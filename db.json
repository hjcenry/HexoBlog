{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"source/favicon.ico","path":"favicon.ico","modified":1,"renderable":0},{"_id":"source/avatar.png","path":"avatar.png","modified":1,"renderable":0},{"_id":"source/robots.txt","path":"robots.txt","modified":1,"renderable":0},{"_id":"themes/next-reload/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/avatar.png","path":"images/avatar.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/images/logo.svg","path":"images/logo.svg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/js/algolia-search.js","path":"js/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/js/bookmark.js","path":"js/bookmark.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/js/local-search.js","path":"js/local-search.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/js/motion.js","path":"js/motion.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/js/next-boot.js","path":"js/next-boot.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/lib/anime.min.js","path":"lib/anime.min.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/index.html","path":"resume/index.html","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/resume.pdf","path":"resume/resume.pdf","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/resume.zip","path":"resume/resume.zip","modified":1,"renderable":1},{"_id":"themes/next-reload/source/css/live2d/waifu.css","path":"css/live2d/waifu.css","modified":1,"renderable":1},{"_id":"themes/next-reload/source/json/live2d/waifu-tips.json","path":"json/live2d/waifu-tips.json","modified":1,"renderable":1},{"_id":"themes/next-reload/source/js/live2d/autoload.js","path":"js/live2d/autoload.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/js/live2d/live2d.min.js","path":"js/live2d/live2d.min.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/js/live2d/waifu-tips.js","path":"js/live2d/waifu-tips.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/js/schemes/pisces.js","path":"js/schemes/pisces.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/css/b639450b0a54d6ac6997f066f3a7caac","path":"resume/css/b639450b0a54d6ac6997f066f3a7caac","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/css/resume.css","path":"resume/css/resume.css","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/book.png","path":"resume/images/book.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/dy.jpg","path":"resume/images/dy.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/gzsgz.png","path":"resume/images/gzsgz.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/hjswz.png","path":"resume/images/hjswz.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/hsxy.png","path":"resume/images/hsxy.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/java.jpg","path":"resume/images/java.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/kidbear_logo.png","path":"resume/images/kidbear_logo.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/mochalogo.png","path":"resume/images/mochalogo.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/qmzg.png","path":"resume/images/qmzg.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/qxws.png","path":"resume/images/qxws.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/qxzb.jpeg","path":"resume/images/qxzb.jpeg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/tjgd.gif","path":"resume/images/tjgd.gif","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/wzswz.png","path":"resume/images/wzswz.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/youxigulogo.png","path":"resume/images/youxigulogo.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/yxswz.png","path":"resume/images/yxswz.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/yxswz2.png","path":"resume/images/yxswz2.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/js/jquery-1.11.0.js","path":"resume/js/jquery-1.11.0.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/js/jquery.fullPage.css","path":"resume/js/jquery.fullPage.css","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/js/jquery.fullPage.min.js","path":"resume/js/jquery.fullPage.min.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/js/jquery.js","path":"resume/js/jquery.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/js/jquery.slimscroll.min.js","path":"resume/js/jquery.slimscroll.min.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/js/resume.js","path":"resume/js/resume.js","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/style/animate.css","path":"resume/style/animate.css","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/style/main.css","path":"resume/style/main.css","modified":1,"renderable":1},{"_id":"themes/next-reload/source/lib/font-awesome/css/all.min.css","path":"lib/font-awesome/css/all.min.css","modified":1,"renderable":1},{"_id":"themes/next-reload/source/lib/font-awesome/webfonts/fa-brands-400.woff2","path":"lib/font-awesome/webfonts/fa-brands-400.woff2","modified":1,"renderable":1},{"_id":"themes/next-reload/source/lib/font-awesome/webfonts/fa-regular-400.woff2","path":"lib/font-awesome/webfonts/fa-regular-400.woff2","modified":1,"renderable":1},{"_id":"themes/next-reload/source/lib/font-awesome/webfonts/fa-solid-900.woff2","path":"lib/font-awesome/webfonts/fa-solid-900.woff2","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/gz/1.jpg","path":"resume/images/gz/1.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/gz/2.jpg","path":"resume/images/gz/2.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/gz/3.jpg","path":"resume/images/gz/3.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/gz/4.jpg","path":"resume/images/gz/4.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/gz/5.jpg","path":"resume/images/gz/5.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/qx/1.jpg","path":"resume/images/qx/1.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/qx/2.jpg","path":"resume/images/qx/2.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/qx/3.jpg","path":"resume/images/qx/3.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/qx/4.jpg","path":"resume/images/qx/4.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/qx/5.jpg","path":"resume/images/qx/5.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/swz/1.jpg","path":"resume/images/swz/1.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/swz/2.jpg","path":"resume/images/swz/2.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/swz/3.jpg","path":"resume/images/swz/3.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/swz/4.jpg","path":"resume/images/swz/4.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/swz/5.jpg","path":"resume/images/swz/5.jpg","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/tjgd/1.png","path":"resume/images/tjgd/1.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/tjgd/2.png","path":"resume/images/tjgd/2.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/tjgd/3.png","path":"resume/images/tjgd/3.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/tjgd/4.png","path":"resume/images/tjgd/4.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/images/tjgd/5.png","path":"resume/images/tjgd/5.png","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/semantic/dist/semantic.min.css","path":"resume/semantic/dist/semantic.min.css","modified":1,"renderable":1},{"_id":"themes/next-reload/source/resume/semantic/dist/semantic.min.js","path":"resume/semantic/dist/semantic.min.js","modified":1,"renderable":1}],"Cache":[{"_id":"source/404.html","hash":"68a02c0fbd1a1e037e5964085885c01f88d3cc7f","modified":1601135951873},{"_id":"source/favicon.ico","hash":"83820c5ed6162be2750a6b33b957fea5049c584a","modified":1461496420000},{"_id":"source/about/.DS_Store","hash":"4b1737e2d95536850ac239b97c1d4b1deae9a602","modified":1461489184000},{"_id":"source/robots.txt","hash":"44f20486d756e1bf2ce409aeae56496a0476f8a2","modified":1461684872000},{"_id":"source/about/index.md","hash":"1210d190f948389bfa52dc4f6111dc9145b2dd7f","modified":1601134856476},{"_id":"source/_posts/2017随笔总结.md","hash":"6ee60308589903cb1f078c57df085951d6cce87b","modified":1515428085104},{"_id":"source/_posts/CVP认证学习笔记--(何小成)001--在场景中加入文字层.md","hash":"8f246f6559cfdf2a696069c4e0adf8b9796675bf","modified":1461510244000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)003--实现文本菜单层.md","hash":"32ffc20bca960c8d5e2a51fb4b47f1cc950debcb","modified":1461510220000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)002--在场景中加入图片层.md","hash":"d271187bc5e9d2922ed2bbfe261b7f5a0360b9cf","modified":1461510232000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)004--实现自定义场景.md","hash":"4aef0c962404266d6a177d42a195d7549332df09","modified":1462554176000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)005--实现多场景切换.md","hash":"edb466d8877485bf1a81a14e83ca0d6b3ac238e3","modified":1461510180000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)006--实现场景切换特效.md","hash":"e5429803f204e167885db9bbdf6ebe255a31f15f","modified":1461510168000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)007--节点的锚点和坐标.md","hash":"bc95140371e086f5f571bf1d2d662442a17ec460","modified":1461510154000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)008--Node的父子关系.md","hash":"6c898046a5f4716ca29bed908a1f0a38344c1c87","modified":1461510144000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)010--节点的计划任务.md","hash":"712d8b1ed4d3db4ec97d8e9b72e5fbd9049e748f","modified":1461510122000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)009--节点的旋转和缩放.md","hash":"c029d92c5134189bc67fd36da0eb5d1af093d3aa","modified":1461510130000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)011--节点的Action.md","hash":"64e7266c8418e75ca05cfef24c715a673e85868f","modified":1461510100000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)014--点击英雄.md","hash":"e424545ea034a273b771fa0691fb2f99f0d0dcd9","modified":1461510076000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)012--组合动作 .md","hash":"2bf2a725df5ea2a78c193b61704ece2c1c1500d9","modified":1461510096000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)013--在Node的生命周期和图层种处理触摸.md","hash":"d6ff7ff124f027cbd0a65faf2b0a67c9b43e0304","modified":1461510088000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)015--实现绘图节点.md","hash":"595a9afe13aaca6eeaa3e283e802e5027cde733a","modified":1461510068000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)016--实现纹理缓存.md","hash":"f34e8fa7485cdcefa76144b5e73b5fb6529891e5","modified":1461509780000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)017--图片资源的异步加载.md","hash":"d95c6a69362041037ddd79d96b3fcec5b62ecef7","modified":1462002428000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)018--批处理纹理绘图.md","hash":"b9857105e96b0bb32267ecd964d5982fd499842c","modified":1462002420000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)019--实现帧动画处理.md","hash":"653e2cb189d9291b429b5076bedecb49dbd144d2","modified":1462002414000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)020--实现切图帧动画.md","hash":"f96a63954a3664ab2a1d90d877842025ae6eed46","modified":1462002404000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)021--纹理打包文件读取.md","hash":"738998bffc6d974354dfdfbafa17272a28616f29","modified":1462015098000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)022--加载帧动画.md","hash":"69aeb61a01ff6d651d329e4a45eacc55df9de875","modified":1462553920000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)023--加载骨骼动画.md","hash":"15f061a16237e306268d62fa17691d021c947a74","modified":1462553912000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)024--粒子动画.md","hash":"dcaf8834ced680ad3a83ed579de0324f633372cc","modified":1462554246000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)025--音乐和音效.md","hash":"ddc2f04d18f9662fe643aa6ef1aa555be8909330","modified":1464489290000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)026--数组的使用.md","hash":"97cd36c64483ca4dbb3472d1433d031f6137fbc5","modified":1464489310000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)027--纹理缓存的管理.md","hash":"4769e70b714fd75feabed1f5b968c694c6bada54","modified":1464883784000},{"_id":"source/_posts/CVP认证学习笔记--(何小成)骨骼动画的制作.md","hash":"6b42d746d0fcf59f9fc70dc49ae07b6a5e753002","modified":1462893614000},{"_id":"source/_posts/Cocos Creator实现的《点我+1》.md","hash":"1a298d987a7e9615d0a6011857a222dbaf7c544c","modified":1467479544000},{"_id":"source/_posts/Cocos2d-JS实现的2048.md","hash":"d22a647a773d2b327a8f9b5af609b73b7dd54e60","modified":1466348290000},{"_id":"source/_posts/Cocos2d-JS实现的贪吃蛇.md","hash":"65a8367ae6e0b869e44077bedde4f0edc13d318b","modified":1470230054000},{"_id":"source/_posts/Cocos2d-JS实现的打飞机.md","hash":"b06dadb574652a8d6a5e3afd9ccd18a0b8a1c6b2","modified":1468155410000},{"_id":"source/_posts/Java读取CSV和XML文件方法.md","hash":"9de3e2988fc139c0f0a5fc721a0abdc16c429d66","modified":1461344224000},{"_id":"source/_posts/JSON-RPC（jsonrpc4j）使用demo.md","hash":"d4e7530dbdb01e7efda02fbf621e03623607ebfc","modified":1461499766000},{"_id":"source/_posts/我的2019.md","hash":"92b96aedcee0b75432cac17847dd468cda098a8a","modified":1601134463838},{"_id":"source/_posts/微博开源框架Motan初体验.md","hash":"b85f569ae4b615c514b4349ae0921fec95fa9385","modified":1461680472000},{"_id":"source/_posts/我的Python之旅.md","hash":"474328c4be5b16517bd11232ffa3c084ccdfe828","modified":1601134293705},{"_id":"source/tags/index.md","hash":"9e944168e7e8fd8c9ad549c17b7f644e85923a83","modified":1461344224000},{"_id":"source/categories/index.md","hash":"c109ce5f47f8fbb2085ca5240f604a2843bcd3eb","modified":1461344224000},{"_id":"source/avatar.png","hash":"b38d0f754f87df323430262a663918023d319de1","modified":1461496344000},{"_id":"themes/next-reload/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1599023145000},{"_id":"themes/next-reload/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1599023145000},{"_id":"themes/next-reload/.gitattributes","hash":"a54f902957d49356376b59287b894b1a3d7a003f","modified":1599023145000},{"_id":"themes/next-reload/.gitignore","hash":"56f3470755c20311ddd30d421b377697a6e5e68b","modified":1599023145000},{"_id":"themes/next-reload/.stylintrc","hash":"2cf4d637b56d8eb423f59656a11f6403aa90f550","modified":1599023145000},{"_id":"themes/next-reload/.travis.yml","hash":"ecca3b919a5b15886e3eca58aa84aafc395590da","modified":1599023145000},{"_id":"themes/next-reload/LICENSE.md","hash":"18144d8ed58c75af66cb419d54f3f63374cd5c5b","modified":1599023145000},{"_id":"themes/next-reload/README.md","hash":"9b4b7d66aca47f9c65d6321b14eef48d95c4dff1","modified":1599023145000},{"_id":"themes/next-reload/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1599023145000},{"_id":"themes/next-reload/gulpfile.js","hash":"1b4fc262b89948937b9e3794de812a7c1f2f3592","modified":1599023145000},{"_id":"themes/next-reload/package.json","hash":"62fad6de02adbbba9fb096cbe2dcc15fe25f2435","modified":1599023145000},{"_id":"themes/next-reload/.github/CODE_OF_CONDUCT.md","hash":"aa4cb7aff595ca628cb58160ee1eee117989ec4e","modified":1599023145000},{"_id":"themes/next-reload/.github/CONTRIBUTING.md","hash":"e554931b98f251fd49ff1d2443006d9ea2c20461","modified":1599023145000},{"_id":"themes/next-reload/.github/PULL_REQUEST_TEMPLATE.md","hash":"1a435c20ae8fa183d49bbf96ac956f7c6c25c8af","modified":1599023145000},{"_id":"themes/next-reload/.github/config.yml","hash":"1d3f4e8794986817c0fead095c74f756d45f91ed","modified":1599023145000},{"_id":"themes/next-reload/.github/issue-close-app.yml","hash":"7cba457eec47dbfcfd4086acd1c69eaafca2f0cd","modified":1599023145000},{"_id":"themes/next-reload/.github/issue_label_bot.yaml","hash":"fca600ddef6f80c5e61aeed21722d191e5606e5b","modified":1599023145000},{"_id":"themes/next-reload/.github/mergeable.yml","hash":"0ee56e23bbc71e1e76427d2bd255a9879bd36e22","modified":1599023145000},{"_id":"themes/next-reload/.github/release-drafter.yml","hash":"3cc10ce75ecc03a5ce86b00363e2a17eb65d15ea","modified":1599023145000},{"_id":"themes/next-reload/.github/lock.yml","hash":"61173b9522ebac13db2c544e138808295624f7fd","modified":1599023145000},{"_id":"themes/next-reload/.github/stale.yml","hash":"fdf82de9284f8bc8e0b0712b4cc1cb081a94de59","modified":1599023145000},{"_id":"themes/next-reload/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1599023145000},{"_id":"themes/next-reload/.github/support.yml","hash":"d75db6ffa7b4ca3b865a925f9de9aef3fc51925c","modified":1599023145000},{"_id":"themes/next-reload/docs/ALGOLIA-SEARCH.md","hash":"c7a994b9542040317d8f99affa1405c143a94a38","modified":1599023145000},{"_id":"themes/next-reload/docs/DATA-FILES.md","hash":"cddbdc91ee9e65c37a50bec12194f93d36161616","modified":1599023145000},{"_id":"themes/next-reload/docs/INSTALLATION.md","hash":"af88bcce035780aaa061261ed9d0d6c697678618","modified":1599023145000},{"_id":"themes/next-reload/docs/AUTHORS.md","hash":"10135a2f78ac40e9f46b3add3e360c025400752f","modified":1599023145000},{"_id":"themes/next-reload/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"94dc3404ccb0e5f663af2aa883c1af1d6eae553d","modified":1599023145000},{"_id":"themes/next-reload/docs/MATH.md","hash":"d645b025ec7fb9fbf799b9bb76af33b9f5b9ed93","modified":1599023145000},{"_id":"themes/next-reload/docs/UPDATE-FROM-5.1.X.md","hash":"8b6e4b2c9cfcb969833092bdeaed78534082e3e6","modified":1599023145000},{"_id":"themes/next-reload/languages/ar.yml","hash":"9815e84e53d750c8bcbd9193c2d44d8d910e3444","modified":1599023145000},{"_id":"themes/next-reload/languages/de.yml","hash":"74c59f2744217003b717b59d96e275b54635abf5","modified":1599023145000},{"_id":"themes/next-reload/languages/default.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1599023145000},{"_id":"themes/next-reload/languages/en.yml","hash":"45bc5118828bdc72dcaa25282cd367c8622758cb","modified":1599023145000},{"_id":"themes/next-reload/docs/LICENSE.txt","hash":"368bf2c29d70f27d8726dd914f1b3211cae4bbab","modified":1599023145000},{"_id":"themes/next-reload/languages/es.yml","hash":"c64cf05f356096f1464b4b1439da3c6c9b941062","modified":1599023145000},{"_id":"themes/next-reload/languages/fa.yml","hash":"3676b32fda37e122f3c1a655085a1868fb6ad66b","modified":1599023145000},{"_id":"themes/next-reload/languages/fr.yml","hash":"752bf309f46a2cd43890b82300b342d7218d625f","modified":1599023145000},{"_id":"themes/next-reload/languages/hu.yml","hash":"b1ebb77a5fd101195b79f94de293bcf9001d996f","modified":1599023145000},{"_id":"themes/next-reload/languages/id.yml","hash":"572ed855d47aafe26f58c73b1394530754881ec2","modified":1599023145000},{"_id":"themes/next-reload/languages/it.yml","hash":"44759f779ce9c260b895532de1d209ad4bd144bf","modified":1599023145000},{"_id":"themes/next-reload/languages/ja.yml","hash":"0cf0baa663d530f22ff380a051881216d6adcdd8","modified":1599023145000},{"_id":"themes/next-reload/languages/ko.yml","hash":"0feea9e43cd399f3610b94d755a39fff1d371e97","modified":1599023145000},{"_id":"themes/next-reload/languages/pt-BR.yml","hash":"67555b1ba31a0242b12fc6ce3add28531160e35b","modified":1599023145000},{"_id":"themes/next-reload/languages/nl.yml","hash":"5af3473d9f22897204afabc08bb984b247493330","modified":1599023145000},{"_id":"themes/next-reload/languages/pt.yml","hash":"718d131f42f214842337776e1eaddd1e9a584054","modified":1599023145000},{"_id":"themes/next-reload/languages/ru.yml","hash":"e993d5ca072f7f6887e30fc0c19b4da791ca7a88","modified":1599023145000},{"_id":"themes/next-reload/languages/uk.yml","hash":"3a6d635b1035423b22fc86d9455dba9003724de9","modified":1599023145000},{"_id":"themes/next-reload/languages/tr.yml","hash":"fe793f4c2608e3f85f0b872fd0ac1fb93e6155e2","modified":1599023145000},{"_id":"themes/next-reload/languages/vi.yml","hash":"93393b01df148dcbf0863f6eee8e404e2d94ef9e","modified":1599023145000},{"_id":"themes/next-reload/languages/zh-CN.yml","hash":"a1f15571ee7e1e84e3cc0985c3ec4ba1a113f6f8","modified":1599023145000},{"_id":"themes/next-reload/languages/zh-HK.yml","hash":"3789f94010f948e9f23e21235ef422a191753c65","modified":1599023145000},{"_id":"themes/next-reload/layout/_layout.swig","hash":"4b44e5fcc203a267f15dd1bb05611e2a44c51884","modified":1601225082221},{"_id":"themes/next-reload/languages/zh-TW.yml","hash":"8c09da7c4ec3fca2c6ee897b2eea260596a2baa1","modified":1599023145000},{"_id":"themes/next-reload/layout/archive.swig","hash":"e4e31317a8df68f23156cfc49e9b1aa9a12ad2ed","modified":1599023145000},{"_id":"themes/next-reload/layout/category.swig","hash":"1bde61cf4d2d171647311a0ac2c5c7933f6a53b0","modified":1599023145000},{"_id":"themes/next-reload/layout/post.swig","hash":"2f6d992ced7e067521fdce05ffe4fd75481f41c5","modified":1599023145000},{"_id":"themes/next-reload/layout/page.swig","hash":"db581bdeac5c75fabb0f17d7c5e746e47f2a9168","modified":1599023145000},{"_id":"themes/next-reload/layout/index.swig","hash":"7f403a18a68e6d662ae3e154b2c1d3bbe0801a23","modified":1599023145000},{"_id":"themes/next-reload/layout/tag.swig","hash":"0dfb653bd5de980426d55a0606d1ab122bd8c017","modified":1599023145000},{"_id":"themes/next-reload/scripts/renderer.js","hash":"49a65df2028a1bc24814dc72fa50d52231ca4f05","modified":1599023145000},{"_id":"themes/next-reload/.github/ISSUE_TEMPLATE/bug-report.md","hash":"c3e6b8196c983c40fd140bdeca012d03e6e86967","modified":1599023145000},{"_id":"themes/next-reload/.github/ISSUE_TEMPLATE/feature-request.md","hash":"12d99fb8b62bd9e34d9672f306c9ae4ace7e053e","modified":1599023145000},{"_id":"themes/next-reload/.github/ISSUE_TEMPLATE/other.md","hash":"d3efc0df0275c98440e69476f733097916a2d579","modified":1599023145000},{"_id":"themes/next-reload/.github/ISSUE_TEMPLATE/question.md","hash":"53df7d537e26aaf062d70d86835c5fd8f81412f3","modified":1599023145000},{"_id":"themes/next-reload/docs/ru/DATA-FILES.md","hash":"0bd2d696f62a997a11a7d84fec0130122234174e","modified":1599023145000},{"_id":"themes/next-reload/docs/ru/INSTALLATION.md","hash":"9c4fe2873123bf9ceacab5c50d17d8a0f1baef27","modified":1599023145000},{"_id":"themes/next-reload/docs/ru/README.md","hash":"85dd68ed1250897a8e4a444a53a68c1d49eb7e11","modified":1599023145000},{"_id":"themes/next-reload/docs/ru/UPDATE-FROM-5.1.X.md","hash":"5237a368ab99123749d724b6c379415f2c142a96","modified":1599023145000},{"_id":"themes/next-reload/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"34b88784ec120dfdc20fa82aadeb5f64ef614d14","modified":1599023145000},{"_id":"themes/next-reload/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"fb23b85db6f7d8279d73ae1f41631f92f64fc864","modified":1599023145000},{"_id":"themes/next-reload/docs/zh-CN/CONTRIBUTING.md","hash":"d3f03be036b75dc71cf3c366cd75aee7c127c874","modified":1599023145000},{"_id":"themes/next-reload/docs/zh-CN/DATA-FILES.md","hash":"ca1030efdfca5e20f9db2e7a428998e66a24c0d0","modified":1599023145000},{"_id":"themes/next-reload/docs/zh-CN/INSTALLATION.md","hash":"579c7bd8341873fb8be4732476d412814f1a3df7","modified":1599023145000},{"_id":"themes/next-reload/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"8b18f84503a361fc712b0fe4d4568e2f086ca97d","modified":1599023145000},{"_id":"themes/next-reload/docs/zh-CN/MATH.md","hash":"b92585d251f1f9ebe401abb5d932cb920f9b8b10","modified":1599023145000},{"_id":"themes/next-reload/docs/zh-CN/README.md","hash":"c038629ff8f3f24e8593c4c8ecf0bef3a35c750d","modified":1599023145000},{"_id":"themes/next-reload/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"d9ce7331c1236bbe0a551d56cef2405e47e65325","modified":1599023145000},{"_id":"themes/next-reload/layout/_macro/post-collapse.swig","hash":"9c8dc0b8170679cdc1ee9ee8dbcbaebf3f42897b","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/comments.swig","hash":"db6ab5421b5f4b7cb32ac73ad0e053fdf065f83e","modified":1599023145000},{"_id":"themes/next-reload/layout/_macro/sidebar.swig","hash":"71655ca21907e9061b6e8ac52d0d8fbf54d0062b","modified":1599023145000},{"_id":"themes/next-reload/layout/_macro/post.swig","hash":"090b5a9b6fca8e968178004cbd6cff205b7eba57","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/footer.swig","hash":"cf43c5804db7288d1745ecad68a449177e89c91d","modified":1601219897811},{"_id":"themes/next-reload/layout/_partials/languages.swig","hash":"ba9e272f1065b8f0e8848648caa7dea3f02c6be1","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/pagination.swig","hash":"9876dbfc15713c7a47d4bcaa301f4757bd978269","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/widgets.swig","hash":"83a40ce83dfd5cada417444fb2d6f5470aae6bb0","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/baidu-push.swig","hash":"b782eb2e34c0c15440837040b5d65b093ab6ec04","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/index.swig","hash":"70c3c01dd181de81270c57f3d99b6d8f4c723404","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/quicklink.swig","hash":"311e5eceec9e949f1ea8d623b083cec0b8700ff2","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/rating.swig","hash":"2731e262a6b88eaee2a3ca61e6a3583a7f594702","modified":1599023145000},{"_id":"themes/next-reload/layout/_scripts/index.swig","hash":"cea942b450bcb0f352da78d76dc6d6f1d23d5029","modified":1599023145000},{"_id":"themes/next-reload/layout/_scripts/noscript.swig","hash":"d1f2bfde6f1da51a2b35a7ab9e7e8eb6eefd1c6b","modified":1599023145000},{"_id":"themes/next-reload/layout/_scripts/pjax.swig","hash":"4d2c93c66e069852bb0e3ea2e268d213d07bfa3f","modified":1599023145000},{"_id":"themes/next-reload/layout/_scripts/three.swig","hash":"a4f42f2301866bd25a784a2281069d8b66836d0b","modified":1599023145000},{"_id":"themes/next-reload/layout/_scripts/vendors.swig","hash":"ef38c213679e7b6d2a4116f56c9e55d678446069","modified":1599023145000},{"_id":"themes/next-reload/scripts/events/index.js","hash":"5743cde07f3d2aa11532a168a652e52ec28514fd","modified":1599023145000},{"_id":"themes/next-reload/scripts/filters/default-injects.js","hash":"aec50ed57b9d5d3faf2db3c88374f107203617e0","modified":1599023145000},{"_id":"themes/next-reload/scripts/filters/front-matter.js","hash":"703bdd142a671b4b67d3d9dfb4a19d1dd7e7e8f7","modified":1599023145000},{"_id":"themes/next-reload/scripts/filters/locals.js","hash":"b193a936ee63451f09f8886343dcfdca577c0141","modified":1599023145000},{"_id":"themes/next-reload/scripts/filters/minify.js","hash":"19985723b9f677ff775f3b17dcebf314819a76ac","modified":1599023145000},{"_id":"themes/next-reload/scripts/filters/post.js","hash":"44ba9b1c0bdda57590b53141306bb90adf0678db","modified":1599023145000},{"_id":"themes/next-reload/scripts/helpers/engine.js","hash":"bdb424c3cc0d145bd0c6015bb1d2443c8a9c6cda","modified":1599023145000},{"_id":"themes/next-reload/scripts/helpers/font.js","hash":"40cf00e9f2b7aa6e5f33d412e03ed10304b15fd7","modified":1599023145000},{"_id":"themes/next-reload/scripts/helpers/next-config.js","hash":"5e11f30ddb5093a88a687446617a46b048fa02e5","modified":1599023145000},{"_id":"themes/next-reload/scripts/helpers/next-url.js","hash":"958e86b2bd24e4fdfcbf9ce73e998efe3491a71f","modified":1599023145000},{"_id":"themes/next-reload/scripts/tags/button.js","hash":"8c6b45f36e324820c919a822674703769e6da32c","modified":1599023145000},{"_id":"themes/next-reload/scripts/tags/caniuse.js","hash":"94e0bbc7999b359baa42fa3731bdcf89c79ae2b3","modified":1599023145000},{"_id":"themes/next-reload/scripts/tags/center-quote.js","hash":"f1826ade2d135e2f60e2d95cb035383685b3370c","modified":1599023145000},{"_id":"themes/next-reload/scripts/tags/group-pictures.js","hash":"d902fd313e8d35c3cc36f237607c2a0536c9edf1","modified":1599023145000},{"_id":"themes/next-reload/scripts/tags/label.js","hash":"fc5b267d903facb7a35001792db28b801cccb1f8","modified":1599023145000},{"_id":"themes/next-reload/scripts/tags/mermaid.js","hash":"983c6c4adea86160ecc0ba2204bc312aa338121d","modified":1599023145000},{"_id":"themes/next-reload/scripts/tags/note.js","hash":"0a02bb4c15aec41f6d5f1271cdb5c65889e265d9","modified":1599023145000},{"_id":"themes/next-reload/scripts/tags/pdf.js","hash":"8c613b39e7bff735473e35244b5629d02ee20618","modified":1599023145000},{"_id":"themes/next-reload/scripts/tags/tabs.js","hash":"93d8a734a3035c1d3f04933167b500517557ba3e","modified":1599023145000},{"_id":"themes/next-reload/scripts/tags/video.js","hash":"e5ff4c44faee604dd3ea9db6b222828c4750c227","modified":1599023145000},{"_id":"themes/next-reload/source/css/_colors.styl","hash":"a8442520f719d3d7a19811cb3b85bcfd4a596e1f","modified":1599023145000},{"_id":"themes/next-reload/source/css/_mixins.styl","hash":"e31a557f8879c2f4d8d5567ee1800b3e03f91f6e","modified":1599023145000},{"_id":"themes/next-reload/source/css/main.styl","hash":"a3a3bbb5a973052f0186b3523911cb2539ff7b88","modified":1599023145000},{"_id":"themes/next-reload/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1599023145000},{"_id":"themes/next-reload/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1599023145000},{"_id":"themes/next-reload/source/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1599023145000},{"_id":"themes/next-reload/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1599023145000},{"_id":"themes/next-reload/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1599023145000},{"_id":"themes/next-reload/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1599023145000},{"_id":"themes/next-reload/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1599023145000},{"_id":"themes/next-reload/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1599023145000},{"_id":"themes/next-reload/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1599023145000},{"_id":"themes/next-reload/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1599023145000},{"_id":"themes/next-reload/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1599023145000},{"_id":"themes/next-reload/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1599023145000},{"_id":"themes/next-reload/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1599023145000},{"_id":"themes/next-reload/source/js/algolia-search.js","hash":"498d233eb5c7af6940baf94c1a1c36fdf1dd2636","modified":1599023145000},{"_id":"themes/next-reload/source/js/bookmark.js","hash":"9734ebcb9b83489686f5c2da67dc9e6157e988ad","modified":1599023145000},{"_id":"themes/next-reload/source/js/local-search.js","hash":"35ccf100d8f9c0fd6bfbb7fa88c2a76c42a69110","modified":1599023145000},{"_id":"themes/next-reload/source/js/motion.js","hash":"72df86f6dfa29cce22abeff9d814c9dddfcf13a9","modified":1599023145000},{"_id":"themes/next-reload/source/js/next-boot.js","hash":"a1b0636423009d4a4e4cea97bcbf1842bfab582c","modified":1599023145000},{"_id":"themes/next-reload/source/js/utils.js","hash":"730cca7f164eaf258661a61ff3f769851ff1e5da","modified":1599023145000},{"_id":"themes/next-reload/source/lib/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1599023145000},{"_id":"themes/next-reload/source/resume/.project","hash":"39e6e871f6091ffdeb3a624c153063a5472f4537","modified":1478709392000},{"_id":"themes/next-reload/source/resume/index.html","hash":"29011e93ecc6af352820272997e9bfffd254e1da","modified":1601225614048},{"_id":"themes/next-reload/layout/_partials/head/head-unique.swig","hash":"000bad572d76ee95d9c0a78f9ccdc8d97cc7d4b4","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/head/head.swig","hash":"810d544019e4a8651b756dd23e5592ee851eda71","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/header/index.swig","hash":"7dbe93b8297b746afb89700b4d29289556e85267","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/header/menu-item.swig","hash":"9440d8a3a181698b80e1fa47f5104f4565d8cdf3","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/header/menu.swig","hash":"d31f896680a6c2f2c3f5128b4d4dd46c87ce2130","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/header/brand.swig","hash":"c70f8e71e026e878a4e9d5ab3bbbf9b0b23c240c","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/header/sub-menu.swig","hash":"ae2261bea836581918a1c2b0d1028a78718434e0","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/page/breadcrumb.swig","hash":"c851717497ca64789f2176c9ecd1dedab237b752","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/page/page-header.swig","hash":"9b7a66791d7822c52117fe167612265356512477","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/post/post-copyright.swig","hash":"954ad71536b6eb08bd1f30ac6e2f5493b69d1c04","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/post/post-followme.swig","hash":"ceba16b9bd3a0c5c8811af7e7e49d0f9dcb2f41e","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/post/post-footer.swig","hash":"8f14f3f8a1b2998d5114cc56b680fb5c419a6b07","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/post/post-reward.swig","hash":"2b1a73556595c37951e39574df5a3f20b2edeaef","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/post/post-related.swig","hash":"f79c44692451db26efce704813f7a8872b7e63a0","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/search/algolia-search.swig","hash":"48430bd03b8f19c9b8cdb2642005ed67d56c6e0b","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/search/index.swig","hash":"2be50f9bfb1c56b85b3b6910a7df27f51143632c","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/search/localsearch.swig","hash":"f48a6a8eba04eb962470ce76dd731e13074d4c45","modified":1599023145000},{"_id":"themes/next-reload/layout/_partials/sidebar/site-overview.swig","hash":"c46849e0af8f8fb78baccd40d2af14df04a074af","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/analytics/baidu-analytics.swig","hash":"4790058691b7d36cf6d2d6b4e93795a7b8d608ad","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/analytics/busuanzi-counter.swig","hash":"ef04b7b564fc4a5f57b52709acf43626ffc36bfe","modified":1601128751990},{"_id":"themes/next-reload/layout/_third-party/analytics/google-analytics.swig","hash":"2fa2b51d56bfac6a1ea76d651c93b9c20b01c09b","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/analytics/growingio.swig","hash":"5adea065641e8c55994dd2328ddae53215604928","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/analytics/index.swig","hash":"1472cabb0181f60a6a0b7fec8899a4d03dfb2040","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/comments/changyan.swig","hash":"f39a5bf3ce9ee9adad282501235e0c588e4356ec","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/comments/disqus.swig","hash":"b14908644225d78c864cd0a9b60c52407de56183","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/comments/disqusjs.swig","hash":"82f5b6822aa5ec958aa987b101ef860494c6cf1f","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/comments/gitalk.swig","hash":"d6ceb70648555338a80ae5724b778c8c58d7060d","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/comments/livere.swig","hash":"f7a9eca599a682479e8ca863db59be7c9c7508c8","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/comments/valine.swig","hash":"be0a8eccf1f6dc21154af297fc79555343031277","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/chat/chatra.swig","hash":"f910618292c63871ca2e6c6e66c491f344fa7b1f","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/chat/tidio.swig","hash":"cba0e6e0fad08568a9e74ba9a5bee5341cfc04c1","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/math/index.swig","hash":"6c5976621efd5db5f7c4c6b4f11bc79d6554885f","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/math/katex.swig","hash":"4791c977a730f29c846efcf6c9c15131b9400ead","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/math/mathjax.swig","hash":"ecf751321e799f0fb3bf94d049e535130e2547aa","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/search/algolia-search.swig","hash":"d35a999d67f4c302f76fdf13744ceef3c6506481","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/search/localsearch.swig","hash":"767b6c714c22588bcd26ba70b0fc19b6810cbacd","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/search/swiftype.swig","hash":"ba0dbc06b9d244073a1c681ff7a722dcbf920b51","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/statistics/busuanzi-counter.swig","hash":"4b1986e43d6abce13450d2b41a736dd6a5620a10","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/statistics/cnzz-analytics.swig","hash":"a17ace37876822327a2f9306a472974442c9005d","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/statistics/firestore.swig","hash":"b26ac2bfbe91dd88267f8b96aee6bb222b265b7a","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/statistics/lean-analytics.swig","hash":"d56d5af427cdfecc33a0f62ee62c056b4e33d095","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/statistics/index.swig","hash":"5f6a966c509680dbfa70433f9d658cee59c304d7","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/tags/mermaid.swig","hash":"f3c43664a071ff3c0b28bd7e59b5523446829576","modified":1599023145000},{"_id":"themes/next-reload/layout/_third-party/tags/pdf.swig","hash":"d30b0e255a8092043bac46441243f943ed6fb09b","modified":1599023145000},{"_id":"themes/next-reload/layout/_scripts/pages/schedule.swig","hash":"077b5d66f6309f2e7dcf08645058ff2e03143e6c","modified":1599023145000},{"_id":"themes/next-reload/layout/_scripts/schemes/gemini.swig","hash":"1c910fc066c06d5fbbe9f2b0c47447539e029af7","modified":1599023145000},{"_id":"themes/next-reload/layout/_scripts/schemes/mist.swig","hash":"7f14ef43d9e82bc1efc204c5adf0b1dbfc919a9f","modified":1599023145000},{"_id":"themes/next-reload/layout/_scripts/schemes/muse.swig","hash":"7f14ef43d9e82bc1efc204c5adf0b1dbfc919a9f","modified":1599023145000},{"_id":"themes/next-reload/layout/_scripts/schemes/pisces.swig","hash":"1c910fc066c06d5fbbe9f2b0c47447539e029af7","modified":1599023145000},{"_id":"themes/next-reload/scripts/events/lib/config.js","hash":"d34c6040b13649714939f59be5175e137de65ede","modified":1599023145000},{"_id":"themes/next-reload/scripts/events/lib/injects-point.js","hash":"6661c1c91c7cbdefc6a5e6a034b443b8811235a1","modified":1599023145000},{"_id":"themes/next-reload/scripts/events/lib/injects.js","hash":"f233d8d0103ae7f9b861344aa65c1a3c1de8a845","modified":1599023145000},{"_id":"themes/next-reload/scripts/filters/comment/changyan.js","hash":"a54708fd9309b4357c423a3730eb67f395344a5e","modified":1599023145000},{"_id":"themes/next-reload/scripts/filters/comment/common.js","hash":"2486f3e0150c753e5f3af1a3665d074704b8ee2c","modified":1599023145000},{"_id":"themes/next-reload/scripts/filters/comment/default-config.js","hash":"7f2d93af012c1e14b8596fecbfc7febb43d9b7f5","modified":1599023145000},{"_id":"themes/next-reload/scripts/filters/comment/disqus.js","hash":"4c0c99c7e0f00849003dfce02a131104fb671137","modified":1599023145000},{"_id":"themes/next-reload/scripts/filters/comment/disqusjs.js","hash":"7f8b92913d21070b489457fa5ed996d2a55f2c32","modified":1599023145000},{"_id":"themes/next-reload/scripts/filters/comment/gitalk.js","hash":"e51dc3072c1ba0ea3008f09ecae8b46242ec6021","modified":1599023145000},{"_id":"themes/next-reload/scripts/filters/comment/valine.js","hash":"6cbd85f9433c06bae22225ccf75ac55e04f2d106","modified":1599023145000},{"_id":"themes/next-reload/scripts/filters/comment/livere.js","hash":"d5fefc31fba4ab0188305b1af1feb61da49fdeb0","modified":1599023145000},{"_id":"themes/next-reload/source/css/_variables/Gemini.styl","hash":"f4e694e5db81e57442c7e34505a416d818b3044a","modified":1599023145000},{"_id":"themes/next-reload/source/css/_variables/Mist.styl","hash":"f70be8e229da7e1715c11dd0e975a2e71e453ac8","modified":1599023145000},{"_id":"themes/next-reload/source/css/_variables/Pisces.styl","hash":"612ec843372dae709acb17112c1145a53450cc59","modified":1599023145000},{"_id":"themes/next-reload/source/css/_variables/Muse.styl","hash":"62df49459d552bbf73841753da8011a1f5e875c8","modified":1599023145000},{"_id":"themes/next-reload/source/css/_variables/base.styl","hash":"818508748b7a62e02035e87fe58e75b603ed56dc","modified":1599023145000},{"_id":"themes/next-reload/source/css/live2d/waifu.css","hash":"243408053336c0312f967ab769782947982067e3","modified":1601224486264},{"_id":"themes/next-reload/source/json/live2d/waifu-tips.json","hash":"13b4bb215ff7438c440b80a24ae1b4523ebefcfd","modified":1596179615000},{"_id":"themes/next-reload/source/js/live2d/autoload.js","hash":"6fbf29da9d00d666c1c14b202eae11c46cec42d8","modified":1601225210855},{"_id":"themes/next-reload/source/js/live2d/waifu-tips.js","hash":"f8bdc91fa1e51d46dc18e04174c63034d68299bf","modified":1596179615000},{"_id":"themes/next-reload/source/js/schemes/muse.js","hash":"1eb9b88103ddcf8827b1a7cbc56471a9c5592d53","modified":1599023145000},{"_id":"themes/next-reload/source/js/schemes/pisces.js","hash":"0ac5ce155bc58c972fe21c4c447f85e6f8755c62","modified":1599023145000},{"_id":"themes/next-reload/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1599023145000},{"_id":"themes/next-reload/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1599023145000},{"_id":"themes/next-reload/source/resume/css/b639450b0a54d6ac6997f066f3a7caac","hash":"7297dbb295156b7a91695e6e032ee1df3a5fabd9","modified":1478709294000},{"_id":"themes/next-reload/source/resume/css/resume.css","hash":"98831160ae370c13da35ddea883bad764384c0bc","modified":1478709808000},{"_id":"themes/next-reload/source/resume/images/gzsgz.png","hash":"7cb27a2900a5f4eab6047c2ed74fb83b1f203c32","modified":1478709820000},{"_id":"themes/next-reload/source/resume/images/hjswz.png","hash":"4c9987f5ec50540692cac7c272ea8a200fc251fc","modified":1478709820000},{"_id":"themes/next-reload/source/resume/images/hsxy.png","hash":"a11d9a7a62f2fcd5c9a9580327d345077982dcaa","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/kidbear_logo.png","hash":"631480f079b54368ad22811d58189958ae029d29","modified":1478709930000},{"_id":"themes/next-reload/source/resume/images/qmzg.png","hash":"4460572896e52bf73562e5b22f2f877f14d296fa","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/qxws.png","hash":"64bd7e3fb08b4330d5cfc9ff501ecd954b3ac9ec","modified":1478709820000},{"_id":"themes/next-reload/source/resume/images/qxzb.jpeg","hash":"3251d8bc3b1a409ff1c1b89535a6250aee50568c","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/tjgd.gif","hash":"75ecba47a662cdeee26930b8b5f31cf43d62f78d","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/wzswz.png","hash":"178a3a1830f59b0761783442e352a1181022e777","modified":1478709820000},{"_id":"themes/next-reload/source/resume/images/yxswz.png","hash":"2f438f19a351244a8610479852875637984fb392","modified":1478709820000},{"_id":"themes/next-reload/source/resume/images/yxswz2.png","hash":"7dc5aaa5bffc0e7922de2c2c3819120c327ae31f","modified":1478709820000},{"_id":"themes/next-reload/source/resume/js/jquery.fullPage.css","hash":"3df7b3175399bb7817d8638c4b23f9e545e104a4","modified":1478709294000},{"_id":"themes/next-reload/source/resume/js/jquery.fullPage.min.js","hash":"91de3815e670fcd7a6d415fe8799d3eb9bce65dc","modified":1478709294000},{"_id":"themes/next-reload/source/resume/js/jquery.slimscroll.min.js","hash":"06418f554a06ae611b248a9e619480882193dc79","modified":1478709294000},{"_id":"themes/next-reload/source/resume/js/resume.js","hash":"a198fb009174ef57f4a12ceebfcc7da6fd56feb5","modified":1478710106000},{"_id":"themes/next-reload/source/resume/style/main.css","hash":"d61b963f1d63db7ee92f07c3baafde6fc3486714","modified":1478709294000},{"_id":"themes/next-reload/source/css/_common/components/back-to-top-sidebar.styl","hash":"ca5e70662dcfb261c25191cc5db5084dcf661c76","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/back-to-top.styl","hash":"a47725574e1bee3bc3b63b0ff2039cc982b17eff","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/components.styl","hash":"8e7b57a72e757cf95278239641726bb2d5b869d1","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/reading-progress.styl","hash":"2e3bf7baf383c9073ec5e67f157d3cb3823c0957","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/mobile.styl","hash":"681d33e3bc85bdca407d93b134c089264837378c","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/outline.styl","hash":"a1690e035b505d28bdef2b4424c13fc6312ab049","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/base.styl","hash":"0b2c4b78eead410020d7c4ded59c75592a648df8","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/buttons.styl","hash":"a2e9e00962e43e98ec2614d6d248ef1773bb9b78","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/comments.styl","hash":"b1f0fab7344a20ed6748b04065b141ad423cf4d9","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/pagination.styl","hash":"8f58570a1bbc34c4989a47a1b7d42a8030f38b06","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/scaffolding.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/tables.styl","hash":"18ce72d90459c9aa66910ac64eae115f2dde3767","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/toggles.styl","hash":"179e33b8ac7f4d8a8e76736a7e4f965fe9ab8b42","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Gemini/index.styl","hash":"7785bd756e0c4acede3a47fec1ed7b55988385a5","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Muse/_header.styl","hash":"f0131db6275ceaecae7e1a6a3798b8f89f6c850d","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Muse/_layout.styl","hash":"4d1c17345d2d39ef7698f7acf82dfc0f59308c34","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Muse/_menu.styl","hash":"93db5dafe9294542a6b5f647643cb9deaced8e06","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Muse/_sidebar.styl","hash":"2b2e7b5cea7783c9c8bb92655e26a67c266886f0","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Mist/_header.styl","hash":"f6516d0f7d89dc7b6c6e143a5af54b926f585d82","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Mist/_layout.styl","hash":"bb7ace23345364eb14983e860a7172e1683a4c94","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Mist/_menu.styl","hash":"7104b9cef90ca3b140d7a7afcf15540a250218fc","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Mist/_posts-expand.styl","hash":"6136da4bbb7e70cec99f5c7ae8c7e74f5e7c261a","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Mist/index.styl","hash":"a717969829fa6ef88225095737df3f8ee86c286b","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Pisces/_header.styl","hash":"e282df938bd029f391c466168d0e68389978f120","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Pisces/_layout.styl","hash":"70a4324b70501132855b5e59029acfc5d3da1ebd","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Pisces/_menu.styl","hash":"85da2f3006f4bef9a2199416ecfab4d288f848c4","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Pisces/_sidebar.styl","hash":"44f47c88c06d89d06f220f102649057118715828","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Pisces/_sub-menu.styl","hash":"e740deadcfc4f29c5cb01e40f9df6277262ba4e3","modified":1599023145000},{"_id":"themes/next-reload/source/css/_schemes/Pisces/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1599023145000},{"_id":"themes/next-reload/source/lib/font-awesome/css/all.min.css","hash":"0038dc97c79451578b7bd48af60ba62282b4082b","modified":1599023145000},{"_id":"themes/next-reload/source/lib/font-awesome/webfonts/fa-regular-400.woff2","hash":"260bb01acd44d88dcb7f501a238ab968f86bef9e","modified":1599023145000},{"_id":"themes/next-reload/source/resume/images/tjgd/4.png","hash":"6663b4538744eb0a0332c534b29d411a881ebbc4","modified":1478709294000},{"_id":"themes/next-reload/source/css/_common/components/pages/breadcrumb.styl","hash":"fafc96c86926b22afba8bb9418c05e6afbc05a57","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/pages/categories.styl","hash":"2bd0eb1512415325653b26d62a4463e6de83c5ac","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/pages/pages.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/pages/schedule.styl","hash":"e771dcb0b4673e063c0f3e2d73e7336ac05bcd57","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/pages/tag-cloud.styl","hash":"d21d4ac1982c13d02f125a67c065412085a92ff2","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/post/post-collapse.styl","hash":"e75693f33dbc92afc55489438267869ae2f3db54","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/post/post-copyright.styl","hash":"f49ca072b5a800f735e8f01fc3518f885951dd8e","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/post/post-eof.styl","hash":"902569a9dea90548bec21a823dd3efd94ff7c133","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/post/post-expand.styl","hash":"ded41fd9d20a5e8db66aaff7cc50f105f5ef2952","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/post/post-followme.styl","hash":"1e4190c10c9e0c9ce92653b0dbcec21754b0b69d","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/post/post-gallery.styl","hash":"72d495a88f7d6515af425c12cbc67308a57d88ea","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/post/post-header.styl","hash":"65cb6edb69e94e70e3291e9132408361148d41d5","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/post/post-nav.styl","hash":"6a97bcfa635d637dc59005be3b931109e0d1ead5","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/post/post-reward.styl","hash":"d114b2a531129e739a27ba6271cfe6857aa9a865","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/post/post-rtl.styl","hash":"f5c2788a78790aca1a2f37f7149d6058afb539e0","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/post/post-tags.styl","hash":"99e12c9ce3d14d4837e3d3f12fc867ba9c565317","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/post/post-widgets.styl","hash":"5b5649b9749e3fd8b63aef22ceeece0a6e1df605","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/post/post.styl","hash":"a760ee83ba6216871a9f14c5e56dc9bd0d9e2103","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/third-party/gitalk.styl","hash":"8a7fc03a568b95be8d3337195e38bc7ec5ba2b23","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/third-party/math.styl","hash":"b49e9fbd3c182b8fc066b8c2caf248e3eb748619","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/third-party/search.styl","hash":"9f0b93d109c9aec79450c8a0cf4a4eab717d674d","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/third-party/related-posts.styl","hash":"e2992846b39bf3857b5104675af02ba73e72eed5","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/components/third-party/third-party.styl","hash":"9a878d0119785a2316f42aebcceaa05a120b9a7a","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/footer/footer.styl","hash":"454a4aebfabb4469b92a8cbb49f46c49ac9bf165","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/header/bookmark.styl","hash":"e2d606f1ac343e9be4f15dbbaf3464bc4df8bf81","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/header/github-banner.styl","hash":"e7a9fdb6478b8674b1cdf94de4f8052843fb71d9","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/header/header.styl","hash":"a793cfff86ad4af818faef04c18013077873f8f0","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/header/headerband.styl","hash":"0caf32492692ba8e854da43697a2ec8a41612194","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/header/menu.styl","hash":"5f432a6ed9ca80a413c68b00e93d4a411abf280a","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/header/site-meta.styl","hash":"45a239edca44acecf971d99b04f30a1aafbf6906","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/header/site-nav.styl","hash":"b2fc519828fe89a1f8f03ff7b809ad68cd46f3d7","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"2cb1876e9e0c9ac32160888af27b1178dbcb0616","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"fa0222197b5eee47e18ac864cdc6eac75678b8fe","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"44487d9ab290dc97871fa8dd4487016deb56e123","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"1f0e7fbe80956f47087c2458ea880acf7a83078b","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/sidebar/sidebar-dimmer.styl","hash":"9b479c2f9a9bfed77885e5093b8245cc5d768ec7","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"a960a2dd587b15d3b3fe1b59525d6fa971c6a6ec","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"a05a4031e799bc864a4536f9ef61fe643cd421af","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"b3220db827e1adbca7880c2bb23e78fa7cbe95cb","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/sidebar/sidebar.styl","hash":"a9cd93c36bae5af9223e7804963096274e8a4f03","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/outline/sidebar/site-state.styl","hash":"2a47f8a6bb589c2fb635e6c1e4a2563c7f63c407","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"f71a3e86c05ea668b008cf05a81f67d92b6d65e4","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/highlight/highlight.styl","hash":"35c871a809afa8306c8cde13651010e282548bc6","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/highlight/diff.styl","hash":"d3f73688bb7423e3ab0de1efdf6db46db5e34f80","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/highlight/theme.styl","hash":"3b3acc5caa0b95a2598bef4eeacb21bab21bea56","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"1d2778ca5aeeeafaa690dc2766b01b352ab76a02","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"709d10f763e357e1472d6471f8be384ec9e2d983","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/tags/label.styl","hash":"d7fce4b51b5f4b7c31d93a9edb6c6ce740aa0d6b","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/tags/note.styl","hash":"e4d9a77ffe98e851c1202676940097ba28253313","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/tags/pdf.styl","hash":"b49c64f8e9a6ca1c45c0ba98febf1974fdd03616","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/tags/tabs.styl","hash":"f23670f1d8e749f3e83766d446790d8fd9620278","modified":1599023145000},{"_id":"themes/next-reload/source/css/_common/scaffolding/tags/tags.styl","hash":"9e4c0653cfd3cc6908fa0d97581bcf80861fb1e7","modified":1599023145000},{"_id":"themes/next-reload/_config.yml","hash":"7281fa104ab814f93fc6aba2e3d050eb0eb30115","modified":1601225614040},{"_id":"themes/next-reload/source/images/avatar.png","hash":"b38d0f754f87df323430262a663918023d319de1","modified":1598028727000},{"_id":"themes/next-reload/source/resume/images/java.jpg","hash":"4868885775e0dc19255566dea9f8be4df5a7f77e","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/mochalogo.png","hash":"fca78c8c393b192009c3cd3d56952d0c1bab94f2","modified":1478709294000},{"_id":"themes/next-reload/source/resume/style/animate.css","hash":"9cc2b3b9d0f376328cc32b80e486850a2964c27c","modified":1478709294000},{"_id":"themes/next-reload/source/lib/font-awesome/webfonts/fa-brands-400.woff2","hash":"509988477da79c146cb93fb728405f18e923c2de","modified":1599023145000},{"_id":"themes/next-reload/source/lib/font-awesome/webfonts/fa-solid-900.woff2","hash":"75a88815c47a249eadb5f0edc1675957f860cca7","modified":1599023145000},{"_id":"themes/next-reload/source/resume/images/qx/1.jpg","hash":"364786656d77eba516dc872ff09a49c40182bcf6","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/qx/2.jpg","hash":"8213f4a2b0629d0489f5b61b3c485335e6c9b572","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/qx/3.jpg","hash":"f83444b6c66167dfe06b9962ea409c9e27378988","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/qx/4.jpg","hash":"c7009e83920aebaa9c97c832b451266cf33ce203","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/qx/5.jpg","hash":"4dab621b0256a5d13762f8c776fd438c13a92aea","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/tjgd/1.png","hash":"56da17d7486aca13a74f9ae77ff443a39caa389c","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/tjgd/2.png","hash":"b2daa7671bb6d30fd239244dd712964124bd81f4","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/tjgd/3.png","hash":"a062a96d87c08411c5f3de1f68d868fefc0725e7","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/tjgd/5.png","hash":"508e11cdb322dea92d44e70b62caf2f5b094ab1b","modified":1478709294000},{"_id":"themes/next-reload/source/js/live2d/live2d.min.js","hash":"94383fb61de815c3f806ae3f11026bbcfe384082","modified":1596179615000},{"_id":"themes/next-reload/source/resume/images/gz/1.jpg","hash":"4f46b8b87e24f92f5a5b875912b2ff76dac03368","modified":1478709846000},{"_id":"themes/next-reload/source/resume/images/gz/3.jpg","hash":"07280e31aae6acc24cf8585239686a7b6bc48b72","modified":1478709846000},{"_id":"themes/next-reload/source/resume/images/gz/4.jpg","hash":"1f286932ac61c8b23dc62578045679c293803210","modified":1478709846000},{"_id":"themes/next-reload/source/resume/images/gz/5.jpg","hash":"815377ed8aa4bef29776ea9058ae3d89a57e82e4","modified":1478709846000},{"_id":"themes/next-reload/source/resume/images/swz/2.jpg","hash":"063ef7d5086a8a502a9cac442af52f0669c68671","modified":1478709840000},{"_id":"themes/next-reload/source/resume/images/swz/3.jpg","hash":"0204ac37f93ae1220e0e876c551e92eef8bd5d91","modified":1478709840000},{"_id":"themes/next-reload/source/resume/images/swz/4.jpg","hash":"3d4760ac27ca60d6c48be71aba9d2366b0a6acdf","modified":1478709840000},{"_id":"themes/next-reload/source/resume/images/swz/5.jpg","hash":"2424c3a624d3bad3656136af7a4b826aaa140f41","modified":1478709840000},{"_id":"themes/next-reload/source/resume/resume.zip","hash":"3d38c0381eea234f8be4d3d0443aecc0f660685d","modified":1487045292000},{"_id":"themes/next-reload/source/resume/images/gz/2.jpg","hash":"ba2e71f157e67326f075a1c6e6ad702324c552a5","modified":1478709846000},{"_id":"themes/next-reload/source/resume/resume.pdf","hash":"297f18b3def1d5a110a0c1ab9d5d2939ed0c24eb","modified":1487045230000},{"_id":"themes/next-reload/source/resume/js/jquery.js","hash":"bfc05b695dfa4f23e11d04b84993585da7a764bf","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/youxigulogo.png","hash":"d410b0651a9f6b4ecb8580f42a4847460922c8e2","modified":1478709294000},{"_id":"themes/next-reload/source/resume/js/jquery-1.11.0.js","hash":"6945741107601d402c70a13ce46eb72fd1168bc8","modified":1478709294000},{"_id":"themes/next-reload/source/resume/semantic/dist/semantic.min.js","hash":"753394b11f75de8d1fd34d4696af3a2d00aa6bd2","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/swz/1.jpg","hash":"b3b5d1e540950f4d33e971c4a62d0e73483efdab","modified":1478709840000},{"_id":"themes/next-reload/source/resume/semantic/dist/semantic.min.css","hash":"be7a3de04ac7f2567c7e0a0c9e9feadd5c7f4175","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/dy.jpg","hash":"f3e1714da2929a66ac8297ea2b5fd22495fbb681","modified":1478709294000},{"_id":"themes/next-reload/source/resume/images/book.png","hash":"81b46b61e0140c225cbf5130998aefdb5a5bfb33","modified":1478709910000},{"_id":"public/atom.xml","hash":"a702b7e9727451ec0bc7558eff50f41e763961cf","modified":1601227270427},{"_id":"public/search.xml","hash":"652155a21356332dc165943bb7124a45050d4c5b","modified":1601227270427},{"_id":"public/sitemap.xml","hash":"d2af8e45bf2e132003c4a1945f9a6b8e3025e18f","modified":1601227270427},{"_id":"public/404.html","hash":"56e4c215bc5007e043ae39f462769e05e5a60816","modified":1601227270427},{"_id":"public/about/index.html","hash":"8be0fc6706539e4b64a53d4df07f1d9b5af912a4","modified":1601227270427},{"_id":"public/tags/index.html","hash":"ffc0d459ae65243554e4c795968143132b857a6a","modified":1601227270427},{"_id":"public/categories/index.html","hash":"2412b32d47be20265111f37f5c9bb27ce0d5ddd6","modified":1601227270427},{"_id":"public/2019/12/25/我的2019/index.html","hash":"0ae68a37e1828920d7a9ec6674c5de8ddfc1df07","modified":1601227270427},{"_id":"public/2019/11/10/我的Python之旅/index.html","hash":"bc264f68a20a8f90801980ba350178be05a21d90","modified":1601227270427},{"_id":"public/2018/01/08/2017随笔总结/index.html","hash":"0f5c3701b6a2705cd6c37a857dbae726cb84925b","modified":1601227270427},{"_id":"public/2016/07/10/Cocos2d-JS实现的打飞机/index.html","hash":"153ef8d943a1a20333423546589271af250d3a5d","modified":1601227270427},{"_id":"public/2016/07/02/Cocos Creator实现的《点我+1》/index.html","hash":"7474f6c3893bfec77fe7b18585356569e1f3215e","modified":1601227270427},{"_id":"public/2016/06/19/Cocos2d-JS实现的2048/index.html","hash":"7aef06fd4cd319836877804736d15d68d296c9e1","modified":1601227270427},{"_id":"public/2016/06/02/CVP认证学习笔记--(何小成)027--纹理缓存的管理/index.html","hash":"237bdeda7fc76e7da59e6cc86c12422202edeec9","modified":1601227270427},{"_id":"public/2016/05/29/CVP认证学习笔记--(何小成)026--数组的使用/index.html","hash":"6f69792245243249e9c496a193af1d817760087c","modified":1601227270427},{"_id":"public/2016/05/16/Cocos2d-JS实现的贪吃蛇/index.html","hash":"41fb0d86d34e5b6c9bbf0ced4e931c35dbf1cd70","modified":1601227270427},{"_id":"public/2016/05/10/CVP认证学习笔记--(何小成)骨骼动画的制作/index.html","hash":"ca6c4b3e3b7641ee27978343f39084a31db9d85a","modified":1601227270427},{"_id":"public/2016/05/07/CVP认证学习笔记--(何小成)025--音乐和音效/index.html","hash":"13c76cf8e911922631f21faccd6e299df58238b3","modified":1601227270427},{"_id":"public/2016/05/07/CVP认证学习笔记--(何小成)024--粒子动画/index.html","hash":"93a15dac2cc16b5c740a59eb98e2769457817295","modified":1601227270427},{"_id":"public/2016/05/06/CVP认证学习笔记--(何小成)023--加载骨骼动画/index.html","hash":"e7a7fecdd46c227a205c00520a90b18ef1b0c0f9","modified":1601227270427},{"_id":"public/2016/05/05/CVP认证学习笔记--(何小成)022--加载帧动画/index.html","hash":"78b2533b2e68c5fbf831c083de10462cf5f6cc35","modified":1601227270427},{"_id":"public/2016/04/30/CVP认证学习笔记--(何小成)021--纹理打包文件读取/index.html","hash":"40a704f9d3d1d37df08bfe348ba629f864ca24b9","modified":1601227270427},{"_id":"public/2016/04/26/微博开源框架Motan初体验/index.html","hash":"713284f95b78650c3923b4caf38fccf659dede6a","modified":1601227270427},{"_id":"public/2016/04/25/CVP认证学习笔记--(何小成)020--实现切图帧动画/index.html","hash":"9e590facf9dbe583ae0ebbfa51e17f96a01080f1","modified":1601227270427},{"_id":"public/2016/04/24/CVP认证学习笔记--(何小成)019--实现帧动画处理/index.html","hash":"0469c2dc6a4e19fb8bc541521f6a14cfe8e85141","modified":1601227270427},{"_id":"public/2016/04/23/CVP认证学习笔记--(何小成)018--批处理纹理绘图/index.html","hash":"93db756a7e82c7bbbe5f5b3c466867ad895662e9","modified":1601227270427},{"_id":"public/2016/04/23/CVP认证学习笔记--(何小成)017--图片资源的异步加载/index.html","hash":"9a94768244b0fa09b50a53bb3b9fcb4c5272bab5","modified":1601227270427},{"_id":"public/2016/04/23/CVP认证学习笔记--(何小成)016--实现纹理缓存/index.html","hash":"658e8b91f02813e5a5544799fae80c1be3092ca2","modified":1601227270427},{"_id":"public/2016/04/21/CVP认证学习笔记--(何小成)015--实现绘图节点/index.html","hash":"377535e5dcf94e15eada985b8b405161d5c5b1e2","modified":1601227270427},{"_id":"public/2016/04/20/CVP认证学习笔记--(何小成)014--点击英雄/index.html","hash":"72b05b3448fec29e2ad6bc9389560ebb6603d97f","modified":1601227270427},{"_id":"public/2016/04/19/CVP认证学习笔记--(何小成)013--在Node的生命周期和图层种处理触摸/index.html","hash":"deae5bbd4348fc1e4427f034e12695577334d5e7","modified":1601227270427},{"_id":"public/2016/04/19/CVP认证学习笔记--(何小成)012--组合动作 /index.html","hash":"e8aec39bb2e9c23f40dfecd8956585d76e2ec673","modified":1601227270427},{"_id":"public/2016/04/19/CVP认证学习笔记--(何小成)011--节点的Action/index.html","hash":"a38e7e24465f485ed0f1fe8efd00ef778d8a1627","modified":1601227270427},{"_id":"public/2016/04/18/CVP认证学习笔记--(何小成)010--节点的计划任务/index.html","hash":"fd3ccb512ffc8852f1347391801e53c56ecf095c","modified":1601227270427},{"_id":"public/2016/04/18/CVP认证学习笔记--(何小成)009--节点的旋转和缩放/index.html","hash":"fd5d17922a1ebbe58e9ba470c0a607969c862d49","modified":1601227270427},{"_id":"public/2016/04/18/CVP认证学习笔记--(何小成)008--Node的父子关系/index.html","hash":"948ff872740a60568592078b6fafebf662255853","modified":1601227270427},{"_id":"public/2016/04/17/CVP认证学习笔记--(何小成)007--节点的锚点和坐标/index.html","hash":"f393d6e3e1396864a50e3f907afba8df032f51cb","modified":1601227270427},{"_id":"public/2016/04/16/CVP认证学习笔记--(何小成)006--实现场景切换特效/index.html","hash":"d6004c1df942e9aa4ae66c07927d3058b6015e20","modified":1601227270427},{"_id":"public/2016/04/14/CVP认证学习笔记--(何小成)005--实现多场景切换/index.html","hash":"18e7afa0c1a972cadd013db394a4f5aa0f84a1fa","modified":1601227270427},{"_id":"public/2016/04/13/CVP认证学习笔记--(何小成)004--实现自定义场景/index.html","hash":"7a7f68244321202951afb2e79c4e91ad0bd4c9f0","modified":1601227270427},{"_id":"public/2016/04/08/CVP认证学习笔记--(何小成)003--实现文本菜单层/index.html","hash":"c241ab5abdfb83eaaab6c93e584df7212b770530","modified":1601227270427},{"_id":"public/2016/04/06/CVP认证学习笔记--(何小成)002--在场景中加入图片层/index.html","hash":"0695010f0ce23c98d5928128c78851ed2be652ed","modified":1601227270427},{"_id":"public/2016/04/06/CVP认证学习笔记--(何小成)001--在场景中加入文字层/index.html","hash":"25ff565c4b72d2181e5add753da4591a0bc119c0","modified":1601227270427},{"_id":"public/2016/03/22/JSON-RPC（jsonrpc4j）使用demo/index.html","hash":"b8219fe800206bdc96c004922d0fbf4f970e6138","modified":1601227270427},{"_id":"public/2016/02/18/Java读取CSV和XML文件方法/index.html","hash":"a9b15448c6c90a19b03fe930af35cc603b7a1e6b","modified":1601227270427},{"_id":"public/archives/index.html","hash":"4e9929594256930545488d7198160379e92d792a","modified":1601227270427},{"_id":"public/archives/page/2/index.html","hash":"665f9f547b522ca15805be172f51ebf19add41fb","modified":1601227270427},{"_id":"public/archives/page/3/index.html","hash":"8d0e930587d5b181d9ea1803fd4155deac0a907a","modified":1601227270427},{"_id":"public/archives/page/4/index.html","hash":"007bb86c0a9608b3bde82807b160426ef4a59bab","modified":1601227270427},{"_id":"public/archives/2016/index.html","hash":"757ea7a604363e0b4798918314f090d24ae8963e","modified":1601227270427},{"_id":"public/archives/2016/page/2/index.html","hash":"a245e21d7ee0368d2cb835d02a655c7c6582904c","modified":1601227270427},{"_id":"public/archives/2016/page/3/index.html","hash":"85bf58519ed73fa31121cdd90047fbd5ea728920","modified":1601227270427},{"_id":"public/archives/2016/page/4/index.html","hash":"fc4ebed74ddfcc6f7bf4c9034e4eae3dcaa16b94","modified":1601227270427},{"_id":"public/archives/2016/02/index.html","hash":"448ff03ad2b474c4d93ddc7ddab9e4dc5365b082","modified":1601227270427},{"_id":"public/archives/2016/03/index.html","hash":"7341fc04059c5c42d8386c2fd11a35dbcdaae7a5","modified":1601227270427},{"_id":"public/archives/2016/04/index.html","hash":"57bee0c72b37b5c6b8b2cadfbf0ff48c450cddb7","modified":1601227270427},{"_id":"public/archives/2016/04/page/2/index.html","hash":"5cd75ca9c824f7d2e53e7d8ff55fcd4faadeee2a","modified":1601227270427},{"_id":"public/archives/2016/04/page/3/index.html","hash":"e5a8120cb78e55d2fb29a66e8ec53e10cdd30e2e","modified":1601227270427},{"_id":"public/archives/2016/05/index.html","hash":"840073636290132628f3785a34d0949df2ba8116","modified":1601227270427},{"_id":"public/archives/2016/06/index.html","hash":"4d98fdd110348803bed32931fb163fd28daba0e8","modified":1601227270427},{"_id":"public/archives/2016/07/index.html","hash":"bcc658ee1dc0a3afa80ad01831fb96b325b0c0e8","modified":1601227270427},{"_id":"public/archives/2018/index.html","hash":"51998aafe76abcf779f6cc3b024ef477a0fdcdd6","modified":1601227270427},{"_id":"public/archives/2018/01/index.html","hash":"2126b260a702b601f9d8e3a1eee8e67084f85214","modified":1601227270427},{"_id":"public/archives/2019/index.html","hash":"1199441767c45badaa201f57e9381ef9b6b010ef","modified":1601227270427},{"_id":"public/archives/2019/11/index.html","hash":"2415a861bf4a33ac13db5e0964e1274c2b0e4a22","modified":1601227270427},{"_id":"public/archives/2019/12/index.html","hash":"305c80dee07ae98a4e031bf31fda57b2b3779ef2","modified":1601227270427},{"_id":"public/categories/Java/index.html","hash":"49096f25ff3dd36b41d900d4f7f28cc27d07a273","modified":1601227270427},{"_id":"public/categories/cocos2d-js/index.html","hash":"89f028a020d02ee730845683a9d039b565fa948e","modified":1601227270427},{"_id":"public/categories/cocos2d-js/page/2/index.html","hash":"ef6bf2c27b806e55c42efbc88268f53c25358e83","modified":1601227270427},{"_id":"public/categories/cocos2d-js/page/3/index.html","hash":"097e8867fb4c4df8a1dad03df3d95767628ac5bb","modified":1601227270427},{"_id":"public/categories/cocos2d-js/page/4/index.html","hash":"f8b4e49faf476a5b70215b21ee8f8b926d899fcd","modified":1601227270427},{"_id":"public/categories/Python/index.html","hash":"35bdadfb881acede2e450b9df90efd71463e9054","modified":1601227270427},{"_id":"public/categories/生活/index.html","hash":"9faf950bf73d9e4fcd12625c61fa7ed1b8cdfb74","modified":1601227270427},{"_id":"public/index.html","hash":"4f3b845f74b41ae807f3f332085bc6ff403c9419","modified":1601227270427},{"_id":"public/page/2/index.html","hash":"ef02015d9821d832f40158916c19b6b008e59f6a","modified":1601227270427},{"_id":"public/page/3/index.html","hash":"d6cc461ed80560f036bbf836b2908bbad5c14432","modified":1601227270427},{"_id":"public/page/4/index.html","hash":"55633ce98b49e13d7b8c7ce69d78ba4cf1aaad81","modified":1601227270427},{"_id":"public/tags/Java/index.html","hash":"d47ca6bdc1ee8fb4fdec2e6e4195fc69ee7ec628","modified":1601227270427},{"_id":"public/tags/游戏服务器/index.html","hash":"f2cf416b447bf4d725e9d9996dae832c7e4bc226","modified":1601227270427},{"_id":"public/tags/总结/index.html","hash":"99962277496337442a26d9a6c20654110fce5400","modified":1601227270427},{"_id":"public/tags/随笔/index.html","hash":"3977072d3d3b938bd90326b2e2d51b9a2bf454ea","modified":1601227270427},{"_id":"public/tags/cocos2d-js/index.html","hash":"e310f09ce65b0a860e3e0f7631ba9b04ecce20fc","modified":1601227270427},{"_id":"public/tags/cocos2d-js/page/2/index.html","hash":"3584d56f1c2378c33f56a4c72b1cd18f1c208a86","modified":1601227270427},{"_id":"public/tags/cocos2d-js/page/3/index.html","hash":"de27ced24053f1a0a565cbefeb75701eebc2ea6e","modified":1601227270427},{"_id":"public/tags/cocos2d-js/page/4/index.html","hash":"e2d8f9f4cbe472e428daa468395040bbf3356601","modified":1601227270427},{"_id":"public/tags/cvp/index.html","hash":"e7ef6c6088825877f1e7e21ce1d37d95cc418dd8","modified":1601227270427},{"_id":"public/tags/cvp/page/2/index.html","hash":"eb355ebcd44cb1a01c49c2f1c48271b24a04177c","modified":1601227270427},{"_id":"public/tags/cvp/page/3/index.html","hash":"12d799e6144875ff6eab1f2599bed13a2ed58498","modified":1601227270427},{"_id":"public/tags/cvp/page/4/index.html","hash":"a5268aae68b068058cc7e493bdaead9536c769ca","modified":1601227270427},{"_id":"public/tags/rpc/index.html","hash":"360e8b19ff45a5fe111e26eb74a8639d38406c90","modified":1601227270427},{"_id":"public/tags/jsonrpc/index.html","hash":"03d2f77e5a5be4262379222983fc1bd3ac42e8b5","modified":1601227270427},{"_id":"public/tags/Motan/index.html","hash":"236886da1ddba05e33fa661fe0a6a2dcf2850464","modified":1601227270427},{"_id":"public/tags/开源/index.html","hash":"34f29dad1592fc064c7794f642764afa28e9958a","modified":1601227270427},{"_id":"public/tags/Python/index.html","hash":"2b76175674821cc1727cce3d5190a8c1e1ec956f","modified":1601227270427},{"_id":"public/tags/点我-1/index.html","hash":"42def694421ee816ba515b5911de6c631e5a8e71","modified":1601227270427},{"_id":"public/tags/2048/index.html","hash":"e30720f6d6d35662738eac52b0236fe7ccae65c6","modified":1601227270427},{"_id":"public/tags/贪吃蛇/index.html","hash":"62b29c8ac2b021b5e8d8ae26f9ebf7db9abde9ac","modified":1601227270427},{"_id":"public/tags/csv/index.html","hash":"2053f3f2483d82d13d69abec02db3a1ba3a13257","modified":1601227270427},{"_id":"public/tags/xml/index.html","hash":"5baa1cfb930b7cd3f8b6896b536b9d1140860247","modified":1601227270427},{"_id":"public/tags/生活/index.html","hash":"4ac2761069619783b29b39626f2b635f665a12b1","modified":1601227270427},{"_id":"public/tags/打飞机/index.html","hash":"90ce6a172770d93ff82623e2b415393d3f6084fb","modified":1601227270427},{"_id":"public/favicon.ico","hash":"83820c5ed6162be2750a6b33b957fea5049c584a","modified":1601227270427},{"_id":"public/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1601227270427},{"_id":"public/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1601227270427},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1601227270427},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1601227270427},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1601227270427},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1601227270427},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1601227270427},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1601227270427},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1601227270427},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1601227270427},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1601227270427},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1601227270427},{"_id":"public/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1601227270427},{"_id":"public/resume/css/b639450b0a54d6ac6997f066f3a7caac","hash":"7297dbb295156b7a91695e6e032ee1df3a5fabd9","modified":1601227270427},{"_id":"public/resume/images/gzsgz.png","hash":"7cb27a2900a5f4eab6047c2ed74fb83b1f203c32","modified":1601227270427},{"_id":"public/resume/images/hjswz.png","hash":"4c9987f5ec50540692cac7c272ea8a200fc251fc","modified":1601227270427},{"_id":"public/resume/images/hsxy.png","hash":"a11d9a7a62f2fcd5c9a9580327d345077982dcaa","modified":1601227270427},{"_id":"public/resume/images/kidbear_logo.png","hash":"631480f079b54368ad22811d58189958ae029d29","modified":1601227270427},{"_id":"public/resume/images/qmzg.png","hash":"4460572896e52bf73562e5b22f2f877f14d296fa","modified":1601227270427},{"_id":"public/resume/images/qxws.png","hash":"64bd7e3fb08b4330d5cfc9ff501ecd954b3ac9ec","modified":1601227270427},{"_id":"public/resume/images/qxzb.jpeg","hash":"3251d8bc3b1a409ff1c1b89535a6250aee50568c","modified":1601227270427},{"_id":"public/resume/images/tjgd.gif","hash":"75ecba47a662cdeee26930b8b5f31cf43d62f78d","modified":1601227270427},{"_id":"public/resume/images/wzswz.png","hash":"178a3a1830f59b0761783442e352a1181022e777","modified":1601227270427},{"_id":"public/resume/images/yxswz.png","hash":"2f438f19a351244a8610479852875637984fb392","modified":1601227270427},{"_id":"public/resume/images/yxswz2.png","hash":"7dc5aaa5bffc0e7922de2c2c3819120c327ae31f","modified":1601227270427},{"_id":"public/robots.txt","hash":"44f20486d756e1bf2ce409aeae56496a0476f8a2","modified":1601227270427},{"_id":"public/lib/font-awesome/webfonts/fa-regular-400.woff2","hash":"260bb01acd44d88dcb7f501a238ab968f86bef9e","modified":1601227270427},{"_id":"public/resume/images/tjgd/4.png","hash":"6663b4538744eb0a0332c534b29d411a881ebbc4","modified":1601227270427},{"_id":"public/avatar.png","hash":"b38d0f754f87df323430262a663918023d319de1","modified":1601227270427},{"_id":"public/images/avatar.png","hash":"b38d0f754f87df323430262a663918023d319de1","modified":1601227270427},{"_id":"public/resume/images/java.jpg","hash":"4868885775e0dc19255566dea9f8be4df5a7f77e","modified":1601227270427},{"_id":"public/resume/images/mochalogo.png","hash":"fca78c8c393b192009c3cd3d56952d0c1bab94f2","modified":1601227270427},{"_id":"public/lib/font-awesome/webfonts/fa-brands-400.woff2","hash":"509988477da79c146cb93fb728405f18e923c2de","modified":1601227270427},{"_id":"public/lib/font-awesome/webfonts/fa-solid-900.woff2","hash":"75a88815c47a249eadb5f0edc1675957f860cca7","modified":1601227270427},{"_id":"public/resume/images/qx/1.jpg","hash":"364786656d77eba516dc872ff09a49c40182bcf6","modified":1601227270427},{"_id":"public/resume/images/qx/3.jpg","hash":"f83444b6c66167dfe06b9962ea409c9e27378988","modified":1601227270427},{"_id":"public/resume/images/qx/4.jpg","hash":"c7009e83920aebaa9c97c832b451266cf33ce203","modified":1601227270427},{"_id":"public/resume/images/qx/5.jpg","hash":"4dab621b0256a5d13762f8c776fd438c13a92aea","modified":1601227270427},{"_id":"public/resume/images/tjgd/1.png","hash":"56da17d7486aca13a74f9ae77ff443a39caa389c","modified":1601227270427},{"_id":"public/resume/images/tjgd/2.png","hash":"b2daa7671bb6d30fd239244dd712964124bd81f4","modified":1601227270427},{"_id":"public/resume/images/tjgd/3.png","hash":"a062a96d87c08411c5f3de1f68d868fefc0725e7","modified":1601227270427},{"_id":"public/resume/images/tjgd/5.png","hash":"508e11cdb322dea92d44e70b62caf2f5b094ab1b","modified":1601227270427},{"_id":"public/resume/images/gz/1.jpg","hash":"4f46b8b87e24f92f5a5b875912b2ff76dac03368","modified":1601227270427},{"_id":"public/resume/images/gz/2.jpg","hash":"ba2e71f157e67326f075a1c6e6ad702324c552a5","modified":1601227270427},{"_id":"public/resume/images/qx/2.jpg","hash":"8213f4a2b0629d0489f5b61b3c485335e6c9b572","modified":1601227270427},{"_id":"public/js/algolia-search.js","hash":"498d233eb5c7af6940baf94c1a1c36fdf1dd2636","modified":1601227270427},{"_id":"public/js/bookmark.js","hash":"9734ebcb9b83489686f5c2da67dc9e6157e988ad","modified":1601227270427},{"_id":"public/js/local-search.js","hash":"35ccf100d8f9c0fd6bfbb7fa88c2a76c42a69110","modified":1601227270427},{"_id":"public/js/motion.js","hash":"72df86f6dfa29cce22abeff9d814c9dddfcf13a9","modified":1601227270427},{"_id":"public/js/next-boot.js","hash":"a1b0636423009d4a4e4cea97bcbf1842bfab582c","modified":1601227270427},{"_id":"public/js/utils.js","hash":"730cca7f164eaf258661a61ff3f769851ff1e5da","modified":1601227270427},{"_id":"public/css/live2d/waifu.css","hash":"243408053336c0312f967ab769782947982067e3","modified":1601227270427},{"_id":"public/json/live2d/waifu-tips.json","hash":"11845afc8cdc6395f2affcb9de13c68ffbd87698","modified":1601227270427},{"_id":"public/js/live2d/autoload.js","hash":"6fbf29da9d00d666c1c14b202eae11c46cec42d8","modified":1601227270427},{"_id":"public/js/live2d/waifu-tips.js","hash":"f8bdc91fa1e51d46dc18e04174c63034d68299bf","modified":1601227270427},{"_id":"public/js/schemes/pisces.js","hash":"0ac5ce155bc58c972fe21c4c447f85e6f8755c62","modified":1601227270427},{"_id":"public/js/schemes/muse.js","hash":"1eb9b88103ddcf8827b1a7cbc56471a9c5592d53","modified":1601227270427},{"_id":"public/resume/css/resume.css","hash":"98831160ae370c13da35ddea883bad764384c0bc","modified":1601227270427},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1601227270427},{"_id":"public/resume/js/jquery.fullPage.css","hash":"3df7b3175399bb7817d8638c4b23f9e545e104a4","modified":1601227270427},{"_id":"public/resume/js/jquery.slimscroll.min.js","hash":"06418f554a06ae611b248a9e619480882193dc79","modified":1601227270427},{"_id":"public/resume/js/resume.js","hash":"a198fb009174ef57f4a12ceebfcc7da6fd56feb5","modified":1601227270427},{"_id":"public/resume/style/main.css","hash":"d61b963f1d63db7ee92f07c3baafde6fc3486714","modified":1601227270427},{"_id":"public/css/main.css","hash":"bb0e50892a97817bc93241bdc16ab74657f46c84","modified":1601227270427},{"_id":"public/resume/resume.pdf","hash":"297f18b3def1d5a110a0c1ab9d5d2939ed0c24eb","modified":1601227270427},{"_id":"public/resume/resume.zip","hash":"3d38c0381eea234f8be4d3d0443aecc0f660685d","modified":1601227270427},{"_id":"public/resume/images/gz/4.jpg","hash":"1f286932ac61c8b23dc62578045679c293803210","modified":1601227270427},{"_id":"public/resume/images/gz/5.jpg","hash":"815377ed8aa4bef29776ea9058ae3d89a57e82e4","modified":1601227270427},{"_id":"public/resume/images/swz/5.jpg","hash":"2424c3a624d3bad3656136af7a4b826aaa140f41","modified":1601227270427},{"_id":"public/resume/index.html","hash":"29011e93ecc6af352820272997e9bfffd254e1da","modified":1601227270427},{"_id":"public/lib/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1601227270427},{"_id":"public/resume/js/jquery.fullPage.min.js","hash":"91de3815e670fcd7a6d415fe8799d3eb9bce65dc","modified":1601227270427},{"_id":"public/resume/images/gz/3.jpg","hash":"07280e31aae6acc24cf8585239686a7b6bc48b72","modified":1601227270427},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1601227270427},{"_id":"public/resume/images/youxigulogo.png","hash":"d410b0651a9f6b4ecb8580f42a4847460922c8e2","modified":1601227270427},{"_id":"public/resume/images/swz/4.jpg","hash":"3d4760ac27ca60d6c48be71aba9d2366b0a6acdf","modified":1601227270427},{"_id":"public/lib/font-awesome/css/all.min.css","hash":"0038dc97c79451578b7bd48af60ba62282b4082b","modified":1601227270427},{"_id":"public/resume/images/swz/3.jpg","hash":"0204ac37f93ae1220e0e876c551e92eef8bd5d91","modified":1601227270427},{"_id":"public/resume/style/animate.css","hash":"9cc2b3b9d0f376328cc32b80e486850a2964c27c","modified":1601227270427},{"_id":"public/resume/images/swz/2.jpg","hash":"063ef7d5086a8a502a9cac442af52f0669c68671","modified":1601227270427},{"_id":"public/resume/images/swz/1.jpg","hash":"b3b5d1e540950f4d33e971c4a62d0e73483efdab","modified":1601227270427},{"_id":"public/js/live2d/live2d.min.js","hash":"94383fb61de815c3f806ae3f11026bbcfe384082","modified":1601227270427},{"_id":"public/resume/images/dy.jpg","hash":"f3e1714da2929a66ac8297ea2b5fd22495fbb681","modified":1601227270427},{"_id":"public/resume/semantic/dist/semantic.min.js","hash":"753394b11f75de8d1fd34d4696af3a2d00aa6bd2","modified":1601227270427},{"_id":"public/resume/js/jquery.js","hash":"bfc05b695dfa4f23e11d04b84993585da7a764bf","modified":1601227270427},{"_id":"public/resume/js/jquery-1.11.0.js","hash":"6945741107601d402c70a13ce46eb72fd1168bc8","modified":1601227270427},{"_id":"public/resume/images/book.png","hash":"81b46b61e0140c225cbf5130998aefdb5a5bfb33","modified":1601227270427},{"_id":"public/resume/semantic/dist/semantic.min.css","hash":"be7a3de04ac7f2567c7e0a0c9e9feadd5c7f4175","modified":1601227270427}],"Category":[{"name":"Java","_id":"ckflddhth0004wsazd0woeqx8"},{"name":"cocos2d-js","_id":"ckflddhtp000bwsaz9n1xhs92"},{"name":"Python","_id":"ckflddhuy002swsaz87ii9aoc"},{"name":"生活","_id":"ckflddhvw0058wsazeo0hclaa"}],"Data":[],"Page":[{"_content":"<!DOCTYPE HTML>\n<html>\n<head>\n    <meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8;\"/>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\" />\n    <meta name=\"robots\" content=\"all\" />\n    <meta name=\"robots\" content=\"index,follow\"/>\n</head>\n<body>\n\n<script type=\"text/javascript\" src=\"http://www.qq.com/404/search_children.js\"\n        charset=\"utf-8\" homePageUrl=\"https://www.hjcenry.com\"\n        homePageName=\"回到我的主页\">\n</script>\n\n</body>\n</html>","source":"404.html","raw":"<!DOCTYPE HTML>\n<html>\n<head>\n    <meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8;\"/>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\" />\n    <meta name=\"robots\" content=\"all\" />\n    <meta name=\"robots\" content=\"index,follow\"/>\n</head>\n<body>\n\n<script type=\"text/javascript\" src=\"http://www.qq.com/404/search_children.js\"\n        charset=\"utf-8\" homePageUrl=\"https://www.hjcenry.com\"\n        homePageName=\"回到我的主页\">\n</script>\n\n</body>\n</html>","date":"2020-09-26T15:59:11.873Z","updated":"2020-09-26T15:59:11.873Z","path":"404.html","title":"","comments":1,"layout":"page","_id":"ckflddht70000wsaz0pg2exb5","content":"<!DOCTYPE HTML>\n<html>\n<head>\n    <meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8;\"/>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\" />\n    <meta name=\"robots\" content=\"all\" />\n    <meta name=\"robots\" content=\"index,follow\"/>\n</head>\n<body>\n\n<script type=\"text/javascript\" src=\"http://www.qq.com/404/search_children.js\"\n        charset=\"utf-8\" homePageUrl=\"https://www.hjcenry.com\"\n        homePageName=\"回到我的主页\">\n</script>\n\n</body>\n</html>","site":{"data":{}},"excerpt":"","more":"<!DOCTYPE HTML>\n<html>\n<head>\n    <meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8;\"/>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\" />\n    <meta name=\"robots\" content=\"all\" />\n    <meta name=\"robots\" content=\"index,follow\"/>\n</head>\n<body>\n\n<script type=\"text/javascript\" src=\"http://www.qq.com/404/search_children.js\"\n        charset=\"utf-8\" homePageUrl=\"https://www.hjcenry.com\"\n        homePageName=\"回到我的主页\">\n</script>\n\n</body>\n</html>"},{"title":"about","date":"2016-04-24T09:12:17.000Z","_content":"### 个人介绍\n#### 信息\n姓名：何小成\n#### 简介\n从事Java游戏服务器开发相关工作，目前就职于云畅游戏，参与鬼泣项目的研发。\n刚毕业时从事Java Web后台开发相关工作，后因个人兴趣转向游戏行业，从事游戏后台开发。\n目前工作主要是Java游戏后台开发。平时喜欢研究新技术，并且对Web前端，游戏客户端也感兴趣，也喜欢将一些技术上的心得体会写成文章发表\n### 专业技能\n#### Web前端 \nHtml5、XHtml、Javascript、Css3、JQuery、Mui、Ajax\n#### Java\nSpring、Hibernate、MyBatis、Java、Mina、Netty、Shell、MySQL、Tomcat、Memcache、Redis、MongoDB、Protocol buffer、Maven\n#### 其他\nCocos2d-js、Go、Node.js\n### 联系我\n欢迎各路大神一起交流\nQQ：359583129\n微信：hjcenry","source":"about/index.md","raw":"---\ntitle: about\ndate: 2016-04-24 17:12:17\n---\n### 个人介绍\n#### 信息\n姓名：何小成\n#### 简介\n从事Java游戏服务器开发相关工作，目前就职于云畅游戏，参与鬼泣项目的研发。\n刚毕业时从事Java Web后台开发相关工作，后因个人兴趣转向游戏行业，从事游戏后台开发。\n目前工作主要是Java游戏后台开发。平时喜欢研究新技术，并且对Web前端，游戏客户端也感兴趣，也喜欢将一些技术上的心得体会写成文章发表\n### 专业技能\n#### Web前端 \nHtml5、XHtml、Javascript、Css3、JQuery、Mui、Ajax\n#### Java\nSpring、Hibernate、MyBatis、Java、Mina、Netty、Shell、MySQL、Tomcat、Memcache、Redis、MongoDB、Protocol buffer、Maven\n#### 其他\nCocos2d-js、Go、Node.js\n### 联系我\n欢迎各路大神一起交流\nQQ：359583129\n微信：hjcenry","updated":"2020-09-26T15:40:56.476Z","path":"about/index.html","comments":1,"layout":"page","_id":"ckflddhte0002wsaz6mood0un","content":"<h3 id=\"个人介绍\"><a href=\"#个人介绍\" class=\"headerlink\" title=\"个人介绍\"></a>个人介绍</h3><h4 id=\"信息\"><a href=\"#信息\" class=\"headerlink\" title=\"信息\"></a>信息</h4><p>姓名：何小成</p>\n<h4 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h4><p>从事Java游戏服务器开发相关工作，目前就职于云畅游戏，参与鬼泣项目的研发。<br>刚毕业时从事Java Web后台开发相关工作，后因个人兴趣转向游戏行业，从事游戏后台开发。<br>目前工作主要是Java游戏后台开发。平时喜欢研究新技术，并且对Web前端，游戏客户端也感兴趣，也喜欢将一些技术上的心得体会写成文章发表</p>\n<h3 id=\"专业技能\"><a href=\"#专业技能\" class=\"headerlink\" title=\"专业技能\"></a>专业技能</h3><h4 id=\"Web前端\"><a href=\"#Web前端\" class=\"headerlink\" title=\"Web前端\"></a>Web前端</h4><p>Html5、XHtml、Javascript、Css3、JQuery、Mui、Ajax</p>\n<h4 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h4><p>Spring、Hibernate、MyBatis、Java、Mina、Netty、Shell、MySQL、Tomcat、Memcache、Redis、MongoDB、Protocol buffer、Maven</p>\n<h4 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h4><p>Cocos2d-js、Go、Node.js</p>\n<h3 id=\"联系我\"><a href=\"#联系我\" class=\"headerlink\" title=\"联系我\"></a>联系我</h3><p>欢迎各路大神一起交流<br>QQ：359583129<br>微信：hjcenry</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"个人介绍\"><a href=\"#个人介绍\" class=\"headerlink\" title=\"个人介绍\"></a>个人介绍</h3><h4 id=\"信息\"><a href=\"#信息\" class=\"headerlink\" title=\"信息\"></a>信息</h4><p>姓名：何小成</p>\n<h4 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h4><p>从事Java游戏服务器开发相关工作，目前就职于云畅游戏，参与鬼泣项目的研发。<br>刚毕业时从事Java Web后台开发相关工作，后因个人兴趣转向游戏行业，从事游戏后台开发。<br>目前工作主要是Java游戏后台开发。平时喜欢研究新技术，并且对Web前端，游戏客户端也感兴趣，也喜欢将一些技术上的心得体会写成文章发表</p>\n<h3 id=\"专业技能\"><a href=\"#专业技能\" class=\"headerlink\" title=\"专业技能\"></a>专业技能</h3><h4 id=\"Web前端\"><a href=\"#Web前端\" class=\"headerlink\" title=\"Web前端\"></a>Web前端</h4><p>Html5、XHtml、Javascript、Css3、JQuery、Mui、Ajax</p>\n<h4 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h4><p>Spring、Hibernate、MyBatis、Java、Mina、Netty、Shell、MySQL、Tomcat、Memcache、Redis、MongoDB、Protocol buffer、Maven</p>\n<h4 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h4><p>Cocos2d-js、Go、Node.js</p>\n<h3 id=\"联系我\"><a href=\"#联系我\" class=\"headerlink\" title=\"联系我\"></a>联系我</h3><p>欢迎各路大神一起交流<br>QQ：359583129<br>微信：hjcenry</p>\n"},{"title":"tags","date":"2016-04-22T07:19:13.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2016-04-22 15:19:13\ntype: \"tags\"\n---\n","updated":"2016-04-22T16:57:04.000Z","path":"tags/index.html","comments":1,"layout":"page","_id":"ckflddhtj0006wsazcg8h83oc","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"categories","date":"2016-04-22T07:17:40.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2016-04-22 15:17:40\ntype: \"categories\"\n---\n","updated":"2016-04-22T16:57:04.000Z","path":"categories/index.html","comments":1,"layout":"page","_id":"ckflddhtm0008wsazahvp3pa7","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"2017随笔总结","date":"2018-01-08T12:14:00.000Z","_content":"今天，已经是2018年1月8日，2017年已经过去，今天挤出来时间，来为我的2017做一个迟到的总结。回忆起上次写文章，是2017年2月16号了，那篇文章叫做《我在创业游戏公司的一年》。这一年时间，我没有写文章，20%是因为今年变得很忙，几乎没有太多的业余时间，剩下的80%嘛，嗯，是因为懒，哈哈！说实在的，没有写不代表这一年什么都没发生，相反，2017年，是我收货最大的一年，嗯，各方各面。\n\n过去的2017年，我做了很多我一直很想做的事。<!--more-->\n\n## 完成了4次小型旅游\n还记得2016年写过一篇文章，计划2017年“能出门旅游一次，带上父母和女朋友”，这个小目标算是完成了，而且还超额完成了，因为17年，我们一共旅行了四次，第一次是五一青岛游，第二次是周末天津游，第三次是周末古北水镇游，第四次是元旦上海游。\n\n五一青岛游，这是一次女朋友、我妈、我姨妈、我，我们四个人的旅行，也是今年最满意的一次旅行，整个过程很舒服，青岛也是个十分舒适的城市，那时天气还不算热，也不算冷，很适宜的温度，沙滩上晒太阳的感觉很舒服，青岛的海鲜很好吃，没有遇到新闻里的坑人大虾，青岛有着很典型的滨海城市的特色、海风、海浪、沙滩、海鲜，该有的都有。好玩，好吃，还划算，去的很值。\n\n周末天津游，由女朋友、我、我姨妈、我舅妈我们四个人去的，之前我去过几次天津，印象还是不错的，印象很深的是有一次和同学来天津逛，天津的炸糕给了我很深的回味，很怀念天津炸糕的味道。可惜的是，这次天津游就不是那么顺利了，由于我们想要去天津的海边，于是我们在天津的塘沽地铁站下了地铁，一下地铁，就有很多人过来拉客，说到海边只要十元一位，我们算了下，自己坐车去也比这贵，于是就糊里糊涂的上了车，结果司机给我们拉到了不知名的海边，可以看出来，海边根本还没怎么开发，海水的颜色，就像黄河一样浑浊，这大概是我看过最脏的海水了，不知道是天津的海都这样还是只是这个地方是这样。那个地方很偏，只能通过他们拉客的车进出，不仅浪费了我们的时间，也坑了我们的钱，这大概就是最糟糕的一次天津游了，想想之前我们有同学在这里进了传销，我不是地域黑，但现在想想，天津整体给人的印象大概就一个字“骗”。\n\n古北水镇游，这是一次三五好友的自驾聚会旅行，韵哥，欣妹儿，龚世伟，周帅哥，谢姐姐，罗倩还有我，司机是我丰弟——经常给老师开车的老司机，这次的旅行还是非常开心的，因为大家都是很久不见的朋友，能在北京聚在一起玩儿一次也是不容易，有的在考研，有的在工作，有的在培训，有的在读研，各自的生活都有着很大的压力，一起出门自驾旅行一次，也算是放松放松了。\n\n元旦上海游，罗倩，侯玲，磊哥和我，我们四个人的旅行，到达当晚由黄懂请客吃饭，老实说，吃的不错，黄懂在饿了么省吃俭用，这回被我们一夜吃到解放前。第二天去了迪士尼，第三天，就累了一天......从此决定，节假日千万不要去游乐园的地方，真的是排队一小时，游玩五分钟，但不得不说的是，海盗船项目的360度身临其境大屏幕还是震撼到我了，另外小矮人矿山车也是很刺激，整体来说，就这两个项目最满意，其他的，基本都是好玩带来的感受不及排队带来的痛苦，只有这俩项目是值得排队的，遗憾的是极速光轮项目和飞跃地平线项目没能游玩上，听说是迪士尼的热门项目。经过了第一天的体力消耗，原本计划的第二天上海市区游也游不动了，真！的！不！想！走！了！，累趴了，31晚外滩人很多，元旦跨年活动也就取消了，遗憾的我们打车回去了，中间有个小插曲，就是打到车后，我们几乎等了一个小时才上到车，因为人真的太多了......\n\n不管怎么说，2017年，我也是有了四次小旅行了，感受了各地的人文和自然风景，对此来说，我已经非常满意了。\n\n## 完成了多年的小目标\n还没成年的时候，就想要开车了，我的记忆中，初中开始，家里就有车了，那时候最喜欢的事情，就是坐我妈的车到处走，去哪儿不重要，要的只是和爸爸妈妈坐在车里的感觉，我记得很清楚的是，当时我家车里有一股味道，大概是皮革味吧，离开家以后，闻到这种皮革味就想起坐我妈的车的感觉。18岁终于成年了，家里人担心我的安全就没允许我学车，而上了大学以后因为懒，我也没报驾校去学车。现在很后悔，因为工作以后，我需要花费更多的时间和金钱去学车，不过不管怎么样，我在12月18日，终于拿到了梦寐以求的驾照，这也算是完成了我多年来一个小小的心愿，中间过程还算顺利，就科目二考了两次，第一次因为太紧张，第一个项目倒车入库直接挂了两次，好在调整好心态后，第二次满分过了。拿到驾照以后，我就开始用一度用车APP到处开车练技术，在北京感觉还好，大家还是比较遵守交通规则，不过共享汽车是自动挡，不知道如果换成手动挡我还能不能熟练的起步停车。现在只想好好练练自己的技术，能做到开车时稳定心态，练好了，就能和家人或者朋友出去自驾游，想想还是很开心的。\n\n## 看过的最感动的电影\n这么久以来，看过的电影也不少了，而国庆档的《缝纫机乐队》却是让我最感动的电影。电影描述的是主角和一个小镇的摇滚梦想，努力保卫小镇大吉他雕像和自己的摇滚梦想。我还记得当时我学吉他的时候，听了一段老师打的架子鼓，感觉特别帅，特别有范儿，后来去网上看了很多很帅的打鼓视频，觉得帅爆了，但我还是觉得，听现场的打鼓才是最震撼的。后来，我经常在后海酒吧门口听里面的人演奏，标准的吉他+贝斯+架子鼓+键盘，觉得玩儿摇滚乐的都特别酷。很遗憾自己小时候没有多接触音乐，没有多学习乐器，后来长大了，高三采取学一点吉他，仅仅一点，大学又去学了一些钢琴，也算是小小的满足了下曾经的梦想，至少，能看懂五线谱了，能生啃一个谱子，生练一个月把一首钢琴曲弹会，也算是一点小小的成就感。\n而我的这些音乐梦，在这部电影里，真的完完全全被重述了出来，电影里，乐队第一次合作的时候，即兴演奏的那一段，我不知道为什么，也许是电影院的音效太好，我的心一下被震撼了，当时有眼泪充斥眼眶，或许这正是我多年来被埋没的梦。而就是这一段即兴的演奏，我甚至认为比后面完整的乐队演奏更为震撼，不知道为什么，很奇怪，我现在仍能想起当时在电影院被震撼的感觉。\n后来看评分，《缝纫机乐队》甚至评分不如《羞羞的铁拳》，但是我认为这真的是我整个2017年看过最能震撼到我的电影，或许这是所有有着音乐梦的人共同的心声。回想起来，上一期引起我音乐共鸣的，是一部泰国电影，叫《音为爱》，一部描述高中生的音乐之路，同样是摇滚和梦想的元素，当时我也正在上高中，也是深深的被感触，甚至莫名其妙的喜欢上了电影里的泰语歌。\n感谢大鹏导演，用电影，用他自己的音乐梦，唤起了我们曾经单纯美好的梦想。\n\n## 玩过的最深刻的游戏\n2017年，我也终于玩上了3A大作，《极品飞车20》《神秘海域》《GTA》《生化危机7》《直到黎明》《消逝的光芒》，太多太多大作了，相信所有人，心里都有一个游戏世界，而这些我们小时候都是很难体验到的，小时候玩游戏，总被认为是罪大恶极，总被灌输游戏是穿肠毒药的思想。长大后，再体验游戏这个东西，就会发现，好的游戏真是第九艺术，用一种艺术的形式，带我们体验一段神奇的旅程，感受不一样的世界。身在游戏行业圈，不得不承认的是，现在好游戏基本来自国外，国产游戏很难有什么好游戏，不知道何时开始的，国内游戏行业的发展方向就从用心做游戏变成了用心坑钱。庆幸的是，虽然艰难，我们国内，仍然有坚持做精品游戏的公司，以及独立游戏团队。因为，我支持ICEY，支持神舞幻想，希望能看到中国游戏行业在世界崛起的那一天，并且是以精品游戏为标杆，而不是过度商业化的圈钱产品。希望有更多的像仙剑之父姚壮宪这样优秀的行业大佬出现！\n要说我玩过深刻的游戏，那必须是《最后的守护者》，又叫《食人的大鹫》，别看名字这么可怕，其他它讲述的是一个纯真少年和一直大鸟（或者叫大狗？）的奇妙旅程，游戏的开始，少年变和大鹫在一起，我扮演的就是少年，和大鹫从最初的陌生到熟悉，到亲密，到不可分离，我似乎能真切的感受到这一个游戏里虚拟的动物的存在，我好像真的有个朋友叫做Trico，它陪我渡过一个又一个的难关。而游戏最后的CG也终于让我忍不住落泪，这是我第一次玩游戏落泪，因为我真的感受到了那种与最亲密的朋友分离的痛苦。CG的最后，奄奄一息的少年，举起手对Trico下了最后一个命令——离开这里，大鹫才煽动翅膀飞走，看着大鹫离开的背影，我当时的心情真的很心酸，好在游戏的结尾，少年长大后，举起手中的铜镜，对Trico互换，远在山谷里的大鹫也似乎感受到了这样的心灵感应，最后点题，大鹫成为了山谷最后的守护者。整个游戏的故事背景最终也没有交代完全，其中还有很多玩家所不知道的事情，留下了悬念，但是少年与大鹫的感情，作为玩家的我是真真切切的感受到了。\n真正的游戏大作，就如同音乐、电影一样，是一种艺术形式，通过更强的代入感，让玩家感受到游戏想要表达的真实情感。不能否定最近大火的竞技游戏的存在，但可以肯定是，这类游戏只能带我们实时竞技的快感，却没有任何实际的意义，而真正的大作游戏，是能引起你内心的共鸣，能让你对现实生活产生思考的好作品。\n\n## 做过的最坚持的事情\n去年，我写了一本书，叫做《深度解析Java游戏服务器开发》，说实话，书的内容并不“深度”，基本都是很基础的内容，不过也算是我日日夜夜辛苦写出来的，其中内容质量，相比其他书来说，不算太好。有一次，我还在北京的王府井书店见到有我的书售卖，当时觉得，这本书没白写。鉴于我对去年写的书的内容并不满意，2017年，我又花了半年时间，写了《Cocos2d-JS快速入门到实战》，这本书不算百分百的满意，但也算把我所有关于Cocos的知识抖出来了，如果还要我再写一本书，我好像真的就没什么能写的了。有一点遗憾的是，我的Cocos2d-JS的书刚写出来，临近年底，微信又推出了微信小游戏，而Cocos Creator能更好的支持微信小游戏的构建，这种情况就很尴尬了，我写的Cocos2d-JS，技术相对过气了，现在Cocos更加大力推崇使用Creator，希2018年我的书能够大卖吧，毕竟Cocos2d-JS也是能做微信小游戏的。\n想起前半年写书的日子，也是很痛苦的，每天几乎是9点下班，回家就写书，写到12点再洗漱睡觉，可以说是非常辛苦了，每一章每一小节，我都要想办法通过一个实际的代码案例来阐述（感觉以后可以做个培训老师了），写书的同时，也算是巩固了我自己的知识储备。按照清华出版社编辑的说法，今年年底，我的书应该就能出来了，到时候，希望大家来两本，毕竟，这次这本书，销量与我收入有关了，哈哈哈！\n\n## 最荣幸的事情\n2017年年初的时候，我加入了云畅游戏，进入了鬼泣项目组，从进入到工作到现在，感觉这是我工作生涯中成长最快的一年。在上家公司的时候，我经历的阶段是探索和学习的阶段，在这家公司，我经历的是规范和进阶的阶段。在现在这家公司，我学到了更多的是如果更加规范的写代码，如何高效的写代码，了解了更多关于Java的泛型、反射、设计模式、枚举、JVM等。同时，团队的开发也让我有了更多与人沟通，团队协作的经验。我所在的项目组做的游戏也是我年少时玩过的划时代的ACT主机游戏——鬼泣，在当时来说，可以说是一流的动作游戏了，没有想到多年后的今天，我会亲自参与到游戏的手游版本的制作。说到手游，公司刚宣布与卡婊的合作的时候，游戏圈一片哗然，全是类似于“不要毁了我心中的鬼泣”“国内厂商，毁了”等消极言论，其实在我看来，手游和原作两者本身受众是不同的，我相信真正的动作游戏硬核玩家是不屑于玩儿手游的，我们这款产品无非做的就是一个情怀，吸引那些原IP里愿意体验简化版的鬼泣，以及新的手游玩家，算是同时面向一部分老的主机游戏玩家和一部分手游玩家。从公司以前的作品（《刀剑神域》《不良人2》）来看，我相信我们的《鬼泣》也会成功的，不期望成为爆款，至少达到《崩坏3》的水平，做出手游ACT的一代标杆。\n2017年，我很荣幸成为了鬼泣项目组的一员！\n\n很久没写文章，请原谅我流水账式的总结，只想安安静静的做个总结，来概括我的2017年！\n\n来点彩蛋吧：\n万万没想到的是，上家公司死掉的产品在快年底的时候，活过来了，这得感谢前同事的各种努力，年底突然的喜讯，也拿到一笔意外的小钱，希望我们可以继续越做越好！","source":"_posts/2017随笔总结.md","raw":"---\ntitle: 2017随笔总结\ndate: 2018-01-08 20:14\ncategories: Java\ntags: [Java,游戏服务器,总结,随笔]\n---\n今天，已经是2018年1月8日，2017年已经过去，今天挤出来时间，来为我的2017做一个迟到的总结。回忆起上次写文章，是2017年2月16号了，那篇文章叫做《我在创业游戏公司的一年》。这一年时间，我没有写文章，20%是因为今年变得很忙，几乎没有太多的业余时间，剩下的80%嘛，嗯，是因为懒，哈哈！说实在的，没有写不代表这一年什么都没发生，相反，2017年，是我收货最大的一年，嗯，各方各面。\n\n过去的2017年，我做了很多我一直很想做的事。<!--more-->\n\n## 完成了4次小型旅游\n还记得2016年写过一篇文章，计划2017年“能出门旅游一次，带上父母和女朋友”，这个小目标算是完成了，而且还超额完成了，因为17年，我们一共旅行了四次，第一次是五一青岛游，第二次是周末天津游，第三次是周末古北水镇游，第四次是元旦上海游。\n\n五一青岛游，这是一次女朋友、我妈、我姨妈、我，我们四个人的旅行，也是今年最满意的一次旅行，整个过程很舒服，青岛也是个十分舒适的城市，那时天气还不算热，也不算冷，很适宜的温度，沙滩上晒太阳的感觉很舒服，青岛的海鲜很好吃，没有遇到新闻里的坑人大虾，青岛有着很典型的滨海城市的特色、海风、海浪、沙滩、海鲜，该有的都有。好玩，好吃，还划算，去的很值。\n\n周末天津游，由女朋友、我、我姨妈、我舅妈我们四个人去的，之前我去过几次天津，印象还是不错的，印象很深的是有一次和同学来天津逛，天津的炸糕给了我很深的回味，很怀念天津炸糕的味道。可惜的是，这次天津游就不是那么顺利了，由于我们想要去天津的海边，于是我们在天津的塘沽地铁站下了地铁，一下地铁，就有很多人过来拉客，说到海边只要十元一位，我们算了下，自己坐车去也比这贵，于是就糊里糊涂的上了车，结果司机给我们拉到了不知名的海边，可以看出来，海边根本还没怎么开发，海水的颜色，就像黄河一样浑浊，这大概是我看过最脏的海水了，不知道是天津的海都这样还是只是这个地方是这样。那个地方很偏，只能通过他们拉客的车进出，不仅浪费了我们的时间，也坑了我们的钱，这大概就是最糟糕的一次天津游了，想想之前我们有同学在这里进了传销，我不是地域黑，但现在想想，天津整体给人的印象大概就一个字“骗”。\n\n古北水镇游，这是一次三五好友的自驾聚会旅行，韵哥，欣妹儿，龚世伟，周帅哥，谢姐姐，罗倩还有我，司机是我丰弟——经常给老师开车的老司机，这次的旅行还是非常开心的，因为大家都是很久不见的朋友，能在北京聚在一起玩儿一次也是不容易，有的在考研，有的在工作，有的在培训，有的在读研，各自的生活都有着很大的压力，一起出门自驾旅行一次，也算是放松放松了。\n\n元旦上海游，罗倩，侯玲，磊哥和我，我们四个人的旅行，到达当晚由黄懂请客吃饭，老实说，吃的不错，黄懂在饿了么省吃俭用，这回被我们一夜吃到解放前。第二天去了迪士尼，第三天，就累了一天......从此决定，节假日千万不要去游乐园的地方，真的是排队一小时，游玩五分钟，但不得不说的是，海盗船项目的360度身临其境大屏幕还是震撼到我了，另外小矮人矿山车也是很刺激，整体来说，就这两个项目最满意，其他的，基本都是好玩带来的感受不及排队带来的痛苦，只有这俩项目是值得排队的，遗憾的是极速光轮项目和飞跃地平线项目没能游玩上，听说是迪士尼的热门项目。经过了第一天的体力消耗，原本计划的第二天上海市区游也游不动了，真！的！不！想！走！了！，累趴了，31晚外滩人很多，元旦跨年活动也就取消了，遗憾的我们打车回去了，中间有个小插曲，就是打到车后，我们几乎等了一个小时才上到车，因为人真的太多了......\n\n不管怎么说，2017年，我也是有了四次小旅行了，感受了各地的人文和自然风景，对此来说，我已经非常满意了。\n\n## 完成了多年的小目标\n还没成年的时候，就想要开车了，我的记忆中，初中开始，家里就有车了，那时候最喜欢的事情，就是坐我妈的车到处走，去哪儿不重要，要的只是和爸爸妈妈坐在车里的感觉，我记得很清楚的是，当时我家车里有一股味道，大概是皮革味吧，离开家以后，闻到这种皮革味就想起坐我妈的车的感觉。18岁终于成年了，家里人担心我的安全就没允许我学车，而上了大学以后因为懒，我也没报驾校去学车。现在很后悔，因为工作以后，我需要花费更多的时间和金钱去学车，不过不管怎么样，我在12月18日，终于拿到了梦寐以求的驾照，这也算是完成了我多年来一个小小的心愿，中间过程还算顺利，就科目二考了两次，第一次因为太紧张，第一个项目倒车入库直接挂了两次，好在调整好心态后，第二次满分过了。拿到驾照以后，我就开始用一度用车APP到处开车练技术，在北京感觉还好，大家还是比较遵守交通规则，不过共享汽车是自动挡，不知道如果换成手动挡我还能不能熟练的起步停车。现在只想好好练练自己的技术，能做到开车时稳定心态，练好了，就能和家人或者朋友出去自驾游，想想还是很开心的。\n\n## 看过的最感动的电影\n这么久以来，看过的电影也不少了，而国庆档的《缝纫机乐队》却是让我最感动的电影。电影描述的是主角和一个小镇的摇滚梦想，努力保卫小镇大吉他雕像和自己的摇滚梦想。我还记得当时我学吉他的时候，听了一段老师打的架子鼓，感觉特别帅，特别有范儿，后来去网上看了很多很帅的打鼓视频，觉得帅爆了，但我还是觉得，听现场的打鼓才是最震撼的。后来，我经常在后海酒吧门口听里面的人演奏，标准的吉他+贝斯+架子鼓+键盘，觉得玩儿摇滚乐的都特别酷。很遗憾自己小时候没有多接触音乐，没有多学习乐器，后来长大了，高三采取学一点吉他，仅仅一点，大学又去学了一些钢琴，也算是小小的满足了下曾经的梦想，至少，能看懂五线谱了，能生啃一个谱子，生练一个月把一首钢琴曲弹会，也算是一点小小的成就感。\n而我的这些音乐梦，在这部电影里，真的完完全全被重述了出来，电影里，乐队第一次合作的时候，即兴演奏的那一段，我不知道为什么，也许是电影院的音效太好，我的心一下被震撼了，当时有眼泪充斥眼眶，或许这正是我多年来被埋没的梦。而就是这一段即兴的演奏，我甚至认为比后面完整的乐队演奏更为震撼，不知道为什么，很奇怪，我现在仍能想起当时在电影院被震撼的感觉。\n后来看评分，《缝纫机乐队》甚至评分不如《羞羞的铁拳》，但是我认为这真的是我整个2017年看过最能震撼到我的电影，或许这是所有有着音乐梦的人共同的心声。回想起来，上一期引起我音乐共鸣的，是一部泰国电影，叫《音为爱》，一部描述高中生的音乐之路，同样是摇滚和梦想的元素，当时我也正在上高中，也是深深的被感触，甚至莫名其妙的喜欢上了电影里的泰语歌。\n感谢大鹏导演，用电影，用他自己的音乐梦，唤起了我们曾经单纯美好的梦想。\n\n## 玩过的最深刻的游戏\n2017年，我也终于玩上了3A大作，《极品飞车20》《神秘海域》《GTA》《生化危机7》《直到黎明》《消逝的光芒》，太多太多大作了，相信所有人，心里都有一个游戏世界，而这些我们小时候都是很难体验到的，小时候玩游戏，总被认为是罪大恶极，总被灌输游戏是穿肠毒药的思想。长大后，再体验游戏这个东西，就会发现，好的游戏真是第九艺术，用一种艺术的形式，带我们体验一段神奇的旅程，感受不一样的世界。身在游戏行业圈，不得不承认的是，现在好游戏基本来自国外，国产游戏很难有什么好游戏，不知道何时开始的，国内游戏行业的发展方向就从用心做游戏变成了用心坑钱。庆幸的是，虽然艰难，我们国内，仍然有坚持做精品游戏的公司，以及独立游戏团队。因为，我支持ICEY，支持神舞幻想，希望能看到中国游戏行业在世界崛起的那一天，并且是以精品游戏为标杆，而不是过度商业化的圈钱产品。希望有更多的像仙剑之父姚壮宪这样优秀的行业大佬出现！\n要说我玩过深刻的游戏，那必须是《最后的守护者》，又叫《食人的大鹫》，别看名字这么可怕，其他它讲述的是一个纯真少年和一直大鸟（或者叫大狗？）的奇妙旅程，游戏的开始，少年变和大鹫在一起，我扮演的就是少年，和大鹫从最初的陌生到熟悉，到亲密，到不可分离，我似乎能真切的感受到这一个游戏里虚拟的动物的存在，我好像真的有个朋友叫做Trico，它陪我渡过一个又一个的难关。而游戏最后的CG也终于让我忍不住落泪，这是我第一次玩游戏落泪，因为我真的感受到了那种与最亲密的朋友分离的痛苦。CG的最后，奄奄一息的少年，举起手对Trico下了最后一个命令——离开这里，大鹫才煽动翅膀飞走，看着大鹫离开的背影，我当时的心情真的很心酸，好在游戏的结尾，少年长大后，举起手中的铜镜，对Trico互换，远在山谷里的大鹫也似乎感受到了这样的心灵感应，最后点题，大鹫成为了山谷最后的守护者。整个游戏的故事背景最终也没有交代完全，其中还有很多玩家所不知道的事情，留下了悬念，但是少年与大鹫的感情，作为玩家的我是真真切切的感受到了。\n真正的游戏大作，就如同音乐、电影一样，是一种艺术形式，通过更强的代入感，让玩家感受到游戏想要表达的真实情感。不能否定最近大火的竞技游戏的存在，但可以肯定是，这类游戏只能带我们实时竞技的快感，却没有任何实际的意义，而真正的大作游戏，是能引起你内心的共鸣，能让你对现实生活产生思考的好作品。\n\n## 做过的最坚持的事情\n去年，我写了一本书，叫做《深度解析Java游戏服务器开发》，说实话，书的内容并不“深度”，基本都是很基础的内容，不过也算是我日日夜夜辛苦写出来的，其中内容质量，相比其他书来说，不算太好。有一次，我还在北京的王府井书店见到有我的书售卖，当时觉得，这本书没白写。鉴于我对去年写的书的内容并不满意，2017年，我又花了半年时间，写了《Cocos2d-JS快速入门到实战》，这本书不算百分百的满意，但也算把我所有关于Cocos的知识抖出来了，如果还要我再写一本书，我好像真的就没什么能写的了。有一点遗憾的是，我的Cocos2d-JS的书刚写出来，临近年底，微信又推出了微信小游戏，而Cocos Creator能更好的支持微信小游戏的构建，这种情况就很尴尬了，我写的Cocos2d-JS，技术相对过气了，现在Cocos更加大力推崇使用Creator，希2018年我的书能够大卖吧，毕竟Cocos2d-JS也是能做微信小游戏的。\n想起前半年写书的日子，也是很痛苦的，每天几乎是9点下班，回家就写书，写到12点再洗漱睡觉，可以说是非常辛苦了，每一章每一小节，我都要想办法通过一个实际的代码案例来阐述（感觉以后可以做个培训老师了），写书的同时，也算是巩固了我自己的知识储备。按照清华出版社编辑的说法，今年年底，我的书应该就能出来了，到时候，希望大家来两本，毕竟，这次这本书，销量与我收入有关了，哈哈哈！\n\n## 最荣幸的事情\n2017年年初的时候，我加入了云畅游戏，进入了鬼泣项目组，从进入到工作到现在，感觉这是我工作生涯中成长最快的一年。在上家公司的时候，我经历的阶段是探索和学习的阶段，在这家公司，我经历的是规范和进阶的阶段。在现在这家公司，我学到了更多的是如果更加规范的写代码，如何高效的写代码，了解了更多关于Java的泛型、反射、设计模式、枚举、JVM等。同时，团队的开发也让我有了更多与人沟通，团队协作的经验。我所在的项目组做的游戏也是我年少时玩过的划时代的ACT主机游戏——鬼泣，在当时来说，可以说是一流的动作游戏了，没有想到多年后的今天，我会亲自参与到游戏的手游版本的制作。说到手游，公司刚宣布与卡婊的合作的时候，游戏圈一片哗然，全是类似于“不要毁了我心中的鬼泣”“国内厂商，毁了”等消极言论，其实在我看来，手游和原作两者本身受众是不同的，我相信真正的动作游戏硬核玩家是不屑于玩儿手游的，我们这款产品无非做的就是一个情怀，吸引那些原IP里愿意体验简化版的鬼泣，以及新的手游玩家，算是同时面向一部分老的主机游戏玩家和一部分手游玩家。从公司以前的作品（《刀剑神域》《不良人2》）来看，我相信我们的《鬼泣》也会成功的，不期望成为爆款，至少达到《崩坏3》的水平，做出手游ACT的一代标杆。\n2017年，我很荣幸成为了鬼泣项目组的一员！\n\n很久没写文章，请原谅我流水账式的总结，只想安安静静的做个总结，来概括我的2017年！\n\n来点彩蛋吧：\n万万没想到的是，上家公司死掉的产品在快年底的时候，活过来了，这得感谢前同事的各种努力，年底突然的喜讯，也拿到一笔意外的小钱，希望我们可以继续越做越好！","slug":"2017随笔总结","published":1,"updated":"2018-01-08T16:14:45.104Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhtb0001wsazebb85kxs","content":"<p>今天，已经是2018年1月8日，2017年已经过去，今天挤出来时间，来为我的2017做一个迟到的总结。回忆起上次写文章，是2017年2月16号了，那篇文章叫做《我在创业游戏公司的一年》。这一年时间，我没有写文章，20%是因为今年变得很忙，几乎没有太多的业余时间，剩下的80%嘛，嗯，是因为懒，哈哈！说实在的，没有写不代表这一年什么都没发生，相反，2017年，是我收货最大的一年，嗯，各方各面。</p>\n<p>过去的2017年，我做了很多我一直很想做的事。<a id=\"more\"></a></p>\n<h2 id=\"完成了4次小型旅游\"><a href=\"#完成了4次小型旅游\" class=\"headerlink\" title=\"完成了4次小型旅游\"></a>完成了4次小型旅游</h2><p>还记得2016年写过一篇文章，计划2017年“能出门旅游一次，带上父母和女朋友”，这个小目标算是完成了，而且还超额完成了，因为17年，我们一共旅行了四次，第一次是五一青岛游，第二次是周末天津游，第三次是周末古北水镇游，第四次是元旦上海游。</p>\n<p>五一青岛游，这是一次女朋友、我妈、我姨妈、我，我们四个人的旅行，也是今年最满意的一次旅行，整个过程很舒服，青岛也是个十分舒适的城市，那时天气还不算热，也不算冷，很适宜的温度，沙滩上晒太阳的感觉很舒服，青岛的海鲜很好吃，没有遇到新闻里的坑人大虾，青岛有着很典型的滨海城市的特色、海风、海浪、沙滩、海鲜，该有的都有。好玩，好吃，还划算，去的很值。</p>\n<p>周末天津游，由女朋友、我、我姨妈、我舅妈我们四个人去的，之前我去过几次天津，印象还是不错的，印象很深的是有一次和同学来天津逛，天津的炸糕给了我很深的回味，很怀念天津炸糕的味道。可惜的是，这次天津游就不是那么顺利了，由于我们想要去天津的海边，于是我们在天津的塘沽地铁站下了地铁，一下地铁，就有很多人过来拉客，说到海边只要十元一位，我们算了下，自己坐车去也比这贵，于是就糊里糊涂的上了车，结果司机给我们拉到了不知名的海边，可以看出来，海边根本还没怎么开发，海水的颜色，就像黄河一样浑浊，这大概是我看过最脏的海水了，不知道是天津的海都这样还是只是这个地方是这样。那个地方很偏，只能通过他们拉客的车进出，不仅浪费了我们的时间，也坑了我们的钱，这大概就是最糟糕的一次天津游了，想想之前我们有同学在这里进了传销，我不是地域黑，但现在想想，天津整体给人的印象大概就一个字“骗”。</p>\n<p>古北水镇游，这是一次三五好友的自驾聚会旅行，韵哥，欣妹儿，龚世伟，周帅哥，谢姐姐，罗倩还有我，司机是我丰弟——经常给老师开车的老司机，这次的旅行还是非常开心的，因为大家都是很久不见的朋友，能在北京聚在一起玩儿一次也是不容易，有的在考研，有的在工作，有的在培训，有的在读研，各自的生活都有着很大的压力，一起出门自驾旅行一次，也算是放松放松了。</p>\n<p>元旦上海游，罗倩，侯玲，磊哥和我，我们四个人的旅行，到达当晚由黄懂请客吃饭，老实说，吃的不错，黄懂在饿了么省吃俭用，这回被我们一夜吃到解放前。第二天去了迪士尼，第三天，就累了一天……从此决定，节假日千万不要去游乐园的地方，真的是排队一小时，游玩五分钟，但不得不说的是，海盗船项目的360度身临其境大屏幕还是震撼到我了，另外小矮人矿山车也是很刺激，整体来说，就这两个项目最满意，其他的，基本都是好玩带来的感受不及排队带来的痛苦，只有这俩项目是值得排队的，遗憾的是极速光轮项目和飞跃地平线项目没能游玩上，听说是迪士尼的热门项目。经过了第一天的体力消耗，原本计划的第二天上海市区游也游不动了，真！的！不！想！走！了！，累趴了，31晚外滩人很多，元旦跨年活动也就取消了，遗憾的我们打车回去了，中间有个小插曲，就是打到车后，我们几乎等了一个小时才上到车，因为人真的太多了……</p>\n<p>不管怎么说，2017年，我也是有了四次小旅行了，感受了各地的人文和自然风景，对此来说，我已经非常满意了。</p>\n<h2 id=\"完成了多年的小目标\"><a href=\"#完成了多年的小目标\" class=\"headerlink\" title=\"完成了多年的小目标\"></a>完成了多年的小目标</h2><p>还没成年的时候，就想要开车了，我的记忆中，初中开始，家里就有车了，那时候最喜欢的事情，就是坐我妈的车到处走，去哪儿不重要，要的只是和爸爸妈妈坐在车里的感觉，我记得很清楚的是，当时我家车里有一股味道，大概是皮革味吧，离开家以后，闻到这种皮革味就想起坐我妈的车的感觉。18岁终于成年了，家里人担心我的安全就没允许我学车，而上了大学以后因为懒，我也没报驾校去学车。现在很后悔，因为工作以后，我需要花费更多的时间和金钱去学车，不过不管怎么样，我在12月18日，终于拿到了梦寐以求的驾照，这也算是完成了我多年来一个小小的心愿，中间过程还算顺利，就科目二考了两次，第一次因为太紧张，第一个项目倒车入库直接挂了两次，好在调整好心态后，第二次满分过了。拿到驾照以后，我就开始用一度用车APP到处开车练技术，在北京感觉还好，大家还是比较遵守交通规则，不过共享汽车是自动挡，不知道如果换成手动挡我还能不能熟练的起步停车。现在只想好好练练自己的技术，能做到开车时稳定心态，练好了，就能和家人或者朋友出去自驾游，想想还是很开心的。</p>\n<h2 id=\"看过的最感动的电影\"><a href=\"#看过的最感动的电影\" class=\"headerlink\" title=\"看过的最感动的电影\"></a>看过的最感动的电影</h2><p>这么久以来，看过的电影也不少了，而国庆档的《缝纫机乐队》却是让我最感动的电影。电影描述的是主角和一个小镇的摇滚梦想，努力保卫小镇大吉他雕像和自己的摇滚梦想。我还记得当时我学吉他的时候，听了一段老师打的架子鼓，感觉特别帅，特别有范儿，后来去网上看了很多很帅的打鼓视频，觉得帅爆了，但我还是觉得，听现场的打鼓才是最震撼的。后来，我经常在后海酒吧门口听里面的人演奏，标准的吉他+贝斯+架子鼓+键盘，觉得玩儿摇滚乐的都特别酷。很遗憾自己小时候没有多接触音乐，没有多学习乐器，后来长大了，高三采取学一点吉他，仅仅一点，大学又去学了一些钢琴，也算是小小的满足了下曾经的梦想，至少，能看懂五线谱了，能生啃一个谱子，生练一个月把一首钢琴曲弹会，也算是一点小小的成就感。<br>而我的这些音乐梦，在这部电影里，真的完完全全被重述了出来，电影里，乐队第一次合作的时候，即兴演奏的那一段，我不知道为什么，也许是电影院的音效太好，我的心一下被震撼了，当时有眼泪充斥眼眶，或许这正是我多年来被埋没的梦。而就是这一段即兴的演奏，我甚至认为比后面完整的乐队演奏更为震撼，不知道为什么，很奇怪，我现在仍能想起当时在电影院被震撼的感觉。<br>后来看评分，《缝纫机乐队》甚至评分不如《羞羞的铁拳》，但是我认为这真的是我整个2017年看过最能震撼到我的电影，或许这是所有有着音乐梦的人共同的心声。回想起来，上一期引起我音乐共鸣的，是一部泰国电影，叫《音为爱》，一部描述高中生的音乐之路，同样是摇滚和梦想的元素，当时我也正在上高中，也是深深的被感触，甚至莫名其妙的喜欢上了电影里的泰语歌。<br>感谢大鹏导演，用电影，用他自己的音乐梦，唤起了我们曾经单纯美好的梦想。</p>\n<h2 id=\"玩过的最深刻的游戏\"><a href=\"#玩过的最深刻的游戏\" class=\"headerlink\" title=\"玩过的最深刻的游戏\"></a>玩过的最深刻的游戏</h2><p>2017年，我也终于玩上了3A大作，《极品飞车20》《神秘海域》《GTA》《生化危机7》《直到黎明》《消逝的光芒》，太多太多大作了，相信所有人，心里都有一个游戏世界，而这些我们小时候都是很难体验到的，小时候玩游戏，总被认为是罪大恶极，总被灌输游戏是穿肠毒药的思想。长大后，再体验游戏这个东西，就会发现，好的游戏真是第九艺术，用一种艺术的形式，带我们体验一段神奇的旅程，感受不一样的世界。身在游戏行业圈，不得不承认的是，现在好游戏基本来自国外，国产游戏很难有什么好游戏，不知道何时开始的，国内游戏行业的发展方向就从用心做游戏变成了用心坑钱。庆幸的是，虽然艰难，我们国内，仍然有坚持做精品游戏的公司，以及独立游戏团队。因为，我支持ICEY，支持神舞幻想，希望能看到中国游戏行业在世界崛起的那一天，并且是以精品游戏为标杆，而不是过度商业化的圈钱产品。希望有更多的像仙剑之父姚壮宪这样优秀的行业大佬出现！<br>要说我玩过深刻的游戏，那必须是《最后的守护者》，又叫《食人的大鹫》，别看名字这么可怕，其他它讲述的是一个纯真少年和一直大鸟（或者叫大狗？）的奇妙旅程，游戏的开始，少年变和大鹫在一起，我扮演的就是少年，和大鹫从最初的陌生到熟悉，到亲密，到不可分离，我似乎能真切的感受到这一个游戏里虚拟的动物的存在，我好像真的有个朋友叫做Trico，它陪我渡过一个又一个的难关。而游戏最后的CG也终于让我忍不住落泪，这是我第一次玩游戏落泪，因为我真的感受到了那种与最亲密的朋友分离的痛苦。CG的最后，奄奄一息的少年，举起手对Trico下了最后一个命令——离开这里，大鹫才煽动翅膀飞走，看着大鹫离开的背影，我当时的心情真的很心酸，好在游戏的结尾，少年长大后，举起手中的铜镜，对Trico互换，远在山谷里的大鹫也似乎感受到了这样的心灵感应，最后点题，大鹫成为了山谷最后的守护者。整个游戏的故事背景最终也没有交代完全，其中还有很多玩家所不知道的事情，留下了悬念，但是少年与大鹫的感情，作为玩家的我是真真切切的感受到了。<br>真正的游戏大作，就如同音乐、电影一样，是一种艺术形式，通过更强的代入感，让玩家感受到游戏想要表达的真实情感。不能否定最近大火的竞技游戏的存在，但可以肯定是，这类游戏只能带我们实时竞技的快感，却没有任何实际的意义，而真正的大作游戏，是能引起你内心的共鸣，能让你对现实生活产生思考的好作品。</p>\n<h2 id=\"做过的最坚持的事情\"><a href=\"#做过的最坚持的事情\" class=\"headerlink\" title=\"做过的最坚持的事情\"></a>做过的最坚持的事情</h2><p>去年，我写了一本书，叫做《深度解析Java游戏服务器开发》，说实话，书的内容并不“深度”，基本都是很基础的内容，不过也算是我日日夜夜辛苦写出来的，其中内容质量，相比其他书来说，不算太好。有一次，我还在北京的王府井书店见到有我的书售卖，当时觉得，这本书没白写。鉴于我对去年写的书的内容并不满意，2017年，我又花了半年时间，写了《Cocos2d-JS快速入门到实战》，这本书不算百分百的满意，但也算把我所有关于Cocos的知识抖出来了，如果还要我再写一本书，我好像真的就没什么能写的了。有一点遗憾的是，我的Cocos2d-JS的书刚写出来，临近年底，微信又推出了微信小游戏，而Cocos Creator能更好的支持微信小游戏的构建，这种情况就很尴尬了，我写的Cocos2d-JS，技术相对过气了，现在Cocos更加大力推崇使用Creator，希2018年我的书能够大卖吧，毕竟Cocos2d-JS也是能做微信小游戏的。<br>想起前半年写书的日子，也是很痛苦的，每天几乎是9点下班，回家就写书，写到12点再洗漱睡觉，可以说是非常辛苦了，每一章每一小节，我都要想办法通过一个实际的代码案例来阐述（感觉以后可以做个培训老师了），写书的同时，也算是巩固了我自己的知识储备。按照清华出版社编辑的说法，今年年底，我的书应该就能出来了，到时候，希望大家来两本，毕竟，这次这本书，销量与我收入有关了，哈哈哈！</p>\n<h2 id=\"最荣幸的事情\"><a href=\"#最荣幸的事情\" class=\"headerlink\" title=\"最荣幸的事情\"></a>最荣幸的事情</h2><p>2017年年初的时候，我加入了云畅游戏，进入了鬼泣项目组，从进入到工作到现在，感觉这是我工作生涯中成长最快的一年。在上家公司的时候，我经历的阶段是探索和学习的阶段，在这家公司，我经历的是规范和进阶的阶段。在现在这家公司，我学到了更多的是如果更加规范的写代码，如何高效的写代码，了解了更多关于Java的泛型、反射、设计模式、枚举、JVM等。同时，团队的开发也让我有了更多与人沟通，团队协作的经验。我所在的项目组做的游戏也是我年少时玩过的划时代的ACT主机游戏——鬼泣，在当时来说，可以说是一流的动作游戏了，没有想到多年后的今天，我会亲自参与到游戏的手游版本的制作。说到手游，公司刚宣布与卡婊的合作的时候，游戏圈一片哗然，全是类似于“不要毁了我心中的鬼泣”“国内厂商，毁了”等消极言论，其实在我看来，手游和原作两者本身受众是不同的，我相信真正的动作游戏硬核玩家是不屑于玩儿手游的，我们这款产品无非做的就是一个情怀，吸引那些原IP里愿意体验简化版的鬼泣，以及新的手游玩家，算是同时面向一部分老的主机游戏玩家和一部分手游玩家。从公司以前的作品（《刀剑神域》《不良人2》）来看，我相信我们的《鬼泣》也会成功的，不期望成为爆款，至少达到《崩坏3》的水平，做出手游ACT的一代标杆。<br>2017年，我很荣幸成为了鬼泣项目组的一员！</p>\n<p>很久没写文章，请原谅我流水账式的总结，只想安安静静的做个总结，来概括我的2017年！</p>\n<p>来点彩蛋吧：<br>万万没想到的是，上家公司死掉的产品在快年底的时候，活过来了，这得感谢前同事的各种努力，年底突然的喜讯，也拿到一笔意外的小钱，希望我们可以继续越做越好！</p>\n","site":{"data":{}},"excerpt":"<p>今天，已经是2018年1月8日，2017年已经过去，今天挤出来时间，来为我的2017做一个迟到的总结。回忆起上次写文章，是2017年2月16号了，那篇文章叫做《我在创业游戏公司的一年》。这一年时间，我没有写文章，20%是因为今年变得很忙，几乎没有太多的业余时间，剩下的80%嘛，嗯，是因为懒，哈哈！说实在的，没有写不代表这一年什么都没发生，相反，2017年，是我收货最大的一年，嗯，各方各面。</p>\n<p>过去的2017年，我做了很多我一直很想做的事。","more":"</p>\n<h2 id=\"完成了4次小型旅游\"><a href=\"#完成了4次小型旅游\" class=\"headerlink\" title=\"完成了4次小型旅游\"></a>完成了4次小型旅游</h2><p>还记得2016年写过一篇文章，计划2017年“能出门旅游一次，带上父母和女朋友”，这个小目标算是完成了，而且还超额完成了，因为17年，我们一共旅行了四次，第一次是五一青岛游，第二次是周末天津游，第三次是周末古北水镇游，第四次是元旦上海游。</p>\n<p>五一青岛游，这是一次女朋友、我妈、我姨妈、我，我们四个人的旅行，也是今年最满意的一次旅行，整个过程很舒服，青岛也是个十分舒适的城市，那时天气还不算热，也不算冷，很适宜的温度，沙滩上晒太阳的感觉很舒服，青岛的海鲜很好吃，没有遇到新闻里的坑人大虾，青岛有着很典型的滨海城市的特色、海风、海浪、沙滩、海鲜，该有的都有。好玩，好吃，还划算，去的很值。</p>\n<p>周末天津游，由女朋友、我、我姨妈、我舅妈我们四个人去的，之前我去过几次天津，印象还是不错的，印象很深的是有一次和同学来天津逛，天津的炸糕给了我很深的回味，很怀念天津炸糕的味道。可惜的是，这次天津游就不是那么顺利了，由于我们想要去天津的海边，于是我们在天津的塘沽地铁站下了地铁，一下地铁，就有很多人过来拉客，说到海边只要十元一位，我们算了下，自己坐车去也比这贵，于是就糊里糊涂的上了车，结果司机给我们拉到了不知名的海边，可以看出来，海边根本还没怎么开发，海水的颜色，就像黄河一样浑浊，这大概是我看过最脏的海水了，不知道是天津的海都这样还是只是这个地方是这样。那个地方很偏，只能通过他们拉客的车进出，不仅浪费了我们的时间，也坑了我们的钱，这大概就是最糟糕的一次天津游了，想想之前我们有同学在这里进了传销，我不是地域黑，但现在想想，天津整体给人的印象大概就一个字“骗”。</p>\n<p>古北水镇游，这是一次三五好友的自驾聚会旅行，韵哥，欣妹儿，龚世伟，周帅哥，谢姐姐，罗倩还有我，司机是我丰弟——经常给老师开车的老司机，这次的旅行还是非常开心的，因为大家都是很久不见的朋友，能在北京聚在一起玩儿一次也是不容易，有的在考研，有的在工作，有的在培训，有的在读研，各自的生活都有着很大的压力，一起出门自驾旅行一次，也算是放松放松了。</p>\n<p>元旦上海游，罗倩，侯玲，磊哥和我，我们四个人的旅行，到达当晚由黄懂请客吃饭，老实说，吃的不错，黄懂在饿了么省吃俭用，这回被我们一夜吃到解放前。第二天去了迪士尼，第三天，就累了一天……从此决定，节假日千万不要去游乐园的地方，真的是排队一小时，游玩五分钟，但不得不说的是，海盗船项目的360度身临其境大屏幕还是震撼到我了，另外小矮人矿山车也是很刺激，整体来说，就这两个项目最满意，其他的，基本都是好玩带来的感受不及排队带来的痛苦，只有这俩项目是值得排队的，遗憾的是极速光轮项目和飞跃地平线项目没能游玩上，听说是迪士尼的热门项目。经过了第一天的体力消耗，原本计划的第二天上海市区游也游不动了，真！的！不！想！走！了！，累趴了，31晚外滩人很多，元旦跨年活动也就取消了，遗憾的我们打车回去了，中间有个小插曲，就是打到车后，我们几乎等了一个小时才上到车，因为人真的太多了……</p>\n<p>不管怎么说，2017年，我也是有了四次小旅行了，感受了各地的人文和自然风景，对此来说，我已经非常满意了。</p>\n<h2 id=\"完成了多年的小目标\"><a href=\"#完成了多年的小目标\" class=\"headerlink\" title=\"完成了多年的小目标\"></a>完成了多年的小目标</h2><p>还没成年的时候，就想要开车了，我的记忆中，初中开始，家里就有车了，那时候最喜欢的事情，就是坐我妈的车到处走，去哪儿不重要，要的只是和爸爸妈妈坐在车里的感觉，我记得很清楚的是，当时我家车里有一股味道，大概是皮革味吧，离开家以后，闻到这种皮革味就想起坐我妈的车的感觉。18岁终于成年了，家里人担心我的安全就没允许我学车，而上了大学以后因为懒，我也没报驾校去学车。现在很后悔，因为工作以后，我需要花费更多的时间和金钱去学车，不过不管怎么样，我在12月18日，终于拿到了梦寐以求的驾照，这也算是完成了我多年来一个小小的心愿，中间过程还算顺利，就科目二考了两次，第一次因为太紧张，第一个项目倒车入库直接挂了两次，好在调整好心态后，第二次满分过了。拿到驾照以后，我就开始用一度用车APP到处开车练技术，在北京感觉还好，大家还是比较遵守交通规则，不过共享汽车是自动挡，不知道如果换成手动挡我还能不能熟练的起步停车。现在只想好好练练自己的技术，能做到开车时稳定心态，练好了，就能和家人或者朋友出去自驾游，想想还是很开心的。</p>\n<h2 id=\"看过的最感动的电影\"><a href=\"#看过的最感动的电影\" class=\"headerlink\" title=\"看过的最感动的电影\"></a>看过的最感动的电影</h2><p>这么久以来，看过的电影也不少了，而国庆档的《缝纫机乐队》却是让我最感动的电影。电影描述的是主角和一个小镇的摇滚梦想，努力保卫小镇大吉他雕像和自己的摇滚梦想。我还记得当时我学吉他的时候，听了一段老师打的架子鼓，感觉特别帅，特别有范儿，后来去网上看了很多很帅的打鼓视频，觉得帅爆了，但我还是觉得，听现场的打鼓才是最震撼的。后来，我经常在后海酒吧门口听里面的人演奏，标准的吉他+贝斯+架子鼓+键盘，觉得玩儿摇滚乐的都特别酷。很遗憾自己小时候没有多接触音乐，没有多学习乐器，后来长大了，高三采取学一点吉他，仅仅一点，大学又去学了一些钢琴，也算是小小的满足了下曾经的梦想，至少，能看懂五线谱了，能生啃一个谱子，生练一个月把一首钢琴曲弹会，也算是一点小小的成就感。<br>而我的这些音乐梦，在这部电影里，真的完完全全被重述了出来，电影里，乐队第一次合作的时候，即兴演奏的那一段，我不知道为什么，也许是电影院的音效太好，我的心一下被震撼了，当时有眼泪充斥眼眶，或许这正是我多年来被埋没的梦。而就是这一段即兴的演奏，我甚至认为比后面完整的乐队演奏更为震撼，不知道为什么，很奇怪，我现在仍能想起当时在电影院被震撼的感觉。<br>后来看评分，《缝纫机乐队》甚至评分不如《羞羞的铁拳》，但是我认为这真的是我整个2017年看过最能震撼到我的电影，或许这是所有有着音乐梦的人共同的心声。回想起来，上一期引起我音乐共鸣的，是一部泰国电影，叫《音为爱》，一部描述高中生的音乐之路，同样是摇滚和梦想的元素，当时我也正在上高中，也是深深的被感触，甚至莫名其妙的喜欢上了电影里的泰语歌。<br>感谢大鹏导演，用电影，用他自己的音乐梦，唤起了我们曾经单纯美好的梦想。</p>\n<h2 id=\"玩过的最深刻的游戏\"><a href=\"#玩过的最深刻的游戏\" class=\"headerlink\" title=\"玩过的最深刻的游戏\"></a>玩过的最深刻的游戏</h2><p>2017年，我也终于玩上了3A大作，《极品飞车20》《神秘海域》《GTA》《生化危机7》《直到黎明》《消逝的光芒》，太多太多大作了，相信所有人，心里都有一个游戏世界，而这些我们小时候都是很难体验到的，小时候玩游戏，总被认为是罪大恶极，总被灌输游戏是穿肠毒药的思想。长大后，再体验游戏这个东西，就会发现，好的游戏真是第九艺术，用一种艺术的形式，带我们体验一段神奇的旅程，感受不一样的世界。身在游戏行业圈，不得不承认的是，现在好游戏基本来自国外，国产游戏很难有什么好游戏，不知道何时开始的，国内游戏行业的发展方向就从用心做游戏变成了用心坑钱。庆幸的是，虽然艰难，我们国内，仍然有坚持做精品游戏的公司，以及独立游戏团队。因为，我支持ICEY，支持神舞幻想，希望能看到中国游戏行业在世界崛起的那一天，并且是以精品游戏为标杆，而不是过度商业化的圈钱产品。希望有更多的像仙剑之父姚壮宪这样优秀的行业大佬出现！<br>要说我玩过深刻的游戏，那必须是《最后的守护者》，又叫《食人的大鹫》，别看名字这么可怕，其他它讲述的是一个纯真少年和一直大鸟（或者叫大狗？）的奇妙旅程，游戏的开始，少年变和大鹫在一起，我扮演的就是少年，和大鹫从最初的陌生到熟悉，到亲密，到不可分离，我似乎能真切的感受到这一个游戏里虚拟的动物的存在，我好像真的有个朋友叫做Trico，它陪我渡过一个又一个的难关。而游戏最后的CG也终于让我忍不住落泪，这是我第一次玩游戏落泪，因为我真的感受到了那种与最亲密的朋友分离的痛苦。CG的最后，奄奄一息的少年，举起手对Trico下了最后一个命令——离开这里，大鹫才煽动翅膀飞走，看着大鹫离开的背影，我当时的心情真的很心酸，好在游戏的结尾，少年长大后，举起手中的铜镜，对Trico互换，远在山谷里的大鹫也似乎感受到了这样的心灵感应，最后点题，大鹫成为了山谷最后的守护者。整个游戏的故事背景最终也没有交代完全，其中还有很多玩家所不知道的事情，留下了悬念，但是少年与大鹫的感情，作为玩家的我是真真切切的感受到了。<br>真正的游戏大作，就如同音乐、电影一样，是一种艺术形式，通过更强的代入感，让玩家感受到游戏想要表达的真实情感。不能否定最近大火的竞技游戏的存在，但可以肯定是，这类游戏只能带我们实时竞技的快感，却没有任何实际的意义，而真正的大作游戏，是能引起你内心的共鸣，能让你对现实生活产生思考的好作品。</p>\n<h2 id=\"做过的最坚持的事情\"><a href=\"#做过的最坚持的事情\" class=\"headerlink\" title=\"做过的最坚持的事情\"></a>做过的最坚持的事情</h2><p>去年，我写了一本书，叫做《深度解析Java游戏服务器开发》，说实话，书的内容并不“深度”，基本都是很基础的内容，不过也算是我日日夜夜辛苦写出来的，其中内容质量，相比其他书来说，不算太好。有一次，我还在北京的王府井书店见到有我的书售卖，当时觉得，这本书没白写。鉴于我对去年写的书的内容并不满意，2017年，我又花了半年时间，写了《Cocos2d-JS快速入门到实战》，这本书不算百分百的满意，但也算把我所有关于Cocos的知识抖出来了，如果还要我再写一本书，我好像真的就没什么能写的了。有一点遗憾的是，我的Cocos2d-JS的书刚写出来，临近年底，微信又推出了微信小游戏，而Cocos Creator能更好的支持微信小游戏的构建，这种情况就很尴尬了，我写的Cocos2d-JS，技术相对过气了，现在Cocos更加大力推崇使用Creator，希2018年我的书能够大卖吧，毕竟Cocos2d-JS也是能做微信小游戏的。<br>想起前半年写书的日子，也是很痛苦的，每天几乎是9点下班，回家就写书，写到12点再洗漱睡觉，可以说是非常辛苦了，每一章每一小节，我都要想办法通过一个实际的代码案例来阐述（感觉以后可以做个培训老师了），写书的同时，也算是巩固了我自己的知识储备。按照清华出版社编辑的说法，今年年底，我的书应该就能出来了，到时候，希望大家来两本，毕竟，这次这本书，销量与我收入有关了，哈哈哈！</p>\n<h2 id=\"最荣幸的事情\"><a href=\"#最荣幸的事情\" class=\"headerlink\" title=\"最荣幸的事情\"></a>最荣幸的事情</h2><p>2017年年初的时候，我加入了云畅游戏，进入了鬼泣项目组，从进入到工作到现在，感觉这是我工作生涯中成长最快的一年。在上家公司的时候，我经历的阶段是探索和学习的阶段，在这家公司，我经历的是规范和进阶的阶段。在现在这家公司，我学到了更多的是如果更加规范的写代码，如何高效的写代码，了解了更多关于Java的泛型、反射、设计模式、枚举、JVM等。同时，团队的开发也让我有了更多与人沟通，团队协作的经验。我所在的项目组做的游戏也是我年少时玩过的划时代的ACT主机游戏——鬼泣，在当时来说，可以说是一流的动作游戏了，没有想到多年后的今天，我会亲自参与到游戏的手游版本的制作。说到手游，公司刚宣布与卡婊的合作的时候，游戏圈一片哗然，全是类似于“不要毁了我心中的鬼泣”“国内厂商，毁了”等消极言论，其实在我看来，手游和原作两者本身受众是不同的，我相信真正的动作游戏硬核玩家是不屑于玩儿手游的，我们这款产品无非做的就是一个情怀，吸引那些原IP里愿意体验简化版的鬼泣，以及新的手游玩家，算是同时面向一部分老的主机游戏玩家和一部分手游玩家。从公司以前的作品（《刀剑神域》《不良人2》）来看，我相信我们的《鬼泣》也会成功的，不期望成为爆款，至少达到《崩坏3》的水平，做出手游ACT的一代标杆。<br>2017年，我很荣幸成为了鬼泣项目组的一员！</p>\n<p>很久没写文章，请原谅我流水账式的总结，只想安安静静的做个总结，来概括我的2017年！</p>\n<p>来点彩蛋吧：<br>万万没想到的是，上家公司死掉的产品在快年底的时候，活过来了，这得感谢前同事的各种努力，年底突然的喜讯，也拿到一笔意外的小钱，希望我们可以继续越做越好！</p>"},{"title":"CVP认证学习笔记--(何小成)001--在场景中加入文字层","date":"2016-04-06T15:16:00.000Z","_content":" 之前一直从事的游戏服务器开发相关工作，由于个人兴趣想来学习Cocos，正巧有这个机会，就加入了这个学习中，之前有过js基础，在做游戏服务器之前是做web开发的，难免涉及前端js部分，基本的ECMScript语法还是有所了解，希望能在学习中用上，能够快速入门。大学的时候对Cocos2dx有所了解，但并不很深入，这次就借此机会好好深入学习一下。\n <!--more-->\n 第一章 在场景中添加文字\n 跟很多教程一样，第一章的内容必定是简单的，仅仅教了如何在场景中添加一个文字控件。步骤如下：\n ### 创建LabelTTF对象:\n 根据cocos的文档，LabelTTF对象继承自Sprite，也就是它也是属于精灵中的一种\n 文档中定义的cc.LabelTTF的构造函数如下：\n```javascript\nctor(text,fontName,fontSize,dimensions),hAlignment,vAlignment)\n```\n text：文本内容\n fontName：字体文件，也可以使用自定义字体文件，需要实现导入到resource中\n fontSize：字体大小\n dimensions：cc.LabelTTF的文字大小\n hAlignment：水平对齐方式，默认值是cc.TEXT_ALIGNMENT_LEFT，表示水平居左\n vAlignment：垂直对齐方式，默认值是cc.VERTICAL_TEXT_ALIGNMENT_TOP，表示垂直顶对齐\n 如下语句初始化一个文本为hello，字体为Arias，大小为100的文本标签\n```javascript\nvar obj = new cc.LabelTTF(“hello”,\"Arias\",100);\n```\n### 设置x，y坐标\n```javascript\nobj.x=100;\nobj.y=100;\n```\n### 在场景中添加这个控件this.addChild(你的LabelTTF对象)\n```javascript\nthis.addChild(obj);\n```\n 完成以上3个步骤就能完成添加文本标签到图层，cocos cvp的在线编程工具挺方便的，扫描二维码还能在手机看到实时效果，这点我喜欢。\n\n### 运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_05/3730c3a9023947cc3b7a78df1e124bf65280d2ea/\n","source":"_posts/CVP认证学习笔记--(何小成)001--在场景中加入文字层.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)001--在场景中加入文字层\ndate: 2016-04-06 23:16\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n 之前一直从事的游戏服务器开发相关工作，由于个人兴趣想来学习Cocos，正巧有这个机会，就加入了这个学习中，之前有过js基础，在做游戏服务器之前是做web开发的，难免涉及前端js部分，基本的ECMScript语法还是有所了解，希望能在学习中用上，能够快速入门。大学的时候对Cocos2dx有所了解，但并不很深入，这次就借此机会好好深入学习一下。\n <!--more-->\n 第一章 在场景中添加文字\n 跟很多教程一样，第一章的内容必定是简单的，仅仅教了如何在场景中添加一个文字控件。步骤如下：\n ### 创建LabelTTF对象:\n 根据cocos的文档，LabelTTF对象继承自Sprite，也就是它也是属于精灵中的一种\n 文档中定义的cc.LabelTTF的构造函数如下：\n```javascript\nctor(text,fontName,fontSize,dimensions),hAlignment,vAlignment)\n```\n text：文本内容\n fontName：字体文件，也可以使用自定义字体文件，需要实现导入到resource中\n fontSize：字体大小\n dimensions：cc.LabelTTF的文字大小\n hAlignment：水平对齐方式，默认值是cc.TEXT_ALIGNMENT_LEFT，表示水平居左\n vAlignment：垂直对齐方式，默认值是cc.VERTICAL_TEXT_ALIGNMENT_TOP，表示垂直顶对齐\n 如下语句初始化一个文本为hello，字体为Arias，大小为100的文本标签\n```javascript\nvar obj = new cc.LabelTTF(“hello”,\"Arias\",100);\n```\n### 设置x，y坐标\n```javascript\nobj.x=100;\nobj.y=100;\n```\n### 在场景中添加这个控件this.addChild(你的LabelTTF对象)\n```javascript\nthis.addChild(obj);\n```\n 完成以上3个步骤就能完成添加文本标签到图层，cocos cvp的在线编程工具挺方便的，扫描二维码还能在手机看到实时效果，这点我喜欢。\n\n### 运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_05/3730c3a9023947cc3b7a78df1e124bf65280d2ea/\n","slug":"CVP认证学习笔记--(何小成)001--在场景中加入文字层","published":1,"updated":"2016-04-24T15:04:04.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhtf0003wsazeec7be0f","content":"<p> 之前一直从事的游戏服务器开发相关工作，由于个人兴趣想来学习Cocos，正巧有这个机会，就加入了这个学习中，之前有过js基础，在做游戏服务器之前是做web开发的，难免涉及前端js部分，基本的ECMScript语法还是有所了解，希望能在学习中用上，能够快速入门。大学的时候对Cocos2dx有所了解，但并不很深入，这次就借此机会好好深入学习一下。<br> <a id=\"more\"></a><br> 第一章 在场景中添加文字<br> 跟很多教程一样，第一章的内容必定是简单的，仅仅教了如何在场景中添加一个文字控件。步骤如下：</p>\n<h3 id=\"创建LabelTTF对象\"><a href=\"#创建LabelTTF对象\" class=\"headerlink\" title=\"创建LabelTTF对象:\"></a>创建LabelTTF对象:</h3><p> 根据cocos的文档，LabelTTF对象继承自Sprite，也就是它也是属于精灵中的一种<br> 文档中定义的cc.LabelTTF的构造函数如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctor(text,fontName,fontSize,dimensions),hAlignment,vAlignment)</span><br></pre></td></tr></table></figure>\n<p> text：文本内容<br> fontName：字体文件，也可以使用自定义字体文件，需要实现导入到resource中<br> fontSize：字体大小<br> dimensions：cc.LabelTTF的文字大小<br> hAlignment：水平对齐方式，默认值是cc.TEXT_ALIGNMENT_LEFT，表示水平居左<br> vAlignment：垂直对齐方式，默认值是cc.VERTICAL_TEXT_ALIGNMENT_TOP，表示垂直顶对齐<br> 如下语句初始化一个文本为hello，字体为Arias，大小为100的文本标签</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = <span class=\"keyword\">new</span> cc.LabelTTF(“hello”,<span class=\"string\">&quot;Arias&quot;</span>,<span class=\"number\">100</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"设置x，y坐标\"><a href=\"#设置x，y坐标\" class=\"headerlink\" title=\"设置x，y坐标\"></a>设置x，y坐标</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">obj.x=<span class=\"number\">100</span>;</span><br><span class=\"line\">obj.y=<span class=\"number\">100</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"在场景中添加这个控件this-addChild-你的LabelTTF对象\"><a href=\"#在场景中添加这个控件this-addChild-你的LabelTTF对象\" class=\"headerlink\" title=\"在场景中添加这个控件this.addChild(你的LabelTTF对象)\"></a>在场景中添加这个控件this.addChild(你的LabelTTF对象)</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">this</span>.addChild(obj);</span><br></pre></td></tr></table></figure>\n<p> 完成以上3个步骤就能完成添加文本标签到图层，cocos cvp的在线编程工具挺方便的，扫描二维码还能在手机看到实时效果，这点我喜欢。</p>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_05/3730c3a9023947cc3b7a78df1e124bf65280d2ea/\">http://www.cocoscvp.com/usercode/2016_04_05/3730c3a9023947cc3b7a78df1e124bf65280d2ea/</a></p>\n","site":{"data":{}},"excerpt":"<p> 之前一直从事的游戏服务器开发相关工作，由于个人兴趣想来学习Cocos，正巧有这个机会，就加入了这个学习中，之前有过js基础，在做游戏服务器之前是做web开发的，难免涉及前端js部分，基本的ECMScript语法还是有所了解，希望能在学习中用上，能够快速入门。大学的时候对Cocos2dx有所了解，但并不很深入，这次就借此机会好好深入学习一下。<br>","more":"<br> 第一章 在场景中添加文字<br> 跟很多教程一样，第一章的内容必定是简单的，仅仅教了如何在场景中添加一个文字控件。步骤如下：</p>\n<h3 id=\"创建LabelTTF对象\"><a href=\"#创建LabelTTF对象\" class=\"headerlink\" title=\"创建LabelTTF对象:\"></a>创建LabelTTF对象:</h3><p> 根据cocos的文档，LabelTTF对象继承自Sprite，也就是它也是属于精灵中的一种<br> 文档中定义的cc.LabelTTF的构造函数如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctor(text,fontName,fontSize,dimensions),hAlignment,vAlignment)</span><br></pre></td></tr></table></figure>\n<p> text：文本内容<br> fontName：字体文件，也可以使用自定义字体文件，需要实现导入到resource中<br> fontSize：字体大小<br> dimensions：cc.LabelTTF的文字大小<br> hAlignment：水平对齐方式，默认值是cc.TEXT_ALIGNMENT_LEFT，表示水平居左<br> vAlignment：垂直对齐方式，默认值是cc.VERTICAL_TEXT_ALIGNMENT_TOP，表示垂直顶对齐<br> 如下语句初始化一个文本为hello，字体为Arias，大小为100的文本标签</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = <span class=\"keyword\">new</span> cc.LabelTTF(“hello”,<span class=\"string\">&quot;Arias&quot;</span>,<span class=\"number\">100</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"设置x，y坐标\"><a href=\"#设置x，y坐标\" class=\"headerlink\" title=\"设置x，y坐标\"></a>设置x，y坐标</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">obj.x=<span class=\"number\">100</span>;</span><br><span class=\"line\">obj.y=<span class=\"number\">100</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"在场景中添加这个控件this-addChild-你的LabelTTF对象\"><a href=\"#在场景中添加这个控件this-addChild-你的LabelTTF对象\" class=\"headerlink\" title=\"在场景中添加这个控件this.addChild(你的LabelTTF对象)\"></a>在场景中添加这个控件this.addChild(你的LabelTTF对象)</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">this</span>.addChild(obj);</span><br></pre></td></tr></table></figure>\n<p> 完成以上3个步骤就能完成添加文本标签到图层，cocos cvp的在线编程工具挺方便的，扫描二维码还能在手机看到实时效果，这点我喜欢。</p>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_05/3730c3a9023947cc3b7a78df1e124bf65280d2ea/\">http://www.cocoscvp.com/usercode/2016_04_05/3730c3a9023947cc3b7a78df1e124bf65280d2ea/</a></p>"},{"title":"CVP认证学习笔记--(何小成)002--在场景中加入图片层","date":"2016-04-06T15:43:00.000Z","_content":"本节加入图片层与上一节加入文字层大同小异，上节说到cc.LabelTTF继承自cc.Sprite，而加入图片层直接添加cc.Sprite即可。\n### 添加图片到resource.js，使之在启动时预加载图片\n```javascript\nvar res = {\n    HelloWorld_png : \"res/HelloWorld.png\",\n    logo_png:\"res/logo.png\",//图片预加载数组\n    CVPlogo_png:\"CVPlog.png\"\n};\n```\n<!--more-->\n格式为json格式，key为图片引用的名字，val为图片在项目中的路径\n### 创建cc.Sprite对象，\n```javascript\nvar logopng = new cc.Sprite(logo_png);\n```\n### 为cc.Sprite设置属性\n```javascript\nlogopng.x=logopng.width;\nlogopng.y=size.height-logopng.height;\n```\n作业要求是要讲图片放置在左上角，那么横纵坐标各式多少呢？实践为准，于是我试了(0,0),(0,size.height),(size.width,0),(size,width,size,height),结果发现，当坐标为(0,size.height)的时候，图片的中恰好在屏幕左上角，也就是说，如果按照坐标系来说的话，手机屏幕应该是处于坐标系的第二象限，这样就好理解多了。但还有一个问题，就是为什么图片只有四分之一漏了出来呢？其实这就是Sprite的锚点了，它的锚点默认是处于图片的正中心位置的，估计后面的课程如果讲到精灵的旋转变换等，一定会用到这个锚点的。\n### 最后一步依然是讲图片层加入背景图层\n```javascript\nthis.addChilde(logopng);\n```\n### 总结\n总的来说，免费体验的两节课程讲了如何在背景层中添加自己的文字层或图片层，它们的原理机制是一样的，两节课虽然内容不多，但这其中的内容，如果要去深挖，还是有很多东西的，比如像构造函数，属性设置，锚点，坐标系，资源加载等，不过体验课更多的是让我们了解cocos2djs开发的一个流程，项目结构等。相信真正有意思的课程都在后边，很是期待！\n\n### 运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_05/16a648e2762f9b75fdd8be57202678aa511d20b4/\n","source":"_posts/CVP认证学习笔记--(何小成)002--在场景中加入图片层.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)002--在场景中加入图片层\ndate: 2016-04-06 23:43\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n本节加入图片层与上一节加入文字层大同小异，上节说到cc.LabelTTF继承自cc.Sprite，而加入图片层直接添加cc.Sprite即可。\n### 添加图片到resource.js，使之在启动时预加载图片\n```javascript\nvar res = {\n    HelloWorld_png : \"res/HelloWorld.png\",\n    logo_png:\"res/logo.png\",//图片预加载数组\n    CVPlogo_png:\"CVPlog.png\"\n};\n```\n<!--more-->\n格式为json格式，key为图片引用的名字，val为图片在项目中的路径\n### 创建cc.Sprite对象，\n```javascript\nvar logopng = new cc.Sprite(logo_png);\n```\n### 为cc.Sprite设置属性\n```javascript\nlogopng.x=logopng.width;\nlogopng.y=size.height-logopng.height;\n```\n作业要求是要讲图片放置在左上角，那么横纵坐标各式多少呢？实践为准，于是我试了(0,0),(0,size.height),(size.width,0),(size,width,size,height),结果发现，当坐标为(0,size.height)的时候，图片的中恰好在屏幕左上角，也就是说，如果按照坐标系来说的话，手机屏幕应该是处于坐标系的第二象限，这样就好理解多了。但还有一个问题，就是为什么图片只有四分之一漏了出来呢？其实这就是Sprite的锚点了，它的锚点默认是处于图片的正中心位置的，估计后面的课程如果讲到精灵的旋转变换等，一定会用到这个锚点的。\n### 最后一步依然是讲图片层加入背景图层\n```javascript\nthis.addChilde(logopng);\n```\n### 总结\n总的来说，免费体验的两节课程讲了如何在背景层中添加自己的文字层或图片层，它们的原理机制是一样的，两节课虽然内容不多，但这其中的内容，如果要去深挖，还是有很多东西的，比如像构造函数，属性设置，锚点，坐标系，资源加载等，不过体验课更多的是让我们了解cocos2djs开发的一个流程，项目结构等。相信真正有意思的课程都在后边，很是期待！\n\n### 运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_05/16a648e2762f9b75fdd8be57202678aa511d20b4/\n","slug":"CVP认证学习笔记--(何小成)002--在场景中加入图片层","published":1,"updated":"2016-04-24T15:03:52.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhtk0007wsaz3gb42je3","content":"<p>本节加入图片层与上一节加入文字层大同小异，上节说到cc.LabelTTF继承自cc.Sprite，而加入图片层直接添加cc.Sprite即可。</p>\n<h3 id=\"添加图片到resource-js，使之在启动时预加载图片\"><a href=\"#添加图片到resource-js，使之在启动时预加载图片\" class=\"headerlink\" title=\"添加图片到resource.js，使之在启动时预加载图片\"></a>添加图片到resource.js，使之在启动时预加载图片</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> res = &#123;</span><br><span class=\"line\">    HelloWorld_png : <span class=\"string\">&quot;res/HelloWorld.png&quot;</span>,</span><br><span class=\"line\">    logo_png:<span class=\"string\">&quot;res/logo.png&quot;</span>,<span class=\"comment\">//图片预加载数组</span></span><br><span class=\"line\">    CVPlogo_png:<span class=\"string\">&quot;CVPlog.png&quot;</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<p>格式为json格式，key为图片引用的名字，val为图片在项目中的路径</p>\n<h3 id=\"创建cc-Sprite对象，\"><a href=\"#创建cc-Sprite对象，\" class=\"headerlink\" title=\"创建cc.Sprite对象，\"></a>创建cc.Sprite对象，</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> logopng = <span class=\"keyword\">new</span> cc.Sprite(logo_png);</span><br></pre></td></tr></table></figure>\n<h3 id=\"为cc-Sprite设置属性\"><a href=\"#为cc-Sprite设置属性\" class=\"headerlink\" title=\"为cc.Sprite设置属性\"></a>为cc.Sprite设置属性</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logopng.x=logopng.width;</span><br><span class=\"line\">logopng.y=size.height-logopng.height;</span><br></pre></td></tr></table></figure>\n<p>作业要求是要讲图片放置在左上角，那么横纵坐标各式多少呢？实践为准，于是我试了(0,0),(0,size.height),(size.width,0),(size,width,size,height),结果发现，当坐标为(0,size.height)的时候，图片的中恰好在屏幕左上角，也就是说，如果按照坐标系来说的话，手机屏幕应该是处于坐标系的第二象限，这样就好理解多了。但还有一个问题，就是为什么图片只有四分之一漏了出来呢？其实这就是Sprite的锚点了，它的锚点默认是处于图片的正中心位置的，估计后面的课程如果讲到精灵的旋转变换等，一定会用到这个锚点的。</p>\n<h3 id=\"最后一步依然是讲图片层加入背景图层\"><a href=\"#最后一步依然是讲图片层加入背景图层\" class=\"headerlink\" title=\"最后一步依然是讲图片层加入背景图层\"></a>最后一步依然是讲图片层加入背景图层</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">this</span>.addChilde(logopng);</span><br></pre></td></tr></table></figure>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>总的来说，免费体验的两节课程讲了如何在背景层中添加自己的文字层或图片层，它们的原理机制是一样的，两节课虽然内容不多，但这其中的内容，如果要去深挖，还是有很多东西的，比如像构造函数，属性设置，锚点，坐标系，资源加载等，不过体验课更多的是让我们了解cocos2djs开发的一个流程，项目结构等。相信真正有意思的课程都在后边，很是期待！</p>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_05/16a648e2762f9b75fdd8be57202678aa511d20b4/\">http://www.cocoscvp.com/usercode/2016_04_05/16a648e2762f9b75fdd8be57202678aa511d20b4/</a></p>\n","site":{"data":{}},"excerpt":"<p>本节加入图片层与上一节加入文字层大同小异，上节说到cc.LabelTTF继承自cc.Sprite，而加入图片层直接添加cc.Sprite即可。</p>\n<h3 id=\"添加图片到resource-js，使之在启动时预加载图片\"><a href=\"#添加图片到resource-js，使之在启动时预加载图片\" class=\"headerlink\" title=\"添加图片到resource.js，使之在启动时预加载图片\"></a>添加图片到resource.js，使之在启动时预加载图片</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> res = &#123;</span><br><span class=\"line\">    HelloWorld_png : <span class=\"string\">&quot;res/HelloWorld.png&quot;</span>,</span><br><span class=\"line\">    logo_png:<span class=\"string\">&quot;res/logo.png&quot;</span>,<span class=\"comment\">//图片预加载数组</span></span><br><span class=\"line\">    CVPlogo_png:<span class=\"string\">&quot;CVPlog.png&quot;</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>","more":"<p>格式为json格式，key为图片引用的名字，val为图片在项目中的路径</p>\n<h3 id=\"创建cc-Sprite对象，\"><a href=\"#创建cc-Sprite对象，\" class=\"headerlink\" title=\"创建cc.Sprite对象，\"></a>创建cc.Sprite对象，</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> logopng = <span class=\"keyword\">new</span> cc.Sprite(logo_png);</span><br></pre></td></tr></table></figure>\n<h3 id=\"为cc-Sprite设置属性\"><a href=\"#为cc-Sprite设置属性\" class=\"headerlink\" title=\"为cc.Sprite设置属性\"></a>为cc.Sprite设置属性</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logopng.x=logopng.width;</span><br><span class=\"line\">logopng.y=size.height-logopng.height;</span><br></pre></td></tr></table></figure>\n<p>作业要求是要讲图片放置在左上角，那么横纵坐标各式多少呢？实践为准，于是我试了(0,0),(0,size.height),(size.width,0),(size,width,size,height),结果发现，当坐标为(0,size.height)的时候，图片的中恰好在屏幕左上角，也就是说，如果按照坐标系来说的话，手机屏幕应该是处于坐标系的第二象限，这样就好理解多了。但还有一个问题，就是为什么图片只有四分之一漏了出来呢？其实这就是Sprite的锚点了，它的锚点默认是处于图片的正中心位置的，估计后面的课程如果讲到精灵的旋转变换等，一定会用到这个锚点的。</p>\n<h3 id=\"最后一步依然是讲图片层加入背景图层\"><a href=\"#最后一步依然是讲图片层加入背景图层\" class=\"headerlink\" title=\"最后一步依然是讲图片层加入背景图层\"></a>最后一步依然是讲图片层加入背景图层</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">this</span>.addChilde(logopng);</span><br></pre></td></tr></table></figure>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>总的来说，免费体验的两节课程讲了如何在背景层中添加自己的文字层或图片层，它们的原理机制是一样的，两节课虽然内容不多，但这其中的内容，如果要去深挖，还是有很多东西的，比如像构造函数，属性设置，锚点，坐标系，资源加载等，不过体验课更多的是让我们了解cocos2djs开发的一个流程，项目结构等。相信真正有意思的课程都在后边，很是期待！</p>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_05/16a648e2762f9b75fdd8be57202678aa511d20b4/\">http://www.cocoscvp.com/usercode/2016_04_05/16a648e2762f9b75fdd8be57202678aa511d20b4/</a></p>"},{"title":"CVP认证学习笔记--(何小成)003--实现文本菜单层","date":"2016-04-08T15:51:00.000Z","_content":"今天这节，算是正式课了，确实难度相对于体验课提高了，并不是简单的四行代码就能实现的了，这节课讲的内容是如何在场景中添加一个文本菜单层。\n课程中是以实现左右按键来使文字左右移动为实例，目的在于让我们掌握Cocos中菜单的使用。<!--more-->而留下的课后作业，就是自行实现上下左右，其实原理都差不多，重点在于要让我们动手敲代码，亲身感受熟悉这个过程。\n### 首先添加一个图片，来让我们操作\n添加过程跟上节内容相同，这里直接new了\n```javascript\nvar logo = new cc.Sprite(res.logo_png);\nlog.setTag(1);\n```\n与前面不同的是，这里为logo添加了一个tag，相当于一个标签，方便后面能在回调函数中得到这个logo控件\n### 设置菜单字体及字体大小（当然，你不设置的话，也是会有一个默认值的）\n```javascript\ncc.MenuItemFont.setFontName(\"Times New Roman\");\ncc.MenuItemFont.setFontSize(80);\n```\n### 创建菜单选项\n第一个参数是文字内容，第二个参数是回调函数，第三个参数是调用对象（回调后面说）\n```javascript\n// 左移动按键\nvar a=new cc.MenuItemFont(\"<\",this.callBackLeft,this);\na.setPosition(a.width/2,size.height/2);\n// 右移动按键\nvar d=new cc.MenuItemFont(\">\",this.callBackRight,this);\nd.setPosition(size.width-d.width/2,size.height/2);\n// 下移动按键\nvar s=new cc.MenuItemFont(\"v\",this.callBackDown,this);\ns.setPosition(size.width/2,s.height/2);\n// 上移动按键\nvar w=new cc.MenuItemFont(\"^\",this.callBackUp,this);\nw.setPosition(size.width/2,size.height-w.height/2);\n```\n刚开始写的WASD。。。后来看到喵酱的<>^V，恍然大悟。。。上下左右还是这样比较美观，并且分布在屏幕四个角落的时候，在手机会好按一点，，，刚开始我wasd挤在右下角，手机上几乎都挤在一起了。。。额。。好吧，这都不是重点。。。重点是，要将四个按键规规矩矩的放在屏幕的四个中等线上还是需要稍微计算一下坐标的，上一节我只大概知道我们cocos的坐标系处于第二象限，今天听到沈大海老师在视频中提了一下，OpenGL的坐标的0,0就是在左下角位置。\n### 添加菜单选项到菜单\ncocos中，添加到图层上的是菜单，一个菜单会包含一个或多个菜单选项，我创建好了4个菜单选项，就要把菜单选项添加到一个菜单中\n```javascript\nvar menu=new cc.Menu(a,d,s,w);\nmenu.setPosition(0,0);\nthis.addChild(menu);\n```\n特地说明一下，为什么还要给menu设置一个Position （0,0），因为menu的默认坐标是在屏幕的正中央，而菜单选项的坐标都是以菜单的坐标为中心的相对位置，所以说，如果我不设置0,0坐标，那么右上按钮就不见了，而左下按钮在右上按钮的位置，相当于，对角线方向上偏移了一半。\n### 写回调函数\n上面说到的回调函数，就是当这个菜单按钮被按下时，所要执行的代码，所以那些按下上下左右的时候图片的相应的位移，就在回调中来实现，实现如下：\n```javascript\ncallBackLeft:function(){\n      var logo=this.getChildByTag(1);\n      if(logo.getPositionX()-40<=logo.width/2){\n        return;\n      }\n      logo.setPosition(logo.getPositionX()-40,logo.getPositionY());\n    },\n    callBackRight:function(){\n      var logo=this.getChildByTag(1);\n      if(logo.getPositionX()+40>=cc.winSize.width-logo.width/2){\n          return;\n      }\n      logo.setPosition(logo.getPositionX()+40,logo.getPositionY());\n    },\n    callBackDown:function(){\n      var logo=this.getChildByTag(1);\n      if(logo.getPositionY()-40<=logo.height/2){\n          return;\n      }\n      logo.setPosition(logo.getPositionX(),logo.getPositionY()-40);\n    },\n    callBackUp:function(){\n      var logo=this.getChildByTag(1);\n      if(logo.getPositionY()+40>=cc.winSize.height-logo.height/2){\n          return;\n      }\n      logo.setPosition(logo.getPositionX(),logo.getPositionY()+40);\n    }\n```\n以上是回调实现，其中加上了边界判断。\n\n### 总结\n这一节课讲了图层中添加菜单按钮，以及按钮功能实现，知识如下：\n1. 坐标计算\n2. 回调函数\n3. menu及menuItem使用\n4. getChildByTag()\n\n### 运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_07/a6a251fd44614c789eb99d1b12b14539635ae6bf/\n","source":"_posts/CVP认证学习笔记--(何小成)003--实现文本菜单层.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)003--实现文本菜单层\ndate: 2016-04-08 23:51\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n今天这节，算是正式课了，确实难度相对于体验课提高了，并不是简单的四行代码就能实现的了，这节课讲的内容是如何在场景中添加一个文本菜单层。\n课程中是以实现左右按键来使文字左右移动为实例，目的在于让我们掌握Cocos中菜单的使用。<!--more-->而留下的课后作业，就是自行实现上下左右，其实原理都差不多，重点在于要让我们动手敲代码，亲身感受熟悉这个过程。\n### 首先添加一个图片，来让我们操作\n添加过程跟上节内容相同，这里直接new了\n```javascript\nvar logo = new cc.Sprite(res.logo_png);\nlog.setTag(1);\n```\n与前面不同的是，这里为logo添加了一个tag，相当于一个标签，方便后面能在回调函数中得到这个logo控件\n### 设置菜单字体及字体大小（当然，你不设置的话，也是会有一个默认值的）\n```javascript\ncc.MenuItemFont.setFontName(\"Times New Roman\");\ncc.MenuItemFont.setFontSize(80);\n```\n### 创建菜单选项\n第一个参数是文字内容，第二个参数是回调函数，第三个参数是调用对象（回调后面说）\n```javascript\n// 左移动按键\nvar a=new cc.MenuItemFont(\"<\",this.callBackLeft,this);\na.setPosition(a.width/2,size.height/2);\n// 右移动按键\nvar d=new cc.MenuItemFont(\">\",this.callBackRight,this);\nd.setPosition(size.width-d.width/2,size.height/2);\n// 下移动按键\nvar s=new cc.MenuItemFont(\"v\",this.callBackDown,this);\ns.setPosition(size.width/2,s.height/2);\n// 上移动按键\nvar w=new cc.MenuItemFont(\"^\",this.callBackUp,this);\nw.setPosition(size.width/2,size.height-w.height/2);\n```\n刚开始写的WASD。。。后来看到喵酱的<>^V，恍然大悟。。。上下左右还是这样比较美观，并且分布在屏幕四个角落的时候，在手机会好按一点，，，刚开始我wasd挤在右下角，手机上几乎都挤在一起了。。。额。。好吧，这都不是重点。。。重点是，要将四个按键规规矩矩的放在屏幕的四个中等线上还是需要稍微计算一下坐标的，上一节我只大概知道我们cocos的坐标系处于第二象限，今天听到沈大海老师在视频中提了一下，OpenGL的坐标的0,0就是在左下角位置。\n### 添加菜单选项到菜单\ncocos中，添加到图层上的是菜单，一个菜单会包含一个或多个菜单选项，我创建好了4个菜单选项，就要把菜单选项添加到一个菜单中\n```javascript\nvar menu=new cc.Menu(a,d,s,w);\nmenu.setPosition(0,0);\nthis.addChild(menu);\n```\n特地说明一下，为什么还要给menu设置一个Position （0,0），因为menu的默认坐标是在屏幕的正中央，而菜单选项的坐标都是以菜单的坐标为中心的相对位置，所以说，如果我不设置0,0坐标，那么右上按钮就不见了，而左下按钮在右上按钮的位置，相当于，对角线方向上偏移了一半。\n### 写回调函数\n上面说到的回调函数，就是当这个菜单按钮被按下时，所要执行的代码，所以那些按下上下左右的时候图片的相应的位移，就在回调中来实现，实现如下：\n```javascript\ncallBackLeft:function(){\n      var logo=this.getChildByTag(1);\n      if(logo.getPositionX()-40<=logo.width/2){\n        return;\n      }\n      logo.setPosition(logo.getPositionX()-40,logo.getPositionY());\n    },\n    callBackRight:function(){\n      var logo=this.getChildByTag(1);\n      if(logo.getPositionX()+40>=cc.winSize.width-logo.width/2){\n          return;\n      }\n      logo.setPosition(logo.getPositionX()+40,logo.getPositionY());\n    },\n    callBackDown:function(){\n      var logo=this.getChildByTag(1);\n      if(logo.getPositionY()-40<=logo.height/2){\n          return;\n      }\n      logo.setPosition(logo.getPositionX(),logo.getPositionY()-40);\n    },\n    callBackUp:function(){\n      var logo=this.getChildByTag(1);\n      if(logo.getPositionY()+40>=cc.winSize.height-logo.height/2){\n          return;\n      }\n      logo.setPosition(logo.getPositionX(),logo.getPositionY()+40);\n    }\n```\n以上是回调实现，其中加上了边界判断。\n\n### 总结\n这一节课讲了图层中添加菜单按钮，以及按钮功能实现，知识如下：\n1. 坐标计算\n2. 回调函数\n3. menu及menuItem使用\n4. getChildByTag()\n\n### 运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_07/a6a251fd44614c789eb99d1b12b14539635ae6bf/\n","slug":"CVP认证学习笔记--(何小成)003--实现文本菜单层","published":1,"updated":"2016-04-24T15:03:40.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhtn0009wsazepxdgybi","content":"<p>今天这节，算是正式课了，确实难度相对于体验课提高了，并不是简单的四行代码就能实现的了，这节课讲的内容是如何在场景中添加一个文本菜单层。<br>课程中是以实现左右按键来使文字左右移动为实例，目的在于让我们掌握Cocos中菜单的使用。<a id=\"more\"></a>而留下的课后作业，就是自行实现上下左右，其实原理都差不多，重点在于要让我们动手敲代码，亲身感受熟悉这个过程。</p>\n<h3 id=\"首先添加一个图片，来让我们操作\"><a href=\"#首先添加一个图片，来让我们操作\" class=\"headerlink\" title=\"首先添加一个图片，来让我们操作\"></a>首先添加一个图片，来让我们操作</h3><p>添加过程跟上节内容相同，这里直接new了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> logo = <span class=\"keyword\">new</span> cc.Sprite(res.logo_png);</span><br><span class=\"line\">log.setTag(<span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure>\n<p>与前面不同的是，这里为logo添加了一个tag，相当于一个标签，方便后面能在回调函数中得到这个logo控件</p>\n<h3 id=\"设置菜单字体及字体大小（当然，你不设置的话，也是会有一个默认值的）\"><a href=\"#设置菜单字体及字体大小（当然，你不设置的话，也是会有一个默认值的）\" class=\"headerlink\" title=\"设置菜单字体及字体大小（当然，你不设置的话，也是会有一个默认值的）\"></a>设置菜单字体及字体大小（当然，你不设置的话，也是会有一个默认值的）</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.MenuItemFont.setFontName(<span class=\"string\">&quot;Times New Roman&quot;</span>);</span><br><span class=\"line\">cc.MenuItemFont.setFontSize(<span class=\"number\">80</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建菜单选项\"><a href=\"#创建菜单选项\" class=\"headerlink\" title=\"创建菜单选项\"></a>创建菜单选项</h3><p>第一个参数是文字内容，第二个参数是回调函数，第三个参数是调用对象（回调后面说）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 左移动按键</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;&lt;&quot;</span>,<span class=\"built_in\">this</span>.callBackLeft,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">a.setPosition(a.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"comment\">// 右移动按键</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> d=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;&gt;&quot;</span>,<span class=\"built_in\">this</span>.callBackRight,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">d.setPosition(size.width-d.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"comment\">// 下移动按键</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> s=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;v&quot;</span>,<span class=\"built_in\">this</span>.callBackDown,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">s.setPosition(size.width/<span class=\"number\">2</span>,s.height/<span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"comment\">// 上移动按键</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> w=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;^&quot;</span>,<span class=\"built_in\">this</span>.callBackUp,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">w.setPosition(size.width/<span class=\"number\">2</span>,size.height-w.height/<span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n<p>刚开始写的WASD。。。后来看到喵酱的&lt;&gt;^V，恍然大悟。。。上下左右还是这样比较美观，并且分布在屏幕四个角落的时候，在手机会好按一点，，，刚开始我wasd挤在右下角，手机上几乎都挤在一起了。。。额。。好吧，这都不是重点。。。重点是，要将四个按键规规矩矩的放在屏幕的四个中等线上还是需要稍微计算一下坐标的，上一节我只大概知道我们cocos的坐标系处于第二象限，今天听到沈大海老师在视频中提了一下，OpenGL的坐标的0,0就是在左下角位置。</p>\n<h3 id=\"添加菜单选项到菜单\"><a href=\"#添加菜单选项到菜单\" class=\"headerlink\" title=\"添加菜单选项到菜单\"></a>添加菜单选项到菜单</h3><p>cocos中，添加到图层上的是菜单，一个菜单会包含一个或多个菜单选项，我创建好了4个菜单选项，就要把菜单选项添加到一个菜单中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(a,d,s,w);</span><br><span class=\"line\">menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"built_in\">this</span>.addChild(menu);</span><br></pre></td></tr></table></figure>\n<p>特地说明一下，为什么还要给menu设置一个Position （0,0），因为menu的默认坐标是在屏幕的正中央，而菜单选项的坐标都是以菜单的坐标为中心的相对位置，所以说，如果我不设置0,0坐标，那么右上按钮就不见了，而左下按钮在右上按钮的位置，相当于，对角线方向上偏移了一半。</p>\n<h3 id=\"写回调函数\"><a href=\"#写回调函数\" class=\"headerlink\" title=\"写回调函数\"></a>写回调函数</h3><p>上面说到的回调函数，就是当这个菜单按钮被按下时，所要执行的代码，所以那些按下上下左右的时候图片的相应的位移，就在回调中来实现，实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">callBackLeft:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> logo=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(logo.getPositionX()<span class=\"number\">-40</span>&lt;=logo.width/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      logo.setPosition(logo.getPositionX()<span class=\"number\">-40</span>,logo.getPositionY());</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callBackRight:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> logo=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(logo.getPositionX()+<span class=\"number\">40</span>&gt;=cc.winSize.width-logo.width/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      logo.setPosition(logo.getPositionX()+<span class=\"number\">40</span>,logo.getPositionY());</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callBackDown:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> logo=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(logo.getPositionY()<span class=\"number\">-40</span>&lt;=logo.height/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      logo.setPosition(logo.getPositionX(),logo.getPositionY()<span class=\"number\">-40</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callBackUp:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> logo=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(logo.getPositionY()+<span class=\"number\">40</span>&gt;=cc.winSize.height-logo.height/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      logo.setPosition(logo.getPositionX(),logo.getPositionY()+<span class=\"number\">40</span>);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>以上是回调实现，其中加上了边界判断。</p>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>这一节课讲了图层中添加菜单按钮，以及按钮功能实现，知识如下：</p>\n<ol>\n<li>坐标计算</li>\n<li>回调函数</li>\n<li>menu及menuItem使用</li>\n<li>getChildByTag()</li>\n</ol>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_07/a6a251fd44614c789eb99d1b12b14539635ae6bf/\">http://www.cocoscvp.com/usercode/2016_04_07/a6a251fd44614c789eb99d1b12b14539635ae6bf/</a></p>\n","site":{"data":{}},"excerpt":"<p>今天这节，算是正式课了，确实难度相对于体验课提高了，并不是简单的四行代码就能实现的了，这节课讲的内容是如何在场景中添加一个文本菜单层。<br>课程中是以实现左右按键来使文字左右移动为实例，目的在于让我们掌握Cocos中菜单的使用。","more":"而留下的课后作业，就是自行实现上下左右，其实原理都差不多，重点在于要让我们动手敲代码，亲身感受熟悉这个过程。</p>\n<h3 id=\"首先添加一个图片，来让我们操作\"><a href=\"#首先添加一个图片，来让我们操作\" class=\"headerlink\" title=\"首先添加一个图片，来让我们操作\"></a>首先添加一个图片，来让我们操作</h3><p>添加过程跟上节内容相同，这里直接new了</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> logo = <span class=\"keyword\">new</span> cc.Sprite(res.logo_png);</span><br><span class=\"line\">log.setTag(<span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure>\n<p>与前面不同的是，这里为logo添加了一个tag，相当于一个标签，方便后面能在回调函数中得到这个logo控件</p>\n<h3 id=\"设置菜单字体及字体大小（当然，你不设置的话，也是会有一个默认值的）\"><a href=\"#设置菜单字体及字体大小（当然，你不设置的话，也是会有一个默认值的）\" class=\"headerlink\" title=\"设置菜单字体及字体大小（当然，你不设置的话，也是会有一个默认值的）\"></a>设置菜单字体及字体大小（当然，你不设置的话，也是会有一个默认值的）</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.MenuItemFont.setFontName(<span class=\"string\">&quot;Times New Roman&quot;</span>);</span><br><span class=\"line\">cc.MenuItemFont.setFontSize(<span class=\"number\">80</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建菜单选项\"><a href=\"#创建菜单选项\" class=\"headerlink\" title=\"创建菜单选项\"></a>创建菜单选项</h3><p>第一个参数是文字内容，第二个参数是回调函数，第三个参数是调用对象（回调后面说）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 左移动按键</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;&lt;&quot;</span>,<span class=\"built_in\">this</span>.callBackLeft,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">a.setPosition(a.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"comment\">// 右移动按键</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> d=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;&gt;&quot;</span>,<span class=\"built_in\">this</span>.callBackRight,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">d.setPosition(size.width-d.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"comment\">// 下移动按键</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> s=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;v&quot;</span>,<span class=\"built_in\">this</span>.callBackDown,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">s.setPosition(size.width/<span class=\"number\">2</span>,s.height/<span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"comment\">// 上移动按键</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> w=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;^&quot;</span>,<span class=\"built_in\">this</span>.callBackUp,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">w.setPosition(size.width/<span class=\"number\">2</span>,size.height-w.height/<span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n<p>刚开始写的WASD。。。后来看到喵酱的&lt;&gt;^V，恍然大悟。。。上下左右还是这样比较美观，并且分布在屏幕四个角落的时候，在手机会好按一点，，，刚开始我wasd挤在右下角，手机上几乎都挤在一起了。。。额。。好吧，这都不是重点。。。重点是，要将四个按键规规矩矩的放在屏幕的四个中等线上还是需要稍微计算一下坐标的，上一节我只大概知道我们cocos的坐标系处于第二象限，今天听到沈大海老师在视频中提了一下，OpenGL的坐标的0,0就是在左下角位置。</p>\n<h3 id=\"添加菜单选项到菜单\"><a href=\"#添加菜单选项到菜单\" class=\"headerlink\" title=\"添加菜单选项到菜单\"></a>添加菜单选项到菜单</h3><p>cocos中，添加到图层上的是菜单，一个菜单会包含一个或多个菜单选项，我创建好了4个菜单选项，就要把菜单选项添加到一个菜单中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(a,d,s,w);</span><br><span class=\"line\">menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"built_in\">this</span>.addChild(menu);</span><br></pre></td></tr></table></figure>\n<p>特地说明一下，为什么还要给menu设置一个Position （0,0），因为menu的默认坐标是在屏幕的正中央，而菜单选项的坐标都是以菜单的坐标为中心的相对位置，所以说，如果我不设置0,0坐标，那么右上按钮就不见了，而左下按钮在右上按钮的位置，相当于，对角线方向上偏移了一半。</p>\n<h3 id=\"写回调函数\"><a href=\"#写回调函数\" class=\"headerlink\" title=\"写回调函数\"></a>写回调函数</h3><p>上面说到的回调函数，就是当这个菜单按钮被按下时，所要执行的代码，所以那些按下上下左右的时候图片的相应的位移，就在回调中来实现，实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">callBackLeft:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> logo=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(logo.getPositionX()<span class=\"number\">-40</span>&lt;=logo.width/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      logo.setPosition(logo.getPositionX()<span class=\"number\">-40</span>,logo.getPositionY());</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callBackRight:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> logo=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(logo.getPositionX()+<span class=\"number\">40</span>&gt;=cc.winSize.width-logo.width/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      logo.setPosition(logo.getPositionX()+<span class=\"number\">40</span>,logo.getPositionY());</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callBackDown:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> logo=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(logo.getPositionY()<span class=\"number\">-40</span>&lt;=logo.height/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      logo.setPosition(logo.getPositionX(),logo.getPositionY()<span class=\"number\">-40</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callBackUp:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> logo=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(logo.getPositionY()+<span class=\"number\">40</span>&gt;=cc.winSize.height-logo.height/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      logo.setPosition(logo.getPositionX(),logo.getPositionY()+<span class=\"number\">40</span>);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>以上是回调实现，其中加上了边界判断。</p>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>这一节课讲了图层中添加菜单按钮，以及按钮功能实现，知识如下：</p>\n<ol>\n<li>坐标计算</li>\n<li>回调函数</li>\n<li>menu及menuItem使用</li>\n<li>getChildByTag()</li>\n</ol>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_07/a6a251fd44614c789eb99d1b12b14539635ae6bf/\">http://www.cocoscvp.com/usercode/2016_04_07/a6a251fd44614c789eb99d1b12b14539635ae6bf/</a></p>"},{"title":"CVP认证学习笔记--(何小成)004--实现自定义场景","date":"2016-04-12T23:29:00.000Z","_content":"这节课的内容讲的是如何在cocos中添加自定义场景，一个看似很简单的内容，包含了很多cocos的运行机制原理。\n以前我们都直接在app.js中写代码，然后运行查看效果，这节课详细讲解了cocos从启动到运行的一个流程，分为以下几步：\n<!--more-->\n### index.html\n由于cocosjs基于h5进行开发，因此启动还是从html页面为入口，在index.html中，有一下几句代码：\n```javascript\n<canvas id=\"gameCanvas\" width=\"480\" height=\"720\"></canvas>\n```\n可以看出，整个cocos的游戏是基于canvas进行绘制的，第一句就定义了一个gameCanvas；\n然后加载了CCBoot.js，记载一些cocos\n### cocos开发库及资源配置加载\n```javascript\nsrc=\"frameworks/cocos2d-html5/CCBoot.js\"\n```\ncocos通过CCBoot.js加载cocos的启动文件，可以点开CCBoot.js查看cocos启动时都加载些什么内容，其中就能看到project.json也是在这个过程中加载的，project.json中，定义了cocos游戏的一些配置参数，其中包括加载的js文件，使用的引擎，使用的模块等信息。\n### main.js\n```javascript\ncocos src=\"main.js\"\n```\n当CCBoot.js启动完之后，才轮到man.js出场，按照以往的惯例，main函数一般都是程序的入口，main.js中的关键函数如下：\n```javascript\ncc.game.onStart = function(){\n//判断当前项目是native game还是h5(我们写的这些代码可以直接打包app)\n//如果是 h5则删掉loading的DOM节点\nif(!cc.sys.isNative %26%26 document.getElementById(\"cocosLoading\")) //If referenced loading.js, please remove it\ndocument.body.removeChild(document.getElementById(\"cocosLoading\"));\n// Pass true to enable retina display, on Android disabled by default to improve performance\ncc.view.enableRetina(cc.sys.os === cc.sys.OS_IOS ? true : false);\n// Adjust viewport meta\ncc.view.adjustViewPort(true);\n// Setup the resolution policy and design resolution size\ncc.view.setDesignResolutionSize(800, 450, cc.ResolutionPolicy.SHOW_ALL);\n// Instead of set design resolution, you can also set the real pixel resolution size\n// Uncomment the following line and delete the previous line.\n// cc.view.setRealPixelResolution(960, 640, cc.ResolutionPolicy.SHOW_ALL);\n// The game will be resized when browser size change\ncc.view.resizeWithBrowserSize(true);\n//以上4行主要来设置屏幕的适配和窗口,SHOW_ALL表示适配全屏幕\n//load resources\n// 预加载所有纹理图片资源，加载完成之后回调function,g_resources在哪定义的？一会揭晓\ncc.LoaderScene.preload(g_resources, function () {\n//当资源加载完成，调用导演类来实现第一个场景的加载HelloWorldScene,src/app.js定义的\n//cc.director.runScene(new HelloWorldScene());\n//现在我们要定义一个新的场景类，然后加载\ncc.director.runScene(new myScene());//先保存这个文件，然后编辑src/myscene.js\n}, this);\n};\ncc.game.run();\n```\n\n可以看到main.js加载了cocos的一些核心类，其中最重要的就是加载了游戏的第一个运行的场景，这里我已经改成了我自己的场景myScene，通过main.js启动第一个场景之后，整个游戏才真正的跑起来了。\n\n以上三个步骤就是cocos项目的启动的一个大概过程，其中讲到了一个场景的概念，我个人认为cocos的这些设计理念特别符合我们人类的主观认识，把游戏和电影中的一些内容对应。cocos中有导演、场景、图层和精灵的概念。一般来说，一场电影中只会有一个导演，cocos游戏中，一般会有一个导演类；一场电影会有多个镜头，对应cocos中就是多个场景，而同一时刻，只会同时运行一个场景，就像电影中不可能同时出现多个镜头；电影场景中的房屋，天空，大地，就对应cocos中的图层；而房屋中的桌椅板凳、天空中的云、地面上的人，就对应cocos中的精灵。通过电影的这么一个过程，我们比较能够容易的理解cocos的一个机制原理。\n\n![cocos中关系图](http://7xnnwn.com1.z0.glb.clouddn.com/relation.png)\n\n以上基本就是课程的全部内容，然后作业呢，也跟课程一样，要完成很简单，但背后内容，还真的是很多的，我自定义的场景内容如下：\n\n```javascript\nvar myLayer = cc.Layer.extend({\n    ctor:function(){\n        this._super();\n        var size = cc.winSize;\n        var txt1 = new cc.LabelTTF(\"这里是游戏场景\",\"\",50);\n        txt1.setPosition(size.width/2,size.height-txt1.height);\n        var txt2 = new cc.LabelTTF(\"我的名字是何金成\",\"\",50);\n        txt2.setPosition(size.width/2,txt1.height-txt1.height/2);\n        this.addChild(txt1);\n        this.addChild(txt2);\n        return true;\n    }\n});\n\nvar myScene = cc.Scene.extend({\n    ctor:function(){\n        this._super();\n        var layer1 = new myLayer();\n        this.addChild(layer1);\n    }\n});\n```\n\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_09/8ab000a365413ab9ebdb5a3533571828bbdd552f/\n","source":"_posts/CVP认证学习笔记--(何小成)004--实现自定义场景.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)004--实现自定义场景\ndate: 2016-04-13 07:29\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n这节课的内容讲的是如何在cocos中添加自定义场景，一个看似很简单的内容，包含了很多cocos的运行机制原理。\n以前我们都直接在app.js中写代码，然后运行查看效果，这节课详细讲解了cocos从启动到运行的一个流程，分为以下几步：\n<!--more-->\n### index.html\n由于cocosjs基于h5进行开发，因此启动还是从html页面为入口，在index.html中，有一下几句代码：\n```javascript\n<canvas id=\"gameCanvas\" width=\"480\" height=\"720\"></canvas>\n```\n可以看出，整个cocos的游戏是基于canvas进行绘制的，第一句就定义了一个gameCanvas；\n然后加载了CCBoot.js，记载一些cocos\n### cocos开发库及资源配置加载\n```javascript\nsrc=\"frameworks/cocos2d-html5/CCBoot.js\"\n```\ncocos通过CCBoot.js加载cocos的启动文件，可以点开CCBoot.js查看cocos启动时都加载些什么内容，其中就能看到project.json也是在这个过程中加载的，project.json中，定义了cocos游戏的一些配置参数，其中包括加载的js文件，使用的引擎，使用的模块等信息。\n### main.js\n```javascript\ncocos src=\"main.js\"\n```\n当CCBoot.js启动完之后，才轮到man.js出场，按照以往的惯例，main函数一般都是程序的入口，main.js中的关键函数如下：\n```javascript\ncc.game.onStart = function(){\n//判断当前项目是native game还是h5(我们写的这些代码可以直接打包app)\n//如果是 h5则删掉loading的DOM节点\nif(!cc.sys.isNative %26%26 document.getElementById(\"cocosLoading\")) //If referenced loading.js, please remove it\ndocument.body.removeChild(document.getElementById(\"cocosLoading\"));\n// Pass true to enable retina display, on Android disabled by default to improve performance\ncc.view.enableRetina(cc.sys.os === cc.sys.OS_IOS ? true : false);\n// Adjust viewport meta\ncc.view.adjustViewPort(true);\n// Setup the resolution policy and design resolution size\ncc.view.setDesignResolutionSize(800, 450, cc.ResolutionPolicy.SHOW_ALL);\n// Instead of set design resolution, you can also set the real pixel resolution size\n// Uncomment the following line and delete the previous line.\n// cc.view.setRealPixelResolution(960, 640, cc.ResolutionPolicy.SHOW_ALL);\n// The game will be resized when browser size change\ncc.view.resizeWithBrowserSize(true);\n//以上4行主要来设置屏幕的适配和窗口,SHOW_ALL表示适配全屏幕\n//load resources\n// 预加载所有纹理图片资源，加载完成之后回调function,g_resources在哪定义的？一会揭晓\ncc.LoaderScene.preload(g_resources, function () {\n//当资源加载完成，调用导演类来实现第一个场景的加载HelloWorldScene,src/app.js定义的\n//cc.director.runScene(new HelloWorldScene());\n//现在我们要定义一个新的场景类，然后加载\ncc.director.runScene(new myScene());//先保存这个文件，然后编辑src/myscene.js\n}, this);\n};\ncc.game.run();\n```\n\n可以看到main.js加载了cocos的一些核心类，其中最重要的就是加载了游戏的第一个运行的场景，这里我已经改成了我自己的场景myScene，通过main.js启动第一个场景之后，整个游戏才真正的跑起来了。\n\n以上三个步骤就是cocos项目的启动的一个大概过程，其中讲到了一个场景的概念，我个人认为cocos的这些设计理念特别符合我们人类的主观认识，把游戏和电影中的一些内容对应。cocos中有导演、场景、图层和精灵的概念。一般来说，一场电影中只会有一个导演，cocos游戏中，一般会有一个导演类；一场电影会有多个镜头，对应cocos中就是多个场景，而同一时刻，只会同时运行一个场景，就像电影中不可能同时出现多个镜头；电影场景中的房屋，天空，大地，就对应cocos中的图层；而房屋中的桌椅板凳、天空中的云、地面上的人，就对应cocos中的精灵。通过电影的这么一个过程，我们比较能够容易的理解cocos的一个机制原理。\n\n![cocos中关系图](http://7xnnwn.com1.z0.glb.clouddn.com/relation.png)\n\n以上基本就是课程的全部内容，然后作业呢，也跟课程一样，要完成很简单，但背后内容，还真的是很多的，我自定义的场景内容如下：\n\n```javascript\nvar myLayer = cc.Layer.extend({\n    ctor:function(){\n        this._super();\n        var size = cc.winSize;\n        var txt1 = new cc.LabelTTF(\"这里是游戏场景\",\"\",50);\n        txt1.setPosition(size.width/2,size.height-txt1.height);\n        var txt2 = new cc.LabelTTF(\"我的名字是何金成\",\"\",50);\n        txt2.setPosition(size.width/2,txt1.height-txt1.height/2);\n        this.addChild(txt1);\n        this.addChild(txt2);\n        return true;\n    }\n});\n\nvar myScene = cc.Scene.extend({\n    ctor:function(){\n        this._super();\n        var layer1 = new myLayer();\n        this.addChild(layer1);\n    }\n});\n```\n\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_09/8ab000a365413ab9ebdb5a3533571828bbdd552f/\n","slug":"CVP认证学习笔记--(何小成)004--实现自定义场景","published":1,"updated":"2016-05-06T17:02:56.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhto000awsazdm7ebrle","content":"<p>这节课的内容讲的是如何在cocos中添加自定义场景，一个看似很简单的内容，包含了很多cocos的运行机制原理。<br>以前我们都直接在app.js中写代码，然后运行查看效果，这节课详细讲解了cocos从启动到运行的一个流程，分为以下几步：</p>\n<a id=\"more\"></a>\n<h3 id=\"index-html\"><a href=\"#index-html\" class=\"headerlink\" title=\"index.html\"></a>index.html</h3><p>由于cocosjs基于h5进行开发，因此启动还是从html页面为入口，在index.html中，有一下几句代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;canvas id=<span class=\"string\">&quot;gameCanvas&quot;</span> width=<span class=\"string\">&quot;480&quot;</span> height=<span class=\"string\">&quot;720&quot;</span>&gt;&lt;/canvas&gt;</span><br></pre></td></tr></table></figure>\n<p>可以看出，整个cocos的游戏是基于canvas进行绘制的，第一句就定义了一个gameCanvas；<br>然后加载了CCBoot.js，记载一些cocos</p>\n<h3 id=\"cocos开发库及资源配置加载\"><a href=\"#cocos开发库及资源配置加载\" class=\"headerlink\" title=\"cocos开发库及资源配置加载\"></a>cocos开发库及资源配置加载</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">src=<span class=\"string\">&quot;frameworks/cocos2d-html5/CCBoot.js&quot;</span></span><br></pre></td></tr></table></figure>\n<p>cocos通过CCBoot.js加载cocos的启动文件，可以点开CCBoot.js查看cocos启动时都加载些什么内容，其中就能看到project.json也是在这个过程中加载的，project.json中，定义了cocos游戏的一些配置参数，其中包括加载的js文件，使用的引擎，使用的模块等信息。</p>\n<h3 id=\"main-js\"><a href=\"#main-js\" class=\"headerlink\" title=\"main.js\"></a>main.js</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cocos src=<span class=\"string\">&quot;main.js&quot;</span></span><br></pre></td></tr></table></figure>\n<p>当CCBoot.js启动完之后，才轮到man.js出场，按照以往的惯例，main函数一般都是程序的入口，main.js中的关键函数如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.game.onStart = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//判断当前项目是native game还是h5(我们写的这些代码可以直接打包app)</span></span><br><span class=\"line\"><span class=\"comment\">//如果是 h5则删掉loading的DOM节点</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(!cc.sys.isNative %<span class=\"number\">26</span>%<span class=\"number\">26</span> <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;cocosLoading&quot;</span>)) <span class=\"comment\">//If referenced loading.js, please remove it</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.removeChild(<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;cocosLoading&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// Pass true to enable retina display, on Android disabled by default to improve performance</span></span><br><span class=\"line\">cc.view.enableRetina(cc.sys.os === cc.sys.OS_IOS ? <span class=\"literal\">true</span> : <span class=\"literal\">false</span>);</span><br><span class=\"line\"><span class=\"comment\">// Adjust viewport meta</span></span><br><span class=\"line\">cc.view.adjustViewPort(<span class=\"literal\">true</span>);</span><br><span class=\"line\"><span class=\"comment\">// Setup the resolution policy and design resolution size</span></span><br><span class=\"line\">cc.view.setDesignResolutionSize(<span class=\"number\">800</span>, <span class=\"number\">450</span>, cc.ResolutionPolicy.SHOW_ALL);</span><br><span class=\"line\"><span class=\"comment\">// Instead of set design resolution, you can also set the real pixel resolution size</span></span><br><span class=\"line\"><span class=\"comment\">// Uncomment the following line and delete the previous line.</span></span><br><span class=\"line\"><span class=\"comment\">// cc.view.setRealPixelResolution(960, 640, cc.ResolutionPolicy.SHOW_ALL);</span></span><br><span class=\"line\"><span class=\"comment\">// The game will be resized when browser size change</span></span><br><span class=\"line\">cc.view.resizeWithBrowserSize(<span class=\"literal\">true</span>);</span><br><span class=\"line\"><span class=\"comment\">//以上4行主要来设置屏幕的适配和窗口,SHOW_ALL表示适配全屏幕</span></span><br><span class=\"line\"><span class=\"comment\">//load resources</span></span><br><span class=\"line\"><span class=\"comment\">// 预加载所有纹理图片资源，加载完成之后回调function,g_resources在哪定义的？一会揭晓</span></span><br><span class=\"line\">cc.LoaderScene.preload(g_resources, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//当资源加载完成，调用导演类来实现第一个场景的加载HelloWorldScene,src/app.js定义的</span></span><br><span class=\"line\"><span class=\"comment\">//cc.director.runScene(new HelloWorldScene());</span></span><br><span class=\"line\"><span class=\"comment\">//现在我们要定义一个新的场景类，然后加载</span></span><br><span class=\"line\">cc.director.runScene(<span class=\"keyword\">new</span> myScene());<span class=\"comment\">//先保存这个文件，然后编辑src/myscene.js</span></span><br><span class=\"line\">&#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">cc.game.run();</span><br></pre></td></tr></table></figure>\n\n<p>可以看到main.js加载了cocos的一些核心类，其中最重要的就是加载了游戏的第一个运行的场景，这里我已经改成了我自己的场景myScene，通过main.js启动第一个场景之后，整个游戏才真正的跑起来了。</p>\n<p>以上三个步骤就是cocos项目的启动的一个大概过程，其中讲到了一个场景的概念，我个人认为cocos的这些设计理念特别符合我们人类的主观认识，把游戏和电影中的一些内容对应。cocos中有导演、场景、图层和精灵的概念。一般来说，一场电影中只会有一个导演，cocos游戏中，一般会有一个导演类；一场电影会有多个镜头，对应cocos中就是多个场景，而同一时刻，只会同时运行一个场景，就像电影中不可能同时出现多个镜头；电影场景中的房屋，天空，大地，就对应cocos中的图层；而房屋中的桌椅板凳、天空中的云、地面上的人，就对应cocos中的精灵。通过电影的这么一个过程，我们比较能够容易的理解cocos的一个机制原理。</p>\n<p><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/relation.png\" alt=\"cocos中关系图\"></p>\n<p>以上基本就是课程的全部内容，然后作业呢，也跟课程一样，要完成很简单，但背后内容，还真的是很多的，我自定义的场景内容如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> myLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> txt1 = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;这里是游戏场景&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>);</span><br><span class=\"line\">        txt1.setPosition(size.width/<span class=\"number\">2</span>,size.height-txt1.height);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> txt2 = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;我的名字是何金成&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>);</span><br><span class=\"line\">        txt2.setPosition(size.width/<span class=\"number\">2</span>,txt1.height-txt1.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(txt1);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(txt2);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> myScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer1 = <span class=\"keyword\">new</span> myLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_09/8ab000a365413ab9ebdb5a3533571828bbdd552f/\">http://www.cocoscvp.com/usercode/2016_04_09/8ab000a365413ab9ebdb5a3533571828bbdd552f/</a></p>\n","site":{"data":{}},"excerpt":"<p>这节课的内容讲的是如何在cocos中添加自定义场景，一个看似很简单的内容，包含了很多cocos的运行机制原理。<br>以前我们都直接在app.js中写代码，然后运行查看效果，这节课详细讲解了cocos从启动到运行的一个流程，分为以下几步：</p>","more":"<h3 id=\"index-html\"><a href=\"#index-html\" class=\"headerlink\" title=\"index.html\"></a>index.html</h3><p>由于cocosjs基于h5进行开发，因此启动还是从html页面为入口，在index.html中，有一下几句代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;canvas id=<span class=\"string\">&quot;gameCanvas&quot;</span> width=<span class=\"string\">&quot;480&quot;</span> height=<span class=\"string\">&quot;720&quot;</span>&gt;&lt;/canvas&gt;</span><br></pre></td></tr></table></figure>\n<p>可以看出，整个cocos的游戏是基于canvas进行绘制的，第一句就定义了一个gameCanvas；<br>然后加载了CCBoot.js，记载一些cocos</p>\n<h3 id=\"cocos开发库及资源配置加载\"><a href=\"#cocos开发库及资源配置加载\" class=\"headerlink\" title=\"cocos开发库及资源配置加载\"></a>cocos开发库及资源配置加载</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">src=<span class=\"string\">&quot;frameworks/cocos2d-html5/CCBoot.js&quot;</span></span><br></pre></td></tr></table></figure>\n<p>cocos通过CCBoot.js加载cocos的启动文件，可以点开CCBoot.js查看cocos启动时都加载些什么内容，其中就能看到project.json也是在这个过程中加载的，project.json中，定义了cocos游戏的一些配置参数，其中包括加载的js文件，使用的引擎，使用的模块等信息。</p>\n<h3 id=\"main-js\"><a href=\"#main-js\" class=\"headerlink\" title=\"main.js\"></a>main.js</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cocos src=<span class=\"string\">&quot;main.js&quot;</span></span><br></pre></td></tr></table></figure>\n<p>当CCBoot.js启动完之后，才轮到man.js出场，按照以往的惯例，main函数一般都是程序的入口，main.js中的关键函数如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.game.onStart = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//判断当前项目是native game还是h5(我们写的这些代码可以直接打包app)</span></span><br><span class=\"line\"><span class=\"comment\">//如果是 h5则删掉loading的DOM节点</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(!cc.sys.isNative %<span class=\"number\">26</span>%<span class=\"number\">26</span> <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;cocosLoading&quot;</span>)) <span class=\"comment\">//If referenced loading.js, please remove it</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.removeChild(<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;cocosLoading&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// Pass true to enable retina display, on Android disabled by default to improve performance</span></span><br><span class=\"line\">cc.view.enableRetina(cc.sys.os === cc.sys.OS_IOS ? <span class=\"literal\">true</span> : <span class=\"literal\">false</span>);</span><br><span class=\"line\"><span class=\"comment\">// Adjust viewport meta</span></span><br><span class=\"line\">cc.view.adjustViewPort(<span class=\"literal\">true</span>);</span><br><span class=\"line\"><span class=\"comment\">// Setup the resolution policy and design resolution size</span></span><br><span class=\"line\">cc.view.setDesignResolutionSize(<span class=\"number\">800</span>, <span class=\"number\">450</span>, cc.ResolutionPolicy.SHOW_ALL);</span><br><span class=\"line\"><span class=\"comment\">// Instead of set design resolution, you can also set the real pixel resolution size</span></span><br><span class=\"line\"><span class=\"comment\">// Uncomment the following line and delete the previous line.</span></span><br><span class=\"line\"><span class=\"comment\">// cc.view.setRealPixelResolution(960, 640, cc.ResolutionPolicy.SHOW_ALL);</span></span><br><span class=\"line\"><span class=\"comment\">// The game will be resized when browser size change</span></span><br><span class=\"line\">cc.view.resizeWithBrowserSize(<span class=\"literal\">true</span>);</span><br><span class=\"line\"><span class=\"comment\">//以上4行主要来设置屏幕的适配和窗口,SHOW_ALL表示适配全屏幕</span></span><br><span class=\"line\"><span class=\"comment\">//load resources</span></span><br><span class=\"line\"><span class=\"comment\">// 预加载所有纹理图片资源，加载完成之后回调function,g_resources在哪定义的？一会揭晓</span></span><br><span class=\"line\">cc.LoaderScene.preload(g_resources, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//当资源加载完成，调用导演类来实现第一个场景的加载HelloWorldScene,src/app.js定义的</span></span><br><span class=\"line\"><span class=\"comment\">//cc.director.runScene(new HelloWorldScene());</span></span><br><span class=\"line\"><span class=\"comment\">//现在我们要定义一个新的场景类，然后加载</span></span><br><span class=\"line\">cc.director.runScene(<span class=\"keyword\">new</span> myScene());<span class=\"comment\">//先保存这个文件，然后编辑src/myscene.js</span></span><br><span class=\"line\">&#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">cc.game.run();</span><br></pre></td></tr></table></figure>\n\n<p>可以看到main.js加载了cocos的一些核心类，其中最重要的就是加载了游戏的第一个运行的场景，这里我已经改成了我自己的场景myScene，通过main.js启动第一个场景之后，整个游戏才真正的跑起来了。</p>\n<p>以上三个步骤就是cocos项目的启动的一个大概过程，其中讲到了一个场景的概念，我个人认为cocos的这些设计理念特别符合我们人类的主观认识，把游戏和电影中的一些内容对应。cocos中有导演、场景、图层和精灵的概念。一般来说，一场电影中只会有一个导演，cocos游戏中，一般会有一个导演类；一场电影会有多个镜头，对应cocos中就是多个场景，而同一时刻，只会同时运行一个场景，就像电影中不可能同时出现多个镜头；电影场景中的房屋，天空，大地，就对应cocos中的图层；而房屋中的桌椅板凳、天空中的云、地面上的人，就对应cocos中的精灵。通过电影的这么一个过程，我们比较能够容易的理解cocos的一个机制原理。</p>\n<p><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/relation.png\" alt=\"cocos中关系图\"></p>\n<p>以上基本就是课程的全部内容，然后作业呢，也跟课程一样，要完成很简单，但背后内容，还真的是很多的，我自定义的场景内容如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> myLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> txt1 = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;这里是游戏场景&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>);</span><br><span class=\"line\">        txt1.setPosition(size.width/<span class=\"number\">2</span>,size.height-txt1.height);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> txt2 = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;我的名字是何金成&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>);</span><br><span class=\"line\">        txt2.setPosition(size.width/<span class=\"number\">2</span>,txt1.height-txt1.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(txt1);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(txt2);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> myScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer1 = <span class=\"keyword\">new</span> myLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_09/8ab000a365413ab9ebdb5a3533571828bbdd552f/\">http://www.cocoscvp.com/usercode/2016_04_09/8ab000a365413ab9ebdb5a3533571828bbdd552f/</a></p>"},{"title":"CVP认证学习笔记--(何小成)005--实现多场景切换","date":"2016-04-13T16:00:00.000Z","_content":"上篇帖子我提到了cocos中的导演、场景、图层以及精灵之间的关系。从那张关系图中可以看出，导演在整个游戏中处于一个相当重要的位置，它掌控者全局。\n### 概念\n在cocos的官网中，可以看到官方文档中对于director的一个解释<!--more-->：http://www.cocos.com/doc/article/index?type=cocos2d-x&url=/doc/cocos-docs-master/manual/framework/cocos2d-js/catalog/../4-essential-concepts/4-6-director-of-game/zh.md 从官方帮助文档中，我们可以看到，director在cocos中有以下几个作用：\n1. 环境设定：游戏开始前的帧率设置，动作管理器，事件管理器等都由director先加载起来\n2. 控制游戏主循环，游戏的原理，与动画相同，每一个看到的画面都是由director一帧一帧的渲染出来的，而这个渲染的过程就在director的主循环体内，所以循环的暂定与恢复也是由director来实现的\n3. 最后一个，也是director最重要的一个作用，同时也是本节课所讲的内容，就是场景的管理，除了创建，销毁，还有切换，push，pop等操作，这些都由director来完成，scene的整个生命周期都由director来管理。\n### 场景管理API\ndirector中关于场景管理的api有如下几个：\n```javascript\n// run the scene\ncc.director.runScene(scene);\n// get the running scene\nvar scene = cc.director.getRunningScene();\n// push in a new scene and cover the running scene\nvar scene = cc.director.pushScene(scene);\n// pop the top scene and run the second scene\ncc.director.popScene();\n// pop all the scene except the scene in the bottom\ncc.director.popToRootScene()\n```\ndirector对场景的管理是以堆栈的数据结构来管理，简单来说就是现进后出的数据结构，可以比喻成一个羽毛球筒，当你放进去一个一个的羽毛球后，最先放进去的一定在最底下，最后放进去的一定在最上面，这种结构就类似堆栈的数据结构，也就是说，当导演运行一个场景之后，它会被放入堆栈中，当你再push一个新的场景之后，第二个场景就会压入堆栈，放在第一个场景的上面，我们看到得就是场景二，而场景一仍然存在，只是被放在了场景二的下面，当我们做pop，堆栈就会销毁顶端的第一个场景，而它下面的场景就会呈现出来，但这时候并不会做初始操作，因为这是一直被压在下面的场景一，而当我们使用runScene的时候，会先销毁当前的场景，在new出第二个场景，我觉得如果不是有特别需要保留数据的场景，我们可以全部用runScene来管理场景，否则如果自己使用pop/push来管理场景有可能就乱了，忘了哪个销毁了哪个要初始化（个人感觉，仅参考）\n### 作业\n作业中代码，我也加入了一段代码来测试场景在切换的时候是否被销毁，只需要用runScene、pushScene、popScene分别来测试即可，代码如下：\n\n这是启动的第一个菜单场景，相当于各个场景的一个入口场景\n\n```javascript\nvar menuLayer=cc.Layer.extend({\n   ctor:function(){\n       this._super();\n       // add text\n       var tit=new cc.LabelTTF(\"CVP认证\",\"\",60);\n       tit.setPosition(240,300);\n       this.addChild(tit);\n       tit.setTag(1);\n       // add menu\n       // click to add a text,to test if the scene destroyed when director invoke runScene\n       var clickItem = new cc.MenuItemFont(\"添加文字\",this.clickCallback,this);\n       var itemstart=new cc.MenuItemFont(\"开始\",this.startScene,this);\n       itemstart.setPosition(clickItem.getPositionX(),clickItem.getPositionY()-clickItem.height/2-50);\n       var itemhelp=new cc.MenuItemFont(\"帮助\",this.helpScene,this);\n       itemhelp.setPosition(itemstart.getPositionX(),itemstart.getPositionY()-itemstart.height/2-50);\n       var menu=new cc.Menu(itemstart,itemhelp,clickItem);\n       this.addChild(menu);\n   },\n   startScene:function(){\n       cc.director.runScene(new HelloWorldScene());\n   },\n   helpScene:function(){\n       cc.director.runScene(new HelpScene());\n   },\n   clickCallback:function(){\n       // add text\n       var test = new cc.LabelTTF(\"添加的文字\",\"\",50);\n       var tit = this.getChildByTag(1);\n       test.setPosition(tit.getPositionX(),tit.getPositionY()+100);\n       this.addChild(test);\n   }\n});\n// define the menu scene\nvar MenuScene=cc.Scene.extend({\n   ctor:function(){\n       this._super();\n       // define the layer\n       var m1=new menuLayer();\n       this.addChild(m1);\n   }\n});\n```\n\n这是hello场景，其中包含了能返回菜单场景的按钮\n\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function () {\n        this._super();\n        var helloLabel = new cc.LabelTTF(\"Hello World\", \"Arial\", 38);\n        helloLabel.x = size.width / 2;\n        helloLabel.y = size.height / 2 + 200;\n        this.addChild(helloLabel, 5);\n        this.sprite = new cc.Sprite(res.HelloWorld_png);\n        this.sprite.attr({\n            x: size.width / 2,\n            y: size.height / 2\n        });\n        this.addChild(this.sprite, 0);\n        var backItem = new cc.MenuItemFont(\"返回主界面\",this.backCallback,this);\n        var menu = new cc.Menu(backItem);\n        this.addChild(menu);\n        return true;\n    },\n    backCallback:function(){\n        cc.director.runScene(new MenuScene());\n    }\n});\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n这是一个帮助场景，场景中只有一行文本\n\n```javascript\nvar HelpLayer = cc.Layer.extend({\n    ctor:function(){\n        this._super();\n        var text = new cc.LabelTTF(\"游戏帮助场景\",\"\",100);\n        text.setPosition(size.width/2,size.height/2);\n        this.addChild(text);\n        return true;\n    }\n});\n\nvar HelpScene = cc.Scene.extend({\n    ctor:function(){\n        this._super();\n        var helpLayer = new HelpLayer();\n        this.addChild(helpLayer);\n        return true;\n    }\n});\n```\n\n为了不让发帖出现各种bug，我把注释都翻译成英文了，，，也真是拼了，，，哎\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_09/a26fb7aab762fd52abcc8af0d183b8d3322b8117/\n","source":"_posts/CVP认证学习笔记--(何小成)005--实现多场景切换.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)005--实现多场景切换\ndate: 2016-04-14 00:00\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n上篇帖子我提到了cocos中的导演、场景、图层以及精灵之间的关系。从那张关系图中可以看出，导演在整个游戏中处于一个相当重要的位置，它掌控者全局。\n### 概念\n在cocos的官网中，可以看到官方文档中对于director的一个解释<!--more-->：http://www.cocos.com/doc/article/index?type=cocos2d-x&url=/doc/cocos-docs-master/manual/framework/cocos2d-js/catalog/../4-essential-concepts/4-6-director-of-game/zh.md 从官方帮助文档中，我们可以看到，director在cocos中有以下几个作用：\n1. 环境设定：游戏开始前的帧率设置，动作管理器，事件管理器等都由director先加载起来\n2. 控制游戏主循环，游戏的原理，与动画相同，每一个看到的画面都是由director一帧一帧的渲染出来的，而这个渲染的过程就在director的主循环体内，所以循环的暂定与恢复也是由director来实现的\n3. 最后一个，也是director最重要的一个作用，同时也是本节课所讲的内容，就是场景的管理，除了创建，销毁，还有切换，push，pop等操作，这些都由director来完成，scene的整个生命周期都由director来管理。\n### 场景管理API\ndirector中关于场景管理的api有如下几个：\n```javascript\n// run the scene\ncc.director.runScene(scene);\n// get the running scene\nvar scene = cc.director.getRunningScene();\n// push in a new scene and cover the running scene\nvar scene = cc.director.pushScene(scene);\n// pop the top scene and run the second scene\ncc.director.popScene();\n// pop all the scene except the scene in the bottom\ncc.director.popToRootScene()\n```\ndirector对场景的管理是以堆栈的数据结构来管理，简单来说就是现进后出的数据结构，可以比喻成一个羽毛球筒，当你放进去一个一个的羽毛球后，最先放进去的一定在最底下，最后放进去的一定在最上面，这种结构就类似堆栈的数据结构，也就是说，当导演运行一个场景之后，它会被放入堆栈中，当你再push一个新的场景之后，第二个场景就会压入堆栈，放在第一个场景的上面，我们看到得就是场景二，而场景一仍然存在，只是被放在了场景二的下面，当我们做pop，堆栈就会销毁顶端的第一个场景，而它下面的场景就会呈现出来，但这时候并不会做初始操作，因为这是一直被压在下面的场景一，而当我们使用runScene的时候，会先销毁当前的场景，在new出第二个场景，我觉得如果不是有特别需要保留数据的场景，我们可以全部用runScene来管理场景，否则如果自己使用pop/push来管理场景有可能就乱了，忘了哪个销毁了哪个要初始化（个人感觉，仅参考）\n### 作业\n作业中代码，我也加入了一段代码来测试场景在切换的时候是否被销毁，只需要用runScene、pushScene、popScene分别来测试即可，代码如下：\n\n这是启动的第一个菜单场景，相当于各个场景的一个入口场景\n\n```javascript\nvar menuLayer=cc.Layer.extend({\n   ctor:function(){\n       this._super();\n       // add text\n       var tit=new cc.LabelTTF(\"CVP认证\",\"\",60);\n       tit.setPosition(240,300);\n       this.addChild(tit);\n       tit.setTag(1);\n       // add menu\n       // click to add a text,to test if the scene destroyed when director invoke runScene\n       var clickItem = new cc.MenuItemFont(\"添加文字\",this.clickCallback,this);\n       var itemstart=new cc.MenuItemFont(\"开始\",this.startScene,this);\n       itemstart.setPosition(clickItem.getPositionX(),clickItem.getPositionY()-clickItem.height/2-50);\n       var itemhelp=new cc.MenuItemFont(\"帮助\",this.helpScene,this);\n       itemhelp.setPosition(itemstart.getPositionX(),itemstart.getPositionY()-itemstart.height/2-50);\n       var menu=new cc.Menu(itemstart,itemhelp,clickItem);\n       this.addChild(menu);\n   },\n   startScene:function(){\n       cc.director.runScene(new HelloWorldScene());\n   },\n   helpScene:function(){\n       cc.director.runScene(new HelpScene());\n   },\n   clickCallback:function(){\n       // add text\n       var test = new cc.LabelTTF(\"添加的文字\",\"\",50);\n       var tit = this.getChildByTag(1);\n       test.setPosition(tit.getPositionX(),tit.getPositionY()+100);\n       this.addChild(test);\n   }\n});\n// define the menu scene\nvar MenuScene=cc.Scene.extend({\n   ctor:function(){\n       this._super();\n       // define the layer\n       var m1=new menuLayer();\n       this.addChild(m1);\n   }\n});\n```\n\n这是hello场景，其中包含了能返回菜单场景的按钮\n\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function () {\n        this._super();\n        var helloLabel = new cc.LabelTTF(\"Hello World\", \"Arial\", 38);\n        helloLabel.x = size.width / 2;\n        helloLabel.y = size.height / 2 + 200;\n        this.addChild(helloLabel, 5);\n        this.sprite = new cc.Sprite(res.HelloWorld_png);\n        this.sprite.attr({\n            x: size.width / 2,\n            y: size.height / 2\n        });\n        this.addChild(this.sprite, 0);\n        var backItem = new cc.MenuItemFont(\"返回主界面\",this.backCallback,this);\n        var menu = new cc.Menu(backItem);\n        this.addChild(menu);\n        return true;\n    },\n    backCallback:function(){\n        cc.director.runScene(new MenuScene());\n    }\n});\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n这是一个帮助场景，场景中只有一行文本\n\n```javascript\nvar HelpLayer = cc.Layer.extend({\n    ctor:function(){\n        this._super();\n        var text = new cc.LabelTTF(\"游戏帮助场景\",\"\",100);\n        text.setPosition(size.width/2,size.height/2);\n        this.addChild(text);\n        return true;\n    }\n});\n\nvar HelpScene = cc.Scene.extend({\n    ctor:function(){\n        this._super();\n        var helpLayer = new HelpLayer();\n        this.addChild(helpLayer);\n        return true;\n    }\n});\n```\n\n为了不让发帖出现各种bug，我把注释都翻译成英文了，，，也真是拼了，，，哎\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_09/a26fb7aab762fd52abcc8af0d183b8d3322b8117/\n","slug":"CVP认证学习笔记--(何小成)005--实现多场景切换","published":1,"updated":"2016-04-24T15:03:00.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhtp000dwsaz9ct7dof1","content":"<p>上篇帖子我提到了cocos中的导演、场景、图层以及精灵之间的关系。从那张关系图中可以看出，导演在整个游戏中处于一个相当重要的位置，它掌控者全局。</p>\n<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>在cocos的官网中，可以看到官方文档中对于director的一个解释<a id=\"more\"></a>：<a href=\"http://www.cocos.com/doc/article/index?type=cocos2d-x&amp;url=/doc/cocos-docs-master/manual/framework/cocos2d-js/catalog/../4-essential-concepts/4-6-director-of-game/zh.md\">http://www.cocos.com/doc/article/index?type=cocos2d-x&amp;url=/doc/cocos-docs-master/manual/framework/cocos2d-js/catalog/../4-essential-concepts/4-6-director-of-game/zh.md</a> 从官方帮助文档中，我们可以看到，director在cocos中有以下几个作用：</p>\n<ol>\n<li>环境设定：游戏开始前的帧率设置，动作管理器，事件管理器等都由director先加载起来</li>\n<li>控制游戏主循环，游戏的原理，与动画相同，每一个看到的画面都是由director一帧一帧的渲染出来的，而这个渲染的过程就在director的主循环体内，所以循环的暂定与恢复也是由director来实现的</li>\n<li>最后一个，也是director最重要的一个作用，同时也是本节课所讲的内容，就是场景的管理，除了创建，销毁，还有切换，push，pop等操作，这些都由director来完成，scene的整个生命周期都由director来管理。<h3 id=\"场景管理API\"><a href=\"#场景管理API\" class=\"headerlink\" title=\"场景管理API\"></a>场景管理API</h3>director中关于场景管理的api有如下几个：<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// run the scene</span></span><br><span class=\"line\">cc.director.runScene(scene);</span><br><span class=\"line\"><span class=\"comment\">// get the running scene</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> scene = cc.director.getRunningScene();</span><br><span class=\"line\"><span class=\"comment\">// push in a new scene and cover the running scene</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> scene = cc.director.pushScene(scene);</span><br><span class=\"line\"><span class=\"comment\">// pop the top scene and run the second scene</span></span><br><span class=\"line\">cc.director.popScene();</span><br><span class=\"line\"><span class=\"comment\">// pop all the scene except the scene in the bottom</span></span><br><span class=\"line\">cc.director.popToRootScene()</span><br></pre></td></tr></table></figure>\ndirector对场景的管理是以堆栈的数据结构来管理，简单来说就是现进后出的数据结构，可以比喻成一个羽毛球筒，当你放进去一个一个的羽毛球后，最先放进去的一定在最底下，最后放进去的一定在最上面，这种结构就类似堆栈的数据结构，也就是说，当导演运行一个场景之后，它会被放入堆栈中，当你再push一个新的场景之后，第二个场景就会压入堆栈，放在第一个场景的上面，我们看到得就是场景二，而场景一仍然存在，只是被放在了场景二的下面，当我们做pop，堆栈就会销毁顶端的第一个场景，而它下面的场景就会呈现出来，但这时候并不会做初始操作，因为这是一直被压在下面的场景一，而当我们使用runScene的时候，会先销毁当前的场景，在new出第二个场景，我觉得如果不是有特别需要保留数据的场景，我们可以全部用runScene来管理场景，否则如果自己使用pop/push来管理场景有可能就乱了，忘了哪个销毁了哪个要初始化（个人感觉，仅参考）<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3>作业中代码，我也加入了一段代码来测试场景在切换的时候是否被销毁，只需要用runScene、pushScene、popScene分别来测试即可，代码如下：</li>\n</ol>\n<p>这是启动的第一个菜单场景，相当于各个场景的一个入口场景</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> menuLayer=cc.Layer.extend(&#123;</span><br><span class=\"line\">   ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">       <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">       <span class=\"comment\">// add text</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> tit=<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;CVP认证&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">60</span>);</span><br><span class=\"line\">       tit.setPosition(<span class=\"number\">240</span>,<span class=\"number\">300</span>);</span><br><span class=\"line\">       <span class=\"built_in\">this</span>.addChild(tit);</span><br><span class=\"line\">       tit.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">       <span class=\"comment\">// add menu</span></span><br><span class=\"line\">       <span class=\"comment\">// click to add a text,to test if the scene destroyed when director invoke runScene</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> clickItem = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;添加文字&quot;</span>,<span class=\"built_in\">this</span>.clickCallback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">       <span class=\"keyword\">var</span> itemstart=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;开始&quot;</span>,<span class=\"built_in\">this</span>.startScene,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">       itemstart.setPosition(clickItem.getPositionX(),clickItem.getPositionY()-clickItem.height/<span class=\"number\">2</span><span class=\"number\">-50</span>);</span><br><span class=\"line\">       <span class=\"keyword\">var</span> itemhelp=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;帮助&quot;</span>,<span class=\"built_in\">this</span>.helpScene,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">       itemhelp.setPosition(itemstart.getPositionX(),itemstart.getPositionY()-itemstart.height/<span class=\"number\">2</span><span class=\"number\">-50</span>);</span><br><span class=\"line\">       <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(itemstart,itemhelp,clickItem);</span><br><span class=\"line\">       <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">   startScene:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">       cc.director.runScene(<span class=\"keyword\">new</span> HelloWorldScene());</span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">   helpScene:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">       cc.director.runScene(<span class=\"keyword\">new</span> HelpScene());</span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">   clickCallback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">// add text</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> test = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;添加的文字&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>);</span><br><span class=\"line\">       <span class=\"keyword\">var</span> tit = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">       test.setPosition(tit.getPositionX(),tit.getPositionY()+<span class=\"number\">100</span>);</span><br><span class=\"line\">       <span class=\"built_in\">this</span>.addChild(test);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// define the menu scene</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> MenuScene=cc.Scene.extend(&#123;</span><br><span class=\"line\">   ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">       <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">       <span class=\"comment\">// define the layer</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> m1=<span class=\"keyword\">new</span> menuLayer();</span><br><span class=\"line\">       <span class=\"built_in\">this</span>.addChild(m1);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>这是hello场景，其中包含了能返回菜单场景的按钮</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helloLabel = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;Hello World&quot;</span>, <span class=\"string\">&quot;Arial&quot;</span>, <span class=\"number\">38</span>);</span><br><span class=\"line\">        helloLabel.x = size.width / <span class=\"number\">2</span>;</span><br><span class=\"line\">        helloLabel.y = size.height / <span class=\"number\">2</span> + <span class=\"number\">200</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(helloLabel, <span class=\"number\">5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite = <span class=\"keyword\">new</span> cc.Sprite(res.HelloWorld_png);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite.attr(&#123;</span><br><span class=\"line\">            x: size.width / <span class=\"number\">2</span>,</span><br><span class=\"line\">            y: size.height / <span class=\"number\">2</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.sprite, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> backItem = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;返回主界面&quot;</span>,<span class=\"built_in\">this</span>.backCallback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(backItem);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    backCallback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> MenuScene());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>这是一个帮助场景，场景中只有一行文本</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelpLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> text = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;游戏帮助场景&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        text.setPosition(size.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(text);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelpScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helpLayer = <span class=\"keyword\">new</span> HelpLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(helpLayer);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>为了不让发帖出现各种bug，我把注释都翻译成英文了，，，也真是拼了，，，哎</p>\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_09/a26fb7aab762fd52abcc8af0d183b8d3322b8117/\">http://www.cocoscvp.com/usercode/2016_04_09/a26fb7aab762fd52abcc8af0d183b8d3322b8117/</a></p>\n","site":{"data":{}},"excerpt":"<p>上篇帖子我提到了cocos中的导演、场景、图层以及精灵之间的关系。从那张关系图中可以看出，导演在整个游戏中处于一个相当重要的位置，它掌控者全局。</p>\n<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>在cocos的官网中，可以看到官方文档中对于director的一个解释","more":"：<a href=\"http://www.cocos.com/doc/article/index?type=cocos2d-x&amp;url=/doc/cocos-docs-master/manual/framework/cocos2d-js/catalog/../4-essential-concepts/4-6-director-of-game/zh.md\">http://www.cocos.com/doc/article/index?type=cocos2d-x&amp;url=/doc/cocos-docs-master/manual/framework/cocos2d-js/catalog/../4-essential-concepts/4-6-director-of-game/zh.md</a> 从官方帮助文档中，我们可以看到，director在cocos中有以下几个作用：</p>\n<ol>\n<li>环境设定：游戏开始前的帧率设置，动作管理器，事件管理器等都由director先加载起来</li>\n<li>控制游戏主循环，游戏的原理，与动画相同，每一个看到的画面都是由director一帧一帧的渲染出来的，而这个渲染的过程就在director的主循环体内，所以循环的暂定与恢复也是由director来实现的</li>\n<li>最后一个，也是director最重要的一个作用，同时也是本节课所讲的内容，就是场景的管理，除了创建，销毁，还有切换，push，pop等操作，这些都由director来完成，scene的整个生命周期都由director来管理。<h3 id=\"场景管理API\"><a href=\"#场景管理API\" class=\"headerlink\" title=\"场景管理API\"></a>场景管理API</h3>director中关于场景管理的api有如下几个：<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// run the scene</span></span><br><span class=\"line\">cc.director.runScene(scene);</span><br><span class=\"line\"><span class=\"comment\">// get the running scene</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> scene = cc.director.getRunningScene();</span><br><span class=\"line\"><span class=\"comment\">// push in a new scene and cover the running scene</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> scene = cc.director.pushScene(scene);</span><br><span class=\"line\"><span class=\"comment\">// pop the top scene and run the second scene</span></span><br><span class=\"line\">cc.director.popScene();</span><br><span class=\"line\"><span class=\"comment\">// pop all the scene except the scene in the bottom</span></span><br><span class=\"line\">cc.director.popToRootScene()</span><br></pre></td></tr></table></figure>\ndirector对场景的管理是以堆栈的数据结构来管理，简单来说就是现进后出的数据结构，可以比喻成一个羽毛球筒，当你放进去一个一个的羽毛球后，最先放进去的一定在最底下，最后放进去的一定在最上面，这种结构就类似堆栈的数据结构，也就是说，当导演运行一个场景之后，它会被放入堆栈中，当你再push一个新的场景之后，第二个场景就会压入堆栈，放在第一个场景的上面，我们看到得就是场景二，而场景一仍然存在，只是被放在了场景二的下面，当我们做pop，堆栈就会销毁顶端的第一个场景，而它下面的场景就会呈现出来，但这时候并不会做初始操作，因为这是一直被压在下面的场景一，而当我们使用runScene的时候，会先销毁当前的场景，在new出第二个场景，我觉得如果不是有特别需要保留数据的场景，我们可以全部用runScene来管理场景，否则如果自己使用pop/push来管理场景有可能就乱了，忘了哪个销毁了哪个要初始化（个人感觉，仅参考）<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3>作业中代码，我也加入了一段代码来测试场景在切换的时候是否被销毁，只需要用runScene、pushScene、popScene分别来测试即可，代码如下：</li>\n</ol>\n<p>这是启动的第一个菜单场景，相当于各个场景的一个入口场景</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> menuLayer=cc.Layer.extend(&#123;</span><br><span class=\"line\">   ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">       <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">       <span class=\"comment\">// add text</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> tit=<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;CVP认证&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">60</span>);</span><br><span class=\"line\">       tit.setPosition(<span class=\"number\">240</span>,<span class=\"number\">300</span>);</span><br><span class=\"line\">       <span class=\"built_in\">this</span>.addChild(tit);</span><br><span class=\"line\">       tit.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">       <span class=\"comment\">// add menu</span></span><br><span class=\"line\">       <span class=\"comment\">// click to add a text,to test if the scene destroyed when director invoke runScene</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> clickItem = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;添加文字&quot;</span>,<span class=\"built_in\">this</span>.clickCallback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">       <span class=\"keyword\">var</span> itemstart=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;开始&quot;</span>,<span class=\"built_in\">this</span>.startScene,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">       itemstart.setPosition(clickItem.getPositionX(),clickItem.getPositionY()-clickItem.height/<span class=\"number\">2</span><span class=\"number\">-50</span>);</span><br><span class=\"line\">       <span class=\"keyword\">var</span> itemhelp=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;帮助&quot;</span>,<span class=\"built_in\">this</span>.helpScene,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">       itemhelp.setPosition(itemstart.getPositionX(),itemstart.getPositionY()-itemstart.height/<span class=\"number\">2</span><span class=\"number\">-50</span>);</span><br><span class=\"line\">       <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(itemstart,itemhelp,clickItem);</span><br><span class=\"line\">       <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">   startScene:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">       cc.director.runScene(<span class=\"keyword\">new</span> HelloWorldScene());</span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">   helpScene:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">       cc.director.runScene(<span class=\"keyword\">new</span> HelpScene());</span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">   clickCallback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">// add text</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> test = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;添加的文字&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>);</span><br><span class=\"line\">       <span class=\"keyword\">var</span> tit = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">       test.setPosition(tit.getPositionX(),tit.getPositionY()+<span class=\"number\">100</span>);</span><br><span class=\"line\">       <span class=\"built_in\">this</span>.addChild(test);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// define the menu scene</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> MenuScene=cc.Scene.extend(&#123;</span><br><span class=\"line\">   ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">       <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">       <span class=\"comment\">// define the layer</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> m1=<span class=\"keyword\">new</span> menuLayer();</span><br><span class=\"line\">       <span class=\"built_in\">this</span>.addChild(m1);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>这是hello场景，其中包含了能返回菜单场景的按钮</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helloLabel = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;Hello World&quot;</span>, <span class=\"string\">&quot;Arial&quot;</span>, <span class=\"number\">38</span>);</span><br><span class=\"line\">        helloLabel.x = size.width / <span class=\"number\">2</span>;</span><br><span class=\"line\">        helloLabel.y = size.height / <span class=\"number\">2</span> + <span class=\"number\">200</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(helloLabel, <span class=\"number\">5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite = <span class=\"keyword\">new</span> cc.Sprite(res.HelloWorld_png);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite.attr(&#123;</span><br><span class=\"line\">            x: size.width / <span class=\"number\">2</span>,</span><br><span class=\"line\">            y: size.height / <span class=\"number\">2</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.sprite, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> backItem = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;返回主界面&quot;</span>,<span class=\"built_in\">this</span>.backCallback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(backItem);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    backCallback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> MenuScene());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>这是一个帮助场景，场景中只有一行文本</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelpLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> text = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;游戏帮助场景&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        text.setPosition(size.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(text);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelpScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helpLayer = <span class=\"keyword\">new</span> HelpLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(helpLayer);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>为了不让发帖出现各种bug，我把注释都翻译成英文了，，，也真是拼了，，，哎</p>\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_09/a26fb7aab762fd52abcc8af0d183b8d3322b8117/\">http://www.cocoscvp.com/usercode/2016_04_09/a26fb7aab762fd52abcc8af0d183b8d3322b8117/</a></p>"},{"title":"CVP认证学习笔记--(何小成)006--实现场景切换特效","date":"2016-04-15T16:31:00.000Z","_content":"### 概念\n在上节实现了场景切换之后，本节内容就是了解一些场景切换的特效，个人感觉，实际项目中，可能实际用到的特效就那么几个，因为同一款游戏中，为了保持风格一致性，不可能用太多种类的特效，所以特效这块重点还是要了解其使用方法，<!--more-->具体要用的特效可以用的时候再去查。\n正常情况下，我们切换场景使用如下语句：\n```javascript\ncc.director.runScene(newScene);\n```\n### 作业\n如果我们要加上特效，只需要将newScene换成我们需要的特效即可，特效太多了，课程中给出了37种转场特效，我将37个特效全部装到一个数组中，转场的时候随机取一个特效播放，具体代码实现如下：\n```javascript\n//下面再定义一个图层类，\n//原则上每个场景每个图层单独应该保存一个文件，然后在project.json中配置加载\n//本案例为了说明场景跳转，写在 app.js一个文件里面\nvar MyLayer = cc.Layer.extend({\n    ctor: function () {\n        this._super();\n        //添加文字标题\n        var tit = new cc.LabelTTF(\"动画转场特效\", \"\", 60);\n        tit.setPosition(240, 300);\n        this.addChild(tit);\n        tit.setTag(1);\n        //添加菜单\n        // 点击按钮添加文字，来测试runScene的时候，当前场景是否被销毁\n        var clickItem = new cc.MenuItemFont(\"添加文字\", this.clickCallback, this);\n        // 定义按钮精灵\n        var btnnormal = new cc.Sprite(res.btn_a_png);\n        var btnselect = new cc.Sprite(res.btn_b_png);\n        var btndisable = new cc.Sprite(res.btn_a_png);\n        var itemstart = new cc.MenuItemSprite(btnnormal, btnselect,btndisable,this.startScene, this);\n        itemstart.setPosition(clickItem.getPositionX(), clickItem.getPositionY() - clickItem.height / 2 - 50);\n        var itemhelp = new cc.MenuItemFont(\"帮助\", this.helpScene, this);\n        itemhelp.setPosition(itemstart.getPositionX(), itemstart.getPositionY() - itemstart.height / 2 - 50);\n        var menu = new cc.Menu(itemstart, itemhelp, clickItem);\n        this.addChild(menu);\n    },\n    startScene: function () {\n        //运行失败，原因是cocos 3.x以后都只用runScene了\n        //所以我们版本是3.9要用runScene,大功告成\n        cc.director.runScene(getRandomTrasition(3, new HelloWorldScene()));\n    },\n    helpScene: function () {\n        cc.director.runScene(getRandomTrasition(3, new HelpScene()));\n    },\n    clickCallback: function () {\n        // 在最上面添加一行文字，如果从第二场景切换回来不见了，说明打开第二场景的时候第一个场景被销毁，切回来又重新初始化了\n        var test = new cc.LabelTTF(\"添加的文字\", \"\", 50);\n        var tit = this.getChildByTag(1);\n        test.setPosition(tit.getPositionX(), tit.getPositionY() + 100);\n        this.addChild(test);\n    }\n});\n//定义一个场景作为入口场景\nvar MyScene = cc.Scene.extend({\n    ctor: function () {\n        this._super();\n        //定义图层\n        var m1 = new MyLayer();\n        this.addChild(m1);\n    }\n});\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite: null,\n    ctor: function () {\n        this._super();\n        var size = cc.winSize;\n        var helloLabel = new cc.LabelTTF(\"Hello World\", \"Arial\", 38);\n        helloLabel.x = size.width / 2;\n        helloLabel.y = size.height / 2 + 200;\n        this.addChild(helloLabel, 5);\n        this.sprite = new cc.Sprite(res.HelloWorld_png);\n        this.sprite.attr({\n            x: size.width / 2,\n            y: size.height / 2\n        });\n        this.addChild(this.sprite, 0);\n        var backItem = new cc.MenuItemFont(\"返回主界面\", this.backCallback, this);\n        var menu = new cc.Menu(backItem);\n        this.addChild(menu);\n        return true;\n    },\n    backCallback: function () {\n        cc.director.runScene(getRandomTrasition(3, new MyScene()));\n    }\n});\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter: function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\nvar HelpLayer = cc.Layer.extend({\n    ctor: function () {\n        this._super();\n        var size = cc.winSize;\n        var text = new cc.LabelTTF(\"游戏帮助场景\", \"\", 100);\n        text.setPosition(size.width / 2, size.height / 2);\n        this.addChild(text);\n        var backItem = new cc.MenuItemFont(\"返回主界面\", this.backCallback, this);\n        backItem.setPosition(size.width / 2, text.getPositionY() - text.height / 2);\n        var menu = new cc.Menu(backItem);\n        menu.setPosition(0, 0);\n        this.addChild(menu);\n        console.log(menu.getAnchorPoint().x, \",\", menu.getAnchorPoint().y);\n        console.log(menu.getPosition().x, \",\", menu.getPosition().y);\n        return true;\n    },\n    backCallback: function () {\n        cc.director.runScene(getRandomTrasition(3, new MyScene()));\n    }\n});\n\n// 帮助场景\nvar HelpScene = cc.Scene.extend({\n    ctor: function () {\n        this._super();\n        var helpLayer = new HelpLayer();\n        this.addChild(helpLayer);\n        return true;\n    }\n});\n\n// 随机获取转场特效\nvar getRandomTrasition = function (t, s) {\n    var index = Math.round(Math.random() * 36);\n    return arr[index](t, s);\n}\n\n// 本节作业：\n// 本节介绍了\n// 1.图片按钮\n// 2.切换特效\n// 以下有更多的切换特效,试着用这些特效晚上上节课的作业\n\nvar arr = [];\narr.push(function (t, s) {\n    return new cc.TransitionJumpZoom(t, s);\n});\narr.push(function (t, s) {\n    return new cc.TransitionFade(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFade(t, s, cc.color(255, 255, 255));\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFlipX(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFlipX(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFlipY(t, s, cc.TRANSITION_ORIENTATION_UP_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFlipY(t, s, cc.TRANSITION_ORIENTATION_DOWN_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFlipAngular(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFlipAngular(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionZoomFlipX(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionZoomFlipX(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionZoomFlipY(t, s, cc.TRANSITION_ORIENTATION_UP_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionZoomFlipY(t, s, cc.TRANSITION_ORIENTATION_DOWN_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionZoomFlipAngular(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionZoomFlipAngular(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionShrinkGrow(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionRotoZoom(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionMoveInL(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionMoveInR(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionMoveInT(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionMoveInB(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionSlideInL(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionSlideInR(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionSlideInT(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionSlideInB(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionCrossFade(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionProgressRadialCCW(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionProgressRadialCW(t, s);\n});\n\narr.push(function (t, s) {\n    director.setDepthTest(true);\n    return new cc.TransitionPageTurn(t, s, false);\n});\n\narr.push(function (t, s) {\n    director.setDepthTest(true);\n    return new cc.TransitionPageTurn(t, s, true);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFadeTR(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFadeBL(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFadeUp(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFadeDown(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionTurnOffTiles(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionSplitRows(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionSplitCols(t, s);\n});\n```\n\n### 运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_10/3f52acf6a69f1b0fa3c08c35f7eb319a87e08d5f\n","source":"_posts/CVP认证学习笔记--(何小成)006--实现场景切换特效.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)006--实现场景切换特效\ndate: 2016-04-16 00:31\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n在上节实现了场景切换之后，本节内容就是了解一些场景切换的特效，个人感觉，实际项目中，可能实际用到的特效就那么几个，因为同一款游戏中，为了保持风格一致性，不可能用太多种类的特效，所以特效这块重点还是要了解其使用方法，<!--more-->具体要用的特效可以用的时候再去查。\n正常情况下，我们切换场景使用如下语句：\n```javascript\ncc.director.runScene(newScene);\n```\n### 作业\n如果我们要加上特效，只需要将newScene换成我们需要的特效即可，特效太多了，课程中给出了37种转场特效，我将37个特效全部装到一个数组中，转场的时候随机取一个特效播放，具体代码实现如下：\n```javascript\n//下面再定义一个图层类，\n//原则上每个场景每个图层单独应该保存一个文件，然后在project.json中配置加载\n//本案例为了说明场景跳转，写在 app.js一个文件里面\nvar MyLayer = cc.Layer.extend({\n    ctor: function () {\n        this._super();\n        //添加文字标题\n        var tit = new cc.LabelTTF(\"动画转场特效\", \"\", 60);\n        tit.setPosition(240, 300);\n        this.addChild(tit);\n        tit.setTag(1);\n        //添加菜单\n        // 点击按钮添加文字，来测试runScene的时候，当前场景是否被销毁\n        var clickItem = new cc.MenuItemFont(\"添加文字\", this.clickCallback, this);\n        // 定义按钮精灵\n        var btnnormal = new cc.Sprite(res.btn_a_png);\n        var btnselect = new cc.Sprite(res.btn_b_png);\n        var btndisable = new cc.Sprite(res.btn_a_png);\n        var itemstart = new cc.MenuItemSprite(btnnormal, btnselect,btndisable,this.startScene, this);\n        itemstart.setPosition(clickItem.getPositionX(), clickItem.getPositionY() - clickItem.height / 2 - 50);\n        var itemhelp = new cc.MenuItemFont(\"帮助\", this.helpScene, this);\n        itemhelp.setPosition(itemstart.getPositionX(), itemstart.getPositionY() - itemstart.height / 2 - 50);\n        var menu = new cc.Menu(itemstart, itemhelp, clickItem);\n        this.addChild(menu);\n    },\n    startScene: function () {\n        //运行失败，原因是cocos 3.x以后都只用runScene了\n        //所以我们版本是3.9要用runScene,大功告成\n        cc.director.runScene(getRandomTrasition(3, new HelloWorldScene()));\n    },\n    helpScene: function () {\n        cc.director.runScene(getRandomTrasition(3, new HelpScene()));\n    },\n    clickCallback: function () {\n        // 在最上面添加一行文字，如果从第二场景切换回来不见了，说明打开第二场景的时候第一个场景被销毁，切回来又重新初始化了\n        var test = new cc.LabelTTF(\"添加的文字\", \"\", 50);\n        var tit = this.getChildByTag(1);\n        test.setPosition(tit.getPositionX(), tit.getPositionY() + 100);\n        this.addChild(test);\n    }\n});\n//定义一个场景作为入口场景\nvar MyScene = cc.Scene.extend({\n    ctor: function () {\n        this._super();\n        //定义图层\n        var m1 = new MyLayer();\n        this.addChild(m1);\n    }\n});\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite: null,\n    ctor: function () {\n        this._super();\n        var size = cc.winSize;\n        var helloLabel = new cc.LabelTTF(\"Hello World\", \"Arial\", 38);\n        helloLabel.x = size.width / 2;\n        helloLabel.y = size.height / 2 + 200;\n        this.addChild(helloLabel, 5);\n        this.sprite = new cc.Sprite(res.HelloWorld_png);\n        this.sprite.attr({\n            x: size.width / 2,\n            y: size.height / 2\n        });\n        this.addChild(this.sprite, 0);\n        var backItem = new cc.MenuItemFont(\"返回主界面\", this.backCallback, this);\n        var menu = new cc.Menu(backItem);\n        this.addChild(menu);\n        return true;\n    },\n    backCallback: function () {\n        cc.director.runScene(getRandomTrasition(3, new MyScene()));\n    }\n});\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter: function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\nvar HelpLayer = cc.Layer.extend({\n    ctor: function () {\n        this._super();\n        var size = cc.winSize;\n        var text = new cc.LabelTTF(\"游戏帮助场景\", \"\", 100);\n        text.setPosition(size.width / 2, size.height / 2);\n        this.addChild(text);\n        var backItem = new cc.MenuItemFont(\"返回主界面\", this.backCallback, this);\n        backItem.setPosition(size.width / 2, text.getPositionY() - text.height / 2);\n        var menu = new cc.Menu(backItem);\n        menu.setPosition(0, 0);\n        this.addChild(menu);\n        console.log(menu.getAnchorPoint().x, \",\", menu.getAnchorPoint().y);\n        console.log(menu.getPosition().x, \",\", menu.getPosition().y);\n        return true;\n    },\n    backCallback: function () {\n        cc.director.runScene(getRandomTrasition(3, new MyScene()));\n    }\n});\n\n// 帮助场景\nvar HelpScene = cc.Scene.extend({\n    ctor: function () {\n        this._super();\n        var helpLayer = new HelpLayer();\n        this.addChild(helpLayer);\n        return true;\n    }\n});\n\n// 随机获取转场特效\nvar getRandomTrasition = function (t, s) {\n    var index = Math.round(Math.random() * 36);\n    return arr[index](t, s);\n}\n\n// 本节作业：\n// 本节介绍了\n// 1.图片按钮\n// 2.切换特效\n// 以下有更多的切换特效,试着用这些特效晚上上节课的作业\n\nvar arr = [];\narr.push(function (t, s) {\n    return new cc.TransitionJumpZoom(t, s);\n});\narr.push(function (t, s) {\n    return new cc.TransitionFade(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFade(t, s, cc.color(255, 255, 255));\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFlipX(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFlipX(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFlipY(t, s, cc.TRANSITION_ORIENTATION_UP_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFlipY(t, s, cc.TRANSITION_ORIENTATION_DOWN_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFlipAngular(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFlipAngular(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionZoomFlipX(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionZoomFlipX(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionZoomFlipY(t, s, cc.TRANSITION_ORIENTATION_UP_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionZoomFlipY(t, s, cc.TRANSITION_ORIENTATION_DOWN_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionZoomFlipAngular(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionZoomFlipAngular(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionShrinkGrow(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionRotoZoom(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionMoveInL(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionMoveInR(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionMoveInT(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionMoveInB(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionSlideInL(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionSlideInR(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionSlideInT(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionSlideInB(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionCrossFade(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionProgressRadialCCW(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionProgressRadialCW(t, s);\n});\n\narr.push(function (t, s) {\n    director.setDepthTest(true);\n    return new cc.TransitionPageTurn(t, s, false);\n});\n\narr.push(function (t, s) {\n    director.setDepthTest(true);\n    return new cc.TransitionPageTurn(t, s, true);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFadeTR(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFadeBL(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFadeUp(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionFadeDown(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionTurnOffTiles(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionSplitRows(t, s);\n});\n\narr.push(function (t, s) {\n    return new cc.TransitionSplitCols(t, s);\n});\n```\n\n### 运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_10/3f52acf6a69f1b0fa3c08c35f7eb319a87e08d5f\n","slug":"CVP认证学习笔记--(何小成)006--实现场景切换特效","published":1,"updated":"2016-04-24T15:02:48.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhtr000ewsaz9olxah2n","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>在上节实现了场景切换之后，本节内容就是了解一些场景切换的特效，个人感觉，实际项目中，可能实际用到的特效就那么几个，因为同一款游戏中，为了保持风格一致性，不可能用太多种类的特效，所以特效这块重点还是要了解其使用方法，<a id=\"more\"></a>具体要用的特效可以用的时候再去查。<br>正常情况下，我们切换场景使用如下语句：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.director.runScene(newScene);</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>如果我们要加上特效，只需要将newScene换成我们需要的特效即可，特效太多了，课程中给出了37种转场特效，我将37个特效全部装到一个数组中，转场的时候随机取一个特效播放，具体代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//下面再定义一个图层类，</span></span><br><span class=\"line\"><span class=\"comment\">//原则上每个场景每个图层单独应该保存一个文件，然后在project.json中配置加载</span></span><br><span class=\"line\"><span class=\"comment\">//本案例为了说明场景跳转，写在 app.js一个文件里面</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> MyLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//添加文字标题</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> tit = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;动画转场特效&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">60</span>);</span><br><span class=\"line\">        tit.setPosition(<span class=\"number\">240</span>, <span class=\"number\">300</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(tit);</span><br><span class=\"line\">        tit.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加菜单</span></span><br><span class=\"line\">        <span class=\"comment\">// 点击按钮添加文字，来测试runScene的时候，当前场景是否被销毁</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> clickItem = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;添加文字&quot;</span>, <span class=\"built_in\">this</span>.clickCallback, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 定义按钮精灵</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> btnnormal = <span class=\"keyword\">new</span> cc.Sprite(res.btn_a_png);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> btnselect = <span class=\"keyword\">new</span> cc.Sprite(res.btn_b_png);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> btndisable = <span class=\"keyword\">new</span> cc.Sprite(res.btn_a_png);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> itemstart = <span class=\"keyword\">new</span> cc.MenuItemSprite(btnnormal, btnselect,btndisable,<span class=\"built_in\">this</span>.startScene, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        itemstart.setPosition(clickItem.getPositionX(), clickItem.getPositionY() - clickItem.height / <span class=\"number\">2</span> - <span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> itemhelp = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;帮助&quot;</span>, <span class=\"built_in\">this</span>.helpScene, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        itemhelp.setPosition(itemstart.getPositionX(), itemstart.getPositionY() - itemstart.height / <span class=\"number\">2</span> - <span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(itemstart, itemhelp, clickItem);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    startScene: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//运行失败，原因是cocos 3.x以后都只用runScene了</span></span><br><span class=\"line\">        <span class=\"comment\">//所以我们版本是3.9要用runScene,大功告成</span></span><br><span class=\"line\">        cc.director.runScene(getRandomTrasition(<span class=\"number\">3</span>, <span class=\"keyword\">new</span> HelloWorldScene()));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    helpScene: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        cc.director.runScene(getRandomTrasition(<span class=\"number\">3</span>, <span class=\"keyword\">new</span> HelpScene()));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    clickCallback: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 在最上面添加一行文字，如果从第二场景切换回来不见了，说明打开第二场景的时候第一个场景被销毁，切回来又重新初始化了</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> test = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;添加的文字&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> tit = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        test.setPosition(tit.getPositionX(), tit.getPositionY() + <span class=\"number\">100</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(test);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">//定义一个场景作为入口场景</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> MyScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//定义图层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> m1 = <span class=\"keyword\">new</span> MyLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(m1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helloLabel = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;Hello World&quot;</span>, <span class=\"string\">&quot;Arial&quot;</span>, <span class=\"number\">38</span>);</span><br><span class=\"line\">        helloLabel.x = size.width / <span class=\"number\">2</span>;</span><br><span class=\"line\">        helloLabel.y = size.height / <span class=\"number\">2</span> + <span class=\"number\">200</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(helloLabel, <span class=\"number\">5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite = <span class=\"keyword\">new</span> cc.Sprite(res.HelloWorld_png);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite.attr(&#123;</span><br><span class=\"line\">            x: size.width / <span class=\"number\">2</span>,</span><br><span class=\"line\">            y: size.height / <span class=\"number\">2</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.sprite, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> backItem = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;返回主界面&quot;</span>, <span class=\"built_in\">this</span>.backCallback, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(backItem);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    backCallback: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        cc.director.runScene(getRandomTrasition(<span class=\"number\">3</span>, <span class=\"keyword\">new</span> MyScene()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">var</span> HelpLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> text = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;游戏帮助场景&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">        text.setPosition(size.width / <span class=\"number\">2</span>, size.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(text);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> backItem = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;返回主界面&quot;</span>, <span class=\"built_in\">this</span>.backCallback, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        backItem.setPosition(size.width / <span class=\"number\">2</span>, text.getPositionY() - text.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(backItem);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(menu.getAnchorPoint().x, <span class=\"string\">&quot;,&quot;</span>, menu.getAnchorPoint().y);</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(menu.getPosition().x, <span class=\"string\">&quot;,&quot;</span>, menu.getPosition().y);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    backCallback: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        cc.director.runScene(getRandomTrasition(<span class=\"number\">3</span>, <span class=\"keyword\">new</span> MyScene()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 帮助场景</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelpScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helpLayer = <span class=\"keyword\">new</span> HelpLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(helpLayer);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 随机获取转场特效</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getRandomTrasition = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> index = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">36</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr[index](t, s);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 本节作业：</span></span><br><span class=\"line\"><span class=\"comment\">// 本节介绍了</span></span><br><span class=\"line\"><span class=\"comment\">// 1.图片按钮</span></span><br><span class=\"line\"><span class=\"comment\">// 2.切换特效</span></span><br><span class=\"line\"><span class=\"comment\">// 以下有更多的切换特效,试着用这些特效晚上上节课的作业</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [];</span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionJumpZoom(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFade(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFade(t, s, cc.color(<span class=\"number\">255</span>, <span class=\"number\">255</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFlipX(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFlipX(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFlipY(t, s, cc.TRANSITION_ORIENTATION_UP_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFlipY(t, s, cc.TRANSITION_ORIENTATION_DOWN_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFlipAngular(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFlipAngular(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionZoomFlipX(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionZoomFlipX(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionZoomFlipY(t, s, cc.TRANSITION_ORIENTATION_UP_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionZoomFlipY(t, s, cc.TRANSITION_ORIENTATION_DOWN_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionZoomFlipAngular(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionZoomFlipAngular(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionShrinkGrow(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionRotoZoom(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionMoveInL(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionMoveInR(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionMoveInT(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionMoveInB(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionSlideInL(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionSlideInR(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionSlideInT(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionSlideInB(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionCrossFade(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionProgressRadialCCW(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionProgressRadialCW(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    director.setDepthTest(<span class=\"literal\">true</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionPageTurn(t, s, <span class=\"literal\">false</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    director.setDepthTest(<span class=\"literal\">true</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionPageTurn(t, s, <span class=\"literal\">true</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFadeTR(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFadeBL(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFadeUp(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFadeDown(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionTurnOffTiles(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionSplitRows(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionSplitCols(t, s);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_10/3f52acf6a69f1b0fa3c08c35f7eb319a87e08d5f\">http://www.cocoscvp.com/usercode/2016_04_10/3f52acf6a69f1b0fa3c08c35f7eb319a87e08d5f</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>在上节实现了场景切换之后，本节内容就是了解一些场景切换的特效，个人感觉，实际项目中，可能实际用到的特效就那么几个，因为同一款游戏中，为了保持风格一致性，不可能用太多种类的特效，所以特效这块重点还是要了解其使用方法，","more":"具体要用的特效可以用的时候再去查。<br>正常情况下，我们切换场景使用如下语句：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.director.runScene(newScene);</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>如果我们要加上特效，只需要将newScene换成我们需要的特效即可，特效太多了，课程中给出了37种转场特效，我将37个特效全部装到一个数组中，转场的时候随机取一个特效播放，具体代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//下面再定义一个图层类，</span></span><br><span class=\"line\"><span class=\"comment\">//原则上每个场景每个图层单独应该保存一个文件，然后在project.json中配置加载</span></span><br><span class=\"line\"><span class=\"comment\">//本案例为了说明场景跳转，写在 app.js一个文件里面</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> MyLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//添加文字标题</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> tit = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;动画转场特效&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">60</span>);</span><br><span class=\"line\">        tit.setPosition(<span class=\"number\">240</span>, <span class=\"number\">300</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(tit);</span><br><span class=\"line\">        tit.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加菜单</span></span><br><span class=\"line\">        <span class=\"comment\">// 点击按钮添加文字，来测试runScene的时候，当前场景是否被销毁</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> clickItem = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;添加文字&quot;</span>, <span class=\"built_in\">this</span>.clickCallback, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 定义按钮精灵</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> btnnormal = <span class=\"keyword\">new</span> cc.Sprite(res.btn_a_png);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> btnselect = <span class=\"keyword\">new</span> cc.Sprite(res.btn_b_png);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> btndisable = <span class=\"keyword\">new</span> cc.Sprite(res.btn_a_png);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> itemstart = <span class=\"keyword\">new</span> cc.MenuItemSprite(btnnormal, btnselect,btndisable,<span class=\"built_in\">this</span>.startScene, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        itemstart.setPosition(clickItem.getPositionX(), clickItem.getPositionY() - clickItem.height / <span class=\"number\">2</span> - <span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> itemhelp = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;帮助&quot;</span>, <span class=\"built_in\">this</span>.helpScene, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        itemhelp.setPosition(itemstart.getPositionX(), itemstart.getPositionY() - itemstart.height / <span class=\"number\">2</span> - <span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(itemstart, itemhelp, clickItem);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    startScene: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//运行失败，原因是cocos 3.x以后都只用runScene了</span></span><br><span class=\"line\">        <span class=\"comment\">//所以我们版本是3.9要用runScene,大功告成</span></span><br><span class=\"line\">        cc.director.runScene(getRandomTrasition(<span class=\"number\">3</span>, <span class=\"keyword\">new</span> HelloWorldScene()));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    helpScene: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        cc.director.runScene(getRandomTrasition(<span class=\"number\">3</span>, <span class=\"keyword\">new</span> HelpScene()));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    clickCallback: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 在最上面添加一行文字，如果从第二场景切换回来不见了，说明打开第二场景的时候第一个场景被销毁，切回来又重新初始化了</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> test = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;添加的文字&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> tit = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        test.setPosition(tit.getPositionX(), tit.getPositionY() + <span class=\"number\">100</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(test);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">//定义一个场景作为入口场景</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> MyScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//定义图层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> m1 = <span class=\"keyword\">new</span> MyLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(m1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helloLabel = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;Hello World&quot;</span>, <span class=\"string\">&quot;Arial&quot;</span>, <span class=\"number\">38</span>);</span><br><span class=\"line\">        helloLabel.x = size.width / <span class=\"number\">2</span>;</span><br><span class=\"line\">        helloLabel.y = size.height / <span class=\"number\">2</span> + <span class=\"number\">200</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(helloLabel, <span class=\"number\">5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite = <span class=\"keyword\">new</span> cc.Sprite(res.HelloWorld_png);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite.attr(&#123;</span><br><span class=\"line\">            x: size.width / <span class=\"number\">2</span>,</span><br><span class=\"line\">            y: size.height / <span class=\"number\">2</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.sprite, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> backItem = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;返回主界面&quot;</span>, <span class=\"built_in\">this</span>.backCallback, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(backItem);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    backCallback: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        cc.director.runScene(getRandomTrasition(<span class=\"number\">3</span>, <span class=\"keyword\">new</span> MyScene()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">var</span> HelpLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> text = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;游戏帮助场景&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">        text.setPosition(size.width / <span class=\"number\">2</span>, size.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(text);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> backItem = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;返回主界面&quot;</span>, <span class=\"built_in\">this</span>.backCallback, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        backItem.setPosition(size.width / <span class=\"number\">2</span>, text.getPositionY() - text.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(backItem);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(menu.getAnchorPoint().x, <span class=\"string\">&quot;,&quot;</span>, menu.getAnchorPoint().y);</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(menu.getPosition().x, <span class=\"string\">&quot;,&quot;</span>, menu.getPosition().y);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    backCallback: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        cc.director.runScene(getRandomTrasition(<span class=\"number\">3</span>, <span class=\"keyword\">new</span> MyScene()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 帮助场景</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelpScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helpLayer = <span class=\"keyword\">new</span> HelpLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(helpLayer);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 随机获取转场特效</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getRandomTrasition = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> index = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">36</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr[index](t, s);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 本节作业：</span></span><br><span class=\"line\"><span class=\"comment\">// 本节介绍了</span></span><br><span class=\"line\"><span class=\"comment\">// 1.图片按钮</span></span><br><span class=\"line\"><span class=\"comment\">// 2.切换特效</span></span><br><span class=\"line\"><span class=\"comment\">// 以下有更多的切换特效,试着用这些特效晚上上节课的作业</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [];</span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionJumpZoom(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFade(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFade(t, s, cc.color(<span class=\"number\">255</span>, <span class=\"number\">255</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFlipX(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFlipX(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFlipY(t, s, cc.TRANSITION_ORIENTATION_UP_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFlipY(t, s, cc.TRANSITION_ORIENTATION_DOWN_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFlipAngular(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFlipAngular(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionZoomFlipX(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionZoomFlipX(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionZoomFlipY(t, s, cc.TRANSITION_ORIENTATION_UP_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionZoomFlipY(t, s, cc.TRANSITION_ORIENTATION_DOWN_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionZoomFlipAngular(t, s, cc.TRANSITION_ORIENTATION_LEFT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionZoomFlipAngular(t, s, cc.TRANSITION_ORIENTATION_RIGHT_OVER);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionShrinkGrow(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionRotoZoom(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionMoveInL(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionMoveInR(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionMoveInT(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionMoveInB(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionSlideInL(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionSlideInR(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionSlideInT(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionSlideInB(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionCrossFade(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionProgressRadialCCW(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionProgressRadialCW(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    director.setDepthTest(<span class=\"literal\">true</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionPageTurn(t, s, <span class=\"literal\">false</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    director.setDepthTest(<span class=\"literal\">true</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionPageTurn(t, s, <span class=\"literal\">true</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFadeTR(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFadeBL(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFadeUp(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionFadeDown(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionTurnOffTiles(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionSplitRows(t, s);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">arr.push(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">t, s</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> cc.TransitionSplitCols(t, s);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_10/3f52acf6a69f1b0fa3c08c35f7eb319a87e08d5f\">http://www.cocoscvp.com/usercode/2016_04_10/3f52acf6a69f1b0fa3c08c35f7eb319a87e08d5f</a></p>"},{"title":"CVP认证学习笔记--(何小成)007--节点的锚点和坐标","date":"2016-04-17T04:06:00.000Z","_content":"### 概念\n本节内容讲了cocos中一个比较重要的概念——锚点，锚点按照我的理解，就是这个图形的中心点，而图形中所有的控件的位置，都是根据这个锚点位置的偏移量。在Cocos中，图层的锚点是图层的左下角，而Node的锚点，则是在Node的正中心，<!--more-->这也就解释了之前做Menu的时候，很多人遇到的那个问题，把menuItem添加到Menu中位置不正确的原因。也就是说，在Cocos中，一个Node或图层的位置，是根据它的Anchor（锚点）和Position（位置）共同决定的。\n### 作业\n课程内容并不难，重点是要理解锚点和位置的关系，课程作业是要完成一个11：58的时间显示，做完之后我觉得不如就把它做成一个电子钟的，于是网上搜下了cocos中定时任务的使用，应该后面几节就会讲到了，这里就先用下了，每秒刷新画面，形成一个电子钟。电子中的数字显示有两层，底层有一层透明度稍淡一点的，上面那层是深一点颜色的，底层的数字锚点为0.5 0.5，也就是默认的锚点，上面颜色深的锚点是0.7 0.3，也是我一点点试出来的看起来比较舒服的一个位置。通过锚点设置，两层图形形成了一个阴影效果。所有的数字是我用一个二维数组提前设置好的一个时钟显示格式，绘制的时候根据二维数组的标识进行绘制。，具体代码如下：\n```javascript\n/**\n * Created by Henry on 16/4/16.\n */\nvar cellSpace = 3;\nvar rectWidth = 10;\nvar rectHeight = 10;\nvar Layer0201 = cc.Layer.extend({\n    normalColor: cc.color(245, 245, 245, 50),\n    numColor: cc.color(152, 245, 255, 255),\n    numColor2: cc.color(152, 245, 255, 80),\n    initX: 0,\n    ctor: function (num, initX, initY) {\n        this._super();\n        var size = cc.winSize;\n        this.initX = initX;\n        var rects = [];\n        var rectNum = num == -1 ? 4 : 8;\n        // 添加显示时间方块\n        for (var row = 0; row < 8; row++) {\n            rects[row] = [];\n            for (var col = 0; col < rectNum; col++) {\n                rects[row][col] = new cc.LayerColor(this.normalColor, rectWidth, rectHeight);\n                rects[row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + row * (cellSpace + rectHeight));\n                rects[row][col].ignoreAnchorPointForPosition(false);\n                rects[row][col].setAnchorPoint(0.5, 0.5);\n                this.addChild(rects[row][col]);\n            }\n        }\n        // 获取要现实的数字的阵型\n        var numArr = getNum(num);\n        for (var row = 0; row < 8; row++) {\n            for (var col = 0; col < rectNum; col++) {\n                if (numArr[row][col] == 1) {\n                    // 改变数字显示单元格的颜色\n                    rects[7 - row][col] = new cc.LayerColor(this.numColor2, rectWidth, rectHeight);\n                    rects[7 - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (7 - row) * (cellSpace + rectHeight));\n                    rects[7 - row][col].ignoreAnchorPointForPosition(false);\n                    rects[7 - row][col].setAnchorPoint(0.5, 0.5);\n                    this.addChild(rects[7 - row][col]);\n                }\n            }\n        }\n        for (var row = 0; row < 8; row++) {\n            for (var col = 0; col < rectNum; col++) {\n                if (numArr[row][col] == 1) {\n                    // 改变数字显示单元格的颜色\n                    rects[7 - row][col] = new cc.LayerColor(this.numColor, rectWidth, rectHeight);\n                    rects[7 - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (7 - row) * (cellSpace + rectHeight));\n                    rects[7 - row][col].ignoreAnchorPointForPosition(false);\n                    rects[7 - row][col].setAnchorPoint(0.8, 0.2);\n                    this.addChild(rects[7 - row][col]);\n                }\n            }\n        }\n\n        return true;\n    },\n    getPositionX: function () {\n        return this.initX;\n    }\n});\n\nvar Scene0201 = cc.Scene.extend({\n    size: cc.winSize,\n    ctor: function () {\n        this._super();\n        var layer = new cc.Layer();\n        this.addChild(layer);\n        layer.setTag(1);\n        // 每秒刷新\n        this.refresh();\n        this.schedule(this.refresh, 1);\n        this.scheduleUpdate();\n        return true;\n    },\n    refresh: function () {\n        var now = new Date();\n        var hour = now.getHours();\n        var minute = now.getMinutes();\n        var seconds = now.getSeconds();\n        var hour1 = hour.toString().length > 1 ? hour.toString().charAt(0) : 0;\n        var hour2 = hour.toString().length > 1 ? hour.toString().charAt(1) : hour;\n        var minute1 = minute.toString().length > 1 ? minute.toString().charAt(0) : 0;\n        var minute2 = minute.toString().length > 1 ? minute.toString().charAt(1) : minute;\n        var second1 = seconds.toString().length > 1 ? seconds.toString().charAt(0) : 0;\n        var second2 = seconds.toString().length > 1 ? seconds.toString().charAt(1) : seconds;\n        layer = this.getChildByTag(1);\n        layer.removeAllChildren();\n        // 添加4个数字和一个冒号\n        var initX = 20;\n        var initY = this.size.height / 2;\n        var num1 = new Layer0201(Number(hour1), initX, initY);\n        var num2 = new Layer0201(Number(hour2), num1.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        var num3 = new Layer0201(-1, num2.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        var num4 = new Layer0201(Number(minute1), num3.getPositionX() + cellSpace * 3 + rectWidth * 4 + 10, initY);\n        var num5 = new Layer0201(Number(minute2), num4.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        var num6 = new Layer0201(-1, num5.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        var num7 = new Layer0201(Number(second1), num6.getPositionX() + cellSpace * 3 + rectWidth * 4 + 10, initY);\n        var num8 = new Layer0201(Number(second2), num7.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        layer.width = num8.getPositionX() + cellSpace * 7 + rectWidth * 8;\n        layer.height = cellSpace * 7 + rectWidth * 8;\n        layer.setPositionX((this.size.width - layer.width) / 2);\n        layer.addChild(num1);\n        layer.addChild(num2);\n        layer.addChild(num3);\n        layer.addChild(num4);\n        layer.addChild(num5);\n        layer.addChild(num6);\n        layer.addChild(num7);\n        layer.addChild(num8);\n    }\n});\n\n// 本节作业：\n// 锚点也叫对齐点，是Position对齐的坐标，如果0,0则用这个node的左下角对齐position\n// 如果是1,1则用node的右上角对齐\n// 0.5,0.5则用node的中心来对齐\n// 作业：\n// 使用锚点实现 11:58 这个时间的显示，注意要画很多的矩形呦\n// 至于这个时间怎么能变 我们后面讲\n// 两个冒号 也是矩形\n\n// 预先设置好数组的显示,以01区分\nvar getNum = function (num) {\n    switch (num) {\n        case -1:// 冒号\n            return [\n                [0, 0, 0, 0],\n                [0, 0, 0, 0],\n                [0, 1, 1, 0],\n                [0, 1, 1, 0],\n                [0, 0, 0, 0],\n                [0, 1, 1, 0],\n                [0, 1, 1, 0],\n                [0, 0, 0, 0]\n            ];\n        case 0:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 0, 0, 0, 1, 0],\n                [0, 1, 0, 1, 0, 0, 1, 0],\n                [0, 1, 0, 0, 1, 0, 1, 0],\n                [0, 1, 0, 0, 0, 1, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 1:\n            return [\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 1, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 2:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 1, 0, 0],\n                [0, 0, 0, 0, 1, 0, 0, 0],\n                [0, 0, 0, 1, 0, 0, 0, 0],\n                [0, 0, 1, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 1, 1, 1, 1, 0]\n            ];\n        case 3:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 4:\n            return [\n                [0, 0, 0, 0, 1, 0, 1, 0],\n                [0, 0, 0, 1, 0, 0, 1, 0],\n                [0, 0, 1, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 1, 1, 1, 1, 1],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0]\n            ];\n        case 5:\n            return [\n                [0, 1, 1, 1, 1, 1, 1, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0],\n                [0, 1, 1, 1, 1, 1, 0, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 1, 1, 1, 0, 0]\n            ];\n        case 6:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0],\n                [0, 1, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 7:\n            return [\n                [0, 0, 1, 1, 1, 1, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 1, 0, 0],\n                [0, 0, 0, 0, 1, 0, 0, 0],\n                [0, 0, 0, 1, 0, 0, 0, 0],\n                [0, 0, 1, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0]\n            ];\n        case 8:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 9:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n    }\n}\n```\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_16/6858edf544c179b468a707b8c67cb7a96e83540e/\n","source":"_posts/CVP认证学习笔记--(何小成)007--节点的锚点和坐标.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)007--节点的锚点和坐标\ndate: 2016-04-17 12:06\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节内容讲了cocos中一个比较重要的概念——锚点，锚点按照我的理解，就是这个图形的中心点，而图形中所有的控件的位置，都是根据这个锚点位置的偏移量。在Cocos中，图层的锚点是图层的左下角，而Node的锚点，则是在Node的正中心，<!--more-->这也就解释了之前做Menu的时候，很多人遇到的那个问题，把menuItem添加到Menu中位置不正确的原因。也就是说，在Cocos中，一个Node或图层的位置，是根据它的Anchor（锚点）和Position（位置）共同决定的。\n### 作业\n课程内容并不难，重点是要理解锚点和位置的关系，课程作业是要完成一个11：58的时间显示，做完之后我觉得不如就把它做成一个电子钟的，于是网上搜下了cocos中定时任务的使用，应该后面几节就会讲到了，这里就先用下了，每秒刷新画面，形成一个电子钟。电子中的数字显示有两层，底层有一层透明度稍淡一点的，上面那层是深一点颜色的，底层的数字锚点为0.5 0.5，也就是默认的锚点，上面颜色深的锚点是0.7 0.3，也是我一点点试出来的看起来比较舒服的一个位置。通过锚点设置，两层图形形成了一个阴影效果。所有的数字是我用一个二维数组提前设置好的一个时钟显示格式，绘制的时候根据二维数组的标识进行绘制。，具体代码如下：\n```javascript\n/**\n * Created by Henry on 16/4/16.\n */\nvar cellSpace = 3;\nvar rectWidth = 10;\nvar rectHeight = 10;\nvar Layer0201 = cc.Layer.extend({\n    normalColor: cc.color(245, 245, 245, 50),\n    numColor: cc.color(152, 245, 255, 255),\n    numColor2: cc.color(152, 245, 255, 80),\n    initX: 0,\n    ctor: function (num, initX, initY) {\n        this._super();\n        var size = cc.winSize;\n        this.initX = initX;\n        var rects = [];\n        var rectNum = num == -1 ? 4 : 8;\n        // 添加显示时间方块\n        for (var row = 0; row < 8; row++) {\n            rects[row] = [];\n            for (var col = 0; col < rectNum; col++) {\n                rects[row][col] = new cc.LayerColor(this.normalColor, rectWidth, rectHeight);\n                rects[row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + row * (cellSpace + rectHeight));\n                rects[row][col].ignoreAnchorPointForPosition(false);\n                rects[row][col].setAnchorPoint(0.5, 0.5);\n                this.addChild(rects[row][col]);\n            }\n        }\n        // 获取要现实的数字的阵型\n        var numArr = getNum(num);\n        for (var row = 0; row < 8; row++) {\n            for (var col = 0; col < rectNum; col++) {\n                if (numArr[row][col] == 1) {\n                    // 改变数字显示单元格的颜色\n                    rects[7 - row][col] = new cc.LayerColor(this.numColor2, rectWidth, rectHeight);\n                    rects[7 - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (7 - row) * (cellSpace + rectHeight));\n                    rects[7 - row][col].ignoreAnchorPointForPosition(false);\n                    rects[7 - row][col].setAnchorPoint(0.5, 0.5);\n                    this.addChild(rects[7 - row][col]);\n                }\n            }\n        }\n        for (var row = 0; row < 8; row++) {\n            for (var col = 0; col < rectNum; col++) {\n                if (numArr[row][col] == 1) {\n                    // 改变数字显示单元格的颜色\n                    rects[7 - row][col] = new cc.LayerColor(this.numColor, rectWidth, rectHeight);\n                    rects[7 - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (7 - row) * (cellSpace + rectHeight));\n                    rects[7 - row][col].ignoreAnchorPointForPosition(false);\n                    rects[7 - row][col].setAnchorPoint(0.8, 0.2);\n                    this.addChild(rects[7 - row][col]);\n                }\n            }\n        }\n\n        return true;\n    },\n    getPositionX: function () {\n        return this.initX;\n    }\n});\n\nvar Scene0201 = cc.Scene.extend({\n    size: cc.winSize,\n    ctor: function () {\n        this._super();\n        var layer = new cc.Layer();\n        this.addChild(layer);\n        layer.setTag(1);\n        // 每秒刷新\n        this.refresh();\n        this.schedule(this.refresh, 1);\n        this.scheduleUpdate();\n        return true;\n    },\n    refresh: function () {\n        var now = new Date();\n        var hour = now.getHours();\n        var minute = now.getMinutes();\n        var seconds = now.getSeconds();\n        var hour1 = hour.toString().length > 1 ? hour.toString().charAt(0) : 0;\n        var hour2 = hour.toString().length > 1 ? hour.toString().charAt(1) : hour;\n        var minute1 = minute.toString().length > 1 ? minute.toString().charAt(0) : 0;\n        var minute2 = minute.toString().length > 1 ? minute.toString().charAt(1) : minute;\n        var second1 = seconds.toString().length > 1 ? seconds.toString().charAt(0) : 0;\n        var second2 = seconds.toString().length > 1 ? seconds.toString().charAt(1) : seconds;\n        layer = this.getChildByTag(1);\n        layer.removeAllChildren();\n        // 添加4个数字和一个冒号\n        var initX = 20;\n        var initY = this.size.height / 2;\n        var num1 = new Layer0201(Number(hour1), initX, initY);\n        var num2 = new Layer0201(Number(hour2), num1.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        var num3 = new Layer0201(-1, num2.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        var num4 = new Layer0201(Number(minute1), num3.getPositionX() + cellSpace * 3 + rectWidth * 4 + 10, initY);\n        var num5 = new Layer0201(Number(minute2), num4.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        var num6 = new Layer0201(-1, num5.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        var num7 = new Layer0201(Number(second1), num6.getPositionX() + cellSpace * 3 + rectWidth * 4 + 10, initY);\n        var num8 = new Layer0201(Number(second2), num7.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        layer.width = num8.getPositionX() + cellSpace * 7 + rectWidth * 8;\n        layer.height = cellSpace * 7 + rectWidth * 8;\n        layer.setPositionX((this.size.width - layer.width) / 2);\n        layer.addChild(num1);\n        layer.addChild(num2);\n        layer.addChild(num3);\n        layer.addChild(num4);\n        layer.addChild(num5);\n        layer.addChild(num6);\n        layer.addChild(num7);\n        layer.addChild(num8);\n    }\n});\n\n// 本节作业：\n// 锚点也叫对齐点，是Position对齐的坐标，如果0,0则用这个node的左下角对齐position\n// 如果是1,1则用node的右上角对齐\n// 0.5,0.5则用node的中心来对齐\n// 作业：\n// 使用锚点实现 11:58 这个时间的显示，注意要画很多的矩形呦\n// 至于这个时间怎么能变 我们后面讲\n// 两个冒号 也是矩形\n\n// 预先设置好数组的显示,以01区分\nvar getNum = function (num) {\n    switch (num) {\n        case -1:// 冒号\n            return [\n                [0, 0, 0, 0],\n                [0, 0, 0, 0],\n                [0, 1, 1, 0],\n                [0, 1, 1, 0],\n                [0, 0, 0, 0],\n                [0, 1, 1, 0],\n                [0, 1, 1, 0],\n                [0, 0, 0, 0]\n            ];\n        case 0:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 0, 0, 0, 1, 0],\n                [0, 1, 0, 1, 0, 0, 1, 0],\n                [0, 1, 0, 0, 1, 0, 1, 0],\n                [0, 1, 0, 0, 0, 1, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 1:\n            return [\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 1, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 2:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 1, 0, 0],\n                [0, 0, 0, 0, 1, 0, 0, 0],\n                [0, 0, 0, 1, 0, 0, 0, 0],\n                [0, 0, 1, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 1, 1, 1, 1, 0]\n            ];\n        case 3:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 4:\n            return [\n                [0, 0, 0, 0, 1, 0, 1, 0],\n                [0, 0, 0, 1, 0, 0, 1, 0],\n                [0, 0, 1, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 1, 1, 1, 1, 1],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0]\n            ];\n        case 5:\n            return [\n                [0, 1, 1, 1, 1, 1, 1, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0],\n                [0, 1, 1, 1, 1, 1, 0, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 1, 1, 1, 0, 0]\n            ];\n        case 6:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0],\n                [0, 1, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 7:\n            return [\n                [0, 0, 1, 1, 1, 1, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 1, 0, 0],\n                [0, 0, 0, 0, 1, 0, 0, 0],\n                [0, 0, 0, 1, 0, 0, 0, 0],\n                [0, 0, 1, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0]\n            ];\n        case 8:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 9:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n    }\n}\n```\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_16/6858edf544c179b468a707b8c67cb7a96e83540e/\n","slug":"CVP认证学习笔记--(何小成)007--节点的锚点和坐标","published":1,"updated":"2016-04-24T15:02:34.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhtu000iwsazb7i30ojc","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节内容讲了cocos中一个比较重要的概念——锚点，锚点按照我的理解，就是这个图形的中心点，而图形中所有的控件的位置，都是根据这个锚点位置的偏移量。在Cocos中，图层的锚点是图层的左下角，而Node的锚点，则是在Node的正中心，<a id=\"more\"></a>这也就解释了之前做Menu的时候，很多人遇到的那个问题，把menuItem添加到Menu中位置不正确的原因。也就是说，在Cocos中，一个Node或图层的位置，是根据它的Anchor（锚点）和Position（位置）共同决定的。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>课程内容并不难，重点是要理解锚点和位置的关系，课程作业是要完成一个11：58的时间显示，做完之后我觉得不如就把它做成一个电子钟的，于是网上搜下了cocos中定时任务的使用，应该后面几节就会讲到了，这里就先用下了，每秒刷新画面，形成一个电子钟。电子中的数字显示有两层，底层有一层透明度稍淡一点的，上面那层是深一点颜色的，底层的数字锚点为0.5 0.5，也就是默认的锚点，上面颜色深的锚点是0.7 0.3，也是我一点点试出来的看起来比较舒服的一个位置。通过锚点设置，两层图形形成了一个阴影效果。所有的数字是我用一个二维数组提前设置好的一个时钟显示格式，绘制的时候根据二维数组的标识进行绘制。，具体代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/4/16.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> cellSpace = <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> rectWidth = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> rectHeight = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> Layer0201 = cc.Layer.extend(&#123;</span><br><span class=\"line\">    normalColor: cc.color(<span class=\"number\">245</span>, <span class=\"number\">245</span>, <span class=\"number\">245</span>, <span class=\"number\">50</span>),</span><br><span class=\"line\">    numColor: cc.color(<span class=\"number\">152</span>, <span class=\"number\">245</span>, <span class=\"number\">255</span>, <span class=\"number\">255</span>),</span><br><span class=\"line\">    numColor2: cc.color(<span class=\"number\">152</span>, <span class=\"number\">245</span>, <span class=\"number\">255</span>, <span class=\"number\">80</span>),</span><br><span class=\"line\">    initX: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num, initX, initY</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.initX = initX;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rects = [];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rectNum = num == <span class=\"number\">-1</span> ? <span class=\"number\">4</span> : <span class=\"number\">8</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 添加显示时间方块</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">8</span>; row++) &#123;</span><br><span class=\"line\">            rects[row] = [];</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; rectNum; col++) &#123;</span><br><span class=\"line\">                rects[row][col] = <span class=\"keyword\">new</span> cc.LayerColor(<span class=\"built_in\">this</span>.normalColor, rectWidth, rectHeight);</span><br><span class=\"line\">                rects[row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + row * (cellSpace + rectHeight));</span><br><span class=\"line\">                rects[row][col].ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                rects[row][col].setAnchorPoint(<span class=\"number\">0.5</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.addChild(rects[row][col]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 获取要现实的数字的阵型</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> numArr = getNum(num);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">8</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; rectNum; col++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (numArr[row][col] == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 改变数字显示单元格的颜色</span></span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col] = <span class=\"keyword\">new</span> cc.LayerColor(<span class=\"built_in\">this</span>.numColor2, rectWidth, rectHeight);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (<span class=\"number\">7</span> - row) * (cellSpace + rectHeight));</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setAnchorPoint(<span class=\"number\">0.5</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.addChild(rects[<span class=\"number\">7</span> - row][col]);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">8</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; rectNum; col++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (numArr[row][col] == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 改变数字显示单元格的颜色</span></span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col] = <span class=\"keyword\">new</span> cc.LayerColor(<span class=\"built_in\">this</span>.numColor, rectWidth, rectHeight);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (<span class=\"number\">7</span> - row) * (cellSpace + rectHeight));</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setAnchorPoint(<span class=\"number\">0.8</span>, <span class=\"number\">0.2</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.addChild(rects[<span class=\"number\">7</span> - row][col]);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    getPositionX: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.initX;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Scene0201 = cc.Scene.extend(&#123;</span><br><span class=\"line\">    size: cc.winSize,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> cc.Layer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">        layer.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 每秒刷新</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.refresh();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.refresh, <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scheduleUpdate();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    refresh: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> now = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hour = now.getHours();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minute = now.getMinutes();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> seconds = now.getSeconds();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hour1 = hour.toString().length &gt; <span class=\"number\">1</span> ? hour.toString().charAt(<span class=\"number\">0</span>) : <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hour2 = hour.toString().length &gt; <span class=\"number\">1</span> ? hour.toString().charAt(<span class=\"number\">1</span>) : hour;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minute1 = minute.toString().length &gt; <span class=\"number\">1</span> ? minute.toString().charAt(<span class=\"number\">0</span>) : <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minute2 = minute.toString().length &gt; <span class=\"number\">1</span> ? minute.toString().charAt(<span class=\"number\">1</span>) : minute;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> second1 = seconds.toString().length &gt; <span class=\"number\">1</span> ? seconds.toString().charAt(<span class=\"number\">0</span>) : <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> second2 = seconds.toString().length &gt; <span class=\"number\">1</span> ? seconds.toString().charAt(<span class=\"number\">1</span>) : seconds;</span><br><span class=\"line\">        layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        layer.removeAllChildren();</span><br><span class=\"line\">        <span class=\"comment\">// 添加4个数字和一个冒号</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> initX = <span class=\"number\">20</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> initY = <span class=\"built_in\">this</span>.size.height / <span class=\"number\">2</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num1 = <span class=\"keyword\">new</span> Layer0201(<span class=\"built_in\">Number</span>(hour1), initX, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num2 = <span class=\"keyword\">new</span> Layer0201(<span class=\"built_in\">Number</span>(hour2), num1.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num3 = <span class=\"keyword\">new</span> Layer0201(<span class=\"number\">-1</span>, num2.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num4 = <span class=\"keyword\">new</span> Layer0201(<span class=\"built_in\">Number</span>(minute1), num3.getPositionX() + cellSpace * <span class=\"number\">3</span> + rectWidth * <span class=\"number\">4</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num5 = <span class=\"keyword\">new</span> Layer0201(<span class=\"built_in\">Number</span>(minute2), num4.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num6 = <span class=\"keyword\">new</span> Layer0201(<span class=\"number\">-1</span>, num5.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num7 = <span class=\"keyword\">new</span> Layer0201(<span class=\"built_in\">Number</span>(second1), num6.getPositionX() + cellSpace * <span class=\"number\">3</span> + rectWidth * <span class=\"number\">4</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num8 = <span class=\"keyword\">new</span> Layer0201(<span class=\"built_in\">Number</span>(second2), num7.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        layer.width = num8.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        layer.height = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        layer.setPositionX((<span class=\"built_in\">this</span>.size.width - layer.width) / <span class=\"number\">2</span>);</span><br><span class=\"line\">        layer.addChild(num1);</span><br><span class=\"line\">        layer.addChild(num2);</span><br><span class=\"line\">        layer.addChild(num3);</span><br><span class=\"line\">        layer.addChild(num4);</span><br><span class=\"line\">        layer.addChild(num5);</span><br><span class=\"line\">        layer.addChild(num6);</span><br><span class=\"line\">        layer.addChild(num7);</span><br><span class=\"line\">        layer.addChild(num8);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 本节作业：</span></span><br><span class=\"line\"><span class=\"comment\">// 锚点也叫对齐点，是Position对齐的坐标，如果0,0则用这个node的左下角对齐position</span></span><br><span class=\"line\"><span class=\"comment\">// 如果是1,1则用node的右上角对齐</span></span><br><span class=\"line\"><span class=\"comment\">// 0.5,0.5则用node的中心来对齐</span></span><br><span class=\"line\"><span class=\"comment\">// 作业：</span></span><br><span class=\"line\"><span class=\"comment\">// 使用锚点实现 11:58 这个时间的显示，注意要画很多的矩形呦</span></span><br><span class=\"line\"><span class=\"comment\">// 至于这个时间怎么能变 我们后面讲</span></span><br><span class=\"line\"><span class=\"comment\">// 两个冒号 也是矩形</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 预先设置好数组的显示,以01区分</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getNum = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (num) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">-1</span>:<span class=\"comment\">// 冒号</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">9</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_16/6858edf544c179b468a707b8c67cb7a96e83540e/\">http://www.cocoscvp.com/usercode/2016_04_16/6858edf544c179b468a707b8c67cb7a96e83540e/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节内容讲了cocos中一个比较重要的概念——锚点，锚点按照我的理解，就是这个图形的中心点，而图形中所有的控件的位置，都是根据这个锚点位置的偏移量。在Cocos中，图层的锚点是图层的左下角，而Node的锚点，则是在Node的正中心，","more":"这也就解释了之前做Menu的时候，很多人遇到的那个问题，把menuItem添加到Menu中位置不正确的原因。也就是说，在Cocos中，一个Node或图层的位置，是根据它的Anchor（锚点）和Position（位置）共同决定的。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>课程内容并不难，重点是要理解锚点和位置的关系，课程作业是要完成一个11：58的时间显示，做完之后我觉得不如就把它做成一个电子钟的，于是网上搜下了cocos中定时任务的使用，应该后面几节就会讲到了，这里就先用下了，每秒刷新画面，形成一个电子钟。电子中的数字显示有两层，底层有一层透明度稍淡一点的，上面那层是深一点颜色的，底层的数字锚点为0.5 0.5，也就是默认的锚点，上面颜色深的锚点是0.7 0.3，也是我一点点试出来的看起来比较舒服的一个位置。通过锚点设置，两层图形形成了一个阴影效果。所有的数字是我用一个二维数组提前设置好的一个时钟显示格式，绘制的时候根据二维数组的标识进行绘制。，具体代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/4/16.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> cellSpace = <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> rectWidth = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> rectHeight = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> Layer0201 = cc.Layer.extend(&#123;</span><br><span class=\"line\">    normalColor: cc.color(<span class=\"number\">245</span>, <span class=\"number\">245</span>, <span class=\"number\">245</span>, <span class=\"number\">50</span>),</span><br><span class=\"line\">    numColor: cc.color(<span class=\"number\">152</span>, <span class=\"number\">245</span>, <span class=\"number\">255</span>, <span class=\"number\">255</span>),</span><br><span class=\"line\">    numColor2: cc.color(<span class=\"number\">152</span>, <span class=\"number\">245</span>, <span class=\"number\">255</span>, <span class=\"number\">80</span>),</span><br><span class=\"line\">    initX: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num, initX, initY</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.initX = initX;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rects = [];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rectNum = num == <span class=\"number\">-1</span> ? <span class=\"number\">4</span> : <span class=\"number\">8</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 添加显示时间方块</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">8</span>; row++) &#123;</span><br><span class=\"line\">            rects[row] = [];</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; rectNum; col++) &#123;</span><br><span class=\"line\">                rects[row][col] = <span class=\"keyword\">new</span> cc.LayerColor(<span class=\"built_in\">this</span>.normalColor, rectWidth, rectHeight);</span><br><span class=\"line\">                rects[row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + row * (cellSpace + rectHeight));</span><br><span class=\"line\">                rects[row][col].ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                rects[row][col].setAnchorPoint(<span class=\"number\">0.5</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.addChild(rects[row][col]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 获取要现实的数字的阵型</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> numArr = getNum(num);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">8</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; rectNum; col++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (numArr[row][col] == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 改变数字显示单元格的颜色</span></span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col] = <span class=\"keyword\">new</span> cc.LayerColor(<span class=\"built_in\">this</span>.numColor2, rectWidth, rectHeight);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (<span class=\"number\">7</span> - row) * (cellSpace + rectHeight));</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setAnchorPoint(<span class=\"number\">0.5</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.addChild(rects[<span class=\"number\">7</span> - row][col]);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">8</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; rectNum; col++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (numArr[row][col] == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 改变数字显示单元格的颜色</span></span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col] = <span class=\"keyword\">new</span> cc.LayerColor(<span class=\"built_in\">this</span>.numColor, rectWidth, rectHeight);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (<span class=\"number\">7</span> - row) * (cellSpace + rectHeight));</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setAnchorPoint(<span class=\"number\">0.8</span>, <span class=\"number\">0.2</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.addChild(rects[<span class=\"number\">7</span> - row][col]);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    getPositionX: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.initX;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Scene0201 = cc.Scene.extend(&#123;</span><br><span class=\"line\">    size: cc.winSize,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> cc.Layer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">        layer.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 每秒刷新</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.refresh();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.refresh, <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scheduleUpdate();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    refresh: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> now = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hour = now.getHours();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minute = now.getMinutes();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> seconds = now.getSeconds();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hour1 = hour.toString().length &gt; <span class=\"number\">1</span> ? hour.toString().charAt(<span class=\"number\">0</span>) : <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hour2 = hour.toString().length &gt; <span class=\"number\">1</span> ? hour.toString().charAt(<span class=\"number\">1</span>) : hour;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minute1 = minute.toString().length &gt; <span class=\"number\">1</span> ? minute.toString().charAt(<span class=\"number\">0</span>) : <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minute2 = minute.toString().length &gt; <span class=\"number\">1</span> ? minute.toString().charAt(<span class=\"number\">1</span>) : minute;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> second1 = seconds.toString().length &gt; <span class=\"number\">1</span> ? seconds.toString().charAt(<span class=\"number\">0</span>) : <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> second2 = seconds.toString().length &gt; <span class=\"number\">1</span> ? seconds.toString().charAt(<span class=\"number\">1</span>) : seconds;</span><br><span class=\"line\">        layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        layer.removeAllChildren();</span><br><span class=\"line\">        <span class=\"comment\">// 添加4个数字和一个冒号</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> initX = <span class=\"number\">20</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> initY = <span class=\"built_in\">this</span>.size.height / <span class=\"number\">2</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num1 = <span class=\"keyword\">new</span> Layer0201(<span class=\"built_in\">Number</span>(hour1), initX, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num2 = <span class=\"keyword\">new</span> Layer0201(<span class=\"built_in\">Number</span>(hour2), num1.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num3 = <span class=\"keyword\">new</span> Layer0201(<span class=\"number\">-1</span>, num2.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num4 = <span class=\"keyword\">new</span> Layer0201(<span class=\"built_in\">Number</span>(minute1), num3.getPositionX() + cellSpace * <span class=\"number\">3</span> + rectWidth * <span class=\"number\">4</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num5 = <span class=\"keyword\">new</span> Layer0201(<span class=\"built_in\">Number</span>(minute2), num4.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num6 = <span class=\"keyword\">new</span> Layer0201(<span class=\"number\">-1</span>, num5.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num7 = <span class=\"keyword\">new</span> Layer0201(<span class=\"built_in\">Number</span>(second1), num6.getPositionX() + cellSpace * <span class=\"number\">3</span> + rectWidth * <span class=\"number\">4</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num8 = <span class=\"keyword\">new</span> Layer0201(<span class=\"built_in\">Number</span>(second2), num7.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        layer.width = num8.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        layer.height = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        layer.setPositionX((<span class=\"built_in\">this</span>.size.width - layer.width) / <span class=\"number\">2</span>);</span><br><span class=\"line\">        layer.addChild(num1);</span><br><span class=\"line\">        layer.addChild(num2);</span><br><span class=\"line\">        layer.addChild(num3);</span><br><span class=\"line\">        layer.addChild(num4);</span><br><span class=\"line\">        layer.addChild(num5);</span><br><span class=\"line\">        layer.addChild(num6);</span><br><span class=\"line\">        layer.addChild(num7);</span><br><span class=\"line\">        layer.addChild(num8);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 本节作业：</span></span><br><span class=\"line\"><span class=\"comment\">// 锚点也叫对齐点，是Position对齐的坐标，如果0,0则用这个node的左下角对齐position</span></span><br><span class=\"line\"><span class=\"comment\">// 如果是1,1则用node的右上角对齐</span></span><br><span class=\"line\"><span class=\"comment\">// 0.5,0.5则用node的中心来对齐</span></span><br><span class=\"line\"><span class=\"comment\">// 作业：</span></span><br><span class=\"line\"><span class=\"comment\">// 使用锚点实现 11:58 这个时间的显示，注意要画很多的矩形呦</span></span><br><span class=\"line\"><span class=\"comment\">// 至于这个时间怎么能变 我们后面讲</span></span><br><span class=\"line\"><span class=\"comment\">// 两个冒号 也是矩形</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 预先设置好数组的显示,以01区分</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getNum = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (num) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">-1</span>:<span class=\"comment\">// 冒号</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">9</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_16/6858edf544c179b468a707b8c67cb7a96e83540e/\">http://www.cocoscvp.com/usercode/2016_04_16/6858edf544c179b468a707b8c67cb7a96e83540e/</a></p>"},{"title":"CVP认证学习笔记--(何小成)010--节点的计划任务","date":"2016-04-18T15:11:00.000Z","_content":"### 作业\n本节内容讲解节点的计划任务，计划任务在游戏中或许是在常见不过的内容了，我们之所以能看到游戏画面中各种精灵的跳动、图层的移动等，都要归功于节点的计划任务，比如蓝天背景中的白云在飘，偶尔还飞过一只小鸟，比如天上偶尔掉下一块金子<!--more-->（当然现实中不会有这种好事。。。），这一切游戏中活物，都是节点的计划任务的功劳，想象下，如果没有计划任务，那么游戏世界一片死寂。\n### API\n废话不多说，直接了解节点计划任务的API，虽然课程中只讲了两个API，schedule和unschedule，但搜索cocosjs的文档后，可以了解，其实他还有其他强大的用法，总结一下计划任务的API如下：\n```javascript\nvar node = new cc.Node();\n// node的update函数将会在每一帧被执行\nnode.scheduleUpdate();\n// callback回调函数会重复得在每个interval时间间隔之后被执行，重复次数为repeat次，并且这个任务会在delay延时之后开始执行\nnode.schedule(callback, interval, repeat, delay);\n// callback回调函数会在delay延时之后被执行一次\nnode.scheduleOnce(callback, delay);\n// 取消callback任务\nnode.unschedule(callback);\n// 取消node节点所有计划中的任务\nnode.unscheduleAllCallbacks();\n```\n### 作业\n不同游戏的不同需求，不同应用场景，可以灵活使用计划任务，让游戏活起来。课后的作业是使用节点的计划任务让节点不断的自我旋转，其代码如下：\n```javascript\n        // 添加要执行节点任务的节点\n        var logo=new cc.Sprite(res.HelloWorld_png);\n        this.addChild(logo);\n        logo.setTag(111);\n        logo.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        //每个节点node都可以绑定一些处理逻辑，在每一帧都会被调用\n        var itemstart=new cc.MenuItemFont(\"启动\",this.start,this);\n        var itemstop=new cc.MenuItemFont(\"停止\",this.stop,this);\n        itemstop.setPositionY(50);\n        var menu=new cc.Menu(itemstart,itemstop);\n        menu.setAnchorPoint(0,0);\n        menu.setPosition(100,100);\n        this.addChild(menu);\n        \n        // 节点任务的回调函数\n        // 开始节点任务\n        start:function(){\n            //启动计划任务\n            this.schedule(this.update);\n        },\n        // 停止节点任务\n        stop:function(){\n            this.unschedule(this.update);\n        },\n        // 更新回调函数\n        update:function(){\n            var nowlogo=this.getChildByTag(111);\n            nowlogo.setRotation(nowlogo.getRotation()+5);\n        }\n```\n\n### 最终运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_18/ac5da37fd647d075cb9c4e67062a368cc469a636/\n","source":"_posts/CVP认证学习笔记--(何小成)010--节点的计划任务.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)010--节点的计划任务\ndate: 2016-04-18 23:11\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 作业\n本节内容讲解节点的计划任务，计划任务在游戏中或许是在常见不过的内容了，我们之所以能看到游戏画面中各种精灵的跳动、图层的移动等，都要归功于节点的计划任务，比如蓝天背景中的白云在飘，偶尔还飞过一只小鸟，比如天上偶尔掉下一块金子<!--more-->（当然现实中不会有这种好事。。。），这一切游戏中活物，都是节点的计划任务的功劳，想象下，如果没有计划任务，那么游戏世界一片死寂。\n### API\n废话不多说，直接了解节点计划任务的API，虽然课程中只讲了两个API，schedule和unschedule，但搜索cocosjs的文档后，可以了解，其实他还有其他强大的用法，总结一下计划任务的API如下：\n```javascript\nvar node = new cc.Node();\n// node的update函数将会在每一帧被执行\nnode.scheduleUpdate();\n// callback回调函数会重复得在每个interval时间间隔之后被执行，重复次数为repeat次，并且这个任务会在delay延时之后开始执行\nnode.schedule(callback, interval, repeat, delay);\n// callback回调函数会在delay延时之后被执行一次\nnode.scheduleOnce(callback, delay);\n// 取消callback任务\nnode.unschedule(callback);\n// 取消node节点所有计划中的任务\nnode.unscheduleAllCallbacks();\n```\n### 作业\n不同游戏的不同需求，不同应用场景，可以灵活使用计划任务，让游戏活起来。课后的作业是使用节点的计划任务让节点不断的自我旋转，其代码如下：\n```javascript\n        // 添加要执行节点任务的节点\n        var logo=new cc.Sprite(res.HelloWorld_png);\n        this.addChild(logo);\n        logo.setTag(111);\n        logo.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        //每个节点node都可以绑定一些处理逻辑，在每一帧都会被调用\n        var itemstart=new cc.MenuItemFont(\"启动\",this.start,this);\n        var itemstop=new cc.MenuItemFont(\"停止\",this.stop,this);\n        itemstop.setPositionY(50);\n        var menu=new cc.Menu(itemstart,itemstop);\n        menu.setAnchorPoint(0,0);\n        menu.setPosition(100,100);\n        this.addChild(menu);\n        \n        // 节点任务的回调函数\n        // 开始节点任务\n        start:function(){\n            //启动计划任务\n            this.schedule(this.update);\n        },\n        // 停止节点任务\n        stop:function(){\n            this.unschedule(this.update);\n        },\n        // 更新回调函数\n        update:function(){\n            var nowlogo=this.getChildByTag(111);\n            nowlogo.setRotation(nowlogo.getRotation()+5);\n        }\n```\n\n### 最终运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_18/ac5da37fd647d075cb9c4e67062a368cc469a636/\n","slug":"CVP认证学习笔记--(何小成)010--节点的计划任务","published":1,"updated":"2016-04-24T15:02:02.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhtw000jwsaz9jol2cpu","content":"<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节内容讲解节点的计划任务，计划任务在游戏中或许是在常见不过的内容了，我们之所以能看到游戏画面中各种精灵的跳动、图层的移动等，都要归功于节点的计划任务，比如蓝天背景中的白云在飘，偶尔还飞过一只小鸟，比如天上偶尔掉下一块金子<a id=\"more\"></a>（当然现实中不会有这种好事。。。），这一切游戏中活物，都是节点的计划任务的功劳，想象下，如果没有计划任务，那么游戏世界一片死寂。</p>\n<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>废话不多说，直接了解节点计划任务的API，虽然课程中只讲了两个API，schedule和unschedule，但搜索cocosjs的文档后，可以了解，其实他还有其他强大的用法，总结一下计划任务的API如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> node = <span class=\"keyword\">new</span> cc.Node();</span><br><span class=\"line\"><span class=\"comment\">// node的update函数将会在每一帧被执行</span></span><br><span class=\"line\">node.scheduleUpdate();</span><br><span class=\"line\"><span class=\"comment\">// callback回调函数会重复得在每个interval时间间隔之后被执行，重复次数为repeat次，并且这个任务会在delay延时之后开始执行</span></span><br><span class=\"line\">node.schedule(callback, interval, repeat, delay);</span><br><span class=\"line\"><span class=\"comment\">// callback回调函数会在delay延时之后被执行一次</span></span><br><span class=\"line\">node.scheduleOnce(callback, delay);</span><br><span class=\"line\"><span class=\"comment\">// 取消callback任务</span></span><br><span class=\"line\">node.unschedule(callback);</span><br><span class=\"line\"><span class=\"comment\">// 取消node节点所有计划中的任务</span></span><br><span class=\"line\">node.unscheduleAllCallbacks();</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业-1\"><a href=\"#作业-1\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>不同游戏的不同需求，不同应用场景，可以灵活使用计划任务，让游戏活起来。课后的作业是使用节点的计划任务让节点不断的自我旋转，其代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        <span class=\"comment\">// 添加要执行节点任务的节点</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> logo=<span class=\"keyword\">new</span> cc.Sprite(res.HelloWorld_png);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(logo);</span><br><span class=\"line\">        logo.setTag(<span class=\"number\">111</span>);</span><br><span class=\"line\">        logo.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">//每个节点node都可以绑定一些处理逻辑，在每一帧都会被调用</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> itemstart=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;启动&quot;</span>,<span class=\"built_in\">this</span>.start,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> itemstop=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;停止&quot;</span>,<span class=\"built_in\">this</span>.stop,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        itemstop.setPositionY(<span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(itemstart,itemstop);</span><br><span class=\"line\">        menu.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">100</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 节点任务的回调函数</span></span><br><span class=\"line\">        <span class=\"comment\">// 开始节点任务</span></span><br><span class=\"line\">        start:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//启动计划任务</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.update);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"comment\">// 停止节点任务</span></span><br><span class=\"line\">        stop:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.update);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"comment\">// 更新回调函数</span></span><br><span class=\"line\">        update:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> nowlogo=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">111</span>);</span><br><span class=\"line\">            nowlogo.setRotation(nowlogo.getRotation()+<span class=\"number\">5</span>);</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终运行效果\"><a href=\"#最终运行效果\" class=\"headerlink\" title=\"最终运行效果\"></a>最终运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_18/ac5da37fd647d075cb9c4e67062a368cc469a636/\">http://www.cocoscvp.com/usercode/2016_04_18/ac5da37fd647d075cb9c4e67062a368cc469a636/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节内容讲解节点的计划任务，计划任务在游戏中或许是在常见不过的内容了，我们之所以能看到游戏画面中各种精灵的跳动、图层的移动等，都要归功于节点的计划任务，比如蓝天背景中的白云在飘，偶尔还飞过一只小鸟，比如天上偶尔掉下一块金子","more":"（当然现实中不会有这种好事。。。），这一切游戏中活物，都是节点的计划任务的功劳，想象下，如果没有计划任务，那么游戏世界一片死寂。</p>\n<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>废话不多说，直接了解节点计划任务的API，虽然课程中只讲了两个API，schedule和unschedule，但搜索cocosjs的文档后，可以了解，其实他还有其他强大的用法，总结一下计划任务的API如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> node = <span class=\"keyword\">new</span> cc.Node();</span><br><span class=\"line\"><span class=\"comment\">// node的update函数将会在每一帧被执行</span></span><br><span class=\"line\">node.scheduleUpdate();</span><br><span class=\"line\"><span class=\"comment\">// callback回调函数会重复得在每个interval时间间隔之后被执行，重复次数为repeat次，并且这个任务会在delay延时之后开始执行</span></span><br><span class=\"line\">node.schedule(callback, interval, repeat, delay);</span><br><span class=\"line\"><span class=\"comment\">// callback回调函数会在delay延时之后被执行一次</span></span><br><span class=\"line\">node.scheduleOnce(callback, delay);</span><br><span class=\"line\"><span class=\"comment\">// 取消callback任务</span></span><br><span class=\"line\">node.unschedule(callback);</span><br><span class=\"line\"><span class=\"comment\">// 取消node节点所有计划中的任务</span></span><br><span class=\"line\">node.unscheduleAllCallbacks();</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业-1\"><a href=\"#作业-1\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>不同游戏的不同需求，不同应用场景，可以灵活使用计划任务，让游戏活起来。课后的作业是使用节点的计划任务让节点不断的自我旋转，其代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        <span class=\"comment\">// 添加要执行节点任务的节点</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> logo=<span class=\"keyword\">new</span> cc.Sprite(res.HelloWorld_png);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(logo);</span><br><span class=\"line\">        logo.setTag(<span class=\"number\">111</span>);</span><br><span class=\"line\">        logo.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">//每个节点node都可以绑定一些处理逻辑，在每一帧都会被调用</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> itemstart=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;启动&quot;</span>,<span class=\"built_in\">this</span>.start,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> itemstop=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;停止&quot;</span>,<span class=\"built_in\">this</span>.stop,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        itemstop.setPositionY(<span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(itemstart,itemstop);</span><br><span class=\"line\">        menu.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">100</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 节点任务的回调函数</span></span><br><span class=\"line\">        <span class=\"comment\">// 开始节点任务</span></span><br><span class=\"line\">        start:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//启动计划任务</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.update);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"comment\">// 停止节点任务</span></span><br><span class=\"line\">        stop:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.update);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"comment\">// 更新回调函数</span></span><br><span class=\"line\">        update:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> nowlogo=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">111</span>);</span><br><span class=\"line\">            nowlogo.setRotation(nowlogo.getRotation()+<span class=\"number\">5</span>);</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终运行效果\"><a href=\"#最终运行效果\" class=\"headerlink\" title=\"最终运行效果\"></a>最终运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_18/ac5da37fd647d075cb9c4e67062a368cc469a636/\">http://www.cocoscvp.com/usercode/2016_04_18/ac5da37fd647d075cb9c4e67062a368cc469a636/</a></p>"},{"title":"CVP认证学习笔记--(何小成)009--节点的旋转和缩放","date":"2016-04-18T14:44:00.000Z","_content":"### API\n本节课内容讲的是节点的旋转和缩放，在cocos中的API是以下两句代码：\n```javascript\n// 1.缩放\n// node为要缩放的节点，scale为要缩放的倍数\nnode.setScale(scale);\n\n// 2.旋转\n// node为要旋转的节点，rotation为要旋转的角度\nnode.setRotation(rotation);\n```\n<!--more-->\n### 作业\n从api来看，实现旋转和缩放并不复杂，在课后作用中，要实现点击按钮来旋转或缩放一个图片，作业实现代码如下：\n```javascript\n    // 添加放大、缩小、旋转按钮\n    var big = new cc.MenuItemLabel(new cc.LabelTTF(\"放大\",\"\",50),this.bigger,this);\n    big.setPosition(size.width/6,size.height/2);\n    var small = new cc.MenuItemLabel(new cc.LabelTTF(\"缩小\",\"\",50),this.small,this);\n    small.setPosition(size.width/2,size.height/2);\n    var rotate = new cc.MenuItemLabel(new cc.LabelTTF(\"旋转\",\"\",50),this.rotate,this);\n    rotate.setPosition(size.width*5/6,size.height/2);\n    var menu = new cc.Menu(big,small,rotate);\n    menu.setPosition(0,0);\n    menu.setAnchorPoint(0,0);\n    this.addChild(menu);\n\n    // 放大按钮回调\n    bigger:function(){\n        var logo = this.getChildByTag(1);\n        logo.setScale(logo.getScale()*1.1);\n    },\n    // 缩小按钮回调\n    small:function(){\n        var logo = this.getChildByTag(1);\n        logo.setScale(logo.getScale()*0.9);\n    },\n    // 旋转按钮回调\n    rotate:function(){\n        var logo = this.getChildByTag(1);\n        logo.setRotation(logo.getRotation()+15);\n    }\n```\n\n### 最终运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_18/0d97ec16bdeb715442b306f7d8559911631fbabe/\n","source":"_posts/CVP认证学习笔记--(何小成)009--节点的旋转和缩放.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)009--节点的旋转和缩放\ndate: 2016-04-18 22:44\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### API\n本节课内容讲的是节点的旋转和缩放，在cocos中的API是以下两句代码：\n```javascript\n// 1.缩放\n// node为要缩放的节点，scale为要缩放的倍数\nnode.setScale(scale);\n\n// 2.旋转\n// node为要旋转的节点，rotation为要旋转的角度\nnode.setRotation(rotation);\n```\n<!--more-->\n### 作业\n从api来看，实现旋转和缩放并不复杂，在课后作用中，要实现点击按钮来旋转或缩放一个图片，作业实现代码如下：\n```javascript\n    // 添加放大、缩小、旋转按钮\n    var big = new cc.MenuItemLabel(new cc.LabelTTF(\"放大\",\"\",50),this.bigger,this);\n    big.setPosition(size.width/6,size.height/2);\n    var small = new cc.MenuItemLabel(new cc.LabelTTF(\"缩小\",\"\",50),this.small,this);\n    small.setPosition(size.width/2,size.height/2);\n    var rotate = new cc.MenuItemLabel(new cc.LabelTTF(\"旋转\",\"\",50),this.rotate,this);\n    rotate.setPosition(size.width*5/6,size.height/2);\n    var menu = new cc.Menu(big,small,rotate);\n    menu.setPosition(0,0);\n    menu.setAnchorPoint(0,0);\n    this.addChild(menu);\n\n    // 放大按钮回调\n    bigger:function(){\n        var logo = this.getChildByTag(1);\n        logo.setScale(logo.getScale()*1.1);\n    },\n    // 缩小按钮回调\n    small:function(){\n        var logo = this.getChildByTag(1);\n        logo.setScale(logo.getScale()*0.9);\n    },\n    // 旋转按钮回调\n    rotate:function(){\n        var logo = this.getChildByTag(1);\n        logo.setRotation(logo.getRotation()+15);\n    }\n```\n\n### 最终运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_18/0d97ec16bdeb715442b306f7d8559911631fbabe/\n","slug":"CVP认证学习笔记--(何小成)009--节点的旋转和缩放","published":1,"updated":"2016-04-24T15:02:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhty000nwsaze1idhkd5","content":"<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>本节课内容讲的是节点的旋转和缩放，在cocos中的API是以下两句代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1.缩放</span></span><br><span class=\"line\"><span class=\"comment\">// node为要缩放的节点，scale为要缩放的倍数</span></span><br><span class=\"line\">node.setScale(scale);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2.旋转</span></span><br><span class=\"line\"><span class=\"comment\">// node为要旋转的节点，rotation为要旋转的角度</span></span><br><span class=\"line\">node.setRotation(rotation);</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>从api来看，实现旋转和缩放并不复杂，在课后作用中，要实现点击按钮来旋转或缩放一个图片，作业实现代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"comment\">// 添加放大、缩小、旋转按钮</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> big = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;放大&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>),<span class=\"built_in\">this</span>.bigger,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    big.setPosition(size.width/<span class=\"number\">6</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> small = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;缩小&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>),<span class=\"built_in\">this</span>.small,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    small.setPosition(size.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> rotate = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;旋转&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>),<span class=\"built_in\">this</span>.rotate,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    rotate.setPosition(size.width*<span class=\"number\">5</span>/<span class=\"number\">6</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(big,small,rotate);</span><br><span class=\"line\">    menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">    menu.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 放大按钮回调</span></span><br><span class=\"line\">    bigger:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> logo = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        logo.setScale(logo.getScale()*<span class=\"number\">1.1</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 缩小按钮回调</span></span><br><span class=\"line\">    small:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> logo = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        logo.setScale(logo.getScale()*<span class=\"number\">0.9</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 旋转按钮回调</span></span><br><span class=\"line\">    rotate:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> logo = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        logo.setRotation(logo.getRotation()+<span class=\"number\">15</span>);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终运行效果\"><a href=\"#最终运行效果\" class=\"headerlink\" title=\"最终运行效果\"></a>最终运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_18/0d97ec16bdeb715442b306f7d8559911631fbabe/\">http://www.cocoscvp.com/usercode/2016_04_18/0d97ec16bdeb715442b306f7d8559911631fbabe/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>本节课内容讲的是节点的旋转和缩放，在cocos中的API是以下两句代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1.缩放</span></span><br><span class=\"line\"><span class=\"comment\">// node为要缩放的节点，scale为要缩放的倍数</span></span><br><span class=\"line\">node.setScale(scale);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2.旋转</span></span><br><span class=\"line\"><span class=\"comment\">// node为要旋转的节点，rotation为要旋转的角度</span></span><br><span class=\"line\">node.setRotation(rotation);</span><br></pre></td></tr></table></figure>","more":"<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>从api来看，实现旋转和缩放并不复杂，在课后作用中，要实现点击按钮来旋转或缩放一个图片，作业实现代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"comment\">// 添加放大、缩小、旋转按钮</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> big = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;放大&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>),<span class=\"built_in\">this</span>.bigger,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    big.setPosition(size.width/<span class=\"number\">6</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> small = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;缩小&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>),<span class=\"built_in\">this</span>.small,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    small.setPosition(size.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> rotate = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;旋转&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>),<span class=\"built_in\">this</span>.rotate,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    rotate.setPosition(size.width*<span class=\"number\">5</span>/<span class=\"number\">6</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(big,small,rotate);</span><br><span class=\"line\">    menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">    menu.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 放大按钮回调</span></span><br><span class=\"line\">    bigger:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> logo = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        logo.setScale(logo.getScale()*<span class=\"number\">1.1</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 缩小按钮回调</span></span><br><span class=\"line\">    small:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> logo = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        logo.setScale(logo.getScale()*<span class=\"number\">0.9</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 旋转按钮回调</span></span><br><span class=\"line\">    rotate:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> logo = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        logo.setRotation(logo.getRotation()+<span class=\"number\">15</span>);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终运行效果\"><a href=\"#最终运行效果\" class=\"headerlink\" title=\"最终运行效果\"></a>最终运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_18/0d97ec16bdeb715442b306f7d8559911631fbabe/\">http://www.cocoscvp.com/usercode/2016_04_18/0d97ec16bdeb715442b306f7d8559911631fbabe/</a></p>"},{"title":"CVP认证学习笔记--(何小成)011--节点的Action","date":"2016-04-19T13:12:00.000Z","_content":"### 概念\n本节课内容讲解节点的Action，不过本节课只以moveTo为例进行了讲解，本节课作业为实现点击按钮让npc在0.2s内向右移动15像素，其中使用了moveTo方法，第一个参数为，动作执行的时间，单位为秒，第二个参数为要移动到的点，如果是moveBy，scaleBy之类的，<!--more-->就是要移动的相对位置或相对缩放比例。\n### 作业\n我的代码实现如下：\n```javascript\n        //定义一个Sprite\n        var npc=new cc.Sprite(res.npc01_png);//一会要增加这个文件在src/resource.js\n        npc.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        this.addChild(npc);\n        npc.setTag(1);\n        //Action是什么？是实现定义好的计划任务 定时修改node属性\n        //npc.runAction(new cc.moveTo(3,cc.p(30,30)));\n        //moveTo 移动到 绝对位置\n        //moveBy 移动到 x,y 相对位置\n        var startItem = new cc.MenuItemFont(\"移动\",this.moveNpc,this);\n        var menu = new cc.Menu(startItem);\n        this.addChild(menu);\n\n        // menu的回调函数\n        moveNpc:function(){\n        var npc = this.getChildByTag(1);\n        npc.runAction(new cc.moveBy(0.2,cc.p(15,0)));\n```\n\n当然这是作业，课程中也说了，Node的Action远不止这么一种，还有诸如moveBy，scaleTo，scaleBy，rotateTo，jumpTo等动作，这里就不一一列举。\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_19/e08b6f708a97a7bc22f248dda38ebab4349f2b36/\n","source":"_posts/CVP认证学习笔记--(何小成)011--节点的Action.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)011--节点的Action\ndate: 2016-04-19 21:12\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节课内容讲解节点的Action，不过本节课只以moveTo为例进行了讲解，本节课作业为实现点击按钮让npc在0.2s内向右移动15像素，其中使用了moveTo方法，第一个参数为，动作执行的时间，单位为秒，第二个参数为要移动到的点，如果是moveBy，scaleBy之类的，<!--more-->就是要移动的相对位置或相对缩放比例。\n### 作业\n我的代码实现如下：\n```javascript\n        //定义一个Sprite\n        var npc=new cc.Sprite(res.npc01_png);//一会要增加这个文件在src/resource.js\n        npc.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        this.addChild(npc);\n        npc.setTag(1);\n        //Action是什么？是实现定义好的计划任务 定时修改node属性\n        //npc.runAction(new cc.moveTo(3,cc.p(30,30)));\n        //moveTo 移动到 绝对位置\n        //moveBy 移动到 x,y 相对位置\n        var startItem = new cc.MenuItemFont(\"移动\",this.moveNpc,this);\n        var menu = new cc.Menu(startItem);\n        this.addChild(menu);\n\n        // menu的回调函数\n        moveNpc:function(){\n        var npc = this.getChildByTag(1);\n        npc.runAction(new cc.moveBy(0.2,cc.p(15,0)));\n```\n\n当然这是作业，课程中也说了，Node的Action远不止这么一种，还有诸如moveBy，scaleTo，scaleBy，rotateTo，jumpTo等动作，这里就不一一列举。\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_19/e08b6f708a97a7bc22f248dda38ebab4349f2b36/\n","slug":"CVP认证学习笔记--(何小成)011--节点的Action","published":1,"updated":"2016-04-24T15:01:40.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhu0000pwsaz49q33dl6","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课内容讲解节点的Action，不过本节课只以moveTo为例进行了讲解，本节课作业为实现点击按钮让npc在0.2s内向右移动15像素，其中使用了moveTo方法，第一个参数为，动作执行的时间，单位为秒，第二个参数为要移动到的点，如果是moveBy，scaleBy之类的，<a id=\"more\"></a>就是要移动的相对位置或相对缩放比例。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>我的代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        <span class=\"comment\">//定义一个Sprite</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc=<span class=\"keyword\">new</span> cc.Sprite(res.npc01_png);<span class=\"comment\">//一会要增加这个文件在src/resource.js</span></span><br><span class=\"line\">        npc.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(npc);</span><br><span class=\"line\">        npc.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//Action是什么？是实现定义好的计划任务 定时修改node属性</span></span><br><span class=\"line\">        <span class=\"comment\">//npc.runAction(new cc.moveTo(3,cc.p(30,30)));</span></span><br><span class=\"line\">        <span class=\"comment\">//moveTo 移动到 绝对位置</span></span><br><span class=\"line\">        <span class=\"comment\">//moveBy 移动到 x,y 相对位置</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> startItem = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;移动&quot;</span>,<span class=\"built_in\">this</span>.moveNpc,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(startItem);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// menu的回调函数</span></span><br><span class=\"line\">        moveNpc:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        npc.runAction(<span class=\"keyword\">new</span> cc.moveBy(<span class=\"number\">0.2</span>,cc.p(<span class=\"number\">15</span>,<span class=\"number\">0</span>)));</span><br></pre></td></tr></table></figure>\n\n<p>当然这是作业，课程中也说了，Node的Action远不止这么一种，还有诸如moveBy，scaleTo，scaleBy，rotateTo，jumpTo等动作，这里就不一一列举。</p>\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_19/e08b6f708a97a7bc22f248dda38ebab4349f2b36/\">http://www.cocoscvp.com/usercode/2016_04_19/e08b6f708a97a7bc22f248dda38ebab4349f2b36/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课内容讲解节点的Action，不过本节课只以moveTo为例进行了讲解，本节课作业为实现点击按钮让npc在0.2s内向右移动15像素，其中使用了moveTo方法，第一个参数为，动作执行的时间，单位为秒，第二个参数为要移动到的点，如果是moveBy，scaleBy之类的，","more":"就是要移动的相对位置或相对缩放比例。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>我的代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        <span class=\"comment\">//定义一个Sprite</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc=<span class=\"keyword\">new</span> cc.Sprite(res.npc01_png);<span class=\"comment\">//一会要增加这个文件在src/resource.js</span></span><br><span class=\"line\">        npc.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(npc);</span><br><span class=\"line\">        npc.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//Action是什么？是实现定义好的计划任务 定时修改node属性</span></span><br><span class=\"line\">        <span class=\"comment\">//npc.runAction(new cc.moveTo(3,cc.p(30,30)));</span></span><br><span class=\"line\">        <span class=\"comment\">//moveTo 移动到 绝对位置</span></span><br><span class=\"line\">        <span class=\"comment\">//moveBy 移动到 x,y 相对位置</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> startItem = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;移动&quot;</span>,<span class=\"built_in\">this</span>.moveNpc,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(startItem);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// menu的回调函数</span></span><br><span class=\"line\">        moveNpc:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        npc.runAction(<span class=\"keyword\">new</span> cc.moveBy(<span class=\"number\">0.2</span>,cc.p(<span class=\"number\">15</span>,<span class=\"number\">0</span>)));</span><br></pre></td></tr></table></figure>\n\n<p>当然这是作业，课程中也说了，Node的Action远不止这么一种，还有诸如moveBy，scaleTo，scaleBy，rotateTo，jumpTo等动作，这里就不一一列举。</p>\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_19/e08b6f708a97a7bc22f248dda38ebab4349f2b36/\">http://www.cocoscvp.com/usercode/2016_04_19/e08b6f708a97a7bc22f248dda38ebab4349f2b36/</a></p>"},{"title":"CVP认证学习笔记--(何小成)014--点击英雄","date":"2016-04-20T15:16:00.000Z","_content":"本节课没有新的知识点，主要是总结本周所学内容所做的一个小demo，作业要求实现点击数字文本，文本加10，为综合应用之前的知识点，我扩展为一个模拟攻击怪物的过程，点击攻击按钮，npc被攻击，当npc血量为0时，执行一个特效后死亡，<!--more-->过程如下：\n### 首先自己实现一个Npc精灵类，其中包含血量属性，包含被攻击的方法\n```javascript\nvar NpcSprite = cc.Sprite.extend({\n    hp:100,// 血量\n    ctor:function(pic){\n        this._super(pic);\n    },\n    // 被攻击方法  \n    attacked:function(attack,layer){\n        if(this.hp>0){\n            this.hp -= attack*(1+Math.random());// 每次攻击，血量减少基础数值*随机的暴击数值\n            var attackTxt = layer.getChildByTag(2);// 获取攻击按钮，传入死亡回调函数使用\n            var hpTxt = layer.getChildByTag(3);\n            this.hp = this.hp<0?0:this.hp;\n            hpTxt.setString(\"血量:\"+Math.round(this.hp));\n            var scoreTxt = layer.getChildByTag(4);\n            scoreTxt.setString(\"分数:\"+Math.round((100-this.hp)*10));\n            var act = new cc.sequence(cc.scaleTo(0.1,1.1),cc.scaleTo(0.1,0.9),cc.scaleTo(0.1,1),cc.callFunc(this.dead,this,attackTxt));\n            this.runAction(act);\n        }\n    },\n    dead:function(npc,attackTxt){// 死亡回调函数\n        if(npc.hp>0){// 如果hp>0，则没有死，直接return\n            return;\n        }\n        // npc执行一个死亡特效后，移除\n        var act = new cc.spawn(\n            new cc.sequence(cc.scaleTo(0.2,1.1),cc.scaleTo(0.3,0),cc.callFunc(function(npc,scoreTxt){\n            npc.removeFromParent();\n            attackTxt.setString(\"战斗胜利\");// 把攻击按钮文字变成战斗胜利\n            var overAct = new cc.sequence(cc.scaleTo(0.2,1.5),cc.scaleTo(0.1,0.8),cc.scaleTo(0.1,1.2));\n            attackTxt.runAction(overAct);// 战斗胜利再来个特效\n        },npc)),cc.rotateBy(0.5,360));\n        npc.runAction(act);\n    }\n});\n```\n### 初始化场景中的精灵\n```javascript\nctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        var size = cc.winSize;\n        cc.log(\"构造\");\n        var npc=new NpcSprite(res.npc01_png);\n        npc.setPosition(200,200);\n        npc.setTag(110);\n        var attack = new cc.LabelTTF(\"攻击\",\"\",25);\n        attack.setPosition(npc.getPositionX()+npc.width/2+100,npc.getPositionY());\n        var hp = new cc.LabelTTF(\"血量:\"+npc.hp,\"\",25);\n        hp.setPosition(hp.width/2,size.height-hp.height/2);\n        var score = new cc.LabelTTF(\"分数:0\",\"\",25);\n        score.setPosition(size.width-score.width/2-100,size.height-score.height/2);\n        this.addChild(npc);\n        this.addChild(attack);\n        this.addChild(hp);\n        this.addChild(score);\n        npc.setTag(1);\n        attack.setTag(2);\n        hp.setTag(3);\n        score.setTag(4);\n        return true;\n    },\n```\n### 添加触摸事件管理，点击攻击按钮，触摸区域判断，如果是攻击按钮所在区域，攻击按钮实现放大缩小的点击效果，怪物实现方法缩小的效果（看起来才像是被打了一下）\n```javascript\nonEnter:function()\n    {\n        this._super();\n        cc.log(\"初始化完成\");\n       //添加触屏事件\n       cc.eventManager.addListener({\n           event:cc.EventListener.TOUCH_ONE_BY_ONE,\n           swallowTouches:true,//吞噬事件 不再传递\n           onTouchBegan:this.touchbegan,\n           onTouchMoved:this.touchmoved,\n           onTouchEnded:this.touchended\n       },this);\n\n    },\n    onExit:function()\n    {\n        this._super();\n        cc.log(\"即将消失\");\n    },\n    touchbegan:function(touch,event){\n        cc.log(\"按下\");\n        var nownpc=event.getCurrentTarget().getChildByTag(1);\n        var attack=event.getCurrentTarget().getChildByTag(2);\n        var startHp = nownpc.hp;\n        if(touch.getLocation().x>=attack.getPositionX()-attack.width&&touch.getLocation().x<=attack.getPositionX()+attack.width\n        &&touch.getLocation().y>=attack.getPositionY()-attack.height&&touch.getLocation().y<=attack.getPositionY()+attack.height){\n            // 点击在区域内，收到攻击\n            nownpc.attacked(2,event.getCurrentTarget());\n            // 飘出血量减少数字\n            var reduceHp = nownpc.hp-startHp;\n            var num = new cc.LabelTTF(\"\"+Math.round(reduceHp),\"\",40);\n            num.setColor(cc.color(255,0,0,255));\n            num.setPosition(nownpc.getPositionX(),nownpc.getPositionY()+nownpc.height/2);\n            event.getCurrentTarget().addChild(num);\n            num.runAction(\n                new cc.sequence(\n                    new cc.spawn(\n                        cc.moveBy(0.5,cc.p(0,50)),cc.fadeOut(0.5)\n                    ),new cc.callFunc(function(num){\n                        num.removeFromParent();\n                    },num)\n                )\n            );\n            // 攻击按钮也变化\n            attack.runAction(new cc.sequence(cc.scaleTo(0.2,1.1),cc.scaleTo(0.1,0.9),cc.scaleTo(0.1,1)));\n        }\n        return true;\n    },\n    touchmoved:function(touch,event)\n    {\n        cc.log(\"移动\");\n    },\n    touchend:function(touch,event)\n    {\n        cc.log(\"抬起\");\n    }\n```\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_20/026bc981b469e83ed488c783b4d0b0034233188a/\n","source":"_posts/CVP认证学习笔记--(何小成)014--点击英雄.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)014--点击英雄\ndate: 2016-04-20 23:16\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n本节课没有新的知识点，主要是总结本周所学内容所做的一个小demo，作业要求实现点击数字文本，文本加10，为综合应用之前的知识点，我扩展为一个模拟攻击怪物的过程，点击攻击按钮，npc被攻击，当npc血量为0时，执行一个特效后死亡，<!--more-->过程如下：\n### 首先自己实现一个Npc精灵类，其中包含血量属性，包含被攻击的方法\n```javascript\nvar NpcSprite = cc.Sprite.extend({\n    hp:100,// 血量\n    ctor:function(pic){\n        this._super(pic);\n    },\n    // 被攻击方法  \n    attacked:function(attack,layer){\n        if(this.hp>0){\n            this.hp -= attack*(1+Math.random());// 每次攻击，血量减少基础数值*随机的暴击数值\n            var attackTxt = layer.getChildByTag(2);// 获取攻击按钮，传入死亡回调函数使用\n            var hpTxt = layer.getChildByTag(3);\n            this.hp = this.hp<0?0:this.hp;\n            hpTxt.setString(\"血量:\"+Math.round(this.hp));\n            var scoreTxt = layer.getChildByTag(4);\n            scoreTxt.setString(\"分数:\"+Math.round((100-this.hp)*10));\n            var act = new cc.sequence(cc.scaleTo(0.1,1.1),cc.scaleTo(0.1,0.9),cc.scaleTo(0.1,1),cc.callFunc(this.dead,this,attackTxt));\n            this.runAction(act);\n        }\n    },\n    dead:function(npc,attackTxt){// 死亡回调函数\n        if(npc.hp>0){// 如果hp>0，则没有死，直接return\n            return;\n        }\n        // npc执行一个死亡特效后，移除\n        var act = new cc.spawn(\n            new cc.sequence(cc.scaleTo(0.2,1.1),cc.scaleTo(0.3,0),cc.callFunc(function(npc,scoreTxt){\n            npc.removeFromParent();\n            attackTxt.setString(\"战斗胜利\");// 把攻击按钮文字变成战斗胜利\n            var overAct = new cc.sequence(cc.scaleTo(0.2,1.5),cc.scaleTo(0.1,0.8),cc.scaleTo(0.1,1.2));\n            attackTxt.runAction(overAct);// 战斗胜利再来个特效\n        },npc)),cc.rotateBy(0.5,360));\n        npc.runAction(act);\n    }\n});\n```\n### 初始化场景中的精灵\n```javascript\nctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        var size = cc.winSize;\n        cc.log(\"构造\");\n        var npc=new NpcSprite(res.npc01_png);\n        npc.setPosition(200,200);\n        npc.setTag(110);\n        var attack = new cc.LabelTTF(\"攻击\",\"\",25);\n        attack.setPosition(npc.getPositionX()+npc.width/2+100,npc.getPositionY());\n        var hp = new cc.LabelTTF(\"血量:\"+npc.hp,\"\",25);\n        hp.setPosition(hp.width/2,size.height-hp.height/2);\n        var score = new cc.LabelTTF(\"分数:0\",\"\",25);\n        score.setPosition(size.width-score.width/2-100,size.height-score.height/2);\n        this.addChild(npc);\n        this.addChild(attack);\n        this.addChild(hp);\n        this.addChild(score);\n        npc.setTag(1);\n        attack.setTag(2);\n        hp.setTag(3);\n        score.setTag(4);\n        return true;\n    },\n```\n### 添加触摸事件管理，点击攻击按钮，触摸区域判断，如果是攻击按钮所在区域，攻击按钮实现放大缩小的点击效果，怪物实现方法缩小的效果（看起来才像是被打了一下）\n```javascript\nonEnter:function()\n    {\n        this._super();\n        cc.log(\"初始化完成\");\n       //添加触屏事件\n       cc.eventManager.addListener({\n           event:cc.EventListener.TOUCH_ONE_BY_ONE,\n           swallowTouches:true,//吞噬事件 不再传递\n           onTouchBegan:this.touchbegan,\n           onTouchMoved:this.touchmoved,\n           onTouchEnded:this.touchended\n       },this);\n\n    },\n    onExit:function()\n    {\n        this._super();\n        cc.log(\"即将消失\");\n    },\n    touchbegan:function(touch,event){\n        cc.log(\"按下\");\n        var nownpc=event.getCurrentTarget().getChildByTag(1);\n        var attack=event.getCurrentTarget().getChildByTag(2);\n        var startHp = nownpc.hp;\n        if(touch.getLocation().x>=attack.getPositionX()-attack.width&&touch.getLocation().x<=attack.getPositionX()+attack.width\n        &&touch.getLocation().y>=attack.getPositionY()-attack.height&&touch.getLocation().y<=attack.getPositionY()+attack.height){\n            // 点击在区域内，收到攻击\n            nownpc.attacked(2,event.getCurrentTarget());\n            // 飘出血量减少数字\n            var reduceHp = nownpc.hp-startHp;\n            var num = new cc.LabelTTF(\"\"+Math.round(reduceHp),\"\",40);\n            num.setColor(cc.color(255,0,0,255));\n            num.setPosition(nownpc.getPositionX(),nownpc.getPositionY()+nownpc.height/2);\n            event.getCurrentTarget().addChild(num);\n            num.runAction(\n                new cc.sequence(\n                    new cc.spawn(\n                        cc.moveBy(0.5,cc.p(0,50)),cc.fadeOut(0.5)\n                    ),new cc.callFunc(function(num){\n                        num.removeFromParent();\n                    },num)\n                )\n            );\n            // 攻击按钮也变化\n            attack.runAction(new cc.sequence(cc.scaleTo(0.2,1.1),cc.scaleTo(0.1,0.9),cc.scaleTo(0.1,1)));\n        }\n        return true;\n    },\n    touchmoved:function(touch,event)\n    {\n        cc.log(\"移动\");\n    },\n    touchend:function(touch,event)\n    {\n        cc.log(\"抬起\");\n    }\n```\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_20/026bc981b469e83ed488c783b4d0b0034233188a/\n","slug":"CVP认证学习笔记--(何小成)014--点击英雄","published":1,"updated":"2016-04-24T15:01:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhu2000twsazaiuxd4pt","content":"<p>本节课没有新的知识点，主要是总结本周所学内容所做的一个小demo，作业要求实现点击数字文本，文本加10，为综合应用之前的知识点，我扩展为一个模拟攻击怪物的过程，点击攻击按钮，npc被攻击，当npc血量为0时，执行一个特效后死亡，<a id=\"more\"></a>过程如下：</p>\n<h3 id=\"首先自己实现一个Npc精灵类，其中包含血量属性，包含被攻击的方法\"><a href=\"#首先自己实现一个Npc精灵类，其中包含血量属性，包含被攻击的方法\" class=\"headerlink\" title=\"首先自己实现一个Npc精灵类，其中包含血量属性，包含被攻击的方法\"></a>首先自己实现一个Npc精灵类，其中包含血量属性，包含被攻击的方法</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> NpcSprite = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    hp:<span class=\"number\">100</span>,<span class=\"comment\">// 血量</span></span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">pic</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super(pic);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 被攻击方法  </span></span><br><span class=\"line\">    attacked:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">attack,layer</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.hp&gt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.hp -= attack*(<span class=\"number\">1</span>+<span class=\"built_in\">Math</span>.random());<span class=\"comment\">// 每次攻击，血量减少基础数值*随机的暴击数值</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> attackTxt = layer.getChildByTag(<span class=\"number\">2</span>);<span class=\"comment\">// 获取攻击按钮，传入死亡回调函数使用</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> hpTxt = layer.getChildByTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.hp = <span class=\"built_in\">this</span>.hp&lt;<span class=\"number\">0</span>?<span class=\"number\">0</span>:<span class=\"built_in\">this</span>.hp;</span><br><span class=\"line\">            hpTxt.setString(<span class=\"string\">&quot;血量:&quot;</span>+<span class=\"built_in\">Math</span>.round(<span class=\"built_in\">this</span>.hp));</span><br><span class=\"line\">            <span class=\"keyword\">var</span> scoreTxt = layer.getChildByTag(<span class=\"number\">4</span>);</span><br><span class=\"line\">            scoreTxt.setString(<span class=\"string\">&quot;分数:&quot;</span>+<span class=\"built_in\">Math</span>.round((<span class=\"number\">100</span>-<span class=\"built_in\">this</span>.hp)*<span class=\"number\">10</span>));</span><br><span class=\"line\">            <span class=\"keyword\">var</span> act = <span class=\"keyword\">new</span> cc.sequence(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1.1</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0.9</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>),cc.callFunc(<span class=\"built_in\">this</span>.dead,<span class=\"built_in\">this</span>,attackTxt));</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.runAction(act);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    dead:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">npc,attackTxt</span>)</span>&#123;<span class=\"comment\">// 死亡回调函数</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(npc.hp&gt;<span class=\"number\">0</span>)&#123;<span class=\"comment\">// 如果hp&gt;0，则没有死，直接return</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// npc执行一个死亡特效后，移除</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> act = <span class=\"keyword\">new</span> cc.spawn(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.1</span>),cc.scaleTo(<span class=\"number\">0.3</span>,<span class=\"number\">0</span>),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">npc,scoreTxt</span>)</span>&#123;</span><br><span class=\"line\">            npc.removeFromParent();</span><br><span class=\"line\">            attackTxt.setString(<span class=\"string\">&quot;战斗胜利&quot;</span>);<span class=\"comment\">// 把攻击按钮文字变成战斗胜利</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> overAct = <span class=\"keyword\">new</span> cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.5</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0.8</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1.2</span>));</span><br><span class=\"line\">            attackTxt.runAction(overAct);<span class=\"comment\">// 战斗胜利再来个特效</span></span><br><span class=\"line\">        &#125;,npc)),cc.rotateBy(<span class=\"number\">0.5</span>,<span class=\"number\">360</span>));</span><br><span class=\"line\">        npc.runAction(act);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"初始化场景中的精灵\"><a href=\"#初始化场景中的精灵\" class=\"headerlink\" title=\"初始化场景中的精灵\"></a>初始化场景中的精灵</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;构造&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc=<span class=\"keyword\">new</span> NpcSprite(res.npc01_png);</span><br><span class=\"line\">        npc.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        npc.setTag(<span class=\"number\">110</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> attack = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;攻击&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">25</span>);</span><br><span class=\"line\">        attack.setPosition(npc.getPositionX()+npc.width/<span class=\"number\">2</span>+<span class=\"number\">100</span>,npc.getPositionY());</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hp = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;血量:&quot;</span>+npc.hp,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">25</span>);</span><br><span class=\"line\">        hp.setPosition(hp.width/<span class=\"number\">2</span>,size.height-hp.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> score = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;分数:0&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">25</span>);</span><br><span class=\"line\">        score.setPosition(size.width-score.width/<span class=\"number\">2</span><span class=\"number\">-100</span>,size.height-score.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(npc);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(attack);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(hp);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(score);</span><br><span class=\"line\">        npc.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        attack.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        hp.setTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        score.setTag(<span class=\"number\">4</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br></pre></td></tr></table></figure>\n<h3 id=\"添加触摸事件管理，点击攻击按钮，触摸区域判断，如果是攻击按钮所在区域，攻击按钮实现放大缩小的点击效果，怪物实现方法缩小的效果（看起来才像是被打了一下）\"><a href=\"#添加触摸事件管理，点击攻击按钮，触摸区域判断，如果是攻击按钮所在区域，攻击按钮实现放大缩小的点击效果，怪物实现方法缩小的效果（看起来才像是被打了一下）\" class=\"headerlink\" title=\"添加触摸事件管理，点击攻击按钮，触摸区域判断，如果是攻击按钮所在区域，攻击按钮实现放大缩小的点击效果，怪物实现方法缩小的效果（看起来才像是被打了一下）\"></a>添加触摸事件管理，点击攻击按钮，触摸区域判断，如果是攻击按钮所在区域，攻击按钮实现放大缩小的点击效果，怪物实现方法缩小的效果（看起来才像是被打了一下）</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;初始化完成&quot;</span>);</span><br><span class=\"line\">       <span class=\"comment\">//添加触屏事件</span></span><br><span class=\"line\">       cc.eventManager.addListener(&#123;</span><br><span class=\"line\">           event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">           swallowTouches:<span class=\"literal\">true</span>,<span class=\"comment\">//吞噬事件 不再传递</span></span><br><span class=\"line\">           onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">           onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">           onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">       &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onExit:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;即将消失&quot;</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;按下&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> nownpc=event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> attack=event.getCurrentTarget().getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> startHp = nownpc.hp;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(touch.getLocation().x&gt;=attack.getPositionX()-attack.width&amp;&amp;touch.getLocation().x&lt;=attack.getPositionX()+attack.width</span><br><span class=\"line\">        &amp;&amp;touch.getLocation().y&gt;=attack.getPositionY()-attack.height&amp;&amp;touch.getLocation().y&lt;=attack.getPositionY()+attack.height)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 点击在区域内，收到攻击</span></span><br><span class=\"line\">            nownpc.attacked(<span class=\"number\">2</span>,event.getCurrentTarget());</span><br><span class=\"line\">            <span class=\"comment\">// 飘出血量减少数字</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> reduceHp = nownpc.hp-startHp;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> num = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;&quot;</span>+<span class=\"built_in\">Math</span>.round(reduceHp),<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">40</span>);</span><br><span class=\"line\">            num.setColor(cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>));</span><br><span class=\"line\">            num.setPosition(nownpc.getPositionX(),nownpc.getPositionY()+nownpc.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">            event.getCurrentTarget().addChild(num);</span><br><span class=\"line\">            num.runAction(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> cc.sequence(</span><br><span class=\"line\">                    <span class=\"keyword\">new</span> cc.spawn(</span><br><span class=\"line\">                        cc.moveBy(<span class=\"number\">0.5</span>,cc.p(<span class=\"number\">0</span>,<span class=\"number\">50</span>)),cc.fadeOut(<span class=\"number\">0.5</span>)</span><br><span class=\"line\">                    ),<span class=\"keyword\">new</span> cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">num</span>)</span>&#123;</span><br><span class=\"line\">                        num.removeFromParent();</span><br><span class=\"line\">                    &#125;,num)</span><br><span class=\"line\">                )</span><br><span class=\"line\">            );</span><br><span class=\"line\">            <span class=\"comment\">// 攻击按钮也变化</span></span><br><span class=\"line\">            attack.runAction(<span class=\"keyword\">new</span> cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.1</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0.9</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;移动&quot;</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchend:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;抬起&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_20/026bc981b469e83ed488c783b4d0b0034233188a/\">http://www.cocoscvp.com/usercode/2016_04_20/026bc981b469e83ed488c783b4d0b0034233188a/</a></p>\n","site":{"data":{}},"excerpt":"<p>本节课没有新的知识点，主要是总结本周所学内容所做的一个小demo，作业要求实现点击数字文本，文本加10，为综合应用之前的知识点，我扩展为一个模拟攻击怪物的过程，点击攻击按钮，npc被攻击，当npc血量为0时，执行一个特效后死亡，","more":"过程如下：</p>\n<h3 id=\"首先自己实现一个Npc精灵类，其中包含血量属性，包含被攻击的方法\"><a href=\"#首先自己实现一个Npc精灵类，其中包含血量属性，包含被攻击的方法\" class=\"headerlink\" title=\"首先自己实现一个Npc精灵类，其中包含血量属性，包含被攻击的方法\"></a>首先自己实现一个Npc精灵类，其中包含血量属性，包含被攻击的方法</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> NpcSprite = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    hp:<span class=\"number\">100</span>,<span class=\"comment\">// 血量</span></span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">pic</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super(pic);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 被攻击方法  </span></span><br><span class=\"line\">    attacked:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">attack,layer</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.hp&gt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.hp -= attack*(<span class=\"number\">1</span>+<span class=\"built_in\">Math</span>.random());<span class=\"comment\">// 每次攻击，血量减少基础数值*随机的暴击数值</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> attackTxt = layer.getChildByTag(<span class=\"number\">2</span>);<span class=\"comment\">// 获取攻击按钮，传入死亡回调函数使用</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> hpTxt = layer.getChildByTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.hp = <span class=\"built_in\">this</span>.hp&lt;<span class=\"number\">0</span>?<span class=\"number\">0</span>:<span class=\"built_in\">this</span>.hp;</span><br><span class=\"line\">            hpTxt.setString(<span class=\"string\">&quot;血量:&quot;</span>+<span class=\"built_in\">Math</span>.round(<span class=\"built_in\">this</span>.hp));</span><br><span class=\"line\">            <span class=\"keyword\">var</span> scoreTxt = layer.getChildByTag(<span class=\"number\">4</span>);</span><br><span class=\"line\">            scoreTxt.setString(<span class=\"string\">&quot;分数:&quot;</span>+<span class=\"built_in\">Math</span>.round((<span class=\"number\">100</span>-<span class=\"built_in\">this</span>.hp)*<span class=\"number\">10</span>));</span><br><span class=\"line\">            <span class=\"keyword\">var</span> act = <span class=\"keyword\">new</span> cc.sequence(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1.1</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0.9</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>),cc.callFunc(<span class=\"built_in\">this</span>.dead,<span class=\"built_in\">this</span>,attackTxt));</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.runAction(act);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    dead:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">npc,attackTxt</span>)</span>&#123;<span class=\"comment\">// 死亡回调函数</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(npc.hp&gt;<span class=\"number\">0</span>)&#123;<span class=\"comment\">// 如果hp&gt;0，则没有死，直接return</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// npc执行一个死亡特效后，移除</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> act = <span class=\"keyword\">new</span> cc.spawn(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.1</span>),cc.scaleTo(<span class=\"number\">0.3</span>,<span class=\"number\">0</span>),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">npc,scoreTxt</span>)</span>&#123;</span><br><span class=\"line\">            npc.removeFromParent();</span><br><span class=\"line\">            attackTxt.setString(<span class=\"string\">&quot;战斗胜利&quot;</span>);<span class=\"comment\">// 把攻击按钮文字变成战斗胜利</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> overAct = <span class=\"keyword\">new</span> cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.5</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0.8</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1.2</span>));</span><br><span class=\"line\">            attackTxt.runAction(overAct);<span class=\"comment\">// 战斗胜利再来个特效</span></span><br><span class=\"line\">        &#125;,npc)),cc.rotateBy(<span class=\"number\">0.5</span>,<span class=\"number\">360</span>));</span><br><span class=\"line\">        npc.runAction(act);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"初始化场景中的精灵\"><a href=\"#初始化场景中的精灵\" class=\"headerlink\" title=\"初始化场景中的精灵\"></a>初始化场景中的精灵</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;构造&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc=<span class=\"keyword\">new</span> NpcSprite(res.npc01_png);</span><br><span class=\"line\">        npc.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        npc.setTag(<span class=\"number\">110</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> attack = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;攻击&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">25</span>);</span><br><span class=\"line\">        attack.setPosition(npc.getPositionX()+npc.width/<span class=\"number\">2</span>+<span class=\"number\">100</span>,npc.getPositionY());</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hp = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;血量:&quot;</span>+npc.hp,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">25</span>);</span><br><span class=\"line\">        hp.setPosition(hp.width/<span class=\"number\">2</span>,size.height-hp.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> score = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;分数:0&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">25</span>);</span><br><span class=\"line\">        score.setPosition(size.width-score.width/<span class=\"number\">2</span><span class=\"number\">-100</span>,size.height-score.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(npc);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(attack);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(hp);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(score);</span><br><span class=\"line\">        npc.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        attack.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        hp.setTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        score.setTag(<span class=\"number\">4</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br></pre></td></tr></table></figure>\n<h3 id=\"添加触摸事件管理，点击攻击按钮，触摸区域判断，如果是攻击按钮所在区域，攻击按钮实现放大缩小的点击效果，怪物实现方法缩小的效果（看起来才像是被打了一下）\"><a href=\"#添加触摸事件管理，点击攻击按钮，触摸区域判断，如果是攻击按钮所在区域，攻击按钮实现放大缩小的点击效果，怪物实现方法缩小的效果（看起来才像是被打了一下）\" class=\"headerlink\" title=\"添加触摸事件管理，点击攻击按钮，触摸区域判断，如果是攻击按钮所在区域，攻击按钮实现放大缩小的点击效果，怪物实现方法缩小的效果（看起来才像是被打了一下）\"></a>添加触摸事件管理，点击攻击按钮，触摸区域判断，如果是攻击按钮所在区域，攻击按钮实现放大缩小的点击效果，怪物实现方法缩小的效果（看起来才像是被打了一下）</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;初始化完成&quot;</span>);</span><br><span class=\"line\">       <span class=\"comment\">//添加触屏事件</span></span><br><span class=\"line\">       cc.eventManager.addListener(&#123;</span><br><span class=\"line\">           event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">           swallowTouches:<span class=\"literal\">true</span>,<span class=\"comment\">//吞噬事件 不再传递</span></span><br><span class=\"line\">           onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">           onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">           onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">       &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onExit:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;即将消失&quot;</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;按下&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> nownpc=event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> attack=event.getCurrentTarget().getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> startHp = nownpc.hp;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(touch.getLocation().x&gt;=attack.getPositionX()-attack.width&amp;&amp;touch.getLocation().x&lt;=attack.getPositionX()+attack.width</span><br><span class=\"line\">        &amp;&amp;touch.getLocation().y&gt;=attack.getPositionY()-attack.height&amp;&amp;touch.getLocation().y&lt;=attack.getPositionY()+attack.height)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 点击在区域内，收到攻击</span></span><br><span class=\"line\">            nownpc.attacked(<span class=\"number\">2</span>,event.getCurrentTarget());</span><br><span class=\"line\">            <span class=\"comment\">// 飘出血量减少数字</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> reduceHp = nownpc.hp-startHp;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> num = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;&quot;</span>+<span class=\"built_in\">Math</span>.round(reduceHp),<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">40</span>);</span><br><span class=\"line\">            num.setColor(cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>));</span><br><span class=\"line\">            num.setPosition(nownpc.getPositionX(),nownpc.getPositionY()+nownpc.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">            event.getCurrentTarget().addChild(num);</span><br><span class=\"line\">            num.runAction(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> cc.sequence(</span><br><span class=\"line\">                    <span class=\"keyword\">new</span> cc.spawn(</span><br><span class=\"line\">                        cc.moveBy(<span class=\"number\">0.5</span>,cc.p(<span class=\"number\">0</span>,<span class=\"number\">50</span>)),cc.fadeOut(<span class=\"number\">0.5</span>)</span><br><span class=\"line\">                    ),<span class=\"keyword\">new</span> cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">num</span>)</span>&#123;</span><br><span class=\"line\">                        num.removeFromParent();</span><br><span class=\"line\">                    &#125;,num)</span><br><span class=\"line\">                )</span><br><span class=\"line\">            );</span><br><span class=\"line\">            <span class=\"comment\">// 攻击按钮也变化</span></span><br><span class=\"line\">            attack.runAction(<span class=\"keyword\">new</span> cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.1</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0.9</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;移动&quot;</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchend:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;抬起&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_20/026bc981b469e83ed488c783b4d0b0034233188a/\">http://www.cocoscvp.com/usercode/2016_04_20/026bc981b469e83ed488c783b4d0b0034233188a/</a></p>"},{"title":"CVP认证学习笔记--(何小成)012--组合动作","date":"2016-04-19T14:48:00.000Z","_content":"### 概念\n本节课程讲解了组合动作，结合上节课的node的action知识点，这节课的知识点是组合动作sequence，让多个action按照一定顺序来执行，在课后作业中也提示了，还有一个spawn方法，能让多个action同时执行。<!--more-->\n### 作业\n本节作业是要显示一个gameover，进入画面，变大在变小再变大，结合上节课内容，我让npc先执行完动作序列之后，回调了sequence的最后一个回调函数，回调函数中，我移除了当前的npc，然后添加gameover在屏幕外，然后让gameover执行了作业所要求的动作序列，代码如下：\n```javascript\n        var npc=new cc.Sprite(res.npc01_png)\n        npc.setPosition(0,0);\n        this.addChild(npc);\n        var act=new cc.sequence(\n            cc.moveTo(1,cc.p(300,300))\n            ,cc.moveTo(0.5,cc.p(200,200)),\n            cc.jumpBy(2,cc.p(0,0),80,4),\n            cc.rotateBy(1,180),\n            cc.callFunc(this.removeNpc,npc,this)\n            );\n        npc.runAction(act);//运行组合动作\n\n       removeNpc:function(npc,layer){\n        npc.removeFromParent();\n        var size = cc.winSize;\n        var label = new cc.LabelTTF(\"GAME OVER\",\"Arias\",100);\n        label.setPosition(size.width/2,size.height+label.height/2);\n        layer.addChild(label);\n        var moveAct = new cc.sequence(\n            cc.moveTo(1,cc.p(size.width/2,size.height/2))\n        );\n        var scaleAct = new cc.sequence(\n            cc.scaleTo(1,1.5),\n            cc.scaleTo(1,1)\n        );\n        // 组合同时动作\n        var action = new cc.spawn(moveAct, scaleAct);\n        label.runAction(action);\n    }\n```\n\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_19/faa78b8612541042b0486f92645e6e24201a5f8d/\n","source":"_posts/CVP认证学习笔记--(何小成)012--组合动作 .md","raw":"---\ntitle: CVP认证学习笔记--(何小成)012--组合动作\ndate: 2016-04-19 22:48\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节课程讲解了组合动作，结合上节课的node的action知识点，这节课的知识点是组合动作sequence，让多个action按照一定顺序来执行，在课后作业中也提示了，还有一个spawn方法，能让多个action同时执行。<!--more-->\n### 作业\n本节作业是要显示一个gameover，进入画面，变大在变小再变大，结合上节课内容，我让npc先执行完动作序列之后，回调了sequence的最后一个回调函数，回调函数中，我移除了当前的npc，然后添加gameover在屏幕外，然后让gameover执行了作业所要求的动作序列，代码如下：\n```javascript\n        var npc=new cc.Sprite(res.npc01_png)\n        npc.setPosition(0,0);\n        this.addChild(npc);\n        var act=new cc.sequence(\n            cc.moveTo(1,cc.p(300,300))\n            ,cc.moveTo(0.5,cc.p(200,200)),\n            cc.jumpBy(2,cc.p(0,0),80,4),\n            cc.rotateBy(1,180),\n            cc.callFunc(this.removeNpc,npc,this)\n            );\n        npc.runAction(act);//运行组合动作\n\n       removeNpc:function(npc,layer){\n        npc.removeFromParent();\n        var size = cc.winSize;\n        var label = new cc.LabelTTF(\"GAME OVER\",\"Arias\",100);\n        label.setPosition(size.width/2,size.height+label.height/2);\n        layer.addChild(label);\n        var moveAct = new cc.sequence(\n            cc.moveTo(1,cc.p(size.width/2,size.height/2))\n        );\n        var scaleAct = new cc.sequence(\n            cc.scaleTo(1,1.5),\n            cc.scaleTo(1,1)\n        );\n        // 组合同时动作\n        var action = new cc.spawn(moveAct, scaleAct);\n        label.runAction(action);\n    }\n```\n\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_19/faa78b8612541042b0486f92645e6e24201a5f8d/\n","slug":"CVP认证学习笔记--(何小成)012--组合动作 ","published":1,"updated":"2016-04-24T15:01:36.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhu7000wwsaz7bft5tud","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课程讲解了组合动作，结合上节课的node的action知识点，这节课的知识点是组合动作sequence，让多个action按照一定顺序来执行，在课后作业中也提示了，还有一个spawn方法，能让多个action同时执行。<a id=\"more\"></a></p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业是要显示一个gameover，进入画面，变大在变小再变大，结合上节课内容，我让npc先执行完动作序列之后，回调了sequence的最后一个回调函数，回调函数中，我移除了当前的npc，然后添加gameover在屏幕外，然后让gameover执行了作业所要求的动作序列，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"keyword\">var</span> npc=<span class=\"keyword\">new</span> cc.Sprite(res.npc01_png)</span><br><span class=\"line\">    npc.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(npc);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> act=<span class=\"keyword\">new</span> cc.sequence(</span><br><span class=\"line\">        cc.moveTo(<span class=\"number\">1</span>,cc.p(<span class=\"number\">300</span>,<span class=\"number\">300</span>))</span><br><span class=\"line\">        ,cc.moveTo(<span class=\"number\">0.5</span>,cc.p(<span class=\"number\">200</span>,<span class=\"number\">200</span>)),</span><br><span class=\"line\">        cc.jumpBy(<span class=\"number\">2</span>,cc.p(<span class=\"number\">0</span>,<span class=\"number\">0</span>),<span class=\"number\">80</span>,<span class=\"number\">4</span>),</span><br><span class=\"line\">        cc.rotateBy(<span class=\"number\">1</span>,<span class=\"number\">180</span>),</span><br><span class=\"line\">        cc.callFunc(<span class=\"built_in\">this</span>.removeNpc,npc,<span class=\"built_in\">this</span>)</span><br><span class=\"line\">        );</span><br><span class=\"line\">    npc.runAction(act);<span class=\"comment\">//运行组合动作</span></span><br><span class=\"line\"></span><br><span class=\"line\">   removeNpc:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">npc,layer</span>)</span>&#123;</span><br><span class=\"line\">    npc.removeFromParent();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> label = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;GAME OVER&quot;</span>,<span class=\"string\">&quot;Arias&quot;</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">    label.setPosition(size.width/<span class=\"number\">2</span>,size.height+label.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    layer.addChild(label);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> moveAct = <span class=\"keyword\">new</span> cc.sequence(</span><br><span class=\"line\">        cc.moveTo(<span class=\"number\">1</span>,cc.p(size.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>))</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"keyword\">var</span> scaleAct = <span class=\"keyword\">new</span> cc.sequence(</span><br><span class=\"line\">        cc.scaleTo(<span class=\"number\">1</span>,<span class=\"number\">1.5</span>),</span><br><span class=\"line\">        cc.scaleTo(<span class=\"number\">1</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// 组合同时动作</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> action = <span class=\"keyword\">new</span> cc.spawn(moveAct, scaleAct);</span><br><span class=\"line\">    label.runAction(action);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_19/faa78b8612541042b0486f92645e6e24201a5f8d/\">http://www.cocoscvp.com/usercode/2016_04_19/faa78b8612541042b0486f92645e6e24201a5f8d/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课程讲解了组合动作，结合上节课的node的action知识点，这节课的知识点是组合动作sequence，让多个action按照一定顺序来执行，在课后作业中也提示了，还有一个spawn方法，能让多个action同时执行。","more":"</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业是要显示一个gameover，进入画面，变大在变小再变大，结合上节课内容，我让npc先执行完动作序列之后，回调了sequence的最后一个回调函数，回调函数中，我移除了当前的npc，然后添加gameover在屏幕外，然后让gameover执行了作业所要求的动作序列，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"keyword\">var</span> npc=<span class=\"keyword\">new</span> cc.Sprite(res.npc01_png)</span><br><span class=\"line\">    npc.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(npc);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> act=<span class=\"keyword\">new</span> cc.sequence(</span><br><span class=\"line\">        cc.moveTo(<span class=\"number\">1</span>,cc.p(<span class=\"number\">300</span>,<span class=\"number\">300</span>))</span><br><span class=\"line\">        ,cc.moveTo(<span class=\"number\">0.5</span>,cc.p(<span class=\"number\">200</span>,<span class=\"number\">200</span>)),</span><br><span class=\"line\">        cc.jumpBy(<span class=\"number\">2</span>,cc.p(<span class=\"number\">0</span>,<span class=\"number\">0</span>),<span class=\"number\">80</span>,<span class=\"number\">4</span>),</span><br><span class=\"line\">        cc.rotateBy(<span class=\"number\">1</span>,<span class=\"number\">180</span>),</span><br><span class=\"line\">        cc.callFunc(<span class=\"built_in\">this</span>.removeNpc,npc,<span class=\"built_in\">this</span>)</span><br><span class=\"line\">        );</span><br><span class=\"line\">    npc.runAction(act);<span class=\"comment\">//运行组合动作</span></span><br><span class=\"line\"></span><br><span class=\"line\">   removeNpc:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">npc,layer</span>)</span>&#123;</span><br><span class=\"line\">    npc.removeFromParent();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> label = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;GAME OVER&quot;</span>,<span class=\"string\">&quot;Arias&quot;</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">    label.setPosition(size.width/<span class=\"number\">2</span>,size.height+label.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    layer.addChild(label);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> moveAct = <span class=\"keyword\">new</span> cc.sequence(</span><br><span class=\"line\">        cc.moveTo(<span class=\"number\">1</span>,cc.p(size.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>))</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"keyword\">var</span> scaleAct = <span class=\"keyword\">new</span> cc.sequence(</span><br><span class=\"line\">        cc.scaleTo(<span class=\"number\">1</span>,<span class=\"number\">1.5</span>),</span><br><span class=\"line\">        cc.scaleTo(<span class=\"number\">1</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// 组合同时动作</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> action = <span class=\"keyword\">new</span> cc.spawn(moveAct, scaleAct);</span><br><span class=\"line\">    label.runAction(action);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_19/faa78b8612541042b0486f92645e6e24201a5f8d/\">http://www.cocoscvp.com/usercode/2016_04_19/faa78b8612541042b0486f92645e6e24201a5f8d/</a></p>"},{"title":"CVP认证学习笔记--(何小成)013--在Node的生命周期和图层种处理触摸","date":"2016-04-19T15:40:00.000Z","_content":"本节课内容讲了两个重要的知识点：\n### Node的生命周期\n首先说Node的生命周期，主要是ctor（构造函数）、onEnter、onExit的理解，执行顺序为先调用构造函数，来创建这个Node对象，然后将Node添加到画面中，调用onEnter，Node销毁时，调用onExit。<!--more-->\n### 图层的触摸处理\n在cocos中，有三个概念要明白：\n1. cc.EventListener事件监听器\n2. cc.eventManager事件管理器\n3. cc.Event事件对象\n使用事件就需要创建以下事件监听器中的其中一个\n1. 触摸事件监听器 (cc.EventListenerTouch)\n2. 键盘事件监听器 (cc.EventListenerKeyboard)\n3. 加速计事件监听器 (cc.EventListenerAcceleration)\n4. 鼠标事件监听器 (cc.EventListenerMouse)\n5. 自定义事件监听器 (cc.EventListenerCustom)\n通过以下语句来创建并添加以上各种类型事件监听器：\n```javascript\n       cc.eventManager.addListener({\n           event:cc.EventListener.TOUCH_ONE_BY_ONE,\n           swallowTouches:true,//吞噬事件 不再传递\n           onTouchBegan:this.touchbegan,\n           onTouchMoved:this.touchmoved,\n           onTouchEnded:this.touchended\n       },this);\n\n    touchbegan:function(touch,event)\n    {// 按下事件\n        cc.log(\"按下\");\n        return true;\n    },\n    touchmoved:function(touch,event)\n    {// 移动事件\n        cc.log(\"移动\");\n    },\n    touchend:function(touch,event)\n    { // 抬起事件\n        cc.log(\"抬起\");\n    }\n```\n\n其中，event类型有以下几种：\n1. cc.EventListener.TOUCH_ONE_BY_ONE (单点触摸)\n2. cc.EventListener.TOUCH_ALL_AT_ONCE (多点触摸)\n3. cc.EventListener.KEYBOARD (键盘)\n4. cc.EventListener.MOUSE (鼠标)\n5. cc.EventListener.ACCELERATION (加速计)\n6. cc.EventListener.CUSTOM (自定义)\n\n更多关于cocos的事件管理机制，在官网的帮助文档有详细介绍，地址如下：\nhttp://www.cocos.com/doc/article/index?type=cocos2d-x&url=/doc/cocos-docs-master/manual/framework/cocos2d-js/catalog/../../html5/v3/eventManager/zh.md\n\n### 作业\n本节课作业要求实现点击屏幕添加一个英雄，我实现了点击添加英雄，并且能拖动创建的对象，对象在执行完一个特定的动作序列后移除自身节点，代码如下：\n```javascript\n    onEnter:function()\n    {\n        this._super();\n        cc.log(\"初始化完成\");\n       //添加触屏事件\n       cc.eventManager.addListener({\n           event:cc.EventListener.TOUCH_ONE_BY_ONE,\n           swallowTouches:true,//吞噬事件 不再传递\n           onTouchBegan:this.touchbegan,\n           onTouchMoved:this.touchmoved,\n           onTouchEnded:this.touchended\n       },this);\n\n    },\n    onExit:function()\n    {\n        this._super();\n        cc.log(\"即将消失\");\n    },\n    touchbegan:function(touch,event){\n        cc.log(\"按下\");\n        var npc=new cc.Sprite(res.npc01_png);\n        npc.setPosition(touch.getLocation().x,touch.getLocation().y);\n        // 设置随机角度和缩放\n        npc.setRotation(Math.round(Math.random()*360));\n        npc.setScale(Math.random()*2);\n        // 添加到图层\n        event.getCurrentTarget().addChild(npc);\n        // 设置到全局变量，便于move方法中使用\n        event.getCurrentTarget().sprite = npc;\n        // 执行动作序列后消失\n        var act = new cc.spawn(cc.sequence(\n            cc.rotateBy(2,360),cc.callFunc(function(npc){\n                npc.removeFromParent();\n            },npc)\n        ),cc.scaleTo(2,0));\n        npc.runAction(act);\n        return true;\n    },\n    touchmoved:function(touch,event)\n    {\n        var nownpc= event.getCurrentTarget().sprite;\n        nownpc.setPosition(touch.getLocation().x,touch.getLocation().y);\n        cc.log(\"移动\");\n    },\n    touchend:function(touch,event)\n    {\n        cc.log(\"抬起\");\n    }\n```\n\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_19/d0e83b7672c345f087f2d82bf65e1746ac063afe/\n","source":"_posts/CVP认证学习笔记--(何小成)013--在Node的生命周期和图层种处理触摸.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)013--在Node的生命周期和图层种处理触摸  \ndate: 2016-04-19 23:40\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n本节课内容讲了两个重要的知识点：\n### Node的生命周期\n首先说Node的生命周期，主要是ctor（构造函数）、onEnter、onExit的理解，执行顺序为先调用构造函数，来创建这个Node对象，然后将Node添加到画面中，调用onEnter，Node销毁时，调用onExit。<!--more-->\n### 图层的触摸处理\n在cocos中，有三个概念要明白：\n1. cc.EventListener事件监听器\n2. cc.eventManager事件管理器\n3. cc.Event事件对象\n使用事件就需要创建以下事件监听器中的其中一个\n1. 触摸事件监听器 (cc.EventListenerTouch)\n2. 键盘事件监听器 (cc.EventListenerKeyboard)\n3. 加速计事件监听器 (cc.EventListenerAcceleration)\n4. 鼠标事件监听器 (cc.EventListenerMouse)\n5. 自定义事件监听器 (cc.EventListenerCustom)\n通过以下语句来创建并添加以上各种类型事件监听器：\n```javascript\n       cc.eventManager.addListener({\n           event:cc.EventListener.TOUCH_ONE_BY_ONE,\n           swallowTouches:true,//吞噬事件 不再传递\n           onTouchBegan:this.touchbegan,\n           onTouchMoved:this.touchmoved,\n           onTouchEnded:this.touchended\n       },this);\n\n    touchbegan:function(touch,event)\n    {// 按下事件\n        cc.log(\"按下\");\n        return true;\n    },\n    touchmoved:function(touch,event)\n    {// 移动事件\n        cc.log(\"移动\");\n    },\n    touchend:function(touch,event)\n    { // 抬起事件\n        cc.log(\"抬起\");\n    }\n```\n\n其中，event类型有以下几种：\n1. cc.EventListener.TOUCH_ONE_BY_ONE (单点触摸)\n2. cc.EventListener.TOUCH_ALL_AT_ONCE (多点触摸)\n3. cc.EventListener.KEYBOARD (键盘)\n4. cc.EventListener.MOUSE (鼠标)\n5. cc.EventListener.ACCELERATION (加速计)\n6. cc.EventListener.CUSTOM (自定义)\n\n更多关于cocos的事件管理机制，在官网的帮助文档有详细介绍，地址如下：\nhttp://www.cocos.com/doc/article/index?type=cocos2d-x&url=/doc/cocos-docs-master/manual/framework/cocos2d-js/catalog/../../html5/v3/eventManager/zh.md\n\n### 作业\n本节课作业要求实现点击屏幕添加一个英雄，我实现了点击添加英雄，并且能拖动创建的对象，对象在执行完一个特定的动作序列后移除自身节点，代码如下：\n```javascript\n    onEnter:function()\n    {\n        this._super();\n        cc.log(\"初始化完成\");\n       //添加触屏事件\n       cc.eventManager.addListener({\n           event:cc.EventListener.TOUCH_ONE_BY_ONE,\n           swallowTouches:true,//吞噬事件 不再传递\n           onTouchBegan:this.touchbegan,\n           onTouchMoved:this.touchmoved,\n           onTouchEnded:this.touchended\n       },this);\n\n    },\n    onExit:function()\n    {\n        this._super();\n        cc.log(\"即将消失\");\n    },\n    touchbegan:function(touch,event){\n        cc.log(\"按下\");\n        var npc=new cc.Sprite(res.npc01_png);\n        npc.setPosition(touch.getLocation().x,touch.getLocation().y);\n        // 设置随机角度和缩放\n        npc.setRotation(Math.round(Math.random()*360));\n        npc.setScale(Math.random()*2);\n        // 添加到图层\n        event.getCurrentTarget().addChild(npc);\n        // 设置到全局变量，便于move方法中使用\n        event.getCurrentTarget().sprite = npc;\n        // 执行动作序列后消失\n        var act = new cc.spawn(cc.sequence(\n            cc.rotateBy(2,360),cc.callFunc(function(npc){\n                npc.removeFromParent();\n            },npc)\n        ),cc.scaleTo(2,0));\n        npc.runAction(act);\n        return true;\n    },\n    touchmoved:function(touch,event)\n    {\n        var nownpc= event.getCurrentTarget().sprite;\n        nownpc.setPosition(touch.getLocation().x,touch.getLocation().y);\n        cc.log(\"移动\");\n    },\n    touchend:function(touch,event)\n    {\n        cc.log(\"抬起\");\n    }\n```\n\n### 最后运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_19/d0e83b7672c345f087f2d82bf65e1746ac063afe/\n","slug":"CVP认证学习笔记--(何小成)013--在Node的生命周期和图层种处理触摸","published":1,"updated":"2016-04-24T15:01:28.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhu8000zwsaz37ba298i","content":"<p>本节课内容讲了两个重要的知识点：</p>\n<h3 id=\"Node的生命周期\"><a href=\"#Node的生命周期\" class=\"headerlink\" title=\"Node的生命周期\"></a>Node的生命周期</h3><p>首先说Node的生命周期，主要是ctor（构造函数）、onEnter、onExit的理解，执行顺序为先调用构造函数，来创建这个Node对象，然后将Node添加到画面中，调用onEnter，Node销毁时，调用onExit。<a id=\"more\"></a></p>\n<h3 id=\"图层的触摸处理\"><a href=\"#图层的触摸处理\" class=\"headerlink\" title=\"图层的触摸处理\"></a>图层的触摸处理</h3><p>在cocos中，有三个概念要明白：</p>\n<ol>\n<li>cc.EventListener事件监听器</li>\n<li>cc.eventManager事件管理器</li>\n<li>cc.Event事件对象<br>使用事件就需要创建以下事件监听器中的其中一个</li>\n<li>触摸事件监听器 (cc.EventListenerTouch)</li>\n<li>键盘事件监听器 (cc.EventListenerKeyboard)</li>\n<li>加速计事件监听器 (cc.EventListenerAcceleration)</li>\n<li>鼠标事件监听器 (cc.EventListenerMouse)</li>\n<li>自定义事件监听器 (cc.EventListenerCustom)<br>通过以下语句来创建并添加以上各种类型事件监听器：<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   cc.eventManager.addListener(&#123;</span><br><span class=\"line\">       event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">       swallowTouches:<span class=\"literal\">true</span>,<span class=\"comment\">//吞噬事件 不再传递</span></span><br><span class=\"line\">       onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">       onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">       onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">   &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;<span class=\"comment\">// 按下事件</span></span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;按下&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;<span class=\"comment\">// 移动事件</span></span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;移动&quot;</span>);</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">touchend:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123; <span class=\"comment\">// 抬起事件</span></span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;抬起&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<p>其中，event类型有以下几种：</p>\n<ol>\n<li>cc.EventListener.TOUCH_ONE_BY_ONE (单点触摸)</li>\n<li>cc.EventListener.TOUCH_ALL_AT_ONCE (多点触摸)</li>\n<li>cc.EventListener.KEYBOARD (键盘)</li>\n<li>cc.EventListener.MOUSE (鼠标)</li>\n<li>cc.EventListener.ACCELERATION (加速计)</li>\n<li>cc.EventListener.CUSTOM (自定义)</li>\n</ol>\n<p>更多关于cocos的事件管理机制，在官网的帮助文档有详细介绍，地址如下：<br><a href=\"http://www.cocos.com/doc/article/index?type=cocos2d-x&amp;url=/doc/cocos-docs-master/manual/framework/cocos2d-js/catalog/../../html5/v3/eventManager/zh.md\">http://www.cocos.com/doc/article/index?type=cocos2d-x&amp;url=/doc/cocos-docs-master/manual/framework/cocos2d-js/catalog/../../html5/v3/eventManager/zh.md</a></p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节课作业要求实现点击屏幕添加一个英雄，我实现了点击添加英雄，并且能拖动创建的对象，对象在执行完一个特定的动作序列后移除自身节点，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;初始化完成&quot;</span>);</span><br><span class=\"line\">   <span class=\"comment\">//添加触屏事件</span></span><br><span class=\"line\">   cc.eventManager.addListener(&#123;</span><br><span class=\"line\">       event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">       swallowTouches:<span class=\"literal\">true</span>,<span class=\"comment\">//吞噬事件 不再传递</span></span><br><span class=\"line\">       onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">       onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">       onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">   &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">onExit:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;即将消失&quot;</span>);</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;按下&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> npc=<span class=\"keyword\">new</span> cc.Sprite(res.npc01_png);</span><br><span class=\"line\">    npc.setPosition(touch.getLocation().x,touch.getLocation().y);</span><br><span class=\"line\">    <span class=\"comment\">// 设置随机角度和缩放</span></span><br><span class=\"line\">    npc.setRotation(<span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">360</span>));</span><br><span class=\"line\">    npc.setScale(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 添加到图层</span></span><br><span class=\"line\">    event.getCurrentTarget().addChild(npc);</span><br><span class=\"line\">    <span class=\"comment\">// 设置到全局变量，便于move方法中使用</span></span><br><span class=\"line\">    event.getCurrentTarget().sprite = npc;</span><br><span class=\"line\">    <span class=\"comment\">// 执行动作序列后消失</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> act = <span class=\"keyword\">new</span> cc.spawn(cc.sequence(</span><br><span class=\"line\">        cc.rotateBy(<span class=\"number\">2</span>,<span class=\"number\">360</span>),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">npc</span>)</span>&#123;</span><br><span class=\"line\">            npc.removeFromParent();</span><br><span class=\"line\">        &#125;,npc)</span><br><span class=\"line\">    ),cc.scaleTo(<span class=\"number\">2</span>,<span class=\"number\">0</span>));</span><br><span class=\"line\">    npc.runAction(act);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> nownpc= event.getCurrentTarget().sprite;</span><br><span class=\"line\">    nownpc.setPosition(touch.getLocation().x,touch.getLocation().y);</span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;移动&quot;</span>);</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">touchend:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;抬起&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_19/d0e83b7672c345f087f2d82bf65e1746ac063afe/\">http://www.cocoscvp.com/usercode/2016_04_19/d0e83b7672c345f087f2d82bf65e1746ac063afe/</a></p>\n","site":{"data":{}},"excerpt":"<p>本节课内容讲了两个重要的知识点：</p>\n<h3 id=\"Node的生命周期\"><a href=\"#Node的生命周期\" class=\"headerlink\" title=\"Node的生命周期\"></a>Node的生命周期</h3><p>首先说Node的生命周期，主要是ctor（构造函数）、onEnter、onExit的理解，执行顺序为先调用构造函数，来创建这个Node对象，然后将Node添加到画面中，调用onEnter，Node销毁时，调用onExit。","more":"</p>\n<h3 id=\"图层的触摸处理\"><a href=\"#图层的触摸处理\" class=\"headerlink\" title=\"图层的触摸处理\"></a>图层的触摸处理</h3><p>在cocos中，有三个概念要明白：</p>\n<ol>\n<li>cc.EventListener事件监听器</li>\n<li>cc.eventManager事件管理器</li>\n<li>cc.Event事件对象<br>使用事件就需要创建以下事件监听器中的其中一个</li>\n<li>触摸事件监听器 (cc.EventListenerTouch)</li>\n<li>键盘事件监听器 (cc.EventListenerKeyboard)</li>\n<li>加速计事件监听器 (cc.EventListenerAcceleration)</li>\n<li>鼠标事件监听器 (cc.EventListenerMouse)</li>\n<li>自定义事件监听器 (cc.EventListenerCustom)<br>通过以下语句来创建并添加以上各种类型事件监听器：<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   cc.eventManager.addListener(&#123;</span><br><span class=\"line\">       event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">       swallowTouches:<span class=\"literal\">true</span>,<span class=\"comment\">//吞噬事件 不再传递</span></span><br><span class=\"line\">       onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">       onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">       onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">   &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;<span class=\"comment\">// 按下事件</span></span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;按下&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;<span class=\"comment\">// 移动事件</span></span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;移动&quot;</span>);</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">touchend:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123; <span class=\"comment\">// 抬起事件</span></span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;抬起&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<p>其中，event类型有以下几种：</p>\n<ol>\n<li>cc.EventListener.TOUCH_ONE_BY_ONE (单点触摸)</li>\n<li>cc.EventListener.TOUCH_ALL_AT_ONCE (多点触摸)</li>\n<li>cc.EventListener.KEYBOARD (键盘)</li>\n<li>cc.EventListener.MOUSE (鼠标)</li>\n<li>cc.EventListener.ACCELERATION (加速计)</li>\n<li>cc.EventListener.CUSTOM (自定义)</li>\n</ol>\n<p>更多关于cocos的事件管理机制，在官网的帮助文档有详细介绍，地址如下：<br><a href=\"http://www.cocos.com/doc/article/index?type=cocos2d-x&amp;url=/doc/cocos-docs-master/manual/framework/cocos2d-js/catalog/../../html5/v3/eventManager/zh.md\">http://www.cocos.com/doc/article/index?type=cocos2d-x&amp;url=/doc/cocos-docs-master/manual/framework/cocos2d-js/catalog/../../html5/v3/eventManager/zh.md</a></p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节课作业要求实现点击屏幕添加一个英雄，我实现了点击添加英雄，并且能拖动创建的对象，对象在执行完一个特定的动作序列后移除自身节点，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;初始化完成&quot;</span>);</span><br><span class=\"line\">   <span class=\"comment\">//添加触屏事件</span></span><br><span class=\"line\">   cc.eventManager.addListener(&#123;</span><br><span class=\"line\">       event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">       swallowTouches:<span class=\"literal\">true</span>,<span class=\"comment\">//吞噬事件 不再传递</span></span><br><span class=\"line\">       onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">       onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">       onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">   &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">onExit:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;即将消失&quot;</span>);</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;按下&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> npc=<span class=\"keyword\">new</span> cc.Sprite(res.npc01_png);</span><br><span class=\"line\">    npc.setPosition(touch.getLocation().x,touch.getLocation().y);</span><br><span class=\"line\">    <span class=\"comment\">// 设置随机角度和缩放</span></span><br><span class=\"line\">    npc.setRotation(<span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">360</span>));</span><br><span class=\"line\">    npc.setScale(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 添加到图层</span></span><br><span class=\"line\">    event.getCurrentTarget().addChild(npc);</span><br><span class=\"line\">    <span class=\"comment\">// 设置到全局变量，便于move方法中使用</span></span><br><span class=\"line\">    event.getCurrentTarget().sprite = npc;</span><br><span class=\"line\">    <span class=\"comment\">// 执行动作序列后消失</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> act = <span class=\"keyword\">new</span> cc.spawn(cc.sequence(</span><br><span class=\"line\">        cc.rotateBy(<span class=\"number\">2</span>,<span class=\"number\">360</span>),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">npc</span>)</span>&#123;</span><br><span class=\"line\">            npc.removeFromParent();</span><br><span class=\"line\">        &#125;,npc)</span><br><span class=\"line\">    ),cc.scaleTo(<span class=\"number\">2</span>,<span class=\"number\">0</span>));</span><br><span class=\"line\">    npc.runAction(act);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> nownpc= event.getCurrentTarget().sprite;</span><br><span class=\"line\">    nownpc.setPosition(touch.getLocation().x,touch.getLocation().y);</span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;移动&quot;</span>);</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">touchend:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    cc.log(<span class=\"string\">&quot;抬起&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最后运行效果\"><a href=\"#最后运行效果\" class=\"headerlink\" title=\"最后运行效果\"></a>最后运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_19/d0e83b7672c345f087f2d82bf65e1746ac063afe/\">http://www.cocoscvp.com/usercode/2016_04_19/d0e83b7672c345f087f2d82bf65e1746ac063afe/</a></p>"},{"title":"CVP认证学习笔记--(何小成)015--实现绘图节点","date":"2016-04-21T15:04:00.000Z","_content":"### API\n本节课的内容是讲得node节点的绘制，node提供了绘制的功能，api如下：\n<!--more-->\n```javascript\n       //绘图节点提供了绘制图形的功能 这里提供了很多2d绘图函数\n       var node1=new cc.DrawNode();\n       this.addChild(node1,10);//10就是绘图的排序\n       //画圆            圆心     粗细  颜色\n       node1.drawDot(cc.p(100,100),10,cc.color(255,0,0));\n      //绘制多边形\n      var points=[cc.p(30,30),\n                  cc.p(30,60),\n                  cc.p(60,60),\n                  cc.p(60,30)];\n                  //  点      内部颜色            边线  边线颜色\n       node1.drawPoly(points,cc.color(0,0,255,128),8,cc.color(0,255,0,128));\n       //绘制线段\n       node1.drawSegment(cc.p(60,60),cc.p(200,200),5,cc.color(0,255,255,128));\n       //绘制贝塞尔曲线\n       node1.drawQuadBezier(cc.p(0,cc.winSize.height),//起点\n                           cc.p(cc.winSize.width/2,cc.winSize.height/2),//控制点\n                           cc.p(cc.winSize.width,cc.winSize.height),//终点\n                           50,//控制线段\n                           2,//线条宽度\n                           cc.color(255,0,255,255)); //颜色\n        //绘制曲线\n        var v4=[cc.p(200,200),\n                cc.p(200,300),\n                cc.p(300,300),\n                cc.p(300,200),\n                cc.p(200,200)];\n        node1.drawCardinalSpline(v4,0.5,100,2,cc.color(255,255,255,255));\n```\n### 作业\n课后作业是绘制五星红旗，其实思考之后，就知道，这是其实是一个多边形，通过确定多边形的几个点，就可以绘制出想要的多边形，先确定一个五角星，我们可以从中心点出发，然后到最上面的点，然后挑一个点，再挑一个点，循环，最后回到最上面的点，这样就能绘制一个五角星，api都熟悉了，重点还是那几个点坐标的计算，话说中间才是踩了不少坑啊，如果不小心计算出无理数，那这个点就直接飘到0，0去了，还必须取个整；完成了单个五角星绘制，其他就好说了，封装好了五角星绘制的方法，传入坐标和半径就能绘制，然后把五角星放在相应的坐标上就行了，代码如下：\n```javascript\nvar Layer0209 = cc.Layer.extend({\n        // sprite:null,\n        ctor: function () {\n            this._super();\n            var size = cc.winSize;\n            var rect = new cc.DrawNode();\n            this.addChild(rect);\n            //红色矩形\n            var points = [\n                cc.p(0, 0),\n                cc.p(size.width, 0),\n                cc.p(size.width, size.height),\n                cc.p(0, size.height)\n            ];\n            // 画矩形\n            rect.drawPoly(points, cc.color(255, 0, 0, 255), 0, cc.color(255, 0, 0, 255));\n            // 画中间的大五角星\n            var centerX = 150;\n            var centerY = size.height - 150;\n            var bigStar = this.drawStar(centerX, centerY, 80);\n            rect.addChild(bigStar);\n            // 画四个小五角星\n            var r = 150;\n            for (var i = 0; i <= 3; i++) {\n                var star = this.drawStar(centerX + Math.round(r * Math.cos(Math.PI * 36 * (1 - i) / 180)), centerY + Math.round(r * Math.sin(Math.PI * 36 * (1 - i) / 180)), 20);\n                rect.addChild(star);\n            }\n            return true;\n        },\n        // 绘制五角星,传入半径,及中心点坐标\n        drawStar: function (x, y, r) {\n            var points = [];\n            //五角星中心点\n            points.push(cc.p(x, y));\n            var angle = 4 * Math.PI / 5;\n            var star = new cc.DrawNode();\n            for (var i = 1; i <= 5; i++) {\n                points.push(cc.p(Math.round(x + Math.sin(i * angle) * r), Math.round(y + Math.cos(i * angle) * r)));\n            }\n            points.push(cc.p(Math.round(x + Math.sin(angle) * r), Math.round(y + Math.cos(angle) * r)));\n            star.drawPoly(points, cc.color(255, 255, 0, 255), 0, cc.color(255, 255, 0, 255));\n            return star;\n        }\n    })\n    ;\n\nvar Scene0209 = cc.Scene.extend({\n    onEnter: function () {\n        this._super();\n        var layer = new Layer0209();\n        this.addChild(layer);\n        return true;\n    }\n});\n```\n\n### 最后效果\nhttp://www.cocoscvp.com/usercode/2016_04_20/c3c8eccd6594c99258a6062239a643b405909593/\n","source":"_posts/CVP认证学习笔记--(何小成)015--实现绘图节点.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)015--实现绘图节点\ndate: 2016-04-21 23:04\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### API\n本节课的内容是讲得node节点的绘制，node提供了绘制的功能，api如下：\n<!--more-->\n```javascript\n       //绘图节点提供了绘制图形的功能 这里提供了很多2d绘图函数\n       var node1=new cc.DrawNode();\n       this.addChild(node1,10);//10就是绘图的排序\n       //画圆            圆心     粗细  颜色\n       node1.drawDot(cc.p(100,100),10,cc.color(255,0,0));\n      //绘制多边形\n      var points=[cc.p(30,30),\n                  cc.p(30,60),\n                  cc.p(60,60),\n                  cc.p(60,30)];\n                  //  点      内部颜色            边线  边线颜色\n       node1.drawPoly(points,cc.color(0,0,255,128),8,cc.color(0,255,0,128));\n       //绘制线段\n       node1.drawSegment(cc.p(60,60),cc.p(200,200),5,cc.color(0,255,255,128));\n       //绘制贝塞尔曲线\n       node1.drawQuadBezier(cc.p(0,cc.winSize.height),//起点\n                           cc.p(cc.winSize.width/2,cc.winSize.height/2),//控制点\n                           cc.p(cc.winSize.width,cc.winSize.height),//终点\n                           50,//控制线段\n                           2,//线条宽度\n                           cc.color(255,0,255,255)); //颜色\n        //绘制曲线\n        var v4=[cc.p(200,200),\n                cc.p(200,300),\n                cc.p(300,300),\n                cc.p(300,200),\n                cc.p(200,200)];\n        node1.drawCardinalSpline(v4,0.5,100,2,cc.color(255,255,255,255));\n```\n### 作业\n课后作业是绘制五星红旗，其实思考之后，就知道，这是其实是一个多边形，通过确定多边形的几个点，就可以绘制出想要的多边形，先确定一个五角星，我们可以从中心点出发，然后到最上面的点，然后挑一个点，再挑一个点，循环，最后回到最上面的点，这样就能绘制一个五角星，api都熟悉了，重点还是那几个点坐标的计算，话说中间才是踩了不少坑啊，如果不小心计算出无理数，那这个点就直接飘到0，0去了，还必须取个整；完成了单个五角星绘制，其他就好说了，封装好了五角星绘制的方法，传入坐标和半径就能绘制，然后把五角星放在相应的坐标上就行了，代码如下：\n```javascript\nvar Layer0209 = cc.Layer.extend({\n        // sprite:null,\n        ctor: function () {\n            this._super();\n            var size = cc.winSize;\n            var rect = new cc.DrawNode();\n            this.addChild(rect);\n            //红色矩形\n            var points = [\n                cc.p(0, 0),\n                cc.p(size.width, 0),\n                cc.p(size.width, size.height),\n                cc.p(0, size.height)\n            ];\n            // 画矩形\n            rect.drawPoly(points, cc.color(255, 0, 0, 255), 0, cc.color(255, 0, 0, 255));\n            // 画中间的大五角星\n            var centerX = 150;\n            var centerY = size.height - 150;\n            var bigStar = this.drawStar(centerX, centerY, 80);\n            rect.addChild(bigStar);\n            // 画四个小五角星\n            var r = 150;\n            for (var i = 0; i <= 3; i++) {\n                var star = this.drawStar(centerX + Math.round(r * Math.cos(Math.PI * 36 * (1 - i) / 180)), centerY + Math.round(r * Math.sin(Math.PI * 36 * (1 - i) / 180)), 20);\n                rect.addChild(star);\n            }\n            return true;\n        },\n        // 绘制五角星,传入半径,及中心点坐标\n        drawStar: function (x, y, r) {\n            var points = [];\n            //五角星中心点\n            points.push(cc.p(x, y));\n            var angle = 4 * Math.PI / 5;\n            var star = new cc.DrawNode();\n            for (var i = 1; i <= 5; i++) {\n                points.push(cc.p(Math.round(x + Math.sin(i * angle) * r), Math.round(y + Math.cos(i * angle) * r)));\n            }\n            points.push(cc.p(Math.round(x + Math.sin(angle) * r), Math.round(y + Math.cos(angle) * r)));\n            star.drawPoly(points, cc.color(255, 255, 0, 255), 0, cc.color(255, 255, 0, 255));\n            return star;\n        }\n    })\n    ;\n\nvar Scene0209 = cc.Scene.extend({\n    onEnter: function () {\n        this._super();\n        var layer = new Layer0209();\n        this.addChild(layer);\n        return true;\n    }\n});\n```\n\n### 最后效果\nhttp://www.cocoscvp.com/usercode/2016_04_20/c3c8eccd6594c99258a6062239a643b405909593/\n","slug":"CVP认证学习笔记--(何小成)015--实现绘图节点","published":1,"updated":"2016-04-24T15:01:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhua0013wsazg4793syj","content":"<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>本节课的内容是讲得node节点的绘制，node提供了绘制的功能，api如下：</p>\n<a id=\"more\"></a>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">//绘图节点提供了绘制图形的功能 这里提供了很多2d绘图函数</span></span><br><span class=\"line\"> <span class=\"keyword\">var</span> node1=<span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\"> <span class=\"built_in\">this</span>.addChild(node1,<span class=\"number\">10</span>);<span class=\"comment\">//10就是绘图的排序</span></span><br><span class=\"line\"> <span class=\"comment\">//画圆            圆心     粗细  颜色</span></span><br><span class=\"line\"> node1.drawDot(cc.p(<span class=\"number\">100</span>,<span class=\"number\">100</span>),<span class=\"number\">10</span>,cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>));</span><br><span class=\"line\"><span class=\"comment\">//绘制多边形</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> points=[cc.p(<span class=\"number\">30</span>,<span class=\"number\">30</span>),</span><br><span class=\"line\">            cc.p(<span class=\"number\">30</span>,<span class=\"number\">60</span>),</span><br><span class=\"line\">            cc.p(<span class=\"number\">60</span>,<span class=\"number\">60</span>),</span><br><span class=\"line\">            cc.p(<span class=\"number\">60</span>,<span class=\"number\">30</span>)];</span><br><span class=\"line\">            <span class=\"comment\">//  点      内部颜色            边线  边线颜色</span></span><br><span class=\"line\"> node1.drawPoly(points,cc.color(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>,<span class=\"number\">128</span>),<span class=\"number\">8</span>,cc.color(<span class=\"number\">0</span>,<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">128</span>));</span><br><span class=\"line\"> <span class=\"comment\">//绘制线段</span></span><br><span class=\"line\"> node1.drawSegment(cc.p(<span class=\"number\">60</span>,<span class=\"number\">60</span>),cc.p(<span class=\"number\">200</span>,<span class=\"number\">200</span>),<span class=\"number\">5</span>,cc.color(<span class=\"number\">0</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">128</span>));</span><br><span class=\"line\"> <span class=\"comment\">//绘制贝塞尔曲线</span></span><br><span class=\"line\"> node1.drawQuadBezier(cc.p(<span class=\"number\">0</span>,cc.winSize.height),<span class=\"comment\">//起点</span></span><br><span class=\"line\">                     cc.p(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>),<span class=\"comment\">//控制点</span></span><br><span class=\"line\">                     cc.p(cc.winSize.width,cc.winSize.height),<span class=\"comment\">//终点</span></span><br><span class=\"line\">                     <span class=\"number\">50</span>,<span class=\"comment\">//控制线段</span></span><br><span class=\"line\">                     <span class=\"number\">2</span>,<span class=\"comment\">//线条宽度</span></span><br><span class=\"line\">                     cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>)); <span class=\"comment\">//颜色</span></span><br><span class=\"line\">  <span class=\"comment\">//绘制曲线</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> v4=[cc.p(<span class=\"number\">200</span>,<span class=\"number\">200</span>),</span><br><span class=\"line\">          cc.p(<span class=\"number\">200</span>,<span class=\"number\">300</span>),</span><br><span class=\"line\">          cc.p(<span class=\"number\">300</span>,<span class=\"number\">300</span>),</span><br><span class=\"line\">          cc.p(<span class=\"number\">300</span>,<span class=\"number\">200</span>),</span><br><span class=\"line\">          cc.p(<span class=\"number\">200</span>,<span class=\"number\">200</span>)];</span><br><span class=\"line\">  node1.drawCardinalSpline(v4,<span class=\"number\">0.5</span>,<span class=\"number\">100</span>,<span class=\"number\">2</span>,cc.color(<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>));</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>课后作业是绘制五星红旗，其实思考之后，就知道，这是其实是一个多边形，通过确定多边形的几个点，就可以绘制出想要的多边形，先确定一个五角星，我们可以从中心点出发，然后到最上面的点，然后挑一个点，再挑一个点，循环，最后回到最上面的点，这样就能绘制一个五角星，api都熟悉了，重点还是那几个点坐标的计算，话说中间才是踩了不少坑啊，如果不小心计算出无理数，那这个点就直接飘到0，0去了，还必须取个整；完成了单个五角星绘制，其他就好说了，封装好了五角星绘制的方法，传入坐标和半径就能绘制，然后把五角星放在相应的坐标上就行了，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Layer0209 = cc.Layer.extend(&#123;</span><br><span class=\"line\">        <span class=\"comment\">// sprite:null,</span></span><br><span class=\"line\">        ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">            <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> rect = <span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(rect);</span><br><span class=\"line\">            <span class=\"comment\">//红色矩形</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> points = [</span><br><span class=\"line\">                cc.p(<span class=\"number\">0</span>, <span class=\"number\">0</span>),</span><br><span class=\"line\">                cc.p(size.width, <span class=\"number\">0</span>),</span><br><span class=\"line\">                cc.p(size.width, size.height),</span><br><span class=\"line\">                cc.p(<span class=\"number\">0</span>, size.height)</span><br><span class=\"line\">            ];</span><br><span class=\"line\">            <span class=\"comment\">// 画矩形</span></span><br><span class=\"line\">            rect.drawPoly(points, cc.color(<span class=\"number\">255</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">255</span>), <span class=\"number\">0</span>, cc.color(<span class=\"number\">255</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"comment\">// 画中间的大五角星</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> centerX = <span class=\"number\">150</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> centerY = size.height - <span class=\"number\">150</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> bigStar = <span class=\"built_in\">this</span>.drawStar(centerX, centerY, <span class=\"number\">80</span>);</span><br><span class=\"line\">            rect.addChild(bigStar);</span><br><span class=\"line\">            <span class=\"comment\">// 画四个小五角星</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> r = <span class=\"number\">150</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt;= <span class=\"number\">3</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> star = <span class=\"built_in\">this</span>.drawStar(centerX + <span class=\"built_in\">Math</span>.round(r * <span class=\"built_in\">Math</span>.cos(<span class=\"built_in\">Math</span>.PI * <span class=\"number\">36</span> * (<span class=\"number\">1</span> - i) / <span class=\"number\">180</span>)), centerY + <span class=\"built_in\">Math</span>.round(r * <span class=\"built_in\">Math</span>.sin(<span class=\"built_in\">Math</span>.PI * <span class=\"number\">36</span> * (<span class=\"number\">1</span> - i) / <span class=\"number\">180</span>)), <span class=\"number\">20</span>);</span><br><span class=\"line\">                rect.addChild(star);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"comment\">// 绘制五角星,传入半径,及中心点坐标</span></span><br><span class=\"line\">        drawStar: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">x, y, r</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> points = [];</span><br><span class=\"line\">            <span class=\"comment\">//五角星中心点</span></span><br><span class=\"line\">            points.push(cc.p(x, y));</span><br><span class=\"line\">            <span class=\"keyword\">var</span> angle = <span class=\"number\">4</span> * <span class=\"built_in\">Math</span>.PI / <span class=\"number\">5</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> star = <span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt;= <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">                points.push(cc.p(<span class=\"built_in\">Math</span>.round(x + <span class=\"built_in\">Math</span>.sin(i * angle) * r), <span class=\"built_in\">Math</span>.round(y + <span class=\"built_in\">Math</span>.cos(i * angle) * r)));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            points.push(cc.p(<span class=\"built_in\">Math</span>.round(x + <span class=\"built_in\">Math</span>.sin(angle) * r), <span class=\"built_in\">Math</span>.round(y + <span class=\"built_in\">Math</span>.cos(angle) * r)));</span><br><span class=\"line\">            star.drawPoly(points, cc.color(<span class=\"number\">255</span>, <span class=\"number\">255</span>, <span class=\"number\">0</span>, <span class=\"number\">255</span>), <span class=\"number\">0</span>, cc.color(<span class=\"number\">255</span>, <span class=\"number\">255</span>, <span class=\"number\">0</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">return</span> star;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    ;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Scene0209 = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> Layer0209();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最后效果\"><a href=\"#最后效果\" class=\"headerlink\" title=\"最后效果\"></a>最后效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_20/c3c8eccd6594c99258a6062239a643b405909593/\">http://www.cocoscvp.com/usercode/2016_04_20/c3c8eccd6594c99258a6062239a643b405909593/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>本节课的内容是讲得node节点的绘制，node提供了绘制的功能，api如下：</p>","more":"<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">//绘图节点提供了绘制图形的功能 这里提供了很多2d绘图函数</span></span><br><span class=\"line\"> <span class=\"keyword\">var</span> node1=<span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\"> <span class=\"built_in\">this</span>.addChild(node1,<span class=\"number\">10</span>);<span class=\"comment\">//10就是绘图的排序</span></span><br><span class=\"line\"> <span class=\"comment\">//画圆            圆心     粗细  颜色</span></span><br><span class=\"line\"> node1.drawDot(cc.p(<span class=\"number\">100</span>,<span class=\"number\">100</span>),<span class=\"number\">10</span>,cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>));</span><br><span class=\"line\"><span class=\"comment\">//绘制多边形</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> points=[cc.p(<span class=\"number\">30</span>,<span class=\"number\">30</span>),</span><br><span class=\"line\">            cc.p(<span class=\"number\">30</span>,<span class=\"number\">60</span>),</span><br><span class=\"line\">            cc.p(<span class=\"number\">60</span>,<span class=\"number\">60</span>),</span><br><span class=\"line\">            cc.p(<span class=\"number\">60</span>,<span class=\"number\">30</span>)];</span><br><span class=\"line\">            <span class=\"comment\">//  点      内部颜色            边线  边线颜色</span></span><br><span class=\"line\"> node1.drawPoly(points,cc.color(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>,<span class=\"number\">128</span>),<span class=\"number\">8</span>,cc.color(<span class=\"number\">0</span>,<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">128</span>));</span><br><span class=\"line\"> <span class=\"comment\">//绘制线段</span></span><br><span class=\"line\"> node1.drawSegment(cc.p(<span class=\"number\">60</span>,<span class=\"number\">60</span>),cc.p(<span class=\"number\">200</span>,<span class=\"number\">200</span>),<span class=\"number\">5</span>,cc.color(<span class=\"number\">0</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">128</span>));</span><br><span class=\"line\"> <span class=\"comment\">//绘制贝塞尔曲线</span></span><br><span class=\"line\"> node1.drawQuadBezier(cc.p(<span class=\"number\">0</span>,cc.winSize.height),<span class=\"comment\">//起点</span></span><br><span class=\"line\">                     cc.p(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>),<span class=\"comment\">//控制点</span></span><br><span class=\"line\">                     cc.p(cc.winSize.width,cc.winSize.height),<span class=\"comment\">//终点</span></span><br><span class=\"line\">                     <span class=\"number\">50</span>,<span class=\"comment\">//控制线段</span></span><br><span class=\"line\">                     <span class=\"number\">2</span>,<span class=\"comment\">//线条宽度</span></span><br><span class=\"line\">                     cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>)); <span class=\"comment\">//颜色</span></span><br><span class=\"line\">  <span class=\"comment\">//绘制曲线</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> v4=[cc.p(<span class=\"number\">200</span>,<span class=\"number\">200</span>),</span><br><span class=\"line\">          cc.p(<span class=\"number\">200</span>,<span class=\"number\">300</span>),</span><br><span class=\"line\">          cc.p(<span class=\"number\">300</span>,<span class=\"number\">300</span>),</span><br><span class=\"line\">          cc.p(<span class=\"number\">300</span>,<span class=\"number\">200</span>),</span><br><span class=\"line\">          cc.p(<span class=\"number\">200</span>,<span class=\"number\">200</span>)];</span><br><span class=\"line\">  node1.drawCardinalSpline(v4,<span class=\"number\">0.5</span>,<span class=\"number\">100</span>,<span class=\"number\">2</span>,cc.color(<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>));</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>课后作业是绘制五星红旗，其实思考之后，就知道，这是其实是一个多边形，通过确定多边形的几个点，就可以绘制出想要的多边形，先确定一个五角星，我们可以从中心点出发，然后到最上面的点，然后挑一个点，再挑一个点，循环，最后回到最上面的点，这样就能绘制一个五角星，api都熟悉了，重点还是那几个点坐标的计算，话说中间才是踩了不少坑啊，如果不小心计算出无理数，那这个点就直接飘到0，0去了，还必须取个整；完成了单个五角星绘制，其他就好说了，封装好了五角星绘制的方法，传入坐标和半径就能绘制，然后把五角星放在相应的坐标上就行了，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Layer0209 = cc.Layer.extend(&#123;</span><br><span class=\"line\">        <span class=\"comment\">// sprite:null,</span></span><br><span class=\"line\">        ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">            <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> rect = <span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(rect);</span><br><span class=\"line\">            <span class=\"comment\">//红色矩形</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> points = [</span><br><span class=\"line\">                cc.p(<span class=\"number\">0</span>, <span class=\"number\">0</span>),</span><br><span class=\"line\">                cc.p(size.width, <span class=\"number\">0</span>),</span><br><span class=\"line\">                cc.p(size.width, size.height),</span><br><span class=\"line\">                cc.p(<span class=\"number\">0</span>, size.height)</span><br><span class=\"line\">            ];</span><br><span class=\"line\">            <span class=\"comment\">// 画矩形</span></span><br><span class=\"line\">            rect.drawPoly(points, cc.color(<span class=\"number\">255</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">255</span>), <span class=\"number\">0</span>, cc.color(<span class=\"number\">255</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"comment\">// 画中间的大五角星</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> centerX = <span class=\"number\">150</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> centerY = size.height - <span class=\"number\">150</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> bigStar = <span class=\"built_in\">this</span>.drawStar(centerX, centerY, <span class=\"number\">80</span>);</span><br><span class=\"line\">            rect.addChild(bigStar);</span><br><span class=\"line\">            <span class=\"comment\">// 画四个小五角星</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> r = <span class=\"number\">150</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt;= <span class=\"number\">3</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> star = <span class=\"built_in\">this</span>.drawStar(centerX + <span class=\"built_in\">Math</span>.round(r * <span class=\"built_in\">Math</span>.cos(<span class=\"built_in\">Math</span>.PI * <span class=\"number\">36</span> * (<span class=\"number\">1</span> - i) / <span class=\"number\">180</span>)), centerY + <span class=\"built_in\">Math</span>.round(r * <span class=\"built_in\">Math</span>.sin(<span class=\"built_in\">Math</span>.PI * <span class=\"number\">36</span> * (<span class=\"number\">1</span> - i) / <span class=\"number\">180</span>)), <span class=\"number\">20</span>);</span><br><span class=\"line\">                rect.addChild(star);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"comment\">// 绘制五角星,传入半径,及中心点坐标</span></span><br><span class=\"line\">        drawStar: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">x, y, r</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> points = [];</span><br><span class=\"line\">            <span class=\"comment\">//五角星中心点</span></span><br><span class=\"line\">            points.push(cc.p(x, y));</span><br><span class=\"line\">            <span class=\"keyword\">var</span> angle = <span class=\"number\">4</span> * <span class=\"built_in\">Math</span>.PI / <span class=\"number\">5</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> star = <span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt;= <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">                points.push(cc.p(<span class=\"built_in\">Math</span>.round(x + <span class=\"built_in\">Math</span>.sin(i * angle) * r), <span class=\"built_in\">Math</span>.round(y + <span class=\"built_in\">Math</span>.cos(i * angle) * r)));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            points.push(cc.p(<span class=\"built_in\">Math</span>.round(x + <span class=\"built_in\">Math</span>.sin(angle) * r), <span class=\"built_in\">Math</span>.round(y + <span class=\"built_in\">Math</span>.cos(angle) * r)));</span><br><span class=\"line\">            star.drawPoly(points, cc.color(<span class=\"number\">255</span>, <span class=\"number\">255</span>, <span class=\"number\">0</span>, <span class=\"number\">255</span>), <span class=\"number\">0</span>, cc.color(<span class=\"number\">255</span>, <span class=\"number\">255</span>, <span class=\"number\">0</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">return</span> star;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    ;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Scene0209 = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> Layer0209();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最后效果\"><a href=\"#最后效果\" class=\"headerlink\" title=\"最后效果\"></a>最后效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_20/c3c8eccd6594c99258a6062239a643b405909593/\">http://www.cocoscvp.com/usercode/2016_04_20/c3c8eccd6594c99258a6062239a643b405909593/</a></p>"},{"title":"CVP认证学习笔记--(何小成)016--实现纹理缓存","date":"2016-04-22T16:49:00.000Z","_content":"### 概念\n本节课内容讲的精灵的纹理缓存，由于在手机上的资源是非常宝贵的，遇到多个相同图片的精灵，我们不可能一个一个绘制，cocos中提供了纹理缓存机制，在程序预加载之后，就已经放在了纹理缓存中，而我们new cc.Sprite的时候，<!--more-->构造函数默认会先从textureCache中去取图片，取不到图片才会选择load一个，这个过程我们也可以从cc.Sprite的源码中看到。纹理就相当于调用了canvas绘图来绘制一个图片，这个图片用的人都可以拿去用这同一个图片，然后Sprite就相当于封装一个精灵，包含图片以及其他属性。\n### 作业\n本节课的作业，是完成通过纹理加载一个精灵“冰女”（话说跟我们公司的某游戏的冰女美术形象长得好像。。。），然后点击屏幕中的位置，冰女可以移动过去，相当于本节课纹理加载图片和上节课触摸事件的综合应用。\n我实现了通过点击屏幕，冰女会在一定时间内跳跃着过去，如果方向不同，精灵还会进行水平翻转的效果：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    npcDirect:\"right\",// 精灵面部朝向\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        //为了显示和管理所有图片资源\n        // cocos 定义了纹理缓存对象\n        var bgTexture=cc.textureCache.addImage(\"res/bg.jpg\");//读取图片到缓存\n        var bnTexture=cc.textureCache.addImage(\"res/h2.png\");\n        //使用纹理对象来创建sprite \n        //纹理对象是对 Image的封装，包含了图片的像素信息但不能直接显示需要\n        //通过sprite来包装 \n        var bg=new cc.Sprite(bgTexture);\n        this.addChild(bg);\n        bg.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        var bn=new cc.Sprite(bnTexture);\n        this.addChild(bn);\n        bn.setPosition(200,200);\n        bn.setScale(0.1);\n        bn.setTag(1);\n        return true;\n    },\n    onEnter:function(){\n        this._super();\n        //添加触屏事件\n       cc.eventManager.addListener({\n           event:cc.EventListener.TOUCH_ONE_BY_ONE,\n           swallowTouches:true,//吞噬事件 不再传递\n           onTouchBegan:this.touchbegan,\n           onTouchMoved:this.touchmoved,\n           onTouchEnded:this.touchended\n       },this);\n    },\n    touchbegan:function(touch,event){\n        var x = touch.getLocation().x;\n        var y = touch.getLocation().y;\n        var bn = event.getCurrentTarget().getChildByTag(1);\n        // 走路时间\n        var time = Math.round(Math.sqrt(Math.pow(x-bn.getPositionX(),2)+Math.pow(y-bn.getPositionY(),2)))/100;\n        // 跳跃次数\n        var jumps = Math.round(Math.sqrt(Math.pow(x-bn.getPositionX(),2)+Math.pow(y-bn.getPositionY(),2)))/20;\n        bn.stopAllActions();\n        if(event.getCurrentTarget().npcDirect==\"right\"&&x<bn.getPositionX()){\n            // 转向\n            event.getCurrentTarget().npcDirect = \"left\";\n            bn.runAction(cc.flipX(true));// 水平翻转\n        }else if(event.getCurrentTarget().npcDirect==\"left\"&&x>bn.getPositionX()){\n            // 转向\n            event.getCurrentTarget().npcDirect = \"right\";\n            bn.runAction(cc.flipX(false));// 翻转回来\n        }\n        bn.runAction(cc.jumpTo(time,cc.p(x,y),10,jumps));\n        return true;\n    },\n    touchmoved:function(){\n        return true;\n    },\n    touchended:function(touch,event){\n        return true;\n    }\n});\n \nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_22/38160c80fb0e368cc9ab2cff54bad163961fbfb5/ \n\n","source":"_posts/CVP认证学习笔记--(何小成)016--实现纹理缓存.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)016--实现纹理缓存\ndate: 2016-04-23 00:49\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节课内容讲的精灵的纹理缓存，由于在手机上的资源是非常宝贵的，遇到多个相同图片的精灵，我们不可能一个一个绘制，cocos中提供了纹理缓存机制，在程序预加载之后，就已经放在了纹理缓存中，而我们new cc.Sprite的时候，<!--more-->构造函数默认会先从textureCache中去取图片，取不到图片才会选择load一个，这个过程我们也可以从cc.Sprite的源码中看到。纹理就相当于调用了canvas绘图来绘制一个图片，这个图片用的人都可以拿去用这同一个图片，然后Sprite就相当于封装一个精灵，包含图片以及其他属性。\n### 作业\n本节课的作业，是完成通过纹理加载一个精灵“冰女”（话说跟我们公司的某游戏的冰女美术形象长得好像。。。），然后点击屏幕中的位置，冰女可以移动过去，相当于本节课纹理加载图片和上节课触摸事件的综合应用。\n我实现了通过点击屏幕，冰女会在一定时间内跳跃着过去，如果方向不同，精灵还会进行水平翻转的效果：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    npcDirect:\"right\",// 精灵面部朝向\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        //为了显示和管理所有图片资源\n        // cocos 定义了纹理缓存对象\n        var bgTexture=cc.textureCache.addImage(\"res/bg.jpg\");//读取图片到缓存\n        var bnTexture=cc.textureCache.addImage(\"res/h2.png\");\n        //使用纹理对象来创建sprite \n        //纹理对象是对 Image的封装，包含了图片的像素信息但不能直接显示需要\n        //通过sprite来包装 \n        var bg=new cc.Sprite(bgTexture);\n        this.addChild(bg);\n        bg.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        var bn=new cc.Sprite(bnTexture);\n        this.addChild(bn);\n        bn.setPosition(200,200);\n        bn.setScale(0.1);\n        bn.setTag(1);\n        return true;\n    },\n    onEnter:function(){\n        this._super();\n        //添加触屏事件\n       cc.eventManager.addListener({\n           event:cc.EventListener.TOUCH_ONE_BY_ONE,\n           swallowTouches:true,//吞噬事件 不再传递\n           onTouchBegan:this.touchbegan,\n           onTouchMoved:this.touchmoved,\n           onTouchEnded:this.touchended\n       },this);\n    },\n    touchbegan:function(touch,event){\n        var x = touch.getLocation().x;\n        var y = touch.getLocation().y;\n        var bn = event.getCurrentTarget().getChildByTag(1);\n        // 走路时间\n        var time = Math.round(Math.sqrt(Math.pow(x-bn.getPositionX(),2)+Math.pow(y-bn.getPositionY(),2)))/100;\n        // 跳跃次数\n        var jumps = Math.round(Math.sqrt(Math.pow(x-bn.getPositionX(),2)+Math.pow(y-bn.getPositionY(),2)))/20;\n        bn.stopAllActions();\n        if(event.getCurrentTarget().npcDirect==\"right\"&&x<bn.getPositionX()){\n            // 转向\n            event.getCurrentTarget().npcDirect = \"left\";\n            bn.runAction(cc.flipX(true));// 水平翻转\n        }else if(event.getCurrentTarget().npcDirect==\"left\"&&x>bn.getPositionX()){\n            // 转向\n            event.getCurrentTarget().npcDirect = \"right\";\n            bn.runAction(cc.flipX(false));// 翻转回来\n        }\n        bn.runAction(cc.jumpTo(time,cc.p(x,y),10,jumps));\n        return true;\n    },\n    touchmoved:function(){\n        return true;\n    },\n    touchended:function(touch,event){\n        return true;\n    }\n});\n \nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_22/38160c80fb0e368cc9ab2cff54bad163961fbfb5/ \n\n","slug":"CVP认证学习笔记--(何小成)016--实现纹理缓存","published":1,"updated":"2016-04-24T14:56:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhub0016wsaz5a1f9lhk","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课内容讲的精灵的纹理缓存，由于在手机上的资源是非常宝贵的，遇到多个相同图片的精灵，我们不可能一个一个绘制，cocos中提供了纹理缓存机制，在程序预加载之后，就已经放在了纹理缓存中，而我们new cc.Sprite的时候，<a id=\"more\"></a>构造函数默认会先从textureCache中去取图片，取不到图片才会选择load一个，这个过程我们也可以从cc.Sprite的源码中看到。纹理就相当于调用了canvas绘图来绘制一个图片，这个图片用的人都可以拿去用这同一个图片，然后Sprite就相当于封装一个精灵，包含图片以及其他属性。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节课的作业，是完成通过纹理加载一个精灵“冰女”（话说跟我们公司的某游戏的冰女美术形象长得好像。。。），然后点击屏幕中的位置，冰女可以移动过去，相当于本节课纹理加载图片和上节课触摸事件的综合应用。<br>我实现了通过点击屏幕，冰女会在一定时间内跳跃着过去，如果方向不同，精灵还会进行水平翻转的效果：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    npcDirect:<span class=\"string\">&quot;right&quot;</span>,<span class=\"comment\">// 精灵面部朝向</span></span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//为了显示和管理所有图片资源</span></span><br><span class=\"line\">        <span class=\"comment\">// cocos 定义了纹理缓存对象</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bgTexture=cc.textureCache.addImage(<span class=\"string\">&quot;res/bg.jpg&quot;</span>);<span class=\"comment\">//读取图片到缓存</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bnTexture=cc.textureCache.addImage(<span class=\"string\">&quot;res/h2.png&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//使用纹理对象来创建sprite </span></span><br><span class=\"line\">        <span class=\"comment\">//纹理对象是对 Image的封装，包含了图片的像素信息但不能直接显示需要</span></span><br><span class=\"line\">        <span class=\"comment\">//通过sprite来包装 </span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg=<span class=\"keyword\">new</span> cc.Sprite(bgTexture);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        bg.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn=<span class=\"keyword\">new</span> cc.Sprite(bnTexture);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bn);</span><br><span class=\"line\">        bn.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        bn.setScale(<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        bn.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//添加触屏事件</span></span><br><span class=\"line\">       cc.eventManager.addListener(&#123;</span><br><span class=\"line\">           event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">           swallowTouches:<span class=\"literal\">true</span>,<span class=\"comment\">//吞噬事件 不再传递</span></span><br><span class=\"line\">           onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">           onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">           onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">       &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocation().x;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocation().y;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 走路时间</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-bn.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-bn.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 跳跃次数</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> jumps = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-bn.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-bn.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">20</span>;</span><br><span class=\"line\">        bn.stopAllActions();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(event.getCurrentTarget().npcDirect==<span class=\"string\">&quot;right&quot;</span>&amp;&amp;x&lt;bn.getPositionX())&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 转向</span></span><br><span class=\"line\">            event.getCurrentTarget().npcDirect = <span class=\"string\">&quot;left&quot;</span>;</span><br><span class=\"line\">            bn.runAction(cc.flipX(<span class=\"literal\">true</span>));<span class=\"comment\">// 水平翻转</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(event.getCurrentTarget().npcDirect==<span class=\"string\">&quot;left&quot;</span>&amp;&amp;x&gt;bn.getPositionX())&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 转向</span></span><br><span class=\"line\">            event.getCurrentTarget().npcDirect = <span class=\"string\">&quot;right&quot;</span>;</span><br><span class=\"line\">            bn.runAction(cc.flipX(<span class=\"literal\">false</span>));<span class=\"comment\">// 翻转回来</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        bn.runAction(cc.jumpTo(time,cc.p(x,y),<span class=\"number\">10</span>,jumps));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_22/38160c80fb0e368cc9ab2cff54bad163961fbfb5/\">http://www.cocoscvp.com/usercode/2016_04_22/38160c80fb0e368cc9ab2cff54bad163961fbfb5/</a> </p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课内容讲的精灵的纹理缓存，由于在手机上的资源是非常宝贵的，遇到多个相同图片的精灵，我们不可能一个一个绘制，cocos中提供了纹理缓存机制，在程序预加载之后，就已经放在了纹理缓存中，而我们new cc.Sprite的时候，","more":"构造函数默认会先从textureCache中去取图片，取不到图片才会选择load一个，这个过程我们也可以从cc.Sprite的源码中看到。纹理就相当于调用了canvas绘图来绘制一个图片，这个图片用的人都可以拿去用这同一个图片，然后Sprite就相当于封装一个精灵，包含图片以及其他属性。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节课的作业，是完成通过纹理加载一个精灵“冰女”（话说跟我们公司的某游戏的冰女美术形象长得好像。。。），然后点击屏幕中的位置，冰女可以移动过去，相当于本节课纹理加载图片和上节课触摸事件的综合应用。<br>我实现了通过点击屏幕，冰女会在一定时间内跳跃着过去，如果方向不同，精灵还会进行水平翻转的效果：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    npcDirect:<span class=\"string\">&quot;right&quot;</span>,<span class=\"comment\">// 精灵面部朝向</span></span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//为了显示和管理所有图片资源</span></span><br><span class=\"line\">        <span class=\"comment\">// cocos 定义了纹理缓存对象</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bgTexture=cc.textureCache.addImage(<span class=\"string\">&quot;res/bg.jpg&quot;</span>);<span class=\"comment\">//读取图片到缓存</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bnTexture=cc.textureCache.addImage(<span class=\"string\">&quot;res/h2.png&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//使用纹理对象来创建sprite </span></span><br><span class=\"line\">        <span class=\"comment\">//纹理对象是对 Image的封装，包含了图片的像素信息但不能直接显示需要</span></span><br><span class=\"line\">        <span class=\"comment\">//通过sprite来包装 </span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg=<span class=\"keyword\">new</span> cc.Sprite(bgTexture);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        bg.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn=<span class=\"keyword\">new</span> cc.Sprite(bnTexture);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bn);</span><br><span class=\"line\">        bn.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        bn.setScale(<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        bn.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//添加触屏事件</span></span><br><span class=\"line\">       cc.eventManager.addListener(&#123;</span><br><span class=\"line\">           event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">           swallowTouches:<span class=\"literal\">true</span>,<span class=\"comment\">//吞噬事件 不再传递</span></span><br><span class=\"line\">           onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">           onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">           onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">       &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocation().x;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocation().y;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 走路时间</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-bn.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-bn.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 跳跃次数</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> jumps = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-bn.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-bn.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">20</span>;</span><br><span class=\"line\">        bn.stopAllActions();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(event.getCurrentTarget().npcDirect==<span class=\"string\">&quot;right&quot;</span>&amp;&amp;x&lt;bn.getPositionX())&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 转向</span></span><br><span class=\"line\">            event.getCurrentTarget().npcDirect = <span class=\"string\">&quot;left&quot;</span>;</span><br><span class=\"line\">            bn.runAction(cc.flipX(<span class=\"literal\">true</span>));<span class=\"comment\">// 水平翻转</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(event.getCurrentTarget().npcDirect==<span class=\"string\">&quot;left&quot;</span>&amp;&amp;x&gt;bn.getPositionX())&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 转向</span></span><br><span class=\"line\">            event.getCurrentTarget().npcDirect = <span class=\"string\">&quot;right&quot;</span>;</span><br><span class=\"line\">            bn.runAction(cc.flipX(<span class=\"literal\">false</span>));<span class=\"comment\">// 翻转回来</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        bn.runAction(cc.jumpTo(time,cc.p(x,y),<span class=\"number\">10</span>,jumps));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_22/38160c80fb0e368cc9ab2cff54bad163961fbfb5/\">http://www.cocoscvp.com/usercode/2016_04_22/38160c80fb0e368cc9ab2cff54bad163961fbfb5/</a> </p>"},{"title":"CVP认证学习笔记--(何小成)017--图片资源的异步加载","date":"2016-04-23T15:09:00.000Z","_content":"### API\n本节课讲了cocos中图片资源的异步加载，主要涉及到的api如下：\n```javascript\ncc.textureCache.addImageAsync(allpic[n],this.callback,this);\n```\n以上api通过纹理缓存来异步加载资源，实际上每次调试启动的时候的那个进度条也是一个异步加载，这样可以让资源在每个场景需要用到的时候来进行加载，而不用一进游戏就全部加载完成，提高资源利用率。\n<!--more-->\n### 作业\n本节作业要求把示例中的文字显示进度更换了进度条显示，并且提示了使用上一周所学的节点绘制。我的做法是封装一个绘制矩形的方法，通过传入需要的参数来绘制一个矩形，并且每次addImageAsync回调的时候，都更新进度条，使进度条产生一个动态的效果，实现过程如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    process:0,\n    sprite:null,\n    size:cc.winSize,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        //还记得启动我们之前作业的启动画面吗\n        //是在main.js cc.LoadScene.preload .....\n        //这个文件在frameworks/cocos2d-html5/cocos2d/core/scenes/CCloaderScene.js\n        //有兴趣可以看看引擎源码 其原理是用一个场景加载进度\n        // 本节作业：\n        // 本节课介绍如何loading资源在纹理缓存\n        // cc.textureCache提供了很多有用的函数如：\n        // removeTextureCacheForKey(文件名)\n        // clear 清空所有纹理缓存（所以每个游戏的每一关都会load新资源释放旧资源，否则浏览器就崩溃啦）\n        // 本课作业\n        // 实现一个loading进度条（还记得画矩形吗？）\n        // 当loading完成，显示data游戏战斗画面\n        var allpic=[\"res/bg.jpg\",\n                    \"res/h2.png\",\n                    \"res/walk01.png\",\n                    \"res/walk02.png\",\n                    \"res/walk03.png\",\n                    \"res/walk04.png\",\n                    \"res/walk05.png\"];\n        //使用异步任务加载所有图片，定义全局进度process\n        for(var n=0;n<allpic.length;n++) {//异步加载图片\n            cc.textureCache.addImageAsync(allpic[n],this.callback,this);\n        }\n        return true;\n    },\n    callback:function(){//每个图片加载完成都会回调\n        this.process++;\n        var width = this.size.width-50;\n        // 画外框\n        this.drawProgress(1,(this.size.width-width)/2,100,width,50,cc.color(255,0,0,255),5,cc.color(255,0,0,0));\n        var np=this.process*100/7;//计算进度\n        // 画进度\n        this.drawProgress(2,(this.size.width-width)/2,100,width*(np/100),50,cc.color(255,0,0,255),5,cc.color(255,0,0,255));\n        if(np==100){\n            // 加载完成，清除进度条，显示场景资源或通过导演切换场景\n            this.removeChild(100,true);\n            var spbg=new cc.Sprite(\"res/bg.jpg\");//这时候就会从缓存读取\n            this.addChild(spbg);\n            var sphero=new cc.Sprite(\"res/h2.png\");//\n            this.addChild(sphero);\n            spbg.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n            sphero.setScale(0.3);\n            sphero.setPosition(200,200);\n        }\n    },\n    // 绘制进度条\n    drawProgress:function(tag,x,y,width,height,borderColor,border,fillColor){\n        if(this.getChildByTag(tag)!=null){\n            this.removeChildByTag(tag);\n        }\n        var rect = new cc.DrawNode();\n        this.addChild(rect);\n        rect.setTag(tag);\n        var points = [\n            cc.p(x,y),\n            cc.p(x+width,y),\n            cc.p(x+width,y+height),\n            cc.p(x,y+height)\n        ];\n        rect.drawPoly(points, fillColor, border,borderColor);\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_23/5231fee76d1bf8e0db21b35e6e59f9485bf68563/\n\n","source":"_posts/CVP认证学习笔记--(何小成)017--图片资源的异步加载.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)017--图片资源的异步加载\ndate: 2016-04-23 23:09\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### API\n本节课讲了cocos中图片资源的异步加载，主要涉及到的api如下：\n```javascript\ncc.textureCache.addImageAsync(allpic[n],this.callback,this);\n```\n以上api通过纹理缓存来异步加载资源，实际上每次调试启动的时候的那个进度条也是一个异步加载，这样可以让资源在每个场景需要用到的时候来进行加载，而不用一进游戏就全部加载完成，提高资源利用率。\n<!--more-->\n### 作业\n本节作业要求把示例中的文字显示进度更换了进度条显示，并且提示了使用上一周所学的节点绘制。我的做法是封装一个绘制矩形的方法，通过传入需要的参数来绘制一个矩形，并且每次addImageAsync回调的时候，都更新进度条，使进度条产生一个动态的效果，实现过程如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    process:0,\n    sprite:null,\n    size:cc.winSize,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        //还记得启动我们之前作业的启动画面吗\n        //是在main.js cc.LoadScene.preload .....\n        //这个文件在frameworks/cocos2d-html5/cocos2d/core/scenes/CCloaderScene.js\n        //有兴趣可以看看引擎源码 其原理是用一个场景加载进度\n        // 本节作业：\n        // 本节课介绍如何loading资源在纹理缓存\n        // cc.textureCache提供了很多有用的函数如：\n        // removeTextureCacheForKey(文件名)\n        // clear 清空所有纹理缓存（所以每个游戏的每一关都会load新资源释放旧资源，否则浏览器就崩溃啦）\n        // 本课作业\n        // 实现一个loading进度条（还记得画矩形吗？）\n        // 当loading完成，显示data游戏战斗画面\n        var allpic=[\"res/bg.jpg\",\n                    \"res/h2.png\",\n                    \"res/walk01.png\",\n                    \"res/walk02.png\",\n                    \"res/walk03.png\",\n                    \"res/walk04.png\",\n                    \"res/walk05.png\"];\n        //使用异步任务加载所有图片，定义全局进度process\n        for(var n=0;n<allpic.length;n++) {//异步加载图片\n            cc.textureCache.addImageAsync(allpic[n],this.callback,this);\n        }\n        return true;\n    },\n    callback:function(){//每个图片加载完成都会回调\n        this.process++;\n        var width = this.size.width-50;\n        // 画外框\n        this.drawProgress(1,(this.size.width-width)/2,100,width,50,cc.color(255,0,0,255),5,cc.color(255,0,0,0));\n        var np=this.process*100/7;//计算进度\n        // 画进度\n        this.drawProgress(2,(this.size.width-width)/2,100,width*(np/100),50,cc.color(255,0,0,255),5,cc.color(255,0,0,255));\n        if(np==100){\n            // 加载完成，清除进度条，显示场景资源或通过导演切换场景\n            this.removeChild(100,true);\n            var spbg=new cc.Sprite(\"res/bg.jpg\");//这时候就会从缓存读取\n            this.addChild(spbg);\n            var sphero=new cc.Sprite(\"res/h2.png\");//\n            this.addChild(sphero);\n            spbg.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n            sphero.setScale(0.3);\n            sphero.setPosition(200,200);\n        }\n    },\n    // 绘制进度条\n    drawProgress:function(tag,x,y,width,height,borderColor,border,fillColor){\n        if(this.getChildByTag(tag)!=null){\n            this.removeChildByTag(tag);\n        }\n        var rect = new cc.DrawNode();\n        this.addChild(rect);\n        rect.setTag(tag);\n        var points = [\n            cc.p(x,y),\n            cc.p(x+width,y),\n            cc.p(x+width,y+height),\n            cc.p(x,y+height)\n        ];\n        rect.drawPoly(points, fillColor, border,borderColor);\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_23/5231fee76d1bf8e0db21b35e6e59f9485bf68563/\n\n","slug":"CVP认证学习笔记--(何小成)017--图片资源的异步加载","published":1,"updated":"2016-04-30T07:47:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhud001awsaz08re5fgj","content":"<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>本节课讲了cocos中图片资源的异步加载，主要涉及到的api如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.textureCache.addImageAsync(allpic[n],<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br></pre></td></tr></table></figure>\n<p>以上api通过纹理缓存来异步加载资源，实际上每次调试启动的时候的那个进度条也是一个异步加载，这样可以让资源在每个场景需要用到的时候来进行加载，而不用一进游戏就全部加载完成，提高资源利用率。</p>\n<a id=\"more\"></a>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业要求把示例中的文字显示进度更换了进度条显示，并且提示了使用上一周所学的节点绘制。我的做法是封装一个绘制矩形的方法，通过传入需要的参数来绘制一个矩形，并且每次addImageAsync回调的时候，都更新进度条，使进度条产生一个动态的效果，实现过程如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    process:<span class=\"number\">0</span>,</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    size:cc.winSize,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//还记得启动我们之前作业的启动画面吗</span></span><br><span class=\"line\">        <span class=\"comment\">//是在main.js cc.LoadScene.preload .....</span></span><br><span class=\"line\">        <span class=\"comment\">//这个文件在frameworks/cocos2d-html5/cocos2d/core/scenes/CCloaderScene.js</span></span><br><span class=\"line\">        <span class=\"comment\">//有兴趣可以看看引擎源码 其原理是用一个场景加载进度</span></span><br><span class=\"line\">        <span class=\"comment\">// 本节作业：</span></span><br><span class=\"line\">        <span class=\"comment\">// 本节课介绍如何loading资源在纹理缓存</span></span><br><span class=\"line\">        <span class=\"comment\">// cc.textureCache提供了很多有用的函数如：</span></span><br><span class=\"line\">        <span class=\"comment\">// removeTextureCacheForKey(文件名)</span></span><br><span class=\"line\">        <span class=\"comment\">// clear 清空所有纹理缓存（所以每个游戏的每一关都会load新资源释放旧资源，否则浏览器就崩溃啦）</span></span><br><span class=\"line\">        <span class=\"comment\">// 本课作业</span></span><br><span class=\"line\">        <span class=\"comment\">// 实现一个loading进度条（还记得画矩形吗？）</span></span><br><span class=\"line\">        <span class=\"comment\">// 当loading完成，显示data游戏战斗画面</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> allpic=[<span class=\"string\">&quot;res/bg.jpg&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;res/h2.png&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;res/walk01.png&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;res/walk02.png&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;res/walk03.png&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;res/walk04.png&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;res/walk05.png&quot;</span>];</span><br><span class=\"line\">        <span class=\"comment\">//使用异步任务加载所有图片，定义全局进度process</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> n=<span class=\"number\">0</span>;n&lt;allpic.length;n++) &#123;<span class=\"comment\">//异步加载图片</span></span><br><span class=\"line\">            cc.textureCache.addImageAsync(allpic[n],<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"comment\">//每个图片加载完成都会回调</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.process++;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> width = <span class=\"built_in\">this</span>.size.width<span class=\"number\">-50</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 画外框</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.drawProgress(<span class=\"number\">1</span>,(<span class=\"built_in\">this</span>.size.width-width)/<span class=\"number\">2</span>,<span class=\"number\">100</span>,width,<span class=\"number\">50</span>,cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>),<span class=\"number\">5</span>,cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>));</span><br><span class=\"line\">        <span class=\"keyword\">var</span> np=<span class=\"built_in\">this</span>.process*<span class=\"number\">100</span>/<span class=\"number\">7</span>;<span class=\"comment\">//计算进度</span></span><br><span class=\"line\">        <span class=\"comment\">// 画进度</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.drawProgress(<span class=\"number\">2</span>,(<span class=\"built_in\">this</span>.size.width-width)/<span class=\"number\">2</span>,<span class=\"number\">100</span>,width*(np/<span class=\"number\">100</span>),<span class=\"number\">50</span>,cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>),<span class=\"number\">5</span>,cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>));</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(np==<span class=\"number\">100</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 加载完成，清除进度条，显示场景资源或通过导演切换场景</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.removeChild(<span class=\"number\">100</span>,<span class=\"literal\">true</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> spbg=<span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/bg.jpg&quot;</span>);<span class=\"comment\">//这时候就会从缓存读取</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(spbg);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> sphero=<span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/h2.png&quot;</span>);<span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(sphero);</span><br><span class=\"line\">            spbg.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">            sphero.setScale(<span class=\"number\">0.3</span>);</span><br><span class=\"line\">            sphero.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 绘制进度条</span></span><br><span class=\"line\">    drawProgress:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">tag,x,y,width,height,borderColor,border,fillColor</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.getChildByTag(tag)!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.removeChildByTag(tag);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rect = <span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(rect);</span><br><span class=\"line\">        rect.setTag(tag);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> points = [</span><br><span class=\"line\">            cc.p(x,y),</span><br><span class=\"line\">            cc.p(x+width,y),</span><br><span class=\"line\">            cc.p(x+width,y+height),</span><br><span class=\"line\">            cc.p(x,y+height)</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        rect.drawPoly(points, fillColor, border,borderColor);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_23/5231fee76d1bf8e0db21b35e6e59f9485bf68563/\">http://www.cocoscvp.com/usercode/2016_04_23/5231fee76d1bf8e0db21b35e6e59f9485bf68563/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>本节课讲了cocos中图片资源的异步加载，主要涉及到的api如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.textureCache.addImageAsync(allpic[n],<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br></pre></td></tr></table></figure>\n<p>以上api通过纹理缓存来异步加载资源，实际上每次调试启动的时候的那个进度条也是一个异步加载，这样可以让资源在每个场景需要用到的时候来进行加载，而不用一进游戏就全部加载完成，提高资源利用率。</p>","more":"<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业要求把示例中的文字显示进度更换了进度条显示，并且提示了使用上一周所学的节点绘制。我的做法是封装一个绘制矩形的方法，通过传入需要的参数来绘制一个矩形，并且每次addImageAsync回调的时候，都更新进度条，使进度条产生一个动态的效果，实现过程如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    process:<span class=\"number\">0</span>,</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    size:cc.winSize,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//还记得启动我们之前作业的启动画面吗</span></span><br><span class=\"line\">        <span class=\"comment\">//是在main.js cc.LoadScene.preload .....</span></span><br><span class=\"line\">        <span class=\"comment\">//这个文件在frameworks/cocos2d-html5/cocos2d/core/scenes/CCloaderScene.js</span></span><br><span class=\"line\">        <span class=\"comment\">//有兴趣可以看看引擎源码 其原理是用一个场景加载进度</span></span><br><span class=\"line\">        <span class=\"comment\">// 本节作业：</span></span><br><span class=\"line\">        <span class=\"comment\">// 本节课介绍如何loading资源在纹理缓存</span></span><br><span class=\"line\">        <span class=\"comment\">// cc.textureCache提供了很多有用的函数如：</span></span><br><span class=\"line\">        <span class=\"comment\">// removeTextureCacheForKey(文件名)</span></span><br><span class=\"line\">        <span class=\"comment\">// clear 清空所有纹理缓存（所以每个游戏的每一关都会load新资源释放旧资源，否则浏览器就崩溃啦）</span></span><br><span class=\"line\">        <span class=\"comment\">// 本课作业</span></span><br><span class=\"line\">        <span class=\"comment\">// 实现一个loading进度条（还记得画矩形吗？）</span></span><br><span class=\"line\">        <span class=\"comment\">// 当loading完成，显示data游戏战斗画面</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> allpic=[<span class=\"string\">&quot;res/bg.jpg&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;res/h2.png&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;res/walk01.png&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;res/walk02.png&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;res/walk03.png&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;res/walk04.png&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;res/walk05.png&quot;</span>];</span><br><span class=\"line\">        <span class=\"comment\">//使用异步任务加载所有图片，定义全局进度process</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> n=<span class=\"number\">0</span>;n&lt;allpic.length;n++) &#123;<span class=\"comment\">//异步加载图片</span></span><br><span class=\"line\">            cc.textureCache.addImageAsync(allpic[n],<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"comment\">//每个图片加载完成都会回调</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.process++;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> width = <span class=\"built_in\">this</span>.size.width<span class=\"number\">-50</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 画外框</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.drawProgress(<span class=\"number\">1</span>,(<span class=\"built_in\">this</span>.size.width-width)/<span class=\"number\">2</span>,<span class=\"number\">100</span>,width,<span class=\"number\">50</span>,cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>),<span class=\"number\">5</span>,cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>));</span><br><span class=\"line\">        <span class=\"keyword\">var</span> np=<span class=\"built_in\">this</span>.process*<span class=\"number\">100</span>/<span class=\"number\">7</span>;<span class=\"comment\">//计算进度</span></span><br><span class=\"line\">        <span class=\"comment\">// 画进度</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.drawProgress(<span class=\"number\">2</span>,(<span class=\"built_in\">this</span>.size.width-width)/<span class=\"number\">2</span>,<span class=\"number\">100</span>,width*(np/<span class=\"number\">100</span>),<span class=\"number\">50</span>,cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>),<span class=\"number\">5</span>,cc.color(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>));</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(np==<span class=\"number\">100</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 加载完成，清除进度条，显示场景资源或通过导演切换场景</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.removeChild(<span class=\"number\">100</span>,<span class=\"literal\">true</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> spbg=<span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/bg.jpg&quot;</span>);<span class=\"comment\">//这时候就会从缓存读取</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(spbg);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> sphero=<span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/h2.png&quot;</span>);<span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(sphero);</span><br><span class=\"line\">            spbg.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">            sphero.setScale(<span class=\"number\">0.3</span>);</span><br><span class=\"line\">            sphero.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 绘制进度条</span></span><br><span class=\"line\">    drawProgress:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">tag,x,y,width,height,borderColor,border,fillColor</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.getChildByTag(tag)!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.removeChildByTag(tag);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rect = <span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(rect);</span><br><span class=\"line\">        rect.setTag(tag);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> points = [</span><br><span class=\"line\">            cc.p(x,y),</span><br><span class=\"line\">            cc.p(x+width,y),</span><br><span class=\"line\">            cc.p(x+width,y+height),</span><br><span class=\"line\">            cc.p(x,y+height)</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        rect.drawPoly(points, fillColor, border,borderColor);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_23/5231fee76d1bf8e0db21b35e6e59f9485bf68563/\">http://www.cocoscvp.com/usercode/2016_04_23/5231fee76d1bf8e0db21b35e6e59f9485bf68563/</a></p>"},{"title":"CVP认证学习笔记--(何小成)018--批处理纹理绘图","date":"2016-04-23T15:44:00.000Z","_content":"### 概念\n本节课讲了cocos中的批处理纹理绘图，一般情况下，每绘制一个精灵，都需要绘制一个纹理，而cocos中提供批处理纹理绘图SpriteBatchNode，查阅官方文档 http://www.cocos.com/doc/cocos2d-x-3.0/dd/d2f/classcocos2d_1_1_sprite_batch_node.html#details <!--more-->这其中对SpriteBatchNode的解释如下：\nSpriteBatchNode与批量节点类似，如果包含子节点会在一次OpenGL调用内绘制完成(一般称为\"batch draw\")\n一个SpriteBatchNode可以引用一个且只有一个纹理(一个图像文件或一个纹理集)，只有包含该纹理的Sprite可以加入到SpriteBatchNode中。 加入SpriteBatchNode的所有Sprite在一次OpenGL ES调用内绘制完成，而未加入SpriteBatchNode的Sprite每一个都需要单独调用OpenGL ES绘制，这样效率比较低。\n限制：\n只有Sprite或Sprite的子类对象才允许作为子节点(或孙子节点，等等)加入到SpriteBatchNode中，例如：particles、labels和layer不能加入SpriteBatchNode。\n所有子节点的\"alias\"属性必须统一为Aliased或Antialiased，不能二者同时存在，因为\"alias\"是纹理的属性，而SpriteBatchNode全部的子节点共用一个纹理。\n由cocos官方文档可见，cocos中批处理纹理绘图，可以使多个Sprite在一个OpenGL ES调用内绘制完成，很明显，这样减少了Sprite绘制的次数，从而提高画面渲染的效率。\n### 作业\n使用SpriteBatchNode的代码如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        var add=new cc.MenuItemFont(\"添加Sprite\",this.callback,this);\n        var menu=new cc.Menu(add);\n        this.addChild(menu,10000);\n        return true;\n    },\n    callback:function(obj)\n    {\n        if(this.sprite==null){\n            this.sprite=new cc.SpriteBatchNode(\"res/HelloWorld.png\",1);\n            this.addChild(this.sprite);\n        }\n        var sp2=new cc.Sprite(this.sprite.texture,cc.rect(0,0,195,270));\n        this.sprite.addChild(sp2);\n        sp2.setPosition(Math.random()*300+300,Math.random()*300);\n        sp2.setScale(Math.random());\n        sp2.setRotation(Math.round(Math.random()*360));\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n本节课内容的api介绍很简单，重点是要理解SpriteBatchNode的运作原理，具体查阅官方文档就能明白，很多时候程序中可以通过SpriteBatchNode来优化Sprite渲染次数，从而提高运行效率。\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_23/5608bd70128bddf09770f642e784f35643acadc9/\n\n","source":"_posts/CVP认证学习笔记--(何小成)018--批处理纹理绘图.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)018--批处理纹理绘图\ndate: 2016-04-23 23:44\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节课讲了cocos中的批处理纹理绘图，一般情况下，每绘制一个精灵，都需要绘制一个纹理，而cocos中提供批处理纹理绘图SpriteBatchNode，查阅官方文档 http://www.cocos.com/doc/cocos2d-x-3.0/dd/d2f/classcocos2d_1_1_sprite_batch_node.html#details <!--more-->这其中对SpriteBatchNode的解释如下：\nSpriteBatchNode与批量节点类似，如果包含子节点会在一次OpenGL调用内绘制完成(一般称为\"batch draw\")\n一个SpriteBatchNode可以引用一个且只有一个纹理(一个图像文件或一个纹理集)，只有包含该纹理的Sprite可以加入到SpriteBatchNode中。 加入SpriteBatchNode的所有Sprite在一次OpenGL ES调用内绘制完成，而未加入SpriteBatchNode的Sprite每一个都需要单独调用OpenGL ES绘制，这样效率比较低。\n限制：\n只有Sprite或Sprite的子类对象才允许作为子节点(或孙子节点，等等)加入到SpriteBatchNode中，例如：particles、labels和layer不能加入SpriteBatchNode。\n所有子节点的\"alias\"属性必须统一为Aliased或Antialiased，不能二者同时存在，因为\"alias\"是纹理的属性，而SpriteBatchNode全部的子节点共用一个纹理。\n由cocos官方文档可见，cocos中批处理纹理绘图，可以使多个Sprite在一个OpenGL ES调用内绘制完成，很明显，这样减少了Sprite绘制的次数，从而提高画面渲染的效率。\n### 作业\n使用SpriteBatchNode的代码如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        var add=new cc.MenuItemFont(\"添加Sprite\",this.callback,this);\n        var menu=new cc.Menu(add);\n        this.addChild(menu,10000);\n        return true;\n    },\n    callback:function(obj)\n    {\n        if(this.sprite==null){\n            this.sprite=new cc.SpriteBatchNode(\"res/HelloWorld.png\",1);\n            this.addChild(this.sprite);\n        }\n        var sp2=new cc.Sprite(this.sprite.texture,cc.rect(0,0,195,270));\n        this.sprite.addChild(sp2);\n        sp2.setPosition(Math.random()*300+300,Math.random()*300);\n        sp2.setScale(Math.random());\n        sp2.setRotation(Math.round(Math.random()*360));\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n本节课内容的api介绍很简单，重点是要理解SpriteBatchNode的运作原理，具体查阅官方文档就能明白，很多时候程序中可以通过SpriteBatchNode来优化Sprite渲染次数，从而提高运行效率。\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_23/5608bd70128bddf09770f642e784f35643acadc9/\n\n","slug":"CVP认证学习笔记--(何小成)018--批处理纹理绘图","published":1,"updated":"2016-04-30T07:47:00.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhue001dwsaz2axrb1vo","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课讲了cocos中的批处理纹理绘图，一般情况下，每绘制一个精灵，都需要绘制一个纹理，而cocos中提供批处理纹理绘图SpriteBatchNode，查阅官方文档 <a href=\"http://www.cocos.com/doc/cocos2d-x-3.0/dd/d2f/classcocos2d_1_1_sprite_batch_node.html#details\">http://www.cocos.com/doc/cocos2d-x-3.0/dd/d2f/classcocos2d_1_1_sprite_batch_node.html#details</a> <a id=\"more\"></a>这其中对SpriteBatchNode的解释如下：<br>SpriteBatchNode与批量节点类似，如果包含子节点会在一次OpenGL调用内绘制完成(一般称为”batch draw”)<br>一个SpriteBatchNode可以引用一个且只有一个纹理(一个图像文件或一个纹理集)，只有包含该纹理的Sprite可以加入到SpriteBatchNode中。 加入SpriteBatchNode的所有Sprite在一次OpenGL ES调用内绘制完成，而未加入SpriteBatchNode的Sprite每一个都需要单独调用OpenGL ES绘制，这样效率比较低。<br>限制：<br>只有Sprite或Sprite的子类对象才允许作为子节点(或孙子节点，等等)加入到SpriteBatchNode中，例如：particles、labels和layer不能加入SpriteBatchNode。<br>所有子节点的”alias”属性必须统一为Aliased或Antialiased，不能二者同时存在，因为”alias”是纹理的属性，而SpriteBatchNode全部的子节点共用一个纹理。<br>由cocos官方文档可见，cocos中批处理纹理绘图，可以使多个Sprite在一个OpenGL ES调用内绘制完成，很明显，这样减少了Sprite绘制的次数，从而提高画面渲染的效率。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>使用SpriteBatchNode的代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> add=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;添加Sprite&quot;</span>,<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(add);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu,<span class=\"number\">10000</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.sprite==<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.sprite=<span class=\"keyword\">new</span> cc.SpriteBatchNode(<span class=\"string\">&quot;res/HelloWorld.png&quot;</span>,<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.sprite);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2=<span class=\"keyword\">new</span> cc.Sprite(<span class=\"built_in\">this</span>.sprite.texture,cc.rect(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">195</span>,<span class=\"number\">270</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite.addChild(sp2);</span><br><span class=\"line\">        sp2.setPosition(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">300</span>+<span class=\"number\">300</span>,<span class=\"built_in\">Math</span>.random()*<span class=\"number\">300</span>);</span><br><span class=\"line\">        sp2.setScale(<span class=\"built_in\">Math</span>.random());</span><br><span class=\"line\">        sp2.setRotation(<span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">360</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>本节课内容的api介绍很简单，重点是要理解SpriteBatchNode的运作原理，具体查阅官方文档就能明白，很多时候程序中可以通过SpriteBatchNode来优化Sprite渲染次数，从而提高运行效率。</p>\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_23/5608bd70128bddf09770f642e784f35643acadc9/\">http://www.cocoscvp.com/usercode/2016_04_23/5608bd70128bddf09770f642e784f35643acadc9/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课讲了cocos中的批处理纹理绘图，一般情况下，每绘制一个精灵，都需要绘制一个纹理，而cocos中提供批处理纹理绘图SpriteBatchNode，查阅官方文档 <a href=\"http://www.cocos.com/doc/cocos2d-x-3.0/dd/d2f/classcocos2d_1_1_sprite_batch_node.html#details\">http://www.cocos.com/doc/cocos2d-x-3.0/dd/d2f/classcocos2d_1_1_sprite_batch_node.html#details</a>","more":"这其中对SpriteBatchNode的解释如下：<br>SpriteBatchNode与批量节点类似，如果包含子节点会在一次OpenGL调用内绘制完成(一般称为”batch draw”)<br>一个SpriteBatchNode可以引用一个且只有一个纹理(一个图像文件或一个纹理集)，只有包含该纹理的Sprite可以加入到SpriteBatchNode中。 加入SpriteBatchNode的所有Sprite在一次OpenGL ES调用内绘制完成，而未加入SpriteBatchNode的Sprite每一个都需要单独调用OpenGL ES绘制，这样效率比较低。<br>限制：<br>只有Sprite或Sprite的子类对象才允许作为子节点(或孙子节点，等等)加入到SpriteBatchNode中，例如：particles、labels和layer不能加入SpriteBatchNode。<br>所有子节点的”alias”属性必须统一为Aliased或Antialiased，不能二者同时存在，因为”alias”是纹理的属性，而SpriteBatchNode全部的子节点共用一个纹理。<br>由cocos官方文档可见，cocos中批处理纹理绘图，可以使多个Sprite在一个OpenGL ES调用内绘制完成，很明显，这样减少了Sprite绘制的次数，从而提高画面渲染的效率。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>使用SpriteBatchNode的代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> add=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;添加Sprite&quot;</span>,<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(add);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu,<span class=\"number\">10000</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.sprite==<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.sprite=<span class=\"keyword\">new</span> cc.SpriteBatchNode(<span class=\"string\">&quot;res/HelloWorld.png&quot;</span>,<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.sprite);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2=<span class=\"keyword\">new</span> cc.Sprite(<span class=\"built_in\">this</span>.sprite.texture,cc.rect(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">195</span>,<span class=\"number\">270</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite.addChild(sp2);</span><br><span class=\"line\">        sp2.setPosition(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">300</span>+<span class=\"number\">300</span>,<span class=\"built_in\">Math</span>.random()*<span class=\"number\">300</span>);</span><br><span class=\"line\">        sp2.setScale(<span class=\"built_in\">Math</span>.random());</span><br><span class=\"line\">        sp2.setRotation(<span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">360</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>本节课内容的api介绍很简单，重点是要理解SpriteBatchNode的运作原理，具体查阅官方文档就能明白，很多时候程序中可以通过SpriteBatchNode来优化Sprite渲染次数，从而提高运行效率。</p>\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_23/5608bd70128bddf09770f642e784f35643acadc9/\">http://www.cocoscvp.com/usercode/2016_04_23/5608bd70128bddf09770f642e784f35643acadc9/</a></p>"},{"title":"CVP认证学习笔记--(何小成)019--实现帧动画处理","date":"2016-04-24T14:33:00.000Z","_content":"### 概念\n本节课的内容是通过帧的纹理定时切换就实现动画效果，游戏中的人物通常在每个状态都会有一个循环播放的动画，我们都知道动画的实质就是一帧一帧的画面，cocos中的动画实现就是将一张一张的图片衔接起来播放，一连贯性来达到一个动画的效果。<!--more-->\n### API\n本节课的主要方法如下：\n```javascript\nvar animation=new cc.Animation();\nanimation.addSpriteFrameWithFile(frameName);\nvar act = cc.animate(animation).repeatForever();\n```\n其步骤就是先创建一个Animation，然后通过addSpriteFrameWithFile往Animation中添加精灵帧，然后将其封装为动画，精灵执行这个动画就可以实现帧动画播放。\n### 作业\n最后课程留下的作业是通过实现点击屏幕，让npc移动，并且能在转向时实现翻转，实际上在本周的第一节课程的作业中，我已经实现了这个效果，只是没有帧动画播放的过程，作业实现如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ac:null,\n    npcDirect:\"right\",\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n\n        /////////////////////////////\n        // 2. add a menu item with \"X\" image, which is clicked to quit the program\n        //    you may modify it.\n        // ask the window size\n        var size = cc.winSize;\n       //添加背景\n        var bg=new cc.Sprite(res.bg_jpg);\n        this.addChild(bg);\n        bg.setPosition(size.width/2,size.height/2);\n        //添加动画层\n        var sphero=new cc.Sprite(\"res/walk01.png\");\n        var animation=new cc.Animation();\n        for(var i=1;i<=5;i++)\n        {\n            var frameName=\"res/walk0\"+i+\".png\";\n            animation.addSpriteFrameWithFile(frameName);\n        }\n        animation.setDelayPerUnit(0.1);//300毫秒每帧\n        this.ac=cc.animate(animation).repeatForever();//包装成动作\n        this.addChild(sphero);\n        sphero.setTag(1);\n        sphero.setPosition(200,200);\n        return true;\n    },\n    onEnter:function(touch,event){\n       this._super();\n        //添加触屏事件\n       cc.eventManager.addListener({\n           event:cc.EventListener.TOUCH_ONE_BY_ONE,\n           swallowTouches:true,//吞噬事件 不再传递\n           onTouchBegan:this.touchbegan,\n           onTouchMoved:this.touchmoved,\n           onTouchEnded:this.touchended\n       },this);\n    },\n    touchbegan:function(touch,event){\n        var x = touch.getLocation().x;\n        var y = touch.getLocation().y;\n        var bn = event.getCurrentTarget().getChildByTag(1);\n        // 走路时间\n        var time = Math.round(Math.sqrt(Math.pow(x-bn.getPositionX(),2)+Math.pow(y-bn.getPositionY(),2)))/100;\n        bn.stopAllActions();\n        if(event.getCurrentTarget().npcDirect==\"right\"&&x<bn.getPositionX()){\n            // 转向\n            event.getCurrentTarget().npcDirect = \"left\";\n            bn.runAction(cc.flipX(true));// 水平翻转\n        }else if(event.getCurrentTarget().npcDirect==\"left\"&&x>bn.getPositionX()){\n            // 转向\n            event.getCurrentTarget().npcDirect = \"right\";\n            bn.runAction(cc.flipX(false));// 翻转回来\n        }\n        cc.log(event.getCurrentTarget().ac);\n        // 执行走路动画\n        bn.runAction(event.getCurrentTarget().ac);\n        bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(function(bn){\n            // 移动动作完成之后停止精灵的动画，并设置精灵图片为第一张\n            bn.stopAllActions();\n            bn.setTexture(\"res/walk01.png\");\n        },bn)));\n        return true;\n    },\n    touchmoved:function(touch,event){\n        \n    },\n    touchended:function(touch,event){\n\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_24/f5abb96ca567c25d6c217acbad8daee4aad15b1e/\n","source":"_posts/CVP认证学习笔记--(何小成)019--实现帧动画处理.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)019--实现帧动画处理\ndate: 2016-04-24 22:33\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节课的内容是通过帧的纹理定时切换就实现动画效果，游戏中的人物通常在每个状态都会有一个循环播放的动画，我们都知道动画的实质就是一帧一帧的画面，cocos中的动画实现就是将一张一张的图片衔接起来播放，一连贯性来达到一个动画的效果。<!--more-->\n### API\n本节课的主要方法如下：\n```javascript\nvar animation=new cc.Animation();\nanimation.addSpriteFrameWithFile(frameName);\nvar act = cc.animate(animation).repeatForever();\n```\n其步骤就是先创建一个Animation，然后通过addSpriteFrameWithFile往Animation中添加精灵帧，然后将其封装为动画，精灵执行这个动画就可以实现帧动画播放。\n### 作业\n最后课程留下的作业是通过实现点击屏幕，让npc移动，并且能在转向时实现翻转，实际上在本周的第一节课程的作业中，我已经实现了这个效果，只是没有帧动画播放的过程，作业实现如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ac:null,\n    npcDirect:\"right\",\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n\n        /////////////////////////////\n        // 2. add a menu item with \"X\" image, which is clicked to quit the program\n        //    you may modify it.\n        // ask the window size\n        var size = cc.winSize;\n       //添加背景\n        var bg=new cc.Sprite(res.bg_jpg);\n        this.addChild(bg);\n        bg.setPosition(size.width/2,size.height/2);\n        //添加动画层\n        var sphero=new cc.Sprite(\"res/walk01.png\");\n        var animation=new cc.Animation();\n        for(var i=1;i<=5;i++)\n        {\n            var frameName=\"res/walk0\"+i+\".png\";\n            animation.addSpriteFrameWithFile(frameName);\n        }\n        animation.setDelayPerUnit(0.1);//300毫秒每帧\n        this.ac=cc.animate(animation).repeatForever();//包装成动作\n        this.addChild(sphero);\n        sphero.setTag(1);\n        sphero.setPosition(200,200);\n        return true;\n    },\n    onEnter:function(touch,event){\n       this._super();\n        //添加触屏事件\n       cc.eventManager.addListener({\n           event:cc.EventListener.TOUCH_ONE_BY_ONE,\n           swallowTouches:true,//吞噬事件 不再传递\n           onTouchBegan:this.touchbegan,\n           onTouchMoved:this.touchmoved,\n           onTouchEnded:this.touchended\n       },this);\n    },\n    touchbegan:function(touch,event){\n        var x = touch.getLocation().x;\n        var y = touch.getLocation().y;\n        var bn = event.getCurrentTarget().getChildByTag(1);\n        // 走路时间\n        var time = Math.round(Math.sqrt(Math.pow(x-bn.getPositionX(),2)+Math.pow(y-bn.getPositionY(),2)))/100;\n        bn.stopAllActions();\n        if(event.getCurrentTarget().npcDirect==\"right\"&&x<bn.getPositionX()){\n            // 转向\n            event.getCurrentTarget().npcDirect = \"left\";\n            bn.runAction(cc.flipX(true));// 水平翻转\n        }else if(event.getCurrentTarget().npcDirect==\"left\"&&x>bn.getPositionX()){\n            // 转向\n            event.getCurrentTarget().npcDirect = \"right\";\n            bn.runAction(cc.flipX(false));// 翻转回来\n        }\n        cc.log(event.getCurrentTarget().ac);\n        // 执行走路动画\n        bn.runAction(event.getCurrentTarget().ac);\n        bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(function(bn){\n            // 移动动作完成之后停止精灵的动画，并设置精灵图片为第一张\n            bn.stopAllActions();\n            bn.setTexture(\"res/walk01.png\");\n        },bn)));\n        return true;\n    },\n    touchmoved:function(touch,event){\n        \n    },\n    touchended:function(touch,event){\n\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_24/f5abb96ca567c25d6c217acbad8daee4aad15b1e/\n","slug":"CVP认证学习笔记--(何小成)019--实现帧动画处理","published":1,"updated":"2016-04-30T07:46:54.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhuf001hwsaz0tsj99jv","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课的内容是通过帧的纹理定时切换就实现动画效果，游戏中的人物通常在每个状态都会有一个循环播放的动画，我们都知道动画的实质就是一帧一帧的画面，cocos中的动画实现就是将一张一张的图片衔接起来播放，一连贯性来达到一个动画的效果。<a id=\"more\"></a></p>\n<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>本节课的主要方法如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> animation=<span class=\"keyword\">new</span> cc.Animation();</span><br><span class=\"line\">animation.addSpriteFrameWithFile(frameName);</span><br><span class=\"line\"><span class=\"keyword\">var</span> act = cc.animate(animation).repeatForever();</span><br></pre></td></tr></table></figure>\n<p>其步骤就是先创建一个Animation，然后通过addSpriteFrameWithFile往Animation中添加精灵帧，然后将其封装为动画，精灵执行这个动画就可以实现帧动画播放。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>最后课程留下的作业是通过实现点击屏幕，让npc移动，并且能在转向时实现翻转，实际上在本周的第一节课程的作业中，我已经实现了这个效果，只是没有帧动画播放的过程，作业实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ac:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    npcDirect:<span class=\"string\">&quot;right&quot;</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 2. add a menu item with &quot;X&quot; image, which is clicked to quit the program</span></span><br><span class=\"line\">        <span class=\"comment\">//    you may modify it.</span></span><br><span class=\"line\">        <span class=\"comment\">// ask the window size</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">       <span class=\"comment\">//添加背景</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg=<span class=\"keyword\">new</span> cc.Sprite(res.bg_jpg);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        bg.setPosition(size.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sphero=<span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/walk01.png&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> animation=<span class=\"keyword\">new</span> cc.Animation();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>;i&lt;=<span class=\"number\">5</span>;i++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> frameName=<span class=\"string\">&quot;res/walk0&quot;</span>+i+<span class=\"string\">&quot;.png&quot;</span>;</span><br><span class=\"line\">            animation.addSpriteFrameWithFile(frameName);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        animation.setDelayPerUnit(<span class=\"number\">0.1</span>);<span class=\"comment\">//300毫秒每帧</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.ac=cc.animate(animation).repeatForever();<span class=\"comment\">//包装成动作</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(sphero);</span><br><span class=\"line\">        sphero.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        sphero.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">       <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//添加触屏事件</span></span><br><span class=\"line\">       cc.eventManager.addListener(&#123;</span><br><span class=\"line\">           event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">           swallowTouches:<span class=\"literal\">true</span>,<span class=\"comment\">//吞噬事件 不再传递</span></span><br><span class=\"line\">           onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">           onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">           onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">       &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocation().x;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocation().y;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 走路时间</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-bn.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-bn.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        bn.stopAllActions();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(event.getCurrentTarget().npcDirect==<span class=\"string\">&quot;right&quot;</span>&amp;&amp;x&lt;bn.getPositionX())&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 转向</span></span><br><span class=\"line\">            event.getCurrentTarget().npcDirect = <span class=\"string\">&quot;left&quot;</span>;</span><br><span class=\"line\">            bn.runAction(cc.flipX(<span class=\"literal\">true</span>));<span class=\"comment\">// 水平翻转</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(event.getCurrentTarget().npcDirect==<span class=\"string\">&quot;left&quot;</span>&amp;&amp;x&gt;bn.getPositionX())&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 转向</span></span><br><span class=\"line\">            event.getCurrentTarget().npcDirect = <span class=\"string\">&quot;right&quot;</span>;</span><br><span class=\"line\">            bn.runAction(cc.flipX(<span class=\"literal\">false</span>));<span class=\"comment\">// 翻转回来</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        cc.log(event.getCurrentTarget().ac);</span><br><span class=\"line\">        <span class=\"comment\">// 执行走路动画</span></span><br><span class=\"line\">        bn.runAction(event.getCurrentTarget().ac);</span><br><span class=\"line\">        bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">bn</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 移动动作完成之后停止精灵的动画，并设置精灵图片为第一张</span></span><br><span class=\"line\">            bn.stopAllActions();</span><br><span class=\"line\">            bn.setTexture(<span class=\"string\">&quot;res/walk01.png&quot;</span>);</span><br><span class=\"line\">        &#125;,bn)));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_24/f5abb96ca567c25d6c217acbad8daee4aad15b1e/\">http://www.cocoscvp.com/usercode/2016_04_24/f5abb96ca567c25d6c217acbad8daee4aad15b1e/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课的内容是通过帧的纹理定时切换就实现动画效果，游戏中的人物通常在每个状态都会有一个循环播放的动画，我们都知道动画的实质就是一帧一帧的画面，cocos中的动画实现就是将一张一张的图片衔接起来播放，一连贯性来达到一个动画的效果。","more":"</p>\n<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>本节课的主要方法如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> animation=<span class=\"keyword\">new</span> cc.Animation();</span><br><span class=\"line\">animation.addSpriteFrameWithFile(frameName);</span><br><span class=\"line\"><span class=\"keyword\">var</span> act = cc.animate(animation).repeatForever();</span><br></pre></td></tr></table></figure>\n<p>其步骤就是先创建一个Animation，然后通过addSpriteFrameWithFile往Animation中添加精灵帧，然后将其封装为动画，精灵执行这个动画就可以实现帧动画播放。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>最后课程留下的作业是通过实现点击屏幕，让npc移动，并且能在转向时实现翻转，实际上在本周的第一节课程的作业中，我已经实现了这个效果，只是没有帧动画播放的过程，作业实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ac:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    npcDirect:<span class=\"string\">&quot;right&quot;</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 2. add a menu item with &quot;X&quot; image, which is clicked to quit the program</span></span><br><span class=\"line\">        <span class=\"comment\">//    you may modify it.</span></span><br><span class=\"line\">        <span class=\"comment\">// ask the window size</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">       <span class=\"comment\">//添加背景</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg=<span class=\"keyword\">new</span> cc.Sprite(res.bg_jpg);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        bg.setPosition(size.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sphero=<span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/walk01.png&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> animation=<span class=\"keyword\">new</span> cc.Animation();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>;i&lt;=<span class=\"number\">5</span>;i++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> frameName=<span class=\"string\">&quot;res/walk0&quot;</span>+i+<span class=\"string\">&quot;.png&quot;</span>;</span><br><span class=\"line\">            animation.addSpriteFrameWithFile(frameName);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        animation.setDelayPerUnit(<span class=\"number\">0.1</span>);<span class=\"comment\">//300毫秒每帧</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.ac=cc.animate(animation).repeatForever();<span class=\"comment\">//包装成动作</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(sphero);</span><br><span class=\"line\">        sphero.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        sphero.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">       <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//添加触屏事件</span></span><br><span class=\"line\">       cc.eventManager.addListener(&#123;</span><br><span class=\"line\">           event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">           swallowTouches:<span class=\"literal\">true</span>,<span class=\"comment\">//吞噬事件 不再传递</span></span><br><span class=\"line\">           onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">           onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">           onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">       &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocation().x;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocation().y;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 走路时间</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-bn.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-bn.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        bn.stopAllActions();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(event.getCurrentTarget().npcDirect==<span class=\"string\">&quot;right&quot;</span>&amp;&amp;x&lt;bn.getPositionX())&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 转向</span></span><br><span class=\"line\">            event.getCurrentTarget().npcDirect = <span class=\"string\">&quot;left&quot;</span>;</span><br><span class=\"line\">            bn.runAction(cc.flipX(<span class=\"literal\">true</span>));<span class=\"comment\">// 水平翻转</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(event.getCurrentTarget().npcDirect==<span class=\"string\">&quot;left&quot;</span>&amp;&amp;x&gt;bn.getPositionX())&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 转向</span></span><br><span class=\"line\">            event.getCurrentTarget().npcDirect = <span class=\"string\">&quot;right&quot;</span>;</span><br><span class=\"line\">            bn.runAction(cc.flipX(<span class=\"literal\">false</span>));<span class=\"comment\">// 翻转回来</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        cc.log(event.getCurrentTarget().ac);</span><br><span class=\"line\">        <span class=\"comment\">// 执行走路动画</span></span><br><span class=\"line\">        bn.runAction(event.getCurrentTarget().ac);</span><br><span class=\"line\">        bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">bn</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 移动动作完成之后停止精灵的动画，并设置精灵图片为第一张</span></span><br><span class=\"line\">            bn.stopAllActions();</span><br><span class=\"line\">            bn.setTexture(<span class=\"string\">&quot;res/walk01.png&quot;</span>);</span><br><span class=\"line\">        &#125;,bn)));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_24/f5abb96ca567c25d6c217acbad8daee4aad15b1e/\">http://www.cocoscvp.com/usercode/2016_04_24/f5abb96ca567c25d6c217acbad8daee4aad15b1e/</a></p>"},{"title":"CVP认证学习笔记--(何小成)020--实现切图帧动画","date":"2016-04-25T15:30:00.000Z","_content":"### 概念\n本节内容是掌握cocos中的动画缓存，通过cc.animationCache.addAnimation，可以将预先写好的一组动画放入动画缓存，当一些事件触发时，如触摸点击屏幕精灵时，便可以通过cc.animationCache.getAnimation获取到先前缓存的动画。<!--more-->\n### 步骤\n#### 添加帧序列\n事先准备好的帧序列图片放在一张大图中，通过截取矩形区域来获得所需要的帧序列图片\n```javascript\nfor(var n=0;n<4;n++) {\n    var sp1Nowframedown=new cc.SpriteFrame(sp1Texture,cc.rect(32*n,0,32,48));\n}\n```\n#### 创建动画\n使用帧序列创建一个动画，动画播放0.1s\n```javascript\nvar sp1AnimationDown=new cc.Animation(sp1FrameDown,0.1);\n```\n#### 添加精灵到缓存\n把精灵帧动画添加到动画缓存中\n```javascript\ncc.animationCache.addAnimation(sp1AnimationDown,\"sp1down\");\n```\n#### 获取并运行动画\n以上步骤完成后，就可以在事件中使用动画\n```javascript\ncc.animate(cc.animationCache.getAnimation(\"sp1down\")).repeatForever();\n```\n### 作业\n作业内容是点击屏幕，英雄移动到该位置并且播放动画，跟上节课作业差不多，只不过这节课的动画通过动画缓存来获得，而上节课使用的是固定的动画。我在作业中实现了点击按钮可以切换精灵，在行走方向的判断上，我把屏幕在以人物为中心的坐标轴上，画两条对角线，根据分为四个区域，分别判断这四个区域为上下左右。点击相应区域实现人物相应的动画播放。由于是作业，所以代码也就不是那么规范了，看起来是有点乱的，在正式项目中，应该对这些方法进行良好的封装。作业代码如下：\n```javascript\n\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    chooseRole:0,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        //添加背景\n        var bg=new cc.Sprite(res.bg_jpg);\n        this.addChild(bg);\n        bg.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        sp1Texture=cc.textureCache.addImage(\"res/1.png\");\n        sp2Texture=cc.textureCache.addImage(\"res/2.png\");\n        // 精灵1\n        var sp1FrameUp=[];\n        var sp1FrameDown=[];\n        var sp1FrameLeft=[];\n        var sp1FrameRight=[];\n        // 精灵2\n        var sp2FrameUp=[];\n        var sp2FrameDown=[];\n        var sp2FrameLeft=[];\n        var sp2FrameRight=[];\n         //添加帧序列\n        for(var n=0;n<4;n++) {\n            // 精灵1\n          var sp1Nowframedown=new cc.SpriteFrame(sp1Texture,cc.rect(32*n,0,32,48));\n          var sp1Nowframeleft=new cc.SpriteFrame(sp1Texture,cc.rect(32*n,48,32,48));\n          var sp1Nowframeright=new cc.SpriteFrame(sp1Texture,cc.rect(32*n,48*2,32,48));\n          var sp1Nowframeup=new cc.SpriteFrame(sp1Texture,cc.rect(32*n,48*3,32,48));\n          sp1FrameDown.push(sp1Nowframedown);\n          sp1FrameLeft.push(sp1Nowframeleft);\n          sp1FrameRight.push(sp1Nowframeright);\n          sp1FrameUp.push(sp1Nowframeup);\n          // 精灵2\n          var sp2Nowframedown=new cc.SpriteFrame(sp2Texture,cc.rect(32*n,0,32,48));\n          var sp2Nowframeleft=new cc.SpriteFrame(sp2Texture,cc.rect(32*n,48*1,32,48));\n          var sp2Nowframeright=new cc.SpriteFrame(sp2Texture,cc.rect(32*n,48*2,32,48));\n          var sp2Nowframeup=new cc.SpriteFrame(sp2Texture,cc.rect(32*n,48*3,32,48));\n          sp2FrameUp.push(sp2Nowframeup); \n          sp2FrameDown.push(sp2Nowframedown);\n          sp2FrameLeft.push(sp2Nowframeleft);\n          sp2FrameRight.push(sp2Nowframeright);\n        }\n        //创建动画\n        // 精灵1\n        var sp1AnimationUp=new cc.Animation(sp1FrameUp,0.1);\n        var sp1AnimationDown=new cc.Animation(sp1FrameDown,0.1);\n        var sp1AnimationLeft=new cc.Animation(sp1FrameLeft,0.1);\n        var sp1AnimationRight=new cc.Animation(sp1FrameRight,0.1);\n         // 精灵2\n        var sp2AnimationUp=new cc.Animation(sp2FrameUp,0.1);\n        var sp2AnimationDown=new cc.Animation(sp2FrameDown,0.1);\n        var sp2AnimationLeft=new cc.Animation(sp2FrameLeft,0.1);\n        var sp2AnimationRight=new cc.Animation(sp2FrameRight,0.1);\n        //添加到缓存里\n        // 精灵1\n        cc.animationCache.addAnimation(sp1AnimationUp,\"sp1up\");\n        cc.animationCache.addAnimation(sp1AnimationDown,\"sp1down\");\n        cc.animationCache.addAnimation(sp1AnimationLeft,\"sp1left\");\n        cc.animationCache.addAnimation(sp1AnimationRight,\"sp1right\");\n        // 精灵2\n        cc.animationCache.addAnimation(sp2AnimationUp,\"sp2up\");\n        cc.animationCache.addAnimation(sp2AnimationDown,\"sp2down\");\n        cc.animationCache.addAnimation(sp2AnimationLeft,\"sp2left\");\n        cc.animationCache.addAnimation(sp2AnimationRight,\"sp2right\");\n        //创建animate并运行\n        this.sprite=new cc.Sprite(sp1Texture,cc.rect(32,0,32,48));\n        this.chooseRole=1;// 默认选择鸣人\n        this.addChild(this.sprite);\n        this.sprite.setTag(1);\n        this.sprite.setScale(4);\n        this.sprite.setPosition(200,200);\n        //添加按钮改变精灵\n        var sp1=new cc.MenuItemFont(\"选鸣人\",this.callback,this);\n        var sp2=new cc.MenuItemFont(\"选小樱\",this.callback,this);\n        sp1.setTag(11);\n        sp2.setTag(12);\n        sp1.setPositionY(50);\n        var menu=new cc.Menu(sp1,sp2);\n        this.addChild(menu);\n        return true;\n    },\n    getRole:function(){\n        return this.chooseRole;\n    },\n    callback:function(obj){\n        switch(obj.tag){\n            case 11://鸣人\n                this.sprite.stopAllActions();\n                this.sprite.setTexture(cc.textureCache.addImage(\"res/1.png\"),cc.rect(32,0,32,48));\n                this.chooseRole=1;\n                break;\n            case 12://小樱\n                this.sprite.stopAllActions();\n                this.sprite.setTexture(cc.textureCache.addImage(\"res/2.png\"),cc.rect(32,0,32,48));\n                this.chooseRole=2;\n                break;\n        }\n    },\n    onEnter:function(){\n        this._super();\n        //添加触屏事件\n        cc.eventManager.addListener({\n           event:cc.EventListener.TOUCH_ONE_BY_ONE,\n           swallowTouches:true,//吞噬事件 不再传递\n           onTouchBegan:this.touchbegan,\n           onTouchMoved:this.touchmoved,\n           onTouchEnded:this.touchended\n       },this);\n    },\n    touchbegan:function(touch,event){\n        var x = touch.getLocation().x;\n        var y = touch.getLocation().y;\n        var bn = event.getCurrentTarget().getChildByTag(1);\n        // 走路时间\n        var time = Math.round(Math.sqrt(Math.pow(x-bn.getPositionX(),2)+Math.pow(y-bn.getPositionY(),2)))/100;\n        bn.stopAllActions();\n        if(x<bn.getPositionX()){// 点击人物左侧\n            if(Math.abs(x-bn.getPositionX())/Math.abs(y-bn.getPositionY())<1){\n                if(y<bn.getPositionY()){\n                    //  向下走\n                    var role = Number(event.getCurrentTarget().getRole());\n                    var act=role==1?cc.animate(cc.animationCache.getAnimation(\"sp1down\")).repeatForever():cc.animate(cc.animationCache.getAnimation(\"sp2down\")).repeatForever();\n                    bn.runAction(act);\n                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(\n                                function(sprite){\n                                    sprite.stopAllActions();\n                                },event.getCurrentTarget().sprite)));\n                }else{\n                    // 向上走\n                     var role = event.getCurrentTarget().getRole();\n                    var act=role==1?cc.animate(cc.animationCache.getAnimation(\"sp1up\")).repeatForever():cc.animate(cc.animationCache.getAnimation(\"sp2up\")).repeatForever();\n                    bn.runAction(act);\n                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(\n                                function(sprite){\n                                    sprite.stopAllActions();\n                                },event.getCurrentTarget().sprite)));\n                }\n            } else if(Math.abs(x-bn.getPositionX())/Math.abs(y-bn.getPositionY())>=1){// 向左走\n                var role = event.getCurrentTarget().getRole();\n                var act=role==1?cc.animate(cc.animationCache.getAnimation(\"sp1left\")).repeatForever():cc.animate(cc.animationCache.getAnimation(\"sp2left\")).repeatForever();\n                bn.runAction(act);\n                bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(\n                            function(sprite){\n                                sprite.stopAllActions();\n                            },event.getCurrentTarget().sprite)));\n            }\n        }else if(x>bn.getPositionX()){\n           if(Math.abs(x-bn.getPositionX())/Math.abs(y-bn.getPositionY())<1){\n                if(y<bn.getPositionY()){\n                    //  向下走\n                    var role = event.getCurrentTarget().getRole();\n                    var act=role==1?cc.animate(cc.animationCache.getAnimation(\"sp1down\")).repeatForever():cc.animate(cc.animationCache.getAnimation(\"sp2down\")).repeatForever();\n                    bn.runAction(act);\n                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(\n                                function(sprite){\n                                    sprite.stopAllActions();\n                                },event.getCurrentTarget().sprite)));\n                }else{\n                    // 向上走\n                    var role = event.getCurrentTarget().getRole();\n                    var act=role==1?cc.animate(cc.animationCache.getAnimation(\"sp1up\")).repeatForever():cc.animate(cc.animationCache.getAnimation(\"sp2up\")).repeatForever();\n                    bn.runAction(act);\n                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(\n                                function(sprite){\n                                    sprite.stopAllActions();\n                                },event.getCurrentTarget().sprite)));\n                }\n            } else if(Math.abs(x-bn.getPositionX())/Math.abs(y-bn.getPositionY())>=1){// 向右走\n                var role = event.getCurrentTarget().getRole();\n                var act=role==1?cc.animate(cc.animationCache.getAnimation(\"sp1right\")).repeatForever():cc.animate(cc.animationCache.getAnimation(\"sp2right\")).repeatForever();\n                bn.runAction(act);\n                bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(\n                            function(sprite){\n                                sprite.stopAllActions();\n                            },event.getCurrentTarget().sprite)));\n            }\n        }\n        return true;\n    },\n    touchmoved:function(){\n        return true;\n    },\n    touchended:function(touch,event){\n        return true;\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_24/3faf3ea09347be95a5fd15287ff32724995d4f09/\n","source":"_posts/CVP认证学习笔记--(何小成)020--实现切图帧动画.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)020--实现切图帧动画\ndate: 2016-04-25 23:30\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节内容是掌握cocos中的动画缓存，通过cc.animationCache.addAnimation，可以将预先写好的一组动画放入动画缓存，当一些事件触发时，如触摸点击屏幕精灵时，便可以通过cc.animationCache.getAnimation获取到先前缓存的动画。<!--more-->\n### 步骤\n#### 添加帧序列\n事先准备好的帧序列图片放在一张大图中，通过截取矩形区域来获得所需要的帧序列图片\n```javascript\nfor(var n=0;n<4;n++) {\n    var sp1Nowframedown=new cc.SpriteFrame(sp1Texture,cc.rect(32*n,0,32,48));\n}\n```\n#### 创建动画\n使用帧序列创建一个动画，动画播放0.1s\n```javascript\nvar sp1AnimationDown=new cc.Animation(sp1FrameDown,0.1);\n```\n#### 添加精灵到缓存\n把精灵帧动画添加到动画缓存中\n```javascript\ncc.animationCache.addAnimation(sp1AnimationDown,\"sp1down\");\n```\n#### 获取并运行动画\n以上步骤完成后，就可以在事件中使用动画\n```javascript\ncc.animate(cc.animationCache.getAnimation(\"sp1down\")).repeatForever();\n```\n### 作业\n作业内容是点击屏幕，英雄移动到该位置并且播放动画，跟上节课作业差不多，只不过这节课的动画通过动画缓存来获得，而上节课使用的是固定的动画。我在作业中实现了点击按钮可以切换精灵，在行走方向的判断上，我把屏幕在以人物为中心的坐标轴上，画两条对角线，根据分为四个区域，分别判断这四个区域为上下左右。点击相应区域实现人物相应的动画播放。由于是作业，所以代码也就不是那么规范了，看起来是有点乱的，在正式项目中，应该对这些方法进行良好的封装。作业代码如下：\n```javascript\n\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    chooseRole:0,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        //添加背景\n        var bg=new cc.Sprite(res.bg_jpg);\n        this.addChild(bg);\n        bg.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        sp1Texture=cc.textureCache.addImage(\"res/1.png\");\n        sp2Texture=cc.textureCache.addImage(\"res/2.png\");\n        // 精灵1\n        var sp1FrameUp=[];\n        var sp1FrameDown=[];\n        var sp1FrameLeft=[];\n        var sp1FrameRight=[];\n        // 精灵2\n        var sp2FrameUp=[];\n        var sp2FrameDown=[];\n        var sp2FrameLeft=[];\n        var sp2FrameRight=[];\n         //添加帧序列\n        for(var n=0;n<4;n++) {\n            // 精灵1\n          var sp1Nowframedown=new cc.SpriteFrame(sp1Texture,cc.rect(32*n,0,32,48));\n          var sp1Nowframeleft=new cc.SpriteFrame(sp1Texture,cc.rect(32*n,48,32,48));\n          var sp1Nowframeright=new cc.SpriteFrame(sp1Texture,cc.rect(32*n,48*2,32,48));\n          var sp1Nowframeup=new cc.SpriteFrame(sp1Texture,cc.rect(32*n,48*3,32,48));\n          sp1FrameDown.push(sp1Nowframedown);\n          sp1FrameLeft.push(sp1Nowframeleft);\n          sp1FrameRight.push(sp1Nowframeright);\n          sp1FrameUp.push(sp1Nowframeup);\n          // 精灵2\n          var sp2Nowframedown=new cc.SpriteFrame(sp2Texture,cc.rect(32*n,0,32,48));\n          var sp2Nowframeleft=new cc.SpriteFrame(sp2Texture,cc.rect(32*n,48*1,32,48));\n          var sp2Nowframeright=new cc.SpriteFrame(sp2Texture,cc.rect(32*n,48*2,32,48));\n          var sp2Nowframeup=new cc.SpriteFrame(sp2Texture,cc.rect(32*n,48*3,32,48));\n          sp2FrameUp.push(sp2Nowframeup); \n          sp2FrameDown.push(sp2Nowframedown);\n          sp2FrameLeft.push(sp2Nowframeleft);\n          sp2FrameRight.push(sp2Nowframeright);\n        }\n        //创建动画\n        // 精灵1\n        var sp1AnimationUp=new cc.Animation(sp1FrameUp,0.1);\n        var sp1AnimationDown=new cc.Animation(sp1FrameDown,0.1);\n        var sp1AnimationLeft=new cc.Animation(sp1FrameLeft,0.1);\n        var sp1AnimationRight=new cc.Animation(sp1FrameRight,0.1);\n         // 精灵2\n        var sp2AnimationUp=new cc.Animation(sp2FrameUp,0.1);\n        var sp2AnimationDown=new cc.Animation(sp2FrameDown,0.1);\n        var sp2AnimationLeft=new cc.Animation(sp2FrameLeft,0.1);\n        var sp2AnimationRight=new cc.Animation(sp2FrameRight,0.1);\n        //添加到缓存里\n        // 精灵1\n        cc.animationCache.addAnimation(sp1AnimationUp,\"sp1up\");\n        cc.animationCache.addAnimation(sp1AnimationDown,\"sp1down\");\n        cc.animationCache.addAnimation(sp1AnimationLeft,\"sp1left\");\n        cc.animationCache.addAnimation(sp1AnimationRight,\"sp1right\");\n        // 精灵2\n        cc.animationCache.addAnimation(sp2AnimationUp,\"sp2up\");\n        cc.animationCache.addAnimation(sp2AnimationDown,\"sp2down\");\n        cc.animationCache.addAnimation(sp2AnimationLeft,\"sp2left\");\n        cc.animationCache.addAnimation(sp2AnimationRight,\"sp2right\");\n        //创建animate并运行\n        this.sprite=new cc.Sprite(sp1Texture,cc.rect(32,0,32,48));\n        this.chooseRole=1;// 默认选择鸣人\n        this.addChild(this.sprite);\n        this.sprite.setTag(1);\n        this.sprite.setScale(4);\n        this.sprite.setPosition(200,200);\n        //添加按钮改变精灵\n        var sp1=new cc.MenuItemFont(\"选鸣人\",this.callback,this);\n        var sp2=new cc.MenuItemFont(\"选小樱\",this.callback,this);\n        sp1.setTag(11);\n        sp2.setTag(12);\n        sp1.setPositionY(50);\n        var menu=new cc.Menu(sp1,sp2);\n        this.addChild(menu);\n        return true;\n    },\n    getRole:function(){\n        return this.chooseRole;\n    },\n    callback:function(obj){\n        switch(obj.tag){\n            case 11://鸣人\n                this.sprite.stopAllActions();\n                this.sprite.setTexture(cc.textureCache.addImage(\"res/1.png\"),cc.rect(32,0,32,48));\n                this.chooseRole=1;\n                break;\n            case 12://小樱\n                this.sprite.stopAllActions();\n                this.sprite.setTexture(cc.textureCache.addImage(\"res/2.png\"),cc.rect(32,0,32,48));\n                this.chooseRole=2;\n                break;\n        }\n    },\n    onEnter:function(){\n        this._super();\n        //添加触屏事件\n        cc.eventManager.addListener({\n           event:cc.EventListener.TOUCH_ONE_BY_ONE,\n           swallowTouches:true,//吞噬事件 不再传递\n           onTouchBegan:this.touchbegan,\n           onTouchMoved:this.touchmoved,\n           onTouchEnded:this.touchended\n       },this);\n    },\n    touchbegan:function(touch,event){\n        var x = touch.getLocation().x;\n        var y = touch.getLocation().y;\n        var bn = event.getCurrentTarget().getChildByTag(1);\n        // 走路时间\n        var time = Math.round(Math.sqrt(Math.pow(x-bn.getPositionX(),2)+Math.pow(y-bn.getPositionY(),2)))/100;\n        bn.stopAllActions();\n        if(x<bn.getPositionX()){// 点击人物左侧\n            if(Math.abs(x-bn.getPositionX())/Math.abs(y-bn.getPositionY())<1){\n                if(y<bn.getPositionY()){\n                    //  向下走\n                    var role = Number(event.getCurrentTarget().getRole());\n                    var act=role==1?cc.animate(cc.animationCache.getAnimation(\"sp1down\")).repeatForever():cc.animate(cc.animationCache.getAnimation(\"sp2down\")).repeatForever();\n                    bn.runAction(act);\n                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(\n                                function(sprite){\n                                    sprite.stopAllActions();\n                                },event.getCurrentTarget().sprite)));\n                }else{\n                    // 向上走\n                     var role = event.getCurrentTarget().getRole();\n                    var act=role==1?cc.animate(cc.animationCache.getAnimation(\"sp1up\")).repeatForever():cc.animate(cc.animationCache.getAnimation(\"sp2up\")).repeatForever();\n                    bn.runAction(act);\n                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(\n                                function(sprite){\n                                    sprite.stopAllActions();\n                                },event.getCurrentTarget().sprite)));\n                }\n            } else if(Math.abs(x-bn.getPositionX())/Math.abs(y-bn.getPositionY())>=1){// 向左走\n                var role = event.getCurrentTarget().getRole();\n                var act=role==1?cc.animate(cc.animationCache.getAnimation(\"sp1left\")).repeatForever():cc.animate(cc.animationCache.getAnimation(\"sp2left\")).repeatForever();\n                bn.runAction(act);\n                bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(\n                            function(sprite){\n                                sprite.stopAllActions();\n                            },event.getCurrentTarget().sprite)));\n            }\n        }else if(x>bn.getPositionX()){\n           if(Math.abs(x-bn.getPositionX())/Math.abs(y-bn.getPositionY())<1){\n                if(y<bn.getPositionY()){\n                    //  向下走\n                    var role = event.getCurrentTarget().getRole();\n                    var act=role==1?cc.animate(cc.animationCache.getAnimation(\"sp1down\")).repeatForever():cc.animate(cc.animationCache.getAnimation(\"sp2down\")).repeatForever();\n                    bn.runAction(act);\n                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(\n                                function(sprite){\n                                    sprite.stopAllActions();\n                                },event.getCurrentTarget().sprite)));\n                }else{\n                    // 向上走\n                    var role = event.getCurrentTarget().getRole();\n                    var act=role==1?cc.animate(cc.animationCache.getAnimation(\"sp1up\")).repeatForever():cc.animate(cc.animationCache.getAnimation(\"sp2up\")).repeatForever();\n                    bn.runAction(act);\n                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(\n                                function(sprite){\n                                    sprite.stopAllActions();\n                                },event.getCurrentTarget().sprite)));\n                }\n            } else if(Math.abs(x-bn.getPositionX())/Math.abs(y-bn.getPositionY())>=1){// 向右走\n                var role = event.getCurrentTarget().getRole();\n                var act=role==1?cc.animate(cc.animationCache.getAnimation(\"sp1right\")).repeatForever():cc.animate(cc.animationCache.getAnimation(\"sp2right\")).repeatForever();\n                bn.runAction(act);\n                bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(\n                            function(sprite){\n                                sprite.stopAllActions();\n                            },event.getCurrentTarget().sprite)));\n            }\n        }\n        return true;\n    },\n    touchmoved:function(){\n        return true;\n    },\n    touchended:function(touch,event){\n        return true;\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_24/3faf3ea09347be95a5fd15287ff32724995d4f09/\n","slug":"CVP认证学习笔记--(何小成)020--实现切图帧动画","published":1,"updated":"2016-04-30T07:46:44.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhug001kwsazc7xo5tkj","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节内容是掌握cocos中的动画缓存，通过cc.animationCache.addAnimation，可以将预先写好的一组动画放入动画缓存，当一些事件触发时，如触摸点击屏幕精灵时，便可以通过cc.animationCache.getAnimation获取到先前缓存的动画。<a id=\"more\"></a></p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><h4 id=\"添加帧序列\"><a href=\"#添加帧序列\" class=\"headerlink\" title=\"添加帧序列\"></a>添加帧序列</h4><p>事先准备好的帧序列图片放在一张大图中，通过截取矩形区域来获得所需要的帧序列图片</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> n=<span class=\"number\">0</span>;n&lt;<span class=\"number\">4</span>;n++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> sp1Nowframedown=<span class=\"keyword\">new</span> cc.SpriteFrame(sp1Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">0</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"创建动画\"><a href=\"#创建动画\" class=\"headerlink\" title=\"创建动画\"></a>创建动画</h4><p>使用帧序列创建一个动画，动画播放0.1s</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> sp1AnimationDown=<span class=\"keyword\">new</span> cc.Animation(sp1FrameDown,<span class=\"number\">0.1</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"添加精灵到缓存\"><a href=\"#添加精灵到缓存\" class=\"headerlink\" title=\"添加精灵到缓存\"></a>添加精灵到缓存</h4><p>把精灵帧动画添加到动画缓存中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.animationCache.addAnimation(sp1AnimationDown,<span class=\"string\">&quot;sp1down&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"获取并运行动画\"><a href=\"#获取并运行动画\" class=\"headerlink\" title=\"获取并运行动画\"></a>获取并运行动画</h4><p>以上步骤完成后，就可以在事件中使用动画</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1down&quot;</span>)).repeatForever();</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>作业内容是点击屏幕，英雄移动到该位置并且播放动画，跟上节课作业差不多，只不过这节课的动画通过动画缓存来获得，而上节课使用的是固定的动画。我在作业中实现了点击按钮可以切换精灵，在行走方向的判断上，我把屏幕在以人物为中心的坐标轴上，画两条对角线，根据分为四个区域，分别判断这四个区域为上下左右。点击相应区域实现人物相应的动画播放。由于是作业，所以代码也就不是那么规范了，看起来是有点乱的，在正式项目中，应该对这些方法进行良好的封装。作业代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    chooseRole:<span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//添加背景</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg=<span class=\"keyword\">new</span> cc.Sprite(res.bg_jpg);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        bg.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        sp1Texture=cc.textureCache.addImage(<span class=\"string\">&quot;res/1.png&quot;</span>);</span><br><span class=\"line\">        sp2Texture=cc.textureCache.addImage(<span class=\"string\">&quot;res/2.png&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 精灵1</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1FrameUp=[];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1FrameDown=[];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1FrameLeft=[];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1FrameRight=[];</span><br><span class=\"line\">        <span class=\"comment\">// 精灵2</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2FrameUp=[];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2FrameDown=[];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2FrameLeft=[];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2FrameRight=[];</span><br><span class=\"line\">         <span class=\"comment\">//添加帧序列</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> n=<span class=\"number\">0</span>;n&lt;<span class=\"number\">4</span>;n++) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 精灵1</span></span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp1Nowframedown=<span class=\"keyword\">new</span> cc.SpriteFrame(sp1Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">0</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp1Nowframeleft=<span class=\"keyword\">new</span> cc.SpriteFrame(sp1Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">48</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp1Nowframeright=<span class=\"keyword\">new</span> cc.SpriteFrame(sp1Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">48</span>*<span class=\"number\">2</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp1Nowframeup=<span class=\"keyword\">new</span> cc.SpriteFrame(sp1Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">48</span>*<span class=\"number\">3</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          sp1FrameDown.push(sp1Nowframedown);</span><br><span class=\"line\">          sp1FrameLeft.push(sp1Nowframeleft);</span><br><span class=\"line\">          sp1FrameRight.push(sp1Nowframeright);</span><br><span class=\"line\">          sp1FrameUp.push(sp1Nowframeup);</span><br><span class=\"line\">          <span class=\"comment\">// 精灵2</span></span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp2Nowframedown=<span class=\"keyword\">new</span> cc.SpriteFrame(sp2Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">0</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp2Nowframeleft=<span class=\"keyword\">new</span> cc.SpriteFrame(sp2Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">48</span>*<span class=\"number\">1</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp2Nowframeright=<span class=\"keyword\">new</span> cc.SpriteFrame(sp2Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">48</span>*<span class=\"number\">2</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp2Nowframeup=<span class=\"keyword\">new</span> cc.SpriteFrame(sp2Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">48</span>*<span class=\"number\">3</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          sp2FrameUp.push(sp2Nowframeup); </span><br><span class=\"line\">          sp2FrameDown.push(sp2Nowframedown);</span><br><span class=\"line\">          sp2FrameLeft.push(sp2Nowframeleft);</span><br><span class=\"line\">          sp2FrameRight.push(sp2Nowframeright);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//创建动画</span></span><br><span class=\"line\">        <span class=\"comment\">// 精灵1</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1AnimationUp=<span class=\"keyword\">new</span> cc.Animation(sp1FrameUp,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1AnimationDown=<span class=\"keyword\">new</span> cc.Animation(sp1FrameDown,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1AnimationLeft=<span class=\"keyword\">new</span> cc.Animation(sp1FrameLeft,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1AnimationRight=<span class=\"keyword\">new</span> cc.Animation(sp1FrameRight,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">         <span class=\"comment\">// 精灵2</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2AnimationUp=<span class=\"keyword\">new</span> cc.Animation(sp2FrameUp,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2AnimationDown=<span class=\"keyword\">new</span> cc.Animation(sp2FrameDown,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2AnimationLeft=<span class=\"keyword\">new</span> cc.Animation(sp2FrameLeft,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2AnimationRight=<span class=\"keyword\">new</span> cc.Animation(sp2FrameRight,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加到缓存里</span></span><br><span class=\"line\">        <span class=\"comment\">// 精灵1</span></span><br><span class=\"line\">        cc.animationCache.addAnimation(sp1AnimationUp,<span class=\"string\">&quot;sp1up&quot;</span>);</span><br><span class=\"line\">        cc.animationCache.addAnimation(sp1AnimationDown,<span class=\"string\">&quot;sp1down&quot;</span>);</span><br><span class=\"line\">        cc.animationCache.addAnimation(sp1AnimationLeft,<span class=\"string\">&quot;sp1left&quot;</span>);</span><br><span class=\"line\">        cc.animationCache.addAnimation(sp1AnimationRight,<span class=\"string\">&quot;sp1right&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 精灵2</span></span><br><span class=\"line\">        cc.animationCache.addAnimation(sp2AnimationUp,<span class=\"string\">&quot;sp2up&quot;</span>);</span><br><span class=\"line\">        cc.animationCache.addAnimation(sp2AnimationDown,<span class=\"string\">&quot;sp2down&quot;</span>);</span><br><span class=\"line\">        cc.animationCache.addAnimation(sp2AnimationLeft,<span class=\"string\">&quot;sp2left&quot;</span>);</span><br><span class=\"line\">        cc.animationCache.addAnimation(sp2AnimationRight,<span class=\"string\">&quot;sp2right&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//创建animate并运行</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite=<span class=\"keyword\">new</span> cc.Sprite(sp1Texture,cc.rect(<span class=\"number\">32</span>,<span class=\"number\">0</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chooseRole=<span class=\"number\">1</span>;<span class=\"comment\">// 默认选择鸣人</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.sprite);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite.setScale(<span class=\"number\">4</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加按钮改变精灵</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;选鸣人&quot;</span>,<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;选小樱&quot;</span>,<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        sp1.setTag(<span class=\"number\">11</span>);</span><br><span class=\"line\">        sp2.setTag(<span class=\"number\">12</span>);</span><br><span class=\"line\">        sp1.setPositionY(<span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(sp1,sp2);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    getRole:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.chooseRole;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(obj.tag)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">11</span>:<span class=\"comment\">//鸣人</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.sprite.stopAllActions();</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.sprite.setTexture(cc.textureCache.addImage(<span class=\"string\">&quot;res/1.png&quot;</span>),cc.rect(<span class=\"number\">32</span>,<span class=\"number\">0</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.chooseRole=<span class=\"number\">1</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">12</span>:<span class=\"comment\">//小樱</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.sprite.stopAllActions();</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.sprite.setTexture(cc.textureCache.addImage(<span class=\"string\">&quot;res/2.png&quot;</span>),cc.rect(<span class=\"number\">32</span>,<span class=\"number\">0</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.chooseRole=<span class=\"number\">2</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//添加触屏事件</span></span><br><span class=\"line\">        cc.eventManager.addListener(&#123;</span><br><span class=\"line\">           event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">           swallowTouches:<span class=\"literal\">true</span>,<span class=\"comment\">//吞噬事件 不再传递</span></span><br><span class=\"line\">           onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">           onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">           onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">       &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocation().x;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocation().y;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 走路时间</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-bn.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-bn.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        bn.stopAllActions();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;bn.getPositionX())&#123;<span class=\"comment\">// 点击人物左侧</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"built_in\">Math</span>.abs(x-bn.getPositionX())/<span class=\"built_in\">Math</span>.abs(y-bn.getPositionY())&lt;<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(y&lt;bn.getPositionY())&#123;</span><br><span class=\"line\">                    <span class=\"comment\">//  向下走</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> role = <span class=\"built_in\">Number</span>(event.getCurrentTarget().getRole());</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> act=role==<span class=\"number\">1</span>?cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1down&quot;</span>)).repeatForever():cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp2down&quot;</span>)).repeatForever();</span><br><span class=\"line\">                    bn.runAction(act);</span><br><span class=\"line\">                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(</span><br><span class=\"line\">                                <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sprite</span>)</span>&#123;</span><br><span class=\"line\">                                    sprite.stopAllActions();</span><br><span class=\"line\">                                &#125;,event.getCurrentTarget().sprite)));</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 向上走</span></span><br><span class=\"line\">                     <span class=\"keyword\">var</span> role = event.getCurrentTarget().getRole();</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> act=role==<span class=\"number\">1</span>?cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1up&quot;</span>)).repeatForever():cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp2up&quot;</span>)).repeatForever();</span><br><span class=\"line\">                    bn.runAction(act);</span><br><span class=\"line\">                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(</span><br><span class=\"line\">                                <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sprite</span>)</span>&#123;</span><br><span class=\"line\">                                    sprite.stopAllActions();</span><br><span class=\"line\">                                &#125;,event.getCurrentTarget().sprite)));</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">Math</span>.abs(x-bn.getPositionX())/<span class=\"built_in\">Math</span>.abs(y-bn.getPositionY())&gt;=<span class=\"number\">1</span>)&#123;<span class=\"comment\">// 向左走</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> role = event.getCurrentTarget().getRole();</span><br><span class=\"line\">                <span class=\"keyword\">var</span> act=role==<span class=\"number\">1</span>?cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1left&quot;</span>)).repeatForever():cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp2left&quot;</span>)).repeatForever();</span><br><span class=\"line\">                bn.runAction(act);</span><br><span class=\"line\">                bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(</span><br><span class=\"line\">                            <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sprite</span>)</span>&#123;</span><br><span class=\"line\">                                sprite.stopAllActions();</span><br><span class=\"line\">                            &#125;,event.getCurrentTarget().sprite)));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(x&gt;bn.getPositionX())&#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span>(<span class=\"built_in\">Math</span>.abs(x-bn.getPositionX())/<span class=\"built_in\">Math</span>.abs(y-bn.getPositionY())&lt;<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(y&lt;bn.getPositionY())&#123;</span><br><span class=\"line\">                    <span class=\"comment\">//  向下走</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> role = event.getCurrentTarget().getRole();</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> act=role==<span class=\"number\">1</span>?cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1down&quot;</span>)).repeatForever():cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp2down&quot;</span>)).repeatForever();</span><br><span class=\"line\">                    bn.runAction(act);</span><br><span class=\"line\">                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(</span><br><span class=\"line\">                                <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sprite</span>)</span>&#123;</span><br><span class=\"line\">                                    sprite.stopAllActions();</span><br><span class=\"line\">                                &#125;,event.getCurrentTarget().sprite)));</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 向上走</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> role = event.getCurrentTarget().getRole();</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> act=role==<span class=\"number\">1</span>?cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1up&quot;</span>)).repeatForever():cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp2up&quot;</span>)).repeatForever();</span><br><span class=\"line\">                    bn.runAction(act);</span><br><span class=\"line\">                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(</span><br><span class=\"line\">                                <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sprite</span>)</span>&#123;</span><br><span class=\"line\">                                    sprite.stopAllActions();</span><br><span class=\"line\">                                &#125;,event.getCurrentTarget().sprite)));</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">Math</span>.abs(x-bn.getPositionX())/<span class=\"built_in\">Math</span>.abs(y-bn.getPositionY())&gt;=<span class=\"number\">1</span>)&#123;<span class=\"comment\">// 向右走</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> role = event.getCurrentTarget().getRole();</span><br><span class=\"line\">                <span class=\"keyword\">var</span> act=role==<span class=\"number\">1</span>?cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1right&quot;</span>)).repeatForever():cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp2right&quot;</span>)).repeatForever();</span><br><span class=\"line\">                bn.runAction(act);</span><br><span class=\"line\">                bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(</span><br><span class=\"line\">                            <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sprite</span>)</span>&#123;</span><br><span class=\"line\">                                sprite.stopAllActions();</span><br><span class=\"line\">                            &#125;,event.getCurrentTarget().sprite)));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_24/3faf3ea09347be95a5fd15287ff32724995d4f09/\">http://www.cocoscvp.com/usercode/2016_04_24/3faf3ea09347be95a5fd15287ff32724995d4f09/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节内容是掌握cocos中的动画缓存，通过cc.animationCache.addAnimation，可以将预先写好的一组动画放入动画缓存，当一些事件触发时，如触摸点击屏幕精灵时，便可以通过cc.animationCache.getAnimation获取到先前缓存的动画。","more":"</p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><h4 id=\"添加帧序列\"><a href=\"#添加帧序列\" class=\"headerlink\" title=\"添加帧序列\"></a>添加帧序列</h4><p>事先准备好的帧序列图片放在一张大图中，通过截取矩形区域来获得所需要的帧序列图片</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> n=<span class=\"number\">0</span>;n&lt;<span class=\"number\">4</span>;n++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> sp1Nowframedown=<span class=\"keyword\">new</span> cc.SpriteFrame(sp1Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">0</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"创建动画\"><a href=\"#创建动画\" class=\"headerlink\" title=\"创建动画\"></a>创建动画</h4><p>使用帧序列创建一个动画，动画播放0.1s</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> sp1AnimationDown=<span class=\"keyword\">new</span> cc.Animation(sp1FrameDown,<span class=\"number\">0.1</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"添加精灵到缓存\"><a href=\"#添加精灵到缓存\" class=\"headerlink\" title=\"添加精灵到缓存\"></a>添加精灵到缓存</h4><p>把精灵帧动画添加到动画缓存中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.animationCache.addAnimation(sp1AnimationDown,<span class=\"string\">&quot;sp1down&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"获取并运行动画\"><a href=\"#获取并运行动画\" class=\"headerlink\" title=\"获取并运行动画\"></a>获取并运行动画</h4><p>以上步骤完成后，就可以在事件中使用动画</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1down&quot;</span>)).repeatForever();</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>作业内容是点击屏幕，英雄移动到该位置并且播放动画，跟上节课作业差不多，只不过这节课的动画通过动画缓存来获得，而上节课使用的是固定的动画。我在作业中实现了点击按钮可以切换精灵，在行走方向的判断上，我把屏幕在以人物为中心的坐标轴上，画两条对角线，根据分为四个区域，分别判断这四个区域为上下左右。点击相应区域实现人物相应的动画播放。由于是作业，所以代码也就不是那么规范了，看起来是有点乱的，在正式项目中，应该对这些方法进行良好的封装。作业代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    chooseRole:<span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//添加背景</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg=<span class=\"keyword\">new</span> cc.Sprite(res.bg_jpg);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        bg.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        sp1Texture=cc.textureCache.addImage(<span class=\"string\">&quot;res/1.png&quot;</span>);</span><br><span class=\"line\">        sp2Texture=cc.textureCache.addImage(<span class=\"string\">&quot;res/2.png&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 精灵1</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1FrameUp=[];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1FrameDown=[];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1FrameLeft=[];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1FrameRight=[];</span><br><span class=\"line\">        <span class=\"comment\">// 精灵2</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2FrameUp=[];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2FrameDown=[];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2FrameLeft=[];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2FrameRight=[];</span><br><span class=\"line\">         <span class=\"comment\">//添加帧序列</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> n=<span class=\"number\">0</span>;n&lt;<span class=\"number\">4</span>;n++) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 精灵1</span></span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp1Nowframedown=<span class=\"keyword\">new</span> cc.SpriteFrame(sp1Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">0</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp1Nowframeleft=<span class=\"keyword\">new</span> cc.SpriteFrame(sp1Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">48</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp1Nowframeright=<span class=\"keyword\">new</span> cc.SpriteFrame(sp1Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">48</span>*<span class=\"number\">2</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp1Nowframeup=<span class=\"keyword\">new</span> cc.SpriteFrame(sp1Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">48</span>*<span class=\"number\">3</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          sp1FrameDown.push(sp1Nowframedown);</span><br><span class=\"line\">          sp1FrameLeft.push(sp1Nowframeleft);</span><br><span class=\"line\">          sp1FrameRight.push(sp1Nowframeright);</span><br><span class=\"line\">          sp1FrameUp.push(sp1Nowframeup);</span><br><span class=\"line\">          <span class=\"comment\">// 精灵2</span></span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp2Nowframedown=<span class=\"keyword\">new</span> cc.SpriteFrame(sp2Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">0</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp2Nowframeleft=<span class=\"keyword\">new</span> cc.SpriteFrame(sp2Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">48</span>*<span class=\"number\">1</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp2Nowframeright=<span class=\"keyword\">new</span> cc.SpriteFrame(sp2Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">48</span>*<span class=\"number\">2</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          <span class=\"keyword\">var</span> sp2Nowframeup=<span class=\"keyword\">new</span> cc.SpriteFrame(sp2Texture,cc.rect(<span class=\"number\">32</span>*n,<span class=\"number\">48</span>*<span class=\"number\">3</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">          sp2FrameUp.push(sp2Nowframeup); </span><br><span class=\"line\">          sp2FrameDown.push(sp2Nowframedown);</span><br><span class=\"line\">          sp2FrameLeft.push(sp2Nowframeleft);</span><br><span class=\"line\">          sp2FrameRight.push(sp2Nowframeright);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//创建动画</span></span><br><span class=\"line\">        <span class=\"comment\">// 精灵1</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1AnimationUp=<span class=\"keyword\">new</span> cc.Animation(sp1FrameUp,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1AnimationDown=<span class=\"keyword\">new</span> cc.Animation(sp1FrameDown,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1AnimationLeft=<span class=\"keyword\">new</span> cc.Animation(sp1FrameLeft,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1AnimationRight=<span class=\"keyword\">new</span> cc.Animation(sp1FrameRight,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">         <span class=\"comment\">// 精灵2</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2AnimationUp=<span class=\"keyword\">new</span> cc.Animation(sp2FrameUp,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2AnimationDown=<span class=\"keyword\">new</span> cc.Animation(sp2FrameDown,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2AnimationLeft=<span class=\"keyword\">new</span> cc.Animation(sp2FrameLeft,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2AnimationRight=<span class=\"keyword\">new</span> cc.Animation(sp2FrameRight,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加到缓存里</span></span><br><span class=\"line\">        <span class=\"comment\">// 精灵1</span></span><br><span class=\"line\">        cc.animationCache.addAnimation(sp1AnimationUp,<span class=\"string\">&quot;sp1up&quot;</span>);</span><br><span class=\"line\">        cc.animationCache.addAnimation(sp1AnimationDown,<span class=\"string\">&quot;sp1down&quot;</span>);</span><br><span class=\"line\">        cc.animationCache.addAnimation(sp1AnimationLeft,<span class=\"string\">&quot;sp1left&quot;</span>);</span><br><span class=\"line\">        cc.animationCache.addAnimation(sp1AnimationRight,<span class=\"string\">&quot;sp1right&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 精灵2</span></span><br><span class=\"line\">        cc.animationCache.addAnimation(sp2AnimationUp,<span class=\"string\">&quot;sp2up&quot;</span>);</span><br><span class=\"line\">        cc.animationCache.addAnimation(sp2AnimationDown,<span class=\"string\">&quot;sp2down&quot;</span>);</span><br><span class=\"line\">        cc.animationCache.addAnimation(sp2AnimationLeft,<span class=\"string\">&quot;sp2left&quot;</span>);</span><br><span class=\"line\">        cc.animationCache.addAnimation(sp2AnimationRight,<span class=\"string\">&quot;sp2right&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//创建animate并运行</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite=<span class=\"keyword\">new</span> cc.Sprite(sp1Texture,cc.rect(<span class=\"number\">32</span>,<span class=\"number\">0</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chooseRole=<span class=\"number\">1</span>;<span class=\"comment\">// 默认选择鸣人</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.sprite);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite.setScale(<span class=\"number\">4</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.sprite.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加按钮改变精灵</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;选鸣人&quot;</span>,<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;选小樱&quot;</span>,<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        sp1.setTag(<span class=\"number\">11</span>);</span><br><span class=\"line\">        sp2.setTag(<span class=\"number\">12</span>);</span><br><span class=\"line\">        sp1.setPositionY(<span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(sp1,sp2);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    getRole:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.chooseRole;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(obj.tag)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">11</span>:<span class=\"comment\">//鸣人</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.sprite.stopAllActions();</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.sprite.setTexture(cc.textureCache.addImage(<span class=\"string\">&quot;res/1.png&quot;</span>),cc.rect(<span class=\"number\">32</span>,<span class=\"number\">0</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.chooseRole=<span class=\"number\">1</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">12</span>:<span class=\"comment\">//小樱</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.sprite.stopAllActions();</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.sprite.setTexture(cc.textureCache.addImage(<span class=\"string\">&quot;res/2.png&quot;</span>),cc.rect(<span class=\"number\">32</span>,<span class=\"number\">0</span>,<span class=\"number\">32</span>,<span class=\"number\">48</span>));</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.chooseRole=<span class=\"number\">2</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//添加触屏事件</span></span><br><span class=\"line\">        cc.eventManager.addListener(&#123;</span><br><span class=\"line\">           event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">           swallowTouches:<span class=\"literal\">true</span>,<span class=\"comment\">//吞噬事件 不再传递</span></span><br><span class=\"line\">           onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">           onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">           onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">       &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocation().x;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocation().y;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 走路时间</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-bn.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-bn.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        bn.stopAllActions();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;bn.getPositionX())&#123;<span class=\"comment\">// 点击人物左侧</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"built_in\">Math</span>.abs(x-bn.getPositionX())/<span class=\"built_in\">Math</span>.abs(y-bn.getPositionY())&lt;<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(y&lt;bn.getPositionY())&#123;</span><br><span class=\"line\">                    <span class=\"comment\">//  向下走</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> role = <span class=\"built_in\">Number</span>(event.getCurrentTarget().getRole());</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> act=role==<span class=\"number\">1</span>?cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1down&quot;</span>)).repeatForever():cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp2down&quot;</span>)).repeatForever();</span><br><span class=\"line\">                    bn.runAction(act);</span><br><span class=\"line\">                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(</span><br><span class=\"line\">                                <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sprite</span>)</span>&#123;</span><br><span class=\"line\">                                    sprite.stopAllActions();</span><br><span class=\"line\">                                &#125;,event.getCurrentTarget().sprite)));</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 向上走</span></span><br><span class=\"line\">                     <span class=\"keyword\">var</span> role = event.getCurrentTarget().getRole();</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> act=role==<span class=\"number\">1</span>?cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1up&quot;</span>)).repeatForever():cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp2up&quot;</span>)).repeatForever();</span><br><span class=\"line\">                    bn.runAction(act);</span><br><span class=\"line\">                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(</span><br><span class=\"line\">                                <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sprite</span>)</span>&#123;</span><br><span class=\"line\">                                    sprite.stopAllActions();</span><br><span class=\"line\">                                &#125;,event.getCurrentTarget().sprite)));</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">Math</span>.abs(x-bn.getPositionX())/<span class=\"built_in\">Math</span>.abs(y-bn.getPositionY())&gt;=<span class=\"number\">1</span>)&#123;<span class=\"comment\">// 向左走</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> role = event.getCurrentTarget().getRole();</span><br><span class=\"line\">                <span class=\"keyword\">var</span> act=role==<span class=\"number\">1</span>?cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1left&quot;</span>)).repeatForever():cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp2left&quot;</span>)).repeatForever();</span><br><span class=\"line\">                bn.runAction(act);</span><br><span class=\"line\">                bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(</span><br><span class=\"line\">                            <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sprite</span>)</span>&#123;</span><br><span class=\"line\">                                sprite.stopAllActions();</span><br><span class=\"line\">                            &#125;,event.getCurrentTarget().sprite)));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(x&gt;bn.getPositionX())&#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span>(<span class=\"built_in\">Math</span>.abs(x-bn.getPositionX())/<span class=\"built_in\">Math</span>.abs(y-bn.getPositionY())&lt;<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(y&lt;bn.getPositionY())&#123;</span><br><span class=\"line\">                    <span class=\"comment\">//  向下走</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> role = event.getCurrentTarget().getRole();</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> act=role==<span class=\"number\">1</span>?cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1down&quot;</span>)).repeatForever():cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp2down&quot;</span>)).repeatForever();</span><br><span class=\"line\">                    bn.runAction(act);</span><br><span class=\"line\">                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(</span><br><span class=\"line\">                                <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sprite</span>)</span>&#123;</span><br><span class=\"line\">                                    sprite.stopAllActions();</span><br><span class=\"line\">                                &#125;,event.getCurrentTarget().sprite)));</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 向上走</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> role = event.getCurrentTarget().getRole();</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> act=role==<span class=\"number\">1</span>?cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1up&quot;</span>)).repeatForever():cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp2up&quot;</span>)).repeatForever();</span><br><span class=\"line\">                    bn.runAction(act);</span><br><span class=\"line\">                    bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(</span><br><span class=\"line\">                                <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sprite</span>)</span>&#123;</span><br><span class=\"line\">                                    sprite.stopAllActions();</span><br><span class=\"line\">                                &#125;,event.getCurrentTarget().sprite)));</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">Math</span>.abs(x-bn.getPositionX())/<span class=\"built_in\">Math</span>.abs(y-bn.getPositionY())&gt;=<span class=\"number\">1</span>)&#123;<span class=\"comment\">// 向右走</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> role = event.getCurrentTarget().getRole();</span><br><span class=\"line\">                <span class=\"keyword\">var</span> act=role==<span class=\"number\">1</span>?cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp1right&quot;</span>)).repeatForever():cc.animate(cc.animationCache.getAnimation(<span class=\"string\">&quot;sp2right&quot;</span>)).repeatForever();</span><br><span class=\"line\">                bn.runAction(act);</span><br><span class=\"line\">                bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(</span><br><span class=\"line\">                            <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sprite</span>)</span>&#123;</span><br><span class=\"line\">                                sprite.stopAllActions();</span><br><span class=\"line\">                            &#125;,event.getCurrentTarget().sprite)));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_24/3faf3ea09347be95a5fd15287ff32724995d4f09/\">http://www.cocoscvp.com/usercode/2016_04_24/3faf3ea09347be95a5fd15287ff32724995d4f09/</a></p>"},{"title":"CVP认证学习笔记--(何小成)021--纹理打包文件读取","date":"2016-04-30T07:46:00.000Z","_content":"### 概念\n本节课内容介绍了如何将多张小图打包成一张大图，以及纹理打包文件的读取，在正式项目中，一个精灵动画的多帧图片通常是通过TexturePacker打包成一张png及一个plist文件使用，在cocos中使用其中的纹理图片时，直接通过解析plist文件就能读取到打包的png的各个需要的帧图片的部分<!--more-->\n### 步骤\n#### 打包纹理图片\n上一节直接使用了打包好的纹理大图，这一节介绍打包这张大图的一个工具————TexturePacker，同时又mac版和win版，使用Texture，将要打包的图片拖进去，设置好图片大小，然后发布，就能在对应目录下生成一个png文件一个plist文件，其中png文件就是打包好的大图，plist是一个xml文件，对这张png图片的详细描述。plist文件具体内容如下：\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple Computer//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n    <dict>\n        <key>frames</key>\n        <dict>\n            <key>kick01.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{2,164},{42,106}}</string>\n                <key>offset</key>\n                <string>{-36,-3}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{15,10},{42,106}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick02.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{194,262},{56,84}}</string>\n                <key>offset</key>\n                <string>{-36,-14}</string>\n                <key>rotated</key>\n                <false/>\n                <key>sourceColorRect</key>\n                <string>{{8,32},{56,84}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick03.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{100,262},{64,92}}</string>\n                <key>offset</key>\n                <string>{-36,-10}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{4,24},{64,92}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick04.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{2,208},{72,96}}</string>\n                <key>offset</key>\n                <string>{-23,-8}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{13,20},{72,96}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick05.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{2,282},{54,90}}</string>\n                <key>offset</key>\n                <string>{-29,-11}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{16,26},{54,90}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick06.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{2,2},{122,102}}</string>\n                <key>offset</key>\n                <string>{8,-5}</string>\n                <key>rotated</key>\n                <false/>\n                <key>sourceColorRect</key>\n                <string>{{19,14},{122,102}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick07.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{126,2},{118,102}}</string>\n                <key>offset</key>\n                <string>{8,-5}</string>\n                <key>rotated</key>\n                <false/>\n                <key>sourceColorRect</key>\n                <string>{{21,14},{118,102}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick08.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{110,168},{92,100}}</string>\n                <key>offset</key>\n                <string>{6,-6}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{32,16},{92,100}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick09.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{118,106},{60,112}}</string>\n                <key>offset</key>\n                <string>{-11,0}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{31,4},{60,112}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick10.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{2,106},{56,114}}</string>\n                <key>offset</key>\n                <string>{-12,1}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{32,2},{56,114}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n        </dict>\n        <key>metadata</key>\n        <dict>\n            <key>format</key>\n            <integer>2</integer>\n            <key>realTextureFileName</key>\n            <string>npc.png</string>\n            <key>size</key>\n            <string>{256,512}</string>\n            <key>smartupdate</key>\n            <string>$TexturePacker:SmartUpdate:e4480d70d3c21807e7e1537afdfcd8a8$</string>\n            <key>textureFileName</key>\n            <string>npc.png</string>\n        </dict>\n    </dict>\n</plist>\n```\n可以看到，在plist中，对png中的每个小图片的位置，名字等都有详细描述，在cocos中通过SpriteFrameCache就可以对plist中的信息进行读取，然后从png中切出这张小图。\n#### 加载纹理图片\n一次性加载纹理图片并解析所有的帧\n```javascript\ncc.spriteFrameCache.addSpriteFrames(res.npc_plist);\n```\n#### 使用帧缓存创建Sprite\n根据帧缓存就可以创建sprite\n```javascript\nvar sp=new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"kick01.png\"));\nthis.addChild(sp);\n```\n#### 使用帧缓存创建动画\n也可以使用帧缓存创建动画\n```javascript\nvar frames=[];\nfor(var n=1;n<10;n++)\n{\n    var sf=cc.spriteFrameCache.getSpriteFrame(\"kick0\"+n+\".png\");\n    frames.push(sf);\n}\nvar animation=new cc.Animation(frames,0.2);\nvar animate=new cc.animate(animation);\n```\n### 作业\n本节作业：实现对spriteBachNode的动画创建，让动画播放添加到一个spriteBachNode父节点上。作业代码如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n\n        //一次加载纹理图片和解析所有的帧\n        cc.spriteFrameCache.addSpriteFrames(res.npc_plist);\n        //根据帧缓存来创建sprite\n        var sp=new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"kick01.png\"));\n        // this.addChild(sp);\n        sp.setPosition(200,200);\n        //使用帧缓存创建动画\n        var frames=[];\n        for(var n=1;n<10;n++)\n        {\n            var sf=cc.spriteFrameCache.getSpriteFrame(\"kick0\"+n+\".png\");\n            frames.push(sf);\n        }\n        var animation=new cc.Animation(frames,0.2);\n        var animate1=new cc.animate(animation);\n        var animate2=new cc.animate(animation);\n        \n        // 本节作业，实现对spriteBachNode的动画创建\n        // 让动画播放添加到一个spriteBachNode父节点上\n        \n        // 读取和plist文件同名的png文件，这个文件其实已经被读取到纹理内存里了的\n        var spBatch = new cc.SpriteBatchNode(res.npc_png);\n        this.addChild(spBatch,1);\n        // 为SpriteBatchNode添加第一个Sprite\n        var sp1 = new cc.Sprite.create(cc.spriteFrameCache.getSpriteFrame(\"kick01.png\"));\n        sp1.setPosition(300,300);\n        spBatch.addChild(sp1,3);\n        sp1.runAction(animate1.repeatForever());\n        // 为SpriteBatchNode添加第二个Sprite\n        var sp2 = new cc.Sprite.create(cc.spriteFrameCache.getSpriteFrame(\"kick01.png\"));\n        sp2.setPosition(500,300);\n        spBatch.addChild(sp2,3);\n        sp2.runAction(animate2.repeatForever());\n        return true;\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_30/810eec0b33a2c2d59f828dda9204f341d0d9a585/\n","source":"_posts/CVP认证学习笔记--(何小成)021--纹理打包文件读取.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)021--纹理打包文件读取\ndate: 2016-04-30 15:46\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节课内容介绍了如何将多张小图打包成一张大图，以及纹理打包文件的读取，在正式项目中，一个精灵动画的多帧图片通常是通过TexturePacker打包成一张png及一个plist文件使用，在cocos中使用其中的纹理图片时，直接通过解析plist文件就能读取到打包的png的各个需要的帧图片的部分<!--more-->\n### 步骤\n#### 打包纹理图片\n上一节直接使用了打包好的纹理大图，这一节介绍打包这张大图的一个工具————TexturePacker，同时又mac版和win版，使用Texture，将要打包的图片拖进去，设置好图片大小，然后发布，就能在对应目录下生成一个png文件一个plist文件，其中png文件就是打包好的大图，plist是一个xml文件，对这张png图片的详细描述。plist文件具体内容如下：\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple Computer//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n    <dict>\n        <key>frames</key>\n        <dict>\n            <key>kick01.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{2,164},{42,106}}</string>\n                <key>offset</key>\n                <string>{-36,-3}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{15,10},{42,106}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick02.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{194,262},{56,84}}</string>\n                <key>offset</key>\n                <string>{-36,-14}</string>\n                <key>rotated</key>\n                <false/>\n                <key>sourceColorRect</key>\n                <string>{{8,32},{56,84}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick03.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{100,262},{64,92}}</string>\n                <key>offset</key>\n                <string>{-36,-10}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{4,24},{64,92}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick04.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{2,208},{72,96}}</string>\n                <key>offset</key>\n                <string>{-23,-8}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{13,20},{72,96}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick05.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{2,282},{54,90}}</string>\n                <key>offset</key>\n                <string>{-29,-11}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{16,26},{54,90}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick06.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{2,2},{122,102}}</string>\n                <key>offset</key>\n                <string>{8,-5}</string>\n                <key>rotated</key>\n                <false/>\n                <key>sourceColorRect</key>\n                <string>{{19,14},{122,102}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick07.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{126,2},{118,102}}</string>\n                <key>offset</key>\n                <string>{8,-5}</string>\n                <key>rotated</key>\n                <false/>\n                <key>sourceColorRect</key>\n                <string>{{21,14},{118,102}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick08.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{110,168},{92,100}}</string>\n                <key>offset</key>\n                <string>{6,-6}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{32,16},{92,100}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick09.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{118,106},{60,112}}</string>\n                <key>offset</key>\n                <string>{-11,0}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{31,4},{60,112}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n            <key>kick10.png</key>\n            <dict>\n                <key>frame</key>\n                <string>{{2,106},{56,114}}</string>\n                <key>offset</key>\n                <string>{-12,1}</string>\n                <key>rotated</key>\n                <true/>\n                <key>sourceColorRect</key>\n                <string>{{32,2},{56,114}}</string>\n                <key>sourceSize</key>\n                <string>{144,120}</string>\n            </dict>\n        </dict>\n        <key>metadata</key>\n        <dict>\n            <key>format</key>\n            <integer>2</integer>\n            <key>realTextureFileName</key>\n            <string>npc.png</string>\n            <key>size</key>\n            <string>{256,512}</string>\n            <key>smartupdate</key>\n            <string>$TexturePacker:SmartUpdate:e4480d70d3c21807e7e1537afdfcd8a8$</string>\n            <key>textureFileName</key>\n            <string>npc.png</string>\n        </dict>\n    </dict>\n</plist>\n```\n可以看到，在plist中，对png中的每个小图片的位置，名字等都有详细描述，在cocos中通过SpriteFrameCache就可以对plist中的信息进行读取，然后从png中切出这张小图。\n#### 加载纹理图片\n一次性加载纹理图片并解析所有的帧\n```javascript\ncc.spriteFrameCache.addSpriteFrames(res.npc_plist);\n```\n#### 使用帧缓存创建Sprite\n根据帧缓存就可以创建sprite\n```javascript\nvar sp=new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"kick01.png\"));\nthis.addChild(sp);\n```\n#### 使用帧缓存创建动画\n也可以使用帧缓存创建动画\n```javascript\nvar frames=[];\nfor(var n=1;n<10;n++)\n{\n    var sf=cc.spriteFrameCache.getSpriteFrame(\"kick0\"+n+\".png\");\n    frames.push(sf);\n}\nvar animation=new cc.Animation(frames,0.2);\nvar animate=new cc.animate(animation);\n```\n### 作业\n本节作业：实现对spriteBachNode的动画创建，让动画播放添加到一个spriteBachNode父节点上。作业代码如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n\n        //一次加载纹理图片和解析所有的帧\n        cc.spriteFrameCache.addSpriteFrames(res.npc_plist);\n        //根据帧缓存来创建sprite\n        var sp=new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"kick01.png\"));\n        // this.addChild(sp);\n        sp.setPosition(200,200);\n        //使用帧缓存创建动画\n        var frames=[];\n        for(var n=1;n<10;n++)\n        {\n            var sf=cc.spriteFrameCache.getSpriteFrame(\"kick0\"+n+\".png\");\n            frames.push(sf);\n        }\n        var animation=new cc.Animation(frames,0.2);\n        var animate1=new cc.animate(animation);\n        var animate2=new cc.animate(animation);\n        \n        // 本节作业，实现对spriteBachNode的动画创建\n        // 让动画播放添加到一个spriteBachNode父节点上\n        \n        // 读取和plist文件同名的png文件，这个文件其实已经被读取到纹理内存里了的\n        var spBatch = new cc.SpriteBatchNode(res.npc_png);\n        this.addChild(spBatch,1);\n        // 为SpriteBatchNode添加第一个Sprite\n        var sp1 = new cc.Sprite.create(cc.spriteFrameCache.getSpriteFrame(\"kick01.png\"));\n        sp1.setPosition(300,300);\n        spBatch.addChild(sp1,3);\n        sp1.runAction(animate1.repeatForever());\n        // 为SpriteBatchNode添加第二个Sprite\n        var sp2 = new cc.Sprite.create(cc.spriteFrameCache.getSpriteFrame(\"kick01.png\"));\n        sp2.setPosition(500,300);\n        spBatch.addChild(sp2,3);\n        sp2.runAction(animate2.repeatForever());\n        return true;\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_30/810eec0b33a2c2d59f828dda9204f341d0d9a585/\n","slug":"CVP认证学习笔记--(何小成)021--纹理打包文件读取","published":1,"updated":"2016-04-30T11:18:18.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhui001owsaz4o1v9gfj","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课内容介绍了如何将多张小图打包成一张大图，以及纹理打包文件的读取，在正式项目中，一个精灵动画的多帧图片通常是通过TexturePacker打包成一张png及一个plist文件使用，在cocos中使用其中的纹理图片时，直接通过解析plist文件就能读取到打包的png的各个需要的帧图片的部分<a id=\"more\"></a></p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><h4 id=\"打包纹理图片\"><a href=\"#打包纹理图片\" class=\"headerlink\" title=\"打包纹理图片\"></a>打包纹理图片</h4><p>上一节直接使用了打包好的纹理大图，这一节介绍打包这张大图的一个工具————TexturePacker，同时又mac版和win版，使用Texture，将要打包的图片拖进去，设置好图片大小，然后发布，就能在对应目录下生成一个png文件一个plist文件，其中png文件就是打包好的大图，plist是一个xml文件，对这张png图片的详细描述。plist文件具体内容如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">plist</span> <span class=\"meta-keyword\">PUBLIC</span> <span class=\"meta-string\">&quot;-//Apple Computer//DTD PLIST 1.0//EN&quot;</span> <span class=\"meta-string\">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plist</span> <span class=\"attr\">version</span>=<span class=\"string\">&quot;1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frames<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick01.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;2,164&#125;,&#123;42,106&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-36,-3&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;15,10&#125;,&#123;42,106&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick02.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;194,262&#125;,&#123;56,84&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-36,-14&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">false</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;8,32&#125;,&#123;56,84&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick03.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;100,262&#125;,&#123;64,92&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-36,-10&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;4,24&#125;,&#123;64,92&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick04.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;2,208&#125;,&#123;72,96&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-23,-8&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;13,20&#125;,&#123;72,96&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick05.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;2,282&#125;,&#123;54,90&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-29,-11&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;16,26&#125;,&#123;54,90&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick06.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;2,2&#125;,&#123;122,102&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;8,-5&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">false</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;19,14&#125;,&#123;122,102&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick07.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;126,2&#125;,&#123;118,102&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;8,-5&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">false</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;21,14&#125;,&#123;118,102&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick08.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;110,168&#125;,&#123;92,100&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;6,-6&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;32,16&#125;,&#123;92,100&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick09.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;118,106&#125;,&#123;60,112&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-11,0&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;31,4&#125;,&#123;60,112&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick10.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;2,106&#125;,&#123;56,114&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-12,1&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;32,2&#125;,&#123;56,114&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>metadata<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>format<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">integer</span>&gt;</span>2<span class=\"tag\">&lt;/<span class=\"name\">integer</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>realTextureFileName<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>npc.png<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>size<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;256,512&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>smartupdate<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>$TexturePacker:SmartUpdate:e4480d70d3c21807e7e1537afdfcd8a8$<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>textureFileName<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>npc.png<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plist</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>可以看到，在plist中，对png中的每个小图片的位置，名字等都有详细描述，在cocos中通过SpriteFrameCache就可以对plist中的信息进行读取，然后从png中切出这张小图。</p>\n<h4 id=\"加载纹理图片\"><a href=\"#加载纹理图片\" class=\"headerlink\" title=\"加载纹理图片\"></a>加载纹理图片</h4><p>一次性加载纹理图片并解析所有的帧</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.spriteFrameCache.addSpriteFrames(res.npc_plist);</span><br></pre></td></tr></table></figure>\n<h4 id=\"使用帧缓存创建Sprite\"><a href=\"#使用帧缓存创建Sprite\" class=\"headerlink\" title=\"使用帧缓存创建Sprite\"></a>使用帧缓存创建Sprite</h4><p>根据帧缓存就可以创建sprite</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> sp=<span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;kick01.png&quot;</span>));</span><br><span class=\"line\"><span class=\"built_in\">this</span>.addChild(sp);</span><br></pre></td></tr></table></figure>\n<h4 id=\"使用帧缓存创建动画\"><a href=\"#使用帧缓存创建动画\" class=\"headerlink\" title=\"使用帧缓存创建动画\"></a>使用帧缓存创建动画</h4><p>也可以使用帧缓存创建动画</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> frames=[];</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> n=<span class=\"number\">1</span>;n&lt;<span class=\"number\">10</span>;n++)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> sf=cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;kick0&quot;</span>+n+<span class=\"string\">&quot;.png&quot;</span>);</span><br><span class=\"line\">    frames.push(sf);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> animation=<span class=\"keyword\">new</span> cc.Animation(frames,<span class=\"number\">0.2</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> animate=<span class=\"keyword\">new</span> cc.animate(animation);</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：实现对spriteBachNode的动画创建，让动画播放添加到一个spriteBachNode父节点上。作业代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//一次加载纹理图片和解析所有的帧</span></span><br><span class=\"line\">        cc.spriteFrameCache.addSpriteFrames(res.npc_plist);</span><br><span class=\"line\">        <span class=\"comment\">//根据帧缓存来创建sprite</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp=<span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;kick01.png&quot;</span>));</span><br><span class=\"line\">        <span class=\"comment\">// this.addChild(sp);</span></span><br><span class=\"line\">        sp.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        <span class=\"comment\">//使用帧缓存创建动画</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> frames=[];</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> n=<span class=\"number\">1</span>;n&lt;<span class=\"number\">10</span>;n++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> sf=cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;kick0&quot;</span>+n+<span class=\"string\">&quot;.png&quot;</span>);</span><br><span class=\"line\">            frames.push(sf);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> animation=<span class=\"keyword\">new</span> cc.Animation(frames,<span class=\"number\">0.2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> animate1=<span class=\"keyword\">new</span> cc.animate(animation);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> animate2=<span class=\"keyword\">new</span> cc.animate(animation);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 本节作业，实现对spriteBachNode的动画创建</span></span><br><span class=\"line\">        <span class=\"comment\">// 让动画播放添加到一个spriteBachNode父节点上</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 读取和plist文件同名的png文件，这个文件其实已经被读取到纹理内存里了的</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> spBatch = <span class=\"keyword\">new</span> cc.SpriteBatchNode(res.npc_png);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(spBatch,<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 为SpriteBatchNode添加第一个Sprite</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1 = <span class=\"keyword\">new</span> cc.Sprite.create(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;kick01.png&quot;</span>));</span><br><span class=\"line\">        sp1.setPosition(<span class=\"number\">300</span>,<span class=\"number\">300</span>);</span><br><span class=\"line\">        spBatch.addChild(sp1,<span class=\"number\">3</span>);</span><br><span class=\"line\">        sp1.runAction(animate1.repeatForever());</span><br><span class=\"line\">        <span class=\"comment\">// 为SpriteBatchNode添加第二个Sprite</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2 = <span class=\"keyword\">new</span> cc.Sprite.create(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;kick01.png&quot;</span>));</span><br><span class=\"line\">        sp2.setPosition(<span class=\"number\">500</span>,<span class=\"number\">300</span>);</span><br><span class=\"line\">        spBatch.addChild(sp2,<span class=\"number\">3</span>);</span><br><span class=\"line\">        sp2.runAction(animate2.repeatForever());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_30/810eec0b33a2c2d59f828dda9204f341d0d9a585/\">http://www.cocoscvp.com/usercode/2016_04_30/810eec0b33a2c2d59f828dda9204f341d0d9a585/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课内容介绍了如何将多张小图打包成一张大图，以及纹理打包文件的读取，在正式项目中，一个精灵动画的多帧图片通常是通过TexturePacker打包成一张png及一个plist文件使用，在cocos中使用其中的纹理图片时，直接通过解析plist文件就能读取到打包的png的各个需要的帧图片的部分","more":"</p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><h4 id=\"打包纹理图片\"><a href=\"#打包纹理图片\" class=\"headerlink\" title=\"打包纹理图片\"></a>打包纹理图片</h4><p>上一节直接使用了打包好的纹理大图，这一节介绍打包这张大图的一个工具————TexturePacker，同时又mac版和win版，使用Texture，将要打包的图片拖进去，设置好图片大小，然后发布，就能在对应目录下生成一个png文件一个plist文件，其中png文件就是打包好的大图，plist是一个xml文件，对这张png图片的详细描述。plist文件具体内容如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">plist</span> <span class=\"meta-keyword\">PUBLIC</span> <span class=\"meta-string\">&quot;-//Apple Computer//DTD PLIST 1.0//EN&quot;</span> <span class=\"meta-string\">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plist</span> <span class=\"attr\">version</span>=<span class=\"string\">&quot;1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frames<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick01.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;2,164&#125;,&#123;42,106&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-36,-3&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;15,10&#125;,&#123;42,106&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick02.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;194,262&#125;,&#123;56,84&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-36,-14&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">false</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;8,32&#125;,&#123;56,84&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick03.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;100,262&#125;,&#123;64,92&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-36,-10&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;4,24&#125;,&#123;64,92&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick04.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;2,208&#125;,&#123;72,96&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-23,-8&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;13,20&#125;,&#123;72,96&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick05.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;2,282&#125;,&#123;54,90&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-29,-11&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;16,26&#125;,&#123;54,90&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick06.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;2,2&#125;,&#123;122,102&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;8,-5&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">false</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;19,14&#125;,&#123;122,102&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick07.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;126,2&#125;,&#123;118,102&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;8,-5&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">false</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;21,14&#125;,&#123;118,102&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick08.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;110,168&#125;,&#123;92,100&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;6,-6&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;32,16&#125;,&#123;92,100&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick09.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;118,106&#125;,&#123;60,112&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-11,0&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;31,4&#125;,&#123;60,112&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kick10.png<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>frame<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;2,106&#125;,&#123;56,114&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>offset<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;-12,1&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>rotated<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceColorRect<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;&#123;32,2&#125;,&#123;56,114&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>sourceSize<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;144,120&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>metadata<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>format<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">integer</span>&gt;</span>2<span class=\"tag\">&lt;/<span class=\"name\">integer</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>realTextureFileName<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>npc.png<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>size<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>&#123;256,512&#125;<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>smartupdate<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>$TexturePacker:SmartUpdate:e4480d70d3c21807e7e1537afdfcd8a8$<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>textureFileName<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>npc.png<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plist</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>可以看到，在plist中，对png中的每个小图片的位置，名字等都有详细描述，在cocos中通过SpriteFrameCache就可以对plist中的信息进行读取，然后从png中切出这张小图。</p>\n<h4 id=\"加载纹理图片\"><a href=\"#加载纹理图片\" class=\"headerlink\" title=\"加载纹理图片\"></a>加载纹理图片</h4><p>一次性加载纹理图片并解析所有的帧</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc.spriteFrameCache.addSpriteFrames(res.npc_plist);</span><br></pre></td></tr></table></figure>\n<h4 id=\"使用帧缓存创建Sprite\"><a href=\"#使用帧缓存创建Sprite\" class=\"headerlink\" title=\"使用帧缓存创建Sprite\"></a>使用帧缓存创建Sprite</h4><p>根据帧缓存就可以创建sprite</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> sp=<span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;kick01.png&quot;</span>));</span><br><span class=\"line\"><span class=\"built_in\">this</span>.addChild(sp);</span><br></pre></td></tr></table></figure>\n<h4 id=\"使用帧缓存创建动画\"><a href=\"#使用帧缓存创建动画\" class=\"headerlink\" title=\"使用帧缓存创建动画\"></a>使用帧缓存创建动画</h4><p>也可以使用帧缓存创建动画</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> frames=[];</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> n=<span class=\"number\">1</span>;n&lt;<span class=\"number\">10</span>;n++)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> sf=cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;kick0&quot;</span>+n+<span class=\"string\">&quot;.png&quot;</span>);</span><br><span class=\"line\">    frames.push(sf);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> animation=<span class=\"keyword\">new</span> cc.Animation(frames,<span class=\"number\">0.2</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> animate=<span class=\"keyword\">new</span> cc.animate(animation);</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：实现对spriteBachNode的动画创建，让动画播放添加到一个spriteBachNode父节点上。作业代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//一次加载纹理图片和解析所有的帧</span></span><br><span class=\"line\">        cc.spriteFrameCache.addSpriteFrames(res.npc_plist);</span><br><span class=\"line\">        <span class=\"comment\">//根据帧缓存来创建sprite</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp=<span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;kick01.png&quot;</span>));</span><br><span class=\"line\">        <span class=\"comment\">// this.addChild(sp);</span></span><br><span class=\"line\">        sp.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        <span class=\"comment\">//使用帧缓存创建动画</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> frames=[];</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> n=<span class=\"number\">1</span>;n&lt;<span class=\"number\">10</span>;n++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> sf=cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;kick0&quot;</span>+n+<span class=\"string\">&quot;.png&quot;</span>);</span><br><span class=\"line\">            frames.push(sf);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> animation=<span class=\"keyword\">new</span> cc.Animation(frames,<span class=\"number\">0.2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> animate1=<span class=\"keyword\">new</span> cc.animate(animation);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> animate2=<span class=\"keyword\">new</span> cc.animate(animation);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 本节作业，实现对spriteBachNode的动画创建</span></span><br><span class=\"line\">        <span class=\"comment\">// 让动画播放添加到一个spriteBachNode父节点上</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 读取和plist文件同名的png文件，这个文件其实已经被读取到纹理内存里了的</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> spBatch = <span class=\"keyword\">new</span> cc.SpriteBatchNode(res.npc_png);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(spBatch,<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 为SpriteBatchNode添加第一个Sprite</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp1 = <span class=\"keyword\">new</span> cc.Sprite.create(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;kick01.png&quot;</span>));</span><br><span class=\"line\">        sp1.setPosition(<span class=\"number\">300</span>,<span class=\"number\">300</span>);</span><br><span class=\"line\">        spBatch.addChild(sp1,<span class=\"number\">3</span>);</span><br><span class=\"line\">        sp1.runAction(animate1.repeatForever());</span><br><span class=\"line\">        <span class=\"comment\">// 为SpriteBatchNode添加第二个Sprite</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp2 = <span class=\"keyword\">new</span> cc.Sprite.create(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;kick01.png&quot;</span>));</span><br><span class=\"line\">        sp2.setPosition(<span class=\"number\">500</span>,<span class=\"number\">300</span>);</span><br><span class=\"line\">        spBatch.addChild(sp2,<span class=\"number\">3</span>);</span><br><span class=\"line\">        sp2.runAction(animate2.repeatForever());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_30/810eec0b33a2c2d59f828dda9204f341d0d9a585/\">http://www.cocoscvp.com/usercode/2016_04_30/810eec0b33a2c2d59f828dda9204f341d0d9a585/</a></p>"},{"title":"CVP认证学习笔记--(何小成)022--加载帧动画","date":"2016-05-04T16:05:00.000Z","_content":"### 概念\n本节课介绍如何使用Animation Editor创建帧动画，然后在cocos中加载编辑好的动画，通过一些动画编辑器如Animation Editor能使我们在开发动画的时候更加方便，在cocos中，可以通过ArmatureDataManager加载自定义好的帧动画。<!--more-->\n### 步骤\n首先需要下载Animation Editor（从大海老师网盘中取win版的），网上没找到mac版的，我只能找了一个win的电脑装了Animation Editor，并且将网盘中的图片资源做了四个动画，分别是stand、walk、punch、kick，代表robert的四个状态，最好之后由酋长上传到了作业资源中。然后再根据作业要求在程序中加载我制作好的帧动画。实际上，也有别的动画编辑器，包括现在Animation Editor也继承到了Cocos Studio中，本节课就Animation Editor为例进行讲解。\n#### 制作帧动画\n制作帧动画的过程很简单，通过Animation Editor使得动画编辑非常简单，只需要把需要的资源拖进资源中，然后选择形体模式，将第一张图片放在屏幕中心，如下图：\n![Animation editor形体模式](http://7xnnwn.com1.z0.glb.clouddn.com/2.pic.jpg）\n选择动画模式，将剩下的四张图片拖放到左下角眼睛的地方，然后就能根据多张图片自动创建一个帧动画，如下图：\n![Animation editor动画模式](http://7xnnwn.com1.z0.glb.clouddn.com/1.pic.jpg）\n创建完动画之后，可以预览，确定没有问题就可以导出做好的动画，导出的文件有png、plist和ExportJson三个文件。\n#### 添加文件\n先将json文件导入到armatureDataManager中\n```javascript\n//添加文件\nccs.armatureDataManager.addArmatureFileInfo(res.punch_json);\n```\n#### 创建动画层\n通过Armature创建动画层，并设置播放第几个动画，设置坐标之后添加到图层中，就可以看到一个播放着动画的Robert\n```javascript\nvar punch=new ccs.Armature(\"punch\");\npunch.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\npunch.setPosition(this.npcX,this.npcY);\nthis.addChild(punch);\n```\n#### 动画回调函数\n如果需要动画播放之后回调某个函数\n```javascript\n// 设置动画回调函数\npunch.getAnimation().setMovementEventCallFunc(this.animationEvent,this); \n// 动作结束时执行相关回调\nanimationEvent:function (armature, movementType, movementID) {   \n    // TODO\n    // movementType有如下几种类型：\n    // 1.boneFrameEvent\n    // 2.complete\n    // 3.loopComplete\n    // 4.movementChange\n    // 5.movementFameEvent\n    // 6.start\n},\n```\n### 作业\n本节作业：\n// 实现罗伯特走路和攻击的动画，然后保存\n// 发到limu@h5edu.cn\n// 让老师协助上传到服务器\n// 然后在代码中加载自己编辑的动画\n// 当用户点击屏幕则播放攻击动画动画播放完成则继续播放走路动画\n我实现了点击屏幕，Robert可以播放行走动画，并走到该点，走到目的地时播放stand动画，右边提供踢和打两个按钮，点击分别会播放kick和punch动画\n作业代码实现如下：\n```javascript\n\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    direction:\"right\",\n    npcX:100,\n    npcY:100,\n    isStand:true,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n\n        // 实现罗伯特走路和攻击的动画，然后保存\n        // 发到limu@h5edu.cn\n        // 让老师协助上传到服务器\n        // 然后在代码中加载自己编辑的动画\n        // 当用户点击屏幕则播放攻击动画动画播放完成则继续播放走路动画\n        var size = cc.winSize;\n        // 拳击按钮\n        var punch = new cc.MenuItemFont(\"打\",this.punchCall,this);\n        punch.setPosition(size.width-100,100);\n        // 脚踢按钮\n        var kick = new cc.MenuItemFont(\"踢\",this.kickCall,this);\n        kick.setPosition(size.width-100,150);\n        var menu=new cc.Menu(punch,kick);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n        //添加文件\n        ccs.armatureDataManager.addArmatureFileInfo(res.stand_json);\n        //创建动画层\n        var stand=new ccs.Armature(\"stand\");\n        stand.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\n        stand.setPosition(this.npcX,this.npcY);\n        this.addChild(stand);\n        stand.setTag(1);\n        return true;\n    },\n    // 拳击动画\n    punchCall:function(){\n        this.npcX = this.getChildByTag(1).getPositionX();\n        //移除当前动画\n        this.removeChildByTag(1);\n        //添加文件\n        ccs.armatureDataManager.addArmatureFileInfo(res.punch_json);\n        //创建动画层\n        var punch=new ccs.Armature(\"punch\");\n        punch.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\n        punch.setPosition(this.npcX,this.npcY);\n        this.addChild(punch);\n        punch.setTag(1);\n        \n        this.isStand = false;\n        punch.getAnimation().setMovementEventCallFunc(this.animationEvent,this);  //为Armature添加一个事件监听\n        \n    },\n    // 踢腿动画\n    kickCall:function(){\n        this.npcX = this.getChildByTag(1).getPositionX();\n        //移除当前动画\n        this.removeChildByTag(1);\n        //添加文件\n        ccs.armatureDataManager.addArmatureFileInfo(res.kick_json);\n        //创建动画层\n        var kick=new ccs.Armature(\"kick\");\n        kick.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\n        kick.setPosition(this.npcX,this.npcY);\n        this.addChild(kick);\n        kick.setTag(1);\n        \n        this.isStand = false;\n        kick.getAnimation().setMovementEventCallFunc(this.animationEvent,this);  //为Armature添加一个事件监听\n        \n    },\n    // 动作结束时播放stand动画\n    animationEvent:function (armature, movementType, movementID) {   //当事件loopComplete发生时触发下一个动作；\n        if(!this.isStand){\n            //移除当前动画\n            this.removeChildByTag(1);\n            //添加文件\n            ccs.armatureDataManager.addArmatureFileInfo(res.stand_json);\n            //创建动画层\n            var stand=new ccs.Armature(\"stand\");\n            stand.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\n            stand.setPosition(this.npcX,this.npcY);\n            this.addChild(stand);\n            stand.setTag(1);\n            this.isStand = true;\n        }\n    },\n    onEnter:function(){\n        this._super();\n        cc.eventManager.addListener({\n            event:cc.EventListener.TOUCH_ONE_BY_ONE,\n            swallowTouches:true,\n            onTouchBegan:this.touchbegan,\n            onTouchMoved:this.touchmoved,\n            onTouchEnded:this.touchended\n        },this);\n        return true;\n    },\n    touchbegan:function(touch,event){\n        event.getCurrentTarget().npcX = event.getCurrentTarget().getChildByTag(1).getPositionX();\n        // 走路动画\n        //移除当前动画\n        event.getCurrentTarget().removeChildByTag(1);\n        //添加文件\n        ccs.armatureDataManager.addArmatureFileInfo(res.walk_json);\n        //创建动画层\n        var walk=new ccs.Armature(\"walk\");\n        walk.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\n        walk.setPosition(event.getCurrentTarget().npcX,event.getCurrentTarget().npcY);\n        event.getCurrentTarget().addChild(walk);\n        walk.setTag(1);\n        \n        var x = touch.getLocation().x;\n        var y = event.getCurrentTarget().npcY;\n        var bn = event.getCurrentTarget().getChildByTag(1);\n        bn.stopAllActions();\n        // 走路时间\n        var time = Math.round(Math.sqrt(Math.pow(x-bn.getPositionX(),2)+Math.pow(y-bn.getPositionY(),2)))/100;\n        bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(function(bn){\n            var layer = bn.parent;\n            //移除当前动画\n            bn.removeFromParent();\n            //添加文件\n            ccs.armatureDataManager.addArmatureFileInfo(res.stand_json);\n            //创建动画层\n            var stand=new ccs.Armature(\"stand\");\n            stand.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\n            stand.setPosition(bn.getPositionX(),bn.getPositionY());\n            layer.npcX = bn.getPositionX();\n            layer.npcY = bn.getPositionY();\n            layer.addChild(stand);\n            stand.setTag(1);\n            layer.isStand = true;\n        },bn)));   \n        return true;\n    },\n    touchmoved:function(){\n    },\n    touchended:function(){\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_30/785bc6b6db98a170b123a8151f7e965d4132ba3c/\n","source":"_posts/CVP认证学习笔记--(何小成)022--加载帧动画.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)022--加载帧动画\ndate: 2016-05-05 00:05\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节课介绍如何使用Animation Editor创建帧动画，然后在cocos中加载编辑好的动画，通过一些动画编辑器如Animation Editor能使我们在开发动画的时候更加方便，在cocos中，可以通过ArmatureDataManager加载自定义好的帧动画。<!--more-->\n### 步骤\n首先需要下载Animation Editor（从大海老师网盘中取win版的），网上没找到mac版的，我只能找了一个win的电脑装了Animation Editor，并且将网盘中的图片资源做了四个动画，分别是stand、walk、punch、kick，代表robert的四个状态，最好之后由酋长上传到了作业资源中。然后再根据作业要求在程序中加载我制作好的帧动画。实际上，也有别的动画编辑器，包括现在Animation Editor也继承到了Cocos Studio中，本节课就Animation Editor为例进行讲解。\n#### 制作帧动画\n制作帧动画的过程很简单，通过Animation Editor使得动画编辑非常简单，只需要把需要的资源拖进资源中，然后选择形体模式，将第一张图片放在屏幕中心，如下图：\n![Animation editor形体模式](http://7xnnwn.com1.z0.glb.clouddn.com/2.pic.jpg）\n选择动画模式，将剩下的四张图片拖放到左下角眼睛的地方，然后就能根据多张图片自动创建一个帧动画，如下图：\n![Animation editor动画模式](http://7xnnwn.com1.z0.glb.clouddn.com/1.pic.jpg）\n创建完动画之后，可以预览，确定没有问题就可以导出做好的动画，导出的文件有png、plist和ExportJson三个文件。\n#### 添加文件\n先将json文件导入到armatureDataManager中\n```javascript\n//添加文件\nccs.armatureDataManager.addArmatureFileInfo(res.punch_json);\n```\n#### 创建动画层\n通过Armature创建动画层，并设置播放第几个动画，设置坐标之后添加到图层中，就可以看到一个播放着动画的Robert\n```javascript\nvar punch=new ccs.Armature(\"punch\");\npunch.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\npunch.setPosition(this.npcX,this.npcY);\nthis.addChild(punch);\n```\n#### 动画回调函数\n如果需要动画播放之后回调某个函数\n```javascript\n// 设置动画回调函数\npunch.getAnimation().setMovementEventCallFunc(this.animationEvent,this); \n// 动作结束时执行相关回调\nanimationEvent:function (armature, movementType, movementID) {   \n    // TODO\n    // movementType有如下几种类型：\n    // 1.boneFrameEvent\n    // 2.complete\n    // 3.loopComplete\n    // 4.movementChange\n    // 5.movementFameEvent\n    // 6.start\n},\n```\n### 作业\n本节作业：\n// 实现罗伯特走路和攻击的动画，然后保存\n// 发到limu@h5edu.cn\n// 让老师协助上传到服务器\n// 然后在代码中加载自己编辑的动画\n// 当用户点击屏幕则播放攻击动画动画播放完成则继续播放走路动画\n我实现了点击屏幕，Robert可以播放行走动画，并走到该点，走到目的地时播放stand动画，右边提供踢和打两个按钮，点击分别会播放kick和punch动画\n作业代码实现如下：\n```javascript\n\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    direction:\"right\",\n    npcX:100,\n    npcY:100,\n    isStand:true,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n\n        // 实现罗伯特走路和攻击的动画，然后保存\n        // 发到limu@h5edu.cn\n        // 让老师协助上传到服务器\n        // 然后在代码中加载自己编辑的动画\n        // 当用户点击屏幕则播放攻击动画动画播放完成则继续播放走路动画\n        var size = cc.winSize;\n        // 拳击按钮\n        var punch = new cc.MenuItemFont(\"打\",this.punchCall,this);\n        punch.setPosition(size.width-100,100);\n        // 脚踢按钮\n        var kick = new cc.MenuItemFont(\"踢\",this.kickCall,this);\n        kick.setPosition(size.width-100,150);\n        var menu=new cc.Menu(punch,kick);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n        //添加文件\n        ccs.armatureDataManager.addArmatureFileInfo(res.stand_json);\n        //创建动画层\n        var stand=new ccs.Armature(\"stand\");\n        stand.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\n        stand.setPosition(this.npcX,this.npcY);\n        this.addChild(stand);\n        stand.setTag(1);\n        return true;\n    },\n    // 拳击动画\n    punchCall:function(){\n        this.npcX = this.getChildByTag(1).getPositionX();\n        //移除当前动画\n        this.removeChildByTag(1);\n        //添加文件\n        ccs.armatureDataManager.addArmatureFileInfo(res.punch_json);\n        //创建动画层\n        var punch=new ccs.Armature(\"punch\");\n        punch.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\n        punch.setPosition(this.npcX,this.npcY);\n        this.addChild(punch);\n        punch.setTag(1);\n        \n        this.isStand = false;\n        punch.getAnimation().setMovementEventCallFunc(this.animationEvent,this);  //为Armature添加一个事件监听\n        \n    },\n    // 踢腿动画\n    kickCall:function(){\n        this.npcX = this.getChildByTag(1).getPositionX();\n        //移除当前动画\n        this.removeChildByTag(1);\n        //添加文件\n        ccs.armatureDataManager.addArmatureFileInfo(res.kick_json);\n        //创建动画层\n        var kick=new ccs.Armature(\"kick\");\n        kick.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\n        kick.setPosition(this.npcX,this.npcY);\n        this.addChild(kick);\n        kick.setTag(1);\n        \n        this.isStand = false;\n        kick.getAnimation().setMovementEventCallFunc(this.animationEvent,this);  //为Armature添加一个事件监听\n        \n    },\n    // 动作结束时播放stand动画\n    animationEvent:function (armature, movementType, movementID) {   //当事件loopComplete发生时触发下一个动作；\n        if(!this.isStand){\n            //移除当前动画\n            this.removeChildByTag(1);\n            //添加文件\n            ccs.armatureDataManager.addArmatureFileInfo(res.stand_json);\n            //创建动画层\n            var stand=new ccs.Armature(\"stand\");\n            stand.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\n            stand.setPosition(this.npcX,this.npcY);\n            this.addChild(stand);\n            stand.setTag(1);\n            this.isStand = true;\n        }\n    },\n    onEnter:function(){\n        this._super();\n        cc.eventManager.addListener({\n            event:cc.EventListener.TOUCH_ONE_BY_ONE,\n            swallowTouches:true,\n            onTouchBegan:this.touchbegan,\n            onTouchMoved:this.touchmoved,\n            onTouchEnded:this.touchended\n        },this);\n        return true;\n    },\n    touchbegan:function(touch,event){\n        event.getCurrentTarget().npcX = event.getCurrentTarget().getChildByTag(1).getPositionX();\n        // 走路动画\n        //移除当前动画\n        event.getCurrentTarget().removeChildByTag(1);\n        //添加文件\n        ccs.armatureDataManager.addArmatureFileInfo(res.walk_json);\n        //创建动画层\n        var walk=new ccs.Armature(\"walk\");\n        walk.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\n        walk.setPosition(event.getCurrentTarget().npcX,event.getCurrentTarget().npcY);\n        event.getCurrentTarget().addChild(walk);\n        walk.setTag(1);\n        \n        var x = touch.getLocation().x;\n        var y = event.getCurrentTarget().npcY;\n        var bn = event.getCurrentTarget().getChildByTag(1);\n        bn.stopAllActions();\n        // 走路时间\n        var time = Math.round(Math.sqrt(Math.pow(x-bn.getPositionX(),2)+Math.pow(y-bn.getPositionY(),2)))/100;\n        bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(function(bn){\n            var layer = bn.parent;\n            //移除当前动画\n            bn.removeFromParent();\n            //添加文件\n            ccs.armatureDataManager.addArmatureFileInfo(res.stand_json);\n            //创建动画层\n            var stand=new ccs.Armature(\"stand\");\n            stand.getAnimation().playWithIndex(0);//通过0 1 2可以切换不同的动画\n            stand.setPosition(bn.getPositionX(),bn.getPositionY());\n            layer.npcX = bn.getPositionX();\n            layer.npcY = bn.getPositionY();\n            layer.addChild(stand);\n            stand.setTag(1);\n            layer.isStand = true;\n        },bn)));   \n        return true;\n    },\n    touchmoved:function(){\n    },\n    touchended:function(){\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_04_30/785bc6b6db98a170b123a8151f7e965d4132ba3c/\n","slug":"CVP认证学习笔记--(何小成)022--加载帧动画","published":1,"updated":"2016-05-06T16:58:40.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhuj001rwsaz2ipgb68v","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课介绍如何使用Animation Editor创建帧动画，然后在cocos中加载编辑好的动画，通过一些动画编辑器如Animation Editor能使我们在开发动画的时候更加方便，在cocos中，可以通过ArmatureDataManager加载自定义好的帧动画。<a id=\"more\"></a></p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><p>首先需要下载Animation Editor（从大海老师网盘中取win版的），网上没找到mac版的，我只能找了一个win的电脑装了Animation Editor，并且将网盘中的图片资源做了四个动画，分别是stand、walk、punch、kick，代表robert的四个状态，最好之后由酋长上传到了作业资源中。然后再根据作业要求在程序中加载我制作好的帧动画。实际上，也有别的动画编辑器，包括现在Animation Editor也继承到了Cocos Studio中，本节课就Animation Editor为例进行讲解。</p>\n<h4 id=\"制作帧动画\"><a href=\"#制作帧动画\" class=\"headerlink\" title=\"制作帧动画\"></a>制作帧动画</h4><p>制作帧动画的过程很简单，通过Animation Editor使得动画编辑非常简单，只需要把需要的资源拖进资源中，然后选择形体模式，将第一张图片放在屏幕中心，如下图：<br>![Animation editor形体模式](<a href=\"http://7xnnwn.com1.z0.glb.clouddn.com/2.pic.jpg%EF%BC%89\">http://7xnnwn.com1.z0.glb.clouddn.com/2.pic.jpg）</a><br>选择动画模式，将剩下的四张图片拖放到左下角眼睛的地方，然后就能根据多张图片自动创建一个帧动画，如下图：<br>![Animation editor动画模式](<a href=\"http://7xnnwn.com1.z0.glb.clouddn.com/1.pic.jpg%EF%BC%89\">http://7xnnwn.com1.z0.glb.clouddn.com/1.pic.jpg）</a><br>创建完动画之后，可以预览，确定没有问题就可以导出做好的动画，导出的文件有png、plist和ExportJson三个文件。</p>\n<h4 id=\"添加文件\"><a href=\"#添加文件\" class=\"headerlink\" title=\"添加文件\"></a>添加文件</h4><p>先将json文件导入到armatureDataManager中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//添加文件</span></span><br><span class=\"line\">ccs.armatureDataManager.addArmatureFileInfo(res.punch_json);</span><br></pre></td></tr></table></figure>\n<h4 id=\"创建动画层\"><a href=\"#创建动画层\" class=\"headerlink\" title=\"创建动画层\"></a>创建动画层</h4><p>通过Armature创建动画层，并设置播放第几个动画，设置坐标之后添加到图层中，就可以看到一个播放着动画的Robert</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> punch=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;punch&quot;</span>);</span><br><span class=\"line\">punch.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">punch.setPosition(<span class=\"built_in\">this</span>.npcX,<span class=\"built_in\">this</span>.npcY);</span><br><span class=\"line\"><span class=\"built_in\">this</span>.addChild(punch);</span><br></pre></td></tr></table></figure>\n<h4 id=\"动画回调函数\"><a href=\"#动画回调函数\" class=\"headerlink\" title=\"动画回调函数\"></a>动画回调函数</h4><p>如果需要动画播放之后回调某个函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 设置动画回调函数</span></span><br><span class=\"line\">punch.getAnimation().setMovementEventCallFunc(<span class=\"built_in\">this</span>.animationEvent,<span class=\"built_in\">this</span>); </span><br><span class=\"line\"><span class=\"comment\">// 动作结束时执行相关回调</span></span><br><span class=\"line\">animationEvent:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">armature, movementType, movementID</span>) </span>&#123;   </span><br><span class=\"line\">    <span class=\"comment\">// TODO</span></span><br><span class=\"line\">    <span class=\"comment\">// movementType有如下几种类型：</span></span><br><span class=\"line\">    <span class=\"comment\">// 1.boneFrameEvent</span></span><br><span class=\"line\">    <span class=\"comment\">// 2.complete</span></span><br><span class=\"line\">    <span class=\"comment\">// 3.loopComplete</span></span><br><span class=\"line\">    <span class=\"comment\">// 4.movementChange</span></span><br><span class=\"line\">    <span class=\"comment\">// 5.movementFameEvent</span></span><br><span class=\"line\">    <span class=\"comment\">// 6.start</span></span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：<br>// 实现罗伯特走路和攻击的动画，然后保存<br>// 发到<a href=\"mailto:&#x6c;&#x69;&#109;&#x75;&#64;&#104;&#53;&#101;&#100;&#117;&#46;&#99;&#110;\">&#x6c;&#x69;&#109;&#x75;&#64;&#104;&#53;&#101;&#100;&#117;&#46;&#99;&#110;</a><br>// 让老师协助上传到服务器<br>// 然后在代码中加载自己编辑的动画<br>// 当用户点击屏幕则播放攻击动画动画播放完成则继续播放走路动画<br>我实现了点击屏幕，Robert可以播放行走动画，并走到该点，走到目的地时播放stand动画，右边提供踢和打两个按钮，点击分别会播放kick和punch动画<br>作业代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    direction:<span class=\"string\">&quot;right&quot;</span>,</span><br><span class=\"line\">    npcX:<span class=\"number\">100</span>,</span><br><span class=\"line\">    npcY:<span class=\"number\">100</span>,</span><br><span class=\"line\">    isStand:<span class=\"literal\">true</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 实现罗伯特走路和攻击的动画，然后保存</span></span><br><span class=\"line\">        <span class=\"comment\">// 发到limu@h5edu.cn</span></span><br><span class=\"line\">        <span class=\"comment\">// 让老师协助上传到服务器</span></span><br><span class=\"line\">        <span class=\"comment\">// 然后在代码中加载自己编辑的动画</span></span><br><span class=\"line\">        <span class=\"comment\">// 当用户点击屏幕则播放攻击动画动画播放完成则继续播放走路动画</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"comment\">// 拳击按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> punch = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;打&quot;</span>,<span class=\"built_in\">this</span>.punchCall,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        punch.setPosition(size.width<span class=\"number\">-100</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 脚踢按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> kick = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;踢&quot;</span>,<span class=\"built_in\">this</span>.kickCall,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        kick.setPosition(size.width<span class=\"number\">-100</span>,<span class=\"number\">150</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(punch,kick);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"comment\">//添加文件</span></span><br><span class=\"line\">        ccs.armatureDataManager.addArmatureFileInfo(res.stand_json);</span><br><span class=\"line\">        <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> stand=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;stand&quot;</span>);</span><br><span class=\"line\">        stand.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">        stand.setPosition(<span class=\"built_in\">this</span>.npcX,<span class=\"built_in\">this</span>.npcY);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(stand);</span><br><span class=\"line\">        stand.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 拳击动画</span></span><br><span class=\"line\">    punchCall:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcX = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).getPositionX();</span><br><span class=\"line\">        <span class=\"comment\">//移除当前动画</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.removeChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加文件</span></span><br><span class=\"line\">        ccs.armatureDataManager.addArmatureFileInfo(res.punch_json);</span><br><span class=\"line\">        <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> punch=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;punch&quot;</span>);</span><br><span class=\"line\">        punch.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">        punch.setPosition(<span class=\"built_in\">this</span>.npcX,<span class=\"built_in\">this</span>.npcY);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(punch);</span><br><span class=\"line\">        punch.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">this</span>.isStand = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        punch.getAnimation().setMovementEventCallFunc(<span class=\"built_in\">this</span>.animationEvent,<span class=\"built_in\">this</span>);  <span class=\"comment\">//为Armature添加一个事件监听</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 踢腿动画</span></span><br><span class=\"line\">    kickCall:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcX = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).getPositionX();</span><br><span class=\"line\">        <span class=\"comment\">//移除当前动画</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.removeChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加文件</span></span><br><span class=\"line\">        ccs.armatureDataManager.addArmatureFileInfo(res.kick_json);</span><br><span class=\"line\">        <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> kick=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;kick&quot;</span>);</span><br><span class=\"line\">        kick.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">        kick.setPosition(<span class=\"built_in\">this</span>.npcX,<span class=\"built_in\">this</span>.npcY);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(kick);</span><br><span class=\"line\">        kick.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">this</span>.isStand = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        kick.getAnimation().setMovementEventCallFunc(<span class=\"built_in\">this</span>.animationEvent,<span class=\"built_in\">this</span>);  <span class=\"comment\">//为Armature添加一个事件监听</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 动作结束时播放stand动画</span></span><br><span class=\"line\">    animationEvent:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">armature, movementType, movementID</span>) </span>&#123;   <span class=\"comment\">//当事件loopComplete发生时触发下一个动作；</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"built_in\">this</span>.isStand)&#123;</span><br><span class=\"line\">            <span class=\"comment\">//移除当前动画</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.removeChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"comment\">//添加文件</span></span><br><span class=\"line\">            ccs.armatureDataManager.addArmatureFileInfo(res.stand_json);</span><br><span class=\"line\">            <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> stand=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;stand&quot;</span>);</span><br><span class=\"line\">            stand.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">            stand.setPosition(<span class=\"built_in\">this</span>.npcX,<span class=\"built_in\">this</span>.npcY);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(stand);</span><br><span class=\"line\">            stand.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.isStand = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        cc.eventManager.addListener(&#123;</span><br><span class=\"line\">            event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">            swallowTouches:<span class=\"literal\">true</span>,</span><br><span class=\"line\">            onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">            onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">            onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        event.getCurrentTarget().npcX = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>).getPositionX();</span><br><span class=\"line\">        <span class=\"comment\">// 走路动画</span></span><br><span class=\"line\">        <span class=\"comment\">//移除当前动画</span></span><br><span class=\"line\">        event.getCurrentTarget().removeChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加文件</span></span><br><span class=\"line\">        ccs.armatureDataManager.addArmatureFileInfo(res.walk_json);</span><br><span class=\"line\">        <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> walk=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;walk&quot;</span>);</span><br><span class=\"line\">        walk.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">        walk.setPosition(event.getCurrentTarget().npcX,event.getCurrentTarget().npcY);</span><br><span class=\"line\">        event.getCurrentTarget().addChild(walk);</span><br><span class=\"line\">        walk.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocation().x;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = event.getCurrentTarget().npcY;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        bn.stopAllActions();</span><br><span class=\"line\">        <span class=\"comment\">// 走路时间</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-bn.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-bn.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">bn</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> layer = bn.parent;</span><br><span class=\"line\">            <span class=\"comment\">//移除当前动画</span></span><br><span class=\"line\">            bn.removeFromParent();</span><br><span class=\"line\">            <span class=\"comment\">//添加文件</span></span><br><span class=\"line\">            ccs.armatureDataManager.addArmatureFileInfo(res.stand_json);</span><br><span class=\"line\">            <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> stand=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;stand&quot;</span>);</span><br><span class=\"line\">            stand.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">            stand.setPosition(bn.getPositionX(),bn.getPositionY());</span><br><span class=\"line\">            layer.npcX = bn.getPositionX();</span><br><span class=\"line\">            layer.npcY = bn.getPositionY();</span><br><span class=\"line\">            layer.addChild(stand);</span><br><span class=\"line\">            stand.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">            layer.isStand = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;,bn)));   </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_30/785bc6b6db98a170b123a8151f7e965d4132ba3c/\">http://www.cocoscvp.com/usercode/2016_04_30/785bc6b6db98a170b123a8151f7e965d4132ba3c/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课介绍如何使用Animation Editor创建帧动画，然后在cocos中加载编辑好的动画，通过一些动画编辑器如Animation Editor能使我们在开发动画的时候更加方便，在cocos中，可以通过ArmatureDataManager加载自定义好的帧动画。","more":"</p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><p>首先需要下载Animation Editor（从大海老师网盘中取win版的），网上没找到mac版的，我只能找了一个win的电脑装了Animation Editor，并且将网盘中的图片资源做了四个动画，分别是stand、walk、punch、kick，代表robert的四个状态，最好之后由酋长上传到了作业资源中。然后再根据作业要求在程序中加载我制作好的帧动画。实际上，也有别的动画编辑器，包括现在Animation Editor也继承到了Cocos Studio中，本节课就Animation Editor为例进行讲解。</p>\n<h4 id=\"制作帧动画\"><a href=\"#制作帧动画\" class=\"headerlink\" title=\"制作帧动画\"></a>制作帧动画</h4><p>制作帧动画的过程很简单，通过Animation Editor使得动画编辑非常简单，只需要把需要的资源拖进资源中，然后选择形体模式，将第一张图片放在屏幕中心，如下图：<br>![Animation editor形体模式](<a href=\"http://7xnnwn.com1.z0.glb.clouddn.com/2.pic.jpg%EF%BC%89\">http://7xnnwn.com1.z0.glb.clouddn.com/2.pic.jpg）</a><br>选择动画模式，将剩下的四张图片拖放到左下角眼睛的地方，然后就能根据多张图片自动创建一个帧动画，如下图：<br>![Animation editor动画模式](<a href=\"http://7xnnwn.com1.z0.glb.clouddn.com/1.pic.jpg%EF%BC%89\">http://7xnnwn.com1.z0.glb.clouddn.com/1.pic.jpg）</a><br>创建完动画之后，可以预览，确定没有问题就可以导出做好的动画，导出的文件有png、plist和ExportJson三个文件。</p>\n<h4 id=\"添加文件\"><a href=\"#添加文件\" class=\"headerlink\" title=\"添加文件\"></a>添加文件</h4><p>先将json文件导入到armatureDataManager中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//添加文件</span></span><br><span class=\"line\">ccs.armatureDataManager.addArmatureFileInfo(res.punch_json);</span><br></pre></td></tr></table></figure>\n<h4 id=\"创建动画层\"><a href=\"#创建动画层\" class=\"headerlink\" title=\"创建动画层\"></a>创建动画层</h4><p>通过Armature创建动画层，并设置播放第几个动画，设置坐标之后添加到图层中，就可以看到一个播放着动画的Robert</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> punch=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;punch&quot;</span>);</span><br><span class=\"line\">punch.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">punch.setPosition(<span class=\"built_in\">this</span>.npcX,<span class=\"built_in\">this</span>.npcY);</span><br><span class=\"line\"><span class=\"built_in\">this</span>.addChild(punch);</span><br></pre></td></tr></table></figure>\n<h4 id=\"动画回调函数\"><a href=\"#动画回调函数\" class=\"headerlink\" title=\"动画回调函数\"></a>动画回调函数</h4><p>如果需要动画播放之后回调某个函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 设置动画回调函数</span></span><br><span class=\"line\">punch.getAnimation().setMovementEventCallFunc(<span class=\"built_in\">this</span>.animationEvent,<span class=\"built_in\">this</span>); </span><br><span class=\"line\"><span class=\"comment\">// 动作结束时执行相关回调</span></span><br><span class=\"line\">animationEvent:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">armature, movementType, movementID</span>) </span>&#123;   </span><br><span class=\"line\">    <span class=\"comment\">// TODO</span></span><br><span class=\"line\">    <span class=\"comment\">// movementType有如下几种类型：</span></span><br><span class=\"line\">    <span class=\"comment\">// 1.boneFrameEvent</span></span><br><span class=\"line\">    <span class=\"comment\">// 2.complete</span></span><br><span class=\"line\">    <span class=\"comment\">// 3.loopComplete</span></span><br><span class=\"line\">    <span class=\"comment\">// 4.movementChange</span></span><br><span class=\"line\">    <span class=\"comment\">// 5.movementFameEvent</span></span><br><span class=\"line\">    <span class=\"comment\">// 6.start</span></span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：<br>// 实现罗伯特走路和攻击的动画，然后保存<br>// 发到<a href=\"mailto:&#x6c;&#x69;&#109;&#x75;&#64;&#104;&#53;&#101;&#100;&#117;&#46;&#99;&#110;\">&#x6c;&#x69;&#109;&#x75;&#64;&#104;&#53;&#101;&#100;&#117;&#46;&#99;&#110;</a><br>// 让老师协助上传到服务器<br>// 然后在代码中加载自己编辑的动画<br>// 当用户点击屏幕则播放攻击动画动画播放完成则继续播放走路动画<br>我实现了点击屏幕，Robert可以播放行走动画，并走到该点，走到目的地时播放stand动画，右边提供踢和打两个按钮，点击分别会播放kick和punch动画<br>作业代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    direction:<span class=\"string\">&quot;right&quot;</span>,</span><br><span class=\"line\">    npcX:<span class=\"number\">100</span>,</span><br><span class=\"line\">    npcY:<span class=\"number\">100</span>,</span><br><span class=\"line\">    isStand:<span class=\"literal\">true</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 实现罗伯特走路和攻击的动画，然后保存</span></span><br><span class=\"line\">        <span class=\"comment\">// 发到limu@h5edu.cn</span></span><br><span class=\"line\">        <span class=\"comment\">// 让老师协助上传到服务器</span></span><br><span class=\"line\">        <span class=\"comment\">// 然后在代码中加载自己编辑的动画</span></span><br><span class=\"line\">        <span class=\"comment\">// 当用户点击屏幕则播放攻击动画动画播放完成则继续播放走路动画</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"comment\">// 拳击按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> punch = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;打&quot;</span>,<span class=\"built_in\">this</span>.punchCall,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        punch.setPosition(size.width<span class=\"number\">-100</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 脚踢按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> kick = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;踢&quot;</span>,<span class=\"built_in\">this</span>.kickCall,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        kick.setPosition(size.width<span class=\"number\">-100</span>,<span class=\"number\">150</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(punch,kick);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"comment\">//添加文件</span></span><br><span class=\"line\">        ccs.armatureDataManager.addArmatureFileInfo(res.stand_json);</span><br><span class=\"line\">        <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> stand=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;stand&quot;</span>);</span><br><span class=\"line\">        stand.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">        stand.setPosition(<span class=\"built_in\">this</span>.npcX,<span class=\"built_in\">this</span>.npcY);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(stand);</span><br><span class=\"line\">        stand.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 拳击动画</span></span><br><span class=\"line\">    punchCall:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcX = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).getPositionX();</span><br><span class=\"line\">        <span class=\"comment\">//移除当前动画</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.removeChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加文件</span></span><br><span class=\"line\">        ccs.armatureDataManager.addArmatureFileInfo(res.punch_json);</span><br><span class=\"line\">        <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> punch=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;punch&quot;</span>);</span><br><span class=\"line\">        punch.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">        punch.setPosition(<span class=\"built_in\">this</span>.npcX,<span class=\"built_in\">this</span>.npcY);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(punch);</span><br><span class=\"line\">        punch.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">this</span>.isStand = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        punch.getAnimation().setMovementEventCallFunc(<span class=\"built_in\">this</span>.animationEvent,<span class=\"built_in\">this</span>);  <span class=\"comment\">//为Armature添加一个事件监听</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 踢腿动画</span></span><br><span class=\"line\">    kickCall:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcX = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).getPositionX();</span><br><span class=\"line\">        <span class=\"comment\">//移除当前动画</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.removeChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加文件</span></span><br><span class=\"line\">        ccs.armatureDataManager.addArmatureFileInfo(res.kick_json);</span><br><span class=\"line\">        <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> kick=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;kick&quot;</span>);</span><br><span class=\"line\">        kick.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">        kick.setPosition(<span class=\"built_in\">this</span>.npcX,<span class=\"built_in\">this</span>.npcY);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(kick);</span><br><span class=\"line\">        kick.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">this</span>.isStand = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        kick.getAnimation().setMovementEventCallFunc(<span class=\"built_in\">this</span>.animationEvent,<span class=\"built_in\">this</span>);  <span class=\"comment\">//为Armature添加一个事件监听</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 动作结束时播放stand动画</span></span><br><span class=\"line\">    animationEvent:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">armature, movementType, movementID</span>) </span>&#123;   <span class=\"comment\">//当事件loopComplete发生时触发下一个动作；</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"built_in\">this</span>.isStand)&#123;</span><br><span class=\"line\">            <span class=\"comment\">//移除当前动画</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.removeChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"comment\">//添加文件</span></span><br><span class=\"line\">            ccs.armatureDataManager.addArmatureFileInfo(res.stand_json);</span><br><span class=\"line\">            <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> stand=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;stand&quot;</span>);</span><br><span class=\"line\">            stand.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">            stand.setPosition(<span class=\"built_in\">this</span>.npcX,<span class=\"built_in\">this</span>.npcY);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(stand);</span><br><span class=\"line\">            stand.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.isStand = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        cc.eventManager.addListener(&#123;</span><br><span class=\"line\">            event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">            swallowTouches:<span class=\"literal\">true</span>,</span><br><span class=\"line\">            onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">            onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">            onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        event.getCurrentTarget().npcX = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>).getPositionX();</span><br><span class=\"line\">        <span class=\"comment\">// 走路动画</span></span><br><span class=\"line\">        <span class=\"comment\">//移除当前动画</span></span><br><span class=\"line\">        event.getCurrentTarget().removeChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加文件</span></span><br><span class=\"line\">        ccs.armatureDataManager.addArmatureFileInfo(res.walk_json);</span><br><span class=\"line\">        <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> walk=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;walk&quot;</span>);</span><br><span class=\"line\">        walk.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">        walk.setPosition(event.getCurrentTarget().npcX,event.getCurrentTarget().npcY);</span><br><span class=\"line\">        event.getCurrentTarget().addChild(walk);</span><br><span class=\"line\">        walk.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocation().x;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = event.getCurrentTarget().npcY;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        bn.stopAllActions();</span><br><span class=\"line\">        <span class=\"comment\">// 走路时间</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-bn.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-bn.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        bn.runAction(cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">bn</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> layer = bn.parent;</span><br><span class=\"line\">            <span class=\"comment\">//移除当前动画</span></span><br><span class=\"line\">            bn.removeFromParent();</span><br><span class=\"line\">            <span class=\"comment\">//添加文件</span></span><br><span class=\"line\">            ccs.armatureDataManager.addArmatureFileInfo(res.stand_json);</span><br><span class=\"line\">            <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> stand=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;stand&quot;</span>);</span><br><span class=\"line\">            stand.getAnimation().playWithIndex(<span class=\"number\">0</span>);<span class=\"comment\">//通过0 1 2可以切换不同的动画</span></span><br><span class=\"line\">            stand.setPosition(bn.getPositionX(),bn.getPositionY());</span><br><span class=\"line\">            layer.npcX = bn.getPositionX();</span><br><span class=\"line\">            layer.npcY = bn.getPositionY();</span><br><span class=\"line\">            layer.addChild(stand);</span><br><span class=\"line\">            stand.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">            layer.isStand = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;,bn)));   </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_30/785bc6b6db98a170b123a8151f7e965d4132ba3c/\">http://www.cocoscvp.com/usercode/2016_04_30/785bc6b6db98a170b123a8151f7e965d4132ba3c/</a></p>"},{"title":"CVP认证学习笔记--(何小成)023--加载骨骼动画","date":"2016-05-05T16:49:00.000Z","_content":"### 概念\n本节课介绍如何使用Animation Editor创建骨骼动画，通过骨骼动画，可以让人物形象更加的生动，学习使用Animation Editor编辑骨骼动画，并在游戏场景中加载骨骼动画<!--more-->\n### 步骤\n首先需要用到的还是上节课下载好的动画编辑器Animation Editor。\n#### 制作帧动画\n制作骨骼动画的过程相对于制作帧动画来说要麻烦很多，需要在Animation Editor中对每一个骨骼都进行细微的调整，调整完了同帧动画一样，导出资源，，就会有png、plist和json三个文件。\n#### 添加文件\n同帧动画一样，先将json文件导入到armatureDataManager中\n```javascript\n//添加文件\nccs.armatureDataManager.addArmatureFileInfo(res.ani_json);\n```\n#### 创建动画层\n通过Armature创建动画层，创建船长的动画\n```javascript\nvar ani=new ccs.Armature(\"chuanzhang\");\n```\n#### 播放站立动画\n添加后的船长站立不动\n```javascript\nani.getAnimation().play(\"hold\");\nthis.addChild(ani);\nani.setPosition(200,200);\nani.setTag(1);\n```\n#### 动画事件监听\n动画播放之后的回调函数\n```javascript\n//设置动画的事件侦听\nani.getAnimation().setMovementEventCallFunc(this.anievent);\n// 动作结束时执行相关回调\nanievent:function (armature, movementType, movementID) {   \n    // TODO\n    // movementType有如下几种类型：\n    // 1.boneFrameEvent\n    // 2.complete\n    // 3.loopComplete\n    // 4.movementChange\n    // 5.movementFameEvent\n    // 6.start\n},\n```\n### 作业\n本节作业：\n// 作业要求，实现一个点击英雄\n// 点击屏幕让船长播放攻击的动画1-3次随机\n// 然后继续走路\n与上节课作业差不多，我实现了点击屏幕船长会走到这个位置，点击攻击会进行攻击，同时，场景会有一个敌人npc，npc会随机游走，相遇时，会不停攻击自己，自己也可以攻击npc，双方血量会减少，谁先杀死对方，谁将获得胜利。\n作业代码实现如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    gameState:1,// 1游戏中，0结束\n    direction:1,// 0左，1右\n    state:0,\n    npcDirection:1,\n    npcState:0,//0移动，1攻击\n    selfHp:100,\n    npcHp:100,\n    selfHpTxt:null,\n    npcHpTxt:null,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n\n        // 攻击按钮\n        var attackMenu = new cc.MenuItemFont(\"打\",this.attackCall,this);\n        attackMenu.setPosition(cc.winSize.width-150,100);\n        \n        var menu = new cc.Menu(attackMenu);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n        \n        // 血量\n        this.selfHpTxt = new cc.LabelTTF(\"我方血量:100\",\"\",25);\n        this.npcHpTxt = new cc.LabelTTF(\"敌方血量:100\",\"\",25);\n        this.selfHpTxt.setPosition(cc.winSize.width-150,cc.winSize.height-50);\n        this.npcHpTxt.setPosition(150,cc.winSize.height-50);\n        this.addChild(this.selfHpTxt);\n        this.addChild(this.npcHpTxt);\n\n        //加载动画\n        ccs.armatureDataManager.addArmatureFileInfo(res.ani_json);\n        //创建动画层\n        var ani=new ccs.Armature(\"chuanzhang\");\n        //播放站立动画\n        ani.getAnimation().play(\"hold\");\n        this.addChild(ani);\n        ani.setPosition(200,200);\n        ani.setTag(1);\n        //设置动画的事件侦听\n        ani.getAnimation().setMovementEventCallFunc(this.anievent);\n        \n        // 敌人npc\n        //加载动画\n        ccs.armatureDataManager.addArmatureFileInfo(res.ani_json);\n        //创建动画层\n        var npc=new ccs.Armature(\"chuanzhang\");\n        //播放站立动画\n        npc.getAnimation().play(\"hold\");\n        this.addChild(npc);\n        npc.setPosition(400,200);\n        npc.setTag(2);\n        //设置动画的事件侦听\n        npc.getAnimation().setMovementEventCallFunc(this.npcevent);\n        this.npcMove();\n        this.schedule(this.update);\n        this.npcState = 0;\n        \n        // 作业要求，实现一个点击英雄\n        // 点击屏幕让船长播放攻击的动画1-3次随机\n        // 然后继续走路\n            \n        return true;\n    },\n    // 返回按钮\n    back:function(){\n        cc.director.runScene(new startLayer());\n    },\n    // 计划任务，写敌人npc的ai\n    update:function(){\n        var bn=this.getChildByTag(1);\n        var npc=this.getChildByTag(2);\n        if(this.gameState==0&&this.getChildByTag(111)==null){// 游戏结束，判断胜利还是失败\n            var text = \"\";\n            if(npc==null){// 赢了\n                text = \"You Win\";\n            }\n            if(bn==null){// 输了\n                text = \"You Lose\";            \n            }\n            this.removeAllChildren();\n            var over = new cc.LabelTTF(text,\"\",50);\n            over.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n            this.addChild(over);\n            over.setTag(111);\n            over.runAction(cc.sequence(cc.scaleTo(0.2,2),cc.scaleTo(0.2,0.5),cc.scaleTo(0.2,1)));\n            // 按钮\n            var back = new cc.MenuItemFont(\"返回\",this.back,this);\n            back.setPosition(cc.winSize.width/2,over.height+50);\n            var menu = new cc.Menu(back);\n            menu.setPosition(0,0);\n            this.addChild(menu);\n        }\n        if(this.gameState==1){// 游戏运行中\n            if(\n                (Math.abs(npc.getPositionX()-bn.getPositionX()))<=bn.width/2\n                &&(Math.abs(npc.getPositionY()-bn.getPositionY())<=bn.height/4)\n            ){// 主角出现在npc的攻击范围内\n                if(this.npcState==0){\n                    this.npcState = 1;\n                    npc.stopAllActions();\n                    npc.getAnimation().play(\"attack\");\n                }\n            }else{\n                if(this.npcState==1){\n                    this.npcState = 0;\n                    npc.getAnimation().play(\"walk\");\n                    this.npcMove();\n                }\n            }\n        }\n    },\n    // 敌人移动动画\n    npcMove:function(){\n        var npcDirection = this.npcDirection;\n        var npc=this.getChildByTag(2);\n        var randomX = Math.round(Math.random()*(cc.winSize.width-npc.width)+npc.width/2);\n        var randomY = Math.round(Math.random()*(cc.winSize.height-npc.height)+npc.height/2);\n        // 走路时间\n        var time = Math.round(Math.sqrt(Math.pow(randomX-npc.getPositionX(),2)+Math.pow(randomY-npc.getPositionY(),2)))/100;\n        \n        if(randomX<npc.getPositionX()&&npcDirection==1){\n            // 左转\n            npc.runAction(cc.scaleTo(0,-1,1));\n            this.npcDirection = 0;\n        } else if(randomX>npc.getPositionX()&&npcDirection==0){\n            // 右转\n            npc.runAction(cc.scaleTo(0,1,1));\n            this.npcDirection = 1;\n        }\n        npc.getAnimation().play(\"walk\");\n        npc.runAction(cc.sequence(cc.moveTo(time,cc.p(randomX,randomY)),cc.callFunc(function(npc){\n            npc.parent.npcMove();\n        },npc)));\n    },\n    onEnter:function(){\n        this._super();\n        cc.eventManager.addListener({\n            event:cc.EventListener.TOUCH_ONE_BY_ONE,\n            swallowTouches:true,\n            onTouchBegan:this.touchbegan,\n            onTouchMoved:this.touchmoved,\n            onTouchEnded:this.touchended\n        },this);\n    },\n    touchbegan:function(touch,event){\n        event.getCurrentTarget().state = 0;\n        if(event.getCurrentTarget().gameState==0){\n            return false;\n        }\n        var x = touch.getLocation().x;\n        var y = touch.getLocation().y;\n        var direction = event.getCurrentTarget().direction;\n        var bn = event.getCurrentTarget().getChildByTag(1);\n        bn.stopAllActions();\n        // 走路时间\n        var time = Math.round(Math.sqrt(Math.pow(x-bn.getPositionX(),2)+Math.pow(y-bn.getPositionY(),2)))/100;\n        if(x<bn.getPositionX()&&direction==1){\n            // 左转\n            bn.runAction(cc.scaleTo(0,-1,1));\n            event.getCurrentTarget().direction = 0;\n        } else if(x>bn.getPositionX()&&direction==0){\n            // 右转\n            bn.runAction(cc.scaleTo(0,1,1));\n            event.getCurrentTarget().direction = 1;\n        }\n        bn.getAnimation().play(\"walk\");\n        var walkTo = new cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(function(bn){\n            bn.getAnimation().play(\"hold\");\n        },bn));\n        bn.runAction(walkTo);\n        return true;\n    },\n    touchmoved:function(){\n        \n    },\n    touchended:function(){\n        \n    },\n    // 攻击按钮回调\n    attackCall:function(){\n        if(this.state==0){\n            this.state=1;\n            this.getChildByTag(1).stopAllActions();\n            // 攻击动画\n            this.getChildByTag(1).getAnimation().play(\"attack\");\n        }\n    },\n    // 攻击npc血量\n    anievent:function(armature,movementtype,movementID){\n        if(movementtype==2)\n        {\n            if(movementID==\"attack\")\n            {\n                armature.parent.stopAllActions();\n                if(\n                    Math.abs(armature.parent.getChildByTag(2).getPositionX()-armature.parent.getChildByTag(1).getPositionX())<=armature.parent.getChildByTag(1).width/2\n                    &&Math.abs(armature.parent.getChildByTag(2).getPositionY()-armature.parent.getChildByTag(1).getPositionY())<=armature.parent.getChildByTag(1).height/4\n                ){\n                    armature.parent.state=1;\n                    armature.parent.npcHp-=4+Math.round(Math.random()*2);\n                    armature.parent.npcHpTxt.runAction(\n                        cc.sequence(\n                            cc.scaleTo(0.2,1.2),\n                            cc.scaleTo(0.1,0.9),\n                            cc.scaleTo(0.1,1),\n                            cc.callFunc(function(armature){\n                                armature.parent.npcHpTxt.setString(\"敌方血量:\"+armature.parent.npcHp);\n                            },armature)));\n                    if(armature.parent.npcHp<=0){\n                        armature.parent.getChildByTag(2).removeFromParent();\n                        armature.parent.gameState=0;\n                    }\n                }\n                armature.parent.state = 0;\n                armature.getAnimation().play(\"hold\");\n            }\n        }\n    },\n    // npc攻击我方血量\n    npcevent:function(armature,movementtype,movementID){\n        if(movementtype==2)\n        {\n            if(movementID==\"attack\")\n            {\n                armature.parent.selfHp-=2+Math.round(Math.random()*2);\n                armature.parent.selfHpTxt.runAction(\n                    cc.sequence(\n                        cc.scaleTo(0.2,1.2),\n                        cc.scaleTo(0.1,0.9),\n                        cc.scaleTo(0.1,1),\n                        cc.callFunc(function(armature){\n                            armature.parent.selfHpTxt.setString(\"我方血量:\"+armature.parent.selfHp);\n                        },armature)));\n                if(armature.parent.selfHp<=0){\n                    armature.parent.getChildByTag(1).removeFromParent();\n                    armature.getAnimation().play(\"hold\");\n                    armature.parent.gameState=0;\n                }\n            }\n        }\n    }\n});\n\nvar startLayer = cc.Layer.extend({\n    ctor:function(){\n        this._super();\n        var size = cc.winSize;\n        // 标题\n        var title = new cc.LabelTTF(\"真假船长大战\",\"\",100);\n        title.setPosition(size.width/2,size.height-100);\n        this.addChild(title);\n        // 按钮\n        var startMenu = new cc.MenuItemFont(\"开始游戏\",this.start,this);\n        startMenu.setPosition(size.width/2,size.height/2);\n        var helpMenu = new cc.MenuItemFont(\"帮助\",this.help,this);\n        helpMenu.setPosition(size.width/2,startMenu.height+50);\n        var menu = new cc.Menu(startMenu,helpMenu);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n        return true;\n    },\n    start:function(){\n        cc.director.runScene(new HelloWorldLayer());\n    },\n    help:function(){\n        cc.director.runScene(new helpLayer());\n    }\n});\n\nvar helpLayer = cc.Layer.extend({\n    ctor:function(){\n        this._super();\n        var size = cc.winSize;\n        // 标题\n        var title = new cc.LabelTTF(\"游戏中有一个假船长四处游走，\\r\\n当你们靠的很近时，它会攻击你，你也可以攻击它，\\r\\n谁先打倒对方谁将获得胜利！\",\"\",30);\n        title.setPosition(size.width/2,size.height-100);\n        this.addChild(title);\n        // 按钮\n        var back = new cc.MenuItemFont(\"返回\",this.help,this);\n        back.setPosition(size.width/2,size.height/2);\n        var menu = new cc.Menu(back);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n        return true;\n    },\n    help:function(){\n        cc.director.runScene(new startLayer());\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new startLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_05_03/59d170f1dd8aec6a65cf900f6759098d960ab296/\n","source":"_posts/CVP认证学习笔记--(何小成)023--加载骨骼动画.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)023--加载骨骼动画\ndate: 2016-05-06 00:49\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节课介绍如何使用Animation Editor创建骨骼动画，通过骨骼动画，可以让人物形象更加的生动，学习使用Animation Editor编辑骨骼动画，并在游戏场景中加载骨骼动画<!--more-->\n### 步骤\n首先需要用到的还是上节课下载好的动画编辑器Animation Editor。\n#### 制作帧动画\n制作骨骼动画的过程相对于制作帧动画来说要麻烦很多，需要在Animation Editor中对每一个骨骼都进行细微的调整，调整完了同帧动画一样，导出资源，，就会有png、plist和json三个文件。\n#### 添加文件\n同帧动画一样，先将json文件导入到armatureDataManager中\n```javascript\n//添加文件\nccs.armatureDataManager.addArmatureFileInfo(res.ani_json);\n```\n#### 创建动画层\n通过Armature创建动画层，创建船长的动画\n```javascript\nvar ani=new ccs.Armature(\"chuanzhang\");\n```\n#### 播放站立动画\n添加后的船长站立不动\n```javascript\nani.getAnimation().play(\"hold\");\nthis.addChild(ani);\nani.setPosition(200,200);\nani.setTag(1);\n```\n#### 动画事件监听\n动画播放之后的回调函数\n```javascript\n//设置动画的事件侦听\nani.getAnimation().setMovementEventCallFunc(this.anievent);\n// 动作结束时执行相关回调\nanievent:function (armature, movementType, movementID) {   \n    // TODO\n    // movementType有如下几种类型：\n    // 1.boneFrameEvent\n    // 2.complete\n    // 3.loopComplete\n    // 4.movementChange\n    // 5.movementFameEvent\n    // 6.start\n},\n```\n### 作业\n本节作业：\n// 作业要求，实现一个点击英雄\n// 点击屏幕让船长播放攻击的动画1-3次随机\n// 然后继续走路\n与上节课作业差不多，我实现了点击屏幕船长会走到这个位置，点击攻击会进行攻击，同时，场景会有一个敌人npc，npc会随机游走，相遇时，会不停攻击自己，自己也可以攻击npc，双方血量会减少，谁先杀死对方，谁将获得胜利。\n作业代码实现如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    gameState:1,// 1游戏中，0结束\n    direction:1,// 0左，1右\n    state:0,\n    npcDirection:1,\n    npcState:0,//0移动，1攻击\n    selfHp:100,\n    npcHp:100,\n    selfHpTxt:null,\n    npcHpTxt:null,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n\n        // 攻击按钮\n        var attackMenu = new cc.MenuItemFont(\"打\",this.attackCall,this);\n        attackMenu.setPosition(cc.winSize.width-150,100);\n        \n        var menu = new cc.Menu(attackMenu);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n        \n        // 血量\n        this.selfHpTxt = new cc.LabelTTF(\"我方血量:100\",\"\",25);\n        this.npcHpTxt = new cc.LabelTTF(\"敌方血量:100\",\"\",25);\n        this.selfHpTxt.setPosition(cc.winSize.width-150,cc.winSize.height-50);\n        this.npcHpTxt.setPosition(150,cc.winSize.height-50);\n        this.addChild(this.selfHpTxt);\n        this.addChild(this.npcHpTxt);\n\n        //加载动画\n        ccs.armatureDataManager.addArmatureFileInfo(res.ani_json);\n        //创建动画层\n        var ani=new ccs.Armature(\"chuanzhang\");\n        //播放站立动画\n        ani.getAnimation().play(\"hold\");\n        this.addChild(ani);\n        ani.setPosition(200,200);\n        ani.setTag(1);\n        //设置动画的事件侦听\n        ani.getAnimation().setMovementEventCallFunc(this.anievent);\n        \n        // 敌人npc\n        //加载动画\n        ccs.armatureDataManager.addArmatureFileInfo(res.ani_json);\n        //创建动画层\n        var npc=new ccs.Armature(\"chuanzhang\");\n        //播放站立动画\n        npc.getAnimation().play(\"hold\");\n        this.addChild(npc);\n        npc.setPosition(400,200);\n        npc.setTag(2);\n        //设置动画的事件侦听\n        npc.getAnimation().setMovementEventCallFunc(this.npcevent);\n        this.npcMove();\n        this.schedule(this.update);\n        this.npcState = 0;\n        \n        // 作业要求，实现一个点击英雄\n        // 点击屏幕让船长播放攻击的动画1-3次随机\n        // 然后继续走路\n            \n        return true;\n    },\n    // 返回按钮\n    back:function(){\n        cc.director.runScene(new startLayer());\n    },\n    // 计划任务，写敌人npc的ai\n    update:function(){\n        var bn=this.getChildByTag(1);\n        var npc=this.getChildByTag(2);\n        if(this.gameState==0&&this.getChildByTag(111)==null){// 游戏结束，判断胜利还是失败\n            var text = \"\";\n            if(npc==null){// 赢了\n                text = \"You Win\";\n            }\n            if(bn==null){// 输了\n                text = \"You Lose\";            \n            }\n            this.removeAllChildren();\n            var over = new cc.LabelTTF(text,\"\",50);\n            over.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n            this.addChild(over);\n            over.setTag(111);\n            over.runAction(cc.sequence(cc.scaleTo(0.2,2),cc.scaleTo(0.2,0.5),cc.scaleTo(0.2,1)));\n            // 按钮\n            var back = new cc.MenuItemFont(\"返回\",this.back,this);\n            back.setPosition(cc.winSize.width/2,over.height+50);\n            var menu = new cc.Menu(back);\n            menu.setPosition(0,0);\n            this.addChild(menu);\n        }\n        if(this.gameState==1){// 游戏运行中\n            if(\n                (Math.abs(npc.getPositionX()-bn.getPositionX()))<=bn.width/2\n                &&(Math.abs(npc.getPositionY()-bn.getPositionY())<=bn.height/4)\n            ){// 主角出现在npc的攻击范围内\n                if(this.npcState==0){\n                    this.npcState = 1;\n                    npc.stopAllActions();\n                    npc.getAnimation().play(\"attack\");\n                }\n            }else{\n                if(this.npcState==1){\n                    this.npcState = 0;\n                    npc.getAnimation().play(\"walk\");\n                    this.npcMove();\n                }\n            }\n        }\n    },\n    // 敌人移动动画\n    npcMove:function(){\n        var npcDirection = this.npcDirection;\n        var npc=this.getChildByTag(2);\n        var randomX = Math.round(Math.random()*(cc.winSize.width-npc.width)+npc.width/2);\n        var randomY = Math.round(Math.random()*(cc.winSize.height-npc.height)+npc.height/2);\n        // 走路时间\n        var time = Math.round(Math.sqrt(Math.pow(randomX-npc.getPositionX(),2)+Math.pow(randomY-npc.getPositionY(),2)))/100;\n        \n        if(randomX<npc.getPositionX()&&npcDirection==1){\n            // 左转\n            npc.runAction(cc.scaleTo(0,-1,1));\n            this.npcDirection = 0;\n        } else if(randomX>npc.getPositionX()&&npcDirection==0){\n            // 右转\n            npc.runAction(cc.scaleTo(0,1,1));\n            this.npcDirection = 1;\n        }\n        npc.getAnimation().play(\"walk\");\n        npc.runAction(cc.sequence(cc.moveTo(time,cc.p(randomX,randomY)),cc.callFunc(function(npc){\n            npc.parent.npcMove();\n        },npc)));\n    },\n    onEnter:function(){\n        this._super();\n        cc.eventManager.addListener({\n            event:cc.EventListener.TOUCH_ONE_BY_ONE,\n            swallowTouches:true,\n            onTouchBegan:this.touchbegan,\n            onTouchMoved:this.touchmoved,\n            onTouchEnded:this.touchended\n        },this);\n    },\n    touchbegan:function(touch,event){\n        event.getCurrentTarget().state = 0;\n        if(event.getCurrentTarget().gameState==0){\n            return false;\n        }\n        var x = touch.getLocation().x;\n        var y = touch.getLocation().y;\n        var direction = event.getCurrentTarget().direction;\n        var bn = event.getCurrentTarget().getChildByTag(1);\n        bn.stopAllActions();\n        // 走路时间\n        var time = Math.round(Math.sqrt(Math.pow(x-bn.getPositionX(),2)+Math.pow(y-bn.getPositionY(),2)))/100;\n        if(x<bn.getPositionX()&&direction==1){\n            // 左转\n            bn.runAction(cc.scaleTo(0,-1,1));\n            event.getCurrentTarget().direction = 0;\n        } else if(x>bn.getPositionX()&&direction==0){\n            // 右转\n            bn.runAction(cc.scaleTo(0,1,1));\n            event.getCurrentTarget().direction = 1;\n        }\n        bn.getAnimation().play(\"walk\");\n        var walkTo = new cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(function(bn){\n            bn.getAnimation().play(\"hold\");\n        },bn));\n        bn.runAction(walkTo);\n        return true;\n    },\n    touchmoved:function(){\n        \n    },\n    touchended:function(){\n        \n    },\n    // 攻击按钮回调\n    attackCall:function(){\n        if(this.state==0){\n            this.state=1;\n            this.getChildByTag(1).stopAllActions();\n            // 攻击动画\n            this.getChildByTag(1).getAnimation().play(\"attack\");\n        }\n    },\n    // 攻击npc血量\n    anievent:function(armature,movementtype,movementID){\n        if(movementtype==2)\n        {\n            if(movementID==\"attack\")\n            {\n                armature.parent.stopAllActions();\n                if(\n                    Math.abs(armature.parent.getChildByTag(2).getPositionX()-armature.parent.getChildByTag(1).getPositionX())<=armature.parent.getChildByTag(1).width/2\n                    &&Math.abs(armature.parent.getChildByTag(2).getPositionY()-armature.parent.getChildByTag(1).getPositionY())<=armature.parent.getChildByTag(1).height/4\n                ){\n                    armature.parent.state=1;\n                    armature.parent.npcHp-=4+Math.round(Math.random()*2);\n                    armature.parent.npcHpTxt.runAction(\n                        cc.sequence(\n                            cc.scaleTo(0.2,1.2),\n                            cc.scaleTo(0.1,0.9),\n                            cc.scaleTo(0.1,1),\n                            cc.callFunc(function(armature){\n                                armature.parent.npcHpTxt.setString(\"敌方血量:\"+armature.parent.npcHp);\n                            },armature)));\n                    if(armature.parent.npcHp<=0){\n                        armature.parent.getChildByTag(2).removeFromParent();\n                        armature.parent.gameState=0;\n                    }\n                }\n                armature.parent.state = 0;\n                armature.getAnimation().play(\"hold\");\n            }\n        }\n    },\n    // npc攻击我方血量\n    npcevent:function(armature,movementtype,movementID){\n        if(movementtype==2)\n        {\n            if(movementID==\"attack\")\n            {\n                armature.parent.selfHp-=2+Math.round(Math.random()*2);\n                armature.parent.selfHpTxt.runAction(\n                    cc.sequence(\n                        cc.scaleTo(0.2,1.2),\n                        cc.scaleTo(0.1,0.9),\n                        cc.scaleTo(0.1,1),\n                        cc.callFunc(function(armature){\n                            armature.parent.selfHpTxt.setString(\"我方血量:\"+armature.parent.selfHp);\n                        },armature)));\n                if(armature.parent.selfHp<=0){\n                    armature.parent.getChildByTag(1).removeFromParent();\n                    armature.getAnimation().play(\"hold\");\n                    armature.parent.gameState=0;\n                }\n            }\n        }\n    }\n});\n\nvar startLayer = cc.Layer.extend({\n    ctor:function(){\n        this._super();\n        var size = cc.winSize;\n        // 标题\n        var title = new cc.LabelTTF(\"真假船长大战\",\"\",100);\n        title.setPosition(size.width/2,size.height-100);\n        this.addChild(title);\n        // 按钮\n        var startMenu = new cc.MenuItemFont(\"开始游戏\",this.start,this);\n        startMenu.setPosition(size.width/2,size.height/2);\n        var helpMenu = new cc.MenuItemFont(\"帮助\",this.help,this);\n        helpMenu.setPosition(size.width/2,startMenu.height+50);\n        var menu = new cc.Menu(startMenu,helpMenu);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n        return true;\n    },\n    start:function(){\n        cc.director.runScene(new HelloWorldLayer());\n    },\n    help:function(){\n        cc.director.runScene(new helpLayer());\n    }\n});\n\nvar helpLayer = cc.Layer.extend({\n    ctor:function(){\n        this._super();\n        var size = cc.winSize;\n        // 标题\n        var title = new cc.LabelTTF(\"游戏中有一个假船长四处游走，\\r\\n当你们靠的很近时，它会攻击你，你也可以攻击它，\\r\\n谁先打倒对方谁将获得胜利！\",\"\",30);\n        title.setPosition(size.width/2,size.height-100);\n        this.addChild(title);\n        // 按钮\n        var back = new cc.MenuItemFont(\"返回\",this.help,this);\n        back.setPosition(size.width/2,size.height/2);\n        var menu = new cc.Menu(back);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n        return true;\n    },\n    help:function(){\n        cc.director.runScene(new startLayer());\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new startLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_05_03/59d170f1dd8aec6a65cf900f6759098d960ab296/\n","slug":"CVP认证学习笔记--(何小成)023--加载骨骼动画","published":1,"updated":"2016-05-06T16:58:32.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhul001vwsazd9qhgu94","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课介绍如何使用Animation Editor创建骨骼动画，通过骨骼动画，可以让人物形象更加的生动，学习使用Animation Editor编辑骨骼动画，并在游戏场景中加载骨骼动画<a id=\"more\"></a></p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><p>首先需要用到的还是上节课下载好的动画编辑器Animation Editor。</p>\n<h4 id=\"制作帧动画\"><a href=\"#制作帧动画\" class=\"headerlink\" title=\"制作帧动画\"></a>制作帧动画</h4><p>制作骨骼动画的过程相对于制作帧动画来说要麻烦很多，需要在Animation Editor中对每一个骨骼都进行细微的调整，调整完了同帧动画一样，导出资源，，就会有png、plist和json三个文件。</p>\n<h4 id=\"添加文件\"><a href=\"#添加文件\" class=\"headerlink\" title=\"添加文件\"></a>添加文件</h4><p>同帧动画一样，先将json文件导入到armatureDataManager中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//添加文件</span></span><br><span class=\"line\">ccs.armatureDataManager.addArmatureFileInfo(res.ani_json);</span><br></pre></td></tr></table></figure>\n<h4 id=\"创建动画层\"><a href=\"#创建动画层\" class=\"headerlink\" title=\"创建动画层\"></a>创建动画层</h4><p>通过Armature创建动画层，创建船长的动画</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ani=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;chuanzhang&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"播放站立动画\"><a href=\"#播放站立动画\" class=\"headerlink\" title=\"播放站立动画\"></a>播放站立动画</h4><p>添加后的船长站立不动</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ani.getAnimation().play(<span class=\"string\">&quot;hold&quot;</span>);</span><br><span class=\"line\"><span class=\"built_in\">this</span>.addChild(ani);</span><br><span class=\"line\">ani.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">ani.setTag(<span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"动画事件监听\"><a href=\"#动画事件监听\" class=\"headerlink\" title=\"动画事件监听\"></a>动画事件监听</h4><p>动画播放之后的回调函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//设置动画的事件侦听</span></span><br><span class=\"line\">ani.getAnimation().setMovementEventCallFunc(<span class=\"built_in\">this</span>.anievent);</span><br><span class=\"line\"><span class=\"comment\">// 动作结束时执行相关回调</span></span><br><span class=\"line\">anievent:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">armature, movementType, movementID</span>) </span>&#123;   </span><br><span class=\"line\">    <span class=\"comment\">// TODO</span></span><br><span class=\"line\">    <span class=\"comment\">// movementType有如下几种类型：</span></span><br><span class=\"line\">    <span class=\"comment\">// 1.boneFrameEvent</span></span><br><span class=\"line\">    <span class=\"comment\">// 2.complete</span></span><br><span class=\"line\">    <span class=\"comment\">// 3.loopComplete</span></span><br><span class=\"line\">    <span class=\"comment\">// 4.movementChange</span></span><br><span class=\"line\">    <span class=\"comment\">// 5.movementFameEvent</span></span><br><span class=\"line\">    <span class=\"comment\">// 6.start</span></span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：<br>// 作业要求，实现一个点击英雄<br>// 点击屏幕让船长播放攻击的动画1-3次随机<br>// 然后继续走路<br>与上节课作业差不多，我实现了点击屏幕船长会走到这个位置，点击攻击会进行攻击，同时，场景会有一个敌人npc，npc会随机游走，相遇时，会不停攻击自己，自己也可以攻击npc，双方血量会减少，谁先杀死对方，谁将获得胜利。<br>作业代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    gameState:<span class=\"number\">1</span>,<span class=\"comment\">// 1游戏中，0结束</span></span><br><span class=\"line\">    direction:<span class=\"number\">1</span>,<span class=\"comment\">// 0左，1右</span></span><br><span class=\"line\">    state:<span class=\"number\">0</span>,</span><br><span class=\"line\">    npcDirection:<span class=\"number\">1</span>,</span><br><span class=\"line\">    npcState:<span class=\"number\">0</span>,<span class=\"comment\">//0移动，1攻击</span></span><br><span class=\"line\">    selfHp:<span class=\"number\">100</span>,</span><br><span class=\"line\">    npcHp:<span class=\"number\">100</span>,</span><br><span class=\"line\">    selfHpTxt:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    npcHpTxt:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 攻击按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> attackMenu = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;打&quot;</span>,<span class=\"built_in\">this</span>.attackCall,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        attackMenu.setPosition(cc.winSize.width<span class=\"number\">-150</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(attackMenu);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 血量</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.selfHpTxt = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;我方血量:100&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">25</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcHpTxt = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;敌方血量:100&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">25</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.selfHpTxt.setPosition(cc.winSize.width<span class=\"number\">-150</span>,cc.winSize.height<span class=\"number\">-50</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcHpTxt.setPosition(<span class=\"number\">150</span>,cc.winSize.height<span class=\"number\">-50</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.selfHpTxt);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.npcHpTxt);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//加载动画</span></span><br><span class=\"line\">        ccs.armatureDataManager.addArmatureFileInfo(res.ani_json);</span><br><span class=\"line\">        <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> ani=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;chuanzhang&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//播放站立动画</span></span><br><span class=\"line\">        ani.getAnimation().play(<span class=\"string\">&quot;hold&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(ani);</span><br><span class=\"line\">        ani.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        ani.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//设置动画的事件侦听</span></span><br><span class=\"line\">        ani.getAnimation().setMovementEventCallFunc(<span class=\"built_in\">this</span>.anievent);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 敌人npc</span></span><br><span class=\"line\">        <span class=\"comment\">//加载动画</span></span><br><span class=\"line\">        ccs.armatureDataManager.addArmatureFileInfo(res.ani_json);</span><br><span class=\"line\">        <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;chuanzhang&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//播放站立动画</span></span><br><span class=\"line\">        npc.getAnimation().play(<span class=\"string\">&quot;hold&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(npc);</span><br><span class=\"line\">        npc.setPosition(<span class=\"number\">400</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        npc.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">//设置动画的事件侦听</span></span><br><span class=\"line\">        npc.getAnimation().setMovementEventCallFunc(<span class=\"built_in\">this</span>.npcevent);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcMove();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.update);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcState = <span class=\"number\">0</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 作业要求，实现一个点击英雄</span></span><br><span class=\"line\">        <span class=\"comment\">// 点击屏幕让船长播放攻击的动画1-3次随机</span></span><br><span class=\"line\">        <span class=\"comment\">// 然后继续走路</span></span><br><span class=\"line\">            </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 返回按钮</span></span><br><span class=\"line\">    back:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> startLayer());</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 计划任务，写敌人npc的ai</span></span><br><span class=\"line\">    update:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.gameState==<span class=\"number\">0</span>&amp;&amp;<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">111</span>)==<span class=\"literal\">null</span>)&#123;<span class=\"comment\">// 游戏结束，判断胜利还是失败</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> text = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(npc==<span class=\"literal\">null</span>)&#123;<span class=\"comment\">// 赢了</span></span><br><span class=\"line\">                text = <span class=\"string\">&quot;You Win&quot;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(bn==<span class=\"literal\">null</span>)&#123;<span class=\"comment\">// 输了</span></span><br><span class=\"line\">                text = <span class=\"string\">&quot;You Lose&quot;</span>;            </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.removeAllChildren();</span><br><span class=\"line\">            <span class=\"keyword\">var</span> over = <span class=\"keyword\">new</span> cc.LabelTTF(text,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>);</span><br><span class=\"line\">            over.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(over);</span><br><span class=\"line\">            over.setTag(<span class=\"number\">111</span>);</span><br><span class=\"line\">            over.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">2</span>),cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">0.5</span>),cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">            <span class=\"comment\">// 按钮</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> back = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;返回&quot;</span>,<span class=\"built_in\">this</span>.back,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">            back.setPosition(cc.winSize.width/<span class=\"number\">2</span>,over.height+<span class=\"number\">50</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(back);</span><br><span class=\"line\">            menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.gameState==<span class=\"number\">1</span>)&#123;<span class=\"comment\">// 游戏运行中</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(</span><br><span class=\"line\">                (<span class=\"built_in\">Math</span>.abs(npc.getPositionX()-bn.getPositionX()))&lt;=bn.width/<span class=\"number\">2</span></span><br><span class=\"line\">                &amp;&amp;(<span class=\"built_in\">Math</span>.abs(npc.getPositionY()-bn.getPositionY())&lt;=bn.height/<span class=\"number\">4</span>)</span><br><span class=\"line\">            )&#123;<span class=\"comment\">// 主角出现在npc的攻击范围内</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.npcState==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.npcState = <span class=\"number\">1</span>;</span><br><span class=\"line\">                    npc.stopAllActions();</span><br><span class=\"line\">                    npc.getAnimation().play(<span class=\"string\">&quot;attack&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.npcState==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.npcState = <span class=\"number\">0</span>;</span><br><span class=\"line\">                    npc.getAnimation().play(<span class=\"string\">&quot;walk&quot;</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.npcMove();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 敌人移动动画</span></span><br><span class=\"line\">    npcMove:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npcDirection = <span class=\"built_in\">this</span>.npcDirection;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> randomX = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*(cc.winSize.width-npc.width)+npc.width/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> randomY = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*(cc.winSize.height-npc.height)+npc.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 走路时间</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(randomX-npc.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(randomY-npc.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(randomX&lt;npc.getPositionX()&amp;&amp;npcDirection==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 左转</span></span><br><span class=\"line\">            npc.runAction(cc.scaleTo(<span class=\"number\">0</span>,<span class=\"number\">-1</span>,<span class=\"number\">1</span>));</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.npcDirection = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(randomX&gt;npc.getPositionX()&amp;&amp;npcDirection==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 右转</span></span><br><span class=\"line\">            npc.runAction(cc.scaleTo(<span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>));</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.npcDirection = <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        npc.getAnimation().play(<span class=\"string\">&quot;walk&quot;</span>);</span><br><span class=\"line\">        npc.runAction(cc.sequence(cc.moveTo(time,cc.p(randomX,randomY)),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">npc</span>)</span>&#123;</span><br><span class=\"line\">            npc.parent.npcMove();</span><br><span class=\"line\">        &#125;,npc)));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        cc.eventManager.addListener(&#123;</span><br><span class=\"line\">            event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">            swallowTouches:<span class=\"literal\">true</span>,</span><br><span class=\"line\">            onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">            onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">            onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        event.getCurrentTarget().state = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(event.getCurrentTarget().gameState==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocation().x;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocation().y;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> direction = event.getCurrentTarget().direction;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        bn.stopAllActions();</span><br><span class=\"line\">        <span class=\"comment\">// 走路时间</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-bn.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-bn.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;bn.getPositionX()&amp;&amp;direction==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 左转</span></span><br><span class=\"line\">            bn.runAction(cc.scaleTo(<span class=\"number\">0</span>,<span class=\"number\">-1</span>,<span class=\"number\">1</span>));</span><br><span class=\"line\">            event.getCurrentTarget().direction = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(x&gt;bn.getPositionX()&amp;&amp;direction==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 右转</span></span><br><span class=\"line\">            bn.runAction(cc.scaleTo(<span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>));</span><br><span class=\"line\">            event.getCurrentTarget().direction = <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        bn.getAnimation().play(<span class=\"string\">&quot;walk&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> walkTo = <span class=\"keyword\">new</span> cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">bn</span>)</span>&#123;</span><br><span class=\"line\">            bn.getAnimation().play(<span class=\"string\">&quot;hold&quot;</span>);</span><br><span class=\"line\">        &#125;,bn));</span><br><span class=\"line\">        bn.runAction(walkTo);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 攻击按钮回调</span></span><br><span class=\"line\">    attackCall:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.state==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.state=<span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).stopAllActions();</span><br><span class=\"line\">            <span class=\"comment\">// 攻击动画</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).getAnimation().play(<span class=\"string\">&quot;attack&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 攻击npc血量</span></span><br><span class=\"line\">    anievent:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">armature,movementtype,movementID</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(movementtype==<span class=\"number\">2</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(movementID==<span class=\"string\">&quot;attack&quot;</span>)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                armature.parent.stopAllActions();</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(</span><br><span class=\"line\">                    <span class=\"built_in\">Math</span>.abs(armature.parent.getChildByTag(<span class=\"number\">2</span>).getPositionX()-armature.parent.getChildByTag(<span class=\"number\">1</span>).getPositionX())&lt;=armature.parent.getChildByTag(<span class=\"number\">1</span>).width/<span class=\"number\">2</span></span><br><span class=\"line\">                    &amp;&amp;<span class=\"built_in\">Math</span>.abs(armature.parent.getChildByTag(<span class=\"number\">2</span>).getPositionY()-armature.parent.getChildByTag(<span class=\"number\">1</span>).getPositionY())&lt;=armature.parent.getChildByTag(<span class=\"number\">1</span>).height/<span class=\"number\">4</span></span><br><span class=\"line\">                )&#123;</span><br><span class=\"line\">                    armature.parent.state=<span class=\"number\">1</span>;</span><br><span class=\"line\">                    armature.parent.npcHp-=<span class=\"number\">4</span>+<span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">2</span>);</span><br><span class=\"line\">                    armature.parent.npcHpTxt.runAction(</span><br><span class=\"line\">                        cc.sequence(</span><br><span class=\"line\">                            cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.2</span>),</span><br><span class=\"line\">                            cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0.9</span>),</span><br><span class=\"line\">                            cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>),</span><br><span class=\"line\">                            cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">armature</span>)</span>&#123;</span><br><span class=\"line\">                                armature.parent.npcHpTxt.setString(<span class=\"string\">&quot;敌方血量:&quot;</span>+armature.parent.npcHp);</span><br><span class=\"line\">                            &#125;,armature)));</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(armature.parent.npcHp&lt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                        armature.parent.getChildByTag(<span class=\"number\">2</span>).removeFromParent();</span><br><span class=\"line\">                        armature.parent.gameState=<span class=\"number\">0</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                armature.parent.state = <span class=\"number\">0</span>;</span><br><span class=\"line\">                armature.getAnimation().play(<span class=\"string\">&quot;hold&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// npc攻击我方血量</span></span><br><span class=\"line\">    npcevent:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">armature,movementtype,movementID</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(movementtype==<span class=\"number\">2</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(movementID==<span class=\"string\">&quot;attack&quot;</span>)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                armature.parent.selfHp-=<span class=\"number\">2</span>+<span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">2</span>);</span><br><span class=\"line\">                armature.parent.selfHpTxt.runAction(</span><br><span class=\"line\">                    cc.sequence(</span><br><span class=\"line\">                        cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.2</span>),</span><br><span class=\"line\">                        cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0.9</span>),</span><br><span class=\"line\">                        cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>),</span><br><span class=\"line\">                        cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">armature</span>)</span>&#123;</span><br><span class=\"line\">                            armature.parent.selfHpTxt.setString(<span class=\"string\">&quot;我方血量:&quot;</span>+armature.parent.selfHp);</span><br><span class=\"line\">                        &#125;,armature)));</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(armature.parent.selfHp&lt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                    armature.parent.getChildByTag(<span class=\"number\">1</span>).removeFromParent();</span><br><span class=\"line\">                    armature.getAnimation().play(<span class=\"string\">&quot;hold&quot;</span>);</span><br><span class=\"line\">                    armature.parent.gameState=<span class=\"number\">0</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> startLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"comment\">// 标题</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> title = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;真假船长大战&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        title.setPosition(size.width/<span class=\"number\">2</span>,size.height<span class=\"number\">-100</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(title);</span><br><span class=\"line\">        <span class=\"comment\">// 按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> startMenu = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;开始游戏&quot;</span>,<span class=\"built_in\">this</span>.start,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        startMenu.setPosition(size.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helpMenu = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;帮助&quot;</span>,<span class=\"built_in\">this</span>.help,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        helpMenu.setPosition(size.width/<span class=\"number\">2</span>,startMenu.height+<span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(startMenu,helpMenu);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    start:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> HelloWorldLayer());</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    help:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> helpLayer());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> helpLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"comment\">// 标题</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> title = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;游戏中有一个假船长四处游走，\\r\\n当你们靠的很近时，它会攻击你，你也可以攻击它，\\r\\n谁先打倒对方谁将获得胜利！&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">30</span>);</span><br><span class=\"line\">        title.setPosition(size.width/<span class=\"number\">2</span>,size.height<span class=\"number\">-100</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(title);</span><br><span class=\"line\">        <span class=\"comment\">// 按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> back = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;返回&quot;</span>,<span class=\"built_in\">this</span>.help,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        back.setPosition(size.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(back);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    help:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> startLayer());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> startLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_05_03/59d170f1dd8aec6a65cf900f6759098d960ab296/\">http://www.cocoscvp.com/usercode/2016_05_03/59d170f1dd8aec6a65cf900f6759098d960ab296/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课介绍如何使用Animation Editor创建骨骼动画，通过骨骼动画，可以让人物形象更加的生动，学习使用Animation Editor编辑骨骼动画，并在游戏场景中加载骨骼动画","more":"</p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><p>首先需要用到的还是上节课下载好的动画编辑器Animation Editor。</p>\n<h4 id=\"制作帧动画\"><a href=\"#制作帧动画\" class=\"headerlink\" title=\"制作帧动画\"></a>制作帧动画</h4><p>制作骨骼动画的过程相对于制作帧动画来说要麻烦很多，需要在Animation Editor中对每一个骨骼都进行细微的调整，调整完了同帧动画一样，导出资源，，就会有png、plist和json三个文件。</p>\n<h4 id=\"添加文件\"><a href=\"#添加文件\" class=\"headerlink\" title=\"添加文件\"></a>添加文件</h4><p>同帧动画一样，先将json文件导入到armatureDataManager中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//添加文件</span></span><br><span class=\"line\">ccs.armatureDataManager.addArmatureFileInfo(res.ani_json);</span><br></pre></td></tr></table></figure>\n<h4 id=\"创建动画层\"><a href=\"#创建动画层\" class=\"headerlink\" title=\"创建动画层\"></a>创建动画层</h4><p>通过Armature创建动画层，创建船长的动画</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ani=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;chuanzhang&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"播放站立动画\"><a href=\"#播放站立动画\" class=\"headerlink\" title=\"播放站立动画\"></a>播放站立动画</h4><p>添加后的船长站立不动</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ani.getAnimation().play(<span class=\"string\">&quot;hold&quot;</span>);</span><br><span class=\"line\"><span class=\"built_in\">this</span>.addChild(ani);</span><br><span class=\"line\">ani.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">ani.setTag(<span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"动画事件监听\"><a href=\"#动画事件监听\" class=\"headerlink\" title=\"动画事件监听\"></a>动画事件监听</h4><p>动画播放之后的回调函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//设置动画的事件侦听</span></span><br><span class=\"line\">ani.getAnimation().setMovementEventCallFunc(<span class=\"built_in\">this</span>.anievent);</span><br><span class=\"line\"><span class=\"comment\">// 动作结束时执行相关回调</span></span><br><span class=\"line\">anievent:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">armature, movementType, movementID</span>) </span>&#123;   </span><br><span class=\"line\">    <span class=\"comment\">// TODO</span></span><br><span class=\"line\">    <span class=\"comment\">// movementType有如下几种类型：</span></span><br><span class=\"line\">    <span class=\"comment\">// 1.boneFrameEvent</span></span><br><span class=\"line\">    <span class=\"comment\">// 2.complete</span></span><br><span class=\"line\">    <span class=\"comment\">// 3.loopComplete</span></span><br><span class=\"line\">    <span class=\"comment\">// 4.movementChange</span></span><br><span class=\"line\">    <span class=\"comment\">// 5.movementFameEvent</span></span><br><span class=\"line\">    <span class=\"comment\">// 6.start</span></span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：<br>// 作业要求，实现一个点击英雄<br>// 点击屏幕让船长播放攻击的动画1-3次随机<br>// 然后继续走路<br>与上节课作业差不多，我实现了点击屏幕船长会走到这个位置，点击攻击会进行攻击，同时，场景会有一个敌人npc，npc会随机游走，相遇时，会不停攻击自己，自己也可以攻击npc，双方血量会减少，谁先杀死对方，谁将获得胜利。<br>作业代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    gameState:<span class=\"number\">1</span>,<span class=\"comment\">// 1游戏中，0结束</span></span><br><span class=\"line\">    direction:<span class=\"number\">1</span>,<span class=\"comment\">// 0左，1右</span></span><br><span class=\"line\">    state:<span class=\"number\">0</span>,</span><br><span class=\"line\">    npcDirection:<span class=\"number\">1</span>,</span><br><span class=\"line\">    npcState:<span class=\"number\">0</span>,<span class=\"comment\">//0移动，1攻击</span></span><br><span class=\"line\">    selfHp:<span class=\"number\">100</span>,</span><br><span class=\"line\">    npcHp:<span class=\"number\">100</span>,</span><br><span class=\"line\">    selfHpTxt:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    npcHpTxt:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 攻击按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> attackMenu = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;打&quot;</span>,<span class=\"built_in\">this</span>.attackCall,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        attackMenu.setPosition(cc.winSize.width<span class=\"number\">-150</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(attackMenu);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 血量</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.selfHpTxt = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;我方血量:100&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">25</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcHpTxt = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;敌方血量:100&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">25</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.selfHpTxt.setPosition(cc.winSize.width<span class=\"number\">-150</span>,cc.winSize.height<span class=\"number\">-50</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcHpTxt.setPosition(<span class=\"number\">150</span>,cc.winSize.height<span class=\"number\">-50</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.selfHpTxt);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.npcHpTxt);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//加载动画</span></span><br><span class=\"line\">        ccs.armatureDataManager.addArmatureFileInfo(res.ani_json);</span><br><span class=\"line\">        <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> ani=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;chuanzhang&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//播放站立动画</span></span><br><span class=\"line\">        ani.getAnimation().play(<span class=\"string\">&quot;hold&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(ani);</span><br><span class=\"line\">        ani.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        ani.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">//设置动画的事件侦听</span></span><br><span class=\"line\">        ani.getAnimation().setMovementEventCallFunc(<span class=\"built_in\">this</span>.anievent);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 敌人npc</span></span><br><span class=\"line\">        <span class=\"comment\">//加载动画</span></span><br><span class=\"line\">        ccs.armatureDataManager.addArmatureFileInfo(res.ani_json);</span><br><span class=\"line\">        <span class=\"comment\">//创建动画层</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc=<span class=\"keyword\">new</span> ccs.Armature(<span class=\"string\">&quot;chuanzhang&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//播放站立动画</span></span><br><span class=\"line\">        npc.getAnimation().play(<span class=\"string\">&quot;hold&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(npc);</span><br><span class=\"line\">        npc.setPosition(<span class=\"number\">400</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        npc.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">//设置动画的事件侦听</span></span><br><span class=\"line\">        npc.getAnimation().setMovementEventCallFunc(<span class=\"built_in\">this</span>.npcevent);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcMove();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.update);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcState = <span class=\"number\">0</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 作业要求，实现一个点击英雄</span></span><br><span class=\"line\">        <span class=\"comment\">// 点击屏幕让船长播放攻击的动画1-3次随机</span></span><br><span class=\"line\">        <span class=\"comment\">// 然后继续走路</span></span><br><span class=\"line\">            </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 返回按钮</span></span><br><span class=\"line\">    back:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> startLayer());</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 计划任务，写敌人npc的ai</span></span><br><span class=\"line\">    update:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.gameState==<span class=\"number\">0</span>&amp;&amp;<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">111</span>)==<span class=\"literal\">null</span>)&#123;<span class=\"comment\">// 游戏结束，判断胜利还是失败</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> text = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(npc==<span class=\"literal\">null</span>)&#123;<span class=\"comment\">// 赢了</span></span><br><span class=\"line\">                text = <span class=\"string\">&quot;You Win&quot;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(bn==<span class=\"literal\">null</span>)&#123;<span class=\"comment\">// 输了</span></span><br><span class=\"line\">                text = <span class=\"string\">&quot;You Lose&quot;</span>;            </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.removeAllChildren();</span><br><span class=\"line\">            <span class=\"keyword\">var</span> over = <span class=\"keyword\">new</span> cc.LabelTTF(text,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">50</span>);</span><br><span class=\"line\">            over.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(over);</span><br><span class=\"line\">            over.setTag(<span class=\"number\">111</span>);</span><br><span class=\"line\">            over.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">2</span>),cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">0.5</span>),cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">            <span class=\"comment\">// 按钮</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> back = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;返回&quot;</span>,<span class=\"built_in\">this</span>.back,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">            back.setPosition(cc.winSize.width/<span class=\"number\">2</span>,over.height+<span class=\"number\">50</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(back);</span><br><span class=\"line\">            menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.gameState==<span class=\"number\">1</span>)&#123;<span class=\"comment\">// 游戏运行中</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(</span><br><span class=\"line\">                (<span class=\"built_in\">Math</span>.abs(npc.getPositionX()-bn.getPositionX()))&lt;=bn.width/<span class=\"number\">2</span></span><br><span class=\"line\">                &amp;&amp;(<span class=\"built_in\">Math</span>.abs(npc.getPositionY()-bn.getPositionY())&lt;=bn.height/<span class=\"number\">4</span>)</span><br><span class=\"line\">            )&#123;<span class=\"comment\">// 主角出现在npc的攻击范围内</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.npcState==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.npcState = <span class=\"number\">1</span>;</span><br><span class=\"line\">                    npc.stopAllActions();</span><br><span class=\"line\">                    npc.getAnimation().play(<span class=\"string\">&quot;attack&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.npcState==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.npcState = <span class=\"number\">0</span>;</span><br><span class=\"line\">                    npc.getAnimation().play(<span class=\"string\">&quot;walk&quot;</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.npcMove();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 敌人移动动画</span></span><br><span class=\"line\">    npcMove:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npcDirection = <span class=\"built_in\">this</span>.npcDirection;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc=<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> randomX = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*(cc.winSize.width-npc.width)+npc.width/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> randomY = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*(cc.winSize.height-npc.height)+npc.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 走路时间</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(randomX-npc.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(randomY-npc.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(randomX&lt;npc.getPositionX()&amp;&amp;npcDirection==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 左转</span></span><br><span class=\"line\">            npc.runAction(cc.scaleTo(<span class=\"number\">0</span>,<span class=\"number\">-1</span>,<span class=\"number\">1</span>));</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.npcDirection = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(randomX&gt;npc.getPositionX()&amp;&amp;npcDirection==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 右转</span></span><br><span class=\"line\">            npc.runAction(cc.scaleTo(<span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>));</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.npcDirection = <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        npc.getAnimation().play(<span class=\"string\">&quot;walk&quot;</span>);</span><br><span class=\"line\">        npc.runAction(cc.sequence(cc.moveTo(time,cc.p(randomX,randomY)),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">npc</span>)</span>&#123;</span><br><span class=\"line\">            npc.parent.npcMove();</span><br><span class=\"line\">        &#125;,npc)));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        cc.eventManager.addListener(&#123;</span><br><span class=\"line\">            event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">            swallowTouches:<span class=\"literal\">true</span>,</span><br><span class=\"line\">            onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">            onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">            onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        event.getCurrentTarget().state = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(event.getCurrentTarget().gameState==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocation().x;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocation().y;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> direction = event.getCurrentTarget().direction;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bn = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        bn.stopAllActions();</span><br><span class=\"line\">        <span class=\"comment\">// 走路时间</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-bn.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-bn.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;bn.getPositionX()&amp;&amp;direction==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 左转</span></span><br><span class=\"line\">            bn.runAction(cc.scaleTo(<span class=\"number\">0</span>,<span class=\"number\">-1</span>,<span class=\"number\">1</span>));</span><br><span class=\"line\">            event.getCurrentTarget().direction = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(x&gt;bn.getPositionX()&amp;&amp;direction==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 右转</span></span><br><span class=\"line\">            bn.runAction(cc.scaleTo(<span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>));</span><br><span class=\"line\">            event.getCurrentTarget().direction = <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        bn.getAnimation().play(<span class=\"string\">&quot;walk&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> walkTo = <span class=\"keyword\">new</span> cc.sequence(cc.moveTo(time,cc.p(x,y)),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">bn</span>)</span>&#123;</span><br><span class=\"line\">            bn.getAnimation().play(<span class=\"string\">&quot;hold&quot;</span>);</span><br><span class=\"line\">        &#125;,bn));</span><br><span class=\"line\">        bn.runAction(walkTo);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 攻击按钮回调</span></span><br><span class=\"line\">    attackCall:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.state==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.state=<span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).stopAllActions();</span><br><span class=\"line\">            <span class=\"comment\">// 攻击动画</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).getAnimation().play(<span class=\"string\">&quot;attack&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 攻击npc血量</span></span><br><span class=\"line\">    anievent:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">armature,movementtype,movementID</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(movementtype==<span class=\"number\">2</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(movementID==<span class=\"string\">&quot;attack&quot;</span>)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                armature.parent.stopAllActions();</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(</span><br><span class=\"line\">                    <span class=\"built_in\">Math</span>.abs(armature.parent.getChildByTag(<span class=\"number\">2</span>).getPositionX()-armature.parent.getChildByTag(<span class=\"number\">1</span>).getPositionX())&lt;=armature.parent.getChildByTag(<span class=\"number\">1</span>).width/<span class=\"number\">2</span></span><br><span class=\"line\">                    &amp;&amp;<span class=\"built_in\">Math</span>.abs(armature.parent.getChildByTag(<span class=\"number\">2</span>).getPositionY()-armature.parent.getChildByTag(<span class=\"number\">1</span>).getPositionY())&lt;=armature.parent.getChildByTag(<span class=\"number\">1</span>).height/<span class=\"number\">4</span></span><br><span class=\"line\">                )&#123;</span><br><span class=\"line\">                    armature.parent.state=<span class=\"number\">1</span>;</span><br><span class=\"line\">                    armature.parent.npcHp-=<span class=\"number\">4</span>+<span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">2</span>);</span><br><span class=\"line\">                    armature.parent.npcHpTxt.runAction(</span><br><span class=\"line\">                        cc.sequence(</span><br><span class=\"line\">                            cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.2</span>),</span><br><span class=\"line\">                            cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0.9</span>),</span><br><span class=\"line\">                            cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>),</span><br><span class=\"line\">                            cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">armature</span>)</span>&#123;</span><br><span class=\"line\">                                armature.parent.npcHpTxt.setString(<span class=\"string\">&quot;敌方血量:&quot;</span>+armature.parent.npcHp);</span><br><span class=\"line\">                            &#125;,armature)));</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(armature.parent.npcHp&lt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                        armature.parent.getChildByTag(<span class=\"number\">2</span>).removeFromParent();</span><br><span class=\"line\">                        armature.parent.gameState=<span class=\"number\">0</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                armature.parent.state = <span class=\"number\">0</span>;</span><br><span class=\"line\">                armature.getAnimation().play(<span class=\"string\">&quot;hold&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// npc攻击我方血量</span></span><br><span class=\"line\">    npcevent:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">armature,movementtype,movementID</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(movementtype==<span class=\"number\">2</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(movementID==<span class=\"string\">&quot;attack&quot;</span>)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                armature.parent.selfHp-=<span class=\"number\">2</span>+<span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">2</span>);</span><br><span class=\"line\">                armature.parent.selfHpTxt.runAction(</span><br><span class=\"line\">                    cc.sequence(</span><br><span class=\"line\">                        cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.2</span>),</span><br><span class=\"line\">                        cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0.9</span>),</span><br><span class=\"line\">                        cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>),</span><br><span class=\"line\">                        cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">armature</span>)</span>&#123;</span><br><span class=\"line\">                            armature.parent.selfHpTxt.setString(<span class=\"string\">&quot;我方血量:&quot;</span>+armature.parent.selfHp);</span><br><span class=\"line\">                        &#125;,armature)));</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(armature.parent.selfHp&lt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                    armature.parent.getChildByTag(<span class=\"number\">1</span>).removeFromParent();</span><br><span class=\"line\">                    armature.getAnimation().play(<span class=\"string\">&quot;hold&quot;</span>);</span><br><span class=\"line\">                    armature.parent.gameState=<span class=\"number\">0</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> startLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"comment\">// 标题</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> title = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;真假船长大战&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        title.setPosition(size.width/<span class=\"number\">2</span>,size.height<span class=\"number\">-100</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(title);</span><br><span class=\"line\">        <span class=\"comment\">// 按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> startMenu = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;开始游戏&quot;</span>,<span class=\"built_in\">this</span>.start,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        startMenu.setPosition(size.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helpMenu = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;帮助&quot;</span>,<span class=\"built_in\">this</span>.help,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        helpMenu.setPosition(size.width/<span class=\"number\">2</span>,startMenu.height+<span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(startMenu,helpMenu);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    start:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> HelloWorldLayer());</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    help:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> helpLayer());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> helpLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"comment\">// 标题</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> title = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;游戏中有一个假船长四处游走，\\r\\n当你们靠的很近时，它会攻击你，你也可以攻击它，\\r\\n谁先打倒对方谁将获得胜利！&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">30</span>);</span><br><span class=\"line\">        title.setPosition(size.width/<span class=\"number\">2</span>,size.height<span class=\"number\">-100</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(title);</span><br><span class=\"line\">        <span class=\"comment\">// 按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> back = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;返回&quot;</span>,<span class=\"built_in\">this</span>.help,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        back.setPosition(size.width/<span class=\"number\">2</span>,size.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(back);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    help:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> startLayer());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> startLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_05_03/59d170f1dd8aec6a65cf900f6759098d960ab296/\">http://www.cocoscvp.com/usercode/2016_05_03/59d170f1dd8aec6a65cf900f6759098d960ab296/</a></p>"},{"title":"CVP认证学习笔记--(何小成)024--粒子动画","date":"2016-05-06T16:58:00.000Z","_content":"### 概念\n本节课介绍如何使用在cocos中使用粒子动画，其中可以使用cocos中包含的11种系统定义好的粒子动画，也可以使用粒子编辑器自定义粒子动画，然后在cocos代码中使用自己定义的粒子动画。<!--more-->系统的11种默认粒子动画我分别截了图，不过粒子动画由于是动画，我截图是静态图，可能效果还是不大明显，大家还是用实际代码来看效果比较好\n#### 爆炸粒子效果\nParticleExplosion。属于半径模式。\n![爆炸粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-12@2x.png)\n#### 火焰粒子效果\nParticleFire。属于重力径模式。\n![火焰粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-2@2x.png)\n#### 烟花粒子效果\nParticleFireworks。属于重力模式。\n![烟花粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-3@2x.png)\n#### 花粒子效果\nParticleFlower。属于重力模式。\n![花粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-4@2x.png)\n#### 星系粒子效果\nParticleGalaxy。属于半径模式。\n![星系粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-5@2x.png)\n#### 流星粒子效果\nParticleMeteor。属于重力模式。\n![流星粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-6@2x.png)\n#### 漩涡粒子效果\nParticleSpiral。属于半径模式。\n![漩涡粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-7@2x.png)\n#### 雪粒子效果\nParticleSnow。属于重力模式。\n![雪粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-8@2x.png)\n#### 烟粒子效果\nParticleSmoke。属于重力模式。\n![烟粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-9@2x.png)\n#### 太阳粒子效果\nParticleSun。属于重力模式。\n![太阳粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-10@2x.png)\n#### 雨粒子效果\nParticleRain。属于重力模式\n![雨粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-11@2x.png)\n### 步骤\n#### 制作粒子动画\n如果需要系统的粒子动画不能满足需求，可以使用粒子编辑器自己编辑一个粒子动画，我在mac系统使用的是ParticleDesigner，打开之后，有多种模板可以进行选择，选择完模板之后，再对各种细节进行调整，知道调整出满意的粒子动画，如下图：\n![ParticleDesigner](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-1@2x.png)\n其中包括了调整面板以及预览面板，当调整结果满意之后，点击导出即可在相应的文件夹下导出程序中所需要的plist文件和png图片。\n#### 创建粒子\n无论是使用系统提供的动画还是自定义的动画，首先需要创建相应的对象\n```javascript\n// 使用自定义粒子动画\nvar myp = new cc.ParticleSystem(\"res/lizi.plist\");\n// 使用系统提供的粒子动画\nvar fire = new cc.ParticleFire();\n```\n#### 设置纹理\n系统粒子动画需要为动画设置纹理，自定义粒子动画一般会将粒子动画使用的纹理写在plist中\n```javascript\nfire.texture = cc.textureCache.addImage(\"res/lizi.plist.png\");\n```\n#### 添加动画到图层\n最后将粒子动画添加到图层，就能看见粒子动画在屏幕中播放\n```javascript\nthis.addChild(fire);\nfire.setPosition(200, 200);\n```\n### 作业\n本节作业：\n主要了解所有的系统粒子动画以及掌握自定义粒子动画并加载到程序中。我在作业中实现了通过菜单选择查看不同的粒子动画，并且通过点击屏幕或在屏幕上滑动，粒子会跟着坐标移动。\n作业代码实现如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function (index) {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        var backMenu = new cc.MenuItemFont(\"返回\",this.backCall,this);\n        backMenu.setPosition(backMenu.width/2,cc.winSize.height-backMenu.height/2);\n        var menu = new cc.Menu(backMenu);\n        this.addChild(menu);\n        menu.setPosition(0,0);\n        //添加系统内置粒子效果\n        var lizi;\n        switch(index){\n            case 1:\n                lizi = new cc.ParticleFire();\n                break;\n            case 2:\n                lizi = new cc.ParticleFireworks();\n                break;\n            case 3:\n                lizi = new cc.ParticleFlower();\n                break;\n            case 4:\n                lizi = new cc.ParticleGalaxy();\n                break;\n            case 5:\n                lizi = new cc.ParticleMeteor();\n                break;\n            case 6:\n                lizi = new cc.ParticleSpiral();\n                break;\n            case 7:\n                lizi = new cc.ParticleSnow();\n                break;\n            case 8:\n                lizi = new cc.ParticleSmoke();\n                break;\n            case 9:\n                lizi = new cc.ParticleSun();\n                break;\n            case 10:\n                lizi = new cc.ParticleRain();\n                break;\n            case 11:\n                lizi = new cc.ParticleExplosion();\n                break;\n        }\n        lizi.texture=cc.textureCache.addImage(\"res/ballfire.plist.png\");\n        lizi.setPosition(200,200);\n        this.addChild(lizi);\n        lizi.setTag(1);\n        return true;\n    },\n    backCall:function(){\n        cc.director.runScene(new MenuLayer());\n    },\n    onEnter:function () {\n        this._super();\n        cc.eventManager.addListener({\n            event:cc.EventListener.TOUCH_ONE_BY_ONE ,\n            swallowTouches:true,\n            onTouchBegan:this.touchbegan,\n            onTouchMoved:this.touchmoved,\n            onTouchEnded:this.touchended\n        },this);\n        return true;\n    },\n    touchbegan:function (touch,event) {\n        var x = touch.getLocationX();\n        var y = touch.getLocationY();\n        event.getCurrentTarget().getChildByTag(1).setPosition(x,y);\n        return true;\n    },\n    touchmoved:function (touch,event) {\n        var x = touch.getLocationX();\n        var y = touch.getLocationY();\n        event.getCurrentTarget().getChildByTag(1).setPosition(x,y);\n        return true;\n    },\n    touchended:function () {\n\n    }\n});\n\nvar MenuLayer = cc.Layer.extend({\n    onEnter:function () {\n        this._super();\n        var size = cc.winSize;\n        // cocos中的各种系统粒子\n        var file = new cc.MenuItemFont(\"火焰粒子\",this.enterLayer,this);\n        file.setPosition(size.width/2,size.height-file.height/2-20);\n        file.setTag(1);\n        var yanhua = new cc.MenuItemFont(\"烟花粒子\",this.enterLayer,this);\n        yanhua.setPosition(size.width/2,file.getPositionY()-yanhua.height/2-20);\n        yanhua.setTag(2);\n        var flower = new cc.MenuItemFont(\"花粒子\",this.enterLayer,this);\n        flower.setPosition(size.width/2,yanhua.getPositionY()-flower.height/2-20);\n        flower.setTag(3);\n        var star = new cc.MenuItemFont(\"星系粒子\",this.enterLayer,this);\n        star.setPosition(size.width/2,flower.getPositionY()-star.height/2-20);\n        star.setTag(4);\n        var flowerStar = new cc.MenuItemFont(\"流星粒子\",this.enterLayer,this);\n        flowerStar.setPosition(size.width/2,star.getPositionY()-flowerStar.height/2-20);\n        flowerStar.setTag(5);\n        var rotation = new cc.MenuItemFont(\"漩涡粒子\",this.enterLayer,this);\n        rotation.setPosition(size.width/2,flowerStar.getPositionY()-rotation.height/2-20);\n        rotation.setTag(6);\n        var snow = new cc.MenuItemFont(\"雪粒子\",this.enterLayer,this);\n        snow.setPosition(size.width/2,rotation.getPositionY()-snow.height/2-20);\n        snow.setTag(7);\n        var smoke = new cc.MenuItemFont(\"烟粒子\",this.enterLayer,this);\n        smoke.setPosition(size.width/2,snow.getPositionY()-smoke.height/2-20);\n        smoke.setTag(8);\n        var sun = new cc.MenuItemFont(\"太阳粒子\",this.enterLayer,this);\n        sun.setPosition(size.width/2,smoke.getPositionY()-sun.height/2-20);\n        sun.setTag(9);\n        var rain = new cc.MenuItemFont(\"雨粒子\",this.enterLayer,this);\n        rain.setPosition(size.width/2,sun.getPositionY()-rain.height/2-20);\n        rain.setTag(10);\n        var explosion = new cc.MenuItemFont(\"爆炸粒子\",this.enterLayer,this);\n        explosion.setPosition(size.width/2,rain.getPositionY()-explosion.height/2-20);\n        explosion.setTag(11);\n        var menu = new cc.Menu(file,yanhua,flower,star,flowerStar,rotation,snow,smoke,sun,rain,menu,explosion);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n    },\n    enterLayer:function(obj){\n        var layer = new HelloWorldLayer(obj.tag);\n        cc.director.runScene(layer);\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new MenuLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_05_03/6766355ed49af56b6c56f001bfac96ae65823c8e/","source":"_posts/CVP认证学习笔记--(何小成)024--粒子动画.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)024--粒子动画\ndate: 2016-05-07 00:58\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节课介绍如何使用在cocos中使用粒子动画，其中可以使用cocos中包含的11种系统定义好的粒子动画，也可以使用粒子编辑器自定义粒子动画，然后在cocos代码中使用自己定义的粒子动画。<!--more-->系统的11种默认粒子动画我分别截了图，不过粒子动画由于是动画，我截图是静态图，可能效果还是不大明显，大家还是用实际代码来看效果比较好\n#### 爆炸粒子效果\nParticleExplosion。属于半径模式。\n![爆炸粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-12@2x.png)\n#### 火焰粒子效果\nParticleFire。属于重力径模式。\n![火焰粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-2@2x.png)\n#### 烟花粒子效果\nParticleFireworks。属于重力模式。\n![烟花粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-3@2x.png)\n#### 花粒子效果\nParticleFlower。属于重力模式。\n![花粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-4@2x.png)\n#### 星系粒子效果\nParticleGalaxy。属于半径模式。\n![星系粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-5@2x.png)\n#### 流星粒子效果\nParticleMeteor。属于重力模式。\n![流星粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-6@2x.png)\n#### 漩涡粒子效果\nParticleSpiral。属于半径模式。\n![漩涡粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-7@2x.png)\n#### 雪粒子效果\nParticleSnow。属于重力模式。\n![雪粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-8@2x.png)\n#### 烟粒子效果\nParticleSmoke。属于重力模式。\n![烟粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-9@2x.png)\n#### 太阳粒子效果\nParticleSun。属于重力模式。\n![太阳粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-10@2x.png)\n#### 雨粒子效果\nParticleRain。属于重力模式\n![雨粒子效果](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-11@2x.png)\n### 步骤\n#### 制作粒子动画\n如果需要系统的粒子动画不能满足需求，可以使用粒子编辑器自己编辑一个粒子动画，我在mac系统使用的是ParticleDesigner，打开之后，有多种模板可以进行选择，选择完模板之后，再对各种细节进行调整，知道调整出满意的粒子动画，如下图：\n![ParticleDesigner](http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-1@2x.png)\n其中包括了调整面板以及预览面板，当调整结果满意之后，点击导出即可在相应的文件夹下导出程序中所需要的plist文件和png图片。\n#### 创建粒子\n无论是使用系统提供的动画还是自定义的动画，首先需要创建相应的对象\n```javascript\n// 使用自定义粒子动画\nvar myp = new cc.ParticleSystem(\"res/lizi.plist\");\n// 使用系统提供的粒子动画\nvar fire = new cc.ParticleFire();\n```\n#### 设置纹理\n系统粒子动画需要为动画设置纹理，自定义粒子动画一般会将粒子动画使用的纹理写在plist中\n```javascript\nfire.texture = cc.textureCache.addImage(\"res/lizi.plist.png\");\n```\n#### 添加动画到图层\n最后将粒子动画添加到图层，就能看见粒子动画在屏幕中播放\n```javascript\nthis.addChild(fire);\nfire.setPosition(200, 200);\n```\n### 作业\n本节作业：\n主要了解所有的系统粒子动画以及掌握自定义粒子动画并加载到程序中。我在作业中实现了通过菜单选择查看不同的粒子动画，并且通过点击屏幕或在屏幕上滑动，粒子会跟着坐标移动。\n作业代码实现如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function (index) {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        var backMenu = new cc.MenuItemFont(\"返回\",this.backCall,this);\n        backMenu.setPosition(backMenu.width/2,cc.winSize.height-backMenu.height/2);\n        var menu = new cc.Menu(backMenu);\n        this.addChild(menu);\n        menu.setPosition(0,0);\n        //添加系统内置粒子效果\n        var lizi;\n        switch(index){\n            case 1:\n                lizi = new cc.ParticleFire();\n                break;\n            case 2:\n                lizi = new cc.ParticleFireworks();\n                break;\n            case 3:\n                lizi = new cc.ParticleFlower();\n                break;\n            case 4:\n                lizi = new cc.ParticleGalaxy();\n                break;\n            case 5:\n                lizi = new cc.ParticleMeteor();\n                break;\n            case 6:\n                lizi = new cc.ParticleSpiral();\n                break;\n            case 7:\n                lizi = new cc.ParticleSnow();\n                break;\n            case 8:\n                lizi = new cc.ParticleSmoke();\n                break;\n            case 9:\n                lizi = new cc.ParticleSun();\n                break;\n            case 10:\n                lizi = new cc.ParticleRain();\n                break;\n            case 11:\n                lizi = new cc.ParticleExplosion();\n                break;\n        }\n        lizi.texture=cc.textureCache.addImage(\"res/ballfire.plist.png\");\n        lizi.setPosition(200,200);\n        this.addChild(lizi);\n        lizi.setTag(1);\n        return true;\n    },\n    backCall:function(){\n        cc.director.runScene(new MenuLayer());\n    },\n    onEnter:function () {\n        this._super();\n        cc.eventManager.addListener({\n            event:cc.EventListener.TOUCH_ONE_BY_ONE ,\n            swallowTouches:true,\n            onTouchBegan:this.touchbegan,\n            onTouchMoved:this.touchmoved,\n            onTouchEnded:this.touchended\n        },this);\n        return true;\n    },\n    touchbegan:function (touch,event) {\n        var x = touch.getLocationX();\n        var y = touch.getLocationY();\n        event.getCurrentTarget().getChildByTag(1).setPosition(x,y);\n        return true;\n    },\n    touchmoved:function (touch,event) {\n        var x = touch.getLocationX();\n        var y = touch.getLocationY();\n        event.getCurrentTarget().getChildByTag(1).setPosition(x,y);\n        return true;\n    },\n    touchended:function () {\n\n    }\n});\n\nvar MenuLayer = cc.Layer.extend({\n    onEnter:function () {\n        this._super();\n        var size = cc.winSize;\n        // cocos中的各种系统粒子\n        var file = new cc.MenuItemFont(\"火焰粒子\",this.enterLayer,this);\n        file.setPosition(size.width/2,size.height-file.height/2-20);\n        file.setTag(1);\n        var yanhua = new cc.MenuItemFont(\"烟花粒子\",this.enterLayer,this);\n        yanhua.setPosition(size.width/2,file.getPositionY()-yanhua.height/2-20);\n        yanhua.setTag(2);\n        var flower = new cc.MenuItemFont(\"花粒子\",this.enterLayer,this);\n        flower.setPosition(size.width/2,yanhua.getPositionY()-flower.height/2-20);\n        flower.setTag(3);\n        var star = new cc.MenuItemFont(\"星系粒子\",this.enterLayer,this);\n        star.setPosition(size.width/2,flower.getPositionY()-star.height/2-20);\n        star.setTag(4);\n        var flowerStar = new cc.MenuItemFont(\"流星粒子\",this.enterLayer,this);\n        flowerStar.setPosition(size.width/2,star.getPositionY()-flowerStar.height/2-20);\n        flowerStar.setTag(5);\n        var rotation = new cc.MenuItemFont(\"漩涡粒子\",this.enterLayer,this);\n        rotation.setPosition(size.width/2,flowerStar.getPositionY()-rotation.height/2-20);\n        rotation.setTag(6);\n        var snow = new cc.MenuItemFont(\"雪粒子\",this.enterLayer,this);\n        snow.setPosition(size.width/2,rotation.getPositionY()-snow.height/2-20);\n        snow.setTag(7);\n        var smoke = new cc.MenuItemFont(\"烟粒子\",this.enterLayer,this);\n        smoke.setPosition(size.width/2,snow.getPositionY()-smoke.height/2-20);\n        smoke.setTag(8);\n        var sun = new cc.MenuItemFont(\"太阳粒子\",this.enterLayer,this);\n        sun.setPosition(size.width/2,smoke.getPositionY()-sun.height/2-20);\n        sun.setTag(9);\n        var rain = new cc.MenuItemFont(\"雨粒子\",this.enterLayer,this);\n        rain.setPosition(size.width/2,sun.getPositionY()-rain.height/2-20);\n        rain.setTag(10);\n        var explosion = new cc.MenuItemFont(\"爆炸粒子\",this.enterLayer,this);\n        explosion.setPosition(size.width/2,rain.getPositionY()-explosion.height/2-20);\n        explosion.setTag(11);\n        var menu = new cc.Menu(file,yanhua,flower,star,flowerStar,rotation,snow,smoke,sun,rain,menu,explosion);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n    },\n    enterLayer:function(obj){\n        var layer = new HelloWorldLayer(obj.tag);\n        cc.director.runScene(layer);\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new MenuLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_05_03/6766355ed49af56b6c56f001bfac96ae65823c8e/","slug":"CVP认证学习笔记--(何小成)024--粒子动画","published":1,"updated":"2016-05-06T17:04:06.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhum001ywsazdzhb1o1n","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课介绍如何使用在cocos中使用粒子动画，其中可以使用cocos中包含的11种系统定义好的粒子动画，也可以使用粒子编辑器自定义粒子动画，然后在cocos代码中使用自己定义的粒子动画。<a id=\"more\"></a>系统的11种默认粒子动画我分别截了图，不过粒子动画由于是动画，我截图是静态图，可能效果还是不大明显，大家还是用实际代码来看效果比较好</p>\n<h4 id=\"爆炸粒子效果\"><a href=\"#爆炸粒子效果\" class=\"headerlink\" title=\"爆炸粒子效果\"></a>爆炸粒子效果</h4><p>ParticleExplosion。属于半径模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-12@2x.png\" alt=\"爆炸粒子效果\"></p>\n<h4 id=\"火焰粒子效果\"><a href=\"#火焰粒子效果\" class=\"headerlink\" title=\"火焰粒子效果\"></a>火焰粒子效果</h4><p>ParticleFire。属于重力径模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-2@2x.png\" alt=\"火焰粒子效果\"></p>\n<h4 id=\"烟花粒子效果\"><a href=\"#烟花粒子效果\" class=\"headerlink\" title=\"烟花粒子效果\"></a>烟花粒子效果</h4><p>ParticleFireworks。属于重力模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-3@2x.png\" alt=\"烟花粒子效果\"></p>\n<h4 id=\"花粒子效果\"><a href=\"#花粒子效果\" class=\"headerlink\" title=\"花粒子效果\"></a>花粒子效果</h4><p>ParticleFlower。属于重力模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-4@2x.png\" alt=\"花粒子效果\"></p>\n<h4 id=\"星系粒子效果\"><a href=\"#星系粒子效果\" class=\"headerlink\" title=\"星系粒子效果\"></a>星系粒子效果</h4><p>ParticleGalaxy。属于半径模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-5@2x.png\" alt=\"星系粒子效果\"></p>\n<h4 id=\"流星粒子效果\"><a href=\"#流星粒子效果\" class=\"headerlink\" title=\"流星粒子效果\"></a>流星粒子效果</h4><p>ParticleMeteor。属于重力模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-6@2x.png\" alt=\"流星粒子效果\"></p>\n<h4 id=\"漩涡粒子效果\"><a href=\"#漩涡粒子效果\" class=\"headerlink\" title=\"漩涡粒子效果\"></a>漩涡粒子效果</h4><p>ParticleSpiral。属于半径模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-7@2x.png\" alt=\"漩涡粒子效果\"></p>\n<h4 id=\"雪粒子效果\"><a href=\"#雪粒子效果\" class=\"headerlink\" title=\"雪粒子效果\"></a>雪粒子效果</h4><p>ParticleSnow。属于重力模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-8@2x.png\" alt=\"雪粒子效果\"></p>\n<h4 id=\"烟粒子效果\"><a href=\"#烟粒子效果\" class=\"headerlink\" title=\"烟粒子效果\"></a>烟粒子效果</h4><p>ParticleSmoke。属于重力模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-9@2x.png\" alt=\"烟粒子效果\"></p>\n<h4 id=\"太阳粒子效果\"><a href=\"#太阳粒子效果\" class=\"headerlink\" title=\"太阳粒子效果\"></a>太阳粒子效果</h4><p>ParticleSun。属于重力模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-10@2x.png\" alt=\"太阳粒子效果\"></p>\n<h4 id=\"雨粒子效果\"><a href=\"#雨粒子效果\" class=\"headerlink\" title=\"雨粒子效果\"></a>雨粒子效果</h4><p>ParticleRain。属于重力模式<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-11@2x.png\" alt=\"雨粒子效果\"></p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><h4 id=\"制作粒子动画\"><a href=\"#制作粒子动画\" class=\"headerlink\" title=\"制作粒子动画\"></a>制作粒子动画</h4><p>如果需要系统的粒子动画不能满足需求，可以使用粒子编辑器自己编辑一个粒子动画，我在mac系统使用的是ParticleDesigner，打开之后，有多种模板可以进行选择，选择完模板之后，再对各种细节进行调整，知道调整出满意的粒子动画，如下图：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-1@2x.png\" alt=\"ParticleDesigner\"><br>其中包括了调整面板以及预览面板，当调整结果满意之后，点击导出即可在相应的文件夹下导出程序中所需要的plist文件和png图片。</p>\n<h4 id=\"创建粒子\"><a href=\"#创建粒子\" class=\"headerlink\" title=\"创建粒子\"></a>创建粒子</h4><p>无论是使用系统提供的动画还是自定义的动画，首先需要创建相应的对象</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用自定义粒子动画</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> myp = <span class=\"keyword\">new</span> cc.ParticleSystem(<span class=\"string\">&quot;res/lizi.plist&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 使用系统提供的粒子动画</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fire = <span class=\"keyword\">new</span> cc.ParticleFire();</span><br></pre></td></tr></table></figure>\n<h4 id=\"设置纹理\"><a href=\"#设置纹理\" class=\"headerlink\" title=\"设置纹理\"></a>设置纹理</h4><p>系统粒子动画需要为动画设置纹理，自定义粒子动画一般会将粒子动画使用的纹理写在plist中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fire.texture = cc.textureCache.addImage(<span class=\"string\">&quot;res/lizi.plist.png&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"添加动画到图层\"><a href=\"#添加动画到图层\" class=\"headerlink\" title=\"添加动画到图层\"></a>添加动画到图层</h4><p>最后将粒子动画添加到图层，就能看见粒子动画在屏幕中播放</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">this</span>.addChild(fire);</span><br><span class=\"line\">fire.setPosition(<span class=\"number\">200</span>, <span class=\"number\">200</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：<br>主要了解所有的系统粒子动画以及掌握自定义粒子动画并加载到程序中。我在作业中实现了通过菜单选择查看不同的粒子动画，并且通过点击屏幕或在屏幕上滑动，粒子会跟着坐标移动。<br>作业代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">index</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> backMenu = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;返回&quot;</span>,<span class=\"built_in\">this</span>.backCall,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        backMenu.setPosition(backMenu.width/<span class=\"number\">2</span>,cc.winSize.height-backMenu.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(backMenu);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加系统内置粒子效果</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> lizi;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(index)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleFire();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleFireworks();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleFlower();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleGalaxy();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleMeteor();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleSpiral();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleSnow();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleSmoke();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">9</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleSun();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">10</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleRain();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">11</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleExplosion();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        lizi.texture=cc.textureCache.addImage(<span class=\"string\">&quot;res/ballfire.plist.png&quot;</span>);</span><br><span class=\"line\">        lizi.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(lizi);</span><br><span class=\"line\">        lizi.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    backCall:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> MenuLayer());</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        cc.eventManager.addListener(&#123;</span><br><span class=\"line\">            event:cc.EventListener.TOUCH_ONE_BY_ONE ,</span><br><span class=\"line\">            swallowTouches:<span class=\"literal\">true</span>,</span><br><span class=\"line\">            onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">            onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">            onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">touch,event</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocationX();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocationY();</span><br><span class=\"line\">        event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>).setPosition(x,y);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">touch,event</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocationX();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocationY();</span><br><span class=\"line\">        event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>).setPosition(x,y);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> MenuLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"comment\">// cocos中的各种系统粒子</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> file = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;火焰粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        file.setPosition(size.width/<span class=\"number\">2</span>,size.height-file.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        file.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> yanhua = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;烟花粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        yanhua.setPosition(size.width/<span class=\"number\">2</span>,file.getPositionY()-yanhua.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        yanhua.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> flower = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;花粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        flower.setPosition(size.width/<span class=\"number\">2</span>,yanhua.getPositionY()-flower.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        flower.setTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> star = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;星系粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        star.setPosition(size.width/<span class=\"number\">2</span>,flower.getPositionY()-star.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        star.setTag(<span class=\"number\">4</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> flowerStar = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;流星粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        flowerStar.setPosition(size.width/<span class=\"number\">2</span>,star.getPositionY()-flowerStar.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        flowerStar.setTag(<span class=\"number\">5</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rotation = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;漩涡粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        rotation.setPosition(size.width/<span class=\"number\">2</span>,flowerStar.getPositionY()-rotation.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        rotation.setTag(<span class=\"number\">6</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> snow = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;雪粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        snow.setPosition(size.width/<span class=\"number\">2</span>,rotation.getPositionY()-snow.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        snow.setTag(<span class=\"number\">7</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> smoke = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;烟粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        smoke.setPosition(size.width/<span class=\"number\">2</span>,snow.getPositionY()-smoke.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        smoke.setTag(<span class=\"number\">8</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sun = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;太阳粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        sun.setPosition(size.width/<span class=\"number\">2</span>,smoke.getPositionY()-sun.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        sun.setTag(<span class=\"number\">9</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rain = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;雨粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        rain.setPosition(size.width/<span class=\"number\">2</span>,sun.getPositionY()-rain.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        rain.setTag(<span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> explosion = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;爆炸粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        explosion.setPosition(size.width/<span class=\"number\">2</span>,rain.getPositionY()-explosion.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        explosion.setTag(<span class=\"number\">11</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(file,yanhua,flower,star,flowerStar,rotation,snow,smoke,sun,rain,menu,explosion);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    enterLayer:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer(obj.tag);</span><br><span class=\"line\">        cc.director.runScene(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> MenuLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_05_03/6766355ed49af56b6c56f001bfac96ae65823c8e/\">http://www.cocoscvp.com/usercode/2016_05_03/6766355ed49af56b6c56f001bfac96ae65823c8e/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课介绍如何使用在cocos中使用粒子动画，其中可以使用cocos中包含的11种系统定义好的粒子动画，也可以使用粒子编辑器自定义粒子动画，然后在cocos代码中使用自己定义的粒子动画。","more":"系统的11种默认粒子动画我分别截了图，不过粒子动画由于是动画，我截图是静态图，可能效果还是不大明显，大家还是用实际代码来看效果比较好</p>\n<h4 id=\"爆炸粒子效果\"><a href=\"#爆炸粒子效果\" class=\"headerlink\" title=\"爆炸粒子效果\"></a>爆炸粒子效果</h4><p>ParticleExplosion。属于半径模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-12@2x.png\" alt=\"爆炸粒子效果\"></p>\n<h4 id=\"火焰粒子效果\"><a href=\"#火焰粒子效果\" class=\"headerlink\" title=\"火焰粒子效果\"></a>火焰粒子效果</h4><p>ParticleFire。属于重力径模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-2@2x.png\" alt=\"火焰粒子效果\"></p>\n<h4 id=\"烟花粒子效果\"><a href=\"#烟花粒子效果\" class=\"headerlink\" title=\"烟花粒子效果\"></a>烟花粒子效果</h4><p>ParticleFireworks。属于重力模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-3@2x.png\" alt=\"烟花粒子效果\"></p>\n<h4 id=\"花粒子效果\"><a href=\"#花粒子效果\" class=\"headerlink\" title=\"花粒子效果\"></a>花粒子效果</h4><p>ParticleFlower。属于重力模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-4@2x.png\" alt=\"花粒子效果\"></p>\n<h4 id=\"星系粒子效果\"><a href=\"#星系粒子效果\" class=\"headerlink\" title=\"星系粒子效果\"></a>星系粒子效果</h4><p>ParticleGalaxy。属于半径模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-5@2x.png\" alt=\"星系粒子效果\"></p>\n<h4 id=\"流星粒子效果\"><a href=\"#流星粒子效果\" class=\"headerlink\" title=\"流星粒子效果\"></a>流星粒子效果</h4><p>ParticleMeteor。属于重力模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-6@2x.png\" alt=\"流星粒子效果\"></p>\n<h4 id=\"漩涡粒子效果\"><a href=\"#漩涡粒子效果\" class=\"headerlink\" title=\"漩涡粒子效果\"></a>漩涡粒子效果</h4><p>ParticleSpiral。属于半径模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-7@2x.png\" alt=\"漩涡粒子效果\"></p>\n<h4 id=\"雪粒子效果\"><a href=\"#雪粒子效果\" class=\"headerlink\" title=\"雪粒子效果\"></a>雪粒子效果</h4><p>ParticleSnow。属于重力模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-8@2x.png\" alt=\"雪粒子效果\"></p>\n<h4 id=\"烟粒子效果\"><a href=\"#烟粒子效果\" class=\"headerlink\" title=\"烟粒子效果\"></a>烟粒子效果</h4><p>ParticleSmoke。属于重力模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-9@2x.png\" alt=\"烟粒子效果\"></p>\n<h4 id=\"太阳粒子效果\"><a href=\"#太阳粒子效果\" class=\"headerlink\" title=\"太阳粒子效果\"></a>太阳粒子效果</h4><p>ParticleSun。属于重力模式。<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-10@2x.png\" alt=\"太阳粒子效果\"></p>\n<h4 id=\"雨粒子效果\"><a href=\"#雨粒子效果\" class=\"headerlink\" title=\"雨粒子效果\"></a>雨粒子效果</h4><p>ParticleRain。属于重力模式<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-11@2x.png\" alt=\"雨粒子效果\"></p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><h4 id=\"制作粒子动画\"><a href=\"#制作粒子动画\" class=\"headerlink\" title=\"制作粒子动画\"></a>制作粒子动画</h4><p>如果需要系统的粒子动画不能满足需求，可以使用粒子编辑器自己编辑一个粒子动画，我在mac系统使用的是ParticleDesigner，打开之后，有多种模板可以进行选择，选择完模板之后，再对各种细节进行调整，知道调整出满意的粒子动画，如下图：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/QQ20160507-1@2x.png\" alt=\"ParticleDesigner\"><br>其中包括了调整面板以及预览面板，当调整结果满意之后，点击导出即可在相应的文件夹下导出程序中所需要的plist文件和png图片。</p>\n<h4 id=\"创建粒子\"><a href=\"#创建粒子\" class=\"headerlink\" title=\"创建粒子\"></a>创建粒子</h4><p>无论是使用系统提供的动画还是自定义的动画，首先需要创建相应的对象</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用自定义粒子动画</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> myp = <span class=\"keyword\">new</span> cc.ParticleSystem(<span class=\"string\">&quot;res/lizi.plist&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 使用系统提供的粒子动画</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fire = <span class=\"keyword\">new</span> cc.ParticleFire();</span><br></pre></td></tr></table></figure>\n<h4 id=\"设置纹理\"><a href=\"#设置纹理\" class=\"headerlink\" title=\"设置纹理\"></a>设置纹理</h4><p>系统粒子动画需要为动画设置纹理，自定义粒子动画一般会将粒子动画使用的纹理写在plist中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fire.texture = cc.textureCache.addImage(<span class=\"string\">&quot;res/lizi.plist.png&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"添加动画到图层\"><a href=\"#添加动画到图层\" class=\"headerlink\" title=\"添加动画到图层\"></a>添加动画到图层</h4><p>最后将粒子动画添加到图层，就能看见粒子动画在屏幕中播放</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">this</span>.addChild(fire);</span><br><span class=\"line\">fire.setPosition(<span class=\"number\">200</span>, <span class=\"number\">200</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：<br>主要了解所有的系统粒子动画以及掌握自定义粒子动画并加载到程序中。我在作业中实现了通过菜单选择查看不同的粒子动画，并且通过点击屏幕或在屏幕上滑动，粒子会跟着坐标移动。<br>作业代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">index</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> backMenu = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;返回&quot;</span>,<span class=\"built_in\">this</span>.backCall,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        backMenu.setPosition(backMenu.width/<span class=\"number\">2</span>,cc.winSize.height-backMenu.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(backMenu);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"comment\">//添加系统内置粒子效果</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> lizi;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(index)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleFire();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleFireworks();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleFlower();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleGalaxy();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleMeteor();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleSpiral();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleSnow();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleSmoke();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">9</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleSun();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">10</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleRain();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">11</span>:</span><br><span class=\"line\">                lizi = <span class=\"keyword\">new</span> cc.ParticleExplosion();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        lizi.texture=cc.textureCache.addImage(<span class=\"string\">&quot;res/ballfire.plist.png&quot;</span>);</span><br><span class=\"line\">        lizi.setPosition(<span class=\"number\">200</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(lizi);</span><br><span class=\"line\">        lizi.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    backCall:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> MenuLayer());</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        cc.eventManager.addListener(&#123;</span><br><span class=\"line\">            event:cc.EventListener.TOUCH_ONE_BY_ONE ,</span><br><span class=\"line\">            swallowTouches:<span class=\"literal\">true</span>,</span><br><span class=\"line\">            onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">            onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">            onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">touch,event</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocationX();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocationY();</span><br><span class=\"line\">        event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>).setPosition(x,y);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">touch,event</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocationX();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocationY();</span><br><span class=\"line\">        event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>).setPosition(x,y);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> MenuLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"comment\">// cocos中的各种系统粒子</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> file = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;火焰粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        file.setPosition(size.width/<span class=\"number\">2</span>,size.height-file.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        file.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> yanhua = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;烟花粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        yanhua.setPosition(size.width/<span class=\"number\">2</span>,file.getPositionY()-yanhua.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        yanhua.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> flower = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;花粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        flower.setPosition(size.width/<span class=\"number\">2</span>,yanhua.getPositionY()-flower.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        flower.setTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> star = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;星系粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        star.setPosition(size.width/<span class=\"number\">2</span>,flower.getPositionY()-star.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        star.setTag(<span class=\"number\">4</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> flowerStar = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;流星粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        flowerStar.setPosition(size.width/<span class=\"number\">2</span>,star.getPositionY()-flowerStar.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        flowerStar.setTag(<span class=\"number\">5</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rotation = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;漩涡粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        rotation.setPosition(size.width/<span class=\"number\">2</span>,flowerStar.getPositionY()-rotation.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        rotation.setTag(<span class=\"number\">6</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> snow = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;雪粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        snow.setPosition(size.width/<span class=\"number\">2</span>,rotation.getPositionY()-snow.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        snow.setTag(<span class=\"number\">7</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> smoke = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;烟粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        smoke.setPosition(size.width/<span class=\"number\">2</span>,snow.getPositionY()-smoke.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        smoke.setTag(<span class=\"number\">8</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sun = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;太阳粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        sun.setPosition(size.width/<span class=\"number\">2</span>,smoke.getPositionY()-sun.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        sun.setTag(<span class=\"number\">9</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rain = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;雨粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        rain.setPosition(size.width/<span class=\"number\">2</span>,sun.getPositionY()-rain.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        rain.setTag(<span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> explosion = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;爆炸粒子&quot;</span>,<span class=\"built_in\">this</span>.enterLayer,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        explosion.setPosition(size.width/<span class=\"number\">2</span>,rain.getPositionY()-explosion.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        explosion.setTag(<span class=\"number\">11</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(file,yanhua,flower,star,flowerStar,rotation,snow,smoke,sun,rain,menu,explosion);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    enterLayer:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer(obj.tag);</span><br><span class=\"line\">        cc.director.runScene(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> MenuLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_05_03/6766355ed49af56b6c56f001bfac96ae65823c8e/\">http://www.cocoscvp.com/usercode/2016_05_03/6766355ed49af56b6c56f001bfac96ae65823c8e/</a></p>"},{"title":"CVP认证学习笔记--(何小成)025--音乐和音效","date":"2016-05-07T07:51:00.000Z","_content":"### 概念\n本节课内容是cocos中音乐和音效的使用，游戏中经常会有游戏音乐和游戏音效，并且好的音乐音效也是一款游戏的一个卖点，在cocos中，对音乐和音效做了良好的封装，使用起来只需一两句代码就能实现，本节课介绍了cocos中音乐音效的开始暂停。<!--more-->\n### API\ncocos中的音乐音效处理被封装在了audioEngine中，通过使用audioEngine就可以调用相应的音乐音效API，API文档地址是：http://www.cocos.com/doc/jsdoc/symbols/cc.audioEngine.html\n```javascript\n// 结束音乐和音效\ncc.audioEngine.end()\n// 音效音量最大是1.0，最小是0.0\ncc.audioEngine.getEffectsVolume()\n// 音乐的最大音量是1.0，最小音量是0.0  \ncc.audioEngine.getMusicVolume()\n// 判断音乐是否在播放\ncc.audioEngine.isMusicPlaying()\n// 暂停播放所有音效\ncc.audioEngine.pauseAllEffects()\n// 暂停播放音效   \ncc.audioEngine.pauseEffect()\n// 暂停播放音乐  \ncc.audioEngine.pauseMusic()\n// 播放音效  \ncc.audioEngine.playEffect(url, loop)\n// 播放音乐  \ncc.audioEngine.playMusic(url, loop)\n// 重新播放所有音效 \ncc.audioEngine.resumeAllEffects()\n// 重新播放音效  \ncc.audioEngine.resumeEffect()\n// 重新播放音乐   \ncc.audioEngine.resumeMusic()\n// 回放播放的音乐  \ncc.audioEngine.rewindMusic()\n// 设置音效的音量    \ncc.audioEngine.setEffectsVolume(volume)\n// 设置音乐的音量\ncc.audioEngine.setMusicVolume(volume)\n// 停止播放所有音效  \ncc.audioEngine.stopAllEffects()\n// 停止播放音效\ncc.audioEngine.stopEffect()\n// 停止播放音乐 \ncc.audioEngine.stopMusic(releaseData)\n// 从内部缓冲区释放预加载的音效   \ncc.audioEngine.unloadEffect(url)\n// 标示背景音乐是否可以播放   \ncc.audioEngine.willPlayMusic()\n```\n### 作业\n本节作业：\n本节课作业要求实现点击屏幕播放音效，我进行了扩展，综合前面所学，做了一个打飞机的小demo，由于不是一个完整demo，所有有很多bug也没去处理，其中也实现了游戏中的音乐音效播放。\n作业代码实现如下：\n```javascript\nvar soundID=0;\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    music:1,// 0停止，1播放\n    state:0,//0静止，1攻击\n    npcs:[],// 敌机数组\n    bullets:[],// 子弹数组\n    game:0,// 0进行中,1lose\n    score:null,// 分数控件\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        var itemstartbg=new cc.MenuItemFont(\"🚫\",this.callback,this);\n        itemstartbg.setTag(10);\n        itemstartbg.setPositionY(cc.winSize.height-itemstartbg.height/2);\n        itemstartbg.setPositionX(itemstartbg.width/2+20);\n        var menu=new cc.Menu(itemstartbg);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n        \n        var plane = new cc.Sprite(\"res/HelloWorld.png\");\n        plane.setPosition(cc.winSize.width/2,80);\n        plane.setScale(0.5);\n        this.addChild(plane);\n        plane.setTag(1);\n        \n        this.schedule(this.createBullet,0.2);\n        this.schedule(this.createNpc,0.5);\n        this.schedule(this.collision);\n        return true;\n    },\n    callback:function(obj)\n    {// 背景音乐按钮\n        if(this.music==0){\n            cc.log(\"playMusic\");\n            this.music=1;\n            cc.audioEngine.playMusic(\"res/bg.mp3\",true);//循环播放\n            obj.setString(\"🚫\");\n        }else{\n            cc.log(\"stopMusic\");\n            this.music=0;\n            cc.audioEngine.stopMusic();//停止音乐\n            obj.setString(\"🎵\");\n        }\n    },\n    // 游戏逻辑判断\n    collision:function(){\n        if(this.game==1){\n            cc.audioEngine.stopMusic();\n            cc.director.runScene(new OverScene());\n            return;\n        }\n        for(var j in this.npcs){\n            var npc = this.npcs[j];\n            //  判断游戏是否结束\n            var plane = this.getChildByTag(1);\n            if(cc.rectIntersectsRect(npc.getBoundingBox(),plane.getBoundingBox())){\n                cc.log(\"over\");\n                this.game=1;\n                return;\n            }\n            for(var i in this.bullets){\n                var bullet = this.bullets[i];\n                // 判断是否击中敌机，通过rectIntersectsRect进行矩形碰撞判断\n                if(cc.rectIntersectsRect(bullet.getBoundingBox(),npc.getBoundingBox())){\n                    cc.log(\"crash\");\n                    bullet.removeFromParent();\n                    this.npcs.splice(j,1);\n                    this.bullets.splice(i,1);\n                    npc.runAction(\n                        cc.sequence(\n                            cc.scaleTo(0.2,0.5),\n                            cc.spawn(\n                                cc.rotateBy(0.5,720),\n                                cc.scaleTo(0.5,0)\n                            ),\n                            cc.callFunc(function(npc){\n                                npc.removeFromParent();\n                            },npc)\n                        )\n                    );\n                    return;\n                }\n            }\n        }\n    },\n    createNpc:function(){\n        var plane = new cc.Sprite(\"res/HelloWorld.png\");\n        var x = Math.round(Math.random()*cc.winSize.width);\n        plane.setPosition(x,cc.winSize.height+plane.height/2);\n        plane.setScale(0.2);\n        this.addChild(plane);\n        var time = Math.round(Math.sqrt(Math.pow(x-x,2)+Math.pow(0-plane.height/2-cc.winSize.height+plane.height/2,2)))/100;\n        plane.runAction(\n            cc.sequence(\n                cc.moveTo(time,x,0-plane.height/2),\n                cc.callFunc(function(plane){\n                    plane.removeFromParent();\n                },plane)\n            )\n        );\n        this.npcs.push(plane);\n    },\n    createBullet:function(){\n        if(this.state==1){\n            var sp = new cc.Sprite(\"res/logo.png\");\n            cc.audioEngine.playEffect(\"res/click.wav\");\n            var x = this.getChildByTag(1).getPositionX();\n            var y = this.getChildByTag(1).getPositionY()+this.getChildByTag(1).height/2;\n            sp.setPosition(x,y);\n            this.addChild(sp);\n            sp.setScale(0.3);\n            var time = Math.round(Math.sqrt(Math.pow(x-x,2)+Math.pow(cc.winSize.height+sp.height/2-y,2)))/100;\n            sp.runAction(\n                cc.spawn(\n                    cc.rotateBy(time,720).repeatForever(),\n                    cc.sequence(\n                        cc.moveTo(time,x,cc.winSize.height+sp.height/2),\n                        cc.callFunc(function(sp){\n                            sp.removeFromParent();\n                        },sp)\n                    )\n                )\n            );\n            this.bullets.push(sp);\n        }\n    },\n    onEnter:function(){\n        this._super();\n        cc.eventManager.addListener({\n            event:cc.EventListener.TOUCH_ONE_BY_ONE,\n            swallowTouches:true,\n            onTouchBegan:this.touchbegan,\n            onTouchMoved:this.touchMoved,\n            onTouchEnded:this.touchEnded\n        },this);\n        cc.audioEngine.playMusic(\"res/bg.mp3\",true);\n        return true;\n    },\n    touchbegan:function(touch,event){\n        event.getCurrentTarget().state=1;\n        var x = touch.getLocationX();\n        var y = touch.getLocationY();\n        var plane = event.getCurrentTarget().getChildByTag(1);\n        var time = Math.round(Math.sqrt(Math.pow(x-plane.getPositionX(),2)+Math.pow(y-plane.getPositionY(),2)))/1000;\n        plane.stopAllActions(); \n        plane.runAction(cc.moveTo(time,cc.p(x,y)));\n        return true;\n    },\n    touchMoved:function(touch,event){\n        var x = touch.getLocationX();\n        var y = touch.getLocationY();\n        var plane = event.getCurrentTarget().getChildByTag(1);\n        plane.stopAllActions(); \n        plane.setPosition(x,y);\n        return true;\n    },\n    touchEnded:function(touch,event){\n        event.getCurrentTarget().state=0;\n        return true;\n    }\n});\n\nvar OverScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var overTxt = new cc.LabelTTF(\"Game Over\",\"\",100);\n        overTxt.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        this.addChild(overTxt);\n        overTxt.runAction(\n            cc.sequence(cc.scaleTo(0.2,1.2),cc.scaleTo(0.2,0.9),cc.scaleTo(0.2,1))    \n        );\n        var backMenu = new cc.MenuItemFont(\"再来一次\",function(){\n            cc.director.runScene(new HelloWorldScene());\n        },this);\n        backMenu.setPosition(overTxt.getPositionX(),overTxt.getPositionY()-50-backMenu.height/2);\n        var menu = new cc.Menu(backMenu);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_05_03/066a65bf1bf65dcd589d18a33ad67990822843c1/","source":"_posts/CVP认证学习笔记--(何小成)025--音乐和音效.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)025--音乐和音效\ndate: 2016-05-07 15:51\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节课内容是cocos中音乐和音效的使用，游戏中经常会有游戏音乐和游戏音效，并且好的音乐音效也是一款游戏的一个卖点，在cocos中，对音乐和音效做了良好的封装，使用起来只需一两句代码就能实现，本节课介绍了cocos中音乐音效的开始暂停。<!--more-->\n### API\ncocos中的音乐音效处理被封装在了audioEngine中，通过使用audioEngine就可以调用相应的音乐音效API，API文档地址是：http://www.cocos.com/doc/jsdoc/symbols/cc.audioEngine.html\n```javascript\n// 结束音乐和音效\ncc.audioEngine.end()\n// 音效音量最大是1.0，最小是0.0\ncc.audioEngine.getEffectsVolume()\n// 音乐的最大音量是1.0，最小音量是0.0  \ncc.audioEngine.getMusicVolume()\n// 判断音乐是否在播放\ncc.audioEngine.isMusicPlaying()\n// 暂停播放所有音效\ncc.audioEngine.pauseAllEffects()\n// 暂停播放音效   \ncc.audioEngine.pauseEffect()\n// 暂停播放音乐  \ncc.audioEngine.pauseMusic()\n// 播放音效  \ncc.audioEngine.playEffect(url, loop)\n// 播放音乐  \ncc.audioEngine.playMusic(url, loop)\n// 重新播放所有音效 \ncc.audioEngine.resumeAllEffects()\n// 重新播放音效  \ncc.audioEngine.resumeEffect()\n// 重新播放音乐   \ncc.audioEngine.resumeMusic()\n// 回放播放的音乐  \ncc.audioEngine.rewindMusic()\n// 设置音效的音量    \ncc.audioEngine.setEffectsVolume(volume)\n// 设置音乐的音量\ncc.audioEngine.setMusicVolume(volume)\n// 停止播放所有音效  \ncc.audioEngine.stopAllEffects()\n// 停止播放音效\ncc.audioEngine.stopEffect()\n// 停止播放音乐 \ncc.audioEngine.stopMusic(releaseData)\n// 从内部缓冲区释放预加载的音效   \ncc.audioEngine.unloadEffect(url)\n// 标示背景音乐是否可以播放   \ncc.audioEngine.willPlayMusic()\n```\n### 作业\n本节作业：\n本节课作业要求实现点击屏幕播放音效，我进行了扩展，综合前面所学，做了一个打飞机的小demo，由于不是一个完整demo，所有有很多bug也没去处理，其中也实现了游戏中的音乐音效播放。\n作业代码实现如下：\n```javascript\nvar soundID=0;\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    music:1,// 0停止，1播放\n    state:0,//0静止，1攻击\n    npcs:[],// 敌机数组\n    bullets:[],// 子弹数组\n    game:0,// 0进行中,1lose\n    score:null,// 分数控件\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        var itemstartbg=new cc.MenuItemFont(\"🚫\",this.callback,this);\n        itemstartbg.setTag(10);\n        itemstartbg.setPositionY(cc.winSize.height-itemstartbg.height/2);\n        itemstartbg.setPositionX(itemstartbg.width/2+20);\n        var menu=new cc.Menu(itemstartbg);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n        \n        var plane = new cc.Sprite(\"res/HelloWorld.png\");\n        plane.setPosition(cc.winSize.width/2,80);\n        plane.setScale(0.5);\n        this.addChild(plane);\n        plane.setTag(1);\n        \n        this.schedule(this.createBullet,0.2);\n        this.schedule(this.createNpc,0.5);\n        this.schedule(this.collision);\n        return true;\n    },\n    callback:function(obj)\n    {// 背景音乐按钮\n        if(this.music==0){\n            cc.log(\"playMusic\");\n            this.music=1;\n            cc.audioEngine.playMusic(\"res/bg.mp3\",true);//循环播放\n            obj.setString(\"🚫\");\n        }else{\n            cc.log(\"stopMusic\");\n            this.music=0;\n            cc.audioEngine.stopMusic();//停止音乐\n            obj.setString(\"🎵\");\n        }\n    },\n    // 游戏逻辑判断\n    collision:function(){\n        if(this.game==1){\n            cc.audioEngine.stopMusic();\n            cc.director.runScene(new OverScene());\n            return;\n        }\n        for(var j in this.npcs){\n            var npc = this.npcs[j];\n            //  判断游戏是否结束\n            var plane = this.getChildByTag(1);\n            if(cc.rectIntersectsRect(npc.getBoundingBox(),plane.getBoundingBox())){\n                cc.log(\"over\");\n                this.game=1;\n                return;\n            }\n            for(var i in this.bullets){\n                var bullet = this.bullets[i];\n                // 判断是否击中敌机，通过rectIntersectsRect进行矩形碰撞判断\n                if(cc.rectIntersectsRect(bullet.getBoundingBox(),npc.getBoundingBox())){\n                    cc.log(\"crash\");\n                    bullet.removeFromParent();\n                    this.npcs.splice(j,1);\n                    this.bullets.splice(i,1);\n                    npc.runAction(\n                        cc.sequence(\n                            cc.scaleTo(0.2,0.5),\n                            cc.spawn(\n                                cc.rotateBy(0.5,720),\n                                cc.scaleTo(0.5,0)\n                            ),\n                            cc.callFunc(function(npc){\n                                npc.removeFromParent();\n                            },npc)\n                        )\n                    );\n                    return;\n                }\n            }\n        }\n    },\n    createNpc:function(){\n        var plane = new cc.Sprite(\"res/HelloWorld.png\");\n        var x = Math.round(Math.random()*cc.winSize.width);\n        plane.setPosition(x,cc.winSize.height+plane.height/2);\n        plane.setScale(0.2);\n        this.addChild(plane);\n        var time = Math.round(Math.sqrt(Math.pow(x-x,2)+Math.pow(0-plane.height/2-cc.winSize.height+plane.height/2,2)))/100;\n        plane.runAction(\n            cc.sequence(\n                cc.moveTo(time,x,0-plane.height/2),\n                cc.callFunc(function(plane){\n                    plane.removeFromParent();\n                },plane)\n            )\n        );\n        this.npcs.push(plane);\n    },\n    createBullet:function(){\n        if(this.state==1){\n            var sp = new cc.Sprite(\"res/logo.png\");\n            cc.audioEngine.playEffect(\"res/click.wav\");\n            var x = this.getChildByTag(1).getPositionX();\n            var y = this.getChildByTag(1).getPositionY()+this.getChildByTag(1).height/2;\n            sp.setPosition(x,y);\n            this.addChild(sp);\n            sp.setScale(0.3);\n            var time = Math.round(Math.sqrt(Math.pow(x-x,2)+Math.pow(cc.winSize.height+sp.height/2-y,2)))/100;\n            sp.runAction(\n                cc.spawn(\n                    cc.rotateBy(time,720).repeatForever(),\n                    cc.sequence(\n                        cc.moveTo(time,x,cc.winSize.height+sp.height/2),\n                        cc.callFunc(function(sp){\n                            sp.removeFromParent();\n                        },sp)\n                    )\n                )\n            );\n            this.bullets.push(sp);\n        }\n    },\n    onEnter:function(){\n        this._super();\n        cc.eventManager.addListener({\n            event:cc.EventListener.TOUCH_ONE_BY_ONE,\n            swallowTouches:true,\n            onTouchBegan:this.touchbegan,\n            onTouchMoved:this.touchMoved,\n            onTouchEnded:this.touchEnded\n        },this);\n        cc.audioEngine.playMusic(\"res/bg.mp3\",true);\n        return true;\n    },\n    touchbegan:function(touch,event){\n        event.getCurrentTarget().state=1;\n        var x = touch.getLocationX();\n        var y = touch.getLocationY();\n        var plane = event.getCurrentTarget().getChildByTag(1);\n        var time = Math.round(Math.sqrt(Math.pow(x-plane.getPositionX(),2)+Math.pow(y-plane.getPositionY(),2)))/1000;\n        plane.stopAllActions(); \n        plane.runAction(cc.moveTo(time,cc.p(x,y)));\n        return true;\n    },\n    touchMoved:function(touch,event){\n        var x = touch.getLocationX();\n        var y = touch.getLocationY();\n        var plane = event.getCurrentTarget().getChildByTag(1);\n        plane.stopAllActions(); \n        plane.setPosition(x,y);\n        return true;\n    },\n    touchEnded:function(touch,event){\n        event.getCurrentTarget().state=0;\n        return true;\n    }\n});\n\nvar OverScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var overTxt = new cc.LabelTTF(\"Game Over\",\"\",100);\n        overTxt.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        this.addChild(overTxt);\n        overTxt.runAction(\n            cc.sequence(cc.scaleTo(0.2,1.2),cc.scaleTo(0.2,0.9),cc.scaleTo(0.2,1))    \n        );\n        var backMenu = new cc.MenuItemFont(\"再来一次\",function(){\n            cc.director.runScene(new HelloWorldScene());\n        },this);\n        backMenu.setPosition(overTxt.getPositionX(),overTxt.getPositionY()-50-backMenu.height/2);\n        var menu = new cc.Menu(backMenu);\n        menu.setPosition(0,0);\n        this.addChild(menu);\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_05_03/066a65bf1bf65dcd589d18a33ad67990822843c1/","slug":"CVP认证学习笔记--(何小成)025--音乐和音效","published":1,"updated":"2016-05-29T02:34:50.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhuo0022wsazez3dgfr6","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课内容是cocos中音乐和音效的使用，游戏中经常会有游戏音乐和游戏音效，并且好的音乐音效也是一款游戏的一个卖点，在cocos中，对音乐和音效做了良好的封装，使用起来只需一两句代码就能实现，本节课介绍了cocos中音乐音效的开始暂停。<a id=\"more\"></a></p>\n<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>cocos中的音乐音效处理被封装在了audioEngine中，通过使用audioEngine就可以调用相应的音乐音效API，API文档地址是：<a href=\"http://www.cocos.com/doc/jsdoc/symbols/cc.audioEngine.html\">http://www.cocos.com/doc/jsdoc/symbols/cc.audioEngine.html</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 结束音乐和音效</span></span><br><span class=\"line\">cc.audioEngine.end()</span><br><span class=\"line\"><span class=\"comment\">// 音效音量最大是1.0，最小是0.0</span></span><br><span class=\"line\">cc.audioEngine.getEffectsVolume()</span><br><span class=\"line\"><span class=\"comment\">// 音乐的最大音量是1.0，最小音量是0.0  </span></span><br><span class=\"line\">cc.audioEngine.getMusicVolume()</span><br><span class=\"line\"><span class=\"comment\">// 判断音乐是否在播放</span></span><br><span class=\"line\">cc.audioEngine.isMusicPlaying()</span><br><span class=\"line\"><span class=\"comment\">// 暂停播放所有音效</span></span><br><span class=\"line\">cc.audioEngine.pauseAllEffects()</span><br><span class=\"line\"><span class=\"comment\">// 暂停播放音效   </span></span><br><span class=\"line\">cc.audioEngine.pauseEffect()</span><br><span class=\"line\"><span class=\"comment\">// 暂停播放音乐  </span></span><br><span class=\"line\">cc.audioEngine.pauseMusic()</span><br><span class=\"line\"><span class=\"comment\">// 播放音效  </span></span><br><span class=\"line\">cc.audioEngine.playEffect(url, loop)</span><br><span class=\"line\"><span class=\"comment\">// 播放音乐  </span></span><br><span class=\"line\">cc.audioEngine.playMusic(url, loop)</span><br><span class=\"line\"><span class=\"comment\">// 重新播放所有音效 </span></span><br><span class=\"line\">cc.audioEngine.resumeAllEffects()</span><br><span class=\"line\"><span class=\"comment\">// 重新播放音效  </span></span><br><span class=\"line\">cc.audioEngine.resumeEffect()</span><br><span class=\"line\"><span class=\"comment\">// 重新播放音乐   </span></span><br><span class=\"line\">cc.audioEngine.resumeMusic()</span><br><span class=\"line\"><span class=\"comment\">// 回放播放的音乐  </span></span><br><span class=\"line\">cc.audioEngine.rewindMusic()</span><br><span class=\"line\"><span class=\"comment\">// 设置音效的音量    </span></span><br><span class=\"line\">cc.audioEngine.setEffectsVolume(volume)</span><br><span class=\"line\"><span class=\"comment\">// 设置音乐的音量</span></span><br><span class=\"line\">cc.audioEngine.setMusicVolume(volume)</span><br><span class=\"line\"><span class=\"comment\">// 停止播放所有音效  </span></span><br><span class=\"line\">cc.audioEngine.stopAllEffects()</span><br><span class=\"line\"><span class=\"comment\">// 停止播放音效</span></span><br><span class=\"line\">cc.audioEngine.stopEffect()</span><br><span class=\"line\"><span class=\"comment\">// 停止播放音乐 </span></span><br><span class=\"line\">cc.audioEngine.stopMusic(releaseData)</span><br><span class=\"line\"><span class=\"comment\">// 从内部缓冲区释放预加载的音效   </span></span><br><span class=\"line\">cc.audioEngine.unloadEffect(url)</span><br><span class=\"line\"><span class=\"comment\">// 标示背景音乐是否可以播放   </span></span><br><span class=\"line\">cc.audioEngine.willPlayMusic()</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：<br>本节课作业要求实现点击屏幕播放音效，我进行了扩展，综合前面所学，做了一个打飞机的小demo，由于不是一个完整demo，所有有很多bug也没去处理，其中也实现了游戏中的音乐音效播放。<br>作业代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> soundID=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    music:<span class=\"number\">1</span>,<span class=\"comment\">// 0停止，1播放</span></span><br><span class=\"line\">    state:<span class=\"number\">0</span>,<span class=\"comment\">//0静止，1攻击</span></span><br><span class=\"line\">    npcs:[],<span class=\"comment\">// 敌机数组</span></span><br><span class=\"line\">    bullets:[],<span class=\"comment\">// 子弹数组</span></span><br><span class=\"line\">    game:<span class=\"number\">0</span>,<span class=\"comment\">// 0进行中,1lose</span></span><br><span class=\"line\">    score:<span class=\"literal\">null</span>,<span class=\"comment\">// 分数控件</span></span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> itemstartbg=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;🚫&quot;</span>,<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        itemstartbg.setTag(<span class=\"number\">10</span>);</span><br><span class=\"line\">        itemstartbg.setPositionY(cc.winSize.height-itemstartbg.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        itemstartbg.setPositionX(itemstartbg.width/<span class=\"number\">2</span>+<span class=\"number\">20</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(itemstartbg);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">var</span> plane = <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/HelloWorld.png&quot;</span>);</span><br><span class=\"line\">        plane.setPosition(cc.winSize.width/<span class=\"number\">2</span>,<span class=\"number\">80</span>);</span><br><span class=\"line\">        plane.setScale(<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(plane);</span><br><span class=\"line\">        plane.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.createBullet,<span class=\"number\">0.2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.createNpc,<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.collision);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;<span class=\"comment\">// 背景音乐按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.music==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            cc.log(<span class=\"string\">&quot;playMusic&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.music=<span class=\"number\">1</span>;</span><br><span class=\"line\">            cc.audioEngine.playMusic(<span class=\"string\">&quot;res/bg.mp3&quot;</span>,<span class=\"literal\">true</span>);<span class=\"comment\">//循环播放</span></span><br><span class=\"line\">            obj.setString(<span class=\"string\">&quot;🚫&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            cc.log(<span class=\"string\">&quot;stopMusic&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.music=<span class=\"number\">0</span>;</span><br><span class=\"line\">            cc.audioEngine.stopMusic();<span class=\"comment\">//停止音乐</span></span><br><span class=\"line\">            obj.setString(<span class=\"string\">&quot;🎵&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 游戏逻辑判断</span></span><br><span class=\"line\">    collision:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.game==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            cc.audioEngine.stopMusic();</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> OverScene());</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.npcs)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> npc = <span class=\"built_in\">this</span>.npcs[j];</span><br><span class=\"line\">            <span class=\"comment\">//  判断游戏是否结束</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> plane = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(cc.rectIntersectsRect(npc.getBoundingBox(),plane.getBoundingBox()))&#123;</span><br><span class=\"line\">                cc.log(<span class=\"string\">&quot;over&quot;</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.game=<span class=\"number\">1</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.bullets)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> bullet = <span class=\"built_in\">this</span>.bullets[i];</span><br><span class=\"line\">                <span class=\"comment\">// 判断是否击中敌机，通过rectIntersectsRect进行矩形碰撞判断</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(cc.rectIntersectsRect(bullet.getBoundingBox(),npc.getBoundingBox()))&#123;</span><br><span class=\"line\">                    cc.log(<span class=\"string\">&quot;crash&quot;</span>);</span><br><span class=\"line\">                    bullet.removeFromParent();</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.npcs.splice(j,<span class=\"number\">1</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.bullets.splice(i,<span class=\"number\">1</span>);</span><br><span class=\"line\">                    npc.runAction(</span><br><span class=\"line\">                        cc.sequence(</span><br><span class=\"line\">                            cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">0.5</span>),</span><br><span class=\"line\">                            cc.spawn(</span><br><span class=\"line\">                                cc.rotateBy(<span class=\"number\">0.5</span>,<span class=\"number\">720</span>),</span><br><span class=\"line\">                                cc.scaleTo(<span class=\"number\">0.5</span>,<span class=\"number\">0</span>)</span><br><span class=\"line\">                            ),</span><br><span class=\"line\">                            cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">npc</span>)</span>&#123;</span><br><span class=\"line\">                                npc.removeFromParent();</span><br><span class=\"line\">                            &#125;,npc)</span><br><span class=\"line\">                        )</span><br><span class=\"line\">                    );</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    createNpc:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> plane = <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/HelloWorld.png&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*cc.winSize.width);</span><br><span class=\"line\">        plane.setPosition(x,cc.winSize.height+plane.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        plane.setScale(<span class=\"number\">0.2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(plane);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-x,<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(<span class=\"number\">0</span>-plane.height/<span class=\"number\">2</span>-cc.winSize.height+plane.height/<span class=\"number\">2</span>,<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        plane.runAction(</span><br><span class=\"line\">            cc.sequence(</span><br><span class=\"line\">                cc.moveTo(time,x,<span class=\"number\">0</span>-plane.height/<span class=\"number\">2</span>),</span><br><span class=\"line\">                cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">plane</span>)</span>&#123;</span><br><span class=\"line\">                    plane.removeFromParent();</span><br><span class=\"line\">                &#125;,plane)</span><br><span class=\"line\">            )</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcs.push(plane);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    createBullet:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.state==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> sp = <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/logo.png&quot;</span>);</span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/click.wav&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> x = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).getPositionX();</span><br><span class=\"line\">            <span class=\"keyword\">var</span> y = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).getPositionY()+<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).height/<span class=\"number\">2</span>;</span><br><span class=\"line\">            sp.setPosition(x,y);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(sp);</span><br><span class=\"line\">            sp.setScale(<span class=\"number\">0.3</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-x,<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(cc.winSize.height+sp.height/<span class=\"number\">2</span>-y,<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">            sp.runAction(</span><br><span class=\"line\">                cc.spawn(</span><br><span class=\"line\">                    cc.rotateBy(time,<span class=\"number\">720</span>).repeatForever(),</span><br><span class=\"line\">                    cc.sequence(</span><br><span class=\"line\">                        cc.moveTo(time,x,cc.winSize.height+sp.height/<span class=\"number\">2</span>),</span><br><span class=\"line\">                        cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sp</span>)</span>&#123;</span><br><span class=\"line\">                            sp.removeFromParent();</span><br><span class=\"line\">                        &#125;,sp)</span><br><span class=\"line\">                    )</span><br><span class=\"line\">                )</span><br><span class=\"line\">            );</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.bullets.push(sp);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        cc.eventManager.addListener(&#123;</span><br><span class=\"line\">            event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">            swallowTouches:<span class=\"literal\">true</span>,</span><br><span class=\"line\">            onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">            onTouchMoved:<span class=\"built_in\">this</span>.touchMoved,</span><br><span class=\"line\">            onTouchEnded:<span class=\"built_in\">this</span>.touchEnded</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        cc.audioEngine.playMusic(<span class=\"string\">&quot;res/bg.mp3&quot;</span>,<span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        event.getCurrentTarget().state=<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocationX();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocationY();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> plane = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-plane.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-plane.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">1000</span>;</span><br><span class=\"line\">        plane.stopAllActions(); </span><br><span class=\"line\">        plane.runAction(cc.moveTo(time,cc.p(x,y)));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchMoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocationX();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocationY();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> plane = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        plane.stopAllActions(); </span><br><span class=\"line\">        plane.setPosition(x,y);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchEnded:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        event.getCurrentTarget().state=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> overTxt = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;Game Over&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        overTxt.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(overTxt);</span><br><span class=\"line\">        overTxt.runAction(</span><br><span class=\"line\">            cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.2</span>),cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">0.9</span>),cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1</span>))    </span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"keyword\">var</span> backMenu = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;再来一次&quot;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> HelloWorldScene());</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        backMenu.setPosition(overTxt.getPositionX(),overTxt.getPositionY()<span class=\"number\">-50</span>-backMenu.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(backMenu);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_05_03/066a65bf1bf65dcd589d18a33ad67990822843c1/\">http://www.cocoscvp.com/usercode/2016_05_03/066a65bf1bf65dcd589d18a33ad67990822843c1/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课内容是cocos中音乐和音效的使用，游戏中经常会有游戏音乐和游戏音效，并且好的音乐音效也是一款游戏的一个卖点，在cocos中，对音乐和音效做了良好的封装，使用起来只需一两句代码就能实现，本节课介绍了cocos中音乐音效的开始暂停。","more":"</p>\n<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>cocos中的音乐音效处理被封装在了audioEngine中，通过使用audioEngine就可以调用相应的音乐音效API，API文档地址是：<a href=\"http://www.cocos.com/doc/jsdoc/symbols/cc.audioEngine.html\">http://www.cocos.com/doc/jsdoc/symbols/cc.audioEngine.html</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 结束音乐和音效</span></span><br><span class=\"line\">cc.audioEngine.end()</span><br><span class=\"line\"><span class=\"comment\">// 音效音量最大是1.0，最小是0.0</span></span><br><span class=\"line\">cc.audioEngine.getEffectsVolume()</span><br><span class=\"line\"><span class=\"comment\">// 音乐的最大音量是1.0，最小音量是0.0  </span></span><br><span class=\"line\">cc.audioEngine.getMusicVolume()</span><br><span class=\"line\"><span class=\"comment\">// 判断音乐是否在播放</span></span><br><span class=\"line\">cc.audioEngine.isMusicPlaying()</span><br><span class=\"line\"><span class=\"comment\">// 暂停播放所有音效</span></span><br><span class=\"line\">cc.audioEngine.pauseAllEffects()</span><br><span class=\"line\"><span class=\"comment\">// 暂停播放音效   </span></span><br><span class=\"line\">cc.audioEngine.pauseEffect()</span><br><span class=\"line\"><span class=\"comment\">// 暂停播放音乐  </span></span><br><span class=\"line\">cc.audioEngine.pauseMusic()</span><br><span class=\"line\"><span class=\"comment\">// 播放音效  </span></span><br><span class=\"line\">cc.audioEngine.playEffect(url, loop)</span><br><span class=\"line\"><span class=\"comment\">// 播放音乐  </span></span><br><span class=\"line\">cc.audioEngine.playMusic(url, loop)</span><br><span class=\"line\"><span class=\"comment\">// 重新播放所有音效 </span></span><br><span class=\"line\">cc.audioEngine.resumeAllEffects()</span><br><span class=\"line\"><span class=\"comment\">// 重新播放音效  </span></span><br><span class=\"line\">cc.audioEngine.resumeEffect()</span><br><span class=\"line\"><span class=\"comment\">// 重新播放音乐   </span></span><br><span class=\"line\">cc.audioEngine.resumeMusic()</span><br><span class=\"line\"><span class=\"comment\">// 回放播放的音乐  </span></span><br><span class=\"line\">cc.audioEngine.rewindMusic()</span><br><span class=\"line\"><span class=\"comment\">// 设置音效的音量    </span></span><br><span class=\"line\">cc.audioEngine.setEffectsVolume(volume)</span><br><span class=\"line\"><span class=\"comment\">// 设置音乐的音量</span></span><br><span class=\"line\">cc.audioEngine.setMusicVolume(volume)</span><br><span class=\"line\"><span class=\"comment\">// 停止播放所有音效  </span></span><br><span class=\"line\">cc.audioEngine.stopAllEffects()</span><br><span class=\"line\"><span class=\"comment\">// 停止播放音效</span></span><br><span class=\"line\">cc.audioEngine.stopEffect()</span><br><span class=\"line\"><span class=\"comment\">// 停止播放音乐 </span></span><br><span class=\"line\">cc.audioEngine.stopMusic(releaseData)</span><br><span class=\"line\"><span class=\"comment\">// 从内部缓冲区释放预加载的音效   </span></span><br><span class=\"line\">cc.audioEngine.unloadEffect(url)</span><br><span class=\"line\"><span class=\"comment\">// 标示背景音乐是否可以播放   </span></span><br><span class=\"line\">cc.audioEngine.willPlayMusic()</span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：<br>本节课作业要求实现点击屏幕播放音效，我进行了扩展，综合前面所学，做了一个打飞机的小demo，由于不是一个完整demo，所有有很多bug也没去处理，其中也实现了游戏中的音乐音效播放。<br>作业代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> soundID=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    music:<span class=\"number\">1</span>,<span class=\"comment\">// 0停止，1播放</span></span><br><span class=\"line\">    state:<span class=\"number\">0</span>,<span class=\"comment\">//0静止，1攻击</span></span><br><span class=\"line\">    npcs:[],<span class=\"comment\">// 敌机数组</span></span><br><span class=\"line\">    bullets:[],<span class=\"comment\">// 子弹数组</span></span><br><span class=\"line\">    game:<span class=\"number\">0</span>,<span class=\"comment\">// 0进行中,1lose</span></span><br><span class=\"line\">    score:<span class=\"literal\">null</span>,<span class=\"comment\">// 分数控件</span></span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> itemstartbg=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;🚫&quot;</span>,<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        itemstartbg.setTag(<span class=\"number\">10</span>);</span><br><span class=\"line\">        itemstartbg.setPositionY(cc.winSize.height-itemstartbg.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        itemstartbg.setPositionX(itemstartbg.width/<span class=\"number\">2</span>+<span class=\"number\">20</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(itemstartbg);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">var</span> plane = <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/HelloWorld.png&quot;</span>);</span><br><span class=\"line\">        plane.setPosition(cc.winSize.width/<span class=\"number\">2</span>,<span class=\"number\">80</span>);</span><br><span class=\"line\">        plane.setScale(<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(plane);</span><br><span class=\"line\">        plane.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.createBullet,<span class=\"number\">0.2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.createNpc,<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.collision);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;<span class=\"comment\">// 背景音乐按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.music==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            cc.log(<span class=\"string\">&quot;playMusic&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.music=<span class=\"number\">1</span>;</span><br><span class=\"line\">            cc.audioEngine.playMusic(<span class=\"string\">&quot;res/bg.mp3&quot;</span>,<span class=\"literal\">true</span>);<span class=\"comment\">//循环播放</span></span><br><span class=\"line\">            obj.setString(<span class=\"string\">&quot;🚫&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            cc.log(<span class=\"string\">&quot;stopMusic&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.music=<span class=\"number\">0</span>;</span><br><span class=\"line\">            cc.audioEngine.stopMusic();<span class=\"comment\">//停止音乐</span></span><br><span class=\"line\">            obj.setString(<span class=\"string\">&quot;🎵&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 游戏逻辑判断</span></span><br><span class=\"line\">    collision:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.game==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            cc.audioEngine.stopMusic();</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> OverScene());</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.npcs)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> npc = <span class=\"built_in\">this</span>.npcs[j];</span><br><span class=\"line\">            <span class=\"comment\">//  判断游戏是否结束</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> plane = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(cc.rectIntersectsRect(npc.getBoundingBox(),plane.getBoundingBox()))&#123;</span><br><span class=\"line\">                cc.log(<span class=\"string\">&quot;over&quot;</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.game=<span class=\"number\">1</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.bullets)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> bullet = <span class=\"built_in\">this</span>.bullets[i];</span><br><span class=\"line\">                <span class=\"comment\">// 判断是否击中敌机，通过rectIntersectsRect进行矩形碰撞判断</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(cc.rectIntersectsRect(bullet.getBoundingBox(),npc.getBoundingBox()))&#123;</span><br><span class=\"line\">                    cc.log(<span class=\"string\">&quot;crash&quot;</span>);</span><br><span class=\"line\">                    bullet.removeFromParent();</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.npcs.splice(j,<span class=\"number\">1</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.bullets.splice(i,<span class=\"number\">1</span>);</span><br><span class=\"line\">                    npc.runAction(</span><br><span class=\"line\">                        cc.sequence(</span><br><span class=\"line\">                            cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">0.5</span>),</span><br><span class=\"line\">                            cc.spawn(</span><br><span class=\"line\">                                cc.rotateBy(<span class=\"number\">0.5</span>,<span class=\"number\">720</span>),</span><br><span class=\"line\">                                cc.scaleTo(<span class=\"number\">0.5</span>,<span class=\"number\">0</span>)</span><br><span class=\"line\">                            ),</span><br><span class=\"line\">                            cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">npc</span>)</span>&#123;</span><br><span class=\"line\">                                npc.removeFromParent();</span><br><span class=\"line\">                            &#125;,npc)</span><br><span class=\"line\">                        )</span><br><span class=\"line\">                    );</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    createNpc:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> plane = <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/HelloWorld.png&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random()*cc.winSize.width);</span><br><span class=\"line\">        plane.setPosition(x,cc.winSize.height+plane.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        plane.setScale(<span class=\"number\">0.2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(plane);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-x,<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(<span class=\"number\">0</span>-plane.height/<span class=\"number\">2</span>-cc.winSize.height+plane.height/<span class=\"number\">2</span>,<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">        plane.runAction(</span><br><span class=\"line\">            cc.sequence(</span><br><span class=\"line\">                cc.moveTo(time,x,<span class=\"number\">0</span>-plane.height/<span class=\"number\">2</span>),</span><br><span class=\"line\">                cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">plane</span>)</span>&#123;</span><br><span class=\"line\">                    plane.removeFromParent();</span><br><span class=\"line\">                &#125;,plane)</span><br><span class=\"line\">            )</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.npcs.push(plane);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    createBullet:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.state==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> sp = <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/logo.png&quot;</span>);</span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/click.wav&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> x = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).getPositionX();</span><br><span class=\"line\">            <span class=\"keyword\">var</span> y = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).getPositionY()+<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).height/<span class=\"number\">2</span>;</span><br><span class=\"line\">            sp.setPosition(x,y);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(sp);</span><br><span class=\"line\">            sp.setScale(<span class=\"number\">0.3</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-x,<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(cc.winSize.height+sp.height/<span class=\"number\">2</span>-y,<span class=\"number\">2</span>)))/<span class=\"number\">100</span>;</span><br><span class=\"line\">            sp.runAction(</span><br><span class=\"line\">                cc.spawn(</span><br><span class=\"line\">                    cc.rotateBy(time,<span class=\"number\">720</span>).repeatForever(),</span><br><span class=\"line\">                    cc.sequence(</span><br><span class=\"line\">                        cc.moveTo(time,x,cc.winSize.height+sp.height/<span class=\"number\">2</span>),</span><br><span class=\"line\">                        cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">sp</span>)</span>&#123;</span><br><span class=\"line\">                            sp.removeFromParent();</span><br><span class=\"line\">                        &#125;,sp)</span><br><span class=\"line\">                    )</span><br><span class=\"line\">                )</span><br><span class=\"line\">            );</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.bullets.push(sp);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        cc.eventManager.addListener(&#123;</span><br><span class=\"line\">            event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">            swallowTouches:<span class=\"literal\">true</span>,</span><br><span class=\"line\">            onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">            onTouchMoved:<span class=\"built_in\">this</span>.touchMoved,</span><br><span class=\"line\">            onTouchEnded:<span class=\"built_in\">this</span>.touchEnded</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        cc.audioEngine.playMusic(<span class=\"string\">&quot;res/bg.mp3&quot;</span>,<span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        event.getCurrentTarget().state=<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocationX();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocationY();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> plane = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> time = <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(x-plane.getPositionX(),<span class=\"number\">2</span>)+<span class=\"built_in\">Math</span>.pow(y-plane.getPositionY(),<span class=\"number\">2</span>)))/<span class=\"number\">1000</span>;</span><br><span class=\"line\">        plane.stopAllActions(); </span><br><span class=\"line\">        plane.runAction(cc.moveTo(time,cc.p(x,y)));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchMoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x = touch.getLocationX();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> y = touch.getLocationY();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> plane = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        plane.stopAllActions(); </span><br><span class=\"line\">        plane.setPosition(x,y);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchEnded:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        event.getCurrentTarget().state=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> overTxt = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;Game Over&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        overTxt.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(overTxt);</span><br><span class=\"line\">        overTxt.runAction(</span><br><span class=\"line\">            cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.2</span>),cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">0.9</span>),cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1</span>))    </span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"keyword\">var</span> backMenu = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;再来一次&quot;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> HelloWorldScene());</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        backMenu.setPosition(overTxt.getPositionX(),overTxt.getPositionY()<span class=\"number\">-50</span>-backMenu.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(backMenu);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_05_03/066a65bf1bf65dcd589d18a33ad67990822843c1/\">http://www.cocoscvp.com/usercode/2016_05_03/066a65bf1bf65dcd589d18a33ad67990822843c1/</a></p>"},{"title":"CVP认证学习笔记--(何小成)026--数组的使用","date":"2016-05-29T02:35:00.000Z","_content":"### 概念\n本节讲解cocos2d-js中数组的使用，其实数组不是cocos特有的，这是js中的一种数据结构，与Java，C中的数组稍有不同，js中的数组能存储任意类型的元素，并且在声明时无需指定长度，与Java中的List的用法更相似。<!--more-->不过js中数组的强大，有时候也会为开发调试带来不少烦恼，使用时还是要注意符合规范。在cocos中，数组经常被用来存储渲染的Node对象，以方便管理，如前面我写到的打飞机，子弹就可以用数组来管理，每一帧的逻辑，都可以通过遍历子弹数组，来判断是否有子弹飞出屏幕或击中玩家飞机。\n### API\n数组常用的使用方法如下\n```javascript\n// shift:删除原数组第一项，并返回删除元素的值；如果数组为空则返回undefined \nvar a = [1,2,3,4,5];   \nvar b = a.shift(); //a:[2,3,4,5] b:1\n// unshift:将参数添加到原数组开头，并返回数组的长度 \nvar a = [1,2,3,4,5];   \nvar b = a.unshift(-2,-1); //a:[-2,-1,1,2,3,4,5] b:7   \n// pop:删除原数组最后一项，并返回删除元素的值；如果数组为空则返回undefined \nvar a = [1,2,3,4,5];   \nvar b = a.pop(); //a:[1,2,3,4] b:5  \n// push:将参数添加到原数组末尾，并返回数组的长度 \nvar a = [1,2,3,4,5];   \nvar b = a.push(6,7); //a:[1,2,3,4,5,6,7] b:7  \n// concat:返回一个新数组，是将参数添加到原数组中构成的 \nvar a = [1,2,3,4,5];   \nvar b = a.concat(6,7); //a:[1,2,3,4,5] b:[1,2,3,4,5,6,7]  \n// splice(start,deleteCount,val1,val2,...):从start位置开始删除deleteCount项，并从该位置起插入val1,val2,... \nvar a = [1,2,3,4,5];   \nvar b = a.splice(2,2,7,8,9); //a:[1,2,7,8,9,5] b:[3,4]   \nvar b = a.splice(0,1); //同shift   \na.splice(0,0,-2,-1); var b = a.length; //同unshift   \nvar b = a.splice(a.length-1,1); //同pop   \na.splice(a.length,0,6,7); var b = a.length; //同push  \n// reverse:将数组反序 \nvar a = [1,2,3,4,5];   \nvar b = a.reverse(); //a:[5,4,3,2,1] b:[5,4,3,2,1]  \n// sort(orderfunction):按指定的参数对数组进行排序 \nvar a = [1,2,3,4,5];   \nvar b = a.sort(); //a:[1,2,3,4,5] b:[1,2,3,4,5]  \n// slice(start,end):返回从原数组中指定开始下标到结束下标之间的项组成的新数组 \nvar a = [1,2,3,4,5];   \nvar b = a.slice(2,5); //a:[1,2,3,4,5] b:[3,4,5]  \n// join(separator):将数组的元素组起一个字符串，以separator为分隔符，省略的话则用默认用逗号为分隔符 \nvar a = [1,2,3,4,5];   \nvar b = a.join(\"|\"); //a:[1,2,3,4,5] b:\"1|2|3|4|5\"  \n```\n### 作业\n本节作业：\n本节要求掌握js中数组的使用，在作业中完成通过数组动态管理node对象\n作业代码实现如下：\n```javascript\nvar allnpc=new Array();//定义数组\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        var item01=new cc.MenuItemFont(\"添加元素\",this.callback,this);\n        var item02=new cc.MenuItemFont(\"删除元素\",this.callback,this);\n        item01.setPositionY(200);\n        item02.setPositionY(160);\n        item01.setTag(11);\n        item02.setTag(12);\n        var menu=new cc.Menu(item01,item02);\n        this.addChild(menu);\n        //         本章介绍了数组的使用\n        // 通过数组可以动态管理一组对象\n        // 作业要求\n        //   将这5个按钮对应于添加一个Node后将node显示\n        //      这是第N个节点\n        // 当删除某个Node后，将这个Node从屏幕移除     \n        var count = new cc.LabelTTF(\"数组共0个Node\",\"\",30);\n        count.setPosition(menu.getPositionX(),menu.getPositionY()+20);\n        this.addChild(count);\n        count.setTag(3);\n        return true;\n    },\n    callback:function(obj)\n    {  \n        var newobj=new cc.Sprite(\"res/logo.png\");\n        newobj.setPosition(Math.random()*cc.winSize.width,Math.random()*cc.winSize.height);\n        newobj.tag=allnpc.length+1;\n        switch(obj.getTag())\n        {\n            case 11:\n                allnpc.push(newobj);\n                this.addChild(newobj);\n                break;\n            case 12:\n                var oldobj = allnpc.pop();\n                this.removeChild(oldobj);\n                break;\n        }\n        this.getChildByTag(3).setString(\"数组共\"+allnpc.length+\"个Node\");\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_05_20/694a9a04efbc2d25a7a879cf2ac399a0e7ec46a2/","source":"_posts/CVP认证学习笔记--(何小成)026--数组的使用.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)026--数组的使用\ndate: 2016-05-29 10:35\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节讲解cocos2d-js中数组的使用，其实数组不是cocos特有的，这是js中的一种数据结构，与Java，C中的数组稍有不同，js中的数组能存储任意类型的元素，并且在声明时无需指定长度，与Java中的List的用法更相似。<!--more-->不过js中数组的强大，有时候也会为开发调试带来不少烦恼，使用时还是要注意符合规范。在cocos中，数组经常被用来存储渲染的Node对象，以方便管理，如前面我写到的打飞机，子弹就可以用数组来管理，每一帧的逻辑，都可以通过遍历子弹数组，来判断是否有子弹飞出屏幕或击中玩家飞机。\n### API\n数组常用的使用方法如下\n```javascript\n// shift:删除原数组第一项，并返回删除元素的值；如果数组为空则返回undefined \nvar a = [1,2,3,4,5];   \nvar b = a.shift(); //a:[2,3,4,5] b:1\n// unshift:将参数添加到原数组开头，并返回数组的长度 \nvar a = [1,2,3,4,5];   \nvar b = a.unshift(-2,-1); //a:[-2,-1,1,2,3,4,5] b:7   \n// pop:删除原数组最后一项，并返回删除元素的值；如果数组为空则返回undefined \nvar a = [1,2,3,4,5];   \nvar b = a.pop(); //a:[1,2,3,4] b:5  \n// push:将参数添加到原数组末尾，并返回数组的长度 \nvar a = [1,2,3,4,5];   \nvar b = a.push(6,7); //a:[1,2,3,4,5,6,7] b:7  \n// concat:返回一个新数组，是将参数添加到原数组中构成的 \nvar a = [1,2,3,4,5];   \nvar b = a.concat(6,7); //a:[1,2,3,4,5] b:[1,2,3,4,5,6,7]  \n// splice(start,deleteCount,val1,val2,...):从start位置开始删除deleteCount项，并从该位置起插入val1,val2,... \nvar a = [1,2,3,4,5];   \nvar b = a.splice(2,2,7,8,9); //a:[1,2,7,8,9,5] b:[3,4]   \nvar b = a.splice(0,1); //同shift   \na.splice(0,0,-2,-1); var b = a.length; //同unshift   \nvar b = a.splice(a.length-1,1); //同pop   \na.splice(a.length,0,6,7); var b = a.length; //同push  \n// reverse:将数组反序 \nvar a = [1,2,3,4,5];   \nvar b = a.reverse(); //a:[5,4,3,2,1] b:[5,4,3,2,1]  \n// sort(orderfunction):按指定的参数对数组进行排序 \nvar a = [1,2,3,4,5];   \nvar b = a.sort(); //a:[1,2,3,4,5] b:[1,2,3,4,5]  \n// slice(start,end):返回从原数组中指定开始下标到结束下标之间的项组成的新数组 \nvar a = [1,2,3,4,5];   \nvar b = a.slice(2,5); //a:[1,2,3,4,5] b:[3,4,5]  \n// join(separator):将数组的元素组起一个字符串，以separator为分隔符，省略的话则用默认用逗号为分隔符 \nvar a = [1,2,3,4,5];   \nvar b = a.join(\"|\"); //a:[1,2,3,4,5] b:\"1|2|3|4|5\"  \n```\n### 作业\n本节作业：\n本节要求掌握js中数组的使用，在作业中完成通过数组动态管理node对象\n作业代码实现如下：\n```javascript\nvar allnpc=new Array();//定义数组\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        var item01=new cc.MenuItemFont(\"添加元素\",this.callback,this);\n        var item02=new cc.MenuItemFont(\"删除元素\",this.callback,this);\n        item01.setPositionY(200);\n        item02.setPositionY(160);\n        item01.setTag(11);\n        item02.setTag(12);\n        var menu=new cc.Menu(item01,item02);\n        this.addChild(menu);\n        //         本章介绍了数组的使用\n        // 通过数组可以动态管理一组对象\n        // 作业要求\n        //   将这5个按钮对应于添加一个Node后将node显示\n        //      这是第N个节点\n        // 当删除某个Node后，将这个Node从屏幕移除     \n        var count = new cc.LabelTTF(\"数组共0个Node\",\"\",30);\n        count.setPosition(menu.getPositionX(),menu.getPositionY()+20);\n        this.addChild(count);\n        count.setTag(3);\n        return true;\n    },\n    callback:function(obj)\n    {  \n        var newobj=new cc.Sprite(\"res/logo.png\");\n        newobj.setPosition(Math.random()*cc.winSize.width,Math.random()*cc.winSize.height);\n        newobj.tag=allnpc.length+1;\n        switch(obj.getTag())\n        {\n            case 11:\n                allnpc.push(newobj);\n                this.addChild(newobj);\n                break;\n            case 12:\n                var oldobj = allnpc.pop();\n                this.removeChild(oldobj);\n                break;\n        }\n        this.getChildByTag(3).setString(\"数组共\"+allnpc.length+\"个Node\");\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_05_20/694a9a04efbc2d25a7a879cf2ac399a0e7ec46a2/","slug":"CVP认证学习笔记--(何小成)026--数组的使用","published":1,"updated":"2016-05-29T02:35:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhup0025wsaz5cpu5bet","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节讲解cocos2d-js中数组的使用，其实数组不是cocos特有的，这是js中的一种数据结构，与Java，C中的数组稍有不同，js中的数组能存储任意类型的元素，并且在声明时无需指定长度，与Java中的List的用法更相似。<a id=\"more\"></a>不过js中数组的强大，有时候也会为开发调试带来不少烦恼，使用时还是要注意符合规范。在cocos中，数组经常被用来存储渲染的Node对象，以方便管理，如前面我写到的打飞机，子弹就可以用数组来管理，每一帧的逻辑，都可以通过遍历子弹数组，来判断是否有子弹飞出屏幕或击中玩家飞机。</p>\n<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>数组常用的使用方法如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// shift:删除原数组第一项，并返回删除元素的值；如果数组为空则返回undefined </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.shift(); <span class=\"comment\">//a:[2,3,4,5] b:1</span></span><br><span class=\"line\"><span class=\"comment\">// unshift:将参数添加到原数组开头，并返回数组的长度 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.unshift(<span class=\"number\">-2</span>,<span class=\"number\">-1</span>); <span class=\"comment\">//a:[-2,-1,1,2,3,4,5] b:7   </span></span><br><span class=\"line\"><span class=\"comment\">// pop:删除原数组最后一项，并返回删除元素的值；如果数组为空则返回undefined </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.pop(); <span class=\"comment\">//a:[1,2,3,4] b:5  </span></span><br><span class=\"line\"><span class=\"comment\">// push:将参数添加到原数组末尾，并返回数组的长度 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.push(<span class=\"number\">6</span>,<span class=\"number\">7</span>); <span class=\"comment\">//a:[1,2,3,4,5,6,7] b:7  </span></span><br><span class=\"line\"><span class=\"comment\">// concat:返回一个新数组，是将参数添加到原数组中构成的 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.concat(<span class=\"number\">6</span>,<span class=\"number\">7</span>); <span class=\"comment\">//a:[1,2,3,4,5] b:[1,2,3,4,5,6,7]  </span></span><br><span class=\"line\"><span class=\"comment\">// splice(start,deleteCount,val1,val2,...):从start位置开始删除deleteCount项，并从该位置起插入val1,val2,... </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.splice(<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>); <span class=\"comment\">//a:[1,2,7,8,9,5] b:[3,4]   </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.splice(<span class=\"number\">0</span>,<span class=\"number\">1</span>); <span class=\"comment\">//同shift   </span></span><br><span class=\"line\">a.splice(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">-2</span>,<span class=\"number\">-1</span>); <span class=\"keyword\">var</span> b = a.length; <span class=\"comment\">//同unshift   </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.splice(a.length<span class=\"number\">-1</span>,<span class=\"number\">1</span>); <span class=\"comment\">//同pop   </span></span><br><span class=\"line\">a.splice(a.length,<span class=\"number\">0</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>); <span class=\"keyword\">var</span> b = a.length; <span class=\"comment\">//同push  </span></span><br><span class=\"line\"><span class=\"comment\">// reverse:将数组反序 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.reverse(); <span class=\"comment\">//a:[5,4,3,2,1] b:[5,4,3,2,1]  </span></span><br><span class=\"line\"><span class=\"comment\">// sort(orderfunction):按指定的参数对数组进行排序 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.sort(); <span class=\"comment\">//a:[1,2,3,4,5] b:[1,2,3,4,5]  </span></span><br><span class=\"line\"><span class=\"comment\">// slice(start,end):返回从原数组中指定开始下标到结束下标之间的项组成的新数组 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.slice(<span class=\"number\">2</span>,<span class=\"number\">5</span>); <span class=\"comment\">//a:[1,2,3,4,5] b:[3,4,5]  </span></span><br><span class=\"line\"><span class=\"comment\">// join(separator):将数组的元素组起一个字符串，以separator为分隔符，省略的话则用默认用逗号为分隔符 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.join(<span class=\"string\">&quot;|&quot;</span>); <span class=\"comment\">//a:[1,2,3,4,5] b:&quot;1|2|3|4|5&quot;  </span></span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：<br>本节要求掌握js中数组的使用，在作业中完成通过数组动态管理node对象<br>作业代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> allnpc=<span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();<span class=\"comment\">//定义数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> item01=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;添加元素&quot;</span>,<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> item02=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;删除元素&quot;</span>,<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        item01.setPositionY(<span class=\"number\">200</span>);</span><br><span class=\"line\">        item02.setPositionY(<span class=\"number\">160</span>);</span><br><span class=\"line\">        item01.setTag(<span class=\"number\">11</span>);</span><br><span class=\"line\">        item02.setTag(<span class=\"number\">12</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(item01,item02);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"comment\">//         本章介绍了数组的使用</span></span><br><span class=\"line\">        <span class=\"comment\">// 通过数组可以动态管理一组对象</span></span><br><span class=\"line\">        <span class=\"comment\">// 作业要求</span></span><br><span class=\"line\">        <span class=\"comment\">//   将这5个按钮对应于添加一个Node后将node显示</span></span><br><span class=\"line\">        <span class=\"comment\">//      这是第N个节点</span></span><br><span class=\"line\">        <span class=\"comment\">// 当删除某个Node后，将这个Node从屏幕移除     </span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> count = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;数组共0个Node&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">30</span>);</span><br><span class=\"line\">        count.setPosition(menu.getPositionX(),menu.getPositionY()+<span class=\"number\">20</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(count);</span><br><span class=\"line\">        count.setTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;  </span><br><span class=\"line\">        <span class=\"keyword\">var</span> newobj=<span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/logo.png&quot;</span>);</span><br><span class=\"line\">        newobj.setPosition(<span class=\"built_in\">Math</span>.random()*cc.winSize.width,<span class=\"built_in\">Math</span>.random()*cc.winSize.height);</span><br><span class=\"line\">        newobj.tag=allnpc.length+<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(obj.getTag())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">11</span>:</span><br><span class=\"line\">                allnpc.push(newobj);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.addChild(newobj);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">12</span>:</span><br><span class=\"line\">                <span class=\"keyword\">var</span> oldobj = allnpc.pop();</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.removeChild(oldobj);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">3</span>).setString(<span class=\"string\">&quot;数组共&quot;</span>+allnpc.length+<span class=\"string\">&quot;个Node&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_05_20/694a9a04efbc2d25a7a879cf2ac399a0e7ec46a2/\">http://www.cocoscvp.com/usercode/2016_05_20/694a9a04efbc2d25a7a879cf2ac399a0e7ec46a2/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节讲解cocos2d-js中数组的使用，其实数组不是cocos特有的，这是js中的一种数据结构，与Java，C中的数组稍有不同，js中的数组能存储任意类型的元素，并且在声明时无需指定长度，与Java中的List的用法更相似。","more":"不过js中数组的强大，有时候也会为开发调试带来不少烦恼，使用时还是要注意符合规范。在cocos中，数组经常被用来存储渲染的Node对象，以方便管理，如前面我写到的打飞机，子弹就可以用数组来管理，每一帧的逻辑，都可以通过遍历子弹数组，来判断是否有子弹飞出屏幕或击中玩家飞机。</p>\n<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>数组常用的使用方法如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// shift:删除原数组第一项，并返回删除元素的值；如果数组为空则返回undefined </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.shift(); <span class=\"comment\">//a:[2,3,4,5] b:1</span></span><br><span class=\"line\"><span class=\"comment\">// unshift:将参数添加到原数组开头，并返回数组的长度 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.unshift(<span class=\"number\">-2</span>,<span class=\"number\">-1</span>); <span class=\"comment\">//a:[-2,-1,1,2,3,4,5] b:7   </span></span><br><span class=\"line\"><span class=\"comment\">// pop:删除原数组最后一项，并返回删除元素的值；如果数组为空则返回undefined </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.pop(); <span class=\"comment\">//a:[1,2,3,4] b:5  </span></span><br><span class=\"line\"><span class=\"comment\">// push:将参数添加到原数组末尾，并返回数组的长度 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.push(<span class=\"number\">6</span>,<span class=\"number\">7</span>); <span class=\"comment\">//a:[1,2,3,4,5,6,7] b:7  </span></span><br><span class=\"line\"><span class=\"comment\">// concat:返回一个新数组，是将参数添加到原数组中构成的 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.concat(<span class=\"number\">6</span>,<span class=\"number\">7</span>); <span class=\"comment\">//a:[1,2,3,4,5] b:[1,2,3,4,5,6,7]  </span></span><br><span class=\"line\"><span class=\"comment\">// splice(start,deleteCount,val1,val2,...):从start位置开始删除deleteCount项，并从该位置起插入val1,val2,... </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.splice(<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>); <span class=\"comment\">//a:[1,2,7,8,9,5] b:[3,4]   </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.splice(<span class=\"number\">0</span>,<span class=\"number\">1</span>); <span class=\"comment\">//同shift   </span></span><br><span class=\"line\">a.splice(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">-2</span>,<span class=\"number\">-1</span>); <span class=\"keyword\">var</span> b = a.length; <span class=\"comment\">//同unshift   </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.splice(a.length<span class=\"number\">-1</span>,<span class=\"number\">1</span>); <span class=\"comment\">//同pop   </span></span><br><span class=\"line\">a.splice(a.length,<span class=\"number\">0</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>); <span class=\"keyword\">var</span> b = a.length; <span class=\"comment\">//同push  </span></span><br><span class=\"line\"><span class=\"comment\">// reverse:将数组反序 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.reverse(); <span class=\"comment\">//a:[5,4,3,2,1] b:[5,4,3,2,1]  </span></span><br><span class=\"line\"><span class=\"comment\">// sort(orderfunction):按指定的参数对数组进行排序 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.sort(); <span class=\"comment\">//a:[1,2,3,4,5] b:[1,2,3,4,5]  </span></span><br><span class=\"line\"><span class=\"comment\">// slice(start,end):返回从原数组中指定开始下标到结束下标之间的项组成的新数组 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.slice(<span class=\"number\">2</span>,<span class=\"number\">5</span>); <span class=\"comment\">//a:[1,2,3,4,5] b:[3,4,5]  </span></span><br><span class=\"line\"><span class=\"comment\">// join(separator):将数组的元素组起一个字符串，以separator为分隔符，省略的话则用默认用逗号为分隔符 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];   </span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a.join(<span class=\"string\">&quot;|&quot;</span>); <span class=\"comment\">//a:[1,2,3,4,5] b:&quot;1|2|3|4|5&quot;  </span></span><br></pre></td></tr></table></figure>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：<br>本节要求掌握js中数组的使用，在作业中完成通过数组动态管理node对象<br>作业代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> allnpc=<span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();<span class=\"comment\">//定义数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> item01=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;添加元素&quot;</span>,<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> item02=<span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;删除元素&quot;</span>,<span class=\"built_in\">this</span>.callback,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        item01.setPositionY(<span class=\"number\">200</span>);</span><br><span class=\"line\">        item02.setPositionY(<span class=\"number\">160</span>);</span><br><span class=\"line\">        item01.setTag(<span class=\"number\">11</span>);</span><br><span class=\"line\">        item02.setTag(<span class=\"number\">12</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu=<span class=\"keyword\">new</span> cc.Menu(item01,item02);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"comment\">//         本章介绍了数组的使用</span></span><br><span class=\"line\">        <span class=\"comment\">// 通过数组可以动态管理一组对象</span></span><br><span class=\"line\">        <span class=\"comment\">// 作业要求</span></span><br><span class=\"line\">        <span class=\"comment\">//   将这5个按钮对应于添加一个Node后将node显示</span></span><br><span class=\"line\">        <span class=\"comment\">//      这是第N个节点</span></span><br><span class=\"line\">        <span class=\"comment\">// 当删除某个Node后，将这个Node从屏幕移除     </span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> count = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;数组共0个Node&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"number\">30</span>);</span><br><span class=\"line\">        count.setPosition(menu.getPositionX(),menu.getPositionY()+<span class=\"number\">20</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(count);</span><br><span class=\"line\">        count.setTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    callback:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;  </span><br><span class=\"line\">        <span class=\"keyword\">var</span> newobj=<span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/logo.png&quot;</span>);</span><br><span class=\"line\">        newobj.setPosition(<span class=\"built_in\">Math</span>.random()*cc.winSize.width,<span class=\"built_in\">Math</span>.random()*cc.winSize.height);</span><br><span class=\"line\">        newobj.tag=allnpc.length+<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(obj.getTag())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">11</span>:</span><br><span class=\"line\">                allnpc.push(newobj);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.addChild(newobj);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">12</span>:</span><br><span class=\"line\">                <span class=\"keyword\">var</span> oldobj = allnpc.pop();</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.removeChild(oldobj);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">3</span>).setString(<span class=\"string\">&quot;数组共&quot;</span>+allnpc.length+<span class=\"string\">&quot;个Node&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_05_20/694a9a04efbc2d25a7a879cf2ac399a0e7ec46a2/\">http://www.cocoscvp.com/usercode/2016_05_20/694a9a04efbc2d25a7a879cf2ac399a0e7ec46a2/</a></p>"},{"title":"CVP认证学习笔记--(何小成)027--纹理缓存的管理","date":"2016-06-02T15:39:00.000Z","_content":"### 概念\n本节内容主要讲解两个知识点，纹理缓存的管理和cocos的场景加载动画。纹理缓存管理可以通过cc.TextureCache来进行管理，而场景加载动画则在源码中的/frameworks/cocos2d-html5/cocos2d/core/scenes/CCLoaderScene.js中<!--more-->，在CCLoaderScene中定义了场景加载的相关方法。\n### API\ncc.TextureCache的使用API在官网的文档地址是：http://www.cocos.com/doc/jsdoc/symbols/cc.textureCache.html\n其主要API如下：\n```javascript\naddImage(path);// 添加一个纹理到缓存\ndumpCachedTextureInfo();// 把当前TextureCache的内容输出到cc.log,它会计算每个贴图的大小和贴图总共占用的内存\ngetTextureForKey(textureKeyName);// 返回创建好的贴图。如果贴图不存在，返回空。\nremoveAllTextures();// 清空加载贴图的字典，如果你收到“内存警告”时请调用此方法短期来看:释放某些资源，防止app出现闪退,在中期:会分配更多的资源,长远来看:没有什么区别\nremoveTexture(texture);// 从缓存中删除指定的贴图\nremoveTextureForKey(textureKeyName);// 从缓存中根据给定的key删除贴图textureForKey(textureKeyName);// 返回创建好的贴图。如果贴图不存在，返回空。\n```\n### loading场景\ncocos本身的loading场景在/frameworks/cocos2d-html5/cocos2d/core/scenes/CCLoaderScene.js中，而如果我们想要自己实现loading场景，要么在这个类的基础上直接改，要么写一个自己的loading场景，然后在main.js中把加载系统的loading场景改为加载我们自己的loading场景，仔细研究这个CCLoaderScene，其实发现它也没有做多么伟大的事情，其实也就是比普通的场景多做一件事而已，那就是加载资源，通过init的函数，加载一些变量，如loading文本，百分数的进度等，然后调用一个定时任务，定期更新进度文本，定时任务中通过调用cc.loader函数检查资源加载的进度，加载完成之后，再进入主场景。\n### 作业\n本节作业：\n本节作业要求\n// 本节课介绍了loading 的原理和系统源码\n// 并深入介绍了cc.textureCache的核心用法\n// 作业要求\n// 实现一个自定义 loading效果（如果需要图片可以通过提交项目方式完成）\n// 当loading 完成之后\n// 清除loading界面的所有纹理 \n我在代码中实现了自建loading场景，写在了app.js中，并在loading场景中添加了一个移动的npc来模拟加载进度条，并且npc的纹理通过textureCache来管理，进度条加载完之后，通过textureCache移除场景中所有的纹理（其实只有npc的纹理）\n作业代码实现如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        //这时候，在src/resource.js中定义的图片数组都已经保存到了\n        //cc.TextureCache中，因此我们可以直接从这里获取纹理\n        cc.textureCache.addImage(\"res/32636-2.png\");\n        var texture1=cc.textureCache.getTextureForKey(\"res/32636-2.png\");\n        cc.textureCache.dumpCachedTextureInfo();\n        var sp=new cc.Sprite(texture1);\n        this.addChild(sp);\n        sp.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        // 本节课介绍了loading 的原理和系统源码\n        // 并深入介绍了cc.textureCache的核心用法\n        // 作业要求\n        // 实现一个自定义 loading效果（如果需要图片可以通过提交项目方式完成）\n        // 当loading 完成之后\n        // 清除loading界面的所有纹理        \n        return true;\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n\n// 自定义loading界面\nvar MyLoadScene = cc.Scene.extend({\n    _interval : null,\n    _label : null,\n    _npc:null,\n    _className:\"LoaderScene\",\n    cb: null,\n    target: null,\n    npc:null,\n    /**\n     * Contructor of cc.LoaderScene\n     * @returns {boolean}\n     */\n    init : function(){\n        var self = this;\n\n        //logo\n        var logoWidth = 160;\n        var logoHeight = 200;\n\n        // bg\n        var bgLayer = self._bgLayer = new cc.LayerColor(cc.color(32, 255, 32, 255));\n        self.addChild(bgLayer, 0);\n\n        //image move to CCSceneFile.js\n        var fontSize = 24, lblHeight =  -logoHeight / 2 + 100;\n        if(cc._loaderImage){//这个图片在Base64Image中保存，我们可以替换\n            //loading logo\n            cc.loader.loadImg(cc._loaderImage, {isCrossOrigin : false }, function(err, img){\n                logoWidth = img.width;\n                logoHeight = img.height;\n                self._initStage(img, cc.visibleRect.center);\n            });\n            fontSize = 14;\n            lblHeight = -logoHeight / 2 - 10;\n        }\n        //loading percent 加载进度\n        var label = self._label = new cc.LabelTTF(\"Loading... 0%\", \"Arial\", fontSize);\n        label.setPosition(cc.pAdd(cc.visibleRect.center, cc.p(0, lblHeight)));\n        label.setColor(cc.color(180, 180, 180));\n        bgLayer.addChild(this._label, 10);\n        // 自定义npc\n        cc.textureCache.addImage(\"res/32636-2.png\");\n        cc.textureCache.dumpCachedTextureInfo();\n        cc.log(\"loading界面添加纹理32636-2\");\n        var npcTexture = cc.textureCache.getTextureForKey(\"res/32636-2.png\");\n        var npc = self._npc = new cc.Sprite(npcTexture);\n        npc.setPosition(npc.width/2,150);\n        npc.setScale(0.5);\n        this._bgLayer.addChild(this._npc,10);\n        return true;\n    },\n      _initStage: function (img, centerPos) {\n        var self = this;\n        var texture2d = self._texture2d = new cc.Texture2D();\n        texture2d.initWithElement(img);\n        texture2d.handleLoadedTexture();\n        var logo = self._logo = new cc.Sprite(texture2d);\n        logo.setScale(cc.contentScaleFactor());\n        logo.x = centerPos.x;\n        logo.y = centerPos.y;\n        self._bgLayer.addChild(logo, 10);\n    },\n    /**\n     * custom onEnter\n     */\n    onEnter: function () {\n        var self = this;\n        cc.Node.prototype.onEnter.call(self);\n        self.schedule(self._startLoading, 0.3);\n    },\n    /**\n     * custom onExit\n     */\n    onExit: function () {\n        cc.Node.prototype.onExit.call(this);\n        var tmpStr = \"Loading... 100%\";\n        this._label.setString(tmpStr);\n        // 清理缓存\n        cc.textureCache.removeAllTextures();\n        cc.textureCache.dumpCachedTextureInfo();\n        cc.log(\"loading界面结束，清理纹理缓存\");\n    },\n\n    /**\n     * init with resources\n     * @param {Array} resources\n     * @param {Function|String} cb\n     * @param {Object} target\n     */\n    initWithResources: function (resources, cb, target) {\n        if(cc.isString(resources))\n            resources = [resources];\n        this.resources = resources || [];\n        this.cb = cb;\n        this.target = target;\n    },\n\n    _startLoading: function () {\n        var self = this;\n        self.unschedule(self._startLoading);\n        var res = self.resources;\n        cc.loader.load(res,\n            function (result, count, loadedCount) {\n                var percent = (loadedCount / count * 100) | 0;\n                percent = Math.min(percent, 100);\n                self._label.setString(\"Loading... \" + percent + \"%\");\n                self._npc.setPositionX(self._npc.width/2+cc.winSize.width*(percent/100));\n                cc.log(\"loading界面npc走到了\"+percent+\",横坐标\"+(self._npc.width/2+cc.winSize.width*(percent/100))+\"\");\n            }, function () {\n                if (self.cb)\n                    self.cb.call(self.target);\n            });\n    },\n\n    _updateTransform: function(){\n        this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);\n        this._bgLayer._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);\n        this._label._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);\n        this._logo._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);\n    }\n});\n\nMyLoadScene.preload = function(resources, cb, target){\n    var _cc = cc;\n    if(!_cc.loaderScene) {\n        _cc.loaderScene = new MyLoadScene();\n        _cc.loaderScene.init();\n        cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED, function(){\n            _cc.loaderScene._updateTransform();\n        });\n    }\n    //调用initWithResources来实现纹理加载\n    _cc.loaderScene.initWithResources(resources, cb, target);\n    cc.director.runScene(_cc.loaderScene);\n    return _cc.loaderScene;\n};\n```\n其中main.js加载场景的代码修改如下：\n```javascript\n//load resources\n// cc.LoaderScene.preload(g_resources, function () {\n//     cc.director.runScene(new HelloWorldScene());\n// }, this);\nMyLoadScene.preload(g_resources, function () {\n    cc.director.runScene(new HelloWorldScene());\n}, this);\n```\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_05_20/55df2e8d114fce1f48d1151065951e865d56b92c/","source":"_posts/CVP认证学习笔记--(何小成)027--纹理缓存的管理.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)027--纹理缓存的管理\ndate: 2016-06-02 23:39\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节内容主要讲解两个知识点，纹理缓存的管理和cocos的场景加载动画。纹理缓存管理可以通过cc.TextureCache来进行管理，而场景加载动画则在源码中的/frameworks/cocos2d-html5/cocos2d/core/scenes/CCLoaderScene.js中<!--more-->，在CCLoaderScene中定义了场景加载的相关方法。\n### API\ncc.TextureCache的使用API在官网的文档地址是：http://www.cocos.com/doc/jsdoc/symbols/cc.textureCache.html\n其主要API如下：\n```javascript\naddImage(path);// 添加一个纹理到缓存\ndumpCachedTextureInfo();// 把当前TextureCache的内容输出到cc.log,它会计算每个贴图的大小和贴图总共占用的内存\ngetTextureForKey(textureKeyName);// 返回创建好的贴图。如果贴图不存在，返回空。\nremoveAllTextures();// 清空加载贴图的字典，如果你收到“内存警告”时请调用此方法短期来看:释放某些资源，防止app出现闪退,在中期:会分配更多的资源,长远来看:没有什么区别\nremoveTexture(texture);// 从缓存中删除指定的贴图\nremoveTextureForKey(textureKeyName);// 从缓存中根据给定的key删除贴图textureForKey(textureKeyName);// 返回创建好的贴图。如果贴图不存在，返回空。\n```\n### loading场景\ncocos本身的loading场景在/frameworks/cocos2d-html5/cocos2d/core/scenes/CCLoaderScene.js中，而如果我们想要自己实现loading场景，要么在这个类的基础上直接改，要么写一个自己的loading场景，然后在main.js中把加载系统的loading场景改为加载我们自己的loading场景，仔细研究这个CCLoaderScene，其实发现它也没有做多么伟大的事情，其实也就是比普通的场景多做一件事而已，那就是加载资源，通过init的函数，加载一些变量，如loading文本，百分数的进度等，然后调用一个定时任务，定期更新进度文本，定时任务中通过调用cc.loader函数检查资源加载的进度，加载完成之后，再进入主场景。\n### 作业\n本节作业：\n本节作业要求\n// 本节课介绍了loading 的原理和系统源码\n// 并深入介绍了cc.textureCache的核心用法\n// 作业要求\n// 实现一个自定义 loading效果（如果需要图片可以通过提交项目方式完成）\n// 当loading 完成之后\n// 清除loading界面的所有纹理 \n我在代码中实现了自建loading场景，写在了app.js中，并在loading场景中添加了一个移动的npc来模拟加载进度条，并且npc的纹理通过textureCache来管理，进度条加载完之后，通过textureCache移除场景中所有的纹理（其实只有npc的纹理）\n作业代码实现如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n        //这时候，在src/resource.js中定义的图片数组都已经保存到了\n        //cc.TextureCache中，因此我们可以直接从这里获取纹理\n        cc.textureCache.addImage(\"res/32636-2.png\");\n        var texture1=cc.textureCache.getTextureForKey(\"res/32636-2.png\");\n        cc.textureCache.dumpCachedTextureInfo();\n        var sp=new cc.Sprite(texture1);\n        this.addChild(sp);\n        sp.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        // 本节课介绍了loading 的原理和系统源码\n        // 并深入介绍了cc.textureCache的核心用法\n        // 作业要求\n        // 实现一个自定义 loading效果（如果需要图片可以通过提交项目方式完成）\n        // 当loading 完成之后\n        // 清除loading界面的所有纹理        \n        return true;\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n\n// 自定义loading界面\nvar MyLoadScene = cc.Scene.extend({\n    _interval : null,\n    _label : null,\n    _npc:null,\n    _className:\"LoaderScene\",\n    cb: null,\n    target: null,\n    npc:null,\n    /**\n     * Contructor of cc.LoaderScene\n     * @returns {boolean}\n     */\n    init : function(){\n        var self = this;\n\n        //logo\n        var logoWidth = 160;\n        var logoHeight = 200;\n\n        // bg\n        var bgLayer = self._bgLayer = new cc.LayerColor(cc.color(32, 255, 32, 255));\n        self.addChild(bgLayer, 0);\n\n        //image move to CCSceneFile.js\n        var fontSize = 24, lblHeight =  -logoHeight / 2 + 100;\n        if(cc._loaderImage){//这个图片在Base64Image中保存，我们可以替换\n            //loading logo\n            cc.loader.loadImg(cc._loaderImage, {isCrossOrigin : false }, function(err, img){\n                logoWidth = img.width;\n                logoHeight = img.height;\n                self._initStage(img, cc.visibleRect.center);\n            });\n            fontSize = 14;\n            lblHeight = -logoHeight / 2 - 10;\n        }\n        //loading percent 加载进度\n        var label = self._label = new cc.LabelTTF(\"Loading... 0%\", \"Arial\", fontSize);\n        label.setPosition(cc.pAdd(cc.visibleRect.center, cc.p(0, lblHeight)));\n        label.setColor(cc.color(180, 180, 180));\n        bgLayer.addChild(this._label, 10);\n        // 自定义npc\n        cc.textureCache.addImage(\"res/32636-2.png\");\n        cc.textureCache.dumpCachedTextureInfo();\n        cc.log(\"loading界面添加纹理32636-2\");\n        var npcTexture = cc.textureCache.getTextureForKey(\"res/32636-2.png\");\n        var npc = self._npc = new cc.Sprite(npcTexture);\n        npc.setPosition(npc.width/2,150);\n        npc.setScale(0.5);\n        this._bgLayer.addChild(this._npc,10);\n        return true;\n    },\n      _initStage: function (img, centerPos) {\n        var self = this;\n        var texture2d = self._texture2d = new cc.Texture2D();\n        texture2d.initWithElement(img);\n        texture2d.handleLoadedTexture();\n        var logo = self._logo = new cc.Sprite(texture2d);\n        logo.setScale(cc.contentScaleFactor());\n        logo.x = centerPos.x;\n        logo.y = centerPos.y;\n        self._bgLayer.addChild(logo, 10);\n    },\n    /**\n     * custom onEnter\n     */\n    onEnter: function () {\n        var self = this;\n        cc.Node.prototype.onEnter.call(self);\n        self.schedule(self._startLoading, 0.3);\n    },\n    /**\n     * custom onExit\n     */\n    onExit: function () {\n        cc.Node.prototype.onExit.call(this);\n        var tmpStr = \"Loading... 100%\";\n        this._label.setString(tmpStr);\n        // 清理缓存\n        cc.textureCache.removeAllTextures();\n        cc.textureCache.dumpCachedTextureInfo();\n        cc.log(\"loading界面结束，清理纹理缓存\");\n    },\n\n    /**\n     * init with resources\n     * @param {Array} resources\n     * @param {Function|String} cb\n     * @param {Object} target\n     */\n    initWithResources: function (resources, cb, target) {\n        if(cc.isString(resources))\n            resources = [resources];\n        this.resources = resources || [];\n        this.cb = cb;\n        this.target = target;\n    },\n\n    _startLoading: function () {\n        var self = this;\n        self.unschedule(self._startLoading);\n        var res = self.resources;\n        cc.loader.load(res,\n            function (result, count, loadedCount) {\n                var percent = (loadedCount / count * 100) | 0;\n                percent = Math.min(percent, 100);\n                self._label.setString(\"Loading... \" + percent + \"%\");\n                self._npc.setPositionX(self._npc.width/2+cc.winSize.width*(percent/100));\n                cc.log(\"loading界面npc走到了\"+percent+\",横坐标\"+(self._npc.width/2+cc.winSize.width*(percent/100))+\"\");\n            }, function () {\n                if (self.cb)\n                    self.cb.call(self.target);\n            });\n    },\n\n    _updateTransform: function(){\n        this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);\n        this._bgLayer._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);\n        this._label._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);\n        this._logo._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);\n    }\n});\n\nMyLoadScene.preload = function(resources, cb, target){\n    var _cc = cc;\n    if(!_cc.loaderScene) {\n        _cc.loaderScene = new MyLoadScene();\n        _cc.loaderScene.init();\n        cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED, function(){\n            _cc.loaderScene._updateTransform();\n        });\n    }\n    //调用initWithResources来实现纹理加载\n    _cc.loaderScene.initWithResources(resources, cb, target);\n    cc.director.runScene(_cc.loaderScene);\n    return _cc.loaderScene;\n};\n```\n其中main.js加载场景的代码修改如下：\n```javascript\n//load resources\n// cc.LoaderScene.preload(g_resources, function () {\n//     cc.director.runScene(new HelloWorldScene());\n// }, this);\nMyLoadScene.preload(g_resources, function () {\n    cc.director.runScene(new HelloWorldScene());\n}, this);\n```\n### 最终效果\nhttp://www.cocoscvp.com/usercode/2016_05_20/55df2e8d114fce1f48d1151065951e865d56b92c/","slug":"CVP认证学习笔记--(何小成)027--纹理缓存的管理","published":1,"updated":"2016-06-02T16:09:44.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhuq0029wsazgtab1udd","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节内容主要讲解两个知识点，纹理缓存的管理和cocos的场景加载动画。纹理缓存管理可以通过cc.TextureCache来进行管理，而场景加载动画则在源码中的/frameworks/cocos2d-html5/cocos2d/core/scenes/CCLoaderScene.js中<a id=\"more\"></a>，在CCLoaderScene中定义了场景加载的相关方法。</p>\n<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>cc.TextureCache的使用API在官网的文档地址是：<a href=\"http://www.cocos.com/doc/jsdoc/symbols/cc.textureCache.html\">http://www.cocos.com/doc/jsdoc/symbols/cc.textureCache.html</a><br>其主要API如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addImage(path);<span class=\"comment\">// 添加一个纹理到缓存</span></span><br><span class=\"line\">dumpCachedTextureInfo();<span class=\"comment\">// 把当前TextureCache的内容输出到cc.log,它会计算每个贴图的大小和贴图总共占用的内存</span></span><br><span class=\"line\">getTextureForKey(textureKeyName);<span class=\"comment\">// 返回创建好的贴图。如果贴图不存在，返回空。</span></span><br><span class=\"line\">removeAllTextures();<span class=\"comment\">// 清空加载贴图的字典，如果你收到“内存警告”时请调用此方法短期来看:释放某些资源，防止app出现闪退,在中期:会分配更多的资源,长远来看:没有什么区别</span></span><br><span class=\"line\">removeTexture(texture);<span class=\"comment\">// 从缓存中删除指定的贴图</span></span><br><span class=\"line\">removeTextureForKey(textureKeyName);<span class=\"comment\">// 从缓存中根据给定的key删除贴图textureForKey(textureKeyName);// 返回创建好的贴图。如果贴图不存在，返回空。</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"loading场景\"><a href=\"#loading场景\" class=\"headerlink\" title=\"loading场景\"></a>loading场景</h3><p>cocos本身的loading场景在/frameworks/cocos2d-html5/cocos2d/core/scenes/CCLoaderScene.js中，而如果我们想要自己实现loading场景，要么在这个类的基础上直接改，要么写一个自己的loading场景，然后在main.js中把加载系统的loading场景改为加载我们自己的loading场景，仔细研究这个CCLoaderScene，其实发现它也没有做多么伟大的事情，其实也就是比普通的场景多做一件事而已，那就是加载资源，通过init的函数，加载一些变量，如loading文本，百分数的进度等，然后调用一个定时任务，定期更新进度文本，定时任务中通过调用cc.loader函数检查资源加载的进度，加载完成之后，再进入主场景。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：<br>本节作业要求<br>// 本节课介绍了loading 的原理和系统源码<br>// 并深入介绍了cc.textureCache的核心用法<br>// 作业要求<br>// 实现一个自定义 loading效果（如果需要图片可以通过提交项目方式完成）<br>// 当loading 完成之后<br>// 清除loading界面的所有纹理<br>我在代码中实现了自建loading场景，写在了app.js中，并在loading场景中添加了一个移动的npc来模拟加载进度条，并且npc的纹理通过textureCache来管理，进度条加载完之后，通过textureCache移除场景中所有的纹理（其实只有npc的纹理）<br>作业代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//这时候，在src/resource.js中定义的图片数组都已经保存到了</span></span><br><span class=\"line\">        <span class=\"comment\">//cc.TextureCache中，因此我们可以直接从这里获取纹理</span></span><br><span class=\"line\">        cc.textureCache.addImage(<span class=\"string\">&quot;res/32636-2.png&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> texture1=cc.textureCache.getTextureForKey(<span class=\"string\">&quot;res/32636-2.png&quot;</span>);</span><br><span class=\"line\">        cc.textureCache.dumpCachedTextureInfo();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp=<span class=\"keyword\">new</span> cc.Sprite(texture1);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(sp);</span><br><span class=\"line\">        sp.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 本节课介绍了loading 的原理和系统源码</span></span><br><span class=\"line\">        <span class=\"comment\">// 并深入介绍了cc.textureCache的核心用法</span></span><br><span class=\"line\">        <span class=\"comment\">// 作业要求</span></span><br><span class=\"line\">        <span class=\"comment\">// 实现一个自定义 loading效果（如果需要图片可以通过提交项目方式完成）</span></span><br><span class=\"line\">        <span class=\"comment\">// 当loading 完成之后</span></span><br><span class=\"line\">        <span class=\"comment\">// 清除loading界面的所有纹理        </span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 自定义loading界面</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> MyLoadScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    _interval : <span class=\"literal\">null</span>,</span><br><span class=\"line\">    _label : <span class=\"literal\">null</span>,</span><br><span class=\"line\">    _npc:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    _className:<span class=\"string\">&quot;LoaderScene&quot;</span>,</span><br><span class=\"line\">    cb: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    target: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    npc:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Contructor of cc.LoaderScene</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@returns <span class=\"type\">&#123;boolean&#125;</span></span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    init : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//logo</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> logoWidth = <span class=\"number\">160</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> logoHeight = <span class=\"number\">200</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// bg</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bgLayer = self._bgLayer = <span class=\"keyword\">new</span> cc.LayerColor(cc.color(<span class=\"number\">32</span>, <span class=\"number\">255</span>, <span class=\"number\">32</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">        self.addChild(bgLayer, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//image move to CCSceneFile.js</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> fontSize = <span class=\"number\">24</span>, lblHeight =  -logoHeight / <span class=\"number\">2</span> + <span class=\"number\">100</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(cc._loaderImage)&#123;<span class=\"comment\">//这个图片在Base64Image中保存，我们可以替换</span></span><br><span class=\"line\">            <span class=\"comment\">//loading logo</span></span><br><span class=\"line\">            cc.loader.loadImg(cc._loaderImage, &#123;<span class=\"attr\">isCrossOrigin</span> : <span class=\"literal\">false</span> &#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, img</span>)</span>&#123;</span><br><span class=\"line\">                logoWidth = img.width;</span><br><span class=\"line\">                logoHeight = img.height;</span><br><span class=\"line\">                self._initStage(img, cc.visibleRect.center);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            fontSize = <span class=\"number\">14</span>;</span><br><span class=\"line\">            lblHeight = -logoHeight / <span class=\"number\">2</span> - <span class=\"number\">10</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//loading percent 加载进度</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> label = self._label = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;Loading... 0%&quot;</span>, <span class=\"string\">&quot;Arial&quot;</span>, fontSize);</span><br><span class=\"line\">        label.setPosition(cc.pAdd(cc.visibleRect.center, cc.p(<span class=\"number\">0</span>, lblHeight)));</span><br><span class=\"line\">        label.setColor(cc.color(<span class=\"number\">180</span>, <span class=\"number\">180</span>, <span class=\"number\">180</span>));</span><br><span class=\"line\">        bgLayer.addChild(<span class=\"built_in\">this</span>._label, <span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 自定义npc</span></span><br><span class=\"line\">        cc.textureCache.addImage(<span class=\"string\">&quot;res/32636-2.png&quot;</span>);</span><br><span class=\"line\">        cc.textureCache.dumpCachedTextureInfo();</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;loading界面添加纹理32636-2&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npcTexture = cc.textureCache.getTextureForKey(<span class=\"string\">&quot;res/32636-2.png&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc = self._npc = <span class=\"keyword\">new</span> cc.Sprite(npcTexture);</span><br><span class=\"line\">        npc.setPosition(npc.width/<span class=\"number\">2</span>,<span class=\"number\">150</span>);</span><br><span class=\"line\">        npc.setScale(<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._bgLayer.addChild(<span class=\"built_in\">this</span>._npc,<span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">      _initStage: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">img, centerPos</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> texture2d = self._texture2d = <span class=\"keyword\">new</span> cc.Texture2D();</span><br><span class=\"line\">        texture2d.initWithElement(img);</span><br><span class=\"line\">        texture2d.handleLoadedTexture();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> logo = self._logo = <span class=\"keyword\">new</span> cc.Sprite(texture2d);</span><br><span class=\"line\">        logo.setScale(cc.contentScaleFactor());</span><br><span class=\"line\">        logo.x = centerPos.x;</span><br><span class=\"line\">        logo.y = centerPos.y;</span><br><span class=\"line\">        self._bgLayer.addChild(logo, <span class=\"number\">10</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * custom onEnter</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">        cc.Node.prototype.onEnter.call(self);</span><br><span class=\"line\">        self.schedule(self._startLoading, <span class=\"number\">0.3</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * custom onExit</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    onExit: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        cc.Node.prototype.onExit.call(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> tmpStr = <span class=\"string\">&quot;Loading... 100%&quot;</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._label.setString(tmpStr);</span><br><span class=\"line\">        <span class=\"comment\">// 清理缓存</span></span><br><span class=\"line\">        cc.textureCache.removeAllTextures();</span><br><span class=\"line\">        cc.textureCache.dumpCachedTextureInfo();</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;loading界面结束，清理纹理缓存&quot;</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * init with resources</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param <span class=\"type\">&#123;Array&#125;</span> <span class=\"variable\">resources</span></span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param <span class=\"type\">&#123;Function|String&#125;</span> <span class=\"variable\">cb</span></span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&#125;</span> <span class=\"variable\">target</span></span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    initWithResources: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resources, cb, target</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(cc.isString(resources))</span><br><span class=\"line\">            resources = [resources];</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.resources = resources || [];</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.cb = cb;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.target = target;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    _startLoading: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">        self.unschedule(self._startLoading);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> res = self.resources;</span><br><span class=\"line\">        cc.loader.load(res,</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">result, count, loadedCount</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> percent = (loadedCount / count * <span class=\"number\">100</span>) | <span class=\"number\">0</span>;</span><br><span class=\"line\">                percent = <span class=\"built_in\">Math</span>.min(percent, <span class=\"number\">100</span>);</span><br><span class=\"line\">                self._label.setString(<span class=\"string\">&quot;Loading... &quot;</span> + percent + <span class=\"string\">&quot;%&quot;</span>);</span><br><span class=\"line\">                self._npc.setPositionX(self._npc.width/<span class=\"number\">2</span>+cc.winSize.width*(percent/<span class=\"number\">100</span>));</span><br><span class=\"line\">                cc.log(<span class=\"string\">&quot;loading界面npc走到了&quot;</span>+percent+<span class=\"string\">&quot;,横坐标&quot;</span>+(self._npc.width/<span class=\"number\">2</span>+cc.winSize.width*(percent/<span class=\"number\">100</span>))+<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">            &#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (self.cb)</span><br><span class=\"line\">                    self.cb.call(self.target);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    _updateTransform: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._bgLayer._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._label._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._logo._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">MyLoadScene.preload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resources, cb, target</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> _cc = cc;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!_cc.loaderScene) &#123;</span><br><span class=\"line\">        _cc.loaderScene = <span class=\"keyword\">new</span> MyLoadScene();</span><br><span class=\"line\">        _cc.loaderScene.init();</span><br><span class=\"line\">        cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            _cc.loaderScene._updateTransform();</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//调用initWithResources来实现纹理加载</span></span><br><span class=\"line\">    _cc.loaderScene.initWithResources(resources, cb, target);</span><br><span class=\"line\">    cc.director.runScene(_cc.loaderScene);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _cc.loaderScene;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>其中main.js加载场景的代码修改如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//load resources</span></span><br><span class=\"line\"><span class=\"comment\">// cc.LoaderScene.preload(g_resources, function () &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     cc.director.runScene(new HelloWorldScene());</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;, this);</span></span><br><span class=\"line\">MyLoadScene.preload(g_resources, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    cc.director.runScene(<span class=\"keyword\">new</span> HelloWorldScene());</span><br><span class=\"line\">&#125;, <span class=\"built_in\">this</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_05_20/55df2e8d114fce1f48d1151065951e865d56b92c/\">http://www.cocoscvp.com/usercode/2016_05_20/55df2e8d114fce1f48d1151065951e865d56b92c/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节内容主要讲解两个知识点，纹理缓存的管理和cocos的场景加载动画。纹理缓存管理可以通过cc.TextureCache来进行管理，而场景加载动画则在源码中的/frameworks/cocos2d-html5/cocos2d/core/scenes/CCLoaderScene.js中","more":"，在CCLoaderScene中定义了场景加载的相关方法。</p>\n<h3 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h3><p>cc.TextureCache的使用API在官网的文档地址是：<a href=\"http://www.cocos.com/doc/jsdoc/symbols/cc.textureCache.html\">http://www.cocos.com/doc/jsdoc/symbols/cc.textureCache.html</a><br>其主要API如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addImage(path);<span class=\"comment\">// 添加一个纹理到缓存</span></span><br><span class=\"line\">dumpCachedTextureInfo();<span class=\"comment\">// 把当前TextureCache的内容输出到cc.log,它会计算每个贴图的大小和贴图总共占用的内存</span></span><br><span class=\"line\">getTextureForKey(textureKeyName);<span class=\"comment\">// 返回创建好的贴图。如果贴图不存在，返回空。</span></span><br><span class=\"line\">removeAllTextures();<span class=\"comment\">// 清空加载贴图的字典，如果你收到“内存警告”时请调用此方法短期来看:释放某些资源，防止app出现闪退,在中期:会分配更多的资源,长远来看:没有什么区别</span></span><br><span class=\"line\">removeTexture(texture);<span class=\"comment\">// 从缓存中删除指定的贴图</span></span><br><span class=\"line\">removeTextureForKey(textureKeyName);<span class=\"comment\">// 从缓存中根据给定的key删除贴图textureForKey(textureKeyName);// 返回创建好的贴图。如果贴图不存在，返回空。</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"loading场景\"><a href=\"#loading场景\" class=\"headerlink\" title=\"loading场景\"></a>loading场景</h3><p>cocos本身的loading场景在/frameworks/cocos2d-html5/cocos2d/core/scenes/CCLoaderScene.js中，而如果我们想要自己实现loading场景，要么在这个类的基础上直接改，要么写一个自己的loading场景，然后在main.js中把加载系统的loading场景改为加载我们自己的loading场景，仔细研究这个CCLoaderScene，其实发现它也没有做多么伟大的事情，其实也就是比普通的场景多做一件事而已，那就是加载资源，通过init的函数，加载一些变量，如loading文本，百分数的进度等，然后调用一个定时任务，定期更新进度文本，定时任务中通过调用cc.loader函数检查资源加载的进度，加载完成之后，再进入主场景。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>本节作业：<br>本节作业要求<br>// 本节课介绍了loading 的原理和系统源码<br>// 并深入介绍了cc.textureCache的核心用法<br>// 作业要求<br>// 实现一个自定义 loading效果（如果需要图片可以通过提交项目方式完成）<br>// 当loading 完成之后<br>// 清除loading界面的所有纹理<br>我在代码中实现了自建loading场景，写在了app.js中，并在loading场景中添加了一个移动的npc来模拟加载进度条，并且npc的纹理通过textureCache来管理，进度条加载完之后，通过textureCache移除场景中所有的纹理（其实只有npc的纹理）<br>作业代码实现如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">//这时候，在src/resource.js中定义的图片数组都已经保存到了</span></span><br><span class=\"line\">        <span class=\"comment\">//cc.TextureCache中，因此我们可以直接从这里获取纹理</span></span><br><span class=\"line\">        cc.textureCache.addImage(<span class=\"string\">&quot;res/32636-2.png&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> texture1=cc.textureCache.getTextureForKey(<span class=\"string\">&quot;res/32636-2.png&quot;</span>);</span><br><span class=\"line\">        cc.textureCache.dumpCachedTextureInfo();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sp=<span class=\"keyword\">new</span> cc.Sprite(texture1);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(sp);</span><br><span class=\"line\">        sp.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 本节课介绍了loading 的原理和系统源码</span></span><br><span class=\"line\">        <span class=\"comment\">// 并深入介绍了cc.textureCache的核心用法</span></span><br><span class=\"line\">        <span class=\"comment\">// 作业要求</span></span><br><span class=\"line\">        <span class=\"comment\">// 实现一个自定义 loading效果（如果需要图片可以通过提交项目方式完成）</span></span><br><span class=\"line\">        <span class=\"comment\">// 当loading 完成之后</span></span><br><span class=\"line\">        <span class=\"comment\">// 清除loading界面的所有纹理        </span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 自定义loading界面</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> MyLoadScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    _interval : <span class=\"literal\">null</span>,</span><br><span class=\"line\">    _label : <span class=\"literal\">null</span>,</span><br><span class=\"line\">    _npc:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    _className:<span class=\"string\">&quot;LoaderScene&quot;</span>,</span><br><span class=\"line\">    cb: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    target: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    npc:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Contructor of cc.LoaderScene</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@returns <span class=\"type\">&#123;boolean&#125;</span></span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    init : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//logo</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> logoWidth = <span class=\"number\">160</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> logoHeight = <span class=\"number\">200</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// bg</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bgLayer = self._bgLayer = <span class=\"keyword\">new</span> cc.LayerColor(cc.color(<span class=\"number\">32</span>, <span class=\"number\">255</span>, <span class=\"number\">32</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">        self.addChild(bgLayer, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//image move to CCSceneFile.js</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> fontSize = <span class=\"number\">24</span>, lblHeight =  -logoHeight / <span class=\"number\">2</span> + <span class=\"number\">100</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(cc._loaderImage)&#123;<span class=\"comment\">//这个图片在Base64Image中保存，我们可以替换</span></span><br><span class=\"line\">            <span class=\"comment\">//loading logo</span></span><br><span class=\"line\">            cc.loader.loadImg(cc._loaderImage, &#123;<span class=\"attr\">isCrossOrigin</span> : <span class=\"literal\">false</span> &#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, img</span>)</span>&#123;</span><br><span class=\"line\">                logoWidth = img.width;</span><br><span class=\"line\">                logoHeight = img.height;</span><br><span class=\"line\">                self._initStage(img, cc.visibleRect.center);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            fontSize = <span class=\"number\">14</span>;</span><br><span class=\"line\">            lblHeight = -logoHeight / <span class=\"number\">2</span> - <span class=\"number\">10</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//loading percent 加载进度</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> label = self._label = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;Loading... 0%&quot;</span>, <span class=\"string\">&quot;Arial&quot;</span>, fontSize);</span><br><span class=\"line\">        label.setPosition(cc.pAdd(cc.visibleRect.center, cc.p(<span class=\"number\">0</span>, lblHeight)));</span><br><span class=\"line\">        label.setColor(cc.color(<span class=\"number\">180</span>, <span class=\"number\">180</span>, <span class=\"number\">180</span>));</span><br><span class=\"line\">        bgLayer.addChild(<span class=\"built_in\">this</span>._label, <span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 自定义npc</span></span><br><span class=\"line\">        cc.textureCache.addImage(<span class=\"string\">&quot;res/32636-2.png&quot;</span>);</span><br><span class=\"line\">        cc.textureCache.dumpCachedTextureInfo();</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;loading界面添加纹理32636-2&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npcTexture = cc.textureCache.getTextureForKey(<span class=\"string\">&quot;res/32636-2.png&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> npc = self._npc = <span class=\"keyword\">new</span> cc.Sprite(npcTexture);</span><br><span class=\"line\">        npc.setPosition(npc.width/<span class=\"number\">2</span>,<span class=\"number\">150</span>);</span><br><span class=\"line\">        npc.setScale(<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._bgLayer.addChild(<span class=\"built_in\">this</span>._npc,<span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">      _initStage: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">img, centerPos</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> texture2d = self._texture2d = <span class=\"keyword\">new</span> cc.Texture2D();</span><br><span class=\"line\">        texture2d.initWithElement(img);</span><br><span class=\"line\">        texture2d.handleLoadedTexture();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> logo = self._logo = <span class=\"keyword\">new</span> cc.Sprite(texture2d);</span><br><span class=\"line\">        logo.setScale(cc.contentScaleFactor());</span><br><span class=\"line\">        logo.x = centerPos.x;</span><br><span class=\"line\">        logo.y = centerPos.y;</span><br><span class=\"line\">        self._bgLayer.addChild(logo, <span class=\"number\">10</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * custom onEnter</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">        cc.Node.prototype.onEnter.call(self);</span><br><span class=\"line\">        self.schedule(self._startLoading, <span class=\"number\">0.3</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * custom onExit</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    onExit: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        cc.Node.prototype.onExit.call(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> tmpStr = <span class=\"string\">&quot;Loading... 100%&quot;</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._label.setString(tmpStr);</span><br><span class=\"line\">        <span class=\"comment\">// 清理缓存</span></span><br><span class=\"line\">        cc.textureCache.removeAllTextures();</span><br><span class=\"line\">        cc.textureCache.dumpCachedTextureInfo();</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;loading界面结束，清理纹理缓存&quot;</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * init with resources</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param <span class=\"type\">&#123;Array&#125;</span> <span class=\"variable\">resources</span></span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param <span class=\"type\">&#123;Function|String&#125;</span> <span class=\"variable\">cb</span></span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&#125;</span> <span class=\"variable\">target</span></span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    initWithResources: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resources, cb, target</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(cc.isString(resources))</span><br><span class=\"line\">            resources = [resources];</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.resources = resources || [];</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.cb = cb;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.target = target;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    _startLoading: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">        self.unschedule(self._startLoading);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> res = self.resources;</span><br><span class=\"line\">        cc.loader.load(res,</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">result, count, loadedCount</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> percent = (loadedCount / count * <span class=\"number\">100</span>) | <span class=\"number\">0</span>;</span><br><span class=\"line\">                percent = <span class=\"built_in\">Math</span>.min(percent, <span class=\"number\">100</span>);</span><br><span class=\"line\">                self._label.setString(<span class=\"string\">&quot;Loading... &quot;</span> + percent + <span class=\"string\">&quot;%&quot;</span>);</span><br><span class=\"line\">                self._npc.setPositionX(self._npc.width/<span class=\"number\">2</span>+cc.winSize.width*(percent/<span class=\"number\">100</span>));</span><br><span class=\"line\">                cc.log(<span class=\"string\">&quot;loading界面npc走到了&quot;</span>+percent+<span class=\"string\">&quot;,横坐标&quot;</span>+(self._npc.width/<span class=\"number\">2</span>+cc.winSize.width*(percent/<span class=\"number\">100</span>))+<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">            &#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (self.cb)</span><br><span class=\"line\">                    self.cb.call(self.target);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    _updateTransform: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._bgLayer._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._label._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._logo._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">MyLoadScene.preload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resources, cb, target</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> _cc = cc;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!_cc.loaderScene) &#123;</span><br><span class=\"line\">        _cc.loaderScene = <span class=\"keyword\">new</span> MyLoadScene();</span><br><span class=\"line\">        _cc.loaderScene.init();</span><br><span class=\"line\">        cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            _cc.loaderScene._updateTransform();</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//调用initWithResources来实现纹理加载</span></span><br><span class=\"line\">    _cc.loaderScene.initWithResources(resources, cb, target);</span><br><span class=\"line\">    cc.director.runScene(_cc.loaderScene);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _cc.loaderScene;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>其中main.js加载场景的代码修改如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//load resources</span></span><br><span class=\"line\"><span class=\"comment\">// cc.LoaderScene.preload(g_resources, function () &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     cc.director.runScene(new HelloWorldScene());</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;, this);</span></span><br><span class=\"line\">MyLoadScene.preload(g_resources, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    cc.director.runScene(<span class=\"keyword\">new</span> HelloWorldScene());</span><br><span class=\"line\">&#125;, <span class=\"built_in\">this</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_05_20/55df2e8d114fce1f48d1151065951e865d56b92c/\">http://www.cocoscvp.com/usercode/2016_05_20/55df2e8d114fce1f48d1151065951e865d56b92c/</a></p>"},{"title":"CVP认证学习笔记--(何小成)骨骼动画的制作","date":"2016-05-10T14:44:00.000Z","_content":"本文主要复习下骨骼动画的制作过程，<a href=\"http://hjcenry.github.io/2016/05/06/CVP%E8%AE%A4%E8%AF%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--(%E4%BD%95%E5%B0%8F%E6%88%90)023--%E5%8A%A0%E8%BD%BD%E9%AA%A8%E9%AA%BC%E5%8A%A8%E7%94%BB/\">上一篇文章</a>简单介绍了cocos中对于骨骼动画的使用，本文主要从骨骼动画制作的角度来讲解。<!--more-->\n### 导入资源\n制作之前准备好所需要的图片资源，然后倒入到cocos studio中，如下图：\n![导入资源](http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_1a202fb1ffd1025.png)\n### 添加皮肤\n资源中的皮肤一个一个拖放到场景中，使小图片大致能拼出来一个完整的图片，如下图：\n![添加皮肤](http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_55529c9535d5bb4.png)\n### 添加骨骼 \n根据人物的骨骼特征，为皮肤添加骨骼，如下图：\n![添加骨骼](http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_3ad23acff07741b.png)\n### 绑定父关系\n把具有相互关系的骨骼绑定起来，使骨骼之间能够作为整体进行动画，如头部应该绑定身体为父关系，而手腕应该绑定手臂为父关系，如下图：\n![绑定父关系](http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_a02834c9d8347ca.png)\n### 制作动画 \n骨骼绑定之后，就可以编辑动画，动画编辑即选择选择动画模式，然后选择相应的图层，在下面时间轴上的关键帧上进行改变，中间的补间动画cocos studio会自动创建，如下图：\n![制作动画](http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_40c0db20e072450.png)\n### 导出资源\n确定制作完成，并经过了精细的调整之后，就可以导出动画了，导出的操作很简单，即选择文件，然后选择导出项目，如下图：\n![导出资源](http://7xnnwn.com1.z0.glb.clouddn.com/daochu.png)\n导出之后可以看到相应的文件夹下有png，plist和json三个文件，即上一篇文章中说到的cocos中需要使用到的骨骼动画资源，至此，骨骼动画制作完成！ 整个过程感觉是一个挺细心的活，作为一个程序来说，做了一个骨骼动画之后，我真心佩服美术，那些游戏中无论活灵活现的主人公，还是酷炫吊炸天特效，都是美术们这样一帧一帧调出来的，真的是我心目中的艺术家，衷心的点个赞！\n### 最终效果\n制作完之后，我加在了上一节课的作业的开始界面和帮助界面中，如下图：\n![效果图](http://7xnnwn.com1.z0.glb.clouddn.com/1111.gif)\n作业地址：http://www.cocoscvp.com/usercode/b09ecc9894fe6ab8a1ba17f5d5348b9a215038a6/","source":"_posts/CVP认证学习笔记--(何小成)骨骼动画的制作.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)骨骼动画的制作\ndate: 2016-05-10 22:44\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n本文主要复习下骨骼动画的制作过程，<a href=\"http://hjcenry.github.io/2016/05/06/CVP%E8%AE%A4%E8%AF%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--(%E4%BD%95%E5%B0%8F%E6%88%90)023--%E5%8A%A0%E8%BD%BD%E9%AA%A8%E9%AA%BC%E5%8A%A8%E7%94%BB/\">上一篇文章</a>简单介绍了cocos中对于骨骼动画的使用，本文主要从骨骼动画制作的角度来讲解。<!--more-->\n### 导入资源\n制作之前准备好所需要的图片资源，然后倒入到cocos studio中，如下图：\n![导入资源](http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_1a202fb1ffd1025.png)\n### 添加皮肤\n资源中的皮肤一个一个拖放到场景中，使小图片大致能拼出来一个完整的图片，如下图：\n![添加皮肤](http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_55529c9535d5bb4.png)\n### 添加骨骼 \n根据人物的骨骼特征，为皮肤添加骨骼，如下图：\n![添加骨骼](http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_3ad23acff07741b.png)\n### 绑定父关系\n把具有相互关系的骨骼绑定起来，使骨骼之间能够作为整体进行动画，如头部应该绑定身体为父关系，而手腕应该绑定手臂为父关系，如下图：\n![绑定父关系](http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_a02834c9d8347ca.png)\n### 制作动画 \n骨骼绑定之后，就可以编辑动画，动画编辑即选择选择动画模式，然后选择相应的图层，在下面时间轴上的关键帧上进行改变，中间的补间动画cocos studio会自动创建，如下图：\n![制作动画](http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_40c0db20e072450.png)\n### 导出资源\n确定制作完成，并经过了精细的调整之后，就可以导出动画了，导出的操作很简单，即选择文件，然后选择导出项目，如下图：\n![导出资源](http://7xnnwn.com1.z0.glb.clouddn.com/daochu.png)\n导出之后可以看到相应的文件夹下有png，plist和json三个文件，即上一篇文章中说到的cocos中需要使用到的骨骼动画资源，至此，骨骼动画制作完成！ 整个过程感觉是一个挺细心的活，作为一个程序来说，做了一个骨骼动画之后，我真心佩服美术，那些游戏中无论活灵活现的主人公，还是酷炫吊炸天特效，都是美术们这样一帧一帧调出来的，真的是我心目中的艺术家，衷心的点个赞！\n### 最终效果\n制作完之后，我加在了上一节课的作业的开始界面和帮助界面中，如下图：\n![效果图](http://7xnnwn.com1.z0.glb.clouddn.com/1111.gif)\n作业地址：http://www.cocoscvp.com/usercode/b09ecc9894fe6ab8a1ba17f5d5348b9a215038a6/","slug":"CVP认证学习笔记--(何小成)骨骼动画的制作","published":1,"updated":"2016-05-10T15:20:14.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhus002cwsaz8o4g7x8o","content":"<p>本文主要复习下骨骼动画的制作过程，<a href=\"http://hjcenry.github.io/2016/05/06/CVP%E8%AE%A4%E8%AF%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--(%E4%BD%95%E5%B0%8F%E6%88%90)023--%E5%8A%A0%E8%BD%BD%E9%AA%A8%E9%AA%BC%E5%8A%A8%E7%94%BB/\">上一篇文章</a>简单介绍了cocos中对于骨骼动画的使用，本文主要从骨骼动画制作的角度来讲解。<a id=\"more\"></a></p>\n<h3 id=\"导入资源\"><a href=\"#导入资源\" class=\"headerlink\" title=\"导入资源\"></a>导入资源</h3><p>制作之前准备好所需要的图片资源，然后倒入到cocos studio中，如下图：<br><img src=\"http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_1a202fb1ffd1025.png\" alt=\"导入资源\"></p>\n<h3 id=\"添加皮肤\"><a href=\"#添加皮肤\" class=\"headerlink\" title=\"添加皮肤\"></a>添加皮肤</h3><p>资源中的皮肤一个一个拖放到场景中，使小图片大致能拼出来一个完整的图片，如下图：<br><img src=\"http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_55529c9535d5bb4.png\" alt=\"添加皮肤\"></p>\n<h3 id=\"添加骨骼\"><a href=\"#添加骨骼\" class=\"headerlink\" title=\"添加骨骼\"></a>添加骨骼</h3><p>根据人物的骨骼特征，为皮肤添加骨骼，如下图：<br><img src=\"http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_3ad23acff07741b.png\" alt=\"添加骨骼\"></p>\n<h3 id=\"绑定父关系\"><a href=\"#绑定父关系\" class=\"headerlink\" title=\"绑定父关系\"></a>绑定父关系</h3><p>把具有相互关系的骨骼绑定起来，使骨骼之间能够作为整体进行动画，如头部应该绑定身体为父关系，而手腕应该绑定手臂为父关系，如下图：<br><img src=\"http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_a02834c9d8347ca.png\" alt=\"绑定父关系\"></p>\n<h3 id=\"制作动画\"><a href=\"#制作动画\" class=\"headerlink\" title=\"制作动画\"></a>制作动画</h3><p>骨骼绑定之后，就可以编辑动画，动画编辑即选择选择动画模式，然后选择相应的图层，在下面时间轴上的关键帧上进行改变，中间的补间动画cocos studio会自动创建，如下图：<br><img src=\"http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_40c0db20e072450.png\" alt=\"制作动画\"></p>\n<h3 id=\"导出资源\"><a href=\"#导出资源\" class=\"headerlink\" title=\"导出资源\"></a>导出资源</h3><p>确定制作完成，并经过了精细的调整之后，就可以导出动画了，导出的操作很简单，即选择文件，然后选择导出项目，如下图：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/daochu.png\" alt=\"导出资源\"><br>导出之后可以看到相应的文件夹下有png，plist和json三个文件，即上一篇文章中说到的cocos中需要使用到的骨骼动画资源，至此，骨骼动画制作完成！ 整个过程感觉是一个挺细心的活，作为一个程序来说，做了一个骨骼动画之后，我真心佩服美术，那些游戏中无论活灵活现的主人公，还是酷炫吊炸天特效，都是美术们这样一帧一帧调出来的，真的是我心目中的艺术家，衷心的点个赞！</p>\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p>制作完之后，我加在了上一节课的作业的开始界面和帮助界面中，如下图：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/1111.gif\" alt=\"效果图\"><br>作业地址：<a href=\"http://www.cocoscvp.com/usercode/b09ecc9894fe6ab8a1ba17f5d5348b9a215038a6/\">http://www.cocoscvp.com/usercode/b09ecc9894fe6ab8a1ba17f5d5348b9a215038a6/</a></p>\n","site":{"data":{}},"excerpt":"<p>本文主要复习下骨骼动画的制作过程，<a href=\"http://hjcenry.github.io/2016/05/06/CVP%E8%AE%A4%E8%AF%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--(%E4%BD%95%E5%B0%8F%E6%88%90)023--%E5%8A%A0%E8%BD%BD%E9%AA%A8%E9%AA%BC%E5%8A%A8%E7%94%BB/\">上一篇文章</a>简单介绍了cocos中对于骨骼动画的使用，本文主要从骨骼动画制作的角度来讲解。","more":"</p>\n<h3 id=\"导入资源\"><a href=\"#导入资源\" class=\"headerlink\" title=\"导入资源\"></a>导入资源</h3><p>制作之前准备好所需要的图片资源，然后倒入到cocos studio中，如下图：<br><img src=\"http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_1a202fb1ffd1025.png\" alt=\"导入资源\"></p>\n<h3 id=\"添加皮肤\"><a href=\"#添加皮肤\" class=\"headerlink\" title=\"添加皮肤\"></a>添加皮肤</h3><p>资源中的皮肤一个一个拖放到场景中，使小图片大致能拼出来一个完整的图片，如下图：<br><img src=\"http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_55529c9535d5bb4.png\" alt=\"添加皮肤\"></p>\n<h3 id=\"添加骨骼\"><a href=\"#添加骨骼\" class=\"headerlink\" title=\"添加骨骼\"></a>添加骨骼</h3><p>根据人物的骨骼特征，为皮肤添加骨骼，如下图：<br><img src=\"http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_3ad23acff07741b.png\" alt=\"添加骨骼\"></p>\n<h3 id=\"绑定父关系\"><a href=\"#绑定父关系\" class=\"headerlink\" title=\"绑定父关系\"></a>绑定父关系</h3><p>把具有相互关系的骨骼绑定起来，使骨骼之间能够作为整体进行动画，如头部应该绑定身体为父关系，而手腕应该绑定手臂为父关系，如下图：<br><img src=\"http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_a02834c9d8347ca.png\" alt=\"绑定父关系\"></p>\n<h3 id=\"制作动画\"><a href=\"#制作动画\" class=\"headerlink\" title=\"制作动画\"></a>制作动画</h3><p>骨骼绑定之后，就可以编辑动画，动画编辑即选择选择动画模式，然后选择相应的图层，在下面时间轴上的关键帧上进行改变，中间的补间动画cocos studio会自动创建，如下图：<br><img src=\"http://cdn.cocimg.com/bbs/attachment/Fid_72/72_319828_40c0db20e072450.png\" alt=\"制作动画\"></p>\n<h3 id=\"导出资源\"><a href=\"#导出资源\" class=\"headerlink\" title=\"导出资源\"></a>导出资源</h3><p>确定制作完成，并经过了精细的调整之后，就可以导出动画了，导出的操作很简单，即选择文件，然后选择导出项目，如下图：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/daochu.png\" alt=\"导出资源\"><br>导出之后可以看到相应的文件夹下有png，plist和json三个文件，即上一篇文章中说到的cocos中需要使用到的骨骼动画资源，至此，骨骼动画制作完成！ 整个过程感觉是一个挺细心的活，作为一个程序来说，做了一个骨骼动画之后，我真心佩服美术，那些游戏中无论活灵活现的主人公，还是酷炫吊炸天特效，都是美术们这样一帧一帧调出来的，真的是我心目中的艺术家，衷心的点个赞！</p>\n<h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p>制作完之后，我加在了上一节课的作业的开始界面和帮助界面中，如下图：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/1111.gif\" alt=\"效果图\"><br>作业地址：<a href=\"http://www.cocoscvp.com/usercode/b09ecc9894fe6ab8a1ba17f5d5348b9a215038a6/\">http://www.cocoscvp.com/usercode/b09ecc9894fe6ab8a1ba17f5d5348b9a215038a6/</a></p>"},{"title":"JSON-RPC（jsonrpc4j）使用demo","date":"2016-03-22T09:34:00.000Z","_content":"服务端开发，在很多情况下，需要使用到RPC框架，今天发现一款很轻量的RPC框架——JSON-RPC。json rpc 是一种以json为消息格式的远程调用服务，它是一套允许运行在不同操作系统、不同环境的程序实现基于Internet过程调用的规范和一系列的实现。<!--more-->这种远程过程调用可以使用http作为传输协议，也可以使用其它传输协议，传输的内容是json消息体。\njson rpc 和xmlrpc相比具有很多优点。首先xmlrpc是以xml作为消息格式，xml具有体积大，格式复杂，传输占用带宽。程序对xml的解析也比较复杂，并且耗费较多服务器资源。json相比xml体积小巧，并且解析相对容易很多。\njson-rpc是一种非常轻量级的跨语言远程调用协议，实现及使用简单。仅需几十行代码，即可实现一个远程调用的客户端，方便语言扩展客户端的实现。服务器端有php、java、python、ruby、.net等语言实现，是非常不错的及轻量级的远程调用协议。\n其官网地址是：http://www.jsonrpc.org/\n其Wiki地址是：http://json-rpc.org/wiki/implementations\n可以看到，JSON-RPC有C，C++，C#，Javascipt，Erlang，Objective-C，Java等多种语言的实现，这里我简单介绍下Java使用JSON-RPC的示例，今天折腾了半天弄得。\n首先就是要下载jsonrpc4j的jar包以及其依赖的jar包，这里我直接搭建Maven项目，使用Maven来管理jar包，其pom文件如下：\n\npom.xml\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>com.hjc.demo</groupId>\n\t<artifactId>jsonrpc_server</artifactId>\n\t<packaging>war</packaging>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>jsonrpc_server Maven Webapp</name>\n\t<url>http://maven.apache.org</url>\n\t<dependencies>\n\t\t<!-- jsonrpc4j -->\n\t\t<dependency>\n\t\t\t<groupId>com.github.briandilley.jsonrpc4j</groupId>\n\t\t\t<artifactId>jsonrpc4j</artifactId>\n\t\t\t<version>1.0</version>\n\t\t</dependency>\n\t\t<!-- jsonrpc4j依赖的包 -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.10</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.fasterxml.jackson.core</groupId>\n\t\t\t<artifactId>jackson-core</artifactId>\n\t\t\t<version>2.0.2</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.fasterxml.jackson.core</groupId>\n\t\t\t<artifactId>jackson-databind</artifactId>\n\t\t\t<version>2.0.2</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.fasterxml.jackson.core</groupId>\n\t\t\t<artifactId>jackson-annotations</artifactId>\n\t\t\t<version>2.0.2</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>javax.portlet</groupId>\n\t\t\t<artifactId>portlet-api</artifactId>\n\t\t\t<version>2.0</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-core</artifactId>\n\t\t\t<version>3.1.2.RELEASE</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-context</artifactId>\n\t\t\t<version>3.1.2.RELEASE</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-web</artifactId>\n\t\t\t<version>3.1.2.RELEASE</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-test</artifactId>\n\t\t\t<version>3.1.2.RELEASE</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>commons-codec</groupId>\n\t\t\t<artifactId>commons-codec</artifactId>\n\t\t\t<version>1.4</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.httpcomponents</groupId>\n\t\t\t<artifactId>httpcore-nio</artifactId>\n\t\t\t<version>4.2.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.jmock</groupId>\n\t\t\t<artifactId>jmock-junit4</artifactId>\n\t\t\t<version>2.5.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.jmock</groupId>\n\t\t\t<artifactId>jmock</artifactId>\n\t\t\t<version>2.5.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.eclipse.jetty</groupId>\n\t\t\t<artifactId>jetty-server</artifactId>\n\t\t\t<version>9.0.0.RC0</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.eclipse.jetty</groupId>\n\t\t\t<artifactId>jetty-servlet</artifactId>\n\t\t\t<version>9.0.0.RC0</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.ow2.chameleon.fuchsia.base.json-rpc</groupId>\n\t\t\t<artifactId>org.ow2.chameleon.fuchsia.base.json-rpc.json-rpc-bundle</artifactId>\n\t\t\t<version>0.0.2</version>\n\t\t</dependency>\n\n\t</dependencies>\n\t<build>\n\t\t<finalName>jsonrpc_server</finalName>\n\t</build>\n</project>\n```\n待以上jar包等环境部署好了之后，就可以进行开发了，我们先要部署一个Servlet，作为RPC调用的接口。（我的环境的Tomcat6，Tomcat7的朋友可以直接使用@WebServlet来部署Servlet，具体代码因环境而异）。\n\nweb.xml\n```xml\n<!DOCTYPE web-app PUBLIC\n \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n \"http://java.sun.com/dtd/web-app_2_3.dtd\" >\n\n<web-app>\n  <display-name>Archetype Created Web Application</display-name>\n  <servlet>\n  \t<servlet-name>RpcServer</servlet-name>\n  \t<display-name>RpcServer</display-name>\n  \t<description></description>\n  \t<servlet-class>com.hjc.demo.RpcServer</servlet-class>\n  </servlet>\n  <servlet-mapping>\n  \t<servlet-name>RpcServer</servlet-name>\n  \t<url-pattern>/rpc</url-pattern>\n  </servlet-mapping>\n</web-app>\n```\n\nRpcServer.java\n\n```java\npackage com.hjc.demo;\n\nimport java.io.IOException;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\nimport com.googlecode.jsonrpc4j.JsonRpcServer;\n\npublic class RpcServer extends HttpServlet {\n\tprivate static final long serialVersionUID = 1L;\n\tprivate JsonRpcServer rpcServer = null;\n\n\tpublic RpcServer() {\n\t\tsuper();\n\t\trpcServer = new JsonRpcServer(new DemoServiceImply(), DemoService.class);\n\t}\n\n\t@Override\n\tprotected void service(HttpServletRequest request,\n\t\t\tHttpServletResponse response) throws ServletException, IOException {\n\t\trpcServer.handle(request, response);\n\t}\n\n}\n```\n其中，DemoService是RPC调用的接口，DemoServiceImply是DemoService接口的实现，他们的代码分别如下：\n\nDemoService.java\n\n```java\npackage com.hjc.demo;\n\npublic interface DemoService {\n\n\tpublic DemoBean getDemo(String code, String msg);\n\n\tpublic Integer getInt(Integer code);\n\n\tpublic String getString(String msg);\n\n\tpublic void doSomething();\n}\n```\n\nDemoServiceImply.java\n\n```java\npackage com.hjc.demo;\n\npublic class DemoServiceImply implements DemoService {\n\n\tpublic DemoBean getDemo(String code, String msg) {\n\t\tDemoBean bean1 = new DemoBean();\n\t\tbean1.setCode(Integer.parseInt(code));\n\t\tbean1.setMsg(msg);\n\t\treturn bean1;\n\t}\n\n\tpublic Integer getInt(Integer code) {\n\t\treturn code;\n\t}\n\n\tpublic String getString(String msg) {\n\t\treturn msg;\n\t}\n\n\tpublic void doSomething() {\n\t\tSystem.out.println(\"do something\");\n\t}\n\n}\n```\n\nDemoBean是一个普通的JavaBean，其代码如下：\n\nDemoBean.java\n\n```java\npackage com.hjc.demo;\n\nimport java.io.Serializable;\n\npublic class DemoBean implements Serializable{\n\tprivate static final long serialVersionUID = -5141784402935371524L;\n\tprivate int code;\n\tprivate String msg;\n\n\tpublic int getCode() {\n\t\treturn code;\n\t}\n\n\tpublic void setCode(int code) {\n\t\tthis.code = code;\n\t}\n\n\tpublic String getMsg() {\n\t\treturn msg;\n\t}\n\n\tpublic void setMsg(String msg) {\n\t\tthis.msg = msg;\n\t}\n}\n```\n\n以上代码即完成了服务端的代码，接下来写一个客户端的测试类：\n\nJsonRpcTest.java\n\n```java\npackage com.hjc.test;\n\nimport java.net.MalformedURLException;\nimport java.net.URL;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\n\nimport com.fasterxml.jackson.databind.node.ObjectNode;\nimport com.googlecode.jsonrpc4j.JsonRpcHttpClient;\nimport com.hjc.demo.DemoBean;\n\npublic class JsonRpcTest {\n\tstatic JsonRpcHttpClient client;\n\n\tpublic JsonRpcTest() {\n\n\t}\n\n\tpublic static void main(String[] args) throws Throwable {\n\t\t// 实例化请求地址，注意服务端web.xml中地址的配置\n\t\ttry {\n\t\t\tclient = new JsonRpcHttpClient(new URL(\n\t\t\t\t\t\"http://127.0.0.1:8080/jsonrpc_server/rpc\"));\n\t\t\t// 请求头中添加的信息\n\t\t\tMap<String, String> headers = new HashMap<String, String>();\n\t\t\theaders.put(\"UserKey\", \"hjckey\");\n\t\t\t// 添加到请求头中去\n\t\t\tclient.setHeaders(headers);\n\t\t\tJsonRpcTest test = new JsonRpcTest();\n\t\t\ttest.doSomething();\n\t\t\tDemoBean demo = test.getDemo(1, \"哈\");\n\t\t\tint code = test.getInt(2);\n\t\t\tString msg = test.getString(\"哈哈哈\");\n\t\t\t// print\n\t\t\tSystem.out.println(\"===========================javabean\");\n\t\t\tSystem.out.println(demo.getCode());\n\t\t\tSystem.out.println(demo.getMsg());\n\t\t\tSystem.out.println(\"===========================Integer\");\n\t\t\tSystem.out.println(code);\n\t\t\tSystem.out.println(\"===========================String\");\n\t\t\tSystem.out.println(msg);\n\t\t\tSystem.out.println(\"===========================end\");\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n\n\tpublic void doSomething() throws Throwable {\n\t\tclient.invoke(\"doSomething\", null);\n\t}\n\n\tpublic DemoBean getDemo(int code, String msg) throws Throwable {\n\t\tString[] params = new String[] { String.valueOf(code), msg };\n\t\tDemoBean demo = null;\n\t\tdemo = client.invoke(\"getDemo\", params, DemoBean.class);\n\t\treturn demo;\n\t}\n\n\tpublic int getInt(int code) throws Throwable {\n\t\tInteger[] codes = new Integer[] { code };\n\t\treturn client.invoke(\"getInt\", codes, Integer.class);\n\t}\n\n\tpublic String getString(String msg) throws Throwable {\n\t\tString[] msgs = new String[] { msg };\n\t\treturn client.invoke(\"getString\", msgs, String.class);\n\t}\n\n}\n```\n\n最后的打印结果如下：\n\n服务端：\n\n```\ndo something\n```\n\n客户端：\n```\n===========================javabean\n1\n哈\n===========================Integer\n2\n===========================String\n哈哈哈\n===========================end\n```\n以上就完成了JSON-RPC全部的代码，值得说的是，这其中我也爬了很多坑，这里也提一下，JsonRpcHttpClient类的invoke方法，如果你要传递参数，必须是一个数组，这里我传的String[]和Integer[]，如果传递了别的类型会发生什么呢？你可以试一下这样调用：\n```java\nclient.invoke(\"getInt\", 3, Integer.class);\n```\n然后你就会发现服务端报错：\n```java\njava.lang.IllegalArgumentException: Unknown params node type: 2\n\tat com.googlecode.jsonrpc4j.JsonRpcServer.findBestMethodByParamsNode(JsonRpcServer.java:612)\n\tat com.googlecode.jsonrpc4j.JsonRpcServer.handleObject(JsonRpcServer.java:373)\n\tat com.googlecode.jsonrpc4j.JsonRpcServer.handleNode(JsonRpcServer.java:293)\n\tat com.googlecode.jsonrpc4j.JsonRpcServer.handle(JsonRpcServer.java:230)\n\tat com.googlecode.jsonrpc4j.JsonRpcServer.handle(JsonRpcServer.java:207)\n\tat com.hjc.demo.RpcServer.service(RpcServer.java:24)\n        ...\n```\n点进源码，你就全明白了，进入JsonRpcServer类查看findBestMethodByParamsNode方法，其代码如下：\n```java\n/**\n\t * Finds the {@link Method} from the supplied {@link Set} that\n\t * best matches the rest of the arguments supplied and returns\n\t * it as a {@link MethodAndArgs} class.\n\t *\n\t * @param methods the {@link Method}s\n\t * @param paramsNode the {@link JsonNode} passed as the parameters\n\t * @return the {@link MethodAndArgs}\n\t */\n\tprivate MethodAndArgs findBestMethodByParamsNode(Set<Method> methods, JsonNode paramsNode) {\n\n\t\t// no parameters\n\t\tif (paramsNode==null || paramsNode.isNull()) {\n\t\t\treturn findBestMethodUsingParamIndexes(methods, 0, null);\n\n\t\t// array parameters\n\t\t} else if (paramsNode.isArray()) {\n\t\t\treturn findBestMethodUsingParamIndexes(methods, paramsNode.size(), ArrayNode.class.cast(paramsNode));\n\n\t\t// named parameters\n\t\t} else if (paramsNode.isObject()) {\n\t\t\tSet<String> fieldNames = new HashSet<String>();\n\t\t\tIterator<String> itr=paramsNode.fieldNames();\n\t\t\twhile (itr.hasNext()) {\n\t\t\t\tfieldNames.add(itr.next());\n\t\t\t}\n\t\t\treturn findBestMethodUsingParamNames(methods, fieldNames, ObjectNode.class.cast(paramsNode));\n\n\t\t}\n\n\t\t// unknown params node type\n\t\tthrow new IllegalArgumentException(\"Unknown params node type: \"+paramsNode.toString());\n\t}\n```\n所以我就明白了，除了null（不传参数），Array，Object，其他的类都是“Unknown params node type”，当时我也很疑惑，Integer不也是Object嘛，断点一下，原来它认为这是IntNode类，所以不能识别，其他的参数我也试过一些，目前还是数组是最靠谱的，网上资料还比较少，希望有懂得给指点指点。\n这也是我今天花了半天时间弄得JSON-RPC，喜欢的朋友，源码地址在下面：\nhttps://github.com/hjcenry/json-rpc-demo\n","source":"_posts/JSON-RPC（jsonrpc4j）使用demo.md","raw":"---\ntitle: JSON-RPC（jsonrpc4j）使用demo\ndate: 2016-03-22 17:34\ncategories: Java\ntags: [Java,rpc,jsonrpc,游戏服务器]\n---\n服务端开发，在很多情况下，需要使用到RPC框架，今天发现一款很轻量的RPC框架——JSON-RPC。json rpc 是一种以json为消息格式的远程调用服务，它是一套允许运行在不同操作系统、不同环境的程序实现基于Internet过程调用的规范和一系列的实现。<!--more-->这种远程过程调用可以使用http作为传输协议，也可以使用其它传输协议，传输的内容是json消息体。\njson rpc 和xmlrpc相比具有很多优点。首先xmlrpc是以xml作为消息格式，xml具有体积大，格式复杂，传输占用带宽。程序对xml的解析也比较复杂，并且耗费较多服务器资源。json相比xml体积小巧，并且解析相对容易很多。\njson-rpc是一种非常轻量级的跨语言远程调用协议，实现及使用简单。仅需几十行代码，即可实现一个远程调用的客户端，方便语言扩展客户端的实现。服务器端有php、java、python、ruby、.net等语言实现，是非常不错的及轻量级的远程调用协议。\n其官网地址是：http://www.jsonrpc.org/\n其Wiki地址是：http://json-rpc.org/wiki/implementations\n可以看到，JSON-RPC有C，C++，C#，Javascipt，Erlang，Objective-C，Java等多种语言的实现，这里我简单介绍下Java使用JSON-RPC的示例，今天折腾了半天弄得。\n首先就是要下载jsonrpc4j的jar包以及其依赖的jar包，这里我直接搭建Maven项目，使用Maven来管理jar包，其pom文件如下：\n\npom.xml\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>com.hjc.demo</groupId>\n\t<artifactId>jsonrpc_server</artifactId>\n\t<packaging>war</packaging>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>jsonrpc_server Maven Webapp</name>\n\t<url>http://maven.apache.org</url>\n\t<dependencies>\n\t\t<!-- jsonrpc4j -->\n\t\t<dependency>\n\t\t\t<groupId>com.github.briandilley.jsonrpc4j</groupId>\n\t\t\t<artifactId>jsonrpc4j</artifactId>\n\t\t\t<version>1.0</version>\n\t\t</dependency>\n\t\t<!-- jsonrpc4j依赖的包 -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.10</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.fasterxml.jackson.core</groupId>\n\t\t\t<artifactId>jackson-core</artifactId>\n\t\t\t<version>2.0.2</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.fasterxml.jackson.core</groupId>\n\t\t\t<artifactId>jackson-databind</artifactId>\n\t\t\t<version>2.0.2</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.fasterxml.jackson.core</groupId>\n\t\t\t<artifactId>jackson-annotations</artifactId>\n\t\t\t<version>2.0.2</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>javax.portlet</groupId>\n\t\t\t<artifactId>portlet-api</artifactId>\n\t\t\t<version>2.0</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-core</artifactId>\n\t\t\t<version>3.1.2.RELEASE</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-context</artifactId>\n\t\t\t<version>3.1.2.RELEASE</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-web</artifactId>\n\t\t\t<version>3.1.2.RELEASE</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-test</artifactId>\n\t\t\t<version>3.1.2.RELEASE</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>commons-codec</groupId>\n\t\t\t<artifactId>commons-codec</artifactId>\n\t\t\t<version>1.4</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.httpcomponents</groupId>\n\t\t\t<artifactId>httpcore-nio</artifactId>\n\t\t\t<version>4.2.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.jmock</groupId>\n\t\t\t<artifactId>jmock-junit4</artifactId>\n\t\t\t<version>2.5.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.jmock</groupId>\n\t\t\t<artifactId>jmock</artifactId>\n\t\t\t<version>2.5.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.eclipse.jetty</groupId>\n\t\t\t<artifactId>jetty-server</artifactId>\n\t\t\t<version>9.0.0.RC0</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.eclipse.jetty</groupId>\n\t\t\t<artifactId>jetty-servlet</artifactId>\n\t\t\t<version>9.0.0.RC0</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.ow2.chameleon.fuchsia.base.json-rpc</groupId>\n\t\t\t<artifactId>org.ow2.chameleon.fuchsia.base.json-rpc.json-rpc-bundle</artifactId>\n\t\t\t<version>0.0.2</version>\n\t\t</dependency>\n\n\t</dependencies>\n\t<build>\n\t\t<finalName>jsonrpc_server</finalName>\n\t</build>\n</project>\n```\n待以上jar包等环境部署好了之后，就可以进行开发了，我们先要部署一个Servlet，作为RPC调用的接口。（我的环境的Tomcat6，Tomcat7的朋友可以直接使用@WebServlet来部署Servlet，具体代码因环境而异）。\n\nweb.xml\n```xml\n<!DOCTYPE web-app PUBLIC\n \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n \"http://java.sun.com/dtd/web-app_2_3.dtd\" >\n\n<web-app>\n  <display-name>Archetype Created Web Application</display-name>\n  <servlet>\n  \t<servlet-name>RpcServer</servlet-name>\n  \t<display-name>RpcServer</display-name>\n  \t<description></description>\n  \t<servlet-class>com.hjc.demo.RpcServer</servlet-class>\n  </servlet>\n  <servlet-mapping>\n  \t<servlet-name>RpcServer</servlet-name>\n  \t<url-pattern>/rpc</url-pattern>\n  </servlet-mapping>\n</web-app>\n```\n\nRpcServer.java\n\n```java\npackage com.hjc.demo;\n\nimport java.io.IOException;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\nimport com.googlecode.jsonrpc4j.JsonRpcServer;\n\npublic class RpcServer extends HttpServlet {\n\tprivate static final long serialVersionUID = 1L;\n\tprivate JsonRpcServer rpcServer = null;\n\n\tpublic RpcServer() {\n\t\tsuper();\n\t\trpcServer = new JsonRpcServer(new DemoServiceImply(), DemoService.class);\n\t}\n\n\t@Override\n\tprotected void service(HttpServletRequest request,\n\t\t\tHttpServletResponse response) throws ServletException, IOException {\n\t\trpcServer.handle(request, response);\n\t}\n\n}\n```\n其中，DemoService是RPC调用的接口，DemoServiceImply是DemoService接口的实现，他们的代码分别如下：\n\nDemoService.java\n\n```java\npackage com.hjc.demo;\n\npublic interface DemoService {\n\n\tpublic DemoBean getDemo(String code, String msg);\n\n\tpublic Integer getInt(Integer code);\n\n\tpublic String getString(String msg);\n\n\tpublic void doSomething();\n}\n```\n\nDemoServiceImply.java\n\n```java\npackage com.hjc.demo;\n\npublic class DemoServiceImply implements DemoService {\n\n\tpublic DemoBean getDemo(String code, String msg) {\n\t\tDemoBean bean1 = new DemoBean();\n\t\tbean1.setCode(Integer.parseInt(code));\n\t\tbean1.setMsg(msg);\n\t\treturn bean1;\n\t}\n\n\tpublic Integer getInt(Integer code) {\n\t\treturn code;\n\t}\n\n\tpublic String getString(String msg) {\n\t\treturn msg;\n\t}\n\n\tpublic void doSomething() {\n\t\tSystem.out.println(\"do something\");\n\t}\n\n}\n```\n\nDemoBean是一个普通的JavaBean，其代码如下：\n\nDemoBean.java\n\n```java\npackage com.hjc.demo;\n\nimport java.io.Serializable;\n\npublic class DemoBean implements Serializable{\n\tprivate static final long serialVersionUID = -5141784402935371524L;\n\tprivate int code;\n\tprivate String msg;\n\n\tpublic int getCode() {\n\t\treturn code;\n\t}\n\n\tpublic void setCode(int code) {\n\t\tthis.code = code;\n\t}\n\n\tpublic String getMsg() {\n\t\treturn msg;\n\t}\n\n\tpublic void setMsg(String msg) {\n\t\tthis.msg = msg;\n\t}\n}\n```\n\n以上代码即完成了服务端的代码，接下来写一个客户端的测试类：\n\nJsonRpcTest.java\n\n```java\npackage com.hjc.test;\n\nimport java.net.MalformedURLException;\nimport java.net.URL;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\n\nimport com.fasterxml.jackson.databind.node.ObjectNode;\nimport com.googlecode.jsonrpc4j.JsonRpcHttpClient;\nimport com.hjc.demo.DemoBean;\n\npublic class JsonRpcTest {\n\tstatic JsonRpcHttpClient client;\n\n\tpublic JsonRpcTest() {\n\n\t}\n\n\tpublic static void main(String[] args) throws Throwable {\n\t\t// 实例化请求地址，注意服务端web.xml中地址的配置\n\t\ttry {\n\t\t\tclient = new JsonRpcHttpClient(new URL(\n\t\t\t\t\t\"http://127.0.0.1:8080/jsonrpc_server/rpc\"));\n\t\t\t// 请求头中添加的信息\n\t\t\tMap<String, String> headers = new HashMap<String, String>();\n\t\t\theaders.put(\"UserKey\", \"hjckey\");\n\t\t\t// 添加到请求头中去\n\t\t\tclient.setHeaders(headers);\n\t\t\tJsonRpcTest test = new JsonRpcTest();\n\t\t\ttest.doSomething();\n\t\t\tDemoBean demo = test.getDemo(1, \"哈\");\n\t\t\tint code = test.getInt(2);\n\t\t\tString msg = test.getString(\"哈哈哈\");\n\t\t\t// print\n\t\t\tSystem.out.println(\"===========================javabean\");\n\t\t\tSystem.out.println(demo.getCode());\n\t\t\tSystem.out.println(demo.getMsg());\n\t\t\tSystem.out.println(\"===========================Integer\");\n\t\t\tSystem.out.println(code);\n\t\t\tSystem.out.println(\"===========================String\");\n\t\t\tSystem.out.println(msg);\n\t\t\tSystem.out.println(\"===========================end\");\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n\n\tpublic void doSomething() throws Throwable {\n\t\tclient.invoke(\"doSomething\", null);\n\t}\n\n\tpublic DemoBean getDemo(int code, String msg) throws Throwable {\n\t\tString[] params = new String[] { String.valueOf(code), msg };\n\t\tDemoBean demo = null;\n\t\tdemo = client.invoke(\"getDemo\", params, DemoBean.class);\n\t\treturn demo;\n\t}\n\n\tpublic int getInt(int code) throws Throwable {\n\t\tInteger[] codes = new Integer[] { code };\n\t\treturn client.invoke(\"getInt\", codes, Integer.class);\n\t}\n\n\tpublic String getString(String msg) throws Throwable {\n\t\tString[] msgs = new String[] { msg };\n\t\treturn client.invoke(\"getString\", msgs, String.class);\n\t}\n\n}\n```\n\n最后的打印结果如下：\n\n服务端：\n\n```\ndo something\n```\n\n客户端：\n```\n===========================javabean\n1\n哈\n===========================Integer\n2\n===========================String\n哈哈哈\n===========================end\n```\n以上就完成了JSON-RPC全部的代码，值得说的是，这其中我也爬了很多坑，这里也提一下，JsonRpcHttpClient类的invoke方法，如果你要传递参数，必须是一个数组，这里我传的String[]和Integer[]，如果传递了别的类型会发生什么呢？你可以试一下这样调用：\n```java\nclient.invoke(\"getInt\", 3, Integer.class);\n```\n然后你就会发现服务端报错：\n```java\njava.lang.IllegalArgumentException: Unknown params node type: 2\n\tat com.googlecode.jsonrpc4j.JsonRpcServer.findBestMethodByParamsNode(JsonRpcServer.java:612)\n\tat com.googlecode.jsonrpc4j.JsonRpcServer.handleObject(JsonRpcServer.java:373)\n\tat com.googlecode.jsonrpc4j.JsonRpcServer.handleNode(JsonRpcServer.java:293)\n\tat com.googlecode.jsonrpc4j.JsonRpcServer.handle(JsonRpcServer.java:230)\n\tat com.googlecode.jsonrpc4j.JsonRpcServer.handle(JsonRpcServer.java:207)\n\tat com.hjc.demo.RpcServer.service(RpcServer.java:24)\n        ...\n```\n点进源码，你就全明白了，进入JsonRpcServer类查看findBestMethodByParamsNode方法，其代码如下：\n```java\n/**\n\t * Finds the {@link Method} from the supplied {@link Set} that\n\t * best matches the rest of the arguments supplied and returns\n\t * it as a {@link MethodAndArgs} class.\n\t *\n\t * @param methods the {@link Method}s\n\t * @param paramsNode the {@link JsonNode} passed as the parameters\n\t * @return the {@link MethodAndArgs}\n\t */\n\tprivate MethodAndArgs findBestMethodByParamsNode(Set<Method> methods, JsonNode paramsNode) {\n\n\t\t// no parameters\n\t\tif (paramsNode==null || paramsNode.isNull()) {\n\t\t\treturn findBestMethodUsingParamIndexes(methods, 0, null);\n\n\t\t// array parameters\n\t\t} else if (paramsNode.isArray()) {\n\t\t\treturn findBestMethodUsingParamIndexes(methods, paramsNode.size(), ArrayNode.class.cast(paramsNode));\n\n\t\t// named parameters\n\t\t} else if (paramsNode.isObject()) {\n\t\t\tSet<String> fieldNames = new HashSet<String>();\n\t\t\tIterator<String> itr=paramsNode.fieldNames();\n\t\t\twhile (itr.hasNext()) {\n\t\t\t\tfieldNames.add(itr.next());\n\t\t\t}\n\t\t\treturn findBestMethodUsingParamNames(methods, fieldNames, ObjectNode.class.cast(paramsNode));\n\n\t\t}\n\n\t\t// unknown params node type\n\t\tthrow new IllegalArgumentException(\"Unknown params node type: \"+paramsNode.toString());\n\t}\n```\n所以我就明白了，除了null（不传参数），Array，Object，其他的类都是“Unknown params node type”，当时我也很疑惑，Integer不也是Object嘛，断点一下，原来它认为这是IntNode类，所以不能识别，其他的参数我也试过一些，目前还是数组是最靠谱的，网上资料还比较少，希望有懂得给指点指点。\n这也是我今天花了半天时间弄得JSON-RPC，喜欢的朋友，源码地址在下面：\nhttps://github.com/hjcenry/json-rpc-demo\n","slug":"JSON-RPC（jsonrpc4j）使用demo","published":1,"updated":"2016-04-24T12:09:26.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhut002gwsazazxbc4u1","content":"<p>服务端开发，在很多情况下，需要使用到RPC框架，今天发现一款很轻量的RPC框架——JSON-RPC。json rpc 是一种以json为消息格式的远程调用服务，它是一套允许运行在不同操作系统、不同环境的程序实现基于Internet过程调用的规范和一系列的实现。<a id=\"more\"></a>这种远程过程调用可以使用http作为传输协议，也可以使用其它传输协议，传输的内容是json消息体。<br>json rpc 和xmlrpc相比具有很多优点。首先xmlrpc是以xml作为消息格式，xml具有体积大，格式复杂，传输占用带宽。程序对xml的解析也比较复杂，并且耗费较多服务器资源。json相比xml体积小巧，并且解析相对容易很多。<br>json-rpc是一种非常轻量级的跨语言远程调用协议，实现及使用简单。仅需几十行代码，即可实现一个远程调用的客户端，方便语言扩展客户端的实现。服务器端有php、java、python、ruby、.net等语言实现，是非常不错的及轻量级的远程调用协议。<br>其官网地址是：<a href=\"http://www.jsonrpc.org/\">http://www.jsonrpc.org/</a><br>其Wiki地址是：<a href=\"http://json-rpc.org/wiki/implementations\">http://json-rpc.org/wiki/implementations</a><br>可以看到，JSON-RPC有C，C++，C#，Javascipt，Erlang，Objective-C，Java等多种语言的实现，这里我简单介绍下Java使用JSON-RPC的示例，今天折腾了半天弄得。<br>首先就是要下载jsonrpc4j的jar包以及其依赖的jar包，这里我直接搭建Maven项目，使用Maven来管理jar包，其pom文件如下：</p>\n<p>pom.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.hjc.demo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsonrpc_server<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>war<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>jsonrpc_server Maven Webapp<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!-- jsonrpc4j --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.github.briandilley.jsonrpc4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsonrpc4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!-- jsonrpc4j依赖的包 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.10<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-databind<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-annotations<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.portlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>portlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.2.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.2.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.2.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.2.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.httpcomponents<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>httpcore-nio<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.2.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.jmock<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jmock-junit4<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.jmock<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jmock<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.eclipse.jetty<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jetty-server<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>9.0.0.RC0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.eclipse.jetty<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jetty-servlet<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>9.0.0.RC0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.ow2.chameleon.fuchsia.base.json-rpc<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>org.ow2.chameleon.fuchsia.base.json-rpc.json-rpc-bundle<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>jsonrpc_server<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>待以上jar包等环境部署好了之后，就可以进行开发了，我们先要部署一个Servlet，作为RPC调用的接口。（我的环境的Tomcat6，Tomcat7的朋友可以直接使用@WebServlet来部署Servlet，具体代码因环境而异）。</p>\n<p>web.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">web-app</span> <span class=\"meta-keyword\">PUBLIC</span></span></span><br><span class=\"line\"><span class=\"meta\"> <span class=\"meta-string\">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\"> <span class=\"meta-string\">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> &gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">display-name</span>&gt;</span>Archetype Created Web Application<span class=\"tag\">&lt;/<span class=\"name\">display-name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>RpcServer<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">display-name</span>&gt;</span>RpcServer<span class=\"tag\">&lt;/<span class=\"name\">display-name</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.hjc.demo.RpcServer<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>RpcServer<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/rpc<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>RpcServer.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServlet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.googlecode.jsonrpc4j.JsonRpcServer;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RpcServer</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> JsonRpcServer rpcServer = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">RpcServer</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">super</span>();</span><br><span class=\"line\">\t\trpcServer = <span class=\"keyword\">new</span> JsonRpcServer(<span class=\"keyword\">new</span> DemoServiceImply(), DemoService.class);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">service</span><span class=\"params\">(HttpServletRequest request,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t\tHttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">\t\trpcServer.handle(request, response);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中，DemoService是RPC调用的接口，DemoServiceImply是DemoService接口的实现，他们的代码分别如下：</p>\n<p>DemoService.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">DemoService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> DemoBean <span class=\"title\">getDemo</span><span class=\"params\">(String code, String msg)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getInt</span><span class=\"params\">(Integer code)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getString</span><span class=\"params\">(String msg)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>DemoServiceImply.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DemoServiceImply</span> <span class=\"keyword\">implements</span> <span class=\"title\">DemoService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> DemoBean <span class=\"title\">getDemo</span><span class=\"params\">(String code, String msg)</span> </span>&#123;</span><br><span class=\"line\">\t\tDemoBean bean1 = <span class=\"keyword\">new</span> DemoBean();</span><br><span class=\"line\">\t\tbean1.setCode(Integer.parseInt(code));</span><br><span class=\"line\">\t\tbean1.setMsg(msg);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> bean1;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getInt</span><span class=\"params\">(Integer code)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> code;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getString</span><span class=\"params\">(String msg)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> msg;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tSystem.out.println(<span class=\"string\">&quot;do something&quot;</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>DemoBean是一个普通的JavaBean，其代码如下：</p>\n<p>DemoBean.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DemoBean</span> <span class=\"keyword\">implements</span> <span class=\"title\">Serializable</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">5141784402935371524L</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">int</span> code;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String msg;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getCode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> code;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setCode</span><span class=\"params\">(<span class=\"keyword\">int</span> code)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.code = code;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getMsg</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> msg;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setMsg</span><span class=\"params\">(String msg)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.msg = msg;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>以上代码即完成了服务端的代码，接下来写一个客户端的测试类：</p>\n<p>JsonRpcTest.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.test;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.MalformedURLException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URL;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.node.ObjectNode;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.googlecode.jsonrpc4j.JsonRpcHttpClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc.demo.DemoBean;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JsonRpcTest</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">static</span> JsonRpcHttpClient client;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">JsonRpcTest</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 实例化请求地址，注意服务端web.xml中地址的配置</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tclient = <span class=\"keyword\">new</span> JsonRpcHttpClient(<span class=\"keyword\">new</span> URL(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">&quot;http://127.0.0.1:8080/jsonrpc_server/rpc&quot;</span>));</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 请求头中添加的信息</span></span><br><span class=\"line\">\t\t\tMap&lt;String, String&gt; headers = <span class=\"keyword\">new</span> HashMap&lt;String, String&gt;();</span><br><span class=\"line\">\t\t\theaders.put(<span class=\"string\">&quot;UserKey&quot;</span>, <span class=\"string\">&quot;hjckey&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 添加到请求头中去</span></span><br><span class=\"line\">\t\t\tclient.setHeaders(headers);</span><br><span class=\"line\">\t\t\tJsonRpcTest test = <span class=\"keyword\">new</span> JsonRpcTest();</span><br><span class=\"line\">\t\t\ttest.doSomething();</span><br><span class=\"line\">\t\t\tDemoBean demo = test.getDemo(<span class=\"number\">1</span>, <span class=\"string\">&quot;哈&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> code = test.getInt(<span class=\"number\">2</span>);</span><br><span class=\"line\">\t\t\tString msg = test.getString(<span class=\"string\">&quot;哈哈哈&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// print</span></span><br><span class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">&quot;===========================javabean&quot;</span>);</span><br><span class=\"line\">\t\t\tSystem.out.println(demo.getCode());</span><br><span class=\"line\">\t\t\tSystem.out.println(demo.getMsg());</span><br><span class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">&quot;===========================Integer&quot;</span>);</span><br><span class=\"line\">\t\t\tSystem.out.println(code);</span><br><span class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">&quot;===========================String&quot;</span>);</span><br><span class=\"line\">\t\t\tSystem.out.println(msg);</span><br><span class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">&quot;===========================end&quot;</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">\t\tclient.invoke(<span class=\"string\">&quot;doSomething&quot;</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> DemoBean <span class=\"title\">getDemo</span><span class=\"params\">(<span class=\"keyword\">int</span> code, String msg)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">\t\tString[] params = <span class=\"keyword\">new</span> String[] &#123; String.valueOf(code), msg &#125;;</span><br><span class=\"line\">\t\tDemoBean demo = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\tdemo = client.invoke(<span class=\"string\">&quot;getDemo&quot;</span>, params, DemoBean.class);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> demo;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getInt</span><span class=\"params\">(<span class=\"keyword\">int</span> code)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">\t\tInteger[] codes = <span class=\"keyword\">new</span> Integer[] &#123; code &#125;;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> client.invoke(<span class=\"string\">&quot;getInt&quot;</span>, codes, Integer.class);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getString</span><span class=\"params\">(String msg)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">\t\tString[] msgs = <span class=\"keyword\">new</span> String[] &#123; msg &#125;;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> client.invoke(<span class=\"string\">&quot;getString&quot;</span>, msgs, String.class);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>最后的打印结果如下：</p>\n<p>服务端：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">do something</span><br></pre></td></tr></table></figure>\n\n<p>客户端：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;javabean</span><br><span class=\"line\">1</span><br><span class=\"line\">哈</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Integer</span><br><span class=\"line\">2</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;String</span><br><span class=\"line\">哈哈哈</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;end</span><br></pre></td></tr></table></figure>\n<p>以上就完成了JSON-RPC全部的代码，值得说的是，这其中我也爬了很多坑，这里也提一下，JsonRpcHttpClient类的invoke方法，如果你要传递参数，必须是一个数组，这里我传的String[]和Integer[]，如果传递了别的类型会发生什么呢？你可以试一下这样调用：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client.invoke(<span class=\"string\">&quot;getInt&quot;</span>, <span class=\"number\">3</span>, Integer.class);</span><br></pre></td></tr></table></figure>\n<p>然后你就会发现服务端报错：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java.lang.IllegalArgumentException: Unknown params node type: <span class=\"number\">2</span></span><br><span class=\"line\">\tat com.googlecode.jsonrpc4j.JsonRpcServer.findBestMethodByParamsNode(JsonRpcServer.java:<span class=\"number\">612</span>)</span><br><span class=\"line\">\tat com.googlecode.jsonrpc4j.JsonRpcServer.handleObject(JsonRpcServer.java:<span class=\"number\">373</span>)</span><br><span class=\"line\">\tat com.googlecode.jsonrpc4j.JsonRpcServer.handleNode(JsonRpcServer.java:<span class=\"number\">293</span>)</span><br><span class=\"line\">\tat com.googlecode.jsonrpc4j.JsonRpcServer.handle(JsonRpcServer.java:<span class=\"number\">230</span>)</span><br><span class=\"line\">\tat com.googlecode.jsonrpc4j.JsonRpcServer.handle(JsonRpcServer.java:<span class=\"number\">207</span>)</span><br><span class=\"line\">\tat com.hjc.demo.RpcServer.service(RpcServer.java:<span class=\"number\">24</span>)</span><br><span class=\"line\">        ...</span><br></pre></td></tr></table></figure>\n<p>点进源码，你就全明白了，进入JsonRpcServer类查看findBestMethodByParamsNode方法，其代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Finds the &#123;<span class=\"doctag\">@link</span> Method&#125; from the supplied &#123;<span class=\"doctag\">@link</span> Set&#125; that</span></span><br><span class=\"line\"><span class=\"comment\">\t * best matches the rest of the arguments supplied and returns</span></span><br><span class=\"line\"><span class=\"comment\">\t * it as a &#123;<span class=\"doctag\">@link</span> MethodAndArgs&#125; class.</span></span><br><span class=\"line\"><span class=\"comment\">\t *</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> methods the &#123;<span class=\"doctag\">@link</span> Method&#125;s</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> paramsNode the &#123;<span class=\"doctag\">@link</span> JsonNode&#125; passed as the parameters</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@return</span> the &#123;<span class=\"doctag\">@link</span> MethodAndArgs&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> MethodAndArgs <span class=\"title\">findBestMethodByParamsNode</span><span class=\"params\">(Set&lt;Method&gt; methods, JsonNode paramsNode)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// no parameters</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (paramsNode==<span class=\"keyword\">null</span> || paramsNode.isNull()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> findBestMethodUsingParamIndexes(methods, <span class=\"number\">0</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// array parameters</span></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (paramsNode.isArray()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> findBestMethodUsingParamIndexes(methods, paramsNode.size(), ArrayNode.class.cast(paramsNode));</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// named parameters</span></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (paramsNode.isObject()) &#123;</span><br><span class=\"line\">\t\t\tSet&lt;String&gt; fieldNames = <span class=\"keyword\">new</span> HashSet&lt;String&gt;();</span><br><span class=\"line\">\t\t\tIterator&lt;String&gt; itr=paramsNode.fieldNames();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> (itr.hasNext()) &#123;</span><br><span class=\"line\">\t\t\t\tfieldNames.add(itr.next());</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> findBestMethodUsingParamNames(methods, fieldNames, ObjectNode.class.cast(paramsNode));</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// unknown params node type</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;Unknown params node type: &quot;</span>+paramsNode.toString());</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n<p>所以我就明白了，除了null（不传参数），Array，Object，其他的类都是“Unknown params node type”，当时我也很疑惑，Integer不也是Object嘛，断点一下，原来它认为这是IntNode类，所以不能识别，其他的参数我也试过一些，目前还是数组是最靠谱的，网上资料还比较少，希望有懂得给指点指点。<br>这也是我今天花了半天时间弄得JSON-RPC，喜欢的朋友，源码地址在下面：<br><a href=\"https://github.com/hjcenry/json-rpc-demo\">https://github.com/hjcenry/json-rpc-demo</a></p>\n","site":{"data":{}},"excerpt":"<p>服务端开发，在很多情况下，需要使用到RPC框架，今天发现一款很轻量的RPC框架——JSON-RPC。json rpc 是一种以json为消息格式的远程调用服务，它是一套允许运行在不同操作系统、不同环境的程序实现基于Internet过程调用的规范和一系列的实现。","more":"这种远程过程调用可以使用http作为传输协议，也可以使用其它传输协议，传输的内容是json消息体。<br>json rpc 和xmlrpc相比具有很多优点。首先xmlrpc是以xml作为消息格式，xml具有体积大，格式复杂，传输占用带宽。程序对xml的解析也比较复杂，并且耗费较多服务器资源。json相比xml体积小巧，并且解析相对容易很多。<br>json-rpc是一种非常轻量级的跨语言远程调用协议，实现及使用简单。仅需几十行代码，即可实现一个远程调用的客户端，方便语言扩展客户端的实现。服务器端有php、java、python、ruby、.net等语言实现，是非常不错的及轻量级的远程调用协议。<br>其官网地址是：<a href=\"http://www.jsonrpc.org/\">http://www.jsonrpc.org/</a><br>其Wiki地址是：<a href=\"http://json-rpc.org/wiki/implementations\">http://json-rpc.org/wiki/implementations</a><br>可以看到，JSON-RPC有C，C++，C#，Javascipt，Erlang，Objective-C，Java等多种语言的实现，这里我简单介绍下Java使用JSON-RPC的示例，今天折腾了半天弄得。<br>首先就是要下载jsonrpc4j的jar包以及其依赖的jar包，这里我直接搭建Maven项目，使用Maven来管理jar包，其pom文件如下：</p>\n<p>pom.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.hjc.demo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsonrpc_server<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>war<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>jsonrpc_server Maven Webapp<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!-- jsonrpc4j --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.github.briandilley.jsonrpc4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsonrpc4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!-- jsonrpc4j依赖的包 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.10<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-databind<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-annotations<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.portlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>portlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.2.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.2.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.2.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.2.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.httpcomponents<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>httpcore-nio<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.2.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.jmock<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jmock-junit4<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.jmock<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jmock<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.eclipse.jetty<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jetty-server<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>9.0.0.RC0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.eclipse.jetty<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jetty-servlet<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>9.0.0.RC0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.ow2.chameleon.fuchsia.base.json-rpc<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>org.ow2.chameleon.fuchsia.base.json-rpc.json-rpc-bundle<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>jsonrpc_server<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>待以上jar包等环境部署好了之后，就可以进行开发了，我们先要部署一个Servlet，作为RPC调用的接口。（我的环境的Tomcat6，Tomcat7的朋友可以直接使用@WebServlet来部署Servlet，具体代码因环境而异）。</p>\n<p>web.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">web-app</span> <span class=\"meta-keyword\">PUBLIC</span></span></span><br><span class=\"line\"><span class=\"meta\"> <span class=\"meta-string\">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\"> <span class=\"meta-string\">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> &gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">display-name</span>&gt;</span>Archetype Created Web Application<span class=\"tag\">&lt;/<span class=\"name\">display-name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>RpcServer<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">display-name</span>&gt;</span>RpcServer<span class=\"tag\">&lt;/<span class=\"name\">display-name</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.hjc.demo.RpcServer<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>RpcServer<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/rpc<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>RpcServer.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServlet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.googlecode.jsonrpc4j.JsonRpcServer;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RpcServer</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> JsonRpcServer rpcServer = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">RpcServer</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">super</span>();</span><br><span class=\"line\">\t\trpcServer = <span class=\"keyword\">new</span> JsonRpcServer(<span class=\"keyword\">new</span> DemoServiceImply(), DemoService.class);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">service</span><span class=\"params\">(HttpServletRequest request,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t\tHttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">\t\trpcServer.handle(request, response);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中，DemoService是RPC调用的接口，DemoServiceImply是DemoService接口的实现，他们的代码分别如下：</p>\n<p>DemoService.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">DemoService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> DemoBean <span class=\"title\">getDemo</span><span class=\"params\">(String code, String msg)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getInt</span><span class=\"params\">(Integer code)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getString</span><span class=\"params\">(String msg)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>DemoServiceImply.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DemoServiceImply</span> <span class=\"keyword\">implements</span> <span class=\"title\">DemoService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> DemoBean <span class=\"title\">getDemo</span><span class=\"params\">(String code, String msg)</span> </span>&#123;</span><br><span class=\"line\">\t\tDemoBean bean1 = <span class=\"keyword\">new</span> DemoBean();</span><br><span class=\"line\">\t\tbean1.setCode(Integer.parseInt(code));</span><br><span class=\"line\">\t\tbean1.setMsg(msg);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> bean1;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getInt</span><span class=\"params\">(Integer code)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> code;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getString</span><span class=\"params\">(String msg)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> msg;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tSystem.out.println(<span class=\"string\">&quot;do something&quot;</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>DemoBean是一个普通的JavaBean，其代码如下：</p>\n<p>DemoBean.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DemoBean</span> <span class=\"keyword\">implements</span> <span class=\"title\">Serializable</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">5141784402935371524L</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">int</span> code;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String msg;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getCode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> code;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setCode</span><span class=\"params\">(<span class=\"keyword\">int</span> code)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.code = code;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getMsg</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> msg;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setMsg</span><span class=\"params\">(String msg)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.msg = msg;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>以上代码即完成了服务端的代码，接下来写一个客户端的测试类：</p>\n<p>JsonRpcTest.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.test;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.MalformedURLException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URL;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.node.ObjectNode;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.googlecode.jsonrpc4j.JsonRpcHttpClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc.demo.DemoBean;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JsonRpcTest</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">static</span> JsonRpcHttpClient client;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">JsonRpcTest</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 实例化请求地址，注意服务端web.xml中地址的配置</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tclient = <span class=\"keyword\">new</span> JsonRpcHttpClient(<span class=\"keyword\">new</span> URL(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">&quot;http://127.0.0.1:8080/jsonrpc_server/rpc&quot;</span>));</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 请求头中添加的信息</span></span><br><span class=\"line\">\t\t\tMap&lt;String, String&gt; headers = <span class=\"keyword\">new</span> HashMap&lt;String, String&gt;();</span><br><span class=\"line\">\t\t\theaders.put(<span class=\"string\">&quot;UserKey&quot;</span>, <span class=\"string\">&quot;hjckey&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 添加到请求头中去</span></span><br><span class=\"line\">\t\t\tclient.setHeaders(headers);</span><br><span class=\"line\">\t\t\tJsonRpcTest test = <span class=\"keyword\">new</span> JsonRpcTest();</span><br><span class=\"line\">\t\t\ttest.doSomething();</span><br><span class=\"line\">\t\t\tDemoBean demo = test.getDemo(<span class=\"number\">1</span>, <span class=\"string\">&quot;哈&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> code = test.getInt(<span class=\"number\">2</span>);</span><br><span class=\"line\">\t\t\tString msg = test.getString(<span class=\"string\">&quot;哈哈哈&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// print</span></span><br><span class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">&quot;===========================javabean&quot;</span>);</span><br><span class=\"line\">\t\t\tSystem.out.println(demo.getCode());</span><br><span class=\"line\">\t\t\tSystem.out.println(demo.getMsg());</span><br><span class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">&quot;===========================Integer&quot;</span>);</span><br><span class=\"line\">\t\t\tSystem.out.println(code);</span><br><span class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">&quot;===========================String&quot;</span>);</span><br><span class=\"line\">\t\t\tSystem.out.println(msg);</span><br><span class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">&quot;===========================end&quot;</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">\t\tclient.invoke(<span class=\"string\">&quot;doSomething&quot;</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> DemoBean <span class=\"title\">getDemo</span><span class=\"params\">(<span class=\"keyword\">int</span> code, String msg)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">\t\tString[] params = <span class=\"keyword\">new</span> String[] &#123; String.valueOf(code), msg &#125;;</span><br><span class=\"line\">\t\tDemoBean demo = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\tdemo = client.invoke(<span class=\"string\">&quot;getDemo&quot;</span>, params, DemoBean.class);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> demo;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getInt</span><span class=\"params\">(<span class=\"keyword\">int</span> code)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">\t\tInteger[] codes = <span class=\"keyword\">new</span> Integer[] &#123; code &#125;;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> client.invoke(<span class=\"string\">&quot;getInt&quot;</span>, codes, Integer.class);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getString</span><span class=\"params\">(String msg)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">\t\tString[] msgs = <span class=\"keyword\">new</span> String[] &#123; msg &#125;;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> client.invoke(<span class=\"string\">&quot;getString&quot;</span>, msgs, String.class);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>最后的打印结果如下：</p>\n<p>服务端：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">do something</span><br></pre></td></tr></table></figure>\n\n<p>客户端：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;javabean</span><br><span class=\"line\">1</span><br><span class=\"line\">哈</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Integer</span><br><span class=\"line\">2</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;String</span><br><span class=\"line\">哈哈哈</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;end</span><br></pre></td></tr></table></figure>\n<p>以上就完成了JSON-RPC全部的代码，值得说的是，这其中我也爬了很多坑，这里也提一下，JsonRpcHttpClient类的invoke方法，如果你要传递参数，必须是一个数组，这里我传的String[]和Integer[]，如果传递了别的类型会发生什么呢？你可以试一下这样调用：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client.invoke(<span class=\"string\">&quot;getInt&quot;</span>, <span class=\"number\">3</span>, Integer.class);</span><br></pre></td></tr></table></figure>\n<p>然后你就会发现服务端报错：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java.lang.IllegalArgumentException: Unknown params node type: <span class=\"number\">2</span></span><br><span class=\"line\">\tat com.googlecode.jsonrpc4j.JsonRpcServer.findBestMethodByParamsNode(JsonRpcServer.java:<span class=\"number\">612</span>)</span><br><span class=\"line\">\tat com.googlecode.jsonrpc4j.JsonRpcServer.handleObject(JsonRpcServer.java:<span class=\"number\">373</span>)</span><br><span class=\"line\">\tat com.googlecode.jsonrpc4j.JsonRpcServer.handleNode(JsonRpcServer.java:<span class=\"number\">293</span>)</span><br><span class=\"line\">\tat com.googlecode.jsonrpc4j.JsonRpcServer.handle(JsonRpcServer.java:<span class=\"number\">230</span>)</span><br><span class=\"line\">\tat com.googlecode.jsonrpc4j.JsonRpcServer.handle(JsonRpcServer.java:<span class=\"number\">207</span>)</span><br><span class=\"line\">\tat com.hjc.demo.RpcServer.service(RpcServer.java:<span class=\"number\">24</span>)</span><br><span class=\"line\">        ...</span><br></pre></td></tr></table></figure>\n<p>点进源码，你就全明白了，进入JsonRpcServer类查看findBestMethodByParamsNode方法，其代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Finds the &#123;<span class=\"doctag\">@link</span> Method&#125; from the supplied &#123;<span class=\"doctag\">@link</span> Set&#125; that</span></span><br><span class=\"line\"><span class=\"comment\">\t * best matches the rest of the arguments supplied and returns</span></span><br><span class=\"line\"><span class=\"comment\">\t * it as a &#123;<span class=\"doctag\">@link</span> MethodAndArgs&#125; class.</span></span><br><span class=\"line\"><span class=\"comment\">\t *</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> methods the &#123;<span class=\"doctag\">@link</span> Method&#125;s</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> paramsNode the &#123;<span class=\"doctag\">@link</span> JsonNode&#125; passed as the parameters</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@return</span> the &#123;<span class=\"doctag\">@link</span> MethodAndArgs&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> MethodAndArgs <span class=\"title\">findBestMethodByParamsNode</span><span class=\"params\">(Set&lt;Method&gt; methods, JsonNode paramsNode)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// no parameters</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (paramsNode==<span class=\"keyword\">null</span> || paramsNode.isNull()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> findBestMethodUsingParamIndexes(methods, <span class=\"number\">0</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// array parameters</span></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (paramsNode.isArray()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> findBestMethodUsingParamIndexes(methods, paramsNode.size(), ArrayNode.class.cast(paramsNode));</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// named parameters</span></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (paramsNode.isObject()) &#123;</span><br><span class=\"line\">\t\t\tSet&lt;String&gt; fieldNames = <span class=\"keyword\">new</span> HashSet&lt;String&gt;();</span><br><span class=\"line\">\t\t\tIterator&lt;String&gt; itr=paramsNode.fieldNames();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> (itr.hasNext()) &#123;</span><br><span class=\"line\">\t\t\t\tfieldNames.add(itr.next());</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> findBestMethodUsingParamNames(methods, fieldNames, ObjectNode.class.cast(paramsNode));</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// unknown params node type</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;Unknown params node type: &quot;</span>+paramsNode.toString());</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n<p>所以我就明白了，除了null（不传参数），Array，Object，其他的类都是“Unknown params node type”，当时我也很疑惑，Integer不也是Object嘛，断点一下，原来它认为这是IntNode类，所以不能识别，其他的参数我也试过一些，目前还是数组是最靠谱的，网上资料还比较少，希望有懂得给指点指点。<br>这也是我今天花了半天时间弄得JSON-RPC，喜欢的朋友，源码地址在下面：<br><a href=\"https://github.com/hjcenry/json-rpc-demo\">https://github.com/hjcenry/json-rpc-demo</a></p>"},{"title":"微博开源框架Motan初体验","date":"2016-04-26T09:44:00.000Z","_content":"前两天，我在开源中国的微信公众号看到新浪微博的轻量Rpc框架——Motan开源了。上网查了下，才得知这个Motan来头不小，支撑着新浪微博的千亿调用，曾经在2014年的春晚中有着千亿次的调用，对抗了春晚的最高峰值。<!--more-->\n### 什么是Motan\n*2013 年微博 RPC 框架 Motan 在前辈大师们（福林、fishermen、小麦、王喆等）的精心设计和辛勤工作中诞生，向各位大师们致敬，也得到了微博各个技术团队的鼎力支持及不断完善，如今 Motan 在微博平台中已经广泛应用，每天为数百个服务完成近千亿次的调用。” —— 张雷*\n\n微博的Motan RPC服务，底层通讯引擎采用了Netty网络框架，序列化协议支持Hessian和Java序列化，通讯协议支持Motan、http、tcp、mc等，Motan框架在内部大量使用，在系统的健壮性和服务治理方面，有较为成熟的技术解决方案，健壮性上，基于Config配置管理服务实现了High Availability与Load Balance策略（支持灵活的FailOver和FailFast HA策略，以及Round Robin、LRU、Consistent Hash等Load Balance策略），服务治理方面，生成完整的服务调用链数据，服务请求性能数据，响应时间（Response Time）、QPS以及标准化Error、Exception日志信息。\n\nMotan 属于服务治理类型，是一个基于 Java 开发的高性能的轻量级 RPC 框架，Motan 提供了实用的服务治理功能和优秀的 RPC 协议扩展能力。\nMotan 提供的主要功能包括：\n**服务发现** ：服务发布、订阅、通知\n**高可用策略** ：失败重试（Failover）、快速失败（Failfast）、异常隔离（Server 连续失败超过指定次数置为不可用，然后定期进行心跳探测）\n**负载均衡** ：支持低并发优先、一致性 Hash、随机请求、轮询等\n**扩展性** ：支持 SPI 扩展（service provider interface）\n**其他** ：调用统计、访问日志等\n\nMotan 可以支持不同的 RPC 协议、传输协议。Motan 能够无缝支持 Spring 配置方式使用 RPC 服务，通过简单、灵活的配置就可以提供或使用 RPC 服务。通过使用 Motan 框架，可以十分方便的进行服务拆分、分布式服务部署。\n\n关于Motan的更多内容可参考：http://h2ex.com/820\n以及Motan的源码：https://github.com/weibocom/motan\n\n### 简单调用示例\n参照github中wiki，可以快速的跑一跑motan，提前感受一下，由于Motan刚开源，很多东西还不完整，我个人在这中间也遇到很多坑，后面一一介绍。我按照wiki介绍，先创建maven项目motandemo，\n#### 添加pom依赖\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>com.hjc.demo</groupId>\n\t<artifactId>motandemo</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<packaging>war</packaging>\n\t<name>motandemo</name>\n\t<repositories>\n\t\t<repository>\n\t\t\t<id>spy</id>\n\t\t\t<name>36</name>\n\t\t\t<layout>default</layout>\n\t\t\t<url>http://repo1.maven.org/maven2</url>\n\t\t\t<snapshots>\n\t\t\t\t<enabled>false</enabled>\n\t\t\t</snapshots>\n\t\t</repository>\n\t</repositories>\n\t<dependencies>\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>3.8.1</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.weibo</groupId>\n\t\t\t<artifactId>motan-core</artifactId>\n\t\t\t<version>0.0.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.weibo</groupId>\n\t\t\t<artifactId>motan-transport-netty</artifactId>\n\t\t\t<version>0.0.1</version>\n\t\t</dependency>\n\t\t<!-- 集群相关 -->\n\t\t<dependency>\n\t\t\t<groupId>com.weibo</groupId>\n\t\t\t<artifactId>motan-registry-consul</artifactId>\n\t\t\t<version>0.0.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.weibo</groupId>\n\t\t\t<artifactId>motan-registry-zookeeper</artifactId>\n\t\t\t<version>0.0.1</version>\n\t\t</dependency>\n\t\t<!-- dependencies blow were only needed for spring-based features -->\n\t\t<dependency>\n\t\t\t<groupId>com.weibo</groupId>\n\t\t\t<artifactId>motan-springsupport</artifactId>\n\t\t\t<version>0.0.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-context</artifactId>\n\t\t\t<version>4.0.5.RELEASE</version>\n\t\t</dependency>\n\t</dependencies>\n\t<build>\n\t\t<finalName>motan</finalName>\n\t</build>\n</project>\n```\n注意如果maven下载不下来可以去仓库直接搜，然后下载jar包，我在搭建的过程就遇到了jar包下载不下来的情况，可能是网络原因吧。\n仓库地址：http://mvnrepository.com/\n下载下来后使用maven进行本地安装，安装命令如下：\n```shell\nmvn install:install-file -Dfile=<path-to-file> -DgroupId=<group-id> -DartifactId=<artifact-id> -Dversion=<version> -Dpackaging=<packaging> \n```\n确定pom.xml不报错之后再进行下面的步骤\n#### 为服务方和调用方创建接口\n创建接口，服务方和调用方都使用这个接口FooService\nFooService:\n```java\npackage com.hjc.motan.server;\n\nimport java.util.List;\nimport java.util.Map;\n\nimport com.hjc.motan.DemoBean;\n\npublic interface FooService {\n\tpublic String hello(String name);\n\n\tpublic int helloInt(int number1);\n\n\tpublic double helloDouble(double number2);\n\n\tpublic List<String> helloList(List<String> list);\n\n\tpublic Map<String, List<String>> helloMap(Map<String, List<String>> map);\n\n\tpublic DemoBean helloJavabean(DemoBean bean);\n}\n```\n服务方来实现这个接口的逻辑\nFooServiceImpl:\n```java\npackage com.hjc.motan.server;\n\nimport java.util.List;\nimport java.util.Map;\n\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.support.ClassPathXmlApplicationContext;\n\nimport com.hjc.motan.DemoBean;\n\npublic class FooServiceImpl implements FooService {\n\n\tpublic static void main(String[] args) throws InterruptedException {\n\t\tApplicationContext applicationContext = new ClassPathXmlApplicationContext(\n\t\t\t\t\"classpath:motan_server.xml\");\n\t\tSystem.out.println(\"server start...\");\n\t}\n\n\tpublic String hello(String name) {\n\t\tSystem.out.println(\"invoked rpc service \" + name);\n\t\treturn \"hello \" + name;\n\t}\n\n\tpublic int helloInt(int number1) {\n\t\tSystem.out.println(\"invoked rpc service \" + number1);\n\t\treturn number1;\n\t}\n\n\tpublic double helloDouble(double number2) {\n\t\tSystem.out.println(\"invoked rpc service \" + number2);\n\t\treturn number2;\n\t}\n\n\tpublic List<String> helloList(List<String> list) {\n\t\tSystem.out.print(\"invoked rpc service \");\n\t\tfor (String string : list) {\n\t\t\tSystem.out.print(string + \",\");\n\t\t}\n\t\tSystem.out.println();\n\t\treturn list;\n\t}\n\n\tpublic Map<String, List<String>> helloMap(Map<String, List<String>> map) {\n\t\tSystem.out.print(\"invoked rpc service \");\n\t\tfor (String key : map.keySet()) {\n\t\t\tSystem.out.print(key + \":[\");\n\t\t\tfor (String list : map.get(key)) {\n\t\t\t\tSystem.out.print(list + \",\");\n\t\t\t}\n\t\t\tSystem.out.print(\"],\");\n\t\t}\n\t\tSystem.out.println();\n\t\treturn map;\n\t}\n\n\tpublic DemoBean helloJavabean(DemoBean bean) {\n\t\tSystem.out.print(\"invoked rpc service \" + bean);\n\t\tSystem.out.print(\",\" + bean.getId());\n\t\tSystem.out.print(\",\" + bean.getName());\n\t\tSystem.out.print(\",\" + bean.getScore());\n\t\tSystem.out.println();\n\t\treturn bean;\n\t}\n\n}\n```\n#### 配置服务方暴露接口\n在项目根目录（src/main/datasource）创建motan_server.xml，如下：\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xmlns:motan=\"http://api.weibo.com/schema/motan\"\n    xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd\n   http://api.weibo.com/schema/motan http://api.weibo.com/schema/motan.xsd\">\n\n    <!-- service implemention bean -->\n    <bean id=\"serviceImpl\" class=\"com.hjc.motan.server.FooServiceImpl\" />\n    <!-- exporting service by motan -->\n    <motan:service interface=\"com.hjc.motan.server.FooService\" ref=\"serviceImpl\" export=\"8002\" />\n</beans>\n```\n在这个过程中，我发现我的eclipse不能自动下载motan.xsd，这时候我只能手动配置，从motan-core的jar包中，找到这个schema文件，复制到任意位置，然后eclipse中，选择Window->Preferences->XML->XML Catalog->User Specified Entries，点击Add，输入Location和Key，按照如下图所示：\n\n![手动添加schema](http://upload-images.jianshu.io/upload_images/1472037-84987d6df57493e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n以上步骤完成之后，就可以启动Motan Rpc的服务方了，在FooServiceImpl中已经写好了main方法，右键run即可\n#### 配置调用方调用接口\n 在项目根目录（src/main/datasource）创建motan_server.xml，如下：\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\nxmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\nxmlns:motan=\"http://api.weibo.com/schema/motan\"\nxsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd\n   http://api.weibo.com/schema/motan http://api.weibo.com/schema/motan.xsd\">\n\n    <!-- reference to the remote service -->\n    <motan:referer id=\"remoteService\" interface=\"com.hjc.motan.server.FooService\" directUrl=\"localhost:8002\"/>\n</beans>\n```\n#### 调用方调用\n创建Client类调用服务方的接口并输出\nClient：\n```java\npackage com.hjc.motan.client;\n\nimport java.util.Arrays;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.ArrayList;\nimport java.util.Map;\n\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.support.ClassPathXmlApplicationContext;\n\nimport com.hjc.motan.DemoBean;\nimport com.hjc.motan.server.FooService;\n\npublic class Client {\n\n\tpublic static void main(String[] args) throws InterruptedException {\n\t\tApplicationContext ctx = new ClassPathXmlApplicationContext(\n\t\t\t\t\"classpath:motan_client.xml\");\n\t\t// 获取到service\n\t\tFooService service = (FooService) ctx.getBean(\"remoteService\");\n\t\t// rpc调用\n\t\t/** String **/\n\t\tString ret1 = service.hello(\"motan\");\n\t\tSystem.out.println(ret1);\n\t\t/** int **/\n\t\tint ret2 = service.helloInt(110);\n\t\tSystem.out.println(ret2);\n\t\t/** double **/\n\t\tdouble ret3 = service.helloDouble(11.2);\n\t\tSystem.out.println(ret3);\n\t\t/** list **/\n\t\tList<String> list = new ArrayList<String>();\n\t\tlist.add(\"hello\");\n\t\tlist.add(\"motan\");\n\t\tList<String> ret4 = service.helloList(list);\n\t\tfor (String string : ret4) {\n\t\t\tSystem.out.print(string + \",\");\n\t\t}\n\t\tSystem.out.println();\n\t\t/** map **/\n\t\tMap<String, List<String>> map = new HashMap<String, List<String>>();\n\t\tmap.put(\"key1\", Arrays.asList(new String[] { \"val1\",\"val2\" }));\n\t\tmap.put(\"key2\", Arrays.asList(new String[] { \"val1\",\"val2\",\"val3\" }));\n\t\tmap.put(\"key3\", Arrays.asList(new String[] { \"val1\",\"val2\",\"val3\",\"val4\" }));\n\t\tMap<String, List<String>> ret5 = service.helloMap(map);\n\t\tfor (String key : ret5.keySet()) {\n\t\t\tSystem.out.print(key + \":[\");\n\t\t\tfor (String tmp : map.get(key)) {\n\t\t\t\tSystem.out.print(tmp + \",\");\n\t\t\t}\n\t\t\tSystem.out.print(\"],\");\n\t\t}\n\t\tSystem.out.println();\n\t\t/** javabean **/\n\t\tDemoBean bean = new DemoBean();\n\t\tbean.setId(1001l);\n\t\tbean.setName(\"motan bean\");\n\t\tbean.setScore(99.998);\n\t\tDemoBean ret6 = service.helloJavabean(bean);\n\t\tSystem.out.print(ret6.getId());\n\t\tSystem.out.print(\",\" + ret6.getName());\n\t\tSystem.out.print(\",\" + ret6.getScore());\n\t\tSystem.out.println();\n\t}\n\n}\n```\n启动Client的main方法开始调用\n#### 输出结果\n通过以上demo创建了server端和client端，分别启动服务方和调用方之后，查看控制台输出如下：\n服务方：\n```\nserver start...\ninvoked rpc service motan\ninvoked rpc service 110\ninvoked rpc service 11.2\ninvoked rpc service hello,motan,\ninvoked rpc service key3:[val1,val2,val3,val4,],key2:[val1,val2,val3,],key1:[val1,val2,],\ninvoked rpc service com.hjc.motan.DemoBean@2cf3e1fd,1001,motan bean,99.998\n```\n调用方：\n```\nhello motan\n110\n11.2\nhello,motan,\nkey3:[val1,val2,val3,val4,],key2:[val1,val2,val3,],key1:[val1,val2,],\n1001,motan bean,99.998\n```\n### 集群调用示例\n实现集群使用只需要在上面的基础做一点稍稍的改变就可以，motan的集群与阿里的dubbo的原理类似，通过注册方、服务方、调用方三方来实现，三者关系图如下：\n\n![集群关系图](https://github.com/weibocom/motan/wiki/media/14612349319195.jpg)\n\n1. Server 向 Registry 注册服务，并向注册中心发送心跳汇报状态。\n2. Client 需要向注册中心订阅 RPC 服务，Client 根据 Registry 返回的服务列表，对具体的 Sever 进行 RPC 调用。\n3. 当 Server 发生变更时，Registry 会同步变更，Client 感知后会对本地的服务列表作相应调整。\n\n目前按照wiki说明，motan支持Consul和Zookeeper两种外部服务发现组件\n以下我们再上面实现的基础之上进行更改（两种组件分别有介绍）\n#### 添加pom依赖\n在最上面，其实已经写出来了\n```xml\n<!-- consul -->\n<dependency>\n\t<groupId>com.weibo</groupId>\n\t<artifactId>motan-registry-consul</artifactId>\n\t<version>0.0.1</version>\n</dependency>\n<!-- zookeeper -->\n<dependency>\n\t<groupId>com.weibo</groupId>\n\t<artifactId>motan-registry-zookeeper</artifactId>\n\t<version>0.0.1</version>\n</dependency>\n```\n#### 在server和client的配置文件中分别增加registry定义\nconsul\n```xml\n<motan:registry regProtocol=\"consul\" name=\"my_consul\" address=\"127.0.0.1:8500\"/>\n```\nzookeeper单节点\n```xml\n<motan:registry regProtocol=\"zookeeper\" name=\"my_zookeeper\" address=\"127.0.0.1:2181\"/>\n```\nzookeeper多节点集群\n```xml\n<motan:registry regProtocol=\"zookeeper\" name=\"my_zookeeper\" address=\"127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183\"/>\n```\n#### 在motan client及server配置改为通过registry服务发现\nconsul client\n```xml\n<motan:referer id=\"remoteService\" interface=\"quickstart.FooService\" registry=\"my_consul\"/>\n```\nconsul server\n```xml\n<motan:service interface=\"quickstart.FooService\" ref=\"serviceImpl\" registry=\"my_consul\" export=\"8002\" />\n```\nzookeeper client\n```xml\n<motan:referer id=\"remoteService\" interface=\"quickstart.FooService\" registry=\"my_zookeeper\"/>\n```\nzookeeper server\n```xml\n<motan:service interface=\"quickstart.FooService\" ref=\"serviceImpl\" registry=\"my_zookeeper\" export=\"8002\" />\n```\n#### 调用方调用服务\nconsul需要显示调用心跳开关注册到consul（zookeeper不需要）\n```java\nMotanSwitcherUtil.setSwitcher(ConsulConstants.NAMING_PROCESS_HEARTBEAT_SWITCHER, true)\n```\n\n### 总结\n我也是正好最近项目空闲，刚好又看到这么一则新闻，于是就动手了解了下，当然，我所做的只是浅层次的使用，至于更深层次的内容（如，跟dubbo等其他rpc框架的对比，集群上下线对zookeeper的影响等）还没来得及去研究，不过既然它曾经支撑过千亿的调用，那一定是经过实际运营检验的，作为搞技术的，也应该多去了解了解开源的东西，这里我想说一句，开源真好！\n另外，以上demo代码我也传到了我的github上，欢迎交流学习：\nhttps://github.com/hjcenry/motan-demo\n\n---\n*我的个人博客开通啦，每一篇文章都在简书跟个人博客同步，地址是：http://hjcenry.github.io*","source":"_posts/微博开源框架Motan初体验.md","raw":"---\ntitle: 微博开源框架Motan初体验\ndate: 2016-04-26 17:44\ncategories: Java\ntags: [Java,Motan,开源,rpc]\n---\n前两天，我在开源中国的微信公众号看到新浪微博的轻量Rpc框架——Motan开源了。上网查了下，才得知这个Motan来头不小，支撑着新浪微博的千亿调用，曾经在2014年的春晚中有着千亿次的调用，对抗了春晚的最高峰值。<!--more-->\n### 什么是Motan\n*2013 年微博 RPC 框架 Motan 在前辈大师们（福林、fishermen、小麦、王喆等）的精心设计和辛勤工作中诞生，向各位大师们致敬，也得到了微博各个技术团队的鼎力支持及不断完善，如今 Motan 在微博平台中已经广泛应用，每天为数百个服务完成近千亿次的调用。” —— 张雷*\n\n微博的Motan RPC服务，底层通讯引擎采用了Netty网络框架，序列化协议支持Hessian和Java序列化，通讯协议支持Motan、http、tcp、mc等，Motan框架在内部大量使用，在系统的健壮性和服务治理方面，有较为成熟的技术解决方案，健壮性上，基于Config配置管理服务实现了High Availability与Load Balance策略（支持灵活的FailOver和FailFast HA策略，以及Round Robin、LRU、Consistent Hash等Load Balance策略），服务治理方面，生成完整的服务调用链数据，服务请求性能数据，响应时间（Response Time）、QPS以及标准化Error、Exception日志信息。\n\nMotan 属于服务治理类型，是一个基于 Java 开发的高性能的轻量级 RPC 框架，Motan 提供了实用的服务治理功能和优秀的 RPC 协议扩展能力。\nMotan 提供的主要功能包括：\n**服务发现** ：服务发布、订阅、通知\n**高可用策略** ：失败重试（Failover）、快速失败（Failfast）、异常隔离（Server 连续失败超过指定次数置为不可用，然后定期进行心跳探测）\n**负载均衡** ：支持低并发优先、一致性 Hash、随机请求、轮询等\n**扩展性** ：支持 SPI 扩展（service provider interface）\n**其他** ：调用统计、访问日志等\n\nMotan 可以支持不同的 RPC 协议、传输协议。Motan 能够无缝支持 Spring 配置方式使用 RPC 服务，通过简单、灵活的配置就可以提供或使用 RPC 服务。通过使用 Motan 框架，可以十分方便的进行服务拆分、分布式服务部署。\n\n关于Motan的更多内容可参考：http://h2ex.com/820\n以及Motan的源码：https://github.com/weibocom/motan\n\n### 简单调用示例\n参照github中wiki，可以快速的跑一跑motan，提前感受一下，由于Motan刚开源，很多东西还不完整，我个人在这中间也遇到很多坑，后面一一介绍。我按照wiki介绍，先创建maven项目motandemo，\n#### 添加pom依赖\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>com.hjc.demo</groupId>\n\t<artifactId>motandemo</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<packaging>war</packaging>\n\t<name>motandemo</name>\n\t<repositories>\n\t\t<repository>\n\t\t\t<id>spy</id>\n\t\t\t<name>36</name>\n\t\t\t<layout>default</layout>\n\t\t\t<url>http://repo1.maven.org/maven2</url>\n\t\t\t<snapshots>\n\t\t\t\t<enabled>false</enabled>\n\t\t\t</snapshots>\n\t\t</repository>\n\t</repositories>\n\t<dependencies>\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>3.8.1</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.weibo</groupId>\n\t\t\t<artifactId>motan-core</artifactId>\n\t\t\t<version>0.0.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.weibo</groupId>\n\t\t\t<artifactId>motan-transport-netty</artifactId>\n\t\t\t<version>0.0.1</version>\n\t\t</dependency>\n\t\t<!-- 集群相关 -->\n\t\t<dependency>\n\t\t\t<groupId>com.weibo</groupId>\n\t\t\t<artifactId>motan-registry-consul</artifactId>\n\t\t\t<version>0.0.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.weibo</groupId>\n\t\t\t<artifactId>motan-registry-zookeeper</artifactId>\n\t\t\t<version>0.0.1</version>\n\t\t</dependency>\n\t\t<!-- dependencies blow were only needed for spring-based features -->\n\t\t<dependency>\n\t\t\t<groupId>com.weibo</groupId>\n\t\t\t<artifactId>motan-springsupport</artifactId>\n\t\t\t<version>0.0.1</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-context</artifactId>\n\t\t\t<version>4.0.5.RELEASE</version>\n\t\t</dependency>\n\t</dependencies>\n\t<build>\n\t\t<finalName>motan</finalName>\n\t</build>\n</project>\n```\n注意如果maven下载不下来可以去仓库直接搜，然后下载jar包，我在搭建的过程就遇到了jar包下载不下来的情况，可能是网络原因吧。\n仓库地址：http://mvnrepository.com/\n下载下来后使用maven进行本地安装，安装命令如下：\n```shell\nmvn install:install-file -Dfile=<path-to-file> -DgroupId=<group-id> -DartifactId=<artifact-id> -Dversion=<version> -Dpackaging=<packaging> \n```\n确定pom.xml不报错之后再进行下面的步骤\n#### 为服务方和调用方创建接口\n创建接口，服务方和调用方都使用这个接口FooService\nFooService:\n```java\npackage com.hjc.motan.server;\n\nimport java.util.List;\nimport java.util.Map;\n\nimport com.hjc.motan.DemoBean;\n\npublic interface FooService {\n\tpublic String hello(String name);\n\n\tpublic int helloInt(int number1);\n\n\tpublic double helloDouble(double number2);\n\n\tpublic List<String> helloList(List<String> list);\n\n\tpublic Map<String, List<String>> helloMap(Map<String, List<String>> map);\n\n\tpublic DemoBean helloJavabean(DemoBean bean);\n}\n```\n服务方来实现这个接口的逻辑\nFooServiceImpl:\n```java\npackage com.hjc.motan.server;\n\nimport java.util.List;\nimport java.util.Map;\n\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.support.ClassPathXmlApplicationContext;\n\nimport com.hjc.motan.DemoBean;\n\npublic class FooServiceImpl implements FooService {\n\n\tpublic static void main(String[] args) throws InterruptedException {\n\t\tApplicationContext applicationContext = new ClassPathXmlApplicationContext(\n\t\t\t\t\"classpath:motan_server.xml\");\n\t\tSystem.out.println(\"server start...\");\n\t}\n\n\tpublic String hello(String name) {\n\t\tSystem.out.println(\"invoked rpc service \" + name);\n\t\treturn \"hello \" + name;\n\t}\n\n\tpublic int helloInt(int number1) {\n\t\tSystem.out.println(\"invoked rpc service \" + number1);\n\t\treturn number1;\n\t}\n\n\tpublic double helloDouble(double number2) {\n\t\tSystem.out.println(\"invoked rpc service \" + number2);\n\t\treturn number2;\n\t}\n\n\tpublic List<String> helloList(List<String> list) {\n\t\tSystem.out.print(\"invoked rpc service \");\n\t\tfor (String string : list) {\n\t\t\tSystem.out.print(string + \",\");\n\t\t}\n\t\tSystem.out.println();\n\t\treturn list;\n\t}\n\n\tpublic Map<String, List<String>> helloMap(Map<String, List<String>> map) {\n\t\tSystem.out.print(\"invoked rpc service \");\n\t\tfor (String key : map.keySet()) {\n\t\t\tSystem.out.print(key + \":[\");\n\t\t\tfor (String list : map.get(key)) {\n\t\t\t\tSystem.out.print(list + \",\");\n\t\t\t}\n\t\t\tSystem.out.print(\"],\");\n\t\t}\n\t\tSystem.out.println();\n\t\treturn map;\n\t}\n\n\tpublic DemoBean helloJavabean(DemoBean bean) {\n\t\tSystem.out.print(\"invoked rpc service \" + bean);\n\t\tSystem.out.print(\",\" + bean.getId());\n\t\tSystem.out.print(\",\" + bean.getName());\n\t\tSystem.out.print(\",\" + bean.getScore());\n\t\tSystem.out.println();\n\t\treturn bean;\n\t}\n\n}\n```\n#### 配置服务方暴露接口\n在项目根目录（src/main/datasource）创建motan_server.xml，如下：\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xmlns:motan=\"http://api.weibo.com/schema/motan\"\n    xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd\n   http://api.weibo.com/schema/motan http://api.weibo.com/schema/motan.xsd\">\n\n    <!-- service implemention bean -->\n    <bean id=\"serviceImpl\" class=\"com.hjc.motan.server.FooServiceImpl\" />\n    <!-- exporting service by motan -->\n    <motan:service interface=\"com.hjc.motan.server.FooService\" ref=\"serviceImpl\" export=\"8002\" />\n</beans>\n```\n在这个过程中，我发现我的eclipse不能自动下载motan.xsd，这时候我只能手动配置，从motan-core的jar包中，找到这个schema文件，复制到任意位置，然后eclipse中，选择Window->Preferences->XML->XML Catalog->User Specified Entries，点击Add，输入Location和Key，按照如下图所示：\n\n![手动添加schema](http://upload-images.jianshu.io/upload_images/1472037-84987d6df57493e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n以上步骤完成之后，就可以启动Motan Rpc的服务方了，在FooServiceImpl中已经写好了main方法，右键run即可\n#### 配置调用方调用接口\n 在项目根目录（src/main/datasource）创建motan_server.xml，如下：\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\nxmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\nxmlns:motan=\"http://api.weibo.com/schema/motan\"\nxsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd\n   http://api.weibo.com/schema/motan http://api.weibo.com/schema/motan.xsd\">\n\n    <!-- reference to the remote service -->\n    <motan:referer id=\"remoteService\" interface=\"com.hjc.motan.server.FooService\" directUrl=\"localhost:8002\"/>\n</beans>\n```\n#### 调用方调用\n创建Client类调用服务方的接口并输出\nClient：\n```java\npackage com.hjc.motan.client;\n\nimport java.util.Arrays;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.ArrayList;\nimport java.util.Map;\n\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.support.ClassPathXmlApplicationContext;\n\nimport com.hjc.motan.DemoBean;\nimport com.hjc.motan.server.FooService;\n\npublic class Client {\n\n\tpublic static void main(String[] args) throws InterruptedException {\n\t\tApplicationContext ctx = new ClassPathXmlApplicationContext(\n\t\t\t\t\"classpath:motan_client.xml\");\n\t\t// 获取到service\n\t\tFooService service = (FooService) ctx.getBean(\"remoteService\");\n\t\t// rpc调用\n\t\t/** String **/\n\t\tString ret1 = service.hello(\"motan\");\n\t\tSystem.out.println(ret1);\n\t\t/** int **/\n\t\tint ret2 = service.helloInt(110);\n\t\tSystem.out.println(ret2);\n\t\t/** double **/\n\t\tdouble ret3 = service.helloDouble(11.2);\n\t\tSystem.out.println(ret3);\n\t\t/** list **/\n\t\tList<String> list = new ArrayList<String>();\n\t\tlist.add(\"hello\");\n\t\tlist.add(\"motan\");\n\t\tList<String> ret4 = service.helloList(list);\n\t\tfor (String string : ret4) {\n\t\t\tSystem.out.print(string + \",\");\n\t\t}\n\t\tSystem.out.println();\n\t\t/** map **/\n\t\tMap<String, List<String>> map = new HashMap<String, List<String>>();\n\t\tmap.put(\"key1\", Arrays.asList(new String[] { \"val1\",\"val2\" }));\n\t\tmap.put(\"key2\", Arrays.asList(new String[] { \"val1\",\"val2\",\"val3\" }));\n\t\tmap.put(\"key3\", Arrays.asList(new String[] { \"val1\",\"val2\",\"val3\",\"val4\" }));\n\t\tMap<String, List<String>> ret5 = service.helloMap(map);\n\t\tfor (String key : ret5.keySet()) {\n\t\t\tSystem.out.print(key + \":[\");\n\t\t\tfor (String tmp : map.get(key)) {\n\t\t\t\tSystem.out.print(tmp + \",\");\n\t\t\t}\n\t\t\tSystem.out.print(\"],\");\n\t\t}\n\t\tSystem.out.println();\n\t\t/** javabean **/\n\t\tDemoBean bean = new DemoBean();\n\t\tbean.setId(1001l);\n\t\tbean.setName(\"motan bean\");\n\t\tbean.setScore(99.998);\n\t\tDemoBean ret6 = service.helloJavabean(bean);\n\t\tSystem.out.print(ret6.getId());\n\t\tSystem.out.print(\",\" + ret6.getName());\n\t\tSystem.out.print(\",\" + ret6.getScore());\n\t\tSystem.out.println();\n\t}\n\n}\n```\n启动Client的main方法开始调用\n#### 输出结果\n通过以上demo创建了server端和client端，分别启动服务方和调用方之后，查看控制台输出如下：\n服务方：\n```\nserver start...\ninvoked rpc service motan\ninvoked rpc service 110\ninvoked rpc service 11.2\ninvoked rpc service hello,motan,\ninvoked rpc service key3:[val1,val2,val3,val4,],key2:[val1,val2,val3,],key1:[val1,val2,],\ninvoked rpc service com.hjc.motan.DemoBean@2cf3e1fd,1001,motan bean,99.998\n```\n调用方：\n```\nhello motan\n110\n11.2\nhello,motan,\nkey3:[val1,val2,val3,val4,],key2:[val1,val2,val3,],key1:[val1,val2,],\n1001,motan bean,99.998\n```\n### 集群调用示例\n实现集群使用只需要在上面的基础做一点稍稍的改变就可以，motan的集群与阿里的dubbo的原理类似，通过注册方、服务方、调用方三方来实现，三者关系图如下：\n\n![集群关系图](https://github.com/weibocom/motan/wiki/media/14612349319195.jpg)\n\n1. Server 向 Registry 注册服务，并向注册中心发送心跳汇报状态。\n2. Client 需要向注册中心订阅 RPC 服务，Client 根据 Registry 返回的服务列表，对具体的 Sever 进行 RPC 调用。\n3. 当 Server 发生变更时，Registry 会同步变更，Client 感知后会对本地的服务列表作相应调整。\n\n目前按照wiki说明，motan支持Consul和Zookeeper两种外部服务发现组件\n以下我们再上面实现的基础之上进行更改（两种组件分别有介绍）\n#### 添加pom依赖\n在最上面，其实已经写出来了\n```xml\n<!-- consul -->\n<dependency>\n\t<groupId>com.weibo</groupId>\n\t<artifactId>motan-registry-consul</artifactId>\n\t<version>0.0.1</version>\n</dependency>\n<!-- zookeeper -->\n<dependency>\n\t<groupId>com.weibo</groupId>\n\t<artifactId>motan-registry-zookeeper</artifactId>\n\t<version>0.0.1</version>\n</dependency>\n```\n#### 在server和client的配置文件中分别增加registry定义\nconsul\n```xml\n<motan:registry regProtocol=\"consul\" name=\"my_consul\" address=\"127.0.0.1:8500\"/>\n```\nzookeeper单节点\n```xml\n<motan:registry regProtocol=\"zookeeper\" name=\"my_zookeeper\" address=\"127.0.0.1:2181\"/>\n```\nzookeeper多节点集群\n```xml\n<motan:registry regProtocol=\"zookeeper\" name=\"my_zookeeper\" address=\"127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183\"/>\n```\n#### 在motan client及server配置改为通过registry服务发现\nconsul client\n```xml\n<motan:referer id=\"remoteService\" interface=\"quickstart.FooService\" registry=\"my_consul\"/>\n```\nconsul server\n```xml\n<motan:service interface=\"quickstart.FooService\" ref=\"serviceImpl\" registry=\"my_consul\" export=\"8002\" />\n```\nzookeeper client\n```xml\n<motan:referer id=\"remoteService\" interface=\"quickstart.FooService\" registry=\"my_zookeeper\"/>\n```\nzookeeper server\n```xml\n<motan:service interface=\"quickstart.FooService\" ref=\"serviceImpl\" registry=\"my_zookeeper\" export=\"8002\" />\n```\n#### 调用方调用服务\nconsul需要显示调用心跳开关注册到consul（zookeeper不需要）\n```java\nMotanSwitcherUtil.setSwitcher(ConsulConstants.NAMING_PROCESS_HEARTBEAT_SWITCHER, true)\n```\n\n### 总结\n我也是正好最近项目空闲，刚好又看到这么一则新闻，于是就动手了解了下，当然，我所做的只是浅层次的使用，至于更深层次的内容（如，跟dubbo等其他rpc框架的对比，集群上下线对zookeeper的影响等）还没来得及去研究，不过既然它曾经支撑过千亿的调用，那一定是经过实际运营检验的，作为搞技术的，也应该多去了解了解开源的东西，这里我想说一句，开源真好！\n另外，以上demo代码我也传到了我的github上，欢迎交流学习：\nhttps://github.com/hjcenry/motan-demo\n\n---\n*我的个人博客开通啦，每一篇文章都在简书跟个人博客同步，地址是：http://hjcenry.github.io*","slug":"微博开源框架Motan初体验","published":1,"updated":"2016-04-26T14:21:12.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhuv002jwsazfp1n7k4z","content":"<p>前两天，我在开源中国的微信公众号看到新浪微博的轻量Rpc框架——Motan开源了。上网查了下，才得知这个Motan来头不小，支撑着新浪微博的千亿调用，曾经在2014年的春晚中有着千亿次的调用，对抗了春晚的最高峰值。<a id=\"more\"></a></p>\n<h3 id=\"什么是Motan\"><a href=\"#什么是Motan\" class=\"headerlink\" title=\"什么是Motan\"></a>什么是Motan</h3><p><em>2013 年微博 RPC 框架 Motan 在前辈大师们（福林、fishermen、小麦、王喆等）的精心设计和辛勤工作中诞生，向各位大师们致敬，也得到了微博各个技术团队的鼎力支持及不断完善，如今 Motan 在微博平台中已经广泛应用，每天为数百个服务完成近千亿次的调用。” —— 张雷</em></p>\n<p>微博的Motan RPC服务，底层通讯引擎采用了Netty网络框架，序列化协议支持Hessian和Java序列化，通讯协议支持Motan、http、tcp、mc等，Motan框架在内部大量使用，在系统的健壮性和服务治理方面，有较为成熟的技术解决方案，健壮性上，基于Config配置管理服务实现了High Availability与Load Balance策略（支持灵活的FailOver和FailFast HA策略，以及Round Robin、LRU、Consistent Hash等Load Balance策略），服务治理方面，生成完整的服务调用链数据，服务请求性能数据，响应时间（Response Time）、QPS以及标准化Error、Exception日志信息。</p>\n<p>Motan 属于服务治理类型，是一个基于 Java 开发的高性能的轻量级 RPC 框架，Motan 提供了实用的服务治理功能和优秀的 RPC 协议扩展能力。<br>Motan 提供的主要功能包括：<br><strong>服务发现</strong> ：服务发布、订阅、通知<br><strong>高可用策略</strong> ：失败重试（Failover）、快速失败（Failfast）、异常隔离（Server 连续失败超过指定次数置为不可用，然后定期进行心跳探测）<br><strong>负载均衡</strong> ：支持低并发优先、一致性 Hash、随机请求、轮询等<br><strong>扩展性</strong> ：支持 SPI 扩展（service provider interface）<br><strong>其他</strong> ：调用统计、访问日志等</p>\n<p>Motan 可以支持不同的 RPC 协议、传输协议。Motan 能够无缝支持 Spring 配置方式使用 RPC 服务，通过简单、灵活的配置就可以提供或使用 RPC 服务。通过使用 Motan 框架，可以十分方便的进行服务拆分、分布式服务部署。</p>\n<p>关于Motan的更多内容可参考：<a href=\"http://h2ex.com/820\">http://h2ex.com/820</a><br>以及Motan的源码：<a href=\"https://github.com/weibocom/motan\">https://github.com/weibocom/motan</a></p>\n<h3 id=\"简单调用示例\"><a href=\"#简单调用示例\" class=\"headerlink\" title=\"简单调用示例\"></a>简单调用示例</h3><p>参照github中wiki，可以快速的跑一跑motan，提前感受一下，由于Motan刚开源，很多东西还不完整，我个人在这中间也遇到很多坑，后面一一介绍。我按照wiki介绍，先创建maven项目motandemo，</p>\n<h4 id=\"添加pom依赖\"><a href=\"#添加pom依赖\" class=\"headerlink\" title=\"添加pom依赖\"></a>添加pom依赖</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.hjc.demo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motandemo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>war<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>motandemo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spy<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>36<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">layout</span>&gt;</span>default<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://repo1.maven.org/maven2<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.8.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-transport-netty<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!-- 集群相关 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-registry-consul<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-registry-zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!-- dependencies blow were only needed for spring-based features --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-springsupport<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.0.5.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>motan<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>注意如果maven下载不下来可以去仓库直接搜，然后下载jar包，我在搭建的过程就遇到了jar包下载不下来的情况，可能是网络原因吧。<br>仓库地址：<a href=\"http://mvnrepository.com/\">http://mvnrepository.com/</a><br>下载下来后使用maven进行本地安装，安装命令如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install:install-file -Dfile=&lt;path-to-file&gt; -DgroupId=&lt;group-id&gt; -DartifactId=&lt;artifact-id&gt; -Dversion=&lt;version&gt; -Dpackaging=&lt;packaging&gt; </span><br></pre></td></tr></table></figure>\n<p>确定pom.xml不报错之后再进行下面的步骤</p>\n<h4 id=\"为服务方和调用方创建接口\"><a href=\"#为服务方和调用方创建接口\" class=\"headerlink\" title=\"为服务方和调用方创建接口\"></a>为服务方和调用方创建接口</h4><p>创建接口，服务方和调用方都使用这个接口FooService<br>FooService:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.motan.server;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc.motan.DemoBean;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">FooService</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">hello</span><span class=\"params\">(String name)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">helloInt</span><span class=\"params\">(<span class=\"keyword\">int</span> number1)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">double</span> <span class=\"title\">helloDouble</span><span class=\"params\">(<span class=\"keyword\">double</span> number2)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List&lt;String&gt; <span class=\"title\">helloList</span><span class=\"params\">(List&lt;String&gt; list)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> Map&lt;String, List&lt;String&gt;&gt; helloMap(Map&lt;String, List&lt;String&gt;&gt; map);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> DemoBean <span class=\"title\">helloJavabean</span><span class=\"params\">(DemoBean bean)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>服务方来实现这个接口的逻辑<br>FooServiceImpl:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.motan.server;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.ApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc.motan.DemoBean;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FooServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">FooService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">\t\tApplicationContext applicationContext = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;classpath:motan_server.xml&quot;</span>);</span><br><span class=\"line\">\t\tSystem.out.println(<span class=\"string\">&quot;server start...&quot;</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">hello</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">\t\tSystem.out.println(<span class=\"string\">&quot;invoked rpc service &quot;</span> + name);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"string\">&quot;hello &quot;</span> + name;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">helloInt</span><span class=\"params\">(<span class=\"keyword\">int</span> number1)</span> </span>&#123;</span><br><span class=\"line\">\t\tSystem.out.println(<span class=\"string\">&quot;invoked rpc service &quot;</span> + number1);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> number1;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">double</span> <span class=\"title\">helloDouble</span><span class=\"params\">(<span class=\"keyword\">double</span> number2)</span> </span>&#123;</span><br><span class=\"line\">\t\tSystem.out.println(<span class=\"string\">&quot;invoked rpc service &quot;</span> + number2);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> number2;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List&lt;String&gt; <span class=\"title\">helloList</span><span class=\"params\">(List&lt;String&gt; list)</span> </span>&#123;</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;invoked rpc service &quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (String string : list) &#123;</span><br><span class=\"line\">\t\t\tSystem.out.print(string + <span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tSystem.out.println();</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> list;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> Map&lt;String, List&lt;String&gt;&gt; helloMap(Map&lt;String, List&lt;String&gt;&gt; map) &#123;</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;invoked rpc service &quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (String key : map.keySet()) &#123;</span><br><span class=\"line\">\t\t\tSystem.out.print(key + <span class=\"string\">&quot;:[&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (String list : map.get(key)) &#123;</span><br><span class=\"line\">\t\t\t\tSystem.out.print(list + <span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tSystem.out.print(<span class=\"string\">&quot;],&quot;</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tSystem.out.println();</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> map;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> DemoBean <span class=\"title\">helloJavabean</span><span class=\"params\">(DemoBean bean)</span> </span>&#123;</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;invoked rpc service &quot;</span> + bean);</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;,&quot;</span> + bean.getId());</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;,&quot;</span> + bean.getName());</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;,&quot;</span> + bean.getScore());</span><br><span class=\"line\">\t\tSystem.out.println();</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> bean;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"配置服务方暴露接口\"><a href=\"#配置服务方暴露接口\" class=\"headerlink\" title=\"配置服务方暴露接口\"></a>配置服务方暴露接口</h4><p>在项目根目录（src/main/datasource）创建motan_server.xml，如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:motan</span>=<span class=\"string\">&quot;http://api.weibo.com/schema/motan&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">   http://api.weibo.com/schema/motan http://api.weibo.com/schema/motan.xsd&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- service implemention bean --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;serviceImpl&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;com.hjc.motan.server.FooServiceImpl&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- exporting service by motan --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">motan:service</span> <span class=\"attr\">interface</span>=<span class=\"string\">&quot;com.hjc.motan.server.FooService&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;serviceImpl&quot;</span> <span class=\"attr\">export</span>=<span class=\"string\">&quot;8002&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在这个过程中，我发现我的eclipse不能自动下载motan.xsd，这时候我只能手动配置，从motan-core的jar包中，找到这个schema文件，复制到任意位置，然后eclipse中，选择Window-&gt;Preferences-&gt;XML-&gt;XML Catalog-&gt;User Specified Entries，点击Add，输入Location和Key，按照如下图所示：</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/1472037-84987d6df57493e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"手动添加schema\"></p>\n<p>以上步骤完成之后，就可以启动Motan Rpc的服务方了，在FooServiceImpl中已经写好了main方法，右键run即可</p>\n<h4 id=\"配置调用方调用接口\"><a href=\"#配置调用方调用接口\" class=\"headerlink\" title=\"配置调用方调用接口\"></a>配置调用方调用接口</h4><p> 在项目根目录（src/main/datasource）创建motan_server.xml，如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"attr\">xmlns:motan</span>=<span class=\"string\">&quot;http://api.weibo.com/schema/motan&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">   http://api.weibo.com/schema/motan http://api.weibo.com/schema/motan.xsd&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- reference to the remote service --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">motan:referer</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;remoteService&quot;</span> <span class=\"attr\">interface</span>=<span class=\"string\">&quot;com.hjc.motan.server.FooService&quot;</span> <span class=\"attr\">directUrl</span>=<span class=\"string\">&quot;localhost:8002&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"调用方调用\"><a href=\"#调用方调用\" class=\"headerlink\" title=\"调用方调用\"></a>调用方调用</h4><p>创建Client类调用服务方的接口并输出<br>Client：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.motan.client;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.ApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc.motan.DemoBean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc.motan.server.FooService;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Client</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">\t\tApplicationContext ctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;classpath:motan_client.xml&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"comment\">// 获取到service</span></span><br><span class=\"line\">\t\tFooService service = (FooService) ctx.getBean(<span class=\"string\">&quot;remoteService&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"comment\">// rpc调用</span></span><br><span class=\"line\">\t\t<span class=\"comment\">/** String **/</span></span><br><span class=\"line\">\t\tString ret1 = service.hello(<span class=\"string\">&quot;motan&quot;</span>);</span><br><span class=\"line\">\t\tSystem.out.println(ret1);</span><br><span class=\"line\">\t\t<span class=\"comment\">/** int **/</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> ret2 = service.helloInt(<span class=\"number\">110</span>);</span><br><span class=\"line\">\t\tSystem.out.println(ret2);</span><br><span class=\"line\">\t\t<span class=\"comment\">/** double **/</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">double</span> ret3 = service.helloDouble(<span class=\"number\">11.2</span>);</span><br><span class=\"line\">\t\tSystem.out.println(ret3);</span><br><span class=\"line\">\t\t<span class=\"comment\">/** list **/</span></span><br><span class=\"line\">\t\tList&lt;String&gt; list = <span class=\"keyword\">new</span> ArrayList&lt;String&gt;();</span><br><span class=\"line\">\t\tlist.add(<span class=\"string\">&quot;hello&quot;</span>);</span><br><span class=\"line\">\t\tlist.add(<span class=\"string\">&quot;motan&quot;</span>);</span><br><span class=\"line\">\t\tList&lt;String&gt; ret4 = service.helloList(list);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (String string : ret4) &#123;</span><br><span class=\"line\">\t\t\tSystem.out.print(string + <span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tSystem.out.println();</span><br><span class=\"line\">\t\t<span class=\"comment\">/** map **/</span></span><br><span class=\"line\">\t\tMap&lt;String, List&lt;String&gt;&gt; map = <span class=\"keyword\">new</span> HashMap&lt;String, List&lt;String&gt;&gt;();</span><br><span class=\"line\">\t\tmap.put(<span class=\"string\">&quot;key1&quot;</span>, Arrays.asList(<span class=\"keyword\">new</span> String[] &#123; <span class=\"string\">&quot;val1&quot;</span>,<span class=\"string\">&quot;val2&quot;</span> &#125;));</span><br><span class=\"line\">\t\tmap.put(<span class=\"string\">&quot;key2&quot;</span>, Arrays.asList(<span class=\"keyword\">new</span> String[] &#123; <span class=\"string\">&quot;val1&quot;</span>,<span class=\"string\">&quot;val2&quot;</span>,<span class=\"string\">&quot;val3&quot;</span> &#125;));</span><br><span class=\"line\">\t\tmap.put(<span class=\"string\">&quot;key3&quot;</span>, Arrays.asList(<span class=\"keyword\">new</span> String[] &#123; <span class=\"string\">&quot;val1&quot;</span>,<span class=\"string\">&quot;val2&quot;</span>,<span class=\"string\">&quot;val3&quot;</span>,<span class=\"string\">&quot;val4&quot;</span> &#125;));</span><br><span class=\"line\">\t\tMap&lt;String, List&lt;String&gt;&gt; ret5 = service.helloMap(map);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (String key : ret5.keySet()) &#123;</span><br><span class=\"line\">\t\t\tSystem.out.print(key + <span class=\"string\">&quot;:[&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (String tmp : map.get(key)) &#123;</span><br><span class=\"line\">\t\t\t\tSystem.out.print(tmp + <span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tSystem.out.print(<span class=\"string\">&quot;],&quot;</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tSystem.out.println();</span><br><span class=\"line\">\t\t<span class=\"comment\">/** javabean **/</span></span><br><span class=\"line\">\t\tDemoBean bean = <span class=\"keyword\">new</span> DemoBean();</span><br><span class=\"line\">\t\tbean.setId(<span class=\"number\">1001l</span>);</span><br><span class=\"line\">\t\tbean.setName(<span class=\"string\">&quot;motan bean&quot;</span>);</span><br><span class=\"line\">\t\tbean.setScore(<span class=\"number\">99.998</span>);</span><br><span class=\"line\">\t\tDemoBean ret6 = service.helloJavabean(bean);</span><br><span class=\"line\">\t\tSystem.out.print(ret6.getId());</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;,&quot;</span> + ret6.getName());</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;,&quot;</span> + ret6.getScore());</span><br><span class=\"line\">\t\tSystem.out.println();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>启动Client的main方法开始调用</p>\n<h4 id=\"输出结果\"><a href=\"#输出结果\" class=\"headerlink\" title=\"输出结果\"></a>输出结果</h4><p>通过以上demo创建了server端和client端，分别启动服务方和调用方之后，查看控制台输出如下：<br>服务方：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server start...</span><br><span class=\"line\">invoked rpc service motan</span><br><span class=\"line\">invoked rpc service 110</span><br><span class=\"line\">invoked rpc service 11.2</span><br><span class=\"line\">invoked rpc service hello,motan,</span><br><span class=\"line\">invoked rpc service key3:[val1,val2,val3,val4,],key2:[val1,val2,val3,],key1:[val1,val2,],</span><br><span class=\"line\">invoked rpc service com.hjc.motan.DemoBean@2cf3e1fd,1001,motan bean,99.998</span><br></pre></td></tr></table></figure>\n<p>调用方：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello motan</span><br><span class=\"line\">110</span><br><span class=\"line\">11.2</span><br><span class=\"line\">hello,motan,</span><br><span class=\"line\">key3:[val1,val2,val3,val4,],key2:[val1,val2,val3,],key1:[val1,val2,],</span><br><span class=\"line\">1001,motan bean,99.998</span><br></pre></td></tr></table></figure>\n<h3 id=\"集群调用示例\"><a href=\"#集群调用示例\" class=\"headerlink\" title=\"集群调用示例\"></a>集群调用示例</h3><p>实现集群使用只需要在上面的基础做一点稍稍的改变就可以，motan的集群与阿里的dubbo的原理类似，通过注册方、服务方、调用方三方来实现，三者关系图如下：</p>\n<p><img src=\"https://github.com/weibocom/motan/wiki/media/14612349319195.jpg\" alt=\"集群关系图\"></p>\n<ol>\n<li>Server 向 Registry 注册服务，并向注册中心发送心跳汇报状态。</li>\n<li>Client 需要向注册中心订阅 RPC 服务，Client 根据 Registry 返回的服务列表，对具体的 Sever 进行 RPC 调用。</li>\n<li>当 Server 发生变更时，Registry 会同步变更，Client 感知后会对本地的服务列表作相应调整。</li>\n</ol>\n<p>目前按照wiki说明，motan支持Consul和Zookeeper两种外部服务发现组件<br>以下我们再上面实现的基础之上进行更改（两种组件分别有介绍）</p>\n<h4 id=\"添加pom依赖-1\"><a href=\"#添加pom依赖-1\" class=\"headerlink\" title=\"添加pom依赖\"></a>添加pom依赖</h4><p>在最上面，其实已经写出来了</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- consul --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-registry-consul<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- zookeeper --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-registry-zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"在server和client的配置文件中分别增加registry定义\"><a href=\"#在server和client的配置文件中分别增加registry定义\" class=\"headerlink\" title=\"在server和client的配置文件中分别增加registry定义\"></a>在server和client的配置文件中分别增加registry定义</h4><p>consul</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:registry</span> <span class=\"attr\">regProtocol</span>=<span class=\"string\">&quot;consul&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;my_consul&quot;</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;127.0.0.1:8500&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>zookeeper单节点</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:registry</span> <span class=\"attr\">regProtocol</span>=<span class=\"string\">&quot;zookeeper&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;my_zookeeper&quot;</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;127.0.0.1:2181&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>zookeeper多节点集群</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:registry</span> <span class=\"attr\">regProtocol</span>=<span class=\"string\">&quot;zookeeper&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;my_zookeeper&quot;</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"在motan-client及server配置改为通过registry服务发现\"><a href=\"#在motan-client及server配置改为通过registry服务发现\" class=\"headerlink\" title=\"在motan client及server配置改为通过registry服务发现\"></a>在motan client及server配置改为通过registry服务发现</h4><p>consul client</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:referer</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;remoteService&quot;</span> <span class=\"attr\">interface</span>=<span class=\"string\">&quot;quickstart.FooService&quot;</span> <span class=\"attr\">registry</span>=<span class=\"string\">&quot;my_consul&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>consul server</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:service</span> <span class=\"attr\">interface</span>=<span class=\"string\">&quot;quickstart.FooService&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;serviceImpl&quot;</span> <span class=\"attr\">registry</span>=<span class=\"string\">&quot;my_consul&quot;</span> <span class=\"attr\">export</span>=<span class=\"string\">&quot;8002&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>zookeeper client</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:referer</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;remoteService&quot;</span> <span class=\"attr\">interface</span>=<span class=\"string\">&quot;quickstart.FooService&quot;</span> <span class=\"attr\">registry</span>=<span class=\"string\">&quot;my_zookeeper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>zookeeper server</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:service</span> <span class=\"attr\">interface</span>=<span class=\"string\">&quot;quickstart.FooService&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;serviceImpl&quot;</span> <span class=\"attr\">registry</span>=<span class=\"string\">&quot;my_zookeeper&quot;</span> <span class=\"attr\">export</span>=<span class=\"string\">&quot;8002&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"调用方调用服务\"><a href=\"#调用方调用服务\" class=\"headerlink\" title=\"调用方调用服务\"></a>调用方调用服务</h4><p>consul需要显示调用心跳开关注册到consul（zookeeper不需要）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MotanSwitcherUtil.setSwitcher(ConsulConstants.NAMING_PROCESS_HEARTBEAT_SWITCHER, <span class=\"keyword\">true</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>我也是正好最近项目空闲，刚好又看到这么一则新闻，于是就动手了解了下，当然，我所做的只是浅层次的使用，至于更深层次的内容（如，跟dubbo等其他rpc框架的对比，集群上下线对zookeeper的影响等）还没来得及去研究，不过既然它曾经支撑过千亿的调用，那一定是经过实际运营检验的，作为搞技术的，也应该多去了解了解开源的东西，这里我想说一句，开源真好！<br>另外，以上demo代码我也传到了我的github上，欢迎交流学习：<br><a href=\"https://github.com/hjcenry/motan-demo\">https://github.com/hjcenry/motan-demo</a></p>\n<hr>\n<p><em>我的个人博客开通啦，每一篇文章都在简书跟个人博客同步，地址是：<a href=\"http://hjcenry.github.io/\">http://hjcenry.github.io</a></em></p>\n","site":{"data":{}},"excerpt":"<p>前两天，我在开源中国的微信公众号看到新浪微博的轻量Rpc框架——Motan开源了。上网查了下，才得知这个Motan来头不小，支撑着新浪微博的千亿调用，曾经在2014年的春晚中有着千亿次的调用，对抗了春晚的最高峰值。","more":"</p>\n<h3 id=\"什么是Motan\"><a href=\"#什么是Motan\" class=\"headerlink\" title=\"什么是Motan\"></a>什么是Motan</h3><p><em>2013 年微博 RPC 框架 Motan 在前辈大师们（福林、fishermen、小麦、王喆等）的精心设计和辛勤工作中诞生，向各位大师们致敬，也得到了微博各个技术团队的鼎力支持及不断完善，如今 Motan 在微博平台中已经广泛应用，每天为数百个服务完成近千亿次的调用。” —— 张雷</em></p>\n<p>微博的Motan RPC服务，底层通讯引擎采用了Netty网络框架，序列化协议支持Hessian和Java序列化，通讯协议支持Motan、http、tcp、mc等，Motan框架在内部大量使用，在系统的健壮性和服务治理方面，有较为成熟的技术解决方案，健壮性上，基于Config配置管理服务实现了High Availability与Load Balance策略（支持灵活的FailOver和FailFast HA策略，以及Round Robin、LRU、Consistent Hash等Load Balance策略），服务治理方面，生成完整的服务调用链数据，服务请求性能数据，响应时间（Response Time）、QPS以及标准化Error、Exception日志信息。</p>\n<p>Motan 属于服务治理类型，是一个基于 Java 开发的高性能的轻量级 RPC 框架，Motan 提供了实用的服务治理功能和优秀的 RPC 协议扩展能力。<br>Motan 提供的主要功能包括：<br><strong>服务发现</strong> ：服务发布、订阅、通知<br><strong>高可用策略</strong> ：失败重试（Failover）、快速失败（Failfast）、异常隔离（Server 连续失败超过指定次数置为不可用，然后定期进行心跳探测）<br><strong>负载均衡</strong> ：支持低并发优先、一致性 Hash、随机请求、轮询等<br><strong>扩展性</strong> ：支持 SPI 扩展（service provider interface）<br><strong>其他</strong> ：调用统计、访问日志等</p>\n<p>Motan 可以支持不同的 RPC 协议、传输协议。Motan 能够无缝支持 Spring 配置方式使用 RPC 服务，通过简单、灵活的配置就可以提供或使用 RPC 服务。通过使用 Motan 框架，可以十分方便的进行服务拆分、分布式服务部署。</p>\n<p>关于Motan的更多内容可参考：<a href=\"http://h2ex.com/820\">http://h2ex.com/820</a><br>以及Motan的源码：<a href=\"https://github.com/weibocom/motan\">https://github.com/weibocom/motan</a></p>\n<h3 id=\"简单调用示例\"><a href=\"#简单调用示例\" class=\"headerlink\" title=\"简单调用示例\"></a>简单调用示例</h3><p>参照github中wiki，可以快速的跑一跑motan，提前感受一下，由于Motan刚开源，很多东西还不完整，我个人在这中间也遇到很多坑，后面一一介绍。我按照wiki介绍，先创建maven项目motandemo，</p>\n<h4 id=\"添加pom依赖\"><a href=\"#添加pom依赖\" class=\"headerlink\" title=\"添加pom依赖\"></a>添加pom依赖</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.hjc.demo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motandemo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>war<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>motandemo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spy<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>36<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">layout</span>&gt;</span>default<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://repo1.maven.org/maven2<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.8.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-transport-netty<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!-- 集群相关 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-registry-consul<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-registry-zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!-- dependencies blow were only needed for spring-based features --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-springsupport<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.0.5.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>motan<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>注意如果maven下载不下来可以去仓库直接搜，然后下载jar包，我在搭建的过程就遇到了jar包下载不下来的情况，可能是网络原因吧。<br>仓库地址：<a href=\"http://mvnrepository.com/\">http://mvnrepository.com/</a><br>下载下来后使用maven进行本地安装，安装命令如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install:install-file -Dfile=&lt;path-to-file&gt; -DgroupId=&lt;group-id&gt; -DartifactId=&lt;artifact-id&gt; -Dversion=&lt;version&gt; -Dpackaging=&lt;packaging&gt; </span><br></pre></td></tr></table></figure>\n<p>确定pom.xml不报错之后再进行下面的步骤</p>\n<h4 id=\"为服务方和调用方创建接口\"><a href=\"#为服务方和调用方创建接口\" class=\"headerlink\" title=\"为服务方和调用方创建接口\"></a>为服务方和调用方创建接口</h4><p>创建接口，服务方和调用方都使用这个接口FooService<br>FooService:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.motan.server;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc.motan.DemoBean;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">FooService</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">hello</span><span class=\"params\">(String name)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">helloInt</span><span class=\"params\">(<span class=\"keyword\">int</span> number1)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">double</span> <span class=\"title\">helloDouble</span><span class=\"params\">(<span class=\"keyword\">double</span> number2)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List&lt;String&gt; <span class=\"title\">helloList</span><span class=\"params\">(List&lt;String&gt; list)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> Map&lt;String, List&lt;String&gt;&gt; helloMap(Map&lt;String, List&lt;String&gt;&gt; map);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> DemoBean <span class=\"title\">helloJavabean</span><span class=\"params\">(DemoBean bean)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>服务方来实现这个接口的逻辑<br>FooServiceImpl:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.motan.server;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.ApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc.motan.DemoBean;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FooServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">FooService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">\t\tApplicationContext applicationContext = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;classpath:motan_server.xml&quot;</span>);</span><br><span class=\"line\">\t\tSystem.out.println(<span class=\"string\">&quot;server start...&quot;</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">hello</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">\t\tSystem.out.println(<span class=\"string\">&quot;invoked rpc service &quot;</span> + name);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"string\">&quot;hello &quot;</span> + name;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">helloInt</span><span class=\"params\">(<span class=\"keyword\">int</span> number1)</span> </span>&#123;</span><br><span class=\"line\">\t\tSystem.out.println(<span class=\"string\">&quot;invoked rpc service &quot;</span> + number1);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> number1;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">double</span> <span class=\"title\">helloDouble</span><span class=\"params\">(<span class=\"keyword\">double</span> number2)</span> </span>&#123;</span><br><span class=\"line\">\t\tSystem.out.println(<span class=\"string\">&quot;invoked rpc service &quot;</span> + number2);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> number2;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List&lt;String&gt; <span class=\"title\">helloList</span><span class=\"params\">(List&lt;String&gt; list)</span> </span>&#123;</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;invoked rpc service &quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (String string : list) &#123;</span><br><span class=\"line\">\t\t\tSystem.out.print(string + <span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tSystem.out.println();</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> list;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> Map&lt;String, List&lt;String&gt;&gt; helloMap(Map&lt;String, List&lt;String&gt;&gt; map) &#123;</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;invoked rpc service &quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (String key : map.keySet()) &#123;</span><br><span class=\"line\">\t\t\tSystem.out.print(key + <span class=\"string\">&quot;:[&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (String list : map.get(key)) &#123;</span><br><span class=\"line\">\t\t\t\tSystem.out.print(list + <span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tSystem.out.print(<span class=\"string\">&quot;],&quot;</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tSystem.out.println();</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> map;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> DemoBean <span class=\"title\">helloJavabean</span><span class=\"params\">(DemoBean bean)</span> </span>&#123;</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;invoked rpc service &quot;</span> + bean);</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;,&quot;</span> + bean.getId());</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;,&quot;</span> + bean.getName());</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;,&quot;</span> + bean.getScore());</span><br><span class=\"line\">\t\tSystem.out.println();</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> bean;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"配置服务方暴露接口\"><a href=\"#配置服务方暴露接口\" class=\"headerlink\" title=\"配置服务方暴露接口\"></a>配置服务方暴露接口</h4><p>在项目根目录（src/main/datasource）创建motan_server.xml，如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:motan</span>=<span class=\"string\">&quot;http://api.weibo.com/schema/motan&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">   http://api.weibo.com/schema/motan http://api.weibo.com/schema/motan.xsd&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- service implemention bean --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;serviceImpl&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;com.hjc.motan.server.FooServiceImpl&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- exporting service by motan --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">motan:service</span> <span class=\"attr\">interface</span>=<span class=\"string\">&quot;com.hjc.motan.server.FooService&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;serviceImpl&quot;</span> <span class=\"attr\">export</span>=<span class=\"string\">&quot;8002&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在这个过程中，我发现我的eclipse不能自动下载motan.xsd，这时候我只能手动配置，从motan-core的jar包中，找到这个schema文件，复制到任意位置，然后eclipse中，选择Window-&gt;Preferences-&gt;XML-&gt;XML Catalog-&gt;User Specified Entries，点击Add，输入Location和Key，按照如下图所示：</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/1472037-84987d6df57493e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"手动添加schema\"></p>\n<p>以上步骤完成之后，就可以启动Motan Rpc的服务方了，在FooServiceImpl中已经写好了main方法，右键run即可</p>\n<h4 id=\"配置调用方调用接口\"><a href=\"#配置调用方调用接口\" class=\"headerlink\" title=\"配置调用方调用接口\"></a>配置调用方调用接口</h4><p> 在项目根目录（src/main/datasource）创建motan_server.xml，如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"attr\">xmlns:motan</span>=<span class=\"string\">&quot;http://api.weibo.com/schema/motan&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">   http://api.weibo.com/schema/motan http://api.weibo.com/schema/motan.xsd&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- reference to the remote service --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">motan:referer</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;remoteService&quot;</span> <span class=\"attr\">interface</span>=<span class=\"string\">&quot;com.hjc.motan.server.FooService&quot;</span> <span class=\"attr\">directUrl</span>=<span class=\"string\">&quot;localhost:8002&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"调用方调用\"><a href=\"#调用方调用\" class=\"headerlink\" title=\"调用方调用\"></a>调用方调用</h4><p>创建Client类调用服务方的接口并输出<br>Client：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc.motan.client;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.ApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc.motan.DemoBean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc.motan.server.FooService;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Client</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">\t\tApplicationContext ctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;classpath:motan_client.xml&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"comment\">// 获取到service</span></span><br><span class=\"line\">\t\tFooService service = (FooService) ctx.getBean(<span class=\"string\">&quot;remoteService&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"comment\">// rpc调用</span></span><br><span class=\"line\">\t\t<span class=\"comment\">/** String **/</span></span><br><span class=\"line\">\t\tString ret1 = service.hello(<span class=\"string\">&quot;motan&quot;</span>);</span><br><span class=\"line\">\t\tSystem.out.println(ret1);</span><br><span class=\"line\">\t\t<span class=\"comment\">/** int **/</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> ret2 = service.helloInt(<span class=\"number\">110</span>);</span><br><span class=\"line\">\t\tSystem.out.println(ret2);</span><br><span class=\"line\">\t\t<span class=\"comment\">/** double **/</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">double</span> ret3 = service.helloDouble(<span class=\"number\">11.2</span>);</span><br><span class=\"line\">\t\tSystem.out.println(ret3);</span><br><span class=\"line\">\t\t<span class=\"comment\">/** list **/</span></span><br><span class=\"line\">\t\tList&lt;String&gt; list = <span class=\"keyword\">new</span> ArrayList&lt;String&gt;();</span><br><span class=\"line\">\t\tlist.add(<span class=\"string\">&quot;hello&quot;</span>);</span><br><span class=\"line\">\t\tlist.add(<span class=\"string\">&quot;motan&quot;</span>);</span><br><span class=\"line\">\t\tList&lt;String&gt; ret4 = service.helloList(list);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (String string : ret4) &#123;</span><br><span class=\"line\">\t\t\tSystem.out.print(string + <span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tSystem.out.println();</span><br><span class=\"line\">\t\t<span class=\"comment\">/** map **/</span></span><br><span class=\"line\">\t\tMap&lt;String, List&lt;String&gt;&gt; map = <span class=\"keyword\">new</span> HashMap&lt;String, List&lt;String&gt;&gt;();</span><br><span class=\"line\">\t\tmap.put(<span class=\"string\">&quot;key1&quot;</span>, Arrays.asList(<span class=\"keyword\">new</span> String[] &#123; <span class=\"string\">&quot;val1&quot;</span>,<span class=\"string\">&quot;val2&quot;</span> &#125;));</span><br><span class=\"line\">\t\tmap.put(<span class=\"string\">&quot;key2&quot;</span>, Arrays.asList(<span class=\"keyword\">new</span> String[] &#123; <span class=\"string\">&quot;val1&quot;</span>,<span class=\"string\">&quot;val2&quot;</span>,<span class=\"string\">&quot;val3&quot;</span> &#125;));</span><br><span class=\"line\">\t\tmap.put(<span class=\"string\">&quot;key3&quot;</span>, Arrays.asList(<span class=\"keyword\">new</span> String[] &#123; <span class=\"string\">&quot;val1&quot;</span>,<span class=\"string\">&quot;val2&quot;</span>,<span class=\"string\">&quot;val3&quot;</span>,<span class=\"string\">&quot;val4&quot;</span> &#125;));</span><br><span class=\"line\">\t\tMap&lt;String, List&lt;String&gt;&gt; ret5 = service.helloMap(map);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (String key : ret5.keySet()) &#123;</span><br><span class=\"line\">\t\t\tSystem.out.print(key + <span class=\"string\">&quot;:[&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (String tmp : map.get(key)) &#123;</span><br><span class=\"line\">\t\t\t\tSystem.out.print(tmp + <span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tSystem.out.print(<span class=\"string\">&quot;],&quot;</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tSystem.out.println();</span><br><span class=\"line\">\t\t<span class=\"comment\">/** javabean **/</span></span><br><span class=\"line\">\t\tDemoBean bean = <span class=\"keyword\">new</span> DemoBean();</span><br><span class=\"line\">\t\tbean.setId(<span class=\"number\">1001l</span>);</span><br><span class=\"line\">\t\tbean.setName(<span class=\"string\">&quot;motan bean&quot;</span>);</span><br><span class=\"line\">\t\tbean.setScore(<span class=\"number\">99.998</span>);</span><br><span class=\"line\">\t\tDemoBean ret6 = service.helloJavabean(bean);</span><br><span class=\"line\">\t\tSystem.out.print(ret6.getId());</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;,&quot;</span> + ret6.getName());</span><br><span class=\"line\">\t\tSystem.out.print(<span class=\"string\">&quot;,&quot;</span> + ret6.getScore());</span><br><span class=\"line\">\t\tSystem.out.println();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>启动Client的main方法开始调用</p>\n<h4 id=\"输出结果\"><a href=\"#输出结果\" class=\"headerlink\" title=\"输出结果\"></a>输出结果</h4><p>通过以上demo创建了server端和client端，分别启动服务方和调用方之后，查看控制台输出如下：<br>服务方：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server start...</span><br><span class=\"line\">invoked rpc service motan</span><br><span class=\"line\">invoked rpc service 110</span><br><span class=\"line\">invoked rpc service 11.2</span><br><span class=\"line\">invoked rpc service hello,motan,</span><br><span class=\"line\">invoked rpc service key3:[val1,val2,val3,val4,],key2:[val1,val2,val3,],key1:[val1,val2,],</span><br><span class=\"line\">invoked rpc service com.hjc.motan.DemoBean@2cf3e1fd,1001,motan bean,99.998</span><br></pre></td></tr></table></figure>\n<p>调用方：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello motan</span><br><span class=\"line\">110</span><br><span class=\"line\">11.2</span><br><span class=\"line\">hello,motan,</span><br><span class=\"line\">key3:[val1,val2,val3,val4,],key2:[val1,val2,val3,],key1:[val1,val2,],</span><br><span class=\"line\">1001,motan bean,99.998</span><br></pre></td></tr></table></figure>\n<h3 id=\"集群调用示例\"><a href=\"#集群调用示例\" class=\"headerlink\" title=\"集群调用示例\"></a>集群调用示例</h3><p>实现集群使用只需要在上面的基础做一点稍稍的改变就可以，motan的集群与阿里的dubbo的原理类似，通过注册方、服务方、调用方三方来实现，三者关系图如下：</p>\n<p><img src=\"https://github.com/weibocom/motan/wiki/media/14612349319195.jpg\" alt=\"集群关系图\"></p>\n<ol>\n<li>Server 向 Registry 注册服务，并向注册中心发送心跳汇报状态。</li>\n<li>Client 需要向注册中心订阅 RPC 服务，Client 根据 Registry 返回的服务列表，对具体的 Sever 进行 RPC 调用。</li>\n<li>当 Server 发生变更时，Registry 会同步变更，Client 感知后会对本地的服务列表作相应调整。</li>\n</ol>\n<p>目前按照wiki说明，motan支持Consul和Zookeeper两种外部服务发现组件<br>以下我们再上面实现的基础之上进行更改（两种组件分别有介绍）</p>\n<h4 id=\"添加pom依赖-1\"><a href=\"#添加pom依赖-1\" class=\"headerlink\" title=\"添加pom依赖\"></a>添加pom依赖</h4><p>在最上面，其实已经写出来了</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- consul --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-registry-consul<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- zookeeper --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.weibo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>motan-registry-zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"在server和client的配置文件中分别增加registry定义\"><a href=\"#在server和client的配置文件中分别增加registry定义\" class=\"headerlink\" title=\"在server和client的配置文件中分别增加registry定义\"></a>在server和client的配置文件中分别增加registry定义</h4><p>consul</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:registry</span> <span class=\"attr\">regProtocol</span>=<span class=\"string\">&quot;consul&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;my_consul&quot;</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;127.0.0.1:8500&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>zookeeper单节点</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:registry</span> <span class=\"attr\">regProtocol</span>=<span class=\"string\">&quot;zookeeper&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;my_zookeeper&quot;</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;127.0.0.1:2181&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>zookeeper多节点集群</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:registry</span> <span class=\"attr\">regProtocol</span>=<span class=\"string\">&quot;zookeeper&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;my_zookeeper&quot;</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"在motan-client及server配置改为通过registry服务发现\"><a href=\"#在motan-client及server配置改为通过registry服务发现\" class=\"headerlink\" title=\"在motan client及server配置改为通过registry服务发现\"></a>在motan client及server配置改为通过registry服务发现</h4><p>consul client</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:referer</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;remoteService&quot;</span> <span class=\"attr\">interface</span>=<span class=\"string\">&quot;quickstart.FooService&quot;</span> <span class=\"attr\">registry</span>=<span class=\"string\">&quot;my_consul&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>consul server</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:service</span> <span class=\"attr\">interface</span>=<span class=\"string\">&quot;quickstart.FooService&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;serviceImpl&quot;</span> <span class=\"attr\">registry</span>=<span class=\"string\">&quot;my_consul&quot;</span> <span class=\"attr\">export</span>=<span class=\"string\">&quot;8002&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>zookeeper client</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:referer</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;remoteService&quot;</span> <span class=\"attr\">interface</span>=<span class=\"string\">&quot;quickstart.FooService&quot;</span> <span class=\"attr\">registry</span>=<span class=\"string\">&quot;my_zookeeper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>zookeeper server</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">motan:service</span> <span class=\"attr\">interface</span>=<span class=\"string\">&quot;quickstart.FooService&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;serviceImpl&quot;</span> <span class=\"attr\">registry</span>=<span class=\"string\">&quot;my_zookeeper&quot;</span> <span class=\"attr\">export</span>=<span class=\"string\">&quot;8002&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"调用方调用服务\"><a href=\"#调用方调用服务\" class=\"headerlink\" title=\"调用方调用服务\"></a>调用方调用服务</h4><p>consul需要显示调用心跳开关注册到consul（zookeeper不需要）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MotanSwitcherUtil.setSwitcher(ConsulConstants.NAMING_PROCESS_HEARTBEAT_SWITCHER, <span class=\"keyword\">true</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>我也是正好最近项目空闲，刚好又看到这么一则新闻，于是就动手了解了下，当然，我所做的只是浅层次的使用，至于更深层次的内容（如，跟dubbo等其他rpc框架的对比，集群上下线对zookeeper的影响等）还没来得及去研究，不过既然它曾经支撑过千亿的调用，那一定是经过实际运营检验的，作为搞技术的，也应该多去了解了解开源的东西，这里我想说一句，开源真好！<br>另外，以上demo代码我也传到了我的github上，欢迎交流学习：<br><a href=\"https://github.com/hjcenry/motan-demo\">https://github.com/hjcenry/motan-demo</a></p>\n<hr>\n<p><em>我的个人博客开通啦，每一篇文章都在简书跟个人博客同步，地址是：<a href=\"http://hjcenry.github.io/\">http://hjcenry.github.io</a></em></p>"},{"title":"我的Python之旅","date":"2019-11-10T15:22:00.000Z","_content":"## 前言\n工作原因，近两年没写文章了，这里我分享几个我最近学习python的时候写的工具\n\n## Python之旅\n最近两年工作上，我真的是很忙，上一次更新文章还是2018-01-08写的年终总结。这接近两年的时间，我一直在忙于公司的项目<!--more-->，关于996我就不在这里吐槽了，了解这个行业的都应该知道这是常事，这个要吐槽能吐槽到地老天荒，而我倒是挺怀念刚毕业参加工作前两年，每天按时上班下班，周末双休，这也能解释为什么最初我毕业的前两年文章产量那么高，现在真是的想写也没时间写了，心有余而力不足。\n\n其实在工作上，我最近这两年，才是我真正的成长期，从一个项目的开始参与，技术上也是从各方各面都对服务器相关内容有了更深入的了解。我其实是挺喜欢研究一些好玩的 东西，正好这两年，Python特别火，于是我也开始入坑Python，可能是职业的原因，我是一个特别致力于用把重复的工作用一个轮子来解决的人，在工作中，我会做各种工具来简化我的日常重复的操作，生活中，我也开始喜欢用Python来解决我的一些问题，不过目前为止还用的不多，主要是Python功力还不太够，目前做过以下几件事：\n#### 1.  婚礼请柬统计脚本\n\n结合当时我自己做的微信端的请柬，用来发请柬给朋友们（当然了，装X成分比较大），然后用Python定时去统计有多少人点了愿意来。\n\n婚礼请柬前端：[https://github.com/hjcenry/wedding-invitation-client](https://github.com/hjcenry/wedding-invitation-client)\n\n婚礼请柬后端：[https://github.com/hjcenry/wedding-invitation-server](https://github.com/hjcenry/wedding-invitation-server)\n\n婚礼请柬统计脚本： [https://github.com/hjcenry/wedding-invitation-analysis](https://github.com/hjcenry/wedding-invitation-analysis)\n\n后续：因为大部分请的都是父母的朋友以及亲戚，所以做的这玩意儿，实际用处并不大。失败。\n\n#### 2.进京证状态提醒推送\n\n因为本人是在北京北漂，然后买了个车，上了家乡的牌照，所以每周都需要申请进京证，于是就出现了好几次都忘记申请的情况，本着简化生活中一切繁琐事情的原则，我开始了用Python写一个进京证查询的脚本，并且能根据查询结果给我推送邮件或者微信，为什么不直接就用脚本给我申请了呢，一是懒，写查询是最简单的，二是安全，我想进京证系统怎么着也会有申请的验证吧，再者万一我的数据传错了，申请成了两天，或者照片传错，那就是申请不过，或者等进京证到期了再重新申请。\n\n这个东西一开始写出来以后，最开始还挺好用的，我部署在我家里24小时开机的树莓派上（这个强大的东西已经完全被我拿来当一个小型Linux服务器使用了）。一开始都还挺好的，我有时候忘了，它只要查询到没有申请通过会一直微信提醒我。直到2019年11月1日，北京开始实行新的外地车管理政策，每个外地车一年只能申请12次进京证，每次最多7天，这都不是最关键的，最关键的是，我发现我的进京证申请脚本不管用了，原来进京证申请的接口变了，访问原来的接口只能返回403了。我只能重新对接口进行抓包分析，然而不幸的是，北京交警APP似乎做了什么，我一旦打开抓包软件的VPN，请求页面就返回服务器400，然而我正常使用，就能返回数据，不知道APP是做了什么校验，总之我原来的查询脚本就这么废了。失败\n\n进京证状态查询：[https://github.com/hjcenry/enterBjNotify](https://github.com/hjcenry/enterBjNotify)\n\n#### 3.消息推送服务\n\n这个东西算是从进京证状态查询中提炼出来的一个通用的脚本了，算是目前为止我应用Python最成功的的例子了，我把它部署在树莓派上，我可以直接通过命令调用python脚本，然后就能给任何我想要通知的人发消息，目前已经支持发送邮件和微信，微信接入了Server酱和WxPusher两个渠道。\n\n消息推送服务：[https://github.com/hjcenry/sender](https://github.com/hjcenry/sender)\n\n## 一年一度双十一\n现在是2019年11月10日，19点47分，还有4个小时13分钟，就是一年一度的双十一了，按照以往习惯，都是大家买买买的季节，其实在2011年以前，双十一最多只能算个光棍节，其实也是个新时代的概念，但在2011年淘宝第一次搞双十一开始，每年的双十一就成了大家一年一期待的狂欢购物街。\n\n按照以往来说，双十一对我基本没有什么用，因为我是一个属于冲动型消费者，就是平时没什么兴趣就什么都不关注，一旦突然特别想要买某一个东西，我可能就会疯狂查询相关信息，然后立马入手。所以对我来说，根本不存在什么双十一，只要我乐意，每天都可以是双十一，除了三年前在双十一买了一个ikbc的青轴机械键盘以外，从来没买过东西。\n\n那么今年不一样了，不知道什么原因，去年开始，我喜欢上了拍照拍视频，手中拥有一个三年前买的Sony A7一代相机，加一个28-70的套头，一直到现在都用的这个相机，老实说，这款相机加套头的素质还是不错的。然而今年我想追求最新的相机以及更好的镜头——Sony A7M3+蔡索55 1.8+Sony 85 1.8，这一套下来大概在两万多，朝思暮想了好久好久，年初就计划好了今年一定要购置一套更好的设备，不过同时今年也计划了要换最新款苹果手机，替换掉我四年前的iPhone 6s plus，所以其实来说，预算还挺紧张。\n\n## 用Python查询电商网站价格并通知\n\n这个为什么单独提出来一个大标题呢，因为这个确实是我目前为止最有用的一个Python应用，它的作用是能根据我提供的一个或多个商品id去查询我想要知道商品的价格，然后把各大电商网站的价格进行比对，记录一些重要信息，包括如下：\n1.单个商品在某个平台的最低价格\n2.单个商品在某个平台的当前价格\n3.所有商品的最低价以及对应的平台\n\n这里回应文章开头了，我说过今年双十一我更新我的摄影器材，根据以上信息，我就可以知道我想买的东西当前最低价格是多少，以及在哪个平台买最便宜。\n\n我把脚本部署在树莓派上，并且每一个小时运行一次，查询一次价格（查询太频繁担心被封禁），然后每次查询如果出现了最低价，就调用上面提到的通用消息通知脚本给我发送微信通知，脚本在一周前就完成了，于是在一周的时间内，我不断收到价格变动的通知。这里我就想说了，京东是真的坑，它的价格是最飘忽不定的，今天降一两千，明后天就几百几百的涨上去了，不知道一会12点价格还会不会降下来。\n\n查询电商网站价格：[https://github.com/hjcenry/shopDetailNotice](https://github.com/hjcenry/shopDetailNotice)\n\n## 后话\n这里我只是分享下我自己对于python的学习已经应用，其实python这个脚本语言还可以做更多的事。我是一个Java后端开发，但在我眼里，python真的是一个易于上手，开发快捷的脚本语言，如果我要快速的写一个工具，我的第一选择一定是python而不是java，因为它写起来真的很快。不过苦于没有python基础，我写python代码都写的还不够python，都还带着java的代码风格，后续我一定会更加融入python的世界，让我的python代码看起来更加python。\n\n本文就不详细解释代码了，通过贴上的github地址可以看到源代码，欢迎一起交流，有什么python学习的交流群也欢迎拉我入群啊，微信hjcenry，哈哈哈\n\n","source":"_posts/我的Python之旅.md","raw":"---\ntitle: 我的Python之旅\ndate: 2019-11-10 23:22\ncategories: Python\ntags: [Python]\n---\n## 前言\n工作原因，近两年没写文章了，这里我分享几个我最近学习python的时候写的工具\n\n## Python之旅\n最近两年工作上，我真的是很忙，上一次更新文章还是2018-01-08写的年终总结。这接近两年的时间，我一直在忙于公司的项目<!--more-->，关于996我就不在这里吐槽了，了解这个行业的都应该知道这是常事，这个要吐槽能吐槽到地老天荒，而我倒是挺怀念刚毕业参加工作前两年，每天按时上班下班，周末双休，这也能解释为什么最初我毕业的前两年文章产量那么高，现在真是的想写也没时间写了，心有余而力不足。\n\n其实在工作上，我最近这两年，才是我真正的成长期，从一个项目的开始参与，技术上也是从各方各面都对服务器相关内容有了更深入的了解。我其实是挺喜欢研究一些好玩的 东西，正好这两年，Python特别火，于是我也开始入坑Python，可能是职业的原因，我是一个特别致力于用把重复的工作用一个轮子来解决的人，在工作中，我会做各种工具来简化我的日常重复的操作，生活中，我也开始喜欢用Python来解决我的一些问题，不过目前为止还用的不多，主要是Python功力还不太够，目前做过以下几件事：\n#### 1.  婚礼请柬统计脚本\n\n结合当时我自己做的微信端的请柬，用来发请柬给朋友们（当然了，装X成分比较大），然后用Python定时去统计有多少人点了愿意来。\n\n婚礼请柬前端：[https://github.com/hjcenry/wedding-invitation-client](https://github.com/hjcenry/wedding-invitation-client)\n\n婚礼请柬后端：[https://github.com/hjcenry/wedding-invitation-server](https://github.com/hjcenry/wedding-invitation-server)\n\n婚礼请柬统计脚本： [https://github.com/hjcenry/wedding-invitation-analysis](https://github.com/hjcenry/wedding-invitation-analysis)\n\n后续：因为大部分请的都是父母的朋友以及亲戚，所以做的这玩意儿，实际用处并不大。失败。\n\n#### 2.进京证状态提醒推送\n\n因为本人是在北京北漂，然后买了个车，上了家乡的牌照，所以每周都需要申请进京证，于是就出现了好几次都忘记申请的情况，本着简化生活中一切繁琐事情的原则，我开始了用Python写一个进京证查询的脚本，并且能根据查询结果给我推送邮件或者微信，为什么不直接就用脚本给我申请了呢，一是懒，写查询是最简单的，二是安全，我想进京证系统怎么着也会有申请的验证吧，再者万一我的数据传错了，申请成了两天，或者照片传错，那就是申请不过，或者等进京证到期了再重新申请。\n\n这个东西一开始写出来以后，最开始还挺好用的，我部署在我家里24小时开机的树莓派上（这个强大的东西已经完全被我拿来当一个小型Linux服务器使用了）。一开始都还挺好的，我有时候忘了，它只要查询到没有申请通过会一直微信提醒我。直到2019年11月1日，北京开始实行新的外地车管理政策，每个外地车一年只能申请12次进京证，每次最多7天，这都不是最关键的，最关键的是，我发现我的进京证申请脚本不管用了，原来进京证申请的接口变了，访问原来的接口只能返回403了。我只能重新对接口进行抓包分析，然而不幸的是，北京交警APP似乎做了什么，我一旦打开抓包软件的VPN，请求页面就返回服务器400，然而我正常使用，就能返回数据，不知道APP是做了什么校验，总之我原来的查询脚本就这么废了。失败\n\n进京证状态查询：[https://github.com/hjcenry/enterBjNotify](https://github.com/hjcenry/enterBjNotify)\n\n#### 3.消息推送服务\n\n这个东西算是从进京证状态查询中提炼出来的一个通用的脚本了，算是目前为止我应用Python最成功的的例子了，我把它部署在树莓派上，我可以直接通过命令调用python脚本，然后就能给任何我想要通知的人发消息，目前已经支持发送邮件和微信，微信接入了Server酱和WxPusher两个渠道。\n\n消息推送服务：[https://github.com/hjcenry/sender](https://github.com/hjcenry/sender)\n\n## 一年一度双十一\n现在是2019年11月10日，19点47分，还有4个小时13分钟，就是一年一度的双十一了，按照以往习惯，都是大家买买买的季节，其实在2011年以前，双十一最多只能算个光棍节，其实也是个新时代的概念，但在2011年淘宝第一次搞双十一开始，每年的双十一就成了大家一年一期待的狂欢购物街。\n\n按照以往来说，双十一对我基本没有什么用，因为我是一个属于冲动型消费者，就是平时没什么兴趣就什么都不关注，一旦突然特别想要买某一个东西，我可能就会疯狂查询相关信息，然后立马入手。所以对我来说，根本不存在什么双十一，只要我乐意，每天都可以是双十一，除了三年前在双十一买了一个ikbc的青轴机械键盘以外，从来没买过东西。\n\n那么今年不一样了，不知道什么原因，去年开始，我喜欢上了拍照拍视频，手中拥有一个三年前买的Sony A7一代相机，加一个28-70的套头，一直到现在都用的这个相机，老实说，这款相机加套头的素质还是不错的。然而今年我想追求最新的相机以及更好的镜头——Sony A7M3+蔡索55 1.8+Sony 85 1.8，这一套下来大概在两万多，朝思暮想了好久好久，年初就计划好了今年一定要购置一套更好的设备，不过同时今年也计划了要换最新款苹果手机，替换掉我四年前的iPhone 6s plus，所以其实来说，预算还挺紧张。\n\n## 用Python查询电商网站价格并通知\n\n这个为什么单独提出来一个大标题呢，因为这个确实是我目前为止最有用的一个Python应用，它的作用是能根据我提供的一个或多个商品id去查询我想要知道商品的价格，然后把各大电商网站的价格进行比对，记录一些重要信息，包括如下：\n1.单个商品在某个平台的最低价格\n2.单个商品在某个平台的当前价格\n3.所有商品的最低价以及对应的平台\n\n这里回应文章开头了，我说过今年双十一我更新我的摄影器材，根据以上信息，我就可以知道我想买的东西当前最低价格是多少，以及在哪个平台买最便宜。\n\n我把脚本部署在树莓派上，并且每一个小时运行一次，查询一次价格（查询太频繁担心被封禁），然后每次查询如果出现了最低价，就调用上面提到的通用消息通知脚本给我发送微信通知，脚本在一周前就完成了，于是在一周的时间内，我不断收到价格变动的通知。这里我就想说了，京东是真的坑，它的价格是最飘忽不定的，今天降一两千，明后天就几百几百的涨上去了，不知道一会12点价格还会不会降下来。\n\n查询电商网站价格：[https://github.com/hjcenry/shopDetailNotice](https://github.com/hjcenry/shopDetailNotice)\n\n## 后话\n这里我只是分享下我自己对于python的学习已经应用，其实python这个脚本语言还可以做更多的事。我是一个Java后端开发，但在我眼里，python真的是一个易于上手，开发快捷的脚本语言，如果我要快速的写一个工具，我的第一选择一定是python而不是java，因为它写起来真的很快。不过苦于没有python基础，我写python代码都写的还不够python，都还带着java的代码风格，后续我一定会更加融入python的世界，让我的python代码看起来更加python。\n\n本文就不详细解释代码了，通过贴上的github地址可以看到源代码，欢迎一起交流，有什么python学习的交流群也欢迎拉我入群啊，微信hjcenry，哈哈哈\n\n","slug":"我的Python之旅","published":1,"updated":"2020-09-26T15:31:33.705Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhuw002nwsaz0967h5h9","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>工作原因，近两年没写文章了，这里我分享几个我最近学习python的时候写的工具</p>\n<h2 id=\"Python之旅\"><a href=\"#Python之旅\" class=\"headerlink\" title=\"Python之旅\"></a>Python之旅</h2><p>最近两年工作上，我真的是很忙，上一次更新文章还是2018-01-08写的年终总结。这接近两年的时间，我一直在忙于公司的项目<a id=\"more\"></a>，关于996我就不在这里吐槽了，了解这个行业的都应该知道这是常事，这个要吐槽能吐槽到地老天荒，而我倒是挺怀念刚毕业参加工作前两年，每天按时上班下班，周末双休，这也能解释为什么最初我毕业的前两年文章产量那么高，现在真是的想写也没时间写了，心有余而力不足。</p>\n<p>其实在工作上，我最近这两年，才是我真正的成长期，从一个项目的开始参与，技术上也是从各方各面都对服务器相关内容有了更深入的了解。我其实是挺喜欢研究一些好玩的 东西，正好这两年，Python特别火，于是我也开始入坑Python，可能是职业的原因，我是一个特别致力于用把重复的工作用一个轮子来解决的人，在工作中，我会做各种工具来简化我的日常重复的操作，生活中，我也开始喜欢用Python来解决我的一些问题，不过目前为止还用的不多，主要是Python功力还不太够，目前做过以下几件事：</p>\n<h4 id=\"1-婚礼请柬统计脚本\"><a href=\"#1-婚礼请柬统计脚本\" class=\"headerlink\" title=\"1.  婚礼请柬统计脚本\"></a>1.  婚礼请柬统计脚本</h4><p>结合当时我自己做的微信端的请柬，用来发请柬给朋友们（当然了，装X成分比较大），然后用Python定时去统计有多少人点了愿意来。</p>\n<p>婚礼请柬前端：<a href=\"https://github.com/hjcenry/wedding-invitation-client\">https://github.com/hjcenry/wedding-invitation-client</a></p>\n<p>婚礼请柬后端：<a href=\"https://github.com/hjcenry/wedding-invitation-server\">https://github.com/hjcenry/wedding-invitation-server</a></p>\n<p>婚礼请柬统计脚本： <a href=\"https://github.com/hjcenry/wedding-invitation-analysis\">https://github.com/hjcenry/wedding-invitation-analysis</a></p>\n<p>后续：因为大部分请的都是父母的朋友以及亲戚，所以做的这玩意儿，实际用处并不大。失败。</p>\n<h4 id=\"2-进京证状态提醒推送\"><a href=\"#2-进京证状态提醒推送\" class=\"headerlink\" title=\"2.进京证状态提醒推送\"></a>2.进京证状态提醒推送</h4><p>因为本人是在北京北漂，然后买了个车，上了家乡的牌照，所以每周都需要申请进京证，于是就出现了好几次都忘记申请的情况，本着简化生活中一切繁琐事情的原则，我开始了用Python写一个进京证查询的脚本，并且能根据查询结果给我推送邮件或者微信，为什么不直接就用脚本给我申请了呢，一是懒，写查询是最简单的，二是安全，我想进京证系统怎么着也会有申请的验证吧，再者万一我的数据传错了，申请成了两天，或者照片传错，那就是申请不过，或者等进京证到期了再重新申请。</p>\n<p>这个东西一开始写出来以后，最开始还挺好用的，我部署在我家里24小时开机的树莓派上（这个强大的东西已经完全被我拿来当一个小型Linux服务器使用了）。一开始都还挺好的，我有时候忘了，它只要查询到没有申请通过会一直微信提醒我。直到2019年11月1日，北京开始实行新的外地车管理政策，每个外地车一年只能申请12次进京证，每次最多7天，这都不是最关键的，最关键的是，我发现我的进京证申请脚本不管用了，原来进京证申请的接口变了，访问原来的接口只能返回403了。我只能重新对接口进行抓包分析，然而不幸的是，北京交警APP似乎做了什么，我一旦打开抓包软件的VPN，请求页面就返回服务器400，然而我正常使用，就能返回数据，不知道APP是做了什么校验，总之我原来的查询脚本就这么废了。失败</p>\n<p>进京证状态查询：<a href=\"https://github.com/hjcenry/enterBjNotify\">https://github.com/hjcenry/enterBjNotify</a></p>\n<h4 id=\"3-消息推送服务\"><a href=\"#3-消息推送服务\" class=\"headerlink\" title=\"3.消息推送服务\"></a>3.消息推送服务</h4><p>这个东西算是从进京证状态查询中提炼出来的一个通用的脚本了，算是目前为止我应用Python最成功的的例子了，我把它部署在树莓派上，我可以直接通过命令调用python脚本，然后就能给任何我想要通知的人发消息，目前已经支持发送邮件和微信，微信接入了Server酱和WxPusher两个渠道。</p>\n<p>消息推送服务：<a href=\"https://github.com/hjcenry/sender\">https://github.com/hjcenry/sender</a></p>\n<h2 id=\"一年一度双十一\"><a href=\"#一年一度双十一\" class=\"headerlink\" title=\"一年一度双十一\"></a>一年一度双十一</h2><p>现在是2019年11月10日，19点47分，还有4个小时13分钟，就是一年一度的双十一了，按照以往习惯，都是大家买买买的季节，其实在2011年以前，双十一最多只能算个光棍节，其实也是个新时代的概念，但在2011年淘宝第一次搞双十一开始，每年的双十一就成了大家一年一期待的狂欢购物街。</p>\n<p>按照以往来说，双十一对我基本没有什么用，因为我是一个属于冲动型消费者，就是平时没什么兴趣就什么都不关注，一旦突然特别想要买某一个东西，我可能就会疯狂查询相关信息，然后立马入手。所以对我来说，根本不存在什么双十一，只要我乐意，每天都可以是双十一，除了三年前在双十一买了一个ikbc的青轴机械键盘以外，从来没买过东西。</p>\n<p>那么今年不一样了，不知道什么原因，去年开始，我喜欢上了拍照拍视频，手中拥有一个三年前买的Sony A7一代相机，加一个28-70的套头，一直到现在都用的这个相机，老实说，这款相机加套头的素质还是不错的。然而今年我想追求最新的相机以及更好的镜头——Sony A7M3+蔡索55 1.8+Sony 85 1.8，这一套下来大概在两万多，朝思暮想了好久好久，年初就计划好了今年一定要购置一套更好的设备，不过同时今年也计划了要换最新款苹果手机，替换掉我四年前的iPhone 6s plus，所以其实来说，预算还挺紧张。</p>\n<h2 id=\"用Python查询电商网站价格并通知\"><a href=\"#用Python查询电商网站价格并通知\" class=\"headerlink\" title=\"用Python查询电商网站价格并通知\"></a>用Python查询电商网站价格并通知</h2><p>这个为什么单独提出来一个大标题呢，因为这个确实是我目前为止最有用的一个Python应用，它的作用是能根据我提供的一个或多个商品id去查询我想要知道商品的价格，然后把各大电商网站的价格进行比对，记录一些重要信息，包括如下：<br>1.单个商品在某个平台的最低价格<br>2.单个商品在某个平台的当前价格<br>3.所有商品的最低价以及对应的平台</p>\n<p>这里回应文章开头了，我说过今年双十一我更新我的摄影器材，根据以上信息，我就可以知道我想买的东西当前最低价格是多少，以及在哪个平台买最便宜。</p>\n<p>我把脚本部署在树莓派上，并且每一个小时运行一次，查询一次价格（查询太频繁担心被封禁），然后每次查询如果出现了最低价，就调用上面提到的通用消息通知脚本给我发送微信通知，脚本在一周前就完成了，于是在一周的时间内，我不断收到价格变动的通知。这里我就想说了，京东是真的坑，它的价格是最飘忽不定的，今天降一两千，明后天就几百几百的涨上去了，不知道一会12点价格还会不会降下来。</p>\n<p>查询电商网站价格：<a href=\"https://github.com/hjcenry/shopDetailNotice\">https://github.com/hjcenry/shopDetailNotice</a></p>\n<h2 id=\"后话\"><a href=\"#后话\" class=\"headerlink\" title=\"后话\"></a>后话</h2><p>这里我只是分享下我自己对于python的学习已经应用，其实python这个脚本语言还可以做更多的事。我是一个Java后端开发，但在我眼里，python真的是一个易于上手，开发快捷的脚本语言，如果我要快速的写一个工具，我的第一选择一定是python而不是java，因为它写起来真的很快。不过苦于没有python基础，我写python代码都写的还不够python，都还带着java的代码风格，后续我一定会更加融入python的世界，让我的python代码看起来更加python。</p>\n<p>本文就不详细解释代码了，通过贴上的github地址可以看到源代码，欢迎一起交流，有什么python学习的交流群也欢迎拉我入群啊，微信hjcenry，哈哈哈</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>工作原因，近两年没写文章了，这里我分享几个我最近学习python的时候写的工具</p>\n<h2 id=\"Python之旅\"><a href=\"#Python之旅\" class=\"headerlink\" title=\"Python之旅\"></a>Python之旅</h2><p>最近两年工作上，我真的是很忙，上一次更新文章还是2018-01-08写的年终总结。这接近两年的时间，我一直在忙于公司的项目","more":"，关于996我就不在这里吐槽了，了解这个行业的都应该知道这是常事，这个要吐槽能吐槽到地老天荒，而我倒是挺怀念刚毕业参加工作前两年，每天按时上班下班，周末双休，这也能解释为什么最初我毕业的前两年文章产量那么高，现在真是的想写也没时间写了，心有余而力不足。</p>\n<p>其实在工作上，我最近这两年，才是我真正的成长期，从一个项目的开始参与，技术上也是从各方各面都对服务器相关内容有了更深入的了解。我其实是挺喜欢研究一些好玩的 东西，正好这两年，Python特别火，于是我也开始入坑Python，可能是职业的原因，我是一个特别致力于用把重复的工作用一个轮子来解决的人，在工作中，我会做各种工具来简化我的日常重复的操作，生活中，我也开始喜欢用Python来解决我的一些问题，不过目前为止还用的不多，主要是Python功力还不太够，目前做过以下几件事：</p>\n<h4 id=\"1-婚礼请柬统计脚本\"><a href=\"#1-婚礼请柬统计脚本\" class=\"headerlink\" title=\"1.  婚礼请柬统计脚本\"></a>1.  婚礼请柬统计脚本</h4><p>结合当时我自己做的微信端的请柬，用来发请柬给朋友们（当然了，装X成分比较大），然后用Python定时去统计有多少人点了愿意来。</p>\n<p>婚礼请柬前端：<a href=\"https://github.com/hjcenry/wedding-invitation-client\">https://github.com/hjcenry/wedding-invitation-client</a></p>\n<p>婚礼请柬后端：<a href=\"https://github.com/hjcenry/wedding-invitation-server\">https://github.com/hjcenry/wedding-invitation-server</a></p>\n<p>婚礼请柬统计脚本： <a href=\"https://github.com/hjcenry/wedding-invitation-analysis\">https://github.com/hjcenry/wedding-invitation-analysis</a></p>\n<p>后续：因为大部分请的都是父母的朋友以及亲戚，所以做的这玩意儿，实际用处并不大。失败。</p>\n<h4 id=\"2-进京证状态提醒推送\"><a href=\"#2-进京证状态提醒推送\" class=\"headerlink\" title=\"2.进京证状态提醒推送\"></a>2.进京证状态提醒推送</h4><p>因为本人是在北京北漂，然后买了个车，上了家乡的牌照，所以每周都需要申请进京证，于是就出现了好几次都忘记申请的情况，本着简化生活中一切繁琐事情的原则，我开始了用Python写一个进京证查询的脚本，并且能根据查询结果给我推送邮件或者微信，为什么不直接就用脚本给我申请了呢，一是懒，写查询是最简单的，二是安全，我想进京证系统怎么着也会有申请的验证吧，再者万一我的数据传错了，申请成了两天，或者照片传错，那就是申请不过，或者等进京证到期了再重新申请。</p>\n<p>这个东西一开始写出来以后，最开始还挺好用的，我部署在我家里24小时开机的树莓派上（这个强大的东西已经完全被我拿来当一个小型Linux服务器使用了）。一开始都还挺好的，我有时候忘了，它只要查询到没有申请通过会一直微信提醒我。直到2019年11月1日，北京开始实行新的外地车管理政策，每个外地车一年只能申请12次进京证，每次最多7天，这都不是最关键的，最关键的是，我发现我的进京证申请脚本不管用了，原来进京证申请的接口变了，访问原来的接口只能返回403了。我只能重新对接口进行抓包分析，然而不幸的是，北京交警APP似乎做了什么，我一旦打开抓包软件的VPN，请求页面就返回服务器400，然而我正常使用，就能返回数据，不知道APP是做了什么校验，总之我原来的查询脚本就这么废了。失败</p>\n<p>进京证状态查询：<a href=\"https://github.com/hjcenry/enterBjNotify\">https://github.com/hjcenry/enterBjNotify</a></p>\n<h4 id=\"3-消息推送服务\"><a href=\"#3-消息推送服务\" class=\"headerlink\" title=\"3.消息推送服务\"></a>3.消息推送服务</h4><p>这个东西算是从进京证状态查询中提炼出来的一个通用的脚本了，算是目前为止我应用Python最成功的的例子了，我把它部署在树莓派上，我可以直接通过命令调用python脚本，然后就能给任何我想要通知的人发消息，目前已经支持发送邮件和微信，微信接入了Server酱和WxPusher两个渠道。</p>\n<p>消息推送服务：<a href=\"https://github.com/hjcenry/sender\">https://github.com/hjcenry/sender</a></p>\n<h2 id=\"一年一度双十一\"><a href=\"#一年一度双十一\" class=\"headerlink\" title=\"一年一度双十一\"></a>一年一度双十一</h2><p>现在是2019年11月10日，19点47分，还有4个小时13分钟，就是一年一度的双十一了，按照以往习惯，都是大家买买买的季节，其实在2011年以前，双十一最多只能算个光棍节，其实也是个新时代的概念，但在2011年淘宝第一次搞双十一开始，每年的双十一就成了大家一年一期待的狂欢购物街。</p>\n<p>按照以往来说，双十一对我基本没有什么用，因为我是一个属于冲动型消费者，就是平时没什么兴趣就什么都不关注，一旦突然特别想要买某一个东西，我可能就会疯狂查询相关信息，然后立马入手。所以对我来说，根本不存在什么双十一，只要我乐意，每天都可以是双十一，除了三年前在双十一买了一个ikbc的青轴机械键盘以外，从来没买过东西。</p>\n<p>那么今年不一样了，不知道什么原因，去年开始，我喜欢上了拍照拍视频，手中拥有一个三年前买的Sony A7一代相机，加一个28-70的套头，一直到现在都用的这个相机，老实说，这款相机加套头的素质还是不错的。然而今年我想追求最新的相机以及更好的镜头——Sony A7M3+蔡索55 1.8+Sony 85 1.8，这一套下来大概在两万多，朝思暮想了好久好久，年初就计划好了今年一定要购置一套更好的设备，不过同时今年也计划了要换最新款苹果手机，替换掉我四年前的iPhone 6s plus，所以其实来说，预算还挺紧张。</p>\n<h2 id=\"用Python查询电商网站价格并通知\"><a href=\"#用Python查询电商网站价格并通知\" class=\"headerlink\" title=\"用Python查询电商网站价格并通知\"></a>用Python查询电商网站价格并通知</h2><p>这个为什么单独提出来一个大标题呢，因为这个确实是我目前为止最有用的一个Python应用，它的作用是能根据我提供的一个或多个商品id去查询我想要知道商品的价格，然后把各大电商网站的价格进行比对，记录一些重要信息，包括如下：<br>1.单个商品在某个平台的最低价格<br>2.单个商品在某个平台的当前价格<br>3.所有商品的最低价以及对应的平台</p>\n<p>这里回应文章开头了，我说过今年双十一我更新我的摄影器材，根据以上信息，我就可以知道我想买的东西当前最低价格是多少，以及在哪个平台买最便宜。</p>\n<p>我把脚本部署在树莓派上，并且每一个小时运行一次，查询一次价格（查询太频繁担心被封禁），然后每次查询如果出现了最低价，就调用上面提到的通用消息通知脚本给我发送微信通知，脚本在一周前就完成了，于是在一周的时间内，我不断收到价格变动的通知。这里我就想说了，京东是真的坑，它的价格是最飘忽不定的，今天降一两千，明后天就几百几百的涨上去了，不知道一会12点价格还会不会降下来。</p>\n<p>查询电商网站价格：<a href=\"https://github.com/hjcenry/shopDetailNotice\">https://github.com/hjcenry/shopDetailNotice</a></p>\n<h2 id=\"后话\"><a href=\"#后话\" class=\"headerlink\" title=\"后话\"></a>后话</h2><p>这里我只是分享下我自己对于python的学习已经应用，其实python这个脚本语言还可以做更多的事。我是一个Java后端开发，但在我眼里，python真的是一个易于上手，开发快捷的脚本语言，如果我要快速的写一个工具，我的第一选择一定是python而不是java，因为它写起来真的很快。不过苦于没有python基础，我写python代码都写的还不够python，都还带着java的代码风格，后续我一定会更加融入python的世界，让我的python代码看起来更加python。</p>\n<p>本文就不详细解释代码了，通过贴上的github地址可以看到源代码，欢迎一起交流，有什么python学习的交流群也欢迎拉我入群啊，微信hjcenry，哈哈哈</p>"},{"title":"CVP认证学习笔记--(何小成)008--Node的父子关系","date":"2016-04-17T16:06:00.000Z","_content":"### 概念\n本节课内容主要讲了node之间的层级关系，场景中所有的Node是一个节点树，可以根据节点间的关系获取到所需要的节点，并进行相应的操作。在开发中，如果需要对多个node同时进行一个操作，可以将这些node放在一个node中，通过操作这个总的node，<!--more-->就能产生相应的效果。如本节课作业，需要将时间的58分进行上移或下移，在上节课作业中，5和8一般情况下是在两个图层中，而如果需要同时进行上移或下移，就可以把他们放在一个图层中进行操作。一个父节点可以有多个子节点，而一个子节点只能有一个父节点，合理安排图层中节点的关系，可以使得开发中获取各node更加的方便。\n### 作业\n上节课我的作业中是实现的电子钟，这节课作业中我对时分秒分别加入上下两个按钮，实现时分秒的上移或下移，代码如下：\n```javascript\n/**\n * Created by Henry on 16/4/16.\n */\nvar cellSpace = 3;\nvar rectWidth = 10;\nvar rectHeight = 10;\nvar Layer0202 = cc.Layer.extend({\n    normalColor: cc.color(245, 245, 245, 50),\n    numColor: cc.color(152, 245, 255, 255),\n    numColor2: cc.color(152, 245, 255, 80),\n    initX: 0,\n    ctor: function (num, initX, initY) {\n        this._super();\n        var size = cc.winSize;\n        this.initX = initX;\n        var rects = [];\n        var rectNum = num == -1 ? 4 : 8;\n        // 添加显示时间方块\n        for (var row = 0; row < 8; row++) {\n            rects[row] = [];\n            for (var col = 0; col < rectNum; col++) {\n                rects[row][col] = new cc.LayerColor(this.normalColor, rectWidth, rectHeight);\n                rects[row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + row * (cellSpace + rectHeight));\n                rects[row][col].ignoreAnchorPointForPosition(false);\n                rects[row][col].setAnchorPoint(0.5, 0.5);\n                this.addChild(rects[row][col]);\n            }\n        }\n        // 获取要现实的数字的阵型\n        var numArr = getNum(num);\n        for (var row = 0; row < 8; row++) {\n            for (var col = 0; col < rectNum; col++) {\n                if (numArr[row][col] == 1) {\n                    // 改变数字显示单元格的颜色\n                    rects[7 - row][col] = new cc.LayerColor(this.numColor2, rectWidth, rectHeight);\n                    rects[7 - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (7 - row) * (cellSpace + rectHeight));\n                    rects[7 - row][col].ignoreAnchorPointForPosition(false);\n                    rects[7 - row][col].setAnchorPoint(0.5, 0.5);\n                    this.addChild(rects[7 - row][col]);\n                }\n            }\n        }\n        for (var row = 0; row < 8; row++) {\n            for (var col = 0; col < rectNum; col++) {\n                if (numArr[row][col] == 1) {\n                    // 改变数字显示单元格的颜色\n                    rects[7 - row][col] = new cc.LayerColor(this.numColor, rectWidth, rectHeight);\n                    rects[7 - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (7 - row) * (cellSpace + rectHeight));\n                    rects[7 - row][col].ignoreAnchorPointForPosition(false);\n                    rects[7 - row][col].setAnchorPoint(0.8, 0.2);\n                    this.addChild(rects[7 - row][col]);\n                }\n            }\n        }\n\n        return true;\n    },\n    getPositionX: function () {\n        return this.initX;\n    }\n});\n\nvar Scene0202 = cc.Scene.extend({\n    size: cc.winSize,\n    ctor: function () {\n        this._super();\n        // 定义时分秒三个layer\n        var layer = new cc.Layer();\n        this.addChild(layer);\n        layer.setTag(0);\n        var hourLayer = new cc.Layer();\n        var minuteLayer = new cc.Layer();\n        var secondLayer = new cc.Layer();\n        layer.addChild(hourLayer);\n        layer.addChild(minuteLayer);\n        layer.addChild(secondLayer);\n        hourLayer.setTag(1);\n        minuteLayer.setTag(2);\n        secondLayer.setTag(3);\n        hourLayer.width = cellSpace * 7 + rectWidth * 8;\n        hourLayer.height = cellSpace * 7 + rectWidth * 8;\n        minuteLayer.width = cellSpace * 7 + rectWidth * 8;\n        minuteLayer.height = cellSpace * 7 + rectWidth * 8;\n        secondLayer.height = cellSpace * 7 + rectWidth * 8;\n        secondLayer.width = cellSpace * 7 + rectWidth * 8;\n        layer.setPositionX((this.size.width - layer.width) / 2);\n        // 每秒刷新\n        this.refresh();\n        this.schedule(this.refresh, 1);\n        this.scheduleUpdate();\n        // 添加hour上下按钮\n        var hourMenuUp = new cc.MenuItemLabel(new cc.LabelTTF(\"^\", \"\", 50), this.hourUp, this);\n        hourMenuUp.setPosition(0, hourMenuUp.height + 10);\n        var hourMenuDown = new cc.MenuItemLabel(new cc.LabelTTF(\"v\", \"\", 50), this.hourDown, this);\n        hourMenuDown.setPosition(0, 0);\n        var hourMenu = new cc.Menu(hourMenuUp, hourMenuDown);\n        hourMenu.setPosition(this.size.width / 6, 20);\n        hourMenu.ignoreAnchorPointForPosition(false);\n        hourMenu.setAnchorPoint(0, 0);\n        this.addChild(hourMenu);\n        // 添加minute上下按钮\n        var minuteMenuUp = new cc.MenuItemLabel(new cc.LabelTTF(\"^\", \"\", 50), this.minuteUp, this);\n        minuteMenuUp.setPosition(0, minuteMenuUp.height + 10);\n        var minuteMenuDown = new cc.MenuItemLabel(new cc.LabelTTF(\"v\", \"\", 50), this.minuteDown, this);\n        minuteMenuDown.setPosition(0, 0);\n        var minuteMenu = new cc.Menu(minuteMenuUp, minuteMenuDown);\n        minuteMenu.setPosition(this.size.width / 2, 20);\n        minuteMenu.ignoreAnchorPointForPosition(false);\n        minuteMenu.setAnchorPoint(0, 0);\n        this.addChild(minuteMenu);\n        // 添加second上下按钮\n        var secondMenuUp = new cc.MenuItemLabel(new cc.LabelTTF(\"^\", \"\", 50), this.secondUp, this);\n        secondMenuUp.setPosition(0, hourMenuUp.height + 10);\n        var secondMenuDown = new cc.MenuItemLabel(new cc.LabelTTF(\"v\", \"\", 50), this.secondDown, this);\n        secondMenuDown.setPosition(0, 0);\n        var secondMenu = new cc.Menu(secondMenuUp, secondMenuDown);\n        secondMenu.setPosition(this.size.width * 5 / 6, 20);\n        secondMenu.ignoreAnchorPointForPosition(false);\n        secondMenu.setAnchorPoint(0, 0);\n        this.addChild(secondMenu);\n        return true;\n    },\n    hourUp: function () {\n        var layer = this.getChildByTag(0);\n        var hourLayer = layer.getChildByTag(1);\n        hourLayer.setPositionY(hourLayer.getPositionY()+30);\n    },\n    hourDown: function () {\n        var layer = this.getChildByTag(0);\n        var hourLayer = layer.getChildByTag(1);\n        hourLayer.setPositionY(hourLayer.getPositionY()-30);\n    },\n    minuteUp: function () {\n        var layer = this.getChildByTag(0);\n        var minuteLayer = layer.getChildByTag(2);\n        minuteLayer.setPositionY(minuteLayer.getPositionY()+30);\n    },\n    minuteDown: function () {\n        var layer = this.getChildByTag(0);\n        var minuteLayer = layer.getChildByTag(2);\n        minuteLayer.setPositionY(minuteLayer.getPositionY()-30);\n    },\n    secondUp: function () {\n        var layer = this.getChildByTag(0);\n        var secondLayer = layer.getChildByTag(3);\n        secondLayer.setPositionY(secondLayer.getPositionY()+30);\n    },\n    secondDown: function () {\n        var layer = this.getChildByTag(0);\n        var secondLayer = layer.getChildByTag(3);\n        secondLayer.setPositionY(secondLayer.getPositionY()-30);\n    },\n    refresh: function (first) {\n        var now = new Date();\n        var hour = now.getHours();\n        var minute = now.getMinutes();\n        var seconds = now.getSeconds();\n        var hour1 = hour.toString().length > 1 ? hour.toString().charAt(0) : 0;\n        var hour2 = hour.toString().length > 1 ? hour.toString().charAt(1) : hour;\n        var minute1 = minute.toString().length > 1 ? minute.toString().charAt(0) : 0;\n        var minute2 = minute.toString().length > 1 ? minute.toString().charAt(1) : minute;\n        var second1 = seconds.toString().length > 1 ? seconds.toString().charAt(0) : 0;\n        var second2 = seconds.toString().length > 1 ? seconds.toString().charAt(1) : seconds;\n        var layer = this.getChildByTag(0);\n        var hourLayer = layer.getChildByTag(1);\n        var minuteLayer = layer.getChildByTag(2);\n        var secondLayer = layer.getChildByTag(3);\n        if (layer.getChildByTag(4) != null) {\n            layer.removeChildByTag(4);\n        }\n        if (layer.getChildByTag(5) != null) {\n            layer.removeChildByTag(5);\n        }\n        hourLayer.removeAllChildren();\n        minuteLayer.removeAllChildren();\n        secondLayer.removeAllChildren();\n        // 添加6个数字和2个冒号\n        var initX = 20;\n        var initY = this.size.height / 2;\n        // hour\n        var num1 = new Layer0202(Number(hour1), initX, initY);\n        var num2 = new Layer0202(Number(hour2), num1.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        // 冒号\n        var num3 = new Layer0202(-1, num2.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        // minute\n        var num4 = new Layer0202(Number(minute1), num3.getPositionX() + cellSpace * 3 + rectWidth * 4 + 10, initY);\n        var num5 = new Layer0202(Number(minute2), num4.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        // 冒号\n        var num6 = new Layer0202(-1, num5.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        // second\n        var num7 = new Layer0202(Number(second1), num6.getPositionX() + cellSpace * 3 + rectWidth * 4 + 10, initY);\n        var num8 = new Layer0202(Number(second2), num7.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        // 设置小时图层\n        hourLayer.addChild(num1);\n        hourLayer.addChild(num2);\n        // 添加冒号\n        layer.addChild(num3);\n        num3.setTag(4);\n        // 设置分钟图层\n        minuteLayer.addChild(num4);\n        minuteLayer.addChild(num5);\n        layer.addChild(num6);\n        num6.setTag(5);\n        // 设置秒图层\n        secondLayer.addChild(num7);\n        secondLayer.addChild(num8);\n    }\n});\n\n// 本节作业：\n// 锚点也叫对齐点，是Position对齐的坐标，如果0,0则用这个node的左下角对齐position\n// 如果是1,1则用node的右上角对齐\n// 0.5,0.5则用node的中心来对齐\n// 作业：\n// 使用锚点实现 11:58 这个时间的显示，注意要画很多的矩形呦\n// 至于这个时间怎么能变 我们后面讲\n// 两个冒号 也是矩形\n\n// 预先设置好数组的显示,以01区分\nvar getNum = function (num) {\n    switch (num) {\n        case -1:// 冒号\n            return [\n                [0, 0, 0, 0],\n                [0, 0, 0, 0],\n                [0, 1, 1, 0],\n                [0, 1, 1, 0],\n                [0, 0, 0, 0],\n                [0, 1, 1, 0],\n                [0, 1, 1, 0],\n                [0, 0, 0, 0]\n            ];\n        case 0:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 0, 0, 0, 1, 0],\n                [0, 1, 0, 1, 0, 0, 1, 0],\n                [0, 1, 0, 0, 1, 0, 1, 0],\n                [0, 1, 0, 0, 0, 1, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 1:\n            return [\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 1, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 2:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 1, 0, 0],\n                [0, 0, 0, 0, 1, 0, 0, 0],\n                [0, 0, 0, 1, 0, 0, 0, 0],\n                [0, 0, 1, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 1, 1, 1, 1, 0]\n            ];\n        case 3:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 4:\n            return [\n                [0, 0, 0, 0, 1, 0, 1, 0],\n                [0, 0, 0, 1, 0, 0, 1, 0],\n                [0, 0, 1, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 1, 1, 1, 1, 1],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0]\n            ];\n        case 5:\n            return [\n                [0, 1, 1, 1, 1, 1, 1, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0],\n                [0, 1, 1, 1, 1, 1, 0, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 1, 1, 1, 0, 0]\n            ];\n        case 6:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0],\n                [0, 1, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 7:\n            return [\n                [0, 0, 1, 1, 1, 1, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 1, 0, 0],\n                [0, 0, 0, 0, 1, 0, 0, 0],\n                [0, 0, 0, 1, 0, 0, 0, 0],\n                [0, 0, 1, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0]\n            ];\n        case 8:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 9:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n    }\n}\n```\n\n### 运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_17/81435b882df65c1f94e7f5793e1e3de35d6e15a1/\n","source":"_posts/CVP认证学习笔记--(何小成)008--Node的父子关系.md","raw":"---\ntitle: CVP认证学习笔记--(何小成)008--Node的父子关系\ndate: 2016-04-18 00:06\ncategories: cocos2d-js\ntags: [cocos2d-js,cvp]\n---\n### 概念\n本节课内容主要讲了node之间的层级关系，场景中所有的Node是一个节点树，可以根据节点间的关系获取到所需要的节点，并进行相应的操作。在开发中，如果需要对多个node同时进行一个操作，可以将这些node放在一个node中，通过操作这个总的node，<!--more-->就能产生相应的效果。如本节课作业，需要将时间的58分进行上移或下移，在上节课作业中，5和8一般情况下是在两个图层中，而如果需要同时进行上移或下移，就可以把他们放在一个图层中进行操作。一个父节点可以有多个子节点，而一个子节点只能有一个父节点，合理安排图层中节点的关系，可以使得开发中获取各node更加的方便。\n### 作业\n上节课我的作业中是实现的电子钟，这节课作业中我对时分秒分别加入上下两个按钮，实现时分秒的上移或下移，代码如下：\n```javascript\n/**\n * Created by Henry on 16/4/16.\n */\nvar cellSpace = 3;\nvar rectWidth = 10;\nvar rectHeight = 10;\nvar Layer0202 = cc.Layer.extend({\n    normalColor: cc.color(245, 245, 245, 50),\n    numColor: cc.color(152, 245, 255, 255),\n    numColor2: cc.color(152, 245, 255, 80),\n    initX: 0,\n    ctor: function (num, initX, initY) {\n        this._super();\n        var size = cc.winSize;\n        this.initX = initX;\n        var rects = [];\n        var rectNum = num == -1 ? 4 : 8;\n        // 添加显示时间方块\n        for (var row = 0; row < 8; row++) {\n            rects[row] = [];\n            for (var col = 0; col < rectNum; col++) {\n                rects[row][col] = new cc.LayerColor(this.normalColor, rectWidth, rectHeight);\n                rects[row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + row * (cellSpace + rectHeight));\n                rects[row][col].ignoreAnchorPointForPosition(false);\n                rects[row][col].setAnchorPoint(0.5, 0.5);\n                this.addChild(rects[row][col]);\n            }\n        }\n        // 获取要现实的数字的阵型\n        var numArr = getNum(num);\n        for (var row = 0; row < 8; row++) {\n            for (var col = 0; col < rectNum; col++) {\n                if (numArr[row][col] == 1) {\n                    // 改变数字显示单元格的颜色\n                    rects[7 - row][col] = new cc.LayerColor(this.numColor2, rectWidth, rectHeight);\n                    rects[7 - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (7 - row) * (cellSpace + rectHeight));\n                    rects[7 - row][col].ignoreAnchorPointForPosition(false);\n                    rects[7 - row][col].setAnchorPoint(0.5, 0.5);\n                    this.addChild(rects[7 - row][col]);\n                }\n            }\n        }\n        for (var row = 0; row < 8; row++) {\n            for (var col = 0; col < rectNum; col++) {\n                if (numArr[row][col] == 1) {\n                    // 改变数字显示单元格的颜色\n                    rects[7 - row][col] = new cc.LayerColor(this.numColor, rectWidth, rectHeight);\n                    rects[7 - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (7 - row) * (cellSpace + rectHeight));\n                    rects[7 - row][col].ignoreAnchorPointForPosition(false);\n                    rects[7 - row][col].setAnchorPoint(0.8, 0.2);\n                    this.addChild(rects[7 - row][col]);\n                }\n            }\n        }\n\n        return true;\n    },\n    getPositionX: function () {\n        return this.initX;\n    }\n});\n\nvar Scene0202 = cc.Scene.extend({\n    size: cc.winSize,\n    ctor: function () {\n        this._super();\n        // 定义时分秒三个layer\n        var layer = new cc.Layer();\n        this.addChild(layer);\n        layer.setTag(0);\n        var hourLayer = new cc.Layer();\n        var minuteLayer = new cc.Layer();\n        var secondLayer = new cc.Layer();\n        layer.addChild(hourLayer);\n        layer.addChild(minuteLayer);\n        layer.addChild(secondLayer);\n        hourLayer.setTag(1);\n        minuteLayer.setTag(2);\n        secondLayer.setTag(3);\n        hourLayer.width = cellSpace * 7 + rectWidth * 8;\n        hourLayer.height = cellSpace * 7 + rectWidth * 8;\n        minuteLayer.width = cellSpace * 7 + rectWidth * 8;\n        minuteLayer.height = cellSpace * 7 + rectWidth * 8;\n        secondLayer.height = cellSpace * 7 + rectWidth * 8;\n        secondLayer.width = cellSpace * 7 + rectWidth * 8;\n        layer.setPositionX((this.size.width - layer.width) / 2);\n        // 每秒刷新\n        this.refresh();\n        this.schedule(this.refresh, 1);\n        this.scheduleUpdate();\n        // 添加hour上下按钮\n        var hourMenuUp = new cc.MenuItemLabel(new cc.LabelTTF(\"^\", \"\", 50), this.hourUp, this);\n        hourMenuUp.setPosition(0, hourMenuUp.height + 10);\n        var hourMenuDown = new cc.MenuItemLabel(new cc.LabelTTF(\"v\", \"\", 50), this.hourDown, this);\n        hourMenuDown.setPosition(0, 0);\n        var hourMenu = new cc.Menu(hourMenuUp, hourMenuDown);\n        hourMenu.setPosition(this.size.width / 6, 20);\n        hourMenu.ignoreAnchorPointForPosition(false);\n        hourMenu.setAnchorPoint(0, 0);\n        this.addChild(hourMenu);\n        // 添加minute上下按钮\n        var minuteMenuUp = new cc.MenuItemLabel(new cc.LabelTTF(\"^\", \"\", 50), this.minuteUp, this);\n        minuteMenuUp.setPosition(0, minuteMenuUp.height + 10);\n        var minuteMenuDown = new cc.MenuItemLabel(new cc.LabelTTF(\"v\", \"\", 50), this.minuteDown, this);\n        minuteMenuDown.setPosition(0, 0);\n        var minuteMenu = new cc.Menu(minuteMenuUp, minuteMenuDown);\n        minuteMenu.setPosition(this.size.width / 2, 20);\n        minuteMenu.ignoreAnchorPointForPosition(false);\n        minuteMenu.setAnchorPoint(0, 0);\n        this.addChild(minuteMenu);\n        // 添加second上下按钮\n        var secondMenuUp = new cc.MenuItemLabel(new cc.LabelTTF(\"^\", \"\", 50), this.secondUp, this);\n        secondMenuUp.setPosition(0, hourMenuUp.height + 10);\n        var secondMenuDown = new cc.MenuItemLabel(new cc.LabelTTF(\"v\", \"\", 50), this.secondDown, this);\n        secondMenuDown.setPosition(0, 0);\n        var secondMenu = new cc.Menu(secondMenuUp, secondMenuDown);\n        secondMenu.setPosition(this.size.width * 5 / 6, 20);\n        secondMenu.ignoreAnchorPointForPosition(false);\n        secondMenu.setAnchorPoint(0, 0);\n        this.addChild(secondMenu);\n        return true;\n    },\n    hourUp: function () {\n        var layer = this.getChildByTag(0);\n        var hourLayer = layer.getChildByTag(1);\n        hourLayer.setPositionY(hourLayer.getPositionY()+30);\n    },\n    hourDown: function () {\n        var layer = this.getChildByTag(0);\n        var hourLayer = layer.getChildByTag(1);\n        hourLayer.setPositionY(hourLayer.getPositionY()-30);\n    },\n    minuteUp: function () {\n        var layer = this.getChildByTag(0);\n        var minuteLayer = layer.getChildByTag(2);\n        minuteLayer.setPositionY(minuteLayer.getPositionY()+30);\n    },\n    minuteDown: function () {\n        var layer = this.getChildByTag(0);\n        var minuteLayer = layer.getChildByTag(2);\n        minuteLayer.setPositionY(minuteLayer.getPositionY()-30);\n    },\n    secondUp: function () {\n        var layer = this.getChildByTag(0);\n        var secondLayer = layer.getChildByTag(3);\n        secondLayer.setPositionY(secondLayer.getPositionY()+30);\n    },\n    secondDown: function () {\n        var layer = this.getChildByTag(0);\n        var secondLayer = layer.getChildByTag(3);\n        secondLayer.setPositionY(secondLayer.getPositionY()-30);\n    },\n    refresh: function (first) {\n        var now = new Date();\n        var hour = now.getHours();\n        var minute = now.getMinutes();\n        var seconds = now.getSeconds();\n        var hour1 = hour.toString().length > 1 ? hour.toString().charAt(0) : 0;\n        var hour2 = hour.toString().length > 1 ? hour.toString().charAt(1) : hour;\n        var minute1 = minute.toString().length > 1 ? minute.toString().charAt(0) : 0;\n        var minute2 = minute.toString().length > 1 ? minute.toString().charAt(1) : minute;\n        var second1 = seconds.toString().length > 1 ? seconds.toString().charAt(0) : 0;\n        var second2 = seconds.toString().length > 1 ? seconds.toString().charAt(1) : seconds;\n        var layer = this.getChildByTag(0);\n        var hourLayer = layer.getChildByTag(1);\n        var minuteLayer = layer.getChildByTag(2);\n        var secondLayer = layer.getChildByTag(3);\n        if (layer.getChildByTag(4) != null) {\n            layer.removeChildByTag(4);\n        }\n        if (layer.getChildByTag(5) != null) {\n            layer.removeChildByTag(5);\n        }\n        hourLayer.removeAllChildren();\n        minuteLayer.removeAllChildren();\n        secondLayer.removeAllChildren();\n        // 添加6个数字和2个冒号\n        var initX = 20;\n        var initY = this.size.height / 2;\n        // hour\n        var num1 = new Layer0202(Number(hour1), initX, initY);\n        var num2 = new Layer0202(Number(hour2), num1.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        // 冒号\n        var num3 = new Layer0202(-1, num2.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        // minute\n        var num4 = new Layer0202(Number(minute1), num3.getPositionX() + cellSpace * 3 + rectWidth * 4 + 10, initY);\n        var num5 = new Layer0202(Number(minute2), num4.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        // 冒号\n        var num6 = new Layer0202(-1, num5.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        // second\n        var num7 = new Layer0202(Number(second1), num6.getPositionX() + cellSpace * 3 + rectWidth * 4 + 10, initY);\n        var num8 = new Layer0202(Number(second2), num7.getPositionX() + cellSpace * 7 + rectWidth * 8 + 10, initY);\n        // 设置小时图层\n        hourLayer.addChild(num1);\n        hourLayer.addChild(num2);\n        // 添加冒号\n        layer.addChild(num3);\n        num3.setTag(4);\n        // 设置分钟图层\n        minuteLayer.addChild(num4);\n        minuteLayer.addChild(num5);\n        layer.addChild(num6);\n        num6.setTag(5);\n        // 设置秒图层\n        secondLayer.addChild(num7);\n        secondLayer.addChild(num8);\n    }\n});\n\n// 本节作业：\n// 锚点也叫对齐点，是Position对齐的坐标，如果0,0则用这个node的左下角对齐position\n// 如果是1,1则用node的右上角对齐\n// 0.5,0.5则用node的中心来对齐\n// 作业：\n// 使用锚点实现 11:58 这个时间的显示，注意要画很多的矩形呦\n// 至于这个时间怎么能变 我们后面讲\n// 两个冒号 也是矩形\n\n// 预先设置好数组的显示,以01区分\nvar getNum = function (num) {\n    switch (num) {\n        case -1:// 冒号\n            return [\n                [0, 0, 0, 0],\n                [0, 0, 0, 0],\n                [0, 1, 1, 0],\n                [0, 1, 1, 0],\n                [0, 0, 0, 0],\n                [0, 1, 1, 0],\n                [0, 1, 1, 0],\n                [0, 0, 0, 0]\n            ];\n        case 0:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 0, 0, 0, 1, 0],\n                [0, 1, 0, 1, 0, 0, 1, 0],\n                [0, 1, 0, 0, 1, 0, 1, 0],\n                [0, 1, 0, 0, 0, 1, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 1:\n            return [\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 1, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 2:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 1, 0, 0],\n                [0, 0, 0, 0, 1, 0, 0, 0],\n                [0, 0, 0, 1, 0, 0, 0, 0],\n                [0, 0, 1, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 1, 1, 1, 1, 0]\n            ];\n        case 3:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 4:\n            return [\n                [0, 0, 0, 0, 1, 0, 1, 0],\n                [0, 0, 0, 1, 0, 0, 1, 0],\n                [0, 0, 1, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 1, 1, 1, 1, 1],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0]\n            ];\n        case 5:\n            return [\n                [0, 1, 1, 1, 1, 1, 1, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0],\n                [0, 1, 1, 1, 1, 1, 0, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 1, 1, 1, 1, 1, 0, 0]\n            ];\n        case 6:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0],\n                [0, 1, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 7:\n            return [\n                [0, 0, 1, 1, 1, 1, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 0, 0, 0, 0, 1, 0, 0],\n                [0, 0, 0, 0, 1, 0, 0, 0],\n                [0, 0, 0, 1, 0, 0, 0, 0],\n                [0, 0, 1, 0, 0, 0, 0, 0],\n                [0, 1, 0, 0, 0, 0, 0, 0]\n            ];\n        case 8:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n        case 9:\n            return [\n                [0, 0, 1, 1, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 1, 0],\n                [0, 0, 0, 0, 0, 0, 1, 0],\n                [0, 1, 0, 0, 0, 0, 1, 0],\n                [0, 0, 1, 1, 1, 1, 0, 0]\n            ];\n    }\n}\n```\n\n### 运行效果\nhttp://www.cocoscvp.com/usercode/2016_04_17/81435b882df65c1f94e7f5793e1e3de35d6e15a1/\n","slug":"CVP认证学习笔记--(何小成)008--Node的父子关系","published":1,"updated":"2016-04-24T15:02:24.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhvk004twsaz7ccf2apc","content":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课内容主要讲了node之间的层级关系，场景中所有的Node是一个节点树，可以根据节点间的关系获取到所需要的节点，并进行相应的操作。在开发中，如果需要对多个node同时进行一个操作，可以将这些node放在一个node中，通过操作这个总的node，<a id=\"more\"></a>就能产生相应的效果。如本节课作业，需要将时间的58分进行上移或下移，在上节课作业中，5和8一般情况下是在两个图层中，而如果需要同时进行上移或下移，就可以把他们放在一个图层中进行操作。一个父节点可以有多个子节点，而一个子节点只能有一个父节点，合理安排图层中节点的关系，可以使得开发中获取各node更加的方便。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>上节课我的作业中是实现的电子钟，这节课作业中我对时分秒分别加入上下两个按钮，实现时分秒的上移或下移，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/4/16.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> cellSpace = <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> rectWidth = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> rectHeight = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> Layer0202 = cc.Layer.extend(&#123;</span><br><span class=\"line\">    normalColor: cc.color(<span class=\"number\">245</span>, <span class=\"number\">245</span>, <span class=\"number\">245</span>, <span class=\"number\">50</span>),</span><br><span class=\"line\">    numColor: cc.color(<span class=\"number\">152</span>, <span class=\"number\">245</span>, <span class=\"number\">255</span>, <span class=\"number\">255</span>),</span><br><span class=\"line\">    numColor2: cc.color(<span class=\"number\">152</span>, <span class=\"number\">245</span>, <span class=\"number\">255</span>, <span class=\"number\">80</span>),</span><br><span class=\"line\">    initX: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num, initX, initY</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.initX = initX;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rects = [];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rectNum = num == <span class=\"number\">-1</span> ? <span class=\"number\">4</span> : <span class=\"number\">8</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 添加显示时间方块</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">8</span>; row++) &#123;</span><br><span class=\"line\">            rects[row] = [];</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; rectNum; col++) &#123;</span><br><span class=\"line\">                rects[row][col] = <span class=\"keyword\">new</span> cc.LayerColor(<span class=\"built_in\">this</span>.normalColor, rectWidth, rectHeight);</span><br><span class=\"line\">                rects[row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + row * (cellSpace + rectHeight));</span><br><span class=\"line\">                rects[row][col].ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                rects[row][col].setAnchorPoint(<span class=\"number\">0.5</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.addChild(rects[row][col]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 获取要现实的数字的阵型</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> numArr = getNum(num);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">8</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; rectNum; col++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (numArr[row][col] == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 改变数字显示单元格的颜色</span></span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col] = <span class=\"keyword\">new</span> cc.LayerColor(<span class=\"built_in\">this</span>.numColor2, rectWidth, rectHeight);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (<span class=\"number\">7</span> - row) * (cellSpace + rectHeight));</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setAnchorPoint(<span class=\"number\">0.5</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.addChild(rects[<span class=\"number\">7</span> - row][col]);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">8</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; rectNum; col++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (numArr[row][col] == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 改变数字显示单元格的颜色</span></span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col] = <span class=\"keyword\">new</span> cc.LayerColor(<span class=\"built_in\">this</span>.numColor, rectWidth, rectHeight);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (<span class=\"number\">7</span> - row) * (cellSpace + rectHeight));</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setAnchorPoint(<span class=\"number\">0.8</span>, <span class=\"number\">0.2</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.addChild(rects[<span class=\"number\">7</span> - row][col]);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    getPositionX: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.initX;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Scene0202 = cc.Scene.extend(&#123;</span><br><span class=\"line\">    size: cc.winSize,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">// 定义时分秒三个layer</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> cc.Layer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">        layer.setTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourLayer = <span class=\"keyword\">new</span> cc.Layer();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteLayer = <span class=\"keyword\">new</span> cc.Layer();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondLayer = <span class=\"keyword\">new</span> cc.Layer();</span><br><span class=\"line\">        layer.addChild(hourLayer);</span><br><span class=\"line\">        layer.addChild(minuteLayer);</span><br><span class=\"line\">        layer.addChild(secondLayer);</span><br><span class=\"line\">        hourLayer.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        minuteLayer.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        secondLayer.setTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        hourLayer.width = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        hourLayer.height = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        minuteLayer.width = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        minuteLayer.height = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        secondLayer.height = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        secondLayer.width = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        layer.setPositionX((<span class=\"built_in\">this</span>.size.width - layer.width) / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 每秒刷新</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.refresh();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.refresh, <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scheduleUpdate();</span><br><span class=\"line\">        <span class=\"comment\">// 添加hour上下按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourMenuUp = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;^&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>), <span class=\"built_in\">this</span>.hourUp, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        hourMenuUp.setPosition(<span class=\"number\">0</span>, hourMenuUp.height + <span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourMenuDown = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;v&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>), <span class=\"built_in\">this</span>.hourDown, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        hourMenuDown.setPosition(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourMenu = <span class=\"keyword\">new</span> cc.Menu(hourMenuUp, hourMenuDown);</span><br><span class=\"line\">        hourMenu.setPosition(<span class=\"built_in\">this</span>.size.width / <span class=\"number\">6</span>, <span class=\"number\">20</span>);</span><br><span class=\"line\">        hourMenu.ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        hourMenu.setAnchorPoint(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(hourMenu);</span><br><span class=\"line\">        <span class=\"comment\">// 添加minute上下按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteMenuUp = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;^&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>), <span class=\"built_in\">this</span>.minuteUp, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        minuteMenuUp.setPosition(<span class=\"number\">0</span>, minuteMenuUp.height + <span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteMenuDown = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;v&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>), <span class=\"built_in\">this</span>.minuteDown, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        minuteMenuDown.setPosition(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteMenu = <span class=\"keyword\">new</span> cc.Menu(minuteMenuUp, minuteMenuDown);</span><br><span class=\"line\">        minuteMenu.setPosition(<span class=\"built_in\">this</span>.size.width / <span class=\"number\">2</span>, <span class=\"number\">20</span>);</span><br><span class=\"line\">        minuteMenu.ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        minuteMenu.setAnchorPoint(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(minuteMenu);</span><br><span class=\"line\">        <span class=\"comment\">// 添加second上下按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondMenuUp = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;^&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>), <span class=\"built_in\">this</span>.secondUp, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        secondMenuUp.setPosition(<span class=\"number\">0</span>, hourMenuUp.height + <span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondMenuDown = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;v&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>), <span class=\"built_in\">this</span>.secondDown, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        secondMenuDown.setPosition(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondMenu = <span class=\"keyword\">new</span> cc.Menu(secondMenuUp, secondMenuDown);</span><br><span class=\"line\">        secondMenu.setPosition(<span class=\"built_in\">this</span>.size.width * <span class=\"number\">5</span> / <span class=\"number\">6</span>, <span class=\"number\">20</span>);</span><br><span class=\"line\">        secondMenu.ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        secondMenu.setAnchorPoint(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(secondMenu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    hourUp: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourLayer = layer.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        hourLayer.setPositionY(hourLayer.getPositionY()+<span class=\"number\">30</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    hourDown: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourLayer = layer.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        hourLayer.setPositionY(hourLayer.getPositionY()<span class=\"number\">-30</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    minuteUp: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteLayer = layer.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        minuteLayer.setPositionY(minuteLayer.getPositionY()+<span class=\"number\">30</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    minuteDown: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteLayer = layer.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        minuteLayer.setPositionY(minuteLayer.getPositionY()<span class=\"number\">-30</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    secondUp: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondLayer = layer.getChildByTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        secondLayer.setPositionY(secondLayer.getPositionY()+<span class=\"number\">30</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    secondDown: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondLayer = layer.getChildByTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        secondLayer.setPositionY(secondLayer.getPositionY()<span class=\"number\">-30</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    refresh: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">first</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> now = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hour = now.getHours();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minute = now.getMinutes();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> seconds = now.getSeconds();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hour1 = hour.toString().length &gt; <span class=\"number\">1</span> ? hour.toString().charAt(<span class=\"number\">0</span>) : <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hour2 = hour.toString().length &gt; <span class=\"number\">1</span> ? hour.toString().charAt(<span class=\"number\">1</span>) : hour;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minute1 = minute.toString().length &gt; <span class=\"number\">1</span> ? minute.toString().charAt(<span class=\"number\">0</span>) : <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minute2 = minute.toString().length &gt; <span class=\"number\">1</span> ? minute.toString().charAt(<span class=\"number\">1</span>) : minute;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> second1 = seconds.toString().length &gt; <span class=\"number\">1</span> ? seconds.toString().charAt(<span class=\"number\">0</span>) : <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> second2 = seconds.toString().length &gt; <span class=\"number\">1</span> ? seconds.toString().charAt(<span class=\"number\">1</span>) : seconds;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourLayer = layer.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteLayer = layer.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondLayer = layer.getChildByTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (layer.getChildByTag(<span class=\"number\">4</span>) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            layer.removeChildByTag(<span class=\"number\">4</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (layer.getChildByTag(<span class=\"number\">5</span>) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            layer.removeChildByTag(<span class=\"number\">5</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        hourLayer.removeAllChildren();</span><br><span class=\"line\">        minuteLayer.removeAllChildren();</span><br><span class=\"line\">        secondLayer.removeAllChildren();</span><br><span class=\"line\">        <span class=\"comment\">// 添加6个数字和2个冒号</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> initX = <span class=\"number\">20</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> initY = <span class=\"built_in\">this</span>.size.height / <span class=\"number\">2</span>;</span><br><span class=\"line\">        <span class=\"comment\">// hour</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> num1 = <span class=\"keyword\">new</span> Layer0202(<span class=\"built_in\">Number</span>(hour1), initX, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num2 = <span class=\"keyword\">new</span> Layer0202(<span class=\"built_in\">Number</span>(hour2), num1.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"comment\">// 冒号</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> num3 = <span class=\"keyword\">new</span> Layer0202(<span class=\"number\">-1</span>, num2.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"comment\">// minute</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> num4 = <span class=\"keyword\">new</span> Layer0202(<span class=\"built_in\">Number</span>(minute1), num3.getPositionX() + cellSpace * <span class=\"number\">3</span> + rectWidth * <span class=\"number\">4</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num5 = <span class=\"keyword\">new</span> Layer0202(<span class=\"built_in\">Number</span>(minute2), num4.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"comment\">// 冒号</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> num6 = <span class=\"keyword\">new</span> Layer0202(<span class=\"number\">-1</span>, num5.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"comment\">// second</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> num7 = <span class=\"keyword\">new</span> Layer0202(<span class=\"built_in\">Number</span>(second1), num6.getPositionX() + cellSpace * <span class=\"number\">3</span> + rectWidth * <span class=\"number\">4</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num8 = <span class=\"keyword\">new</span> Layer0202(<span class=\"built_in\">Number</span>(second2), num7.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"comment\">// 设置小时图层</span></span><br><span class=\"line\">        hourLayer.addChild(num1);</span><br><span class=\"line\">        hourLayer.addChild(num2);</span><br><span class=\"line\">        <span class=\"comment\">// 添加冒号</span></span><br><span class=\"line\">        layer.addChild(num3);</span><br><span class=\"line\">        num3.setTag(<span class=\"number\">4</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 设置分钟图层</span></span><br><span class=\"line\">        minuteLayer.addChild(num4);</span><br><span class=\"line\">        minuteLayer.addChild(num5);</span><br><span class=\"line\">        layer.addChild(num6);</span><br><span class=\"line\">        num6.setTag(<span class=\"number\">5</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 设置秒图层</span></span><br><span class=\"line\">        secondLayer.addChild(num7);</span><br><span class=\"line\">        secondLayer.addChild(num8);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 本节作业：</span></span><br><span class=\"line\"><span class=\"comment\">// 锚点也叫对齐点，是Position对齐的坐标，如果0,0则用这个node的左下角对齐position</span></span><br><span class=\"line\"><span class=\"comment\">// 如果是1,1则用node的右上角对齐</span></span><br><span class=\"line\"><span class=\"comment\">// 0.5,0.5则用node的中心来对齐</span></span><br><span class=\"line\"><span class=\"comment\">// 作业：</span></span><br><span class=\"line\"><span class=\"comment\">// 使用锚点实现 11:58 这个时间的显示，注意要画很多的矩形呦</span></span><br><span class=\"line\"><span class=\"comment\">// 至于这个时间怎么能变 我们后面讲</span></span><br><span class=\"line\"><span class=\"comment\">// 两个冒号 也是矩形</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 预先设置好数组的显示,以01区分</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getNum = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (num) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">-1</span>:<span class=\"comment\">// 冒号</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">9</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_17/81435b882df65c1f94e7f5793e1e3de35d6e15a1/\">http://www.cocoscvp.com/usercode/2016_04_17/81435b882df65c1f94e7f5793e1e3de35d6e15a1/</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>本节课内容主要讲了node之间的层级关系，场景中所有的Node是一个节点树，可以根据节点间的关系获取到所需要的节点，并进行相应的操作。在开发中，如果需要对多个node同时进行一个操作，可以将这些node放在一个node中，通过操作这个总的node，","more":"就能产生相应的效果。如本节课作业，需要将时间的58分进行上移或下移，在上节课作业中，5和8一般情况下是在两个图层中，而如果需要同时进行上移或下移，就可以把他们放在一个图层中进行操作。一个父节点可以有多个子节点，而一个子节点只能有一个父节点，合理安排图层中节点的关系，可以使得开发中获取各node更加的方便。</p>\n<h3 id=\"作业\"><a href=\"#作业\" class=\"headerlink\" title=\"作业\"></a>作业</h3><p>上节课我的作业中是实现的电子钟，这节课作业中我对时分秒分别加入上下两个按钮，实现时分秒的上移或下移，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/4/16.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> cellSpace = <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> rectWidth = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> rectHeight = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> Layer0202 = cc.Layer.extend(&#123;</span><br><span class=\"line\">    normalColor: cc.color(<span class=\"number\">245</span>, <span class=\"number\">245</span>, <span class=\"number\">245</span>, <span class=\"number\">50</span>),</span><br><span class=\"line\">    numColor: cc.color(<span class=\"number\">152</span>, <span class=\"number\">245</span>, <span class=\"number\">255</span>, <span class=\"number\">255</span>),</span><br><span class=\"line\">    numColor2: cc.color(<span class=\"number\">152</span>, <span class=\"number\">245</span>, <span class=\"number\">255</span>, <span class=\"number\">80</span>),</span><br><span class=\"line\">    initX: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num, initX, initY</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.initX = initX;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rects = [];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rectNum = num == <span class=\"number\">-1</span> ? <span class=\"number\">4</span> : <span class=\"number\">8</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 添加显示时间方块</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">8</span>; row++) &#123;</span><br><span class=\"line\">            rects[row] = [];</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; rectNum; col++) &#123;</span><br><span class=\"line\">                rects[row][col] = <span class=\"keyword\">new</span> cc.LayerColor(<span class=\"built_in\">this</span>.normalColor, rectWidth, rectHeight);</span><br><span class=\"line\">                rects[row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + row * (cellSpace + rectHeight));</span><br><span class=\"line\">                rects[row][col].ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                rects[row][col].setAnchorPoint(<span class=\"number\">0.5</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.addChild(rects[row][col]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 获取要现实的数字的阵型</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> numArr = getNum(num);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">8</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; rectNum; col++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (numArr[row][col] == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 改变数字显示单元格的颜色</span></span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col] = <span class=\"keyword\">new</span> cc.LayerColor(<span class=\"built_in\">this</span>.numColor2, rectWidth, rectHeight);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (<span class=\"number\">7</span> - row) * (cellSpace + rectHeight));</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setAnchorPoint(<span class=\"number\">0.5</span>, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.addChild(rects[<span class=\"number\">7</span> - row][col]);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">8</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; rectNum; col++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (numArr[row][col] == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 改变数字显示单元格的颜色</span></span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col] = <span class=\"keyword\">new</span> cc.LayerColor(<span class=\"built_in\">this</span>.numColor, rectWidth, rectHeight);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setPosition(initX + col * (cellSpace + rectWidth), initY + (<span class=\"number\">7</span> - row) * (cellSpace + rectHeight));</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                    rects[<span class=\"number\">7</span> - row][col].setAnchorPoint(<span class=\"number\">0.8</span>, <span class=\"number\">0.2</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.addChild(rects[<span class=\"number\">7</span> - row][col]);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    getPositionX: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.initX;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Scene0202 = cc.Scene.extend(&#123;</span><br><span class=\"line\">    size: cc.winSize,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">// 定义时分秒三个layer</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> cc.Layer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">        layer.setTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourLayer = <span class=\"keyword\">new</span> cc.Layer();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteLayer = <span class=\"keyword\">new</span> cc.Layer();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondLayer = <span class=\"keyword\">new</span> cc.Layer();</span><br><span class=\"line\">        layer.addChild(hourLayer);</span><br><span class=\"line\">        layer.addChild(minuteLayer);</span><br><span class=\"line\">        layer.addChild(secondLayer);</span><br><span class=\"line\">        hourLayer.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        minuteLayer.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        secondLayer.setTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        hourLayer.width = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        hourLayer.height = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        minuteLayer.width = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        minuteLayer.height = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        secondLayer.height = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        secondLayer.width = cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span>;</span><br><span class=\"line\">        layer.setPositionX((<span class=\"built_in\">this</span>.size.width - layer.width) / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 每秒刷新</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.refresh();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.refresh, <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scheduleUpdate();</span><br><span class=\"line\">        <span class=\"comment\">// 添加hour上下按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourMenuUp = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;^&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>), <span class=\"built_in\">this</span>.hourUp, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        hourMenuUp.setPosition(<span class=\"number\">0</span>, hourMenuUp.height + <span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourMenuDown = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;v&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>), <span class=\"built_in\">this</span>.hourDown, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        hourMenuDown.setPosition(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourMenu = <span class=\"keyword\">new</span> cc.Menu(hourMenuUp, hourMenuDown);</span><br><span class=\"line\">        hourMenu.setPosition(<span class=\"built_in\">this</span>.size.width / <span class=\"number\">6</span>, <span class=\"number\">20</span>);</span><br><span class=\"line\">        hourMenu.ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        hourMenu.setAnchorPoint(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(hourMenu);</span><br><span class=\"line\">        <span class=\"comment\">// 添加minute上下按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteMenuUp = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;^&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>), <span class=\"built_in\">this</span>.minuteUp, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        minuteMenuUp.setPosition(<span class=\"number\">0</span>, minuteMenuUp.height + <span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteMenuDown = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;v&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>), <span class=\"built_in\">this</span>.minuteDown, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        minuteMenuDown.setPosition(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteMenu = <span class=\"keyword\">new</span> cc.Menu(minuteMenuUp, minuteMenuDown);</span><br><span class=\"line\">        minuteMenu.setPosition(<span class=\"built_in\">this</span>.size.width / <span class=\"number\">2</span>, <span class=\"number\">20</span>);</span><br><span class=\"line\">        minuteMenu.ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        minuteMenu.setAnchorPoint(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(minuteMenu);</span><br><span class=\"line\">        <span class=\"comment\">// 添加second上下按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondMenuUp = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;^&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>), <span class=\"built_in\">this</span>.secondUp, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        secondMenuUp.setPosition(<span class=\"number\">0</span>, hourMenuUp.height + <span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondMenuDown = <span class=\"keyword\">new</span> cc.MenuItemLabel(<span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;v&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>), <span class=\"built_in\">this</span>.secondDown, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        secondMenuDown.setPosition(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondMenu = <span class=\"keyword\">new</span> cc.Menu(secondMenuUp, secondMenuDown);</span><br><span class=\"line\">        secondMenu.setPosition(<span class=\"built_in\">this</span>.size.width * <span class=\"number\">5</span> / <span class=\"number\">6</span>, <span class=\"number\">20</span>);</span><br><span class=\"line\">        secondMenu.ignoreAnchorPointForPosition(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        secondMenu.setAnchorPoint(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(secondMenu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    hourUp: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourLayer = layer.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        hourLayer.setPositionY(hourLayer.getPositionY()+<span class=\"number\">30</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    hourDown: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourLayer = layer.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        hourLayer.setPositionY(hourLayer.getPositionY()<span class=\"number\">-30</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    minuteUp: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteLayer = layer.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        minuteLayer.setPositionY(minuteLayer.getPositionY()+<span class=\"number\">30</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    minuteDown: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteLayer = layer.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        minuteLayer.setPositionY(minuteLayer.getPositionY()<span class=\"number\">-30</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    secondUp: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondLayer = layer.getChildByTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        secondLayer.setPositionY(secondLayer.getPositionY()+<span class=\"number\">30</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    secondDown: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondLayer = layer.getChildByTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        secondLayer.setPositionY(secondLayer.getPositionY()<span class=\"number\">-30</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    refresh: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">first</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> now = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hour = now.getHours();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minute = now.getMinutes();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> seconds = now.getSeconds();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hour1 = hour.toString().length &gt; <span class=\"number\">1</span> ? hour.toString().charAt(<span class=\"number\">0</span>) : <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hour2 = hour.toString().length &gt; <span class=\"number\">1</span> ? hour.toString().charAt(<span class=\"number\">1</span>) : hour;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minute1 = minute.toString().length &gt; <span class=\"number\">1</span> ? minute.toString().charAt(<span class=\"number\">0</span>) : <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minute2 = minute.toString().length &gt; <span class=\"number\">1</span> ? minute.toString().charAt(<span class=\"number\">1</span>) : minute;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> second1 = seconds.toString().length &gt; <span class=\"number\">1</span> ? seconds.toString().charAt(<span class=\"number\">0</span>) : <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> second2 = seconds.toString().length &gt; <span class=\"number\">1</span> ? seconds.toString().charAt(<span class=\"number\">1</span>) : seconds;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hourLayer = layer.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minuteLayer = layer.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> secondLayer = layer.getChildByTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (layer.getChildByTag(<span class=\"number\">4</span>) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            layer.removeChildByTag(<span class=\"number\">4</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (layer.getChildByTag(<span class=\"number\">5</span>) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            layer.removeChildByTag(<span class=\"number\">5</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        hourLayer.removeAllChildren();</span><br><span class=\"line\">        minuteLayer.removeAllChildren();</span><br><span class=\"line\">        secondLayer.removeAllChildren();</span><br><span class=\"line\">        <span class=\"comment\">// 添加6个数字和2个冒号</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> initX = <span class=\"number\">20</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> initY = <span class=\"built_in\">this</span>.size.height / <span class=\"number\">2</span>;</span><br><span class=\"line\">        <span class=\"comment\">// hour</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> num1 = <span class=\"keyword\">new</span> Layer0202(<span class=\"built_in\">Number</span>(hour1), initX, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num2 = <span class=\"keyword\">new</span> Layer0202(<span class=\"built_in\">Number</span>(hour2), num1.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"comment\">// 冒号</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> num3 = <span class=\"keyword\">new</span> Layer0202(<span class=\"number\">-1</span>, num2.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"comment\">// minute</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> num4 = <span class=\"keyword\">new</span> Layer0202(<span class=\"built_in\">Number</span>(minute1), num3.getPositionX() + cellSpace * <span class=\"number\">3</span> + rectWidth * <span class=\"number\">4</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num5 = <span class=\"keyword\">new</span> Layer0202(<span class=\"built_in\">Number</span>(minute2), num4.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"comment\">// 冒号</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> num6 = <span class=\"keyword\">new</span> Layer0202(<span class=\"number\">-1</span>, num5.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"comment\">// second</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> num7 = <span class=\"keyword\">new</span> Layer0202(<span class=\"built_in\">Number</span>(second1), num6.getPositionX() + cellSpace * <span class=\"number\">3</span> + rectWidth * <span class=\"number\">4</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> num8 = <span class=\"keyword\">new</span> Layer0202(<span class=\"built_in\">Number</span>(second2), num7.getPositionX() + cellSpace * <span class=\"number\">7</span> + rectWidth * <span class=\"number\">8</span> + <span class=\"number\">10</span>, initY);</span><br><span class=\"line\">        <span class=\"comment\">// 设置小时图层</span></span><br><span class=\"line\">        hourLayer.addChild(num1);</span><br><span class=\"line\">        hourLayer.addChild(num2);</span><br><span class=\"line\">        <span class=\"comment\">// 添加冒号</span></span><br><span class=\"line\">        layer.addChild(num3);</span><br><span class=\"line\">        num3.setTag(<span class=\"number\">4</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 设置分钟图层</span></span><br><span class=\"line\">        minuteLayer.addChild(num4);</span><br><span class=\"line\">        minuteLayer.addChild(num5);</span><br><span class=\"line\">        layer.addChild(num6);</span><br><span class=\"line\">        num6.setTag(<span class=\"number\">5</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 设置秒图层</span></span><br><span class=\"line\">        secondLayer.addChild(num7);</span><br><span class=\"line\">        secondLayer.addChild(num8);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 本节作业：</span></span><br><span class=\"line\"><span class=\"comment\">// 锚点也叫对齐点，是Position对齐的坐标，如果0,0则用这个node的左下角对齐position</span></span><br><span class=\"line\"><span class=\"comment\">// 如果是1,1则用node的右上角对齐</span></span><br><span class=\"line\"><span class=\"comment\">// 0.5,0.5则用node的中心来对齐</span></span><br><span class=\"line\"><span class=\"comment\">// 作业：</span></span><br><span class=\"line\"><span class=\"comment\">// 使用锚点实现 11:58 这个时间的显示，注意要画很多的矩形呦</span></span><br><span class=\"line\"><span class=\"comment\">// 至于这个时间怎么能变 我们后面讲</span></span><br><span class=\"line\"><span class=\"comment\">// 两个冒号 也是矩形</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 预先设置好数组的显示,以01区分</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getNum = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (num) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">-1</span>:<span class=\"comment\">// 冒号</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">9</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">                [<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            ];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p><a href=\"http://www.cocoscvp.com/usercode/2016_04_17/81435b882df65c1f94e7f5793e1e3de35d6e15a1/\">http://www.cocoscvp.com/usercode/2016_04_17/81435b882df65c1f94e7f5793e1e3de35d6e15a1/</a></p>"},{"title":"Cocos Creator实现的《点我+1》","date":"2016-07-02T09:14:00.000Z","_content":"### 前言\n在学习Cocos中，需要一些东西来练手，于是前段时间就开发仿照一款公司之前的产品《点我+1》来做，仿照过程中，所有的算法逻辑都是自己研究的，并没有参考公司代码，也没有使用公司的美术资源，所以也就不存在公司机密的内容啦，完全只是学习练习而已。<!--more-->\n这是一款消除类游戏，规则和大多数三消类游戏差不多，在一个5x5的格子中，有25个方块，每个方块有一个数字，用户的操作就是点击方块，使方块的数字+1，当至少每3个相同数字的时候，这些数字相同的方块合成为一个，并且数字+1，在玩家的表现就是：除了点击的方块之外，其他的相同数字的方块全部消失，然后点击的方块再+1。这款游戏看似很简单，但实际也是蕴含很多细节以及算法，我也是用了一周时间断断续续才做出来。\n并且在这次练习中，我也是第一次尝试使用Cocos Creator来做，使用中也是遇到了不少问题，它与Cocos2d-JS的原生API还是有一定的差别的，Cocos Creator在我看来就是Cocos在向Unity靠近的一个产物，想要像Unity那样实现一整套的工作流，将游戏中的所有元素都组件化，游戏场景可以通过拖动就能搭建，游戏逻辑的实现只需要对组件添加相应的脚本即可，让游戏开发更加的方便，更加直观可视化。\n### Cocos Creator\nCocos Creator是Cocos家族又一个划时代意义的产物，前面已经提到，我个人认为这是Cocos向Unity靠近的产物，或许也可以说，游戏开发的脚本化、组件化、以及高效工作流、高度可扩展，已经成为任何一款游戏引擎的发展方向，这样的高效快速的开发的工具，才是开发者的首选工具。了解Cocos家族历史的人应该都知道，Cocos从各种语言版本，到2dx跨平台版本，到Cocos Stuio、Cocos IDE、Cocos Builder，再到Cocos Creator，这一切都是在使开发者越来越方便，使得游戏开发的门槛越来越低，任何人，只要你有心，有游戏梦，你都可以通过自身的努力来造梦，而Cocos Creator，就是我们造梦的工具。\n不过说实话，Cocos Creator目前是1.1版本，在使用仍然还有许多bug，比如我打包Web版本之后，直接在本地无法运行，查看控制台输出应该是跨域的问题，而发布到服务器就能正常运行，再比如游戏的开发者，开发者还是需要考虑很多各种型号手机屏幕兼容的问题，希望Cocos Creator还能有一套成熟的兼容适配的方案，还有一些我个人的问题或许只是我还不熟悉Cocos的组件化开发而已，需要等到我真正熟悉这款工具，才能用好它，所谓工欲善其事必先利其器，工具用好了，你的造梦之路才会更加顺畅！\nCocos Creator的用户手册：http://www.cocos.com/docs/creator/index.html\nCocos Creator的API：http://www.cocos.com/docs/creator/api/index.html\n### 游戏分析\n这款游戏是比较常见的三消类游戏，不过它也有着自己的特色，将数字类游戏玩法与消除类游戏玩法相结合，游戏过程也比较具有挑战性，让人产生挑战的欲望，游戏的玩法在上文已有描述，没有玩过这款消除类游戏的朋友可以通过以下地址进行下载：\n安卓版地址：http://app.mi.com/detail/231892?ref=search\niOS版地址：https://itunes.apple.com/cn/app/dian-wo+1/id1012314214?mt=8\n没玩过的朋友可以通过以上地址下载下来玩一下，体验下游戏玩法，然后仔细分析其中的游戏逻辑运算过程。\n通过游戏玩法的分析我们至少可以分析出以下几点：\n1.点击游戏方块，方块数字+1\n2.在至少3个相同数字的方块彼此相邻时，可以合成一个+1的数\n3.生成5x5的地图时，最多只能有两个相同数字方块相邻\n4.每完成一次方块合成之后，所有方块向下填补空缺的位置\n5.在填补完空缺位置之后，再生成新的方块\n在Cocos Creator中，我们要熟悉组件化开发，因此我们需要开始场景、游戏场景、结束场景、以及方块预制资源、能量条预制资源，以及各种脚本和音效等。分别用scene、script和voice三个文件夹来存放场景组件，脚本组件和音效组件，另外将预制资源放在根目录下，如下图资源目录：\n![资源结构图](http://7xnnwn.com1.z0.glb.clouddn.com/projstruct.png)\n### 游戏实现\n如之前一篇文章对2048游戏的分析一样，我们首先需要一个数组来存放所有的方块，并将方块单独提出来为一个对象，在这里，我们将方块做成预制资源，在需要的时候直接创建方块预制资源，同样，能量条也可以做成预制资源。另外我们需要开始场景、游戏场景和结束场景三个场景，并对这三个场景组件编写脚本。\n在开发写代码之前，我们经过如上的分析，知道了我们大致要实现的几个核心算法：\n1.扫描某一个位置的上下左右四个方向所有相邻的相同数字的点，并得到这些点的个数\n2.所有方块向下移动，填补所有的空缺\n核心的就这两个算法，其他的都是一些简单的逻辑，下面先对这两个算法进行分析\n#### 扫描算法\n扫描算法实质上就是对指定的点得四周进行扫描，扫描是否有数字相同的点，如果有数字相同的点，那么还需要进一步对这个数字相同的点再进行扫描，直到扫描的点四周都没有数字相同的点，才能确认最终相邻点的个数，实际上就是对指定的点向四周扩散扫描。\n我的实现方式是这样的，写一个函数，传入两个数组，一个用来记录扫描到的数字相同的点，一个用来记录扫描过得点，以便于下次扫描不再扫描已经扫描过的点，除此之外，还需要传入行，列，上次扫描的行，上次扫描的列（在下次扫描时，不用再对上次的那个方向进行扫描），以及扫描要比对的数字。通过指定的点，我向上、下、左、右四个方向进行扫描，如果数字相同，我就将这个点加入到记录数字相同的点得数组中，并对这个点再递归调用这个函数，在四个方向全都递归扫描完毕后，我得到的这个扫描过的点的数组，就是所有与指定点的数字相同且彼此相邻的点的集合。可能我描述不是太清楚，我直接将代码贴出来，我的算法基础不是太好，可能这不是最优的算法，希望有朋友能为我提供更好更快的算法。\n```javascript\n/*\n * 核心扫描逻辑\n * @param row 指定行\n * @param col 指定列\n * @param lastRow 上次扫描的行\n * @param lastCol 上次扫描的列\n * @param num 扫描要比对的数字\n * @param arr 记录数字相同且彼此相邻的数组\n * @param scanArr 记录扫描过的点的数组\n */\nscanAround:function(row,col,lastRow,lastCol,num,arr,scanArr){\n    // cc.log(\"row:\",row,\",col:\",col,\",lastRow:\",lastRow,\",lastCol:\",lastCol,\",num:\",num,\",arr:\",arr,\",scanArr:\",scanArr);\n    if(this.tiles[row][col]==null){\n        return;\n    }\n    var isClear = false;\n    if(scanArr==undefined){\n        scanArr = new Array();\n    }\n    // 扫描过的节点不再扫描\n    if(scanArr.indexOf(row+\"#\"+col)==-1){\n        scanArr.push(row+\"#\"+col);\n    }else{\n        return;\n    }\n    // 扫描上\n    if(row<4&&(lastRow!=(row+1)||lastCol!=col)&&this.tiles[row+1][col]!=null){\n        var nextNum = parseInt(this.tiles[row+1][col].getComponent(\"Tile\").numLabel.string);\n        if(nextNum==num){\n            if(arr.indexOf(row+\"#\"+col)==-1){\n                arr.push(row+\"#\"+col);\n            }\n            this.scanAround(row+1,col,row,col,num,arr,scanArr);\n            isClear = true;\n        }\n    }\n    // 扫描下\n    if(row>0&&(lastRow!=(row-1)||lastCol!=col)&&this.tiles[row-1][col]!=null){\n        var nextNum = parseInt(this.tiles[row-1][col].getComponent(\"Tile\").numLabel.string);\n        if(nextNum==num){\n            if(arr.indexOf(row+\"#\"+col)==-1){\n                arr.push(row+\"#\"+col);\n            }\n            this.scanAround(row-1,col,row,col,num,arr,scanArr);\n            isClear = true;\n        }\n    }\n    // 扫描左\n    if(col>0&&(lastRow!=row||lastCol!=(col-1))&&this.tiles[row][col-1]!=null){\n        var nextNum = parseInt(this.tiles[row][col-1].getComponent(\"Tile\").numLabel.string);\n        if(nextNum==num){\n            if(arr.indexOf(row+\"#\"+col)==-1){\n                arr.push(row+\"#\"+col);\n            }\n            this.scanAround(row,col-1,row,col,num,arr,scanArr);\n            isClear = true;\n        }\n    }\n    // 扫描右\n    if(col<4&&(lastRow!=row||lastCol!=(col+1))&&this.tiles[row][col+1]!=null){\n        var nextNum = parseInt(this.tiles[row][col+1].getComponent(\"Tile\").numLabel.string);\n        if(nextNum==num){\n            if(arr.indexOf(row+\"#\"+col)==-1){\n                arr.push(row+\"#\"+col);\n            }\n            this.scanAround(row,col+1,row,col,num,arr,scanArr);\n            isClear = true;\n        }\n    }\n    // 四周都不通，但不是出发遍历点，并且数字相同，也加入到数组\n    if(!isClear&&(lastRow!=-1&&lastCol!=-1)){\n        var curNum = parseInt(this.tiles[row][col].getComponent(\"Tile\").numLabel.string)\n        if(curNum==num){\n            if(arr.indexOf(row+\"#\"+col)==-1){\n                arr.push(row+\"#\"+col);\n            }\n        }\n    }\n}\n```\n#### 移动算法\n移动算法相对就比较简单了，我只需要对每一列从下往上遍历，当遍历中发现方块不为null时（即这个点有方块），我们就以这个方块为起点，对这一列往下遍历，在子循环中，如果下方为null时（即下方没有方块），这个方块就向下移动一个单位，一直循环到下方见底，或者下方遇到方块，才会停止。这个算法相对简单，代码如下：\n```javascript\nfor (var col = 0; col < 5; col++) {\n    for (var row = 0; row < 5; row++) {\n        if (this.tiles[row][col] != null) {// 有方块\n            for (var row1 = row; row1 > 0; row1--) {\n                if (this.tiles[row1 - 1][col] == null){\n                    //如果没有向下移动\n                    this.tiles[row1 - 1][col] = this.tiles[row1][col];\n                    this.tiles[row1][col] = null;\n                    this.tiles[row1 - 1][col].getComponent(\"Tile\").moveTo(row1 - 1, col);\n                }\n            }\n        }\n    }\n}\n```\n#### 方块类\n方块类我们通过Creator的预制资源来制作，如下图所示：\n![tile图](http://7xnnwn.com1.z0.glb.clouddn.com/tile.png)\n在Tile预制资源中，我们只需要一个背景层，和一个显示数字的Label即可，其背景层的颜色和数字显示都通过脚本来控制，方块需要包含以下几个方法：\n1.产生新方块的初始化及特效\n2.移动到指定点的逻辑及特效\n3.方块销毁的逻辑及特效\n4.设置方块数字以及动态改变其背景色\n5.在方块的初始化onLoad函数中，需要对方块添加TOUCH_START事件，事件中绑定上面提到的4方法，方块类的具体实现代码如下：\n1.方块初始化函数\n添加触摸点击事件，绑定设置数字函数，清空combo次数（combo次数记录放在全局组件Global中）\n```javascript\nonLoad: function () {\n    var self = this;\n    this.node.on(cc.Node.EventType.TOUCH_START,function(event){\n        if(!self.game.isCal){\n            cc.audioEngine.playEffect(self.clickEffect);\n            self.game.isCal = true;\n            // 连击次数归零\n            Global.combo = 0;\n            cc.audioEngine.playEffect(this.addCoin);\n            self.setNum(parseInt(self.numLabel.string)+1,true,false);\n        }\n    }, this.node);\n}\n```\n2.产生新方块\n执行从小变大的动画，设置数组中的行列到属性中\n```javascript\nnewTile:function(row,col){\n    this.node.setPosition(5+(5+this.node.width)*col+this.node.width/2,5+(5+this.node.height)*row+this.node.height/2);\n    this.node.setScale(0);\n    this.node.runAction(cc.scaleTo(0.1,1));\n    this.setArrPosition(row,col);\n}\n```\n3.移动到指定点\n执行移动动画，设置数组中行列到属性中\n```javascript\nmoveTo:function(row,col){\n    this.row = row;\n    this.col = col;\n    this.node.stopActionByTag(1);\n    var action = cc.moveTo(0.2,cc.p(5+(5+this.node.width)*col+this.node.width/2,5+(5+this.node.height)*row+this.node.height/2));\n    this.node.runAction(action);\n    action.setTag(1);\n}\n```\n4.方块销毁\n执行从大变小的动画，执行完动画之后调用destory方法销毁方块\n```javascript\ndestoryTile:function(){\n    var action = cc.sequence(cc.scaleTo(0.1,0),cc.callFunc(function(node){\n        node.destroy();\n    },this.node,this.node));\n    this.node.runAction(action);\n}\n```\n5.设置方块数字\n设置方块的显示数字，并动态改变相应数字对应的颜色，颜色存在全局组件变量Colors中，通过参数exeLogic判断是否需要执行游戏的消除逻辑，通过playEffect判断是否需要播放音效\n```javascript\nsetNum:function(num,exeLogic,playEffect){\n    this.game.maxNum = num>this.game.maxNum?num:this.game.maxNum;\n    this.numLabel.string = num;\n    switch(num){\n        case 1:\n            this.node.color = Colors.num1;\n            break;\n        case 2:\n            this.node.color = Colors.num2;\n            break;\n        case 3:\n            this.node.color = Colors.num3;\n            break;  \n        case 4:\n            this.node.color = Colors.num4;\n            break;\n        case 5:\n            this.node.color = Colors.num5;\n            break;\n        case 6:\n            this.node.color = Colors.num6;\n            break;  \n        case 7:\n            this.node.color = Colors.num7;\n            break;\n        case 8:\n            this.node.color = Colors.num8;\n            break;\n        case 9:\n            this.node.color = Colors.num9;\n            break;  \n        case 10:\n            this.node.color = Colors.num10;\n            break;\n        case 11:\n            this.node.color = Colors.num11;\n            break;\n        case 12:\n            this.node.color = Colors.num12;\n            break;  \n        case 13:\n            this.node.color = Colors.num13;\n            break;\n        case 14:\n            this.node.color = Colors.num14;\n            break;\n        case 15:\n            this.node.color = Colors.num15;\n            break;\n        case 16:\n            this.node.color = Colors.num16;\n            break;\n        case 17:\n            this.node.color = Colors.num17;\n            break;\n        case 18:\n            this.node.color = Colors.num18;\n            break;\n        case 19:\n            this.node.color = Colors.num19;\n            break;\n        case 20:\n            this.node.color = Colors.num20;\n            break;\n        default:\n            this.node.color = Colors.nums;\n            break;\n    }\n    // 播放特效\n    if(playEffect){\n        this.node.runAction(cc.sequence(cc.scaleTo(0.15,1.5),cc.scaleTo(0.15,1)));\n    }\n    // 消除逻辑\n    if(exeLogic){\n        // 执行逻辑\n        var isMove = this.game.operateLogic(this.row,this.col,parseInt(this.numLabel.string),true);\n        var powers = this.game.powers;\n        // 能量条-1\n        if(!isMove){\n            for (var i = powers.length - 1; i >= 0; i--) {\n                if(powers[i]!=null){\n                    var costBarAction = cc.sequence(cc.scaleTo(0.1,0),cc.callFunc(function(power){\n                        power.destroy();\n                    },null,powers[i]));\n                    powers[i].runAction(costBarAction);\n                    powers[i] = null;\n                    break;\n                }\n            };\n            // 游戏结束逻辑判断：能量条为空\n            if(powers[0]==null){\n                Global.score = this.game.scoreNum.string;\n                // Game Over\n                cc.director.loadScene(\"overScene\");\n            }\n        }\n    }\n}\n```\n#### 能量类\n同方块类，我们将游戏场景中的能量条也做成预制资源，其中只需要添加一个背景层就可以，背景层也是通过代码动态控制颜色，能量条不需要任何脚本文件。\n#### 开始场景\n做好了预制资源之后，我们就可以先做开始场景了，效果图如下：\n![startScene图](http://7xnnwn.com1.z0.glb.clouddn.com/startScene.png)\n开始场景中有三个元素，游戏文字，开始按钮，和背景层，其中游戏文字呈现一个变大变小循环播放的动画，点击开始游戏按钮即可转入游戏场景。具体代码如下：\n1.onLoad加载\n动态设置元素的位置及宽高，以适配各种型号手机屏幕\n```javascript\nonLoad: function () {\n    // 背景铺平\n    this.bg.width = cc.winSize.width;\n    this.bg.height = cc.winSize.height;\n    this.bg.setPosition(this.bg.width/2,this.bg.height/2);\n    this.bg.color = Colors.startBg;\n    // 设置文字\n    var action = cc.repeatForever(cc.sequence(cc.scaleTo(1, 1.5),cc.scaleTo(1,1)));\n    this.gameName.runAction(action);\n    this.gameName.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n    // 设置按钮\n    this.startBtn.setPosition(this.gameName.getPositionX(),this.gameName.getPositionY()-210);\n}\n```\n2.开始游戏按钮回调\n点击进入游戏场景\n```javascript\nstartGame:function(){\n    cc.audioEngine.playEffect(this.btnEffect);\n    cc.director.loadScene(\"gameScene\");\n}\n```\n#### 结束场景\n结束场景与开始场景差不多，相比之下，结束场景主要是提供游戏分数特效呈现的功能，效果图如下：\n![overScene图](http://7xnnwn.com1.z0.glb.clouddn.com/overScene.png)\n结束场景也是几个Label，一个背景层和一个Button按钮组成，其中最重要的是分数特效，通过从0一直往上加，加到实际分数的特效，来使玩家获得成就感，具体代码如下：\n1.加载函数\n动态设置场景中元素的宽高及位置，播放分数计算特效，绑定TOUCH_START事件，使特效立即播放完成\n```javascript\nonLoad: function () {\n    // 背景层\n    this.bg.width = cc.winSize.width;\n    this.bg.height = cc.winSize.height;\n    this.bg.setPosition(this.bg.width/2,this.bg.height/2);\n    this.bg.color = Colors.overBg;\n    // 文字层\n    this.gameText.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n    var action = cc.repeatForever(cc.sequence(cc.scaleTo(1, 1.5),cc.scaleTo(1,1)));\n    this.gameText.runAction(action);\n    // 播放结束音效\n    cc.audioEngine.playEffect(this.overEffect);\n    // 分数\n    this.scoreText.setPosition(this.gameText.getPositionX(),this.gameText.getPositionY()+200);\n    this.score = Global.score;\n    this.schedule(this.updateScore,0.1,cc.REPEAT_FOREVER,2);\n    // 点击分数立即加到最高分数\n    var self = this;\n    this.bg.on(cc.Node.EventType.TOUCH_START,function(event){\n        cc.log(\"score text touch\");\n        cc.audioEngine.playEffect(self.addCoin);\n        self.changeScore = self.score;\n        self.scoreLabel.string = \"最终分数：\"+self.changeScore;\n    }, this.bg);\n    // 返回按钮\n    this.backBtn.setPosition(this.gameText.getPositionX(),this.gameText.getPositionY()-200);\n}\n```\n2.更新分数回调\n每一次更新分数回调，将特效分数增加20，直到加满到游戏得分，并将这一过程显示在场景的Label中\n```javascript\nupdateScore(){\n    if(this.score<=this.changeScore){\n        this.unschedule(this.updateScore);\n    }\n    this.changeScore += 20;\n    this.changeScore = this.changeScore>this.score?this.score:this.changeScore;\n    // 添加音效\n    cc.audioEngine.playEffect(this.addCoin);\n    this.scoreLabel.string = \"最终分数：\"+this.changeScore;\n}\n```\n3.返回按钮回调\n游戏分数的全局变量归零，切换加载开始游戏的场景\n```javascript\nback:function(){\n    Global.score = 0;\n    cc.audioEngine.playEffect(this.btnEffect);\n    cc.director.loadScene(\"startScene\");\n}\n```\n#### 游戏场景\n最主要的还是游戏场景，在游戏场景中，我们进行所有的游戏逻辑的运算，包括前面提到的两个核心算法，游戏场景的效果图如下：\n![gameScene图](http://7xnnwn.com1.z0.glb.clouddn.com/gameScene.png)\n在游戏主场景中，我们主要需要在onLoad加载时，初始化25个方块，并放在地图中，使他们之间相邻个数小于3个，然后我们需要提供一个主要逻辑判断函数，这个函数中判断游戏中方块的消除逻辑，再前面的Tile的setNum函数中进行调用，代码如下：\n1.场景加载\n在场景加载中，我们需要初始化25个互相相邻小于3个的方块，与5个能量条，并且动态设置所有元素的宽高与位置。\n```javascript\nonLoad: function () {\n    // 播放背景音乐\n    cc.audioEngine.playMusic(this.bgMusic,true);\n    // 初始化方块数组\n    this.tiles = [\n        [null,null,null,null,null],\n        [null,null,null,null,null],\n        [null,null,null,null,null],\n        [null,null,null,null,null],\n        [null,null,null,null,null]\n    ];\n    this.powers = [null,null,null,null,null];\n    // 背景层\n    this.bg.width = cc.winSize.width;\n    this.bg.height = cc.winSize.height;\n    this.bg.setPosition(-cc.winSize.width/2,-cc.winSize.height/2);\n    this.bg.color = Colors.gameBg;\n    // 顶部背景层\n    this.topBg.width = cc.winSize.width-30;\n    this.topBg.height = 100;\n    this.topBg.setPosition(-cc.winSize.width/2+15,(cc.winSize.width-30)/2);\n    // 能量条背景层\n    this.powerBarBg.width = cc.winSize.width-30;\n    this.powerBarBg.height = this.powerBarBg.width/5/2;\n    this.powerBarBg.setPosition(15-cc.winSize.width/2,this.topBg.getPositionY()-200);\n    this.powerBarBg.color = Colors.powerBarBg;\n    // 方块背景层\n    this.tileBg.width = cc.winSize.width-30;\n    this.tileBg.height = this.tileBg.width;\n    this.tileBg.setPosition(15-cc.winSize.width/2,this.powerBarBg.getPositionY()-10-this.tileBg.height);\n    this.tileBg.color = Colors.tileBg;\n    // 生成能量条\n    for(var i=0;i<5;i++){\n        var power = cc.instantiate(this.powerPre);\n        power.width = (this.powerBarBg.width-30)/5;\n        power.height = this.powerBarBg.height-10;\n        this.powerBarBg.addChild(power);\n        power.setPosition(5+(5+power.width)*i+power.width/2,5+power.height/2);\n        power.color = Colors.power;\n        this.powers[i] = power;\n    };\n    // 生成初始方块\n    for(var row=0;row<5;row++){\n        for(var col = 0;col<5;col++){\n            var tile = cc.instantiate(this.tilePre);\n            tile.getComponent(\"Tile\").game = this;\n            tile.width = (this.tileBg.width-30)/5;\n            tile.height = (this.tileBg.height-30)/5;\n            var count = 0;\n            var maxRandom = 5;\n            var randomNum = 0;\n            while(true){\n                count++;\n                var arr = new Array();\n                var scanArr = new Array();\n                if(count>10){\n                    maxRandom++;\n                }\n                randomNum = Math.ceil(Math.random()*maxRandom);\n                tile.getComponent(\"Tile\").setNum(randomNum,false,false);\n                tile.setPosition(5+(5+tile.width)*col+tile.width/2,5+(5+tile.height)*row+tile.height/2);\n                this.tiles[row][col] = tile;\n                this.scanAround(row,col,-1,-1,randomNum,arr,scanArr);\n                if(arr.length<3){\n                    break;\n                }\n            }\n            tile.getComponent(\"Tile\").setArrPosition(row,col);\n            this.tileBg.addChild(tile);\n        }\n    }\n}\n```\n2.扫描逻辑\n前面已经讲过\n3.主要操作逻辑\n在这个函数中，我们需要对指定的点进行扫描，如果相邻数超过三个，则进行合成动作，然后更新分数，将所有的方块向下移动填补，并补充一条能量条，增加连击次数\n```javascript\noperateLogic:function(touchRow,touchCol,curNum,isFirstCall){\n    var arr = new Array();\n    var scanArr = new Array();\n    this.scanAround(touchRow,touchCol,-1,-1,curNum,arr,scanArr);\n    if(arr.length>=3){\n        var addScore = 0;\n        for(var index in arr){\n            var row = arr[index].split(\"#\")[0];\n            var col = arr[index].split(\"#\")[1];\n            addScore += parseInt(this.tiles[row][col].getComponent(\"Tile\").numLabel.string*10);\n            if(row!=touchRow||col!=touchCol){\n                // 执行销毁动作                    \n                this.tiles[row][col].getComponent(\"Tile\").destoryTile();\n                this.tiles[row][col] = null;\n            }else{\n                this.tiles[row][col].getComponent(\"Tile\").setNum(curNum+1,false,true);\n                this.maxNum = curNum+1>this.maxNum?curNum+1:this.maxNum;\n            }\n        }\n        // 更新分数\n        this.scoreNum.string = parseInt(this.scoreNum.string)+addScore;\n        this.scheduleOnce(function() {\n            // 0.1s后所有方块向下移动\n            this.moveAllTileDown();\n        },0.1);\n        if(!isFirstCall){\n            // 能量条补充一格\n            for(var i=0;i<5;i++){\n                if(this.powers[i]==null){\n                    var power = cc.instantiate(this.powerPre);\n                    power.width = (this.powerBarBg.width-30)/5;\n                    power.height = this.powerBarBg.height-10;\n                    this.powerBarBg.addChild(power);\n                    power.setPosition(5+(5+power.width)*i+power.width/2,5+power.height/2);\n                    power.color = Colors.power;\n                    power.setScale(0);\n                    power.runAction(cc.scaleTo(0.1,1));\n                    this.powers[i] = power;\n                    break;\n                }\n            };\n        }\n        // 连击次数+1\n        Global.combo++;\n        // cc.log(\"连击次数：\"+Global.combo);\n        // 播放音效\n        switch(Global.combo){\n            case 1:\n                cc.audioEngine.playEffect(this.star1);\n            break;\n            case 2:\n                cc.audioEngine.playEffect(this.star2);\n            break;\n            case 3:\n                cc.audioEngine.playEffect(this.star3);\n            break;\n            case 4:\n                cc.audioEngine.playEffect(this.star4);\n            break;\n            case 5:\n                cc.audioEngine.playEffect(this.star5);\n            break;\n            case 6:\n                cc.audioEngine.playEffect(this.star6);\n            break;\n            case 7:\n                cc.audioEngine.playEffect(this.star7);\n            break;\n            default:\n                cc.audioEngine.playEffect(this.star7);\n            break;\n        }\n        return true;\n    }else{\n        this.isCal = false;\n    }\n    return false;\n}\n```\n4.所有方块向下移动\n除了上文提到所有方块的移动算法之外，在移动完成之后，还需要进行新产生一批方块，并再次判断消除逻辑的操作\n```javascript\nmoveAllTileDown:function(){\n    for (var col = 0; col < 5; col++) {\n        for (var row = 0; row < 5; row++) {\n            if (this.tiles[row][col] != null) {// 有方块\n                for (var row1 = row; row1 > 0; row1--) {\n                    if (this.tiles[row1 - 1][col] == null){\n                        //如果没有向下移动\n                        this.tiles[row1 - 1][col] = this.tiles[row1][col];\n                        this.tiles[row1][col] = null;\n                        this.tiles[row1 - 1][col].getComponent(\"Tile\").moveTo(row1 - 1, col);\n                    }\n                }\n            }\n        }\n    }\n    this.scheduleOnce(function() {\n        // 0.3s后生成新方块\n        for (var col = 0; col < 5; col++) {\n            for (var row = 0; row < 5; row++) {\n                if(this.tiles[row][col]==null){\n                    var tile = cc.instantiate(this.tilePre);\n                    tile.getComponent(\"Tile\").game = this;\n                    tile.width = (this.tileBg.width-30)/5;\n                    tile.height = (this.tileBg.height-30)/5;\n                    var maxRandom = this.maxNum;\n                    var randomNum = Math.ceil(Math.random()*maxRandom);\n                    tile.getComponent(\"Tile\").setNum(randomNum,false,false);\n                    tile.getComponent(\"Tile\").newTile(row,col);\n                    this.tiles[row][col] = tile;\n                    this.tileBg.addChild(tile);\n                }\n            }\n        }\n        // 0.5s后遍历执行逻辑\n        this.scheduleOnce(function() {\n            var isSearch = false;\n            for (var col = 0; col < 5; col++) {\n                for (var row = 0; row < 5; row++) {\n                    if(!isSearch){\n                        isSearch = this.tiles[row][col]!=null&&this.operateLogic(row,col,parseInt(this.tiles[row][col].getComponent(\"Tile\").numLabel.string),false);\n                    }\n                }\n            }\n        }, 0.5);        \n     }, 0.3);\n}\n```\n### 运行效果\n最后的运行效果如下\n![点我+1效果图](http://7xnnwn.com1.z0.glb.clouddn.com/addone.gif)\n通过CVP平台的项目托管可看到实际运行效果，地址如下：\n- 由于个人对Cocos Creator的适配还不大了解，在pc上运行时，需要使用chrome的手机调试预览（或者将chrome窗口调至手机屏幕大小），但是如果直接用手机打开，loadScene似乎又有不兼容的问题，至今无法理解，还请大神指点，而我无论是开发时的预览，还是通过xcode打包到我的iPhone6s Plus手机运行，都是完全没有问题。不知道是不是Creator的h5兼容还没有做好，又或者我哪里的技术没有掌握全面。\nhttp://www.cocoscvp.com/usercode/946fc5fd5d2c77331cc344ea1e4bfdd04630cf85/\n\n### 源代码\n所有源代码均上传到github，欢迎交流学习，地址：\nhttps://github.com/hjcenry/addone\n\n- 原文博客：http://hjcenry.github.io","source":"_posts/Cocos Creator实现的《点我+1》.md","raw":"---\ntitle: Cocos Creator实现的《点我+1》\ndate: 2016-07-02 17:14\ncategories: cocos2d-js\ntags: [cocos2d-js,点我+1,cvp]\n---\n### 前言\n在学习Cocos中，需要一些东西来练手，于是前段时间就开发仿照一款公司之前的产品《点我+1》来做，仿照过程中，所有的算法逻辑都是自己研究的，并没有参考公司代码，也没有使用公司的美术资源，所以也就不存在公司机密的内容啦，完全只是学习练习而已。<!--more-->\n这是一款消除类游戏，规则和大多数三消类游戏差不多，在一个5x5的格子中，有25个方块，每个方块有一个数字，用户的操作就是点击方块，使方块的数字+1，当至少每3个相同数字的时候，这些数字相同的方块合成为一个，并且数字+1，在玩家的表现就是：除了点击的方块之外，其他的相同数字的方块全部消失，然后点击的方块再+1。这款游戏看似很简单，但实际也是蕴含很多细节以及算法，我也是用了一周时间断断续续才做出来。\n并且在这次练习中，我也是第一次尝试使用Cocos Creator来做，使用中也是遇到了不少问题，它与Cocos2d-JS的原生API还是有一定的差别的，Cocos Creator在我看来就是Cocos在向Unity靠近的一个产物，想要像Unity那样实现一整套的工作流，将游戏中的所有元素都组件化，游戏场景可以通过拖动就能搭建，游戏逻辑的实现只需要对组件添加相应的脚本即可，让游戏开发更加的方便，更加直观可视化。\n### Cocos Creator\nCocos Creator是Cocos家族又一个划时代意义的产物，前面已经提到，我个人认为这是Cocos向Unity靠近的产物，或许也可以说，游戏开发的脚本化、组件化、以及高效工作流、高度可扩展，已经成为任何一款游戏引擎的发展方向，这样的高效快速的开发的工具，才是开发者的首选工具。了解Cocos家族历史的人应该都知道，Cocos从各种语言版本，到2dx跨平台版本，到Cocos Stuio、Cocos IDE、Cocos Builder，再到Cocos Creator，这一切都是在使开发者越来越方便，使得游戏开发的门槛越来越低，任何人，只要你有心，有游戏梦，你都可以通过自身的努力来造梦，而Cocos Creator，就是我们造梦的工具。\n不过说实话，Cocos Creator目前是1.1版本，在使用仍然还有许多bug，比如我打包Web版本之后，直接在本地无法运行，查看控制台输出应该是跨域的问题，而发布到服务器就能正常运行，再比如游戏的开发者，开发者还是需要考虑很多各种型号手机屏幕兼容的问题，希望Cocos Creator还能有一套成熟的兼容适配的方案，还有一些我个人的问题或许只是我还不熟悉Cocos的组件化开发而已，需要等到我真正熟悉这款工具，才能用好它，所谓工欲善其事必先利其器，工具用好了，你的造梦之路才会更加顺畅！\nCocos Creator的用户手册：http://www.cocos.com/docs/creator/index.html\nCocos Creator的API：http://www.cocos.com/docs/creator/api/index.html\n### 游戏分析\n这款游戏是比较常见的三消类游戏，不过它也有着自己的特色，将数字类游戏玩法与消除类游戏玩法相结合，游戏过程也比较具有挑战性，让人产生挑战的欲望，游戏的玩法在上文已有描述，没有玩过这款消除类游戏的朋友可以通过以下地址进行下载：\n安卓版地址：http://app.mi.com/detail/231892?ref=search\niOS版地址：https://itunes.apple.com/cn/app/dian-wo+1/id1012314214?mt=8\n没玩过的朋友可以通过以上地址下载下来玩一下，体验下游戏玩法，然后仔细分析其中的游戏逻辑运算过程。\n通过游戏玩法的分析我们至少可以分析出以下几点：\n1.点击游戏方块，方块数字+1\n2.在至少3个相同数字的方块彼此相邻时，可以合成一个+1的数\n3.生成5x5的地图时，最多只能有两个相同数字方块相邻\n4.每完成一次方块合成之后，所有方块向下填补空缺的位置\n5.在填补完空缺位置之后，再生成新的方块\n在Cocos Creator中，我们要熟悉组件化开发，因此我们需要开始场景、游戏场景、结束场景、以及方块预制资源、能量条预制资源，以及各种脚本和音效等。分别用scene、script和voice三个文件夹来存放场景组件，脚本组件和音效组件，另外将预制资源放在根目录下，如下图资源目录：\n![资源结构图](http://7xnnwn.com1.z0.glb.clouddn.com/projstruct.png)\n### 游戏实现\n如之前一篇文章对2048游戏的分析一样，我们首先需要一个数组来存放所有的方块，并将方块单独提出来为一个对象，在这里，我们将方块做成预制资源，在需要的时候直接创建方块预制资源，同样，能量条也可以做成预制资源。另外我们需要开始场景、游戏场景和结束场景三个场景，并对这三个场景组件编写脚本。\n在开发写代码之前，我们经过如上的分析，知道了我们大致要实现的几个核心算法：\n1.扫描某一个位置的上下左右四个方向所有相邻的相同数字的点，并得到这些点的个数\n2.所有方块向下移动，填补所有的空缺\n核心的就这两个算法，其他的都是一些简单的逻辑，下面先对这两个算法进行分析\n#### 扫描算法\n扫描算法实质上就是对指定的点得四周进行扫描，扫描是否有数字相同的点，如果有数字相同的点，那么还需要进一步对这个数字相同的点再进行扫描，直到扫描的点四周都没有数字相同的点，才能确认最终相邻点的个数，实际上就是对指定的点向四周扩散扫描。\n我的实现方式是这样的，写一个函数，传入两个数组，一个用来记录扫描到的数字相同的点，一个用来记录扫描过得点，以便于下次扫描不再扫描已经扫描过的点，除此之外，还需要传入行，列，上次扫描的行，上次扫描的列（在下次扫描时，不用再对上次的那个方向进行扫描），以及扫描要比对的数字。通过指定的点，我向上、下、左、右四个方向进行扫描，如果数字相同，我就将这个点加入到记录数字相同的点得数组中，并对这个点再递归调用这个函数，在四个方向全都递归扫描完毕后，我得到的这个扫描过的点的数组，就是所有与指定点的数字相同且彼此相邻的点的集合。可能我描述不是太清楚，我直接将代码贴出来，我的算法基础不是太好，可能这不是最优的算法，希望有朋友能为我提供更好更快的算法。\n```javascript\n/*\n * 核心扫描逻辑\n * @param row 指定行\n * @param col 指定列\n * @param lastRow 上次扫描的行\n * @param lastCol 上次扫描的列\n * @param num 扫描要比对的数字\n * @param arr 记录数字相同且彼此相邻的数组\n * @param scanArr 记录扫描过的点的数组\n */\nscanAround:function(row,col,lastRow,lastCol,num,arr,scanArr){\n    // cc.log(\"row:\",row,\",col:\",col,\",lastRow:\",lastRow,\",lastCol:\",lastCol,\",num:\",num,\",arr:\",arr,\",scanArr:\",scanArr);\n    if(this.tiles[row][col]==null){\n        return;\n    }\n    var isClear = false;\n    if(scanArr==undefined){\n        scanArr = new Array();\n    }\n    // 扫描过的节点不再扫描\n    if(scanArr.indexOf(row+\"#\"+col)==-1){\n        scanArr.push(row+\"#\"+col);\n    }else{\n        return;\n    }\n    // 扫描上\n    if(row<4&&(lastRow!=(row+1)||lastCol!=col)&&this.tiles[row+1][col]!=null){\n        var nextNum = parseInt(this.tiles[row+1][col].getComponent(\"Tile\").numLabel.string);\n        if(nextNum==num){\n            if(arr.indexOf(row+\"#\"+col)==-1){\n                arr.push(row+\"#\"+col);\n            }\n            this.scanAround(row+1,col,row,col,num,arr,scanArr);\n            isClear = true;\n        }\n    }\n    // 扫描下\n    if(row>0&&(lastRow!=(row-1)||lastCol!=col)&&this.tiles[row-1][col]!=null){\n        var nextNum = parseInt(this.tiles[row-1][col].getComponent(\"Tile\").numLabel.string);\n        if(nextNum==num){\n            if(arr.indexOf(row+\"#\"+col)==-1){\n                arr.push(row+\"#\"+col);\n            }\n            this.scanAround(row-1,col,row,col,num,arr,scanArr);\n            isClear = true;\n        }\n    }\n    // 扫描左\n    if(col>0&&(lastRow!=row||lastCol!=(col-1))&&this.tiles[row][col-1]!=null){\n        var nextNum = parseInt(this.tiles[row][col-1].getComponent(\"Tile\").numLabel.string);\n        if(nextNum==num){\n            if(arr.indexOf(row+\"#\"+col)==-1){\n                arr.push(row+\"#\"+col);\n            }\n            this.scanAround(row,col-1,row,col,num,arr,scanArr);\n            isClear = true;\n        }\n    }\n    // 扫描右\n    if(col<4&&(lastRow!=row||lastCol!=(col+1))&&this.tiles[row][col+1]!=null){\n        var nextNum = parseInt(this.tiles[row][col+1].getComponent(\"Tile\").numLabel.string);\n        if(nextNum==num){\n            if(arr.indexOf(row+\"#\"+col)==-1){\n                arr.push(row+\"#\"+col);\n            }\n            this.scanAround(row,col+1,row,col,num,arr,scanArr);\n            isClear = true;\n        }\n    }\n    // 四周都不通，但不是出发遍历点，并且数字相同，也加入到数组\n    if(!isClear&&(lastRow!=-1&&lastCol!=-1)){\n        var curNum = parseInt(this.tiles[row][col].getComponent(\"Tile\").numLabel.string)\n        if(curNum==num){\n            if(arr.indexOf(row+\"#\"+col)==-1){\n                arr.push(row+\"#\"+col);\n            }\n        }\n    }\n}\n```\n#### 移动算法\n移动算法相对就比较简单了，我只需要对每一列从下往上遍历，当遍历中发现方块不为null时（即这个点有方块），我们就以这个方块为起点，对这一列往下遍历，在子循环中，如果下方为null时（即下方没有方块），这个方块就向下移动一个单位，一直循环到下方见底，或者下方遇到方块，才会停止。这个算法相对简单，代码如下：\n```javascript\nfor (var col = 0; col < 5; col++) {\n    for (var row = 0; row < 5; row++) {\n        if (this.tiles[row][col] != null) {// 有方块\n            for (var row1 = row; row1 > 0; row1--) {\n                if (this.tiles[row1 - 1][col] == null){\n                    //如果没有向下移动\n                    this.tiles[row1 - 1][col] = this.tiles[row1][col];\n                    this.tiles[row1][col] = null;\n                    this.tiles[row1 - 1][col].getComponent(\"Tile\").moveTo(row1 - 1, col);\n                }\n            }\n        }\n    }\n}\n```\n#### 方块类\n方块类我们通过Creator的预制资源来制作，如下图所示：\n![tile图](http://7xnnwn.com1.z0.glb.clouddn.com/tile.png)\n在Tile预制资源中，我们只需要一个背景层，和一个显示数字的Label即可，其背景层的颜色和数字显示都通过脚本来控制，方块需要包含以下几个方法：\n1.产生新方块的初始化及特效\n2.移动到指定点的逻辑及特效\n3.方块销毁的逻辑及特效\n4.设置方块数字以及动态改变其背景色\n5.在方块的初始化onLoad函数中，需要对方块添加TOUCH_START事件，事件中绑定上面提到的4方法，方块类的具体实现代码如下：\n1.方块初始化函数\n添加触摸点击事件，绑定设置数字函数，清空combo次数（combo次数记录放在全局组件Global中）\n```javascript\nonLoad: function () {\n    var self = this;\n    this.node.on(cc.Node.EventType.TOUCH_START,function(event){\n        if(!self.game.isCal){\n            cc.audioEngine.playEffect(self.clickEffect);\n            self.game.isCal = true;\n            // 连击次数归零\n            Global.combo = 0;\n            cc.audioEngine.playEffect(this.addCoin);\n            self.setNum(parseInt(self.numLabel.string)+1,true,false);\n        }\n    }, this.node);\n}\n```\n2.产生新方块\n执行从小变大的动画，设置数组中的行列到属性中\n```javascript\nnewTile:function(row,col){\n    this.node.setPosition(5+(5+this.node.width)*col+this.node.width/2,5+(5+this.node.height)*row+this.node.height/2);\n    this.node.setScale(0);\n    this.node.runAction(cc.scaleTo(0.1,1));\n    this.setArrPosition(row,col);\n}\n```\n3.移动到指定点\n执行移动动画，设置数组中行列到属性中\n```javascript\nmoveTo:function(row,col){\n    this.row = row;\n    this.col = col;\n    this.node.stopActionByTag(1);\n    var action = cc.moveTo(0.2,cc.p(5+(5+this.node.width)*col+this.node.width/2,5+(5+this.node.height)*row+this.node.height/2));\n    this.node.runAction(action);\n    action.setTag(1);\n}\n```\n4.方块销毁\n执行从大变小的动画，执行完动画之后调用destory方法销毁方块\n```javascript\ndestoryTile:function(){\n    var action = cc.sequence(cc.scaleTo(0.1,0),cc.callFunc(function(node){\n        node.destroy();\n    },this.node,this.node));\n    this.node.runAction(action);\n}\n```\n5.设置方块数字\n设置方块的显示数字，并动态改变相应数字对应的颜色，颜色存在全局组件变量Colors中，通过参数exeLogic判断是否需要执行游戏的消除逻辑，通过playEffect判断是否需要播放音效\n```javascript\nsetNum:function(num,exeLogic,playEffect){\n    this.game.maxNum = num>this.game.maxNum?num:this.game.maxNum;\n    this.numLabel.string = num;\n    switch(num){\n        case 1:\n            this.node.color = Colors.num1;\n            break;\n        case 2:\n            this.node.color = Colors.num2;\n            break;\n        case 3:\n            this.node.color = Colors.num3;\n            break;  \n        case 4:\n            this.node.color = Colors.num4;\n            break;\n        case 5:\n            this.node.color = Colors.num5;\n            break;\n        case 6:\n            this.node.color = Colors.num6;\n            break;  \n        case 7:\n            this.node.color = Colors.num7;\n            break;\n        case 8:\n            this.node.color = Colors.num8;\n            break;\n        case 9:\n            this.node.color = Colors.num9;\n            break;  \n        case 10:\n            this.node.color = Colors.num10;\n            break;\n        case 11:\n            this.node.color = Colors.num11;\n            break;\n        case 12:\n            this.node.color = Colors.num12;\n            break;  \n        case 13:\n            this.node.color = Colors.num13;\n            break;\n        case 14:\n            this.node.color = Colors.num14;\n            break;\n        case 15:\n            this.node.color = Colors.num15;\n            break;\n        case 16:\n            this.node.color = Colors.num16;\n            break;\n        case 17:\n            this.node.color = Colors.num17;\n            break;\n        case 18:\n            this.node.color = Colors.num18;\n            break;\n        case 19:\n            this.node.color = Colors.num19;\n            break;\n        case 20:\n            this.node.color = Colors.num20;\n            break;\n        default:\n            this.node.color = Colors.nums;\n            break;\n    }\n    // 播放特效\n    if(playEffect){\n        this.node.runAction(cc.sequence(cc.scaleTo(0.15,1.5),cc.scaleTo(0.15,1)));\n    }\n    // 消除逻辑\n    if(exeLogic){\n        // 执行逻辑\n        var isMove = this.game.operateLogic(this.row,this.col,parseInt(this.numLabel.string),true);\n        var powers = this.game.powers;\n        // 能量条-1\n        if(!isMove){\n            for (var i = powers.length - 1; i >= 0; i--) {\n                if(powers[i]!=null){\n                    var costBarAction = cc.sequence(cc.scaleTo(0.1,0),cc.callFunc(function(power){\n                        power.destroy();\n                    },null,powers[i]));\n                    powers[i].runAction(costBarAction);\n                    powers[i] = null;\n                    break;\n                }\n            };\n            // 游戏结束逻辑判断：能量条为空\n            if(powers[0]==null){\n                Global.score = this.game.scoreNum.string;\n                // Game Over\n                cc.director.loadScene(\"overScene\");\n            }\n        }\n    }\n}\n```\n#### 能量类\n同方块类，我们将游戏场景中的能量条也做成预制资源，其中只需要添加一个背景层就可以，背景层也是通过代码动态控制颜色，能量条不需要任何脚本文件。\n#### 开始场景\n做好了预制资源之后，我们就可以先做开始场景了，效果图如下：\n![startScene图](http://7xnnwn.com1.z0.glb.clouddn.com/startScene.png)\n开始场景中有三个元素，游戏文字，开始按钮，和背景层，其中游戏文字呈现一个变大变小循环播放的动画，点击开始游戏按钮即可转入游戏场景。具体代码如下：\n1.onLoad加载\n动态设置元素的位置及宽高，以适配各种型号手机屏幕\n```javascript\nonLoad: function () {\n    // 背景铺平\n    this.bg.width = cc.winSize.width;\n    this.bg.height = cc.winSize.height;\n    this.bg.setPosition(this.bg.width/2,this.bg.height/2);\n    this.bg.color = Colors.startBg;\n    // 设置文字\n    var action = cc.repeatForever(cc.sequence(cc.scaleTo(1, 1.5),cc.scaleTo(1,1)));\n    this.gameName.runAction(action);\n    this.gameName.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n    // 设置按钮\n    this.startBtn.setPosition(this.gameName.getPositionX(),this.gameName.getPositionY()-210);\n}\n```\n2.开始游戏按钮回调\n点击进入游戏场景\n```javascript\nstartGame:function(){\n    cc.audioEngine.playEffect(this.btnEffect);\n    cc.director.loadScene(\"gameScene\");\n}\n```\n#### 结束场景\n结束场景与开始场景差不多，相比之下，结束场景主要是提供游戏分数特效呈现的功能，效果图如下：\n![overScene图](http://7xnnwn.com1.z0.glb.clouddn.com/overScene.png)\n结束场景也是几个Label，一个背景层和一个Button按钮组成，其中最重要的是分数特效，通过从0一直往上加，加到实际分数的特效，来使玩家获得成就感，具体代码如下：\n1.加载函数\n动态设置场景中元素的宽高及位置，播放分数计算特效，绑定TOUCH_START事件，使特效立即播放完成\n```javascript\nonLoad: function () {\n    // 背景层\n    this.bg.width = cc.winSize.width;\n    this.bg.height = cc.winSize.height;\n    this.bg.setPosition(this.bg.width/2,this.bg.height/2);\n    this.bg.color = Colors.overBg;\n    // 文字层\n    this.gameText.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n    var action = cc.repeatForever(cc.sequence(cc.scaleTo(1, 1.5),cc.scaleTo(1,1)));\n    this.gameText.runAction(action);\n    // 播放结束音效\n    cc.audioEngine.playEffect(this.overEffect);\n    // 分数\n    this.scoreText.setPosition(this.gameText.getPositionX(),this.gameText.getPositionY()+200);\n    this.score = Global.score;\n    this.schedule(this.updateScore,0.1,cc.REPEAT_FOREVER,2);\n    // 点击分数立即加到最高分数\n    var self = this;\n    this.bg.on(cc.Node.EventType.TOUCH_START,function(event){\n        cc.log(\"score text touch\");\n        cc.audioEngine.playEffect(self.addCoin);\n        self.changeScore = self.score;\n        self.scoreLabel.string = \"最终分数：\"+self.changeScore;\n    }, this.bg);\n    // 返回按钮\n    this.backBtn.setPosition(this.gameText.getPositionX(),this.gameText.getPositionY()-200);\n}\n```\n2.更新分数回调\n每一次更新分数回调，将特效分数增加20，直到加满到游戏得分，并将这一过程显示在场景的Label中\n```javascript\nupdateScore(){\n    if(this.score<=this.changeScore){\n        this.unschedule(this.updateScore);\n    }\n    this.changeScore += 20;\n    this.changeScore = this.changeScore>this.score?this.score:this.changeScore;\n    // 添加音效\n    cc.audioEngine.playEffect(this.addCoin);\n    this.scoreLabel.string = \"最终分数：\"+this.changeScore;\n}\n```\n3.返回按钮回调\n游戏分数的全局变量归零，切换加载开始游戏的场景\n```javascript\nback:function(){\n    Global.score = 0;\n    cc.audioEngine.playEffect(this.btnEffect);\n    cc.director.loadScene(\"startScene\");\n}\n```\n#### 游戏场景\n最主要的还是游戏场景，在游戏场景中，我们进行所有的游戏逻辑的运算，包括前面提到的两个核心算法，游戏场景的效果图如下：\n![gameScene图](http://7xnnwn.com1.z0.glb.clouddn.com/gameScene.png)\n在游戏主场景中，我们主要需要在onLoad加载时，初始化25个方块，并放在地图中，使他们之间相邻个数小于3个，然后我们需要提供一个主要逻辑判断函数，这个函数中判断游戏中方块的消除逻辑，再前面的Tile的setNum函数中进行调用，代码如下：\n1.场景加载\n在场景加载中，我们需要初始化25个互相相邻小于3个的方块，与5个能量条，并且动态设置所有元素的宽高与位置。\n```javascript\nonLoad: function () {\n    // 播放背景音乐\n    cc.audioEngine.playMusic(this.bgMusic,true);\n    // 初始化方块数组\n    this.tiles = [\n        [null,null,null,null,null],\n        [null,null,null,null,null],\n        [null,null,null,null,null],\n        [null,null,null,null,null],\n        [null,null,null,null,null]\n    ];\n    this.powers = [null,null,null,null,null];\n    // 背景层\n    this.bg.width = cc.winSize.width;\n    this.bg.height = cc.winSize.height;\n    this.bg.setPosition(-cc.winSize.width/2,-cc.winSize.height/2);\n    this.bg.color = Colors.gameBg;\n    // 顶部背景层\n    this.topBg.width = cc.winSize.width-30;\n    this.topBg.height = 100;\n    this.topBg.setPosition(-cc.winSize.width/2+15,(cc.winSize.width-30)/2);\n    // 能量条背景层\n    this.powerBarBg.width = cc.winSize.width-30;\n    this.powerBarBg.height = this.powerBarBg.width/5/2;\n    this.powerBarBg.setPosition(15-cc.winSize.width/2,this.topBg.getPositionY()-200);\n    this.powerBarBg.color = Colors.powerBarBg;\n    // 方块背景层\n    this.tileBg.width = cc.winSize.width-30;\n    this.tileBg.height = this.tileBg.width;\n    this.tileBg.setPosition(15-cc.winSize.width/2,this.powerBarBg.getPositionY()-10-this.tileBg.height);\n    this.tileBg.color = Colors.tileBg;\n    // 生成能量条\n    for(var i=0;i<5;i++){\n        var power = cc.instantiate(this.powerPre);\n        power.width = (this.powerBarBg.width-30)/5;\n        power.height = this.powerBarBg.height-10;\n        this.powerBarBg.addChild(power);\n        power.setPosition(5+(5+power.width)*i+power.width/2,5+power.height/2);\n        power.color = Colors.power;\n        this.powers[i] = power;\n    };\n    // 生成初始方块\n    for(var row=0;row<5;row++){\n        for(var col = 0;col<5;col++){\n            var tile = cc.instantiate(this.tilePre);\n            tile.getComponent(\"Tile\").game = this;\n            tile.width = (this.tileBg.width-30)/5;\n            tile.height = (this.tileBg.height-30)/5;\n            var count = 0;\n            var maxRandom = 5;\n            var randomNum = 0;\n            while(true){\n                count++;\n                var arr = new Array();\n                var scanArr = new Array();\n                if(count>10){\n                    maxRandom++;\n                }\n                randomNum = Math.ceil(Math.random()*maxRandom);\n                tile.getComponent(\"Tile\").setNum(randomNum,false,false);\n                tile.setPosition(5+(5+tile.width)*col+tile.width/2,5+(5+tile.height)*row+tile.height/2);\n                this.tiles[row][col] = tile;\n                this.scanAround(row,col,-1,-1,randomNum,arr,scanArr);\n                if(arr.length<3){\n                    break;\n                }\n            }\n            tile.getComponent(\"Tile\").setArrPosition(row,col);\n            this.tileBg.addChild(tile);\n        }\n    }\n}\n```\n2.扫描逻辑\n前面已经讲过\n3.主要操作逻辑\n在这个函数中，我们需要对指定的点进行扫描，如果相邻数超过三个，则进行合成动作，然后更新分数，将所有的方块向下移动填补，并补充一条能量条，增加连击次数\n```javascript\noperateLogic:function(touchRow,touchCol,curNum,isFirstCall){\n    var arr = new Array();\n    var scanArr = new Array();\n    this.scanAround(touchRow,touchCol,-1,-1,curNum,arr,scanArr);\n    if(arr.length>=3){\n        var addScore = 0;\n        for(var index in arr){\n            var row = arr[index].split(\"#\")[0];\n            var col = arr[index].split(\"#\")[1];\n            addScore += parseInt(this.tiles[row][col].getComponent(\"Tile\").numLabel.string*10);\n            if(row!=touchRow||col!=touchCol){\n                // 执行销毁动作                    \n                this.tiles[row][col].getComponent(\"Tile\").destoryTile();\n                this.tiles[row][col] = null;\n            }else{\n                this.tiles[row][col].getComponent(\"Tile\").setNum(curNum+1,false,true);\n                this.maxNum = curNum+1>this.maxNum?curNum+1:this.maxNum;\n            }\n        }\n        // 更新分数\n        this.scoreNum.string = parseInt(this.scoreNum.string)+addScore;\n        this.scheduleOnce(function() {\n            // 0.1s后所有方块向下移动\n            this.moveAllTileDown();\n        },0.1);\n        if(!isFirstCall){\n            // 能量条补充一格\n            for(var i=0;i<5;i++){\n                if(this.powers[i]==null){\n                    var power = cc.instantiate(this.powerPre);\n                    power.width = (this.powerBarBg.width-30)/5;\n                    power.height = this.powerBarBg.height-10;\n                    this.powerBarBg.addChild(power);\n                    power.setPosition(5+(5+power.width)*i+power.width/2,5+power.height/2);\n                    power.color = Colors.power;\n                    power.setScale(0);\n                    power.runAction(cc.scaleTo(0.1,1));\n                    this.powers[i] = power;\n                    break;\n                }\n            };\n        }\n        // 连击次数+1\n        Global.combo++;\n        // cc.log(\"连击次数：\"+Global.combo);\n        // 播放音效\n        switch(Global.combo){\n            case 1:\n                cc.audioEngine.playEffect(this.star1);\n            break;\n            case 2:\n                cc.audioEngine.playEffect(this.star2);\n            break;\n            case 3:\n                cc.audioEngine.playEffect(this.star3);\n            break;\n            case 4:\n                cc.audioEngine.playEffect(this.star4);\n            break;\n            case 5:\n                cc.audioEngine.playEffect(this.star5);\n            break;\n            case 6:\n                cc.audioEngine.playEffect(this.star6);\n            break;\n            case 7:\n                cc.audioEngine.playEffect(this.star7);\n            break;\n            default:\n                cc.audioEngine.playEffect(this.star7);\n            break;\n        }\n        return true;\n    }else{\n        this.isCal = false;\n    }\n    return false;\n}\n```\n4.所有方块向下移动\n除了上文提到所有方块的移动算法之外，在移动完成之后，还需要进行新产生一批方块，并再次判断消除逻辑的操作\n```javascript\nmoveAllTileDown:function(){\n    for (var col = 0; col < 5; col++) {\n        for (var row = 0; row < 5; row++) {\n            if (this.tiles[row][col] != null) {// 有方块\n                for (var row1 = row; row1 > 0; row1--) {\n                    if (this.tiles[row1 - 1][col] == null){\n                        //如果没有向下移动\n                        this.tiles[row1 - 1][col] = this.tiles[row1][col];\n                        this.tiles[row1][col] = null;\n                        this.tiles[row1 - 1][col].getComponent(\"Tile\").moveTo(row1 - 1, col);\n                    }\n                }\n            }\n        }\n    }\n    this.scheduleOnce(function() {\n        // 0.3s后生成新方块\n        for (var col = 0; col < 5; col++) {\n            for (var row = 0; row < 5; row++) {\n                if(this.tiles[row][col]==null){\n                    var tile = cc.instantiate(this.tilePre);\n                    tile.getComponent(\"Tile\").game = this;\n                    tile.width = (this.tileBg.width-30)/5;\n                    tile.height = (this.tileBg.height-30)/5;\n                    var maxRandom = this.maxNum;\n                    var randomNum = Math.ceil(Math.random()*maxRandom);\n                    tile.getComponent(\"Tile\").setNum(randomNum,false,false);\n                    tile.getComponent(\"Tile\").newTile(row,col);\n                    this.tiles[row][col] = tile;\n                    this.tileBg.addChild(tile);\n                }\n            }\n        }\n        // 0.5s后遍历执行逻辑\n        this.scheduleOnce(function() {\n            var isSearch = false;\n            for (var col = 0; col < 5; col++) {\n                for (var row = 0; row < 5; row++) {\n                    if(!isSearch){\n                        isSearch = this.tiles[row][col]!=null&&this.operateLogic(row,col,parseInt(this.tiles[row][col].getComponent(\"Tile\").numLabel.string),false);\n                    }\n                }\n            }\n        }, 0.5);        \n     }, 0.3);\n}\n```\n### 运行效果\n最后的运行效果如下\n![点我+1效果图](http://7xnnwn.com1.z0.glb.clouddn.com/addone.gif)\n通过CVP平台的项目托管可看到实际运行效果，地址如下：\n- 由于个人对Cocos Creator的适配还不大了解，在pc上运行时，需要使用chrome的手机调试预览（或者将chrome窗口调至手机屏幕大小），但是如果直接用手机打开，loadScene似乎又有不兼容的问题，至今无法理解，还请大神指点，而我无论是开发时的预览，还是通过xcode打包到我的iPhone6s Plus手机运行，都是完全没有问题。不知道是不是Creator的h5兼容还没有做好，又或者我哪里的技术没有掌握全面。\nhttp://www.cocoscvp.com/usercode/946fc5fd5d2c77331cc344ea1e4bfdd04630cf85/\n\n### 源代码\n所有源代码均上传到github，欢迎交流学习，地址：\nhttps://github.com/hjcenry/addone\n\n- 原文博客：http://hjcenry.github.io","slug":"Cocos Creator实现的《点我+1》","published":1,"updated":"2016-07-02T17:12:24.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhvp004uwsazdj8r90e3","content":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>在学习Cocos中，需要一些东西来练手，于是前段时间就开发仿照一款公司之前的产品《点我+1》来做，仿照过程中，所有的算法逻辑都是自己研究的，并没有参考公司代码，也没有使用公司的美术资源，所以也就不存在公司机密的内容啦，完全只是学习练习而已。<a id=\"more\"></a><br>这是一款消除类游戏，规则和大多数三消类游戏差不多，在一个5x5的格子中，有25个方块，每个方块有一个数字，用户的操作就是点击方块，使方块的数字+1，当至少每3个相同数字的时候，这些数字相同的方块合成为一个，并且数字+1，在玩家的表现就是：除了点击的方块之外，其他的相同数字的方块全部消失，然后点击的方块再+1。这款游戏看似很简单，但实际也是蕴含很多细节以及算法，我也是用了一周时间断断续续才做出来。<br>并且在这次练习中，我也是第一次尝试使用Cocos Creator来做，使用中也是遇到了不少问题，它与Cocos2d-JS的原生API还是有一定的差别的，Cocos Creator在我看来就是Cocos在向Unity靠近的一个产物，想要像Unity那样实现一整套的工作流，将游戏中的所有元素都组件化，游戏场景可以通过拖动就能搭建，游戏逻辑的实现只需要对组件添加相应的脚本即可，让游戏开发更加的方便，更加直观可视化。</p>\n<h3 id=\"Cocos-Creator\"><a href=\"#Cocos-Creator\" class=\"headerlink\" title=\"Cocos Creator\"></a>Cocos Creator</h3><p>Cocos Creator是Cocos家族又一个划时代意义的产物，前面已经提到，我个人认为这是Cocos向Unity靠近的产物，或许也可以说，游戏开发的脚本化、组件化、以及高效工作流、高度可扩展，已经成为任何一款游戏引擎的发展方向，这样的高效快速的开发的工具，才是开发者的首选工具。了解Cocos家族历史的人应该都知道，Cocos从各种语言版本，到2dx跨平台版本，到Cocos Stuio、Cocos IDE、Cocos Builder，再到Cocos Creator，这一切都是在使开发者越来越方便，使得游戏开发的门槛越来越低，任何人，只要你有心，有游戏梦，你都可以通过自身的努力来造梦，而Cocos Creator，就是我们造梦的工具。<br>不过说实话，Cocos Creator目前是1.1版本，在使用仍然还有许多bug，比如我打包Web版本之后，直接在本地无法运行，查看控制台输出应该是跨域的问题，而发布到服务器就能正常运行，再比如游戏的开发者，开发者还是需要考虑很多各种型号手机屏幕兼容的问题，希望Cocos Creator还能有一套成熟的兼容适配的方案，还有一些我个人的问题或许只是我还不熟悉Cocos的组件化开发而已，需要等到我真正熟悉这款工具，才能用好它，所谓工欲善其事必先利其器，工具用好了，你的造梦之路才会更加顺畅！<br>Cocos Creator的用户手册：<a href=\"http://www.cocos.com/docs/creator/index.html\">http://www.cocos.com/docs/creator/index.html</a><br>Cocos Creator的API：<a href=\"http://www.cocos.com/docs/creator/api/index.html\">http://www.cocos.com/docs/creator/api/index.html</a></p>\n<h3 id=\"游戏分析\"><a href=\"#游戏分析\" class=\"headerlink\" title=\"游戏分析\"></a>游戏分析</h3><p>这款游戏是比较常见的三消类游戏，不过它也有着自己的特色，将数字类游戏玩法与消除类游戏玩法相结合，游戏过程也比较具有挑战性，让人产生挑战的欲望，游戏的玩法在上文已有描述，没有玩过这款消除类游戏的朋友可以通过以下地址进行下载：<br>安卓版地址：<a href=\"http://app.mi.com/detail/231892?ref=search\">http://app.mi.com/detail/231892?ref=search</a><br>iOS版地址：<a href=\"https://itunes.apple.com/cn/app/dian-wo+1/id1012314214?mt=8\">https://itunes.apple.com/cn/app/dian-wo+1/id1012314214?mt=8</a><br>没玩过的朋友可以通过以上地址下载下来玩一下，体验下游戏玩法，然后仔细分析其中的游戏逻辑运算过程。<br>通过游戏玩法的分析我们至少可以分析出以下几点：<br>1.点击游戏方块，方块数字+1<br>2.在至少3个相同数字的方块彼此相邻时，可以合成一个+1的数<br>3.生成5x5的地图时，最多只能有两个相同数字方块相邻<br>4.每完成一次方块合成之后，所有方块向下填补空缺的位置<br>5.在填补完空缺位置之后，再生成新的方块<br>在Cocos Creator中，我们要熟悉组件化开发，因此我们需要开始场景、游戏场景、结束场景、以及方块预制资源、能量条预制资源，以及各种脚本和音效等。分别用scene、script和voice三个文件夹来存放场景组件，脚本组件和音效组件，另外将预制资源放在根目录下，如下图资源目录：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/projstruct.png\" alt=\"资源结构图\"></p>\n<h3 id=\"游戏实现\"><a href=\"#游戏实现\" class=\"headerlink\" title=\"游戏实现\"></a>游戏实现</h3><p>如之前一篇文章对2048游戏的分析一样，我们首先需要一个数组来存放所有的方块，并将方块单独提出来为一个对象，在这里，我们将方块做成预制资源，在需要的时候直接创建方块预制资源，同样，能量条也可以做成预制资源。另外我们需要开始场景、游戏场景和结束场景三个场景，并对这三个场景组件编写脚本。<br>在开发写代码之前，我们经过如上的分析，知道了我们大致要实现的几个核心算法：<br>1.扫描某一个位置的上下左右四个方向所有相邻的相同数字的点，并得到这些点的个数<br>2.所有方块向下移动，填补所有的空缺<br>核心的就这两个算法，其他的都是一些简单的逻辑，下面先对这两个算法进行分析</p>\n<h4 id=\"扫描算法\"><a href=\"#扫描算法\" class=\"headerlink\" title=\"扫描算法\"></a>扫描算法</h4><p>扫描算法实质上就是对指定的点得四周进行扫描，扫描是否有数字相同的点，如果有数字相同的点，那么还需要进一步对这个数字相同的点再进行扫描，直到扫描的点四周都没有数字相同的点，才能确认最终相邻点的个数，实际上就是对指定的点向四周扩散扫描。<br>我的实现方式是这样的，写一个函数，传入两个数组，一个用来记录扫描到的数字相同的点，一个用来记录扫描过得点，以便于下次扫描不再扫描已经扫描过的点，除此之外，还需要传入行，列，上次扫描的行，上次扫描的列（在下次扫描时，不用再对上次的那个方向进行扫描），以及扫描要比对的数字。通过指定的点，我向上、下、左、右四个方向进行扫描，如果数字相同，我就将这个点加入到记录数字相同的点得数组中，并对这个点再递归调用这个函数，在四个方向全都递归扫描完毕后，我得到的这个扫描过的点的数组，就是所有与指定点的数字相同且彼此相邻的点的集合。可能我描述不是太清楚，我直接将代码贴出来，我的算法基础不是太好，可能这不是最优的算法，希望有朋友能为我提供更好更快的算法。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * 核心扫描逻辑</span></span><br><span class=\"line\"><span class=\"comment\"> * @param row 指定行</span></span><br><span class=\"line\"><span class=\"comment\"> * @param col 指定列</span></span><br><span class=\"line\"><span class=\"comment\"> * @param lastRow 上次扫描的行</span></span><br><span class=\"line\"><span class=\"comment\"> * @param lastCol 上次扫描的列</span></span><br><span class=\"line\"><span class=\"comment\"> * @param num 扫描要比对的数字</span></span><br><span class=\"line\"><span class=\"comment\"> * @param arr 记录数字相同且彼此相邻的数组</span></span><br><span class=\"line\"><span class=\"comment\"> * @param scanArr 记录扫描过的点的数组</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">scanAround:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">row,col,lastRow,lastCol,num,arr,scanArr</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// cc.log(&quot;row:&quot;,row,&quot;,col:&quot;,col,&quot;,lastRow:&quot;,lastRow,&quot;,lastCol:&quot;,lastCol,&quot;,num:&quot;,num,&quot;,arr:&quot;,arr,&quot;,scanArr:&quot;,scanArr);</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.tiles[row][col]==<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isClear = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(scanArr==<span class=\"literal\">undefined</span>)&#123;</span><br><span class=\"line\">        scanArr = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 扫描过的节点不再扫描</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(scanArr.indexOf(row+<span class=\"string\">&quot;#&quot;</span>+col)==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">        scanArr.push(row+<span class=\"string\">&quot;#&quot;</span>+col);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 扫描上</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(row&lt;<span class=\"number\">4</span>&amp;&amp;(lastRow!=(row+<span class=\"number\">1</span>)||lastCol!=col)&amp;&amp;<span class=\"built_in\">this</span>.tiles[row+<span class=\"number\">1</span>][col]!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> nextNum = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row+<span class=\"number\">1</span>][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(nextNum==num)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(arr.indexOf(row+<span class=\"string\">&quot;#&quot;</span>+col)==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">                arr.push(row+<span class=\"string\">&quot;#&quot;</span>+col);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.scanAround(row+<span class=\"number\">1</span>,col,row,col,num,arr,scanArr);</span><br><span class=\"line\">            isClear = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 扫描下</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(row&gt;<span class=\"number\">0</span>&amp;&amp;(lastRow!=(row<span class=\"number\">-1</span>)||lastCol!=col)&amp;&amp;<span class=\"built_in\">this</span>.tiles[row<span class=\"number\">-1</span>][col]!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> nextNum = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row<span class=\"number\">-1</span>][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(nextNum==num)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(arr.indexOf(row+<span class=\"string\">&quot;#&quot;</span>+col)==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">                arr.push(row+<span class=\"string\">&quot;#&quot;</span>+col);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.scanAround(row<span class=\"number\">-1</span>,col,row,col,num,arr,scanArr);</span><br><span class=\"line\">            isClear = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 扫描左</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(col&gt;<span class=\"number\">0</span>&amp;&amp;(lastRow!=row||lastCol!=(col<span class=\"number\">-1</span>))&amp;&amp;<span class=\"built_in\">this</span>.tiles[row][col<span class=\"number\">-1</span>]!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> nextNum = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row][col<span class=\"number\">-1</span>].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(nextNum==num)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(arr.indexOf(row+<span class=\"string\">&quot;#&quot;</span>+col)==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">                arr.push(row+<span class=\"string\">&quot;#&quot;</span>+col);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.scanAround(row,col<span class=\"number\">-1</span>,row,col,num,arr,scanArr);</span><br><span class=\"line\">            isClear = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 扫描右</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(col&lt;<span class=\"number\">4</span>&amp;&amp;(lastRow!=row||lastCol!=(col+<span class=\"number\">1</span>))&amp;&amp;<span class=\"built_in\">this</span>.tiles[row][col+<span class=\"number\">1</span>]!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> nextNum = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row][col+<span class=\"number\">1</span>].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(nextNum==num)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(arr.indexOf(row+<span class=\"string\">&quot;#&quot;</span>+col)==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">                arr.push(row+<span class=\"string\">&quot;#&quot;</span>+col);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.scanAround(row,col+<span class=\"number\">1</span>,row,col,num,arr,scanArr);</span><br><span class=\"line\">            isClear = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 四周都不通，但不是出发遍历点，并且数字相同，也加入到数组</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!isClear&amp;&amp;(lastRow!=<span class=\"number\">-1</span>&amp;&amp;lastCol!=<span class=\"number\">-1</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> curNum = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(curNum==num)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(arr.indexOf(row+<span class=\"string\">&quot;#&quot;</span>+col)==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">                arr.push(row+<span class=\"string\">&quot;#&quot;</span>+col);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"移动算法\"><a href=\"#移动算法\" class=\"headerlink\" title=\"移动算法\"></a>移动算法</h4><p>移动算法相对就比较简单了，我只需要对每一列从下往上遍历，当遍历中发现方块不为null时（即这个点有方块），我们就以这个方块为起点，对这一列往下遍历，在子循环中，如果下方为null时（即下方没有方块），这个方块就向下移动一个单位，一直循环到下方见底，或者下方遇到方块，才会停止。这个算法相对简单，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">5</span>; col++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">5</span>; row++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.tiles[row][col] != <span class=\"literal\">null</span>) &#123;<span class=\"comment\">// 有方块</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row1 = row; row1 &gt; <span class=\"number\">0</span>; row1--) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.tiles[row1 - <span class=\"number\">1</span>][col] == <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                    <span class=\"comment\">//如果没有向下移动</span></span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.tiles[row1 - <span class=\"number\">1</span>][col] = <span class=\"built_in\">this</span>.tiles[row1][col];</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.tiles[row1][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.tiles[row1 - <span class=\"number\">1</span>][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).moveTo(row1 - <span class=\"number\">1</span>, col);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"方块类\"><a href=\"#方块类\" class=\"headerlink\" title=\"方块类\"></a>方块类</h4><p>方块类我们通过Creator的预制资源来制作，如下图所示：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/tile.png\" alt=\"tile图\"><br>在Tile预制资源中，我们只需要一个背景层，和一个显示数字的Label即可，其背景层的颜色和数字显示都通过脚本来控制，方块需要包含以下几个方法：<br>1.产生新方块的初始化及特效<br>2.移动到指定点的逻辑及特效<br>3.方块销毁的逻辑及特效<br>4.设置方块数字以及动态改变其背景色<br>5.在方块的初始化onLoad函数中，需要对方块添加TOUCH_START事件，事件中绑定上面提到的4方法，方块类的具体实现代码如下：<br>1.方块初始化函数<br>添加触摸点击事件，绑定设置数字函数，清空combo次数（combo次数记录放在全局组件Global中）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onLoad: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.on(cc.Node.EventType.TOUCH_START,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!self.game.isCal)&#123;</span><br><span class=\"line\">            cc.audioEngine.playEffect(self.clickEffect);</span><br><span class=\"line\">            self.game.isCal = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"comment\">// 连击次数归零</span></span><br><span class=\"line\">            Global.combo = <span class=\"number\">0</span>;</span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.addCoin);</span><br><span class=\"line\">            self.setNum(<span class=\"built_in\">parseInt</span>(self.numLabel.string)+<span class=\"number\">1</span>,<span class=\"literal\">true</span>,<span class=\"literal\">false</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;, <span class=\"built_in\">this</span>.node);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2.产生新方块<br>执行从小变大的动画，设置数组中的行列到属性中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">newTile:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">row,col</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.setPosition(<span class=\"number\">5</span>+(<span class=\"number\">5</span>+<span class=\"built_in\">this</span>.node.width)*col+<span class=\"built_in\">this</span>.node.width/<span class=\"number\">2</span>,<span class=\"number\">5</span>+(<span class=\"number\">5</span>+<span class=\"built_in\">this</span>.node.height)*row+<span class=\"built_in\">this</span>.node.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.setScale(<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.runAction(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setArrPosition(row,col);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>3.移动到指定点<br>执行移动动画，设置数组中行列到属性中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">moveTo:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">row,col</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.row = row;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.col = col;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.stopActionByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> action = cc.moveTo(<span class=\"number\">0.2</span>,cc.p(<span class=\"number\">5</span>+(<span class=\"number\">5</span>+<span class=\"built_in\">this</span>.node.width)*col+<span class=\"built_in\">this</span>.node.width/<span class=\"number\">2</span>,<span class=\"number\">5</span>+(<span class=\"number\">5</span>+<span class=\"built_in\">this</span>.node.height)*row+<span class=\"built_in\">this</span>.node.height/<span class=\"number\">2</span>));</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.runAction(action);</span><br><span class=\"line\">    action.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>4.方块销毁<br>执行从大变小的动画，执行完动画之后调用destory方法销毁方块</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">destoryTile:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> action = cc.sequence(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0</span>),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">node</span>)</span>&#123;</span><br><span class=\"line\">        node.destroy();</span><br><span class=\"line\">    &#125;,<span class=\"built_in\">this</span>.node,<span class=\"built_in\">this</span>.node));</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.runAction(action);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>5.设置方块数字<br>设置方块的显示数字，并动态改变相应数字对应的颜色，颜色存在全局组件变量Colors中，通过参数exeLogic判断是否需要执行游戏的消除逻辑，通过playEffect判断是否需要播放音效</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setNum:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">num,exeLogic,playEffect</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.game.maxNum = num&gt;<span class=\"built_in\">this</span>.game.maxNum?num:<span class=\"built_in\">this</span>.game.maxNum;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.numLabel.string = num;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span>(num)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num1;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num2;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num3;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;  </span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num4;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num5;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num6;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;  </span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num7;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num8;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">9</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num9;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;  </span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">10</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num10;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">11</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num11;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">12</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num12;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;  </span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">13</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num13;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">14</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num14;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">15</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num15;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">16</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num16;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">17</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num17;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">18</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num18;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">19</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num19;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">20</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num20;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.nums;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 播放特效</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(playEffect)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.node.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.15</span>,<span class=\"number\">1.5</span>),cc.scaleTo(<span class=\"number\">0.15</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 消除逻辑</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(exeLogic)&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 执行逻辑</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> isMove = <span class=\"built_in\">this</span>.game.operateLogic(<span class=\"built_in\">this</span>.row,<span class=\"built_in\">this</span>.col,<span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.numLabel.string),<span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> powers = <span class=\"built_in\">this</span>.game.powers;</span><br><span class=\"line\">        <span class=\"comment\">// 能量条-1</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!isMove)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = powers.length - <span class=\"number\">1</span>; i &gt;= <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(powers[i]!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> costBarAction = cc.sequence(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0</span>),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">power</span>)</span>&#123;</span><br><span class=\"line\">                        power.destroy();</span><br><span class=\"line\">                    &#125;,<span class=\"literal\">null</span>,powers[i]));</span><br><span class=\"line\">                    powers[i].runAction(costBarAction);</span><br><span class=\"line\">                    powers[i] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            <span class=\"comment\">// 游戏结束逻辑判断：能量条为空</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(powers[<span class=\"number\">0</span>]==<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                Global.score = <span class=\"built_in\">this</span>.game.scoreNum.string;</span><br><span class=\"line\">                <span class=\"comment\">// Game Over</span></span><br><span class=\"line\">                cc.director.loadScene(<span class=\"string\">&quot;overScene&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"能量类\"><a href=\"#能量类\" class=\"headerlink\" title=\"能量类\"></a>能量类</h4><p>同方块类，我们将游戏场景中的能量条也做成预制资源，其中只需要添加一个背景层就可以，背景层也是通过代码动态控制颜色，能量条不需要任何脚本文件。</p>\n<h4 id=\"开始场景\"><a href=\"#开始场景\" class=\"headerlink\" title=\"开始场景\"></a>开始场景</h4><p>做好了预制资源之后，我们就可以先做开始场景了，效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/startScene.png\" alt=\"startScene图\"><br>开始场景中有三个元素，游戏文字，开始按钮，和背景层，其中游戏文字呈现一个变大变小循环播放的动画，点击开始游戏按钮即可转入游戏场景。具体代码如下：<br>1.onLoad加载<br>动态设置元素的位置及宽高，以适配各种型号手机屏幕</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onLoad: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 背景铺平</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.width = cc.winSize.width;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.height = cc.winSize.height;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.setPosition(<span class=\"built_in\">this</span>.bg.width/<span class=\"number\">2</span>,<span class=\"built_in\">this</span>.bg.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.color = Colors.startBg;</span><br><span class=\"line\">    <span class=\"comment\">// 设置文字</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> action = cc.repeatForever(cc.sequence(cc.scaleTo(<span class=\"number\">1</span>, <span class=\"number\">1.5</span>),cc.scaleTo(<span class=\"number\">1</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.gameName.runAction(action);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.gameName.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 设置按钮</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.startBtn.setPosition(<span class=\"built_in\">this</span>.gameName.getPositionX(),<span class=\"built_in\">this</span>.gameName.getPositionY()<span class=\"number\">-210</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2.开始游戏按钮回调<br>点击进入游戏场景</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">startGame:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.btnEffect);</span><br><span class=\"line\">    cc.director.loadScene(<span class=\"string\">&quot;gameScene&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"结束场景\"><a href=\"#结束场景\" class=\"headerlink\" title=\"结束场景\"></a>结束场景</h4><p>结束场景与开始场景差不多，相比之下，结束场景主要是提供游戏分数特效呈现的功能，效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/overScene.png\" alt=\"overScene图\"><br>结束场景也是几个Label，一个背景层和一个Button按钮组成，其中最重要的是分数特效，通过从0一直往上加，加到实际分数的特效，来使玩家获得成就感，具体代码如下：<br>1.加载函数<br>动态设置场景中元素的宽高及位置，播放分数计算特效，绑定TOUCH_START事件，使特效立即播放完成</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onLoad: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 背景层</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.width = cc.winSize.width;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.height = cc.winSize.height;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.setPosition(<span class=\"built_in\">this</span>.bg.width/<span class=\"number\">2</span>,<span class=\"built_in\">this</span>.bg.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.color = Colors.overBg;</span><br><span class=\"line\">    <span class=\"comment\">// 文字层</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.gameText.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> action = cc.repeatForever(cc.sequence(cc.scaleTo(<span class=\"number\">1</span>, <span class=\"number\">1.5</span>),cc.scaleTo(<span class=\"number\">1</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.gameText.runAction(action);</span><br><span class=\"line\">    <span class=\"comment\">// 播放结束音效</span></span><br><span class=\"line\">    cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.overEffect);</span><br><span class=\"line\">    <span class=\"comment\">// 分数</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.scoreText.setPosition(<span class=\"built_in\">this</span>.gameText.getPositionX(),<span class=\"built_in\">this</span>.gameText.getPositionY()+<span class=\"number\">200</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.score = Global.score;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.updateScore,<span class=\"number\">0.1</span>,cc.REPEAT_FOREVER,<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 点击分数立即加到最高分数</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.on(cc.Node.EventType.TOUCH_START,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>&#123;</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;score text touch&quot;</span>);</span><br><span class=\"line\">        cc.audioEngine.playEffect(self.addCoin);</span><br><span class=\"line\">        self.changeScore = self.score;</span><br><span class=\"line\">        self.scoreLabel.string = <span class=\"string\">&quot;最终分数：&quot;</span>+self.changeScore;</span><br><span class=\"line\">    &#125;, <span class=\"built_in\">this</span>.bg);</span><br><span class=\"line\">    <span class=\"comment\">// 返回按钮</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.backBtn.setPosition(<span class=\"built_in\">this</span>.gameText.getPositionX(),<span class=\"built_in\">this</span>.gameText.getPositionY()<span class=\"number\">-200</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2.更新分数回调<br>每一次更新分数回调，将特效分数增加20，直到加满到游戏得分，并将这一过程显示在场景的Label中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">updateScore()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.score&lt;=<span class=\"built_in\">this</span>.changeScore)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.updateScore);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.changeScore += <span class=\"number\">20</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.changeScore = <span class=\"built_in\">this</span>.changeScore&gt;<span class=\"built_in\">this</span>.score?<span class=\"built_in\">this</span>.score:<span class=\"built_in\">this</span>.changeScore;</span><br><span class=\"line\">    <span class=\"comment\">// 添加音效</span></span><br><span class=\"line\">    cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.addCoin);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.scoreLabel.string = <span class=\"string\">&quot;最终分数：&quot;</span>+<span class=\"built_in\">this</span>.changeScore;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>3.返回按钮回调<br>游戏分数的全局变量归零，切换加载开始游戏的场景</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">back:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    Global.score = <span class=\"number\">0</span>;</span><br><span class=\"line\">    cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.btnEffect);</span><br><span class=\"line\">    cc.director.loadScene(<span class=\"string\">&quot;startScene&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"游戏场景\"><a href=\"#游戏场景\" class=\"headerlink\" title=\"游戏场景\"></a>游戏场景</h4><p>最主要的还是游戏场景，在游戏场景中，我们进行所有的游戏逻辑的运算，包括前面提到的两个核心算法，游戏场景的效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/gameScene.png\" alt=\"gameScene图\"><br>在游戏主场景中，我们主要需要在onLoad加载时，初始化25个方块，并放在地图中，使他们之间相邻个数小于3个，然后我们需要提供一个主要逻辑判断函数，这个函数中判断游戏中方块的消除逻辑，再前面的Tile的setNum函数中进行调用，代码如下：<br>1.场景加载<br>在场景加载中，我们需要初始化25个互相相邻小于3个的方块，与5个能量条，并且动态设置所有元素的宽高与位置。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onLoad: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 播放背景音乐</span></span><br><span class=\"line\">    cc.audioEngine.playMusic(<span class=\"built_in\">this</span>.bgMusic,<span class=\"literal\">true</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 初始化方块数组</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.tiles = [</span><br><span class=\"line\">        [<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>],</span><br><span class=\"line\">        [<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>],</span><br><span class=\"line\">        [<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>],</span><br><span class=\"line\">        [<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>],</span><br><span class=\"line\">        [<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>]</span><br><span class=\"line\">    ];</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.powers = [<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>];</span><br><span class=\"line\">    <span class=\"comment\">// 背景层</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.width = cc.winSize.width;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.height = cc.winSize.height;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.setPosition(-cc.winSize.width/<span class=\"number\">2</span>,-cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.color = Colors.gameBg;</span><br><span class=\"line\">    <span class=\"comment\">// 顶部背景层</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.topBg.width = cc.winSize.width<span class=\"number\">-30</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.topBg.height = <span class=\"number\">100</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.topBg.setPosition(-cc.winSize.width/<span class=\"number\">2</span>+<span class=\"number\">15</span>,(cc.winSize.width<span class=\"number\">-30</span>)/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 能量条背景层</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.powerBarBg.width = cc.winSize.width<span class=\"number\">-30</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.powerBarBg.height = <span class=\"built_in\">this</span>.powerBarBg.width/<span class=\"number\">5</span>/<span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.powerBarBg.setPosition(<span class=\"number\">15</span>-cc.winSize.width/<span class=\"number\">2</span>,<span class=\"built_in\">this</span>.topBg.getPositionY()<span class=\"number\">-200</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.powerBarBg.color = Colors.powerBarBg;</span><br><span class=\"line\">    <span class=\"comment\">// 方块背景层</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.tileBg.width = cc.winSize.width<span class=\"number\">-30</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.tileBg.height = <span class=\"built_in\">this</span>.tileBg.width;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.tileBg.setPosition(<span class=\"number\">15</span>-cc.winSize.width/<span class=\"number\">2</span>,<span class=\"built_in\">this</span>.powerBarBg.getPositionY()<span class=\"number\">-10</span>-<span class=\"built_in\">this</span>.tileBg.height);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.tileBg.color = Colors.tileBg;</span><br><span class=\"line\">    <span class=\"comment\">// 生成能量条</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">5</span>;i++)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> power = cc.instantiate(<span class=\"built_in\">this</span>.powerPre);</span><br><span class=\"line\">        power.width = (<span class=\"built_in\">this</span>.powerBarBg.width<span class=\"number\">-30</span>)/<span class=\"number\">5</span>;</span><br><span class=\"line\">        power.height = <span class=\"built_in\">this</span>.powerBarBg.height<span class=\"number\">-10</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.powerBarBg.addChild(power);</span><br><span class=\"line\">        power.setPosition(<span class=\"number\">5</span>+(<span class=\"number\">5</span>+power.width)*i+power.width/<span class=\"number\">2</span>,<span class=\"number\">5</span>+power.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        power.color = Colors.power;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.powers[i] = power;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 生成初始方块</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> row=<span class=\"number\">0</span>;row&lt;<span class=\"number\">5</span>;row++)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>;col&lt;<span class=\"number\">5</span>;col++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> tile = cc.instantiate(<span class=\"built_in\">this</span>.tilePre);</span><br><span class=\"line\">            tile.getComponent(<span class=\"string\">&quot;Tile&quot;</span>).game = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">            tile.width = (<span class=\"built_in\">this</span>.tileBg.width<span class=\"number\">-30</span>)/<span class=\"number\">5</span>;</span><br><span class=\"line\">            tile.height = (<span class=\"built_in\">this</span>.tileBg.height<span class=\"number\">-30</span>)/<span class=\"number\">5</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> maxRandom = <span class=\"number\">5</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> randomNum = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">                count++;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> arr = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">                <span class=\"keyword\">var</span> scanArr = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(count&gt;<span class=\"number\">10</span>)&#123;</span><br><span class=\"line\">                    maxRandom++;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                randomNum = <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random()*maxRandom);</span><br><span class=\"line\">                tile.getComponent(<span class=\"string\">&quot;Tile&quot;</span>).setNum(randomNum,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>);</span><br><span class=\"line\">                tile.setPosition(<span class=\"number\">5</span>+(<span class=\"number\">5</span>+tile.width)*col+tile.width/<span class=\"number\">2</span>,<span class=\"number\">5</span>+(<span class=\"number\">5</span>+tile.height)*row+tile.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.tiles[row][col] = tile;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.scanAround(row,col,<span class=\"number\">-1</span>,<span class=\"number\">-1</span>,randomNum,arr,scanArr);</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(arr.length&lt;<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            tile.getComponent(<span class=\"string\">&quot;Tile&quot;</span>).setArrPosition(row,col);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.tileBg.addChild(tile);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2.扫描逻辑<br>前面已经讲过<br>3.主要操作逻辑<br>在这个函数中，我们需要对指定的点进行扫描，如果相邻数超过三个，则进行合成动作，然后更新分数，将所有的方块向下移动填补，并补充一条能量条，增加连击次数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">operateLogic:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touchRow,touchCol,curNum,isFirstCall</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arr = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> scanArr = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.scanAround(touchRow,touchCol,<span class=\"number\">-1</span>,<span class=\"number\">-1</span>,curNum,arr,scanArr);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(arr.length&gt;=<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> addScore = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> index <span class=\"keyword\">in</span> arr)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> row = arr[index].split(<span class=\"string\">&quot;#&quot;</span>)[<span class=\"number\">0</span>];</span><br><span class=\"line\">            <span class=\"keyword\">var</span> col = arr[index].split(<span class=\"string\">&quot;#&quot;</span>)[<span class=\"number\">1</span>];</span><br><span class=\"line\">            addScore += <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string*<span class=\"number\">10</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(row!=touchRow||col!=touchCol)&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 执行销毁动作                    </span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.tiles[row][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).destoryTile();</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.tiles[row][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.tiles[row][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).setNum(curNum+<span class=\"number\">1</span>,<span class=\"literal\">false</span>,<span class=\"literal\">true</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.maxNum = curNum+<span class=\"number\">1</span>&gt;<span class=\"built_in\">this</span>.maxNum?curNum+<span class=\"number\">1</span>:<span class=\"built_in\">this</span>.maxNum;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 更新分数</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scoreNum.string = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.scoreNum.string)+addScore;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scheduleOnce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 0.1s后所有方块向下移动</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.moveAllTileDown();</span><br><span class=\"line\">        &#125;,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!isFirstCall)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 能量条补充一格</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">5</span>;i++)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.powers[i]==<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> power = cc.instantiate(<span class=\"built_in\">this</span>.powerPre);</span><br><span class=\"line\">                    power.width = (<span class=\"built_in\">this</span>.powerBarBg.width<span class=\"number\">-30</span>)/<span class=\"number\">5</span>;</span><br><span class=\"line\">                    power.height = <span class=\"built_in\">this</span>.powerBarBg.height<span class=\"number\">-10</span>;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.powerBarBg.addChild(power);</span><br><span class=\"line\">                    power.setPosition(<span class=\"number\">5</span>+(<span class=\"number\">5</span>+power.width)*i+power.width/<span class=\"number\">2</span>,<span class=\"number\">5</span>+power.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">                    power.color = Colors.power;</span><br><span class=\"line\">                    power.setScale(<span class=\"number\">0</span>);</span><br><span class=\"line\">                    power.runAction(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>));</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.powers[i] = power;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 连击次数+1</span></span><br><span class=\"line\">        Global.combo++;</span><br><span class=\"line\">        <span class=\"comment\">// cc.log(&quot;连击次数：&quot;+Global.combo);</span></span><br><span class=\"line\">        <span class=\"comment\">// 播放音效</span></span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(Global.combo)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star1);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star2);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star3);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star4);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star5);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star6);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star7);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star7);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.isCal = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>4.所有方块向下移动<br>除了上文提到所有方块的移动算法之外，在移动完成之后，还需要进行新产生一批方块，并再次判断消除逻辑的操作</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">moveAllTileDown:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">5</span>; col++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">5</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.tiles[row][col] != <span class=\"literal\">null</span>) &#123;<span class=\"comment\">// 有方块</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row1 = row; row1 &gt; <span class=\"number\">0</span>; row1--) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.tiles[row1 - <span class=\"number\">1</span>][col] == <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                        <span class=\"comment\">//如果没有向下移动</span></span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.tiles[row1 - <span class=\"number\">1</span>][col] = <span class=\"built_in\">this</span>.tiles[row1][col];</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.tiles[row1][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.tiles[row1 - <span class=\"number\">1</span>][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).moveTo(row1 - <span class=\"number\">1</span>, col);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.scheduleOnce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 0.3s后生成新方块</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">5</span>; col++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">5</span>; row++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.tiles[row][col]==<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> tile = cc.instantiate(<span class=\"built_in\">this</span>.tilePre);</span><br><span class=\"line\">                    tile.getComponent(<span class=\"string\">&quot;Tile&quot;</span>).game = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">                    tile.width = (<span class=\"built_in\">this</span>.tileBg.width<span class=\"number\">-30</span>)/<span class=\"number\">5</span>;</span><br><span class=\"line\">                    tile.height = (<span class=\"built_in\">this</span>.tileBg.height<span class=\"number\">-30</span>)/<span class=\"number\">5</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> maxRandom = <span class=\"built_in\">this</span>.maxNum;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> randomNum = <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random()*maxRandom);</span><br><span class=\"line\">                    tile.getComponent(<span class=\"string\">&quot;Tile&quot;</span>).setNum(randomNum,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>);</span><br><span class=\"line\">                    tile.getComponent(<span class=\"string\">&quot;Tile&quot;</span>).newTile(row,col);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.tiles[row][col] = tile;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.tileBg.addChild(tile);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 0.5s后遍历执行逻辑</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scheduleOnce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> isSearch = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">5</span>; col++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">5</span>; row++) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(!isSearch)&#123;</span><br><span class=\"line\">                        isSearch = <span class=\"built_in\">this</span>.tiles[row][col]!=<span class=\"literal\">null</span>&amp;&amp;<span class=\"built_in\">this</span>.operateLogic(row,col,<span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string),<span class=\"literal\">false</span>);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"number\">0.5</span>);        </span><br><span class=\"line\">     &#125;, <span class=\"number\">0.3</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p>最后的运行效果如下<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/addone.gif\" alt=\"点我+1效果图\"><br>通过CVP平台的项目托管可看到实际运行效果，地址如下：</p>\n<ul>\n<li>由于个人对Cocos Creator的适配还不大了解，在pc上运行时，需要使用chrome的手机调试预览（或者将chrome窗口调至手机屏幕大小），但是如果直接用手机打开，loadScene似乎又有不兼容的问题，至今无法理解，还请大神指点，而我无论是开发时的预览，还是通过xcode打包到我的iPhone6s Plus手机运行，都是完全没有问题。不知道是不是Creator的h5兼容还没有做好，又或者我哪里的技术没有掌握全面。<br><a href=\"http://www.cocoscvp.com/usercode/946fc5fd5d2c77331cc344ea1e4bfdd04630cf85/\">http://www.cocoscvp.com/usercode/946fc5fd5d2c77331cc344ea1e4bfdd04630cf85/</a></li>\n</ul>\n<h3 id=\"源代码\"><a href=\"#源代码\" class=\"headerlink\" title=\"源代码\"></a>源代码</h3><p>所有源代码均上传到github，欢迎交流学习，地址：<br><a href=\"https://github.com/hjcenry/addone\">https://github.com/hjcenry/addone</a></p>\n<ul>\n<li>原文博客：<a href=\"http://hjcenry.github.io/\">http://hjcenry.github.io</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>在学习Cocos中，需要一些东西来练手，于是前段时间就开发仿照一款公司之前的产品《点我+1》来做，仿照过程中，所有的算法逻辑都是自己研究的，并没有参考公司代码，也没有使用公司的美术资源，所以也就不存在公司机密的内容啦，完全只是学习练习而已。","more":"<br>这是一款消除类游戏，规则和大多数三消类游戏差不多，在一个5x5的格子中，有25个方块，每个方块有一个数字，用户的操作就是点击方块，使方块的数字+1，当至少每3个相同数字的时候，这些数字相同的方块合成为一个，并且数字+1，在玩家的表现就是：除了点击的方块之外，其他的相同数字的方块全部消失，然后点击的方块再+1。这款游戏看似很简单，但实际也是蕴含很多细节以及算法，我也是用了一周时间断断续续才做出来。<br>并且在这次练习中，我也是第一次尝试使用Cocos Creator来做，使用中也是遇到了不少问题，它与Cocos2d-JS的原生API还是有一定的差别的，Cocos Creator在我看来就是Cocos在向Unity靠近的一个产物，想要像Unity那样实现一整套的工作流，将游戏中的所有元素都组件化，游戏场景可以通过拖动就能搭建，游戏逻辑的实现只需要对组件添加相应的脚本即可，让游戏开发更加的方便，更加直观可视化。</p>\n<h3 id=\"Cocos-Creator\"><a href=\"#Cocos-Creator\" class=\"headerlink\" title=\"Cocos Creator\"></a>Cocos Creator</h3><p>Cocos Creator是Cocos家族又一个划时代意义的产物，前面已经提到，我个人认为这是Cocos向Unity靠近的产物，或许也可以说，游戏开发的脚本化、组件化、以及高效工作流、高度可扩展，已经成为任何一款游戏引擎的发展方向，这样的高效快速的开发的工具，才是开发者的首选工具。了解Cocos家族历史的人应该都知道，Cocos从各种语言版本，到2dx跨平台版本，到Cocos Stuio、Cocos IDE、Cocos Builder，再到Cocos Creator，这一切都是在使开发者越来越方便，使得游戏开发的门槛越来越低，任何人，只要你有心，有游戏梦，你都可以通过自身的努力来造梦，而Cocos Creator，就是我们造梦的工具。<br>不过说实话，Cocos Creator目前是1.1版本，在使用仍然还有许多bug，比如我打包Web版本之后，直接在本地无法运行，查看控制台输出应该是跨域的问题，而发布到服务器就能正常运行，再比如游戏的开发者，开发者还是需要考虑很多各种型号手机屏幕兼容的问题，希望Cocos Creator还能有一套成熟的兼容适配的方案，还有一些我个人的问题或许只是我还不熟悉Cocos的组件化开发而已，需要等到我真正熟悉这款工具，才能用好它，所谓工欲善其事必先利其器，工具用好了，你的造梦之路才会更加顺畅！<br>Cocos Creator的用户手册：<a href=\"http://www.cocos.com/docs/creator/index.html\">http://www.cocos.com/docs/creator/index.html</a><br>Cocos Creator的API：<a href=\"http://www.cocos.com/docs/creator/api/index.html\">http://www.cocos.com/docs/creator/api/index.html</a></p>\n<h3 id=\"游戏分析\"><a href=\"#游戏分析\" class=\"headerlink\" title=\"游戏分析\"></a>游戏分析</h3><p>这款游戏是比较常见的三消类游戏，不过它也有着自己的特色，将数字类游戏玩法与消除类游戏玩法相结合，游戏过程也比较具有挑战性，让人产生挑战的欲望，游戏的玩法在上文已有描述，没有玩过这款消除类游戏的朋友可以通过以下地址进行下载：<br>安卓版地址：<a href=\"http://app.mi.com/detail/231892?ref=search\">http://app.mi.com/detail/231892?ref=search</a><br>iOS版地址：<a href=\"https://itunes.apple.com/cn/app/dian-wo+1/id1012314214?mt=8\">https://itunes.apple.com/cn/app/dian-wo+1/id1012314214?mt=8</a><br>没玩过的朋友可以通过以上地址下载下来玩一下，体验下游戏玩法，然后仔细分析其中的游戏逻辑运算过程。<br>通过游戏玩法的分析我们至少可以分析出以下几点：<br>1.点击游戏方块，方块数字+1<br>2.在至少3个相同数字的方块彼此相邻时，可以合成一个+1的数<br>3.生成5x5的地图时，最多只能有两个相同数字方块相邻<br>4.每完成一次方块合成之后，所有方块向下填补空缺的位置<br>5.在填补完空缺位置之后，再生成新的方块<br>在Cocos Creator中，我们要熟悉组件化开发，因此我们需要开始场景、游戏场景、结束场景、以及方块预制资源、能量条预制资源，以及各种脚本和音效等。分别用scene、script和voice三个文件夹来存放场景组件，脚本组件和音效组件，另外将预制资源放在根目录下，如下图资源目录：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/projstruct.png\" alt=\"资源结构图\"></p>\n<h3 id=\"游戏实现\"><a href=\"#游戏实现\" class=\"headerlink\" title=\"游戏实现\"></a>游戏实现</h3><p>如之前一篇文章对2048游戏的分析一样，我们首先需要一个数组来存放所有的方块，并将方块单独提出来为一个对象，在这里，我们将方块做成预制资源，在需要的时候直接创建方块预制资源，同样，能量条也可以做成预制资源。另外我们需要开始场景、游戏场景和结束场景三个场景，并对这三个场景组件编写脚本。<br>在开发写代码之前，我们经过如上的分析，知道了我们大致要实现的几个核心算法：<br>1.扫描某一个位置的上下左右四个方向所有相邻的相同数字的点，并得到这些点的个数<br>2.所有方块向下移动，填补所有的空缺<br>核心的就这两个算法，其他的都是一些简单的逻辑，下面先对这两个算法进行分析</p>\n<h4 id=\"扫描算法\"><a href=\"#扫描算法\" class=\"headerlink\" title=\"扫描算法\"></a>扫描算法</h4><p>扫描算法实质上就是对指定的点得四周进行扫描，扫描是否有数字相同的点，如果有数字相同的点，那么还需要进一步对这个数字相同的点再进行扫描，直到扫描的点四周都没有数字相同的点，才能确认最终相邻点的个数，实际上就是对指定的点向四周扩散扫描。<br>我的实现方式是这样的，写一个函数，传入两个数组，一个用来记录扫描到的数字相同的点，一个用来记录扫描过得点，以便于下次扫描不再扫描已经扫描过的点，除此之外，还需要传入行，列，上次扫描的行，上次扫描的列（在下次扫描时，不用再对上次的那个方向进行扫描），以及扫描要比对的数字。通过指定的点，我向上、下、左、右四个方向进行扫描，如果数字相同，我就将这个点加入到记录数字相同的点得数组中，并对这个点再递归调用这个函数，在四个方向全都递归扫描完毕后，我得到的这个扫描过的点的数组，就是所有与指定点的数字相同且彼此相邻的点的集合。可能我描述不是太清楚，我直接将代码贴出来，我的算法基础不是太好，可能这不是最优的算法，希望有朋友能为我提供更好更快的算法。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * 核心扫描逻辑</span></span><br><span class=\"line\"><span class=\"comment\"> * @param row 指定行</span></span><br><span class=\"line\"><span class=\"comment\"> * @param col 指定列</span></span><br><span class=\"line\"><span class=\"comment\"> * @param lastRow 上次扫描的行</span></span><br><span class=\"line\"><span class=\"comment\"> * @param lastCol 上次扫描的列</span></span><br><span class=\"line\"><span class=\"comment\"> * @param num 扫描要比对的数字</span></span><br><span class=\"line\"><span class=\"comment\"> * @param arr 记录数字相同且彼此相邻的数组</span></span><br><span class=\"line\"><span class=\"comment\"> * @param scanArr 记录扫描过的点的数组</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">scanAround:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">row,col,lastRow,lastCol,num,arr,scanArr</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// cc.log(&quot;row:&quot;,row,&quot;,col:&quot;,col,&quot;,lastRow:&quot;,lastRow,&quot;,lastCol:&quot;,lastCol,&quot;,num:&quot;,num,&quot;,arr:&quot;,arr,&quot;,scanArr:&quot;,scanArr);</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.tiles[row][col]==<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isClear = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(scanArr==<span class=\"literal\">undefined</span>)&#123;</span><br><span class=\"line\">        scanArr = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 扫描过的节点不再扫描</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(scanArr.indexOf(row+<span class=\"string\">&quot;#&quot;</span>+col)==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">        scanArr.push(row+<span class=\"string\">&quot;#&quot;</span>+col);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 扫描上</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(row&lt;<span class=\"number\">4</span>&amp;&amp;(lastRow!=(row+<span class=\"number\">1</span>)||lastCol!=col)&amp;&amp;<span class=\"built_in\">this</span>.tiles[row+<span class=\"number\">1</span>][col]!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> nextNum = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row+<span class=\"number\">1</span>][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(nextNum==num)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(arr.indexOf(row+<span class=\"string\">&quot;#&quot;</span>+col)==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">                arr.push(row+<span class=\"string\">&quot;#&quot;</span>+col);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.scanAround(row+<span class=\"number\">1</span>,col,row,col,num,arr,scanArr);</span><br><span class=\"line\">            isClear = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 扫描下</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(row&gt;<span class=\"number\">0</span>&amp;&amp;(lastRow!=(row<span class=\"number\">-1</span>)||lastCol!=col)&amp;&amp;<span class=\"built_in\">this</span>.tiles[row<span class=\"number\">-1</span>][col]!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> nextNum = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row<span class=\"number\">-1</span>][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(nextNum==num)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(arr.indexOf(row+<span class=\"string\">&quot;#&quot;</span>+col)==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">                arr.push(row+<span class=\"string\">&quot;#&quot;</span>+col);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.scanAround(row<span class=\"number\">-1</span>,col,row,col,num,arr,scanArr);</span><br><span class=\"line\">            isClear = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 扫描左</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(col&gt;<span class=\"number\">0</span>&amp;&amp;(lastRow!=row||lastCol!=(col<span class=\"number\">-1</span>))&amp;&amp;<span class=\"built_in\">this</span>.tiles[row][col<span class=\"number\">-1</span>]!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> nextNum = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row][col<span class=\"number\">-1</span>].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(nextNum==num)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(arr.indexOf(row+<span class=\"string\">&quot;#&quot;</span>+col)==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">                arr.push(row+<span class=\"string\">&quot;#&quot;</span>+col);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.scanAround(row,col<span class=\"number\">-1</span>,row,col,num,arr,scanArr);</span><br><span class=\"line\">            isClear = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 扫描右</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(col&lt;<span class=\"number\">4</span>&amp;&amp;(lastRow!=row||lastCol!=(col+<span class=\"number\">1</span>))&amp;&amp;<span class=\"built_in\">this</span>.tiles[row][col+<span class=\"number\">1</span>]!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> nextNum = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row][col+<span class=\"number\">1</span>].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(nextNum==num)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(arr.indexOf(row+<span class=\"string\">&quot;#&quot;</span>+col)==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">                arr.push(row+<span class=\"string\">&quot;#&quot;</span>+col);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.scanAround(row,col+<span class=\"number\">1</span>,row,col,num,arr,scanArr);</span><br><span class=\"line\">            isClear = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 四周都不通，但不是出发遍历点，并且数字相同，也加入到数组</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!isClear&amp;&amp;(lastRow!=<span class=\"number\">-1</span>&amp;&amp;lastCol!=<span class=\"number\">-1</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> curNum = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(curNum==num)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(arr.indexOf(row+<span class=\"string\">&quot;#&quot;</span>+col)==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">                arr.push(row+<span class=\"string\">&quot;#&quot;</span>+col);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"移动算法\"><a href=\"#移动算法\" class=\"headerlink\" title=\"移动算法\"></a>移动算法</h4><p>移动算法相对就比较简单了，我只需要对每一列从下往上遍历，当遍历中发现方块不为null时（即这个点有方块），我们就以这个方块为起点，对这一列往下遍历，在子循环中，如果下方为null时（即下方没有方块），这个方块就向下移动一个单位，一直循环到下方见底，或者下方遇到方块，才会停止。这个算法相对简单，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">5</span>; col++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">5</span>; row++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.tiles[row][col] != <span class=\"literal\">null</span>) &#123;<span class=\"comment\">// 有方块</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row1 = row; row1 &gt; <span class=\"number\">0</span>; row1--) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.tiles[row1 - <span class=\"number\">1</span>][col] == <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                    <span class=\"comment\">//如果没有向下移动</span></span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.tiles[row1 - <span class=\"number\">1</span>][col] = <span class=\"built_in\">this</span>.tiles[row1][col];</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.tiles[row1][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.tiles[row1 - <span class=\"number\">1</span>][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).moveTo(row1 - <span class=\"number\">1</span>, col);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"方块类\"><a href=\"#方块类\" class=\"headerlink\" title=\"方块类\"></a>方块类</h4><p>方块类我们通过Creator的预制资源来制作，如下图所示：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/tile.png\" alt=\"tile图\"><br>在Tile预制资源中，我们只需要一个背景层，和一个显示数字的Label即可，其背景层的颜色和数字显示都通过脚本来控制，方块需要包含以下几个方法：<br>1.产生新方块的初始化及特效<br>2.移动到指定点的逻辑及特效<br>3.方块销毁的逻辑及特效<br>4.设置方块数字以及动态改变其背景色<br>5.在方块的初始化onLoad函数中，需要对方块添加TOUCH_START事件，事件中绑定上面提到的4方法，方块类的具体实现代码如下：<br>1.方块初始化函数<br>添加触摸点击事件，绑定设置数字函数，清空combo次数（combo次数记录放在全局组件Global中）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onLoad: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.on(cc.Node.EventType.TOUCH_START,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!self.game.isCal)&#123;</span><br><span class=\"line\">            cc.audioEngine.playEffect(self.clickEffect);</span><br><span class=\"line\">            self.game.isCal = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"comment\">// 连击次数归零</span></span><br><span class=\"line\">            Global.combo = <span class=\"number\">0</span>;</span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.addCoin);</span><br><span class=\"line\">            self.setNum(<span class=\"built_in\">parseInt</span>(self.numLabel.string)+<span class=\"number\">1</span>,<span class=\"literal\">true</span>,<span class=\"literal\">false</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;, <span class=\"built_in\">this</span>.node);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2.产生新方块<br>执行从小变大的动画，设置数组中的行列到属性中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">newTile:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">row,col</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.setPosition(<span class=\"number\">5</span>+(<span class=\"number\">5</span>+<span class=\"built_in\">this</span>.node.width)*col+<span class=\"built_in\">this</span>.node.width/<span class=\"number\">2</span>,<span class=\"number\">5</span>+(<span class=\"number\">5</span>+<span class=\"built_in\">this</span>.node.height)*row+<span class=\"built_in\">this</span>.node.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.setScale(<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.runAction(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setArrPosition(row,col);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>3.移动到指定点<br>执行移动动画，设置数组中行列到属性中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">moveTo:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">row,col</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.row = row;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.col = col;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.stopActionByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> action = cc.moveTo(<span class=\"number\">0.2</span>,cc.p(<span class=\"number\">5</span>+(<span class=\"number\">5</span>+<span class=\"built_in\">this</span>.node.width)*col+<span class=\"built_in\">this</span>.node.width/<span class=\"number\">2</span>,<span class=\"number\">5</span>+(<span class=\"number\">5</span>+<span class=\"built_in\">this</span>.node.height)*row+<span class=\"built_in\">this</span>.node.height/<span class=\"number\">2</span>));</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.runAction(action);</span><br><span class=\"line\">    action.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>4.方块销毁<br>执行从大变小的动画，执行完动画之后调用destory方法销毁方块</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">destoryTile:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> action = cc.sequence(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0</span>),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">node</span>)</span>&#123;</span><br><span class=\"line\">        node.destroy();</span><br><span class=\"line\">    &#125;,<span class=\"built_in\">this</span>.node,<span class=\"built_in\">this</span>.node));</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.node.runAction(action);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>5.设置方块数字<br>设置方块的显示数字，并动态改变相应数字对应的颜色，颜色存在全局组件变量Colors中，通过参数exeLogic判断是否需要执行游戏的消除逻辑，通过playEffect判断是否需要播放音效</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setNum:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">num,exeLogic,playEffect</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.game.maxNum = num&gt;<span class=\"built_in\">this</span>.game.maxNum?num:<span class=\"built_in\">this</span>.game.maxNum;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.numLabel.string = num;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span>(num)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num1;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num2;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num3;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;  </span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num4;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num5;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num6;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;  </span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num7;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num8;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">9</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num9;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;  </span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">10</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num10;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">11</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num11;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">12</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num12;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;  </span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">13</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num13;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">14</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num14;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">15</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num15;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">16</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num16;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">17</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num17;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">18</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num18;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">19</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num19;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">20</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.num20;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.node.color = Colors.nums;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 播放特效</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(playEffect)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.node.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.15</span>,<span class=\"number\">1.5</span>),cc.scaleTo(<span class=\"number\">0.15</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 消除逻辑</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(exeLogic)&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 执行逻辑</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> isMove = <span class=\"built_in\">this</span>.game.operateLogic(<span class=\"built_in\">this</span>.row,<span class=\"built_in\">this</span>.col,<span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.numLabel.string),<span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> powers = <span class=\"built_in\">this</span>.game.powers;</span><br><span class=\"line\">        <span class=\"comment\">// 能量条-1</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!isMove)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = powers.length - <span class=\"number\">1</span>; i &gt;= <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(powers[i]!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> costBarAction = cc.sequence(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0</span>),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">power</span>)</span>&#123;</span><br><span class=\"line\">                        power.destroy();</span><br><span class=\"line\">                    &#125;,<span class=\"literal\">null</span>,powers[i]));</span><br><span class=\"line\">                    powers[i].runAction(costBarAction);</span><br><span class=\"line\">                    powers[i] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            <span class=\"comment\">// 游戏结束逻辑判断：能量条为空</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(powers[<span class=\"number\">0</span>]==<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                Global.score = <span class=\"built_in\">this</span>.game.scoreNum.string;</span><br><span class=\"line\">                <span class=\"comment\">// Game Over</span></span><br><span class=\"line\">                cc.director.loadScene(<span class=\"string\">&quot;overScene&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"能量类\"><a href=\"#能量类\" class=\"headerlink\" title=\"能量类\"></a>能量类</h4><p>同方块类，我们将游戏场景中的能量条也做成预制资源，其中只需要添加一个背景层就可以，背景层也是通过代码动态控制颜色，能量条不需要任何脚本文件。</p>\n<h4 id=\"开始场景\"><a href=\"#开始场景\" class=\"headerlink\" title=\"开始场景\"></a>开始场景</h4><p>做好了预制资源之后，我们就可以先做开始场景了，效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/startScene.png\" alt=\"startScene图\"><br>开始场景中有三个元素，游戏文字，开始按钮，和背景层，其中游戏文字呈现一个变大变小循环播放的动画，点击开始游戏按钮即可转入游戏场景。具体代码如下：<br>1.onLoad加载<br>动态设置元素的位置及宽高，以适配各种型号手机屏幕</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onLoad: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 背景铺平</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.width = cc.winSize.width;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.height = cc.winSize.height;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.setPosition(<span class=\"built_in\">this</span>.bg.width/<span class=\"number\">2</span>,<span class=\"built_in\">this</span>.bg.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.color = Colors.startBg;</span><br><span class=\"line\">    <span class=\"comment\">// 设置文字</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> action = cc.repeatForever(cc.sequence(cc.scaleTo(<span class=\"number\">1</span>, <span class=\"number\">1.5</span>),cc.scaleTo(<span class=\"number\">1</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.gameName.runAction(action);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.gameName.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 设置按钮</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.startBtn.setPosition(<span class=\"built_in\">this</span>.gameName.getPositionX(),<span class=\"built_in\">this</span>.gameName.getPositionY()<span class=\"number\">-210</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2.开始游戏按钮回调<br>点击进入游戏场景</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">startGame:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.btnEffect);</span><br><span class=\"line\">    cc.director.loadScene(<span class=\"string\">&quot;gameScene&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"结束场景\"><a href=\"#结束场景\" class=\"headerlink\" title=\"结束场景\"></a>结束场景</h4><p>结束场景与开始场景差不多，相比之下，结束场景主要是提供游戏分数特效呈现的功能，效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/overScene.png\" alt=\"overScene图\"><br>结束场景也是几个Label，一个背景层和一个Button按钮组成，其中最重要的是分数特效，通过从0一直往上加，加到实际分数的特效，来使玩家获得成就感，具体代码如下：<br>1.加载函数<br>动态设置场景中元素的宽高及位置，播放分数计算特效，绑定TOUCH_START事件，使特效立即播放完成</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onLoad: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 背景层</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.width = cc.winSize.width;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.height = cc.winSize.height;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.setPosition(<span class=\"built_in\">this</span>.bg.width/<span class=\"number\">2</span>,<span class=\"built_in\">this</span>.bg.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.color = Colors.overBg;</span><br><span class=\"line\">    <span class=\"comment\">// 文字层</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.gameText.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> action = cc.repeatForever(cc.sequence(cc.scaleTo(<span class=\"number\">1</span>, <span class=\"number\">1.5</span>),cc.scaleTo(<span class=\"number\">1</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.gameText.runAction(action);</span><br><span class=\"line\">    <span class=\"comment\">// 播放结束音效</span></span><br><span class=\"line\">    cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.overEffect);</span><br><span class=\"line\">    <span class=\"comment\">// 分数</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.scoreText.setPosition(<span class=\"built_in\">this</span>.gameText.getPositionX(),<span class=\"built_in\">this</span>.gameText.getPositionY()+<span class=\"number\">200</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.score = Global.score;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.updateScore,<span class=\"number\">0.1</span>,cc.REPEAT_FOREVER,<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 点击分数立即加到最高分数</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.on(cc.Node.EventType.TOUCH_START,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>&#123;</span><br><span class=\"line\">        cc.log(<span class=\"string\">&quot;score text touch&quot;</span>);</span><br><span class=\"line\">        cc.audioEngine.playEffect(self.addCoin);</span><br><span class=\"line\">        self.changeScore = self.score;</span><br><span class=\"line\">        self.scoreLabel.string = <span class=\"string\">&quot;最终分数：&quot;</span>+self.changeScore;</span><br><span class=\"line\">    &#125;, <span class=\"built_in\">this</span>.bg);</span><br><span class=\"line\">    <span class=\"comment\">// 返回按钮</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.backBtn.setPosition(<span class=\"built_in\">this</span>.gameText.getPositionX(),<span class=\"built_in\">this</span>.gameText.getPositionY()<span class=\"number\">-200</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2.更新分数回调<br>每一次更新分数回调，将特效分数增加20，直到加满到游戏得分，并将这一过程显示在场景的Label中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">updateScore()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.score&lt;=<span class=\"built_in\">this</span>.changeScore)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.updateScore);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.changeScore += <span class=\"number\">20</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.changeScore = <span class=\"built_in\">this</span>.changeScore&gt;<span class=\"built_in\">this</span>.score?<span class=\"built_in\">this</span>.score:<span class=\"built_in\">this</span>.changeScore;</span><br><span class=\"line\">    <span class=\"comment\">// 添加音效</span></span><br><span class=\"line\">    cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.addCoin);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.scoreLabel.string = <span class=\"string\">&quot;最终分数：&quot;</span>+<span class=\"built_in\">this</span>.changeScore;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>3.返回按钮回调<br>游戏分数的全局变量归零，切换加载开始游戏的场景</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">back:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    Global.score = <span class=\"number\">0</span>;</span><br><span class=\"line\">    cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.btnEffect);</span><br><span class=\"line\">    cc.director.loadScene(<span class=\"string\">&quot;startScene&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"游戏场景\"><a href=\"#游戏场景\" class=\"headerlink\" title=\"游戏场景\"></a>游戏场景</h4><p>最主要的还是游戏场景，在游戏场景中，我们进行所有的游戏逻辑的运算，包括前面提到的两个核心算法，游戏场景的效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/gameScene.png\" alt=\"gameScene图\"><br>在游戏主场景中，我们主要需要在onLoad加载时，初始化25个方块，并放在地图中，使他们之间相邻个数小于3个，然后我们需要提供一个主要逻辑判断函数，这个函数中判断游戏中方块的消除逻辑，再前面的Tile的setNum函数中进行调用，代码如下：<br>1.场景加载<br>在场景加载中，我们需要初始化25个互相相邻小于3个的方块，与5个能量条，并且动态设置所有元素的宽高与位置。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onLoad: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 播放背景音乐</span></span><br><span class=\"line\">    cc.audioEngine.playMusic(<span class=\"built_in\">this</span>.bgMusic,<span class=\"literal\">true</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 初始化方块数组</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.tiles = [</span><br><span class=\"line\">        [<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>],</span><br><span class=\"line\">        [<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>],</span><br><span class=\"line\">        [<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>],</span><br><span class=\"line\">        [<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>],</span><br><span class=\"line\">        [<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>]</span><br><span class=\"line\">    ];</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.powers = [<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>,<span class=\"literal\">null</span>];</span><br><span class=\"line\">    <span class=\"comment\">// 背景层</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.width = cc.winSize.width;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.height = cc.winSize.height;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.setPosition(-cc.winSize.width/<span class=\"number\">2</span>,-cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bg.color = Colors.gameBg;</span><br><span class=\"line\">    <span class=\"comment\">// 顶部背景层</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.topBg.width = cc.winSize.width<span class=\"number\">-30</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.topBg.height = <span class=\"number\">100</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.topBg.setPosition(-cc.winSize.width/<span class=\"number\">2</span>+<span class=\"number\">15</span>,(cc.winSize.width<span class=\"number\">-30</span>)/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 能量条背景层</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.powerBarBg.width = cc.winSize.width<span class=\"number\">-30</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.powerBarBg.height = <span class=\"built_in\">this</span>.powerBarBg.width/<span class=\"number\">5</span>/<span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.powerBarBg.setPosition(<span class=\"number\">15</span>-cc.winSize.width/<span class=\"number\">2</span>,<span class=\"built_in\">this</span>.topBg.getPositionY()<span class=\"number\">-200</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.powerBarBg.color = Colors.powerBarBg;</span><br><span class=\"line\">    <span class=\"comment\">// 方块背景层</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.tileBg.width = cc.winSize.width<span class=\"number\">-30</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.tileBg.height = <span class=\"built_in\">this</span>.tileBg.width;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.tileBg.setPosition(<span class=\"number\">15</span>-cc.winSize.width/<span class=\"number\">2</span>,<span class=\"built_in\">this</span>.powerBarBg.getPositionY()<span class=\"number\">-10</span>-<span class=\"built_in\">this</span>.tileBg.height);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.tileBg.color = Colors.tileBg;</span><br><span class=\"line\">    <span class=\"comment\">// 生成能量条</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">5</span>;i++)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> power = cc.instantiate(<span class=\"built_in\">this</span>.powerPre);</span><br><span class=\"line\">        power.width = (<span class=\"built_in\">this</span>.powerBarBg.width<span class=\"number\">-30</span>)/<span class=\"number\">5</span>;</span><br><span class=\"line\">        power.height = <span class=\"built_in\">this</span>.powerBarBg.height<span class=\"number\">-10</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.powerBarBg.addChild(power);</span><br><span class=\"line\">        power.setPosition(<span class=\"number\">5</span>+(<span class=\"number\">5</span>+power.width)*i+power.width/<span class=\"number\">2</span>,<span class=\"number\">5</span>+power.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        power.color = Colors.power;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.powers[i] = power;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 生成初始方块</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> row=<span class=\"number\">0</span>;row&lt;<span class=\"number\">5</span>;row++)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>;col&lt;<span class=\"number\">5</span>;col++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> tile = cc.instantiate(<span class=\"built_in\">this</span>.tilePre);</span><br><span class=\"line\">            tile.getComponent(<span class=\"string\">&quot;Tile&quot;</span>).game = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">            tile.width = (<span class=\"built_in\">this</span>.tileBg.width<span class=\"number\">-30</span>)/<span class=\"number\">5</span>;</span><br><span class=\"line\">            tile.height = (<span class=\"built_in\">this</span>.tileBg.height<span class=\"number\">-30</span>)/<span class=\"number\">5</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> maxRandom = <span class=\"number\">5</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> randomNum = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">                count++;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> arr = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">                <span class=\"keyword\">var</span> scanArr = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(count&gt;<span class=\"number\">10</span>)&#123;</span><br><span class=\"line\">                    maxRandom++;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                randomNum = <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random()*maxRandom);</span><br><span class=\"line\">                tile.getComponent(<span class=\"string\">&quot;Tile&quot;</span>).setNum(randomNum,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>);</span><br><span class=\"line\">                tile.setPosition(<span class=\"number\">5</span>+(<span class=\"number\">5</span>+tile.width)*col+tile.width/<span class=\"number\">2</span>,<span class=\"number\">5</span>+(<span class=\"number\">5</span>+tile.height)*row+tile.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.tiles[row][col] = tile;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.scanAround(row,col,<span class=\"number\">-1</span>,<span class=\"number\">-1</span>,randomNum,arr,scanArr);</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(arr.length&lt;<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            tile.getComponent(<span class=\"string\">&quot;Tile&quot;</span>).setArrPosition(row,col);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.tileBg.addChild(tile);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2.扫描逻辑<br>前面已经讲过<br>3.主要操作逻辑<br>在这个函数中，我们需要对指定的点进行扫描，如果相邻数超过三个，则进行合成动作，然后更新分数，将所有的方块向下移动填补，并补充一条能量条，增加连击次数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">operateLogic:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touchRow,touchCol,curNum,isFirstCall</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arr = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> scanArr = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.scanAround(touchRow,touchCol,<span class=\"number\">-1</span>,<span class=\"number\">-1</span>,curNum,arr,scanArr);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(arr.length&gt;=<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> addScore = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> index <span class=\"keyword\">in</span> arr)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> row = arr[index].split(<span class=\"string\">&quot;#&quot;</span>)[<span class=\"number\">0</span>];</span><br><span class=\"line\">            <span class=\"keyword\">var</span> col = arr[index].split(<span class=\"string\">&quot;#&quot;</span>)[<span class=\"number\">1</span>];</span><br><span class=\"line\">            addScore += <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string*<span class=\"number\">10</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(row!=touchRow||col!=touchCol)&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 执行销毁动作                    </span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.tiles[row][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).destoryTile();</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.tiles[row][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.tiles[row][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).setNum(curNum+<span class=\"number\">1</span>,<span class=\"literal\">false</span>,<span class=\"literal\">true</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.maxNum = curNum+<span class=\"number\">1</span>&gt;<span class=\"built_in\">this</span>.maxNum?curNum+<span class=\"number\">1</span>:<span class=\"built_in\">this</span>.maxNum;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 更新分数</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scoreNum.string = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.scoreNum.string)+addScore;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scheduleOnce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 0.1s后所有方块向下移动</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.moveAllTileDown();</span><br><span class=\"line\">        &#125;,<span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!isFirstCall)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 能量条补充一格</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">5</span>;i++)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.powers[i]==<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> power = cc.instantiate(<span class=\"built_in\">this</span>.powerPre);</span><br><span class=\"line\">                    power.width = (<span class=\"built_in\">this</span>.powerBarBg.width<span class=\"number\">-30</span>)/<span class=\"number\">5</span>;</span><br><span class=\"line\">                    power.height = <span class=\"built_in\">this</span>.powerBarBg.height<span class=\"number\">-10</span>;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.powerBarBg.addChild(power);</span><br><span class=\"line\">                    power.setPosition(<span class=\"number\">5</span>+(<span class=\"number\">5</span>+power.width)*i+power.width/<span class=\"number\">2</span>,<span class=\"number\">5</span>+power.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">                    power.color = Colors.power;</span><br><span class=\"line\">                    power.setScale(<span class=\"number\">0</span>);</span><br><span class=\"line\">                    power.runAction(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>));</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.powers[i] = power;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 连击次数+1</span></span><br><span class=\"line\">        Global.combo++;</span><br><span class=\"line\">        <span class=\"comment\">// cc.log(&quot;连击次数：&quot;+Global.combo);</span></span><br><span class=\"line\">        <span class=\"comment\">// 播放音效</span></span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(Global.combo)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star1);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star2);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star3);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star4);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star5);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star6);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star7);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"built_in\">this</span>.star7);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.isCal = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>4.所有方块向下移动<br>除了上文提到所有方块的移动算法之外，在移动完成之后，还需要进行新产生一批方块，并再次判断消除逻辑的操作</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">moveAllTileDown:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">5</span>; col++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">5</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.tiles[row][col] != <span class=\"literal\">null</span>) &#123;<span class=\"comment\">// 有方块</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row1 = row; row1 &gt; <span class=\"number\">0</span>; row1--) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.tiles[row1 - <span class=\"number\">1</span>][col] == <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                        <span class=\"comment\">//如果没有向下移动</span></span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.tiles[row1 - <span class=\"number\">1</span>][col] = <span class=\"built_in\">this</span>.tiles[row1][col];</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.tiles[row1][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        <span class=\"built_in\">this</span>.tiles[row1 - <span class=\"number\">1</span>][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).moveTo(row1 - <span class=\"number\">1</span>, col);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.scheduleOnce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 0.3s后生成新方块</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">5</span>; col++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">5</span>; row++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.tiles[row][col]==<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> tile = cc.instantiate(<span class=\"built_in\">this</span>.tilePre);</span><br><span class=\"line\">                    tile.getComponent(<span class=\"string\">&quot;Tile&quot;</span>).game = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">                    tile.width = (<span class=\"built_in\">this</span>.tileBg.width<span class=\"number\">-30</span>)/<span class=\"number\">5</span>;</span><br><span class=\"line\">                    tile.height = (<span class=\"built_in\">this</span>.tileBg.height<span class=\"number\">-30</span>)/<span class=\"number\">5</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> maxRandom = <span class=\"built_in\">this</span>.maxNum;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> randomNum = <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random()*maxRandom);</span><br><span class=\"line\">                    tile.getComponent(<span class=\"string\">&quot;Tile&quot;</span>).setNum(randomNum,<span class=\"literal\">false</span>,<span class=\"literal\">false</span>);</span><br><span class=\"line\">                    tile.getComponent(<span class=\"string\">&quot;Tile&quot;</span>).newTile(row,col);</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.tiles[row][col] = tile;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.tileBg.addChild(tile);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 0.5s后遍历执行逻辑</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scheduleOnce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> isSearch = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">5</span>; col++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">5</span>; row++) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(!isSearch)&#123;</span><br><span class=\"line\">                        isSearch = <span class=\"built_in\">this</span>.tiles[row][col]!=<span class=\"literal\">null</span>&amp;&amp;<span class=\"built_in\">this</span>.operateLogic(row,col,<span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.tiles[row][col].getComponent(<span class=\"string\">&quot;Tile&quot;</span>).numLabel.string),<span class=\"literal\">false</span>);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"number\">0.5</span>);        </span><br><span class=\"line\">     &#125;, <span class=\"number\">0.3</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p>最后的运行效果如下<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/addone.gif\" alt=\"点我+1效果图\"><br>通过CVP平台的项目托管可看到实际运行效果，地址如下：</p>\n<ul>\n<li>由于个人对Cocos Creator的适配还不大了解，在pc上运行时，需要使用chrome的手机调试预览（或者将chrome窗口调至手机屏幕大小），但是如果直接用手机打开，loadScene似乎又有不兼容的问题，至今无法理解，还请大神指点，而我无论是开发时的预览，还是通过xcode打包到我的iPhone6s Plus手机运行，都是完全没有问题。不知道是不是Creator的h5兼容还没有做好，又或者我哪里的技术没有掌握全面。<br><a href=\"http://www.cocoscvp.com/usercode/946fc5fd5d2c77331cc344ea1e4bfdd04630cf85/\">http://www.cocoscvp.com/usercode/946fc5fd5d2c77331cc344ea1e4bfdd04630cf85/</a></li>\n</ul>\n<h3 id=\"源代码\"><a href=\"#源代码\" class=\"headerlink\" title=\"源代码\"></a>源代码</h3><p>所有源代码均上传到github，欢迎交流学习，地址：<br><a href=\"https://github.com/hjcenry/addone\">https://github.com/hjcenry/addone</a></p>\n<ul>\n<li>原文博客：<a href=\"http://hjcenry.github.io/\">http://hjcenry.github.io</a></li>\n</ul>"},{"title":"Cocos2d-JS实现的2048","date":"2016-06-19T14:29:00.000Z","_content":"### 前言\n2048是之前火过一段时间的休闲数字消除类游戏，它的玩法很简单，上手很容易，可是想到要得到高分却很难，看似简单的游戏却有着很多得分的技巧，想当初这个游戏也曾是陪伴我大学课堂的游戏之一。<!--more-->虽然在得分上有着很多的技巧，但对于开发来说，这其实是一件相当容易的事情，仔细分析之后就可能大概理清楚这种消除游戏的逻辑。\n### 游戏分析\n这款游戏仔细想想就差不多清楚它的大致的思路，游戏中只有方块这一个我们操作的对象，这个对象包含了所在行，所在列，以及方块显示的数字三个属性，这三个属性足以表达游戏中的所有效果。除了方块，其他的就是游戏中必不可少的背景图层，开始及结束场景等。由于游戏中需要将4x4的方块们整齐排列，因此还需要一个四行四列的表格，来呈现我们的游戏效果。\n### 滑动逻辑\n游戏中最主要的操作就是通过手指触摸屏幕进行滑屏操作，带动场景中的方块整体移动，并且遇到相同数字的方块进行合并。滑动的逻辑就是遍历场景中所有的方块，每一个方块在滑动方向进行移动，如果前方没有方块，方块就一直滑动，如果前方有方块，判断自己的数字与这个方块的数字是否相同，相同进行合并操作，不相同则停在当前位置。\n### 游戏实现\n在对游戏逻辑进行了分析之后，就可以用代码进行实现了，编码，其实就是一个将游戏逻辑转换为机器语言的过程而已。\n#### 方块类\n首先，我们需要一个类来存储方块的长度和宽度，代码如下：\n```javascript\n// 保存方块长度方块\nvar tile = {\n    width: 0,\n    height: 0\n};\n```\n方块类是对场景中可操的方块的封装，包括所在行，所在列，显示数字三个属性，代码如下：\n```javascript\nvar Tiled = cc.Node.extend({\n    num: 0,\n    col: 0,\n    row: 0,\n    ctor: function (num) {\n        this._super();\n        return true;\n    }\n}\n```\n当然仅仅有以上三个属性是不够的，我们还需要在方块的构造函数中绘制方块的背景、绘制方块显示的数字、以及随机设定方块的行列坐标。\n```javascript\nvar Tiled = cc.Node.extend({\n    num: 0,\n    col: 0,\n    row: 0,\n    ctor: function (num) {\n        this._super();\n        this.num = num;\n        var count = 0;\n        while (true) {\n            count++;\n            this.row = Math.floor(Math.random() * 4);\n            this.col = Math.floor(Math.random() * 4);\n            if (tiles[this.row][this.col] == null) {\n                tiles[this.row][this.col] = this;\n                break;\n            }\n            if (count >= 16) {// 格子满了\n                return true;\n            }\n        }\n        // 绘制背景\n        var bg = new cc.DrawNode();\n        bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(255, 209, 145, 255), 1, cc.color(255, 209, 145, 255));\n        this.addChild(bg);\n        bg.setTag(2);\n        // 绘制数字\n        var labelNum = new cc.LabelTTF();\n        labelNum.setString(\"\" + this.num);\n        labelNum.setFontSize(60);\n        // 字体描边效果\n        // labelNum.enableStroke(cc.color.BLACK, 0);\n        this.addChild(labelNum);\n        labelNum.setTag(1);\n        // 设定字体和坐标\n        labelNum.setPosition(tile.width / 2, tile.height / 2);\n        // 移动块\n        this.newTile(this.row, this.col);\n        return true;\n    }\n}\n```\n除此之外，每个方块应该还要包含一个newTile方法、moveTo方法和updateNum方法，分别封装随机创建方块、移动方块和更新方块数字三个功能。\n在updateNum方法中，我们主要做两件事，更新方块显示数字和更新方块背景颜色（在方块的背景色上，我还专门上网搜了几种颜色搭配，恩，感觉很有艺术美，哈哈），代码如下：\n```javascript\nupdateNum: function () {\n    this.getChildByTag(1).setString(\"\" + this.num);\n    var bg = this.getChildByTag(2);\n    switch (this.num) {\n        case 2:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(235, 245, 223, 255), 1, cc.color(235, 245, 223, 255));\n            break;\n        case 4:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(186, 212, 170, 255), 1, cc.color(186, 212, 170, 255));\n            break;\n        case 8:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(212, 212, 170, 255), 1, cc.color(212, 212, 170, 255));\n            break;\n        case 16:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(193, 160, 117, 255), 1, cc.color(193, 160, 117, 255));\n            break;\n        case 32:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(124, 99, 84, 255), 1, cc.color(124, 99, 84, 255));\n            break;\n        case 64:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(218, 227, 224, 255), 1, cc.color(218, 227, 224, 255));\n            break;\n        case 128:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(64, 125, 148, 255), 1, cc.color(64, 125, 148, 255));\n            break;\n        case 256:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(123, 118, 135, 255), 1, cc.color(123, 118, 135, 255));\n            break;\n        case 512:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(172, 173, 172, 255), 1, cc.color(172, 173, 172, 255));\n            break;\n        case 1024:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(204, 196, 194, 255), 1, cc.color(204, 196, 194, 255));\n            break;\n        case 2048:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(199, 225, 240, 255), 1, cc.color(199, 225, 240, 255));\n            break;\n        case 4096:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(150, 196, 230, 255), 1, cc.color(150, 196, 230, 255));\n            break;\n        case 8192:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(25, 77, 91, 255), 1, cc.color(25, 77, 91, 255));\n            break;\n        case 16384:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(229, 96, 205, 255), 1, cc.color(229, 96, 205, 255));\n            break;\n        case 32768:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(250, 174, 78, 255), 1, cc.color(250, 174, 78, 255));\n            break;\n        case 65536:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(255, 241, 222, 255), 1, cc.color(255, 241, 222, 255));\n            break;\n        default:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(255, 209, 145, 255), 1, cc.color(255, 209, 145, 255));\n            break;\n    }\n}\n```\n方块的移动方法和创建方法，我在这里先写成一样，因为还没有对方块的创建和移动做区别，如果要做优化，可以在移动时加入移动的动画，在创建加入创建的动画，代码如下：\n```javascript\nmoveTo: function (row, col) {\n    this.row = row;\n    this.col = col;\n    this.setPositionX((cc.winSize.width - tile.width * 4) / 2 + tile.width * this.col);\n    this.setPositionY((cc.winSize.height - tile.height * 4) / 2 + tile.height * this.row);\n},\nnewTile: function (row, col) {\n    this.row = row;\n    this.col = col;\n    this.setPositionX((cc.winSize.width - tile.width * 4) / 2 + tile.width * this.col);\n    this.setPositionY((cc.winSize.height - tile.height * 4) / 2 + tile.height * this.row);\n}\n```\n#### 游戏场景类\n所有的游戏操作及操作反馈都在游戏场景类中进行，游戏场景类将封装好的方块类放到游戏逻辑中，通过玩家操作给予一定的操作反馈。游戏场景类中主要接受玩家的滑动操作，并在接收到滑动操作后将所有的方块类进行移动或合并。\n游戏场景类中需要isMove，startX，startY，以及tiles四个属性：第一个是控制玩家触摸操作的标识变量，避免重复调用移动方法；中间两个为记录玩家手指滑动的距离，当距离查过一定的长度之后，才判断玩家进行了滑动操作；最后一个变量是一个数组，用于存储在4x4的表格中的方块的信息。\n有了以上四个属性之后，就可以在构造函数中进行初始化了，代码如下：\n```javascript\nvar tiles = null;// 存储方块信息\nvar GameLayer = cc.Layer.extend({\n    isMove: false,\n    startX: 0,\n    startY: 0,\n    ctor: function () {\n        this._super();\n        this.isMove = false;\n        this.startX = 0;\n        this.startY = 0;\n        //设置块的宽高\n        if (cc.winSize.width < cc.winSize.height) {\n            // 竖屏\n            tile.width = cc.winSize.width / 5;\n            tile.height = cc.winSize.width / 5;\n        } else {\n            // 横屏\n            tile.width = cc.winSize.height / 5;\n            tile.height = cc.winSize.height / 5;\n        }\n        // 初始化数组\n        tiles = [\n            [null, null, null, null],\n            [null, null, null, null],\n            [null, null, null, null],\n            [null, null, null, null]\n        ];\n        return true;\n    }\n}\n```\n在初始化完之后，我们就可以在场景的onEnter方法中绘制场景了，绘制的内容包括游戏背景以及随机初始化两个方块，代码如下：\n```javascript\nonEnter: function () {\n    this._super();\n    // 绘制背景\n    this.drawBg();\n    // 绘制块\n    var tile1 = new Tiled(2);\n    var tile2 = new Tiled(2);\n    this.addChild(tile1);\n    this.addChild(tile2);\n    //处理事件\n    cc.eventManager.addListener({\n        event: cc.EventListener.TOUCH_ONE_BY_ONE,\n        swallowTouches: true,\n        onTouchBegan: this.touchbegan,\n        onTouchMoved: this.touchmoved\n    }, this);\n    return true;\n}\n```\n其中drawBg方法中，绘制了五条垂直直线以及五条水平直线，来作为方块所在的4x4的表格，代码如下：\n```javascript\ndrawBg: function () {\n    //绘制背景\n    var bgRect = new cc.DrawNode();\n    bgRect.drawRect(cc.p(0, 0), cc.p(cc.winSize.width, cc.winSize.height), cc.color(173, 140, 61, 255), 1, cc.color(173, 140, 61, 255));\n    this.addChild(bgRect);\n    var bg = new cc.DrawNode();\n    for (var n = 0; n < 5; n++) {\n        bg.drawSegment(cc.p((cc.winSize.width - tile.width * 4) / 2, (cc.winSize.height - tile.height * 4) / 2 + n * tile.width), cc.p(cc.winSize.width / 2 + tile.width * 2, (cc.winSize.height - tile.height * 4) / 2 + n * tile.width), 5,\n            cc.color(55, 62, 64, 255));\n        bg.drawSegment(cc.p((cc.winSize.width - tile.width * 4) / 2 + n * tile.width, (cc.winSize.height - tile.height * 4) / 2), cc.p((cc.winSize.width - tile.width * 4) / 2 + n * tile.width, (cc.winSize.height - tile.height * 4) / 2 + tile.width * 4), 5,\n            cc.color(55, 62, 64, 255));\n    }\n    this.addChild(bg);\n}\n```\n可以看到，在onEnter中，注册了触摸事件，这个触摸事件就用于接受玩家的操作，在TouchBegan事件中记录触摸开始时的点，在TouchMoved中记录当前移动到的点，当触摸距离超过一定长度时，判定玩家进行了滑动操作，并通过触摸点来判断玩家滑动的举例，代码如下：\n```javascript\ntouchbegan: function (touch, event) {\n    this.isMove = true;\n    this.startX = touch.getLocationX();\n    this.startY = touch.getLocationY();\n    return true;\n},\ntouchmoved: function (touch, event) {\n    if (!this.isMove) {\n        return;\n    }\n    var endX = touch.getLocation().x;\n    var endY = touch.getLocation().y;\n    if (Math.abs(endX - this.startX) > 20 ||\n        Math.abs(endY - this.startY) > 20) {\n        var dir = \"\";\n        if (Math.abs(endX - this.startX) > Math.abs(endY - this.startY)) {//左右\n            if (endX > this.startX) {\n                dir = \"right\";\n            } else {\n                dir = \"left\";\n            }\n        } else {\n            //上下\n            if (endY > this.startY) {\n                dir = \"up\";\n            } else {\n                dir = \"down\";\n            }\n        }\n        this.isMove = false;\n        event.getCurrentTarget().moveAllTiled(dir);\n    }\n    return true;\n},\nmoveAllTiled: function (dir) {\n    var isMoved = false;\n    switch (dir) {\n        case \"up\":\n            isMoved = this.moveUp();\n            break;\n        case \"down\":\n            isMoved = this.moveDown();\n            break;\n        case \"left\":\n            isMoved = this.moveLeft();\n            break;\n        case \"right\":\n            isMoved = this.moveRight();\n            break;\n    }\n    if (isMoved) {\n        //每次移动产生一个新块\n        this.newTiled();\n    }\n}\n```\n触动滑动操作后，开始执行滑动逻辑，每次滑动之后，会随机创建一个新的方块，在newTiled方法中，除了创建新方块之外，还需要判断游戏是否结束，代码如下：\n```javascript\nnewTiled: function () {\n    var tile = new Tiled(2);\n    this.addChild(tile);\n    // 判断游戏是否结束\n    var isOver = true;\n    // 判断是否有空余位置\n    for (var row = 0; row < 4; row++) {\n        for (var col = 0; col < 4; col++) {\n            if (tiles[row][col] == null) {\n                isOver = false;\n            }\n        }\n    }\n    if (isOver) {\n        // 判断四周是否有数字相同方块\n        for (var row = 0; row < 4; row++) {\n            for (var col = 0; col < 4; col++) {\n                if (row < 3 && tiles[row + 1][col].num == tiles[row][col].num) {\n                    isOver = false;\n                }\n                if (row > 0 && tiles[row - 1][col].num == tiles[row][col].num) {\n                    isOver = false;\n                }\n                if (col < 3 && tiles[row][col + 1].num == tiles[row][col].num) {\n                    isOver = false;\n                }\n                if (col > 0 && tiles[row][col - 1].num == tiles[row][col].num) {\n                    isOver = false;\n                }\n            }\n        }\n    }\n    if (isOver) {\n        cc.director.runScene(new cc.TransitionFade(1, new OverScene()));\n    }\n}\n```\n方块的滑动，就是2048这款游戏最主要的逻辑了，我们在滑动的时候，需要遍历tiles数组所有不是null的元素，并将这个元素按照滑动方向进行移动，一直遍历到数组的最大长度，也就是将滑动到表格的边缘，如果中途遇到了方块，并且数字与自己相同，就进行合并，合并是将自己删除，将遇到的方块数字乘以2，如果中途遇到的方块的数字与自己不同，此方块的滑动就停止，使其停在当前的位置，滑动分为上下左右四个逻辑，代码分别如下：\n```javascript\nmoveUp: function () {\n    var isMoved = false;\n    for (var col = 0; col < 4; col++) {\n        for (var row = 3; row >= 0; row--) {\n            if (tiles[row][col] != null) {// 有方块\n                for (var row1 = row; row1 < 3; row1++) {\n                    if (tiles[row1 + 1][col] == null)//如果没有向上移动\n                    {\n                        tiles[row1 + 1][col] = tiles[row1][col];\n                        tiles[row1][col] = null;\n                        tiles[row1 + 1][col].moveTo(row1 + 1, col);\n                        isMoved = true;\n                    } else if (tiles[row1 + 1][col].num == tiles[row1][col].num) {// 合并\n                        tiles[row1 + 1][col].num = parseInt(tiles[row1][col].num) * 2;\n                        tiles[row1 + 1][col].updateNum();\n                        tiles[row1][col].removeFromParent();\n                        tiles[row1][col] = null;\n                        isMoved = true;\n                        break;\n                    }\n                }\n            }\n        }\n    }\n    return isMoved;\n},\nmoveDown: function () {\n    var isMoved = false;\n    for (var col = 0; col < 4; col++) {\n        for (var row = 0; row < 4; row++) {\n            if (tiles[row][col] != null) {// 有方块\n                for (var row1 = row; row1 > 0; row1--) {\n                    if (tiles[row1 - 1][col] == null)//如果没有向下移动\n                    {\n                        tiles[row1 - 1][col] = tiles[row1][col];\n                        tiles[row1][col] = null;\n                        tiles[row1 - 1][col].moveTo(row1 - 1, col);\n                        isMoved = true;\n                    } else if (tiles[row1 - 1][col].num == tiles[row1][col].num) {// 合并\n                        tiles[row1 - 1][col].num = parseInt(tiles[row1][col].num) * 2;\n                        tiles[row1 - 1][col].updateNum();\n                        tiles[row1][col].removeFromParent();\n                        tiles[row1][col] = null;\n                        isMoved = true;\n                        break;\n                    }\n                }\n            }\n        }\n    }\n    return isMoved;\n},\nmoveLeft: function () {\n    var isMoved = false;\n    for (var row = 0; row < 4; row++) {\n        for (var col = 0; col < 4; col++) {\n            if (tiles[row][col] != null) {\n                for (var col1 = col; col1 > 0; col1--) {\n                    if (tiles[row][col1 - 1] == null) {\n                        tiles[row][col1 - 1] = tiles[row][col1];\n                        tiles[row][col1] = null;\n                        tiles[row][col1 - 1].moveTo(row, col1 - 1);\n                        isMoved = true;\n                    } else if (tiles[row][col1 - 1].num == tiles[row][col1].num) {// 合并\n                        tiles[row][col1 - 1].num = parseInt(tiles[row][col1].num) * 2;\n                        tiles[row][col1 - 1].updateNum();\n                        tiles[row][col1].removeFromParent();\n                        tiles[row][col1] = null;\n                        isMoved = true;\n                        break;\n                    }\n                }\n            }\n        }\n    }\n    return isMoved;\n},\nmoveRight: function () {\n    var isMoved = false;\n    for (var row = 0; row < 4; row++) {\n        for (var col = 3; col >= 0; col--) {\n            if (tiles[row][col] != null) {\n                for (var col1 = col; col1 < 3; col1++) {\n                    if (tiles[row][col1 + 1] == null) {\n                        tiles[row][col1 + 1] = tiles[row][col1];\n                        tiles[row][col1] = null;\n                        tiles[row][col1 + 1].moveTo(row, col1 + 1);\n                        isMoved = true;\n                    } else if (tiles[row][col1 + 1].num == tiles[row][col1].num) {// 合并\n                        tiles[row][col1 + 1].num = parseInt(tiles[row][col1].num) * 2;\n                        tiles[row][col1 + 1].updateNum();\n                        tiles[row][col1].removeFromParent();\n                        tiles[row][col1] = null;\n                        isMoved = true;\n                        break;\n                    }\n                }\n            }\n        }\n    }\n    return isMoved;\n}\n```\n至此，我们就基本实现了2048游戏的主要逻辑。\n#### 开始/结束场景类\n为了游戏框架的完整，我们还是创建一个开始场景类和结束场景类，代码分别如下：\n开始场景类\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n\n        /////////////////////////////\n        // 2. add a menu item with \"X\" image, which is clicked to quit the program\n        //    you may modify it.\n        // ask the window size\n        var size = cc.winSize;\n\n        /////////////////////////////\n        // 3. add your codes below...\n        // add a label shows \"Hello World\"\n        // create and initialize a label\n        var helloLabel = new cc.LabelTTF(\"2048\", \"Arial\", 38);\n        // position the label on the center of the screen\n        helloLabel.x = size.width / 2;\n        helloLabel.y = size.height / 2 + 200;\n        // add the label as a child to this layer\n        this.addChild(helloLabel, 5);\n\n        // add \"HelloWorld\" splash screen\"\n        // this.sprite = new cc.Sprite(res.HelloWorld_png);\n        // this.sprite.attr({\n        //     x: size.width / 2,\n        //     y: size.height / 2\n        // });\n        // this.addChild(this.sprite, 0);\n\n        var start = new cc.MenuItemFont(\"开始游戏\",function(){\n            cc.director.runScene(new cc.TransitionFade(1,new GameScene()));\n        });\n        var menu = new cc.Menu(start);\n        this.addChild(menu);\n        return true;\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n结束场景类\n```javascript\n/**\n * Created by Henry on 16/6/19.\n */\nvar OverLayer = cc.Layer.extend({\n    ctor: function () {\n        this._super();\n        var overText = new cc.LabelTTF(\"Game Over\", \"\", 50);\n        overText.setPosition(cc.winSize.width / 2, cc.winSize.height / 2);\n        var back = new cc.MenuItemFont(\"再来一次\", function () {\n            cc.director.runScene(new cc.TransitionFade(1, new HelloWorldScene()));\n        }, this);\n        var menu = new cc.Menu(back);\n        this.addChild(menu);\n        return true;\n    }\n});\n\nvar OverScene = cc.Scene.extend({\n    ctor: function () {\n        this._super();\n        var layer = new OverLayer();\n        this.addChild(layer);\n        return true;\n    }\n});\n```\n### 运行效果\n最后的运行效果如下\n![2048效果图](http://7xnnwn.com1.z0.glb.clouddn.com/2048.gif)\n通过CVP平台的项目托管可看到实际运行效果，地址如下：\nhttp://www.cocoscvp.com/usercode/ea72822aeed0546b537b4226954a11be87a7f152/\n### 源代码\n所有源代码均上传到github，欢迎交流学习，地址：\nhttps://github.com/hjcenry/2048\n\n- 原文博客：http://hjcenry.github.io","source":"_posts/Cocos2d-JS实现的2048.md","raw":"---\ntitle: Cocos2d-JS实现的2048\ndate: 2016-06-19 22:29\ncategories: cocos2d-js\ntags: [cocos2d-js,2048,cvp]\n---\n### 前言\n2048是之前火过一段时间的休闲数字消除类游戏，它的玩法很简单，上手很容易，可是想到要得到高分却很难，看似简单的游戏却有着很多得分的技巧，想当初这个游戏也曾是陪伴我大学课堂的游戏之一。<!--more-->虽然在得分上有着很多的技巧，但对于开发来说，这其实是一件相当容易的事情，仔细分析之后就可能大概理清楚这种消除游戏的逻辑。\n### 游戏分析\n这款游戏仔细想想就差不多清楚它的大致的思路，游戏中只有方块这一个我们操作的对象，这个对象包含了所在行，所在列，以及方块显示的数字三个属性，这三个属性足以表达游戏中的所有效果。除了方块，其他的就是游戏中必不可少的背景图层，开始及结束场景等。由于游戏中需要将4x4的方块们整齐排列，因此还需要一个四行四列的表格，来呈现我们的游戏效果。\n### 滑动逻辑\n游戏中最主要的操作就是通过手指触摸屏幕进行滑屏操作，带动场景中的方块整体移动，并且遇到相同数字的方块进行合并。滑动的逻辑就是遍历场景中所有的方块，每一个方块在滑动方向进行移动，如果前方没有方块，方块就一直滑动，如果前方有方块，判断自己的数字与这个方块的数字是否相同，相同进行合并操作，不相同则停在当前位置。\n### 游戏实现\n在对游戏逻辑进行了分析之后，就可以用代码进行实现了，编码，其实就是一个将游戏逻辑转换为机器语言的过程而已。\n#### 方块类\n首先，我们需要一个类来存储方块的长度和宽度，代码如下：\n```javascript\n// 保存方块长度方块\nvar tile = {\n    width: 0,\n    height: 0\n};\n```\n方块类是对场景中可操的方块的封装，包括所在行，所在列，显示数字三个属性，代码如下：\n```javascript\nvar Tiled = cc.Node.extend({\n    num: 0,\n    col: 0,\n    row: 0,\n    ctor: function (num) {\n        this._super();\n        return true;\n    }\n}\n```\n当然仅仅有以上三个属性是不够的，我们还需要在方块的构造函数中绘制方块的背景、绘制方块显示的数字、以及随机设定方块的行列坐标。\n```javascript\nvar Tiled = cc.Node.extend({\n    num: 0,\n    col: 0,\n    row: 0,\n    ctor: function (num) {\n        this._super();\n        this.num = num;\n        var count = 0;\n        while (true) {\n            count++;\n            this.row = Math.floor(Math.random() * 4);\n            this.col = Math.floor(Math.random() * 4);\n            if (tiles[this.row][this.col] == null) {\n                tiles[this.row][this.col] = this;\n                break;\n            }\n            if (count >= 16) {// 格子满了\n                return true;\n            }\n        }\n        // 绘制背景\n        var bg = new cc.DrawNode();\n        bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(255, 209, 145, 255), 1, cc.color(255, 209, 145, 255));\n        this.addChild(bg);\n        bg.setTag(2);\n        // 绘制数字\n        var labelNum = new cc.LabelTTF();\n        labelNum.setString(\"\" + this.num);\n        labelNum.setFontSize(60);\n        // 字体描边效果\n        // labelNum.enableStroke(cc.color.BLACK, 0);\n        this.addChild(labelNum);\n        labelNum.setTag(1);\n        // 设定字体和坐标\n        labelNum.setPosition(tile.width / 2, tile.height / 2);\n        // 移动块\n        this.newTile(this.row, this.col);\n        return true;\n    }\n}\n```\n除此之外，每个方块应该还要包含一个newTile方法、moveTo方法和updateNum方法，分别封装随机创建方块、移动方块和更新方块数字三个功能。\n在updateNum方法中，我们主要做两件事，更新方块显示数字和更新方块背景颜色（在方块的背景色上，我还专门上网搜了几种颜色搭配，恩，感觉很有艺术美，哈哈），代码如下：\n```javascript\nupdateNum: function () {\n    this.getChildByTag(1).setString(\"\" + this.num);\n    var bg = this.getChildByTag(2);\n    switch (this.num) {\n        case 2:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(235, 245, 223, 255), 1, cc.color(235, 245, 223, 255));\n            break;\n        case 4:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(186, 212, 170, 255), 1, cc.color(186, 212, 170, 255));\n            break;\n        case 8:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(212, 212, 170, 255), 1, cc.color(212, 212, 170, 255));\n            break;\n        case 16:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(193, 160, 117, 255), 1, cc.color(193, 160, 117, 255));\n            break;\n        case 32:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(124, 99, 84, 255), 1, cc.color(124, 99, 84, 255));\n            break;\n        case 64:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(218, 227, 224, 255), 1, cc.color(218, 227, 224, 255));\n            break;\n        case 128:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(64, 125, 148, 255), 1, cc.color(64, 125, 148, 255));\n            break;\n        case 256:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(123, 118, 135, 255), 1, cc.color(123, 118, 135, 255));\n            break;\n        case 512:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(172, 173, 172, 255), 1, cc.color(172, 173, 172, 255));\n            break;\n        case 1024:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(204, 196, 194, 255), 1, cc.color(204, 196, 194, 255));\n            break;\n        case 2048:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(199, 225, 240, 255), 1, cc.color(199, 225, 240, 255));\n            break;\n        case 4096:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(150, 196, 230, 255), 1, cc.color(150, 196, 230, 255));\n            break;\n        case 8192:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(25, 77, 91, 255), 1, cc.color(25, 77, 91, 255));\n            break;\n        case 16384:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(229, 96, 205, 255), 1, cc.color(229, 96, 205, 255));\n            break;\n        case 32768:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(250, 174, 78, 255), 1, cc.color(250, 174, 78, 255));\n            break;\n        case 65536:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(255, 241, 222, 255), 1, cc.color(255, 241, 222, 255));\n            break;\n        default:\n            bg.drawRect(cc.p(5, 5), cc.p(tile.width - 5, tile.height - 5), cc.color(255, 209, 145, 255), 1, cc.color(255, 209, 145, 255));\n            break;\n    }\n}\n```\n方块的移动方法和创建方法，我在这里先写成一样，因为还没有对方块的创建和移动做区别，如果要做优化，可以在移动时加入移动的动画，在创建加入创建的动画，代码如下：\n```javascript\nmoveTo: function (row, col) {\n    this.row = row;\n    this.col = col;\n    this.setPositionX((cc.winSize.width - tile.width * 4) / 2 + tile.width * this.col);\n    this.setPositionY((cc.winSize.height - tile.height * 4) / 2 + tile.height * this.row);\n},\nnewTile: function (row, col) {\n    this.row = row;\n    this.col = col;\n    this.setPositionX((cc.winSize.width - tile.width * 4) / 2 + tile.width * this.col);\n    this.setPositionY((cc.winSize.height - tile.height * 4) / 2 + tile.height * this.row);\n}\n```\n#### 游戏场景类\n所有的游戏操作及操作反馈都在游戏场景类中进行，游戏场景类将封装好的方块类放到游戏逻辑中，通过玩家操作给予一定的操作反馈。游戏场景类中主要接受玩家的滑动操作，并在接收到滑动操作后将所有的方块类进行移动或合并。\n游戏场景类中需要isMove，startX，startY，以及tiles四个属性：第一个是控制玩家触摸操作的标识变量，避免重复调用移动方法；中间两个为记录玩家手指滑动的距离，当距离查过一定的长度之后，才判断玩家进行了滑动操作；最后一个变量是一个数组，用于存储在4x4的表格中的方块的信息。\n有了以上四个属性之后，就可以在构造函数中进行初始化了，代码如下：\n```javascript\nvar tiles = null;// 存储方块信息\nvar GameLayer = cc.Layer.extend({\n    isMove: false,\n    startX: 0,\n    startY: 0,\n    ctor: function () {\n        this._super();\n        this.isMove = false;\n        this.startX = 0;\n        this.startY = 0;\n        //设置块的宽高\n        if (cc.winSize.width < cc.winSize.height) {\n            // 竖屏\n            tile.width = cc.winSize.width / 5;\n            tile.height = cc.winSize.width / 5;\n        } else {\n            // 横屏\n            tile.width = cc.winSize.height / 5;\n            tile.height = cc.winSize.height / 5;\n        }\n        // 初始化数组\n        tiles = [\n            [null, null, null, null],\n            [null, null, null, null],\n            [null, null, null, null],\n            [null, null, null, null]\n        ];\n        return true;\n    }\n}\n```\n在初始化完之后，我们就可以在场景的onEnter方法中绘制场景了，绘制的内容包括游戏背景以及随机初始化两个方块，代码如下：\n```javascript\nonEnter: function () {\n    this._super();\n    // 绘制背景\n    this.drawBg();\n    // 绘制块\n    var tile1 = new Tiled(2);\n    var tile2 = new Tiled(2);\n    this.addChild(tile1);\n    this.addChild(tile2);\n    //处理事件\n    cc.eventManager.addListener({\n        event: cc.EventListener.TOUCH_ONE_BY_ONE,\n        swallowTouches: true,\n        onTouchBegan: this.touchbegan,\n        onTouchMoved: this.touchmoved\n    }, this);\n    return true;\n}\n```\n其中drawBg方法中，绘制了五条垂直直线以及五条水平直线，来作为方块所在的4x4的表格，代码如下：\n```javascript\ndrawBg: function () {\n    //绘制背景\n    var bgRect = new cc.DrawNode();\n    bgRect.drawRect(cc.p(0, 0), cc.p(cc.winSize.width, cc.winSize.height), cc.color(173, 140, 61, 255), 1, cc.color(173, 140, 61, 255));\n    this.addChild(bgRect);\n    var bg = new cc.DrawNode();\n    for (var n = 0; n < 5; n++) {\n        bg.drawSegment(cc.p((cc.winSize.width - tile.width * 4) / 2, (cc.winSize.height - tile.height * 4) / 2 + n * tile.width), cc.p(cc.winSize.width / 2 + tile.width * 2, (cc.winSize.height - tile.height * 4) / 2 + n * tile.width), 5,\n            cc.color(55, 62, 64, 255));\n        bg.drawSegment(cc.p((cc.winSize.width - tile.width * 4) / 2 + n * tile.width, (cc.winSize.height - tile.height * 4) / 2), cc.p((cc.winSize.width - tile.width * 4) / 2 + n * tile.width, (cc.winSize.height - tile.height * 4) / 2 + tile.width * 4), 5,\n            cc.color(55, 62, 64, 255));\n    }\n    this.addChild(bg);\n}\n```\n可以看到，在onEnter中，注册了触摸事件，这个触摸事件就用于接受玩家的操作，在TouchBegan事件中记录触摸开始时的点，在TouchMoved中记录当前移动到的点，当触摸距离超过一定长度时，判定玩家进行了滑动操作，并通过触摸点来判断玩家滑动的举例，代码如下：\n```javascript\ntouchbegan: function (touch, event) {\n    this.isMove = true;\n    this.startX = touch.getLocationX();\n    this.startY = touch.getLocationY();\n    return true;\n},\ntouchmoved: function (touch, event) {\n    if (!this.isMove) {\n        return;\n    }\n    var endX = touch.getLocation().x;\n    var endY = touch.getLocation().y;\n    if (Math.abs(endX - this.startX) > 20 ||\n        Math.abs(endY - this.startY) > 20) {\n        var dir = \"\";\n        if (Math.abs(endX - this.startX) > Math.abs(endY - this.startY)) {//左右\n            if (endX > this.startX) {\n                dir = \"right\";\n            } else {\n                dir = \"left\";\n            }\n        } else {\n            //上下\n            if (endY > this.startY) {\n                dir = \"up\";\n            } else {\n                dir = \"down\";\n            }\n        }\n        this.isMove = false;\n        event.getCurrentTarget().moveAllTiled(dir);\n    }\n    return true;\n},\nmoveAllTiled: function (dir) {\n    var isMoved = false;\n    switch (dir) {\n        case \"up\":\n            isMoved = this.moveUp();\n            break;\n        case \"down\":\n            isMoved = this.moveDown();\n            break;\n        case \"left\":\n            isMoved = this.moveLeft();\n            break;\n        case \"right\":\n            isMoved = this.moveRight();\n            break;\n    }\n    if (isMoved) {\n        //每次移动产生一个新块\n        this.newTiled();\n    }\n}\n```\n触动滑动操作后，开始执行滑动逻辑，每次滑动之后，会随机创建一个新的方块，在newTiled方法中，除了创建新方块之外，还需要判断游戏是否结束，代码如下：\n```javascript\nnewTiled: function () {\n    var tile = new Tiled(2);\n    this.addChild(tile);\n    // 判断游戏是否结束\n    var isOver = true;\n    // 判断是否有空余位置\n    for (var row = 0; row < 4; row++) {\n        for (var col = 0; col < 4; col++) {\n            if (tiles[row][col] == null) {\n                isOver = false;\n            }\n        }\n    }\n    if (isOver) {\n        // 判断四周是否有数字相同方块\n        for (var row = 0; row < 4; row++) {\n            for (var col = 0; col < 4; col++) {\n                if (row < 3 && tiles[row + 1][col].num == tiles[row][col].num) {\n                    isOver = false;\n                }\n                if (row > 0 && tiles[row - 1][col].num == tiles[row][col].num) {\n                    isOver = false;\n                }\n                if (col < 3 && tiles[row][col + 1].num == tiles[row][col].num) {\n                    isOver = false;\n                }\n                if (col > 0 && tiles[row][col - 1].num == tiles[row][col].num) {\n                    isOver = false;\n                }\n            }\n        }\n    }\n    if (isOver) {\n        cc.director.runScene(new cc.TransitionFade(1, new OverScene()));\n    }\n}\n```\n方块的滑动，就是2048这款游戏最主要的逻辑了，我们在滑动的时候，需要遍历tiles数组所有不是null的元素，并将这个元素按照滑动方向进行移动，一直遍历到数组的最大长度，也就是将滑动到表格的边缘，如果中途遇到了方块，并且数字与自己相同，就进行合并，合并是将自己删除，将遇到的方块数字乘以2，如果中途遇到的方块的数字与自己不同，此方块的滑动就停止，使其停在当前的位置，滑动分为上下左右四个逻辑，代码分别如下：\n```javascript\nmoveUp: function () {\n    var isMoved = false;\n    for (var col = 0; col < 4; col++) {\n        for (var row = 3; row >= 0; row--) {\n            if (tiles[row][col] != null) {// 有方块\n                for (var row1 = row; row1 < 3; row1++) {\n                    if (tiles[row1 + 1][col] == null)//如果没有向上移动\n                    {\n                        tiles[row1 + 1][col] = tiles[row1][col];\n                        tiles[row1][col] = null;\n                        tiles[row1 + 1][col].moveTo(row1 + 1, col);\n                        isMoved = true;\n                    } else if (tiles[row1 + 1][col].num == tiles[row1][col].num) {// 合并\n                        tiles[row1 + 1][col].num = parseInt(tiles[row1][col].num) * 2;\n                        tiles[row1 + 1][col].updateNum();\n                        tiles[row1][col].removeFromParent();\n                        tiles[row1][col] = null;\n                        isMoved = true;\n                        break;\n                    }\n                }\n            }\n        }\n    }\n    return isMoved;\n},\nmoveDown: function () {\n    var isMoved = false;\n    for (var col = 0; col < 4; col++) {\n        for (var row = 0; row < 4; row++) {\n            if (tiles[row][col] != null) {// 有方块\n                for (var row1 = row; row1 > 0; row1--) {\n                    if (tiles[row1 - 1][col] == null)//如果没有向下移动\n                    {\n                        tiles[row1 - 1][col] = tiles[row1][col];\n                        tiles[row1][col] = null;\n                        tiles[row1 - 1][col].moveTo(row1 - 1, col);\n                        isMoved = true;\n                    } else if (tiles[row1 - 1][col].num == tiles[row1][col].num) {// 合并\n                        tiles[row1 - 1][col].num = parseInt(tiles[row1][col].num) * 2;\n                        tiles[row1 - 1][col].updateNum();\n                        tiles[row1][col].removeFromParent();\n                        tiles[row1][col] = null;\n                        isMoved = true;\n                        break;\n                    }\n                }\n            }\n        }\n    }\n    return isMoved;\n},\nmoveLeft: function () {\n    var isMoved = false;\n    for (var row = 0; row < 4; row++) {\n        for (var col = 0; col < 4; col++) {\n            if (tiles[row][col] != null) {\n                for (var col1 = col; col1 > 0; col1--) {\n                    if (tiles[row][col1 - 1] == null) {\n                        tiles[row][col1 - 1] = tiles[row][col1];\n                        tiles[row][col1] = null;\n                        tiles[row][col1 - 1].moveTo(row, col1 - 1);\n                        isMoved = true;\n                    } else if (tiles[row][col1 - 1].num == tiles[row][col1].num) {// 合并\n                        tiles[row][col1 - 1].num = parseInt(tiles[row][col1].num) * 2;\n                        tiles[row][col1 - 1].updateNum();\n                        tiles[row][col1].removeFromParent();\n                        tiles[row][col1] = null;\n                        isMoved = true;\n                        break;\n                    }\n                }\n            }\n        }\n    }\n    return isMoved;\n},\nmoveRight: function () {\n    var isMoved = false;\n    for (var row = 0; row < 4; row++) {\n        for (var col = 3; col >= 0; col--) {\n            if (tiles[row][col] != null) {\n                for (var col1 = col; col1 < 3; col1++) {\n                    if (tiles[row][col1 + 1] == null) {\n                        tiles[row][col1 + 1] = tiles[row][col1];\n                        tiles[row][col1] = null;\n                        tiles[row][col1 + 1].moveTo(row, col1 + 1);\n                        isMoved = true;\n                    } else if (tiles[row][col1 + 1].num == tiles[row][col1].num) {// 合并\n                        tiles[row][col1 + 1].num = parseInt(tiles[row][col1].num) * 2;\n                        tiles[row][col1 + 1].updateNum();\n                        tiles[row][col1].removeFromParent();\n                        tiles[row][col1] = null;\n                        isMoved = true;\n                        break;\n                    }\n                }\n            }\n        }\n    }\n    return isMoved;\n}\n```\n至此，我们就基本实现了2048游戏的主要逻辑。\n#### 开始/结束场景类\n为了游戏框架的完整，我们还是创建一个开始场景类和结束场景类，代码分别如下：\n开始场景类\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite:null,\n    ctor:function () {\n        //////////////////////////////\n        // 1. super init first\n        this._super();\n\n        /////////////////////////////\n        // 2. add a menu item with \"X\" image, which is clicked to quit the program\n        //    you may modify it.\n        // ask the window size\n        var size = cc.winSize;\n\n        /////////////////////////////\n        // 3. add your codes below...\n        // add a label shows \"Hello World\"\n        // create and initialize a label\n        var helloLabel = new cc.LabelTTF(\"2048\", \"Arial\", 38);\n        // position the label on the center of the screen\n        helloLabel.x = size.width / 2;\n        helloLabel.y = size.height / 2 + 200;\n        // add the label as a child to this layer\n        this.addChild(helloLabel, 5);\n\n        // add \"HelloWorld\" splash screen\"\n        // this.sprite = new cc.Sprite(res.HelloWorld_png);\n        // this.sprite.attr({\n        //     x: size.width / 2,\n        //     y: size.height / 2\n        // });\n        // this.addChild(this.sprite, 0);\n\n        var start = new cc.MenuItemFont(\"开始游戏\",function(){\n            cc.director.runScene(new cc.TransitionFade(1,new GameScene()));\n        });\n        var menu = new cc.Menu(start);\n        this.addChild(menu);\n        return true;\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n结束场景类\n```javascript\n/**\n * Created by Henry on 16/6/19.\n */\nvar OverLayer = cc.Layer.extend({\n    ctor: function () {\n        this._super();\n        var overText = new cc.LabelTTF(\"Game Over\", \"\", 50);\n        overText.setPosition(cc.winSize.width / 2, cc.winSize.height / 2);\n        var back = new cc.MenuItemFont(\"再来一次\", function () {\n            cc.director.runScene(new cc.TransitionFade(1, new HelloWorldScene()));\n        }, this);\n        var menu = new cc.Menu(back);\n        this.addChild(menu);\n        return true;\n    }\n});\n\nvar OverScene = cc.Scene.extend({\n    ctor: function () {\n        this._super();\n        var layer = new OverLayer();\n        this.addChild(layer);\n        return true;\n    }\n});\n```\n### 运行效果\n最后的运行效果如下\n![2048效果图](http://7xnnwn.com1.z0.glb.clouddn.com/2048.gif)\n通过CVP平台的项目托管可看到实际运行效果，地址如下：\nhttp://www.cocoscvp.com/usercode/ea72822aeed0546b537b4226954a11be87a7f152/\n### 源代码\n所有源代码均上传到github，欢迎交流学习，地址：\nhttps://github.com/hjcenry/2048\n\n- 原文博客：http://hjcenry.github.io","slug":"Cocos2d-JS实现的2048","published":1,"updated":"2016-06-19T14:58:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhvq004wwsaz3bgw4f0j","content":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>2048是之前火过一段时间的休闲数字消除类游戏，它的玩法很简单，上手很容易，可是想到要得到高分却很难，看似简单的游戏却有着很多得分的技巧，想当初这个游戏也曾是陪伴我大学课堂的游戏之一。<a id=\"more\"></a>虽然在得分上有着很多的技巧，但对于开发来说，这其实是一件相当容易的事情，仔细分析之后就可能大概理清楚这种消除游戏的逻辑。</p>\n<h3 id=\"游戏分析\"><a href=\"#游戏分析\" class=\"headerlink\" title=\"游戏分析\"></a>游戏分析</h3><p>这款游戏仔细想想就差不多清楚它的大致的思路，游戏中只有方块这一个我们操作的对象，这个对象包含了所在行，所在列，以及方块显示的数字三个属性，这三个属性足以表达游戏中的所有效果。除了方块，其他的就是游戏中必不可少的背景图层，开始及结束场景等。由于游戏中需要将4x4的方块们整齐排列，因此还需要一个四行四列的表格，来呈现我们的游戏效果。</p>\n<h3 id=\"滑动逻辑\"><a href=\"#滑动逻辑\" class=\"headerlink\" title=\"滑动逻辑\"></a>滑动逻辑</h3><p>游戏中最主要的操作就是通过手指触摸屏幕进行滑屏操作，带动场景中的方块整体移动，并且遇到相同数字的方块进行合并。滑动的逻辑就是遍历场景中所有的方块，每一个方块在滑动方向进行移动，如果前方没有方块，方块就一直滑动，如果前方有方块，判断自己的数字与这个方块的数字是否相同，相同进行合并操作，不相同则停在当前位置。</p>\n<h3 id=\"游戏实现\"><a href=\"#游戏实现\" class=\"headerlink\" title=\"游戏实现\"></a>游戏实现</h3><p>在对游戏逻辑进行了分析之后，就可以用代码进行实现了，编码，其实就是一个将游戏逻辑转换为机器语言的过程而已。</p>\n<h4 id=\"方块类\"><a href=\"#方块类\" class=\"headerlink\" title=\"方块类\"></a>方块类</h4><p>首先，我们需要一个类来存储方块的长度和宽度，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 保存方块长度方块</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> tile = &#123;</span><br><span class=\"line\">    width: <span class=\"number\">0</span>,</span><br><span class=\"line\">    height: <span class=\"number\">0</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>方块类是对场景中可操的方块的封装，包括所在行，所在列，显示数字三个属性，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Tiled = cc.Node.extend(&#123;</span><br><span class=\"line\">    num: <span class=\"number\">0</span>,</span><br><span class=\"line\">    col: <span class=\"number\">0</span>,</span><br><span class=\"line\">    row: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>当然仅仅有以上三个属性是不够的，我们还需要在方块的构造函数中绘制方块的背景、绘制方块显示的数字、以及随机设定方块的行列坐标。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Tiled = cc.Node.extend(&#123;</span><br><span class=\"line\">    num: <span class=\"number\">0</span>,</span><br><span class=\"line\">    col: <span class=\"number\">0</span>,</span><br><span class=\"line\">    row: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.num = num;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">            count++;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.row = <span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">4</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.col = <span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">4</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tiles[<span class=\"built_in\">this</span>.row][<span class=\"built_in\">this</span>.col] == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                tiles[<span class=\"built_in\">this</span>.row][<span class=\"built_in\">this</span>.col] = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (count &gt;= <span class=\"number\">16</span>) &#123;<span class=\"comment\">// 格子满了</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 绘制背景</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\">        bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">255</span>, <span class=\"number\">209</span>, <span class=\"number\">145</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">255</span>, <span class=\"number\">209</span>, <span class=\"number\">145</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        bg.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 绘制数字</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> labelNum = <span class=\"keyword\">new</span> cc.LabelTTF();</span><br><span class=\"line\">        labelNum.setString(<span class=\"string\">&quot;&quot;</span> + <span class=\"built_in\">this</span>.num);</span><br><span class=\"line\">        labelNum.setFontSize(<span class=\"number\">60</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 字体描边效果</span></span><br><span class=\"line\">        <span class=\"comment\">// labelNum.enableStroke(cc.color.BLACK, 0);</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(labelNum);</span><br><span class=\"line\">        labelNum.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 设定字体和坐标</span></span><br><span class=\"line\">        labelNum.setPosition(tile.width / <span class=\"number\">2</span>, tile.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 移动块</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.newTile(<span class=\"built_in\">this</span>.row, <span class=\"built_in\">this</span>.col);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>除此之外，每个方块应该还要包含一个newTile方法、moveTo方法和updateNum方法，分别封装随机创建方块、移动方块和更新方块数字三个功能。<br>在updateNum方法中，我们主要做两件事，更新方块显示数字和更新方块背景颜色（在方块的背景色上，我还专门上网搜了几种颜色搭配，恩，感觉很有艺术美，哈哈），代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">updateNum: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).setString(<span class=\"string\">&quot;&quot;</span> + <span class=\"built_in\">this</span>.num);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> bg = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (<span class=\"built_in\">this</span>.num) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">235</span>, <span class=\"number\">245</span>, <span class=\"number\">223</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">235</span>, <span class=\"number\">245</span>, <span class=\"number\">223</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">186</span>, <span class=\"number\">212</span>, <span class=\"number\">170</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">186</span>, <span class=\"number\">212</span>, <span class=\"number\">170</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">212</span>, <span class=\"number\">212</span>, <span class=\"number\">170</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">212</span>, <span class=\"number\">212</span>, <span class=\"number\">170</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">16</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">193</span>, <span class=\"number\">160</span>, <span class=\"number\">117</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">193</span>, <span class=\"number\">160</span>, <span class=\"number\">117</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">32</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">124</span>, <span class=\"number\">99</span>, <span class=\"number\">84</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">124</span>, <span class=\"number\">99</span>, <span class=\"number\">84</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">64</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">218</span>, <span class=\"number\">227</span>, <span class=\"number\">224</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">218</span>, <span class=\"number\">227</span>, <span class=\"number\">224</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">128</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">64</span>, <span class=\"number\">125</span>, <span class=\"number\">148</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">64</span>, <span class=\"number\">125</span>, <span class=\"number\">148</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">256</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">123</span>, <span class=\"number\">118</span>, <span class=\"number\">135</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">123</span>, <span class=\"number\">118</span>, <span class=\"number\">135</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">512</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">172</span>, <span class=\"number\">173</span>, <span class=\"number\">172</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">172</span>, <span class=\"number\">173</span>, <span class=\"number\">172</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1024</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">204</span>, <span class=\"number\">196</span>, <span class=\"number\">194</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">204</span>, <span class=\"number\">196</span>, <span class=\"number\">194</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2048</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">199</span>, <span class=\"number\">225</span>, <span class=\"number\">240</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">199</span>, <span class=\"number\">225</span>, <span class=\"number\">240</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4096</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">150</span>, <span class=\"number\">196</span>, <span class=\"number\">230</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">150</span>, <span class=\"number\">196</span>, <span class=\"number\">230</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">8192</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">25</span>, <span class=\"number\">77</span>, <span class=\"number\">91</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">25</span>, <span class=\"number\">77</span>, <span class=\"number\">91</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">16384</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">229</span>, <span class=\"number\">96</span>, <span class=\"number\">205</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">229</span>, <span class=\"number\">96</span>, <span class=\"number\">205</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">32768</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">250</span>, <span class=\"number\">174</span>, <span class=\"number\">78</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">250</span>, <span class=\"number\">174</span>, <span class=\"number\">78</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">65536</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">255</span>, <span class=\"number\">241</span>, <span class=\"number\">222</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">255</span>, <span class=\"number\">241</span>, <span class=\"number\">222</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">255</span>, <span class=\"number\">209</span>, <span class=\"number\">145</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">255</span>, <span class=\"number\">209</span>, <span class=\"number\">145</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>方块的移动方法和创建方法，我在这里先写成一样，因为还没有对方块的创建和移动做区别，如果要做优化，可以在移动时加入移动的动画，在创建加入创建的动画，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">moveTo: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">row, col</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.row = row;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.col = col;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setPositionX((cc.winSize.width - tile.width * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + tile.width * <span class=\"built_in\">this</span>.col);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setPositionY((cc.winSize.height - tile.height * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + tile.height * <span class=\"built_in\">this</span>.row);</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">newTile: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">row, col</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.row = row;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.col = col;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setPositionX((cc.winSize.width - tile.width * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + tile.width * <span class=\"built_in\">this</span>.col);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setPositionY((cc.winSize.height - tile.height * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + tile.height * <span class=\"built_in\">this</span>.row);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"游戏场景类\"><a href=\"#游戏场景类\" class=\"headerlink\" title=\"游戏场景类\"></a>游戏场景类</h4><p>所有的游戏操作及操作反馈都在游戏场景类中进行，游戏场景类将封装好的方块类放到游戏逻辑中，通过玩家操作给予一定的操作反馈。游戏场景类中主要接受玩家的滑动操作，并在接收到滑动操作后将所有的方块类进行移动或合并。<br>游戏场景类中需要isMove，startX，startY，以及tiles四个属性：第一个是控制玩家触摸操作的标识变量，避免重复调用移动方法；中间两个为记录玩家手指滑动的距离，当距离查过一定的长度之后，才判断玩家进行了滑动操作；最后一个变量是一个数组，用于存储在4x4的表格中的方块的信息。<br>有了以上四个属性之后，就可以在构造函数中进行初始化了，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> tiles = <span class=\"literal\">null</span>;<span class=\"comment\">// 存储方块信息</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> GameLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    isMove: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    startX: <span class=\"number\">0</span>,</span><br><span class=\"line\">    startY: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.isMove = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.startX = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.startY = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"comment\">//设置块的宽高</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cc.winSize.width &lt; cc.winSize.height) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 竖屏</span></span><br><span class=\"line\">            tile.width = cc.winSize.width / <span class=\"number\">5</span>;</span><br><span class=\"line\">            tile.height = cc.winSize.width / <span class=\"number\">5</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 横屏</span></span><br><span class=\"line\">            tile.width = cc.winSize.height / <span class=\"number\">5</span>;</span><br><span class=\"line\">            tile.height = cc.winSize.height / <span class=\"number\">5</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 初始化数组</span></span><br><span class=\"line\">        tiles = [</span><br><span class=\"line\">            [<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>],</span><br><span class=\"line\">            [<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>],</span><br><span class=\"line\">            [<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>],</span><br><span class=\"line\">            [<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>]</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在初始化完之后，我们就可以在场景的onEnter方法中绘制场景了，绘制的内容包括游戏背景以及随机初始化两个方块，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">    <span class=\"comment\">// 绘制背景</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.drawBg();</span><br><span class=\"line\">    <span class=\"comment\">// 绘制块</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> tile1 = <span class=\"keyword\">new</span> Tiled(<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> tile2 = <span class=\"keyword\">new</span> Tiled(<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(tile1);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(tile2);</span><br><span class=\"line\">    <span class=\"comment\">//处理事件</span></span><br><span class=\"line\">    cc.eventManager.addListener(&#123;</span><br><span class=\"line\">        event: cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">        swallowTouches: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        onTouchBegan: <span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">        onTouchMoved: <span class=\"built_in\">this</span>.touchmoved</span><br><span class=\"line\">    &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中drawBg方法中，绘制了五条垂直直线以及五条水平直线，来作为方块所在的4x4的表格，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">drawBg: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//绘制背景</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> bgRect = <span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\">    bgRect.drawRect(cc.p(<span class=\"number\">0</span>, <span class=\"number\">0</span>), cc.p(cc.winSize.width, cc.winSize.height), cc.color(<span class=\"number\">173</span>, <span class=\"number\">140</span>, <span class=\"number\">61</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">173</span>, <span class=\"number\">140</span>, <span class=\"number\">61</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(bgRect);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> n = <span class=\"number\">0</span>; n &lt; <span class=\"number\">5</span>; n++) &#123;</span><br><span class=\"line\">        bg.drawSegment(cc.p((cc.winSize.width - tile.width * <span class=\"number\">4</span>) / <span class=\"number\">2</span>, (cc.winSize.height - tile.height * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + n * tile.width), cc.p(cc.winSize.width / <span class=\"number\">2</span> + tile.width * <span class=\"number\">2</span>, (cc.winSize.height - tile.height * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + n * tile.width), <span class=\"number\">5</span>,</span><br><span class=\"line\">            cc.color(<span class=\"number\">55</span>, <span class=\"number\">62</span>, <span class=\"number\">64</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">        bg.drawSegment(cc.p((cc.winSize.width - tile.width * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + n * tile.width, (cc.winSize.height - tile.height * <span class=\"number\">4</span>) / <span class=\"number\">2</span>), cc.p((cc.winSize.width - tile.width * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + n * tile.width, (cc.winSize.height - tile.height * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + tile.width * <span class=\"number\">4</span>), <span class=\"number\">5</span>,</span><br><span class=\"line\">            cc.color(<span class=\"number\">55</span>, <span class=\"number\">62</span>, <span class=\"number\">64</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>可以看到，在onEnter中，注册了触摸事件，这个触摸事件就用于接受玩家的操作，在TouchBegan事件中记录触摸开始时的点，在TouchMoved中记录当前移动到的点，当触摸距离超过一定长度时，判定玩家进行了滑动操作，并通过触摸点来判断玩家滑动的举例，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touchbegan: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">touch, event</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.isMove = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.startX = touch.getLocationX();</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.startY = touch.getLocationY();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">touchmoved: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">touch, event</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.isMove) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> endX = touch.getLocation().x;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> endY = touch.getLocation().y;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">Math</span>.abs(endX - <span class=\"built_in\">this</span>.startX) &gt; <span class=\"number\">20</span> ||</span><br><span class=\"line\">        <span class=\"built_in\">Math</span>.abs(endY - <span class=\"built_in\">this</span>.startY) &gt; <span class=\"number\">20</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> dir = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">Math</span>.abs(endX - <span class=\"built_in\">this</span>.startX) &gt; <span class=\"built_in\">Math</span>.abs(endY - <span class=\"built_in\">this</span>.startY)) &#123;<span class=\"comment\">//左右</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (endX &gt; <span class=\"built_in\">this</span>.startX) &#123;</span><br><span class=\"line\">                dir = <span class=\"string\">&quot;right&quot;</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                dir = <span class=\"string\">&quot;left&quot;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//上下</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (endY &gt; <span class=\"built_in\">this</span>.startY) &#123;</span><br><span class=\"line\">                dir = <span class=\"string\">&quot;up&quot;</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                dir = <span class=\"string\">&quot;down&quot;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.isMove = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        event.getCurrentTarget().moveAllTiled(dir);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">moveAllTiled: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">dir</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isMoved = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (dir) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;up&quot;</span>:</span><br><span class=\"line\">            isMoved = <span class=\"built_in\">this</span>.moveUp();</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;down&quot;</span>:</span><br><span class=\"line\">            isMoved = <span class=\"built_in\">this</span>.moveDown();</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;left&quot;</span>:</span><br><span class=\"line\">            isMoved = <span class=\"built_in\">this</span>.moveLeft();</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;right&quot;</span>:</span><br><span class=\"line\">            isMoved = <span class=\"built_in\">this</span>.moveRight();</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isMoved) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//每次移动产生一个新块</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.newTiled();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>触动滑动操作后，开始执行滑动逻辑，每次滑动之后，会随机创建一个新的方块，在newTiled方法中，除了创建新方块之外，还需要判断游戏是否结束，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">newTiled: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> tile = <span class=\"keyword\">new</span> Tiled(<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(tile);</span><br><span class=\"line\">    <span class=\"comment\">// 判断游戏是否结束</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> isOver = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 判断是否有空余位置</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">4</span>; row++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">4</span>; col++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tiles[row][col] == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                isOver = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isOver) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 判断四周是否有数字相同方块</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">4</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">4</span>; col++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (row &lt; <span class=\"number\">3</span> &amp;&amp; tiles[row + <span class=\"number\">1</span>][col].num == tiles[row][col].num) &#123;</span><br><span class=\"line\">                    isOver = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (row &gt; <span class=\"number\">0</span> &amp;&amp; tiles[row - <span class=\"number\">1</span>][col].num == tiles[row][col].num) &#123;</span><br><span class=\"line\">                    isOver = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (col &lt; <span class=\"number\">3</span> &amp;&amp; tiles[row][col + <span class=\"number\">1</span>].num == tiles[row][col].num) &#123;</span><br><span class=\"line\">                    isOver = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (col &gt; <span class=\"number\">0</span> &amp;&amp; tiles[row][col - <span class=\"number\">1</span>].num == tiles[row][col].num) &#123;</span><br><span class=\"line\">                    isOver = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isOver) &#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> OverScene()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>方块的滑动，就是2048这款游戏最主要的逻辑了，我们在滑动的时候，需要遍历tiles数组所有不是null的元素，并将这个元素按照滑动方向进行移动，一直遍历到数组的最大长度，也就是将滑动到表格的边缘，如果中途遇到了方块，并且数字与自己相同，就进行合并，合并是将自己删除，将遇到的方块数字乘以2，如果中途遇到的方块的数字与自己不同，此方块的滑动就停止，使其停在当前的位置，滑动分为上下左右四个逻辑，代码分别如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">moveUp: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isMoved = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">4</span>; col++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">3</span>; row &gt;= <span class=\"number\">0</span>; row--) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tiles[row][col] != <span class=\"literal\">null</span>) &#123;<span class=\"comment\">// 有方块</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row1 = row; row1 &lt; <span class=\"number\">3</span>; row1++) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (tiles[row1 + <span class=\"number\">1</span>][col] == <span class=\"literal\">null</span>)<span class=\"comment\">//如果没有向上移动</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        tiles[row1 + <span class=\"number\">1</span>][col] = tiles[row1][col];</span><br><span class=\"line\">                        tiles[row1][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        tiles[row1 + <span class=\"number\">1</span>][col].moveTo(row1 + <span class=\"number\">1</span>, col);</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (tiles[row1 + <span class=\"number\">1</span>][col].num == tiles[row1][col].num) &#123;<span class=\"comment\">// 合并</span></span><br><span class=\"line\">                        tiles[row1 + <span class=\"number\">1</span>][col].num = <span class=\"built_in\">parseInt</span>(tiles[row1][col].num) * <span class=\"number\">2</span>;</span><br><span class=\"line\">                        tiles[row1 + <span class=\"number\">1</span>][col].updateNum();</span><br><span class=\"line\">                        tiles[row1][col].removeFromParent();</span><br><span class=\"line\">                        tiles[row1][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> isMoved;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">moveDown: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isMoved = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">4</span>; col++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">4</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tiles[row][col] != <span class=\"literal\">null</span>) &#123;<span class=\"comment\">// 有方块</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row1 = row; row1 &gt; <span class=\"number\">0</span>; row1--) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (tiles[row1 - <span class=\"number\">1</span>][col] == <span class=\"literal\">null</span>)<span class=\"comment\">//如果没有向下移动</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        tiles[row1 - <span class=\"number\">1</span>][col] = tiles[row1][col];</span><br><span class=\"line\">                        tiles[row1][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        tiles[row1 - <span class=\"number\">1</span>][col].moveTo(row1 - <span class=\"number\">1</span>, col);</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (tiles[row1 - <span class=\"number\">1</span>][col].num == tiles[row1][col].num) &#123;<span class=\"comment\">// 合并</span></span><br><span class=\"line\">                        tiles[row1 - <span class=\"number\">1</span>][col].num = <span class=\"built_in\">parseInt</span>(tiles[row1][col].num) * <span class=\"number\">2</span>;</span><br><span class=\"line\">                        tiles[row1 - <span class=\"number\">1</span>][col].updateNum();</span><br><span class=\"line\">                        tiles[row1][col].removeFromParent();</span><br><span class=\"line\">                        tiles[row1][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> isMoved;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">moveLeft: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isMoved = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">4</span>; row++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">4</span>; col++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tiles[row][col] != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col1 = col; col1 &gt; <span class=\"number\">0</span>; col1--) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (tiles[row][col1 - <span class=\"number\">1</span>] == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        tiles[row][col1 - <span class=\"number\">1</span>] = tiles[row][col1];</span><br><span class=\"line\">                        tiles[row][col1] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        tiles[row][col1 - <span class=\"number\">1</span>].moveTo(row, col1 - <span class=\"number\">1</span>);</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (tiles[row][col1 - <span class=\"number\">1</span>].num == tiles[row][col1].num) &#123;<span class=\"comment\">// 合并</span></span><br><span class=\"line\">                        tiles[row][col1 - <span class=\"number\">1</span>].num = <span class=\"built_in\">parseInt</span>(tiles[row][col1].num) * <span class=\"number\">2</span>;</span><br><span class=\"line\">                        tiles[row][col1 - <span class=\"number\">1</span>].updateNum();</span><br><span class=\"line\">                        tiles[row][col1].removeFromParent();</span><br><span class=\"line\">                        tiles[row][col1] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> isMoved;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">moveRight: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isMoved = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">4</span>; row++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">3</span>; col &gt;= <span class=\"number\">0</span>; col--) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tiles[row][col] != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col1 = col; col1 &lt; <span class=\"number\">3</span>; col1++) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (tiles[row][col1 + <span class=\"number\">1</span>] == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        tiles[row][col1 + <span class=\"number\">1</span>] = tiles[row][col1];</span><br><span class=\"line\">                        tiles[row][col1] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        tiles[row][col1 + <span class=\"number\">1</span>].moveTo(row, col1 + <span class=\"number\">1</span>);</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (tiles[row][col1 + <span class=\"number\">1</span>].num == tiles[row][col1].num) &#123;<span class=\"comment\">// 合并</span></span><br><span class=\"line\">                        tiles[row][col1 + <span class=\"number\">1</span>].num = <span class=\"built_in\">parseInt</span>(tiles[row][col1].num) * <span class=\"number\">2</span>;</span><br><span class=\"line\">                        tiles[row][col1 + <span class=\"number\">1</span>].updateNum();</span><br><span class=\"line\">                        tiles[row][col1].removeFromParent();</span><br><span class=\"line\">                        tiles[row][col1] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> isMoved;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>至此，我们就基本实现了2048游戏的主要逻辑。</p>\n<h4 id=\"开始-结束场景类\"><a href=\"#开始-结束场景类\" class=\"headerlink\" title=\"开始/结束场景类\"></a>开始/结束场景类</h4><p>为了游戏框架的完整，我们还是创建一个开始场景类和结束场景类，代码分别如下：<br>开始场景类</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 2. add a menu item with &quot;X&quot; image, which is clicked to quit the program</span></span><br><span class=\"line\">        <span class=\"comment\">//    you may modify it.</span></span><br><span class=\"line\">        <span class=\"comment\">// ask the window size</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 3. add your codes below...</span></span><br><span class=\"line\">        <span class=\"comment\">// add a label shows &quot;Hello World&quot;</span></span><br><span class=\"line\">        <span class=\"comment\">// create and initialize a label</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> helloLabel = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;2048&quot;</span>, <span class=\"string\">&quot;Arial&quot;</span>, <span class=\"number\">38</span>);</span><br><span class=\"line\">        <span class=\"comment\">// position the label on the center of the screen</span></span><br><span class=\"line\">        helloLabel.x = size.width / <span class=\"number\">2</span>;</span><br><span class=\"line\">        helloLabel.y = size.height / <span class=\"number\">2</span> + <span class=\"number\">200</span>;</span><br><span class=\"line\">        <span class=\"comment\">// add the label as a child to this layer</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(helloLabel, <span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// add &quot;HelloWorld&quot; splash screen&quot;</span></span><br><span class=\"line\">        <span class=\"comment\">// this.sprite = new cc.Sprite(res.HelloWorld_png);</span></span><br><span class=\"line\">        <span class=\"comment\">// this.sprite.attr(&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//     x: size.width / 2,</span></span><br><span class=\"line\">        <span class=\"comment\">//     y: size.height / 2</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">        <span class=\"comment\">// this.addChild(this.sprite, 0);</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">var</span> start = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;开始游戏&quot;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>,<span class=\"keyword\">new</span> GameScene()));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(start);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>结束场景类</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/6/19.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> overText = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;Game Over&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>);</span><br><span class=\"line\">        overText.setPosition(cc.winSize.width / <span class=\"number\">2</span>, cc.winSize.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> back = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;再来一次&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> HelloWorldScene()));</span><br><span class=\"line\">        &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(back);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> OverLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p>最后的运行效果如下<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/2048.gif\" alt=\"2048效果图\"><br>通过CVP平台的项目托管可看到实际运行效果，地址如下：<br><a href=\"http://www.cocoscvp.com/usercode/ea72822aeed0546b537b4226954a11be87a7f152/\">http://www.cocoscvp.com/usercode/ea72822aeed0546b537b4226954a11be87a7f152/</a></p>\n<h3 id=\"源代码\"><a href=\"#源代码\" class=\"headerlink\" title=\"源代码\"></a>源代码</h3><p>所有源代码均上传到github，欢迎交流学习，地址：<br><a href=\"https://github.com/hjcenry/2048\">https://github.com/hjcenry/2048</a></p>\n<ul>\n<li>原文博客：<a href=\"http://hjcenry.github.io/\">http://hjcenry.github.io</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>2048是之前火过一段时间的休闲数字消除类游戏，它的玩法很简单，上手很容易，可是想到要得到高分却很难，看似简单的游戏却有着很多得分的技巧，想当初这个游戏也曾是陪伴我大学课堂的游戏之一。","more":"虽然在得分上有着很多的技巧，但对于开发来说，这其实是一件相当容易的事情，仔细分析之后就可能大概理清楚这种消除游戏的逻辑。</p>\n<h3 id=\"游戏分析\"><a href=\"#游戏分析\" class=\"headerlink\" title=\"游戏分析\"></a>游戏分析</h3><p>这款游戏仔细想想就差不多清楚它的大致的思路，游戏中只有方块这一个我们操作的对象，这个对象包含了所在行，所在列，以及方块显示的数字三个属性，这三个属性足以表达游戏中的所有效果。除了方块，其他的就是游戏中必不可少的背景图层，开始及结束场景等。由于游戏中需要将4x4的方块们整齐排列，因此还需要一个四行四列的表格，来呈现我们的游戏效果。</p>\n<h3 id=\"滑动逻辑\"><a href=\"#滑动逻辑\" class=\"headerlink\" title=\"滑动逻辑\"></a>滑动逻辑</h3><p>游戏中最主要的操作就是通过手指触摸屏幕进行滑屏操作，带动场景中的方块整体移动，并且遇到相同数字的方块进行合并。滑动的逻辑就是遍历场景中所有的方块，每一个方块在滑动方向进行移动，如果前方没有方块，方块就一直滑动，如果前方有方块，判断自己的数字与这个方块的数字是否相同，相同进行合并操作，不相同则停在当前位置。</p>\n<h3 id=\"游戏实现\"><a href=\"#游戏实现\" class=\"headerlink\" title=\"游戏实现\"></a>游戏实现</h3><p>在对游戏逻辑进行了分析之后，就可以用代码进行实现了，编码，其实就是一个将游戏逻辑转换为机器语言的过程而已。</p>\n<h4 id=\"方块类\"><a href=\"#方块类\" class=\"headerlink\" title=\"方块类\"></a>方块类</h4><p>首先，我们需要一个类来存储方块的长度和宽度，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 保存方块长度方块</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> tile = &#123;</span><br><span class=\"line\">    width: <span class=\"number\">0</span>,</span><br><span class=\"line\">    height: <span class=\"number\">0</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>方块类是对场景中可操的方块的封装，包括所在行，所在列，显示数字三个属性，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Tiled = cc.Node.extend(&#123;</span><br><span class=\"line\">    num: <span class=\"number\">0</span>,</span><br><span class=\"line\">    col: <span class=\"number\">0</span>,</span><br><span class=\"line\">    row: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>当然仅仅有以上三个属性是不够的，我们还需要在方块的构造函数中绘制方块的背景、绘制方块显示的数字、以及随机设定方块的行列坐标。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Tiled = cc.Node.extend(&#123;</span><br><span class=\"line\">    num: <span class=\"number\">0</span>,</span><br><span class=\"line\">    col: <span class=\"number\">0</span>,</span><br><span class=\"line\">    row: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.num = num;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">            count++;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.row = <span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">4</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.col = <span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">4</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tiles[<span class=\"built_in\">this</span>.row][<span class=\"built_in\">this</span>.col] == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                tiles[<span class=\"built_in\">this</span>.row][<span class=\"built_in\">this</span>.col] = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (count &gt;= <span class=\"number\">16</span>) &#123;<span class=\"comment\">// 格子满了</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 绘制背景</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\">        bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">255</span>, <span class=\"number\">209</span>, <span class=\"number\">145</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">255</span>, <span class=\"number\">209</span>, <span class=\"number\">145</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        bg.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 绘制数字</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> labelNum = <span class=\"keyword\">new</span> cc.LabelTTF();</span><br><span class=\"line\">        labelNum.setString(<span class=\"string\">&quot;&quot;</span> + <span class=\"built_in\">this</span>.num);</span><br><span class=\"line\">        labelNum.setFontSize(<span class=\"number\">60</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 字体描边效果</span></span><br><span class=\"line\">        <span class=\"comment\">// labelNum.enableStroke(cc.color.BLACK, 0);</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(labelNum);</span><br><span class=\"line\">        labelNum.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 设定字体和坐标</span></span><br><span class=\"line\">        labelNum.setPosition(tile.width / <span class=\"number\">2</span>, tile.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 移动块</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.newTile(<span class=\"built_in\">this</span>.row, <span class=\"built_in\">this</span>.col);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>除此之外，每个方块应该还要包含一个newTile方法、moveTo方法和updateNum方法，分别封装随机创建方块、移动方块和更新方块数字三个功能。<br>在updateNum方法中，我们主要做两件事，更新方块显示数字和更新方块背景颜色（在方块的背景色上，我还专门上网搜了几种颜色搭配，恩，感觉很有艺术美，哈哈），代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">updateNum: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>).setString(<span class=\"string\">&quot;&quot;</span> + <span class=\"built_in\">this</span>.num);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> bg = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (<span class=\"built_in\">this</span>.num) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">235</span>, <span class=\"number\">245</span>, <span class=\"number\">223</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">235</span>, <span class=\"number\">245</span>, <span class=\"number\">223</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">186</span>, <span class=\"number\">212</span>, <span class=\"number\">170</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">186</span>, <span class=\"number\">212</span>, <span class=\"number\">170</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">212</span>, <span class=\"number\">212</span>, <span class=\"number\">170</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">212</span>, <span class=\"number\">212</span>, <span class=\"number\">170</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">16</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">193</span>, <span class=\"number\">160</span>, <span class=\"number\">117</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">193</span>, <span class=\"number\">160</span>, <span class=\"number\">117</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">32</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">124</span>, <span class=\"number\">99</span>, <span class=\"number\">84</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">124</span>, <span class=\"number\">99</span>, <span class=\"number\">84</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">64</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">218</span>, <span class=\"number\">227</span>, <span class=\"number\">224</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">218</span>, <span class=\"number\">227</span>, <span class=\"number\">224</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">128</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">64</span>, <span class=\"number\">125</span>, <span class=\"number\">148</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">64</span>, <span class=\"number\">125</span>, <span class=\"number\">148</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">256</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">123</span>, <span class=\"number\">118</span>, <span class=\"number\">135</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">123</span>, <span class=\"number\">118</span>, <span class=\"number\">135</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">512</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">172</span>, <span class=\"number\">173</span>, <span class=\"number\">172</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">172</span>, <span class=\"number\">173</span>, <span class=\"number\">172</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1024</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">204</span>, <span class=\"number\">196</span>, <span class=\"number\">194</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">204</span>, <span class=\"number\">196</span>, <span class=\"number\">194</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2048</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">199</span>, <span class=\"number\">225</span>, <span class=\"number\">240</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">199</span>, <span class=\"number\">225</span>, <span class=\"number\">240</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4096</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">150</span>, <span class=\"number\">196</span>, <span class=\"number\">230</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">150</span>, <span class=\"number\">196</span>, <span class=\"number\">230</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">8192</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">25</span>, <span class=\"number\">77</span>, <span class=\"number\">91</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">25</span>, <span class=\"number\">77</span>, <span class=\"number\">91</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">16384</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">229</span>, <span class=\"number\">96</span>, <span class=\"number\">205</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">229</span>, <span class=\"number\">96</span>, <span class=\"number\">205</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">32768</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">250</span>, <span class=\"number\">174</span>, <span class=\"number\">78</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">250</span>, <span class=\"number\">174</span>, <span class=\"number\">78</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">65536</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">255</span>, <span class=\"number\">241</span>, <span class=\"number\">222</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">255</span>, <span class=\"number\">241</span>, <span class=\"number\">222</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            bg.drawRect(cc.p(<span class=\"number\">5</span>, <span class=\"number\">5</span>), cc.p(tile.width - <span class=\"number\">5</span>, tile.height - <span class=\"number\">5</span>), cc.color(<span class=\"number\">255</span>, <span class=\"number\">209</span>, <span class=\"number\">145</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">255</span>, <span class=\"number\">209</span>, <span class=\"number\">145</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>方块的移动方法和创建方法，我在这里先写成一样，因为还没有对方块的创建和移动做区别，如果要做优化，可以在移动时加入移动的动画，在创建加入创建的动画，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">moveTo: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">row, col</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.row = row;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.col = col;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setPositionX((cc.winSize.width - tile.width * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + tile.width * <span class=\"built_in\">this</span>.col);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setPositionY((cc.winSize.height - tile.height * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + tile.height * <span class=\"built_in\">this</span>.row);</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">newTile: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">row, col</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.row = row;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.col = col;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setPositionX((cc.winSize.width - tile.width * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + tile.width * <span class=\"built_in\">this</span>.col);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setPositionY((cc.winSize.height - tile.height * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + tile.height * <span class=\"built_in\">this</span>.row);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"游戏场景类\"><a href=\"#游戏场景类\" class=\"headerlink\" title=\"游戏场景类\"></a>游戏场景类</h4><p>所有的游戏操作及操作反馈都在游戏场景类中进行，游戏场景类将封装好的方块类放到游戏逻辑中，通过玩家操作给予一定的操作反馈。游戏场景类中主要接受玩家的滑动操作，并在接收到滑动操作后将所有的方块类进行移动或合并。<br>游戏场景类中需要isMove，startX，startY，以及tiles四个属性：第一个是控制玩家触摸操作的标识变量，避免重复调用移动方法；中间两个为记录玩家手指滑动的距离，当距离查过一定的长度之后，才判断玩家进行了滑动操作；最后一个变量是一个数组，用于存储在4x4的表格中的方块的信息。<br>有了以上四个属性之后，就可以在构造函数中进行初始化了，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> tiles = <span class=\"literal\">null</span>;<span class=\"comment\">// 存储方块信息</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> GameLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    isMove: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    startX: <span class=\"number\">0</span>,</span><br><span class=\"line\">    startY: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.isMove = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.startX = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.startY = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"comment\">//设置块的宽高</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cc.winSize.width &lt; cc.winSize.height) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 竖屏</span></span><br><span class=\"line\">            tile.width = cc.winSize.width / <span class=\"number\">5</span>;</span><br><span class=\"line\">            tile.height = cc.winSize.width / <span class=\"number\">5</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 横屏</span></span><br><span class=\"line\">            tile.width = cc.winSize.height / <span class=\"number\">5</span>;</span><br><span class=\"line\">            tile.height = cc.winSize.height / <span class=\"number\">5</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 初始化数组</span></span><br><span class=\"line\">        tiles = [</span><br><span class=\"line\">            [<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>],</span><br><span class=\"line\">            [<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>],</span><br><span class=\"line\">            [<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>],</span><br><span class=\"line\">            [<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>]</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在初始化完之后，我们就可以在场景的onEnter方法中绘制场景了，绘制的内容包括游戏背景以及随机初始化两个方块，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">    <span class=\"comment\">// 绘制背景</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.drawBg();</span><br><span class=\"line\">    <span class=\"comment\">// 绘制块</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> tile1 = <span class=\"keyword\">new</span> Tiled(<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> tile2 = <span class=\"keyword\">new</span> Tiled(<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(tile1);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(tile2);</span><br><span class=\"line\">    <span class=\"comment\">//处理事件</span></span><br><span class=\"line\">    cc.eventManager.addListener(&#123;</span><br><span class=\"line\">        event: cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">        swallowTouches: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        onTouchBegan: <span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">        onTouchMoved: <span class=\"built_in\">this</span>.touchmoved</span><br><span class=\"line\">    &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中drawBg方法中，绘制了五条垂直直线以及五条水平直线，来作为方块所在的4x4的表格，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">drawBg: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//绘制背景</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> bgRect = <span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\">    bgRect.drawRect(cc.p(<span class=\"number\">0</span>, <span class=\"number\">0</span>), cc.p(cc.winSize.width, cc.winSize.height), cc.color(<span class=\"number\">173</span>, <span class=\"number\">140</span>, <span class=\"number\">61</span>, <span class=\"number\">255</span>), <span class=\"number\">1</span>, cc.color(<span class=\"number\">173</span>, <span class=\"number\">140</span>, <span class=\"number\">61</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(bgRect);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> cc.DrawNode();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> n = <span class=\"number\">0</span>; n &lt; <span class=\"number\">5</span>; n++) &#123;</span><br><span class=\"line\">        bg.drawSegment(cc.p((cc.winSize.width - tile.width * <span class=\"number\">4</span>) / <span class=\"number\">2</span>, (cc.winSize.height - tile.height * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + n * tile.width), cc.p(cc.winSize.width / <span class=\"number\">2</span> + tile.width * <span class=\"number\">2</span>, (cc.winSize.height - tile.height * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + n * tile.width), <span class=\"number\">5</span>,</span><br><span class=\"line\">            cc.color(<span class=\"number\">55</span>, <span class=\"number\">62</span>, <span class=\"number\">64</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">        bg.drawSegment(cc.p((cc.winSize.width - tile.width * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + n * tile.width, (cc.winSize.height - tile.height * <span class=\"number\">4</span>) / <span class=\"number\">2</span>), cc.p((cc.winSize.width - tile.width * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + n * tile.width, (cc.winSize.height - tile.height * <span class=\"number\">4</span>) / <span class=\"number\">2</span> + tile.width * <span class=\"number\">4</span>), <span class=\"number\">5</span>,</span><br><span class=\"line\">            cc.color(<span class=\"number\">55</span>, <span class=\"number\">62</span>, <span class=\"number\">64</span>, <span class=\"number\">255</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>可以看到，在onEnter中，注册了触摸事件，这个触摸事件就用于接受玩家的操作，在TouchBegan事件中记录触摸开始时的点，在TouchMoved中记录当前移动到的点，当触摸距离超过一定长度时，判定玩家进行了滑动操作，并通过触摸点来判断玩家滑动的举例，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touchbegan: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">touch, event</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.isMove = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.startX = touch.getLocationX();</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.startY = touch.getLocationY();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">touchmoved: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">touch, event</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.isMove) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> endX = touch.getLocation().x;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> endY = touch.getLocation().y;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">Math</span>.abs(endX - <span class=\"built_in\">this</span>.startX) &gt; <span class=\"number\">20</span> ||</span><br><span class=\"line\">        <span class=\"built_in\">Math</span>.abs(endY - <span class=\"built_in\">this</span>.startY) &gt; <span class=\"number\">20</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> dir = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">Math</span>.abs(endX - <span class=\"built_in\">this</span>.startX) &gt; <span class=\"built_in\">Math</span>.abs(endY - <span class=\"built_in\">this</span>.startY)) &#123;<span class=\"comment\">//左右</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (endX &gt; <span class=\"built_in\">this</span>.startX) &#123;</span><br><span class=\"line\">                dir = <span class=\"string\">&quot;right&quot;</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                dir = <span class=\"string\">&quot;left&quot;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//上下</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (endY &gt; <span class=\"built_in\">this</span>.startY) &#123;</span><br><span class=\"line\">                dir = <span class=\"string\">&quot;up&quot;</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                dir = <span class=\"string\">&quot;down&quot;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.isMove = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        event.getCurrentTarget().moveAllTiled(dir);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">moveAllTiled: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">dir</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isMoved = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (dir) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;up&quot;</span>:</span><br><span class=\"line\">            isMoved = <span class=\"built_in\">this</span>.moveUp();</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;down&quot;</span>:</span><br><span class=\"line\">            isMoved = <span class=\"built_in\">this</span>.moveDown();</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;left&quot;</span>:</span><br><span class=\"line\">            isMoved = <span class=\"built_in\">this</span>.moveLeft();</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;right&quot;</span>:</span><br><span class=\"line\">            isMoved = <span class=\"built_in\">this</span>.moveRight();</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isMoved) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//每次移动产生一个新块</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.newTiled();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>触动滑动操作后，开始执行滑动逻辑，每次滑动之后，会随机创建一个新的方块，在newTiled方法中，除了创建新方块之外，还需要判断游戏是否结束，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">newTiled: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> tile = <span class=\"keyword\">new</span> Tiled(<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(tile);</span><br><span class=\"line\">    <span class=\"comment\">// 判断游戏是否结束</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> isOver = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 判断是否有空余位置</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">4</span>; row++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">4</span>; col++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tiles[row][col] == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                isOver = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isOver) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 判断四周是否有数字相同方块</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">4</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">4</span>; col++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (row &lt; <span class=\"number\">3</span> &amp;&amp; tiles[row + <span class=\"number\">1</span>][col].num == tiles[row][col].num) &#123;</span><br><span class=\"line\">                    isOver = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (row &gt; <span class=\"number\">0</span> &amp;&amp; tiles[row - <span class=\"number\">1</span>][col].num == tiles[row][col].num) &#123;</span><br><span class=\"line\">                    isOver = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (col &lt; <span class=\"number\">3</span> &amp;&amp; tiles[row][col + <span class=\"number\">1</span>].num == tiles[row][col].num) &#123;</span><br><span class=\"line\">                    isOver = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (col &gt; <span class=\"number\">0</span> &amp;&amp; tiles[row][col - <span class=\"number\">1</span>].num == tiles[row][col].num) &#123;</span><br><span class=\"line\">                    isOver = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isOver) &#123;</span><br><span class=\"line\">        cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> OverScene()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>方块的滑动，就是2048这款游戏最主要的逻辑了，我们在滑动的时候，需要遍历tiles数组所有不是null的元素，并将这个元素按照滑动方向进行移动，一直遍历到数组的最大长度，也就是将滑动到表格的边缘，如果中途遇到了方块，并且数字与自己相同，就进行合并，合并是将自己删除，将遇到的方块数字乘以2，如果中途遇到的方块的数字与自己不同，此方块的滑动就停止，使其停在当前的位置，滑动分为上下左右四个逻辑，代码分别如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">moveUp: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isMoved = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">4</span>; col++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">3</span>; row &gt;= <span class=\"number\">0</span>; row--) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tiles[row][col] != <span class=\"literal\">null</span>) &#123;<span class=\"comment\">// 有方块</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row1 = row; row1 &lt; <span class=\"number\">3</span>; row1++) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (tiles[row1 + <span class=\"number\">1</span>][col] == <span class=\"literal\">null</span>)<span class=\"comment\">//如果没有向上移动</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        tiles[row1 + <span class=\"number\">1</span>][col] = tiles[row1][col];</span><br><span class=\"line\">                        tiles[row1][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        tiles[row1 + <span class=\"number\">1</span>][col].moveTo(row1 + <span class=\"number\">1</span>, col);</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (tiles[row1 + <span class=\"number\">1</span>][col].num == tiles[row1][col].num) &#123;<span class=\"comment\">// 合并</span></span><br><span class=\"line\">                        tiles[row1 + <span class=\"number\">1</span>][col].num = <span class=\"built_in\">parseInt</span>(tiles[row1][col].num) * <span class=\"number\">2</span>;</span><br><span class=\"line\">                        tiles[row1 + <span class=\"number\">1</span>][col].updateNum();</span><br><span class=\"line\">                        tiles[row1][col].removeFromParent();</span><br><span class=\"line\">                        tiles[row1][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> isMoved;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">moveDown: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isMoved = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">4</span>; col++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">4</span>; row++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tiles[row][col] != <span class=\"literal\">null</span>) &#123;<span class=\"comment\">// 有方块</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row1 = row; row1 &gt; <span class=\"number\">0</span>; row1--) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (tiles[row1 - <span class=\"number\">1</span>][col] == <span class=\"literal\">null</span>)<span class=\"comment\">//如果没有向下移动</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        tiles[row1 - <span class=\"number\">1</span>][col] = tiles[row1][col];</span><br><span class=\"line\">                        tiles[row1][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        tiles[row1 - <span class=\"number\">1</span>][col].moveTo(row1 - <span class=\"number\">1</span>, col);</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (tiles[row1 - <span class=\"number\">1</span>][col].num == tiles[row1][col].num) &#123;<span class=\"comment\">// 合并</span></span><br><span class=\"line\">                        tiles[row1 - <span class=\"number\">1</span>][col].num = <span class=\"built_in\">parseInt</span>(tiles[row1][col].num) * <span class=\"number\">2</span>;</span><br><span class=\"line\">                        tiles[row1 - <span class=\"number\">1</span>][col].updateNum();</span><br><span class=\"line\">                        tiles[row1][col].removeFromParent();</span><br><span class=\"line\">                        tiles[row1][col] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> isMoved;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">moveLeft: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isMoved = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">4</span>; row++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">0</span>; col &lt; <span class=\"number\">4</span>; col++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tiles[row][col] != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col1 = col; col1 &gt; <span class=\"number\">0</span>; col1--) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (tiles[row][col1 - <span class=\"number\">1</span>] == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        tiles[row][col1 - <span class=\"number\">1</span>] = tiles[row][col1];</span><br><span class=\"line\">                        tiles[row][col1] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        tiles[row][col1 - <span class=\"number\">1</span>].moveTo(row, col1 - <span class=\"number\">1</span>);</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (tiles[row][col1 - <span class=\"number\">1</span>].num == tiles[row][col1].num) &#123;<span class=\"comment\">// 合并</span></span><br><span class=\"line\">                        tiles[row][col1 - <span class=\"number\">1</span>].num = <span class=\"built_in\">parseInt</span>(tiles[row][col1].num) * <span class=\"number\">2</span>;</span><br><span class=\"line\">                        tiles[row][col1 - <span class=\"number\">1</span>].updateNum();</span><br><span class=\"line\">                        tiles[row][col1].removeFromParent();</span><br><span class=\"line\">                        tiles[row][col1] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> isMoved;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">moveRight: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isMoved = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> row = <span class=\"number\">0</span>; row &lt; <span class=\"number\">4</span>; row++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col = <span class=\"number\">3</span>; col &gt;= <span class=\"number\">0</span>; col--) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tiles[row][col] != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> col1 = col; col1 &lt; <span class=\"number\">3</span>; col1++) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (tiles[row][col1 + <span class=\"number\">1</span>] == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        tiles[row][col1 + <span class=\"number\">1</span>] = tiles[row][col1];</span><br><span class=\"line\">                        tiles[row][col1] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        tiles[row][col1 + <span class=\"number\">1</span>].moveTo(row, col1 + <span class=\"number\">1</span>);</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (tiles[row][col1 + <span class=\"number\">1</span>].num == tiles[row][col1].num) &#123;<span class=\"comment\">// 合并</span></span><br><span class=\"line\">                        tiles[row][col1 + <span class=\"number\">1</span>].num = <span class=\"built_in\">parseInt</span>(tiles[row][col1].num) * <span class=\"number\">2</span>;</span><br><span class=\"line\">                        tiles[row][col1 + <span class=\"number\">1</span>].updateNum();</span><br><span class=\"line\">                        tiles[row][col1].removeFromParent();</span><br><span class=\"line\">                        tiles[row][col1] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        isMoved = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> isMoved;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>至此，我们就基本实现了2048游戏的主要逻辑。</p>\n<h4 id=\"开始-结束场景类\"><a href=\"#开始-结束场景类\" class=\"headerlink\" title=\"开始/结束场景类\"></a>开始/结束场景类</h4><p>为了游戏框架的完整，我们还是创建一个开始场景类和结束场景类，代码分别如下：<br>开始场景类</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 1. super init first</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 2. add a menu item with &quot;X&quot; image, which is clicked to quit the program</span></span><br><span class=\"line\">        <span class=\"comment\">//    you may modify it.</span></span><br><span class=\"line\">        <span class=\"comment\">// ask the window size</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/////////////////////////////</span></span><br><span class=\"line\">        <span class=\"comment\">// 3. add your codes below...</span></span><br><span class=\"line\">        <span class=\"comment\">// add a label shows &quot;Hello World&quot;</span></span><br><span class=\"line\">        <span class=\"comment\">// create and initialize a label</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> helloLabel = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;2048&quot;</span>, <span class=\"string\">&quot;Arial&quot;</span>, <span class=\"number\">38</span>);</span><br><span class=\"line\">        <span class=\"comment\">// position the label on the center of the screen</span></span><br><span class=\"line\">        helloLabel.x = size.width / <span class=\"number\">2</span>;</span><br><span class=\"line\">        helloLabel.y = size.height / <span class=\"number\">2</span> + <span class=\"number\">200</span>;</span><br><span class=\"line\">        <span class=\"comment\">// add the label as a child to this layer</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(helloLabel, <span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// add &quot;HelloWorld&quot; splash screen&quot;</span></span><br><span class=\"line\">        <span class=\"comment\">// this.sprite = new cc.Sprite(res.HelloWorld_png);</span></span><br><span class=\"line\">        <span class=\"comment\">// this.sprite.attr(&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//     x: size.width / 2,</span></span><br><span class=\"line\">        <span class=\"comment\">//     y: size.height / 2</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">        <span class=\"comment\">// this.addChild(this.sprite, 0);</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">var</span> start = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;开始游戏&quot;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>,<span class=\"keyword\">new</span> GameScene()));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(start);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>结束场景类</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/6/19.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> overText = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;Game Over&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">50</span>);</span><br><span class=\"line\">        overText.setPosition(cc.winSize.width / <span class=\"number\">2</span>, cc.winSize.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> back = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;再来一次&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> HelloWorldScene()));</span><br><span class=\"line\">        &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(back);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> OverLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p>最后的运行效果如下<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/2048.gif\" alt=\"2048效果图\"><br>通过CVP平台的项目托管可看到实际运行效果，地址如下：<br><a href=\"http://www.cocoscvp.com/usercode/ea72822aeed0546b537b4226954a11be87a7f152/\">http://www.cocoscvp.com/usercode/ea72822aeed0546b537b4226954a11be87a7f152/</a></p>\n<h3 id=\"源代码\"><a href=\"#源代码\" class=\"headerlink\" title=\"源代码\"></a>源代码</h3><p>所有源代码均上传到github，欢迎交流学习，地址：<br><a href=\"https://github.com/hjcenry/2048\">https://github.com/hjcenry/2048</a></p>\n<ul>\n<li>原文博客：<a href=\"http://hjcenry.github.io/\">http://hjcenry.github.io</a></li>\n</ul>"},{"title":"Cocos2d-JS实现的贪吃蛇","date":"2016-05-16T07:38:00.000Z","_content":"### 前言\n相信贪吃蛇大家都玩儿过，我对贪吃蛇的印象就是在电子词典上，一只像素蛇在屏幕游走，饥渴难耐，看着豆子就要去吃，吃到豆子就会长一节，当蛇的身体越来越长的时候，它才发现这个世界变了，每走一步，都是寸步难行。<!--more-->当它的蛇头触碰到任意的物体，无论是屏幕边界还是自己的身体，游戏都将结束。这款游戏应该是比较经典的一个童年记忆。刚接触游戏开发的人可能比较喜欢以这款游戏入手，因为贪吃蛇包含了很多游戏开发中的原理，并且难度也不大，而我刚好在学习Cocos CVP的课程，学习在一个中间阶段，我也来拿这个练练手，以下就把我做贪吃蛇的过程分享出来。\n### 游戏分析\n#### 身体关节\n贪吃蛇的实现可能有多种方法，但今天，我想用面向对象的思想来对游戏进行设计，到今天，任何的程序开发都离不开面向对象的思想，通过面向对象的思想我们能把很多抽象的问题具象化，方便我们解决很多问题。而在贪吃蛇中，面向对象的思想依然实用。\n在贪吃蛇中，我们可以把一条游走的蛇的每个关节当做是一个对象，而蛇本身是由多个关节组成的整体，当每个关节在移动时，我们就能看到整个蛇的移动，每个关节的位置以及移动方向都跟它的上一个关节息息相关，那么我们就可以把关节与它的上一个关节关联起来，实现如下结构：\n![蛇关节关系图](http://7xnnwn.com1.z0.glb.clouddn.com/snake1.png)\n#### 移动方向\n如上文所说，按照上面的关节关系来实现，那么蛇的移动方向就是与父节点的移动方向相关联，每一个关节应该有一个当前移动方向和下次移动方向，每一步的移动，都是跟着当前移动方向走的，而父关节的当前移动的方向即为子关节的下次移动方向，这样，只需要调整蛇头关节的下次移动方向，整条蛇就能顺着各自的父关节方向移动，蛇的移动方向图如下：\n![蛇的移动方向图](http://7xnnwn.com1.z0.glb.clouddn.com/snakemove.png)\n### 开发设计\n#### 项目结构\n按照前面的设计，我们可以大致可以划分出游戏场景类和关节类，进入游戏场景类，再将一些全局的变量单独存在一个类中，项目结构可划分如下图：\n![项目结构图](http://7xnnwn.com1.z0.glb.clouddn.com/snake%E7%BB%93%E6%9E%84%E5%9B%BE.png)\n#### 全局变量类\n游戏中的全局变量，提炼为一个全局变量类，其中参数可以根据需求灵活变动配置\n```javascript\nvar Constants = {\n    frequency: 0.2,// 刷新频率\n    speed: 31,// 每帧移动距离,身体节点大小+1像素间隔\n    errDistance: 10,// 偏差举例\n}\n```\n#### 关节类\n按照以上设计的结构，每一个关节对象都应该包含蛇的当前方向、下次方向和蛇的父节点三个属性，代码如下：\n```javascript\nvar SnakeBody = cc.Sprite.extend({\n    frontBody: null,//上一个身体关节,没有则为头部\n    nextDirection: 0,// 1-上,2-下,3-左,4-右\n    direction: 0,// 1-上,2-下,3-左,4-右\n    ctor: function (frontBody, direction) {\n        this._super();\n        this.frontBody = frontBody;\n        this.direction = direction;\n        this.nextDirection = direction;\n        return true;\n    }\n}\n```\n上面说的，关节的位置跟它的福关节的位置是息息相关的，那么初始化的时候，我们就需要根据父关节的移动方向来进行次关节的位置设置，这部分代码，我们可以放在onEnter方法中，代码如下：\n```javascript\nonEnter: function () {\n  this._super();\n  if (this.frontBody == null) {\n      // 蛇头部关节,设置头部纹理\n      switch (this.direction) {\n          case 1:\n              this.setTexture(res.head_up);\n              break;\n          case 2:\n              this.setTexture(res.head_down);\n              break;\n          case 3:\n              this.setTexture(res.head_left);\n              break;\n          case 4:\n              this.setTexture(res.head_right);\n              break;\n      }\n  } else {\n      // 蛇身体关节\n      // 设置纹理\n      this.setTexture(res.body);\n      // 设置关节位置\n      var frontX = this.frontBody.getPositionX();\n      var frontY = this.frontBody.getPositionY();\n      var frontWidth = this.frontBody.width;\n      var frontHeight = this.frontBody.height;\n      var width = this.width;\n      var height = this.height;\n      switch (this.frontBody.direction) {\n          // 根据父关节的当前移动方向,决定此关节的位置\n          case 1:// 上\n              this.setPosition(frontX, frontY - frontHeight / 2 - height / 2 - 1);\n              break;\n          case 2:// 下\n              this.setPosition(frontX, frontY + frontHeight / 2 + height / 2 + 1);\n              break;\n          case 3:// 左\n              this.setPosition(frontX + frontWidth / 2 + width / 2 + 1, frontY);\n              break;\n          case 4:// 右\n              this.setPosition(frontX - frontWidth / 2 - width / 2 - 1, frontY);\n              break;\n      }\n  }\n  return true;\n}\n```\n有了这三个属性，每一个节点还应该有最重要的游戏逻辑——move方法，每一个关节分别调用move方法，从游戏场景中就能看到整条蛇按照预定方向进行移动，而整条蛇的运动方向就是跟着头部关节的方向走，头部关节的方向则通过点击屏幕区域控制。\n在move方法中，我们需要做以下事情：\n```\n1.按照关节的下次移动方向移动本身长度的像素的距离\n2.如果是头部关节，需要改变关节纹理\n```\n同时，如果是头部关节，我们还需要判断以下三个临界条件：\n```\n1.头部关节是否触碰到屏幕边界\n2.头部关节是否吃到屏幕中的豆子\n3.头部关节是否触碰到自身关节\n```\n其中1、3条件达成，则判定游戏结束，2条件达成，则能增加游戏分数，并且游戏继续。\nmove方法代码如下：\n```javascript\n// 关节移动方法\nmove: function (layer) {\n    var star = layer.star;\n    var direct;\n    if (this.frontBody == null) {\n        // 头部关节按照自身的下次方向行走\n        direct = this.nextDirection;\n    } else {\n        // 身体关节按照父关节的当前方向行走,并将福关节的当前方向设置为自身的下次方向\n        this.nextDirection = direct = this.frontBody.direction;\n    }\n    switch (direct) {\n        case 1:// 上\n            this.setPosition(this.getPositionX(), this.getPositionY() + Constants.speed);\n            // this.runAction(cc.moveBy(Constants.frequency, cc.p(0, Constants.speed), 0))\n            break;\n        case 2:// 下\n            this.setPosition(this.getPositionX(), this.getPositionY() - Constants.speed);\n            // this.runAction(cc.moveBy(Constants.frequency, cc.p(0, -Constants.speed), 0))\n            break;\n        case 3:// 左\n            this.setPosition(this.getPositionX() - Constants.speed, this.getPositionY());\n            // this.runAction(cc.moveBy(Constants.frequency, cc.p(-Constants.speed, 0), 0))\n            break;\n        case 4:// 右\n            this.setPosition(this.getPositionX() + Constants.speed, this.getPositionY());\n            // this.runAction(cc.moveBy(Constants.frequency, cc.p(Constants.speed, 0), 0))\n            break;\n    }\n    if (this.frontBody == null) {\n        switch (this.nextDirection) {\n            // 头部关节需要设置头部不同方向的纹理\n            case 1:// 上\n                this.setTexture(res.head_up);\n                break;\n            case 2:// 下\n                this.setTexture(res.head_down);\n                break;\n            case 3:// 左\n                this.setTexture(res.head_left);\n                break;\n            case 4:// 右\n                this.setTexture(res.head_right);\n                break;\n        }\n        // 头部关节判断是否触碰到边界\n        var size = cc.winSize;\n        if ((this.getPositionX() > size.width - this.width / 2)\n            || (this.getPositionX() < this.width / 2)\n            || (this.getPositionY() > size.height - this.height / 2)\n            || (this.getPositionY() < this.height / 2)) {\n            // 判断触碰边界\n            cc.log(\"game over\");\n            return false;\n        }\n        // 判断是否触碰到自己身体关节\n        for (var index in layer.bodys) {\n            if (layer.bodys[index] != this && cc.rectIntersectsRect(this.getBoundingBox(), layer.bodys[index].getBoundingBox())) {\n                return false;\n            }\n        }\n        // 判断是否吃到星星\n        if (star != null) {\n            if (cc.rectIntersectsRect(this.getBoundingBox(), star.getBoundingBox())) {\n                star.runAction(\n                    cc.sequence(cc.spawn(\n                        cc.scaleTo(0.2, 3),\n                        cc.fadeOut(0.2)\n                    ), cc.callFunc(function (star) {\n                        star.removeFromParent();\n                    }, star))\n                );\n                // 清除星星\n                layer.star = null;\n                // 添加身体\n                layer.canNewBody = 1;\n                // 改变分数\n                layer.score.setString(\"\" + (Number(layer.score.getString()) + Math.round(Math.random() * 3 + 1)));\n                layer.score.runAction(cc.sequence(cc.scaleTo(0.1, 2), cc.scaleTo(0.1, 0.5), cc.scaleTo(0.1, 1)));\n            }\n        }\n    }\n    return true;\n}\n```\n#### 游戏场景类\n在游戏场景中我们需要以下几个变量：\n```\n1. 贪吃蛇数组：用于存储贪吃蛇所有的关节节点\n2. 贪吃蛇尾部：每添加一个关节节点 ，都将此变量指向这个新加的节点，以便下次继续再尾部节点添加\n3. 吃的星星：屏幕中随机产生的星星，用于判断头部关节是否与它产生碰撞\n4. 是否添加节点：如果在定时任务中判断到吃到星星，那么可以次变量为1，代表可以添加一个节点\n5. 分数：存储游戏中累加的分数\n```\n在cc.Layer的构造函数中对以上变量进行初始化，代码如下：\n```javascript\nvar GameLayer = cc.Layer.extend({\n  bodys: [],// snake body\n  tail: null,// snake tail\n  star: null,// star\n  canNewBody: 0,// 0-无,1-有\n  score: null,// 分数Label\n  ctor: function () {\n      // 初始化全局参数\n      this._super();\n      this.bodys = [];\n      this.canNewBody = 0;\n      this.star = null;\n      this.tail = null;\n      this.score = null;\n      return true;\n  }\n}\n```\n之后，我们首先需要在场景中绘制出一条蛇，初始化定义为1个头部关节，5个身体关节，由于我们对关节类做了很好的封装，所以初始化一条蛇的代码很简单，我们在onEnter方法中进行初始化，如下所示：\n```javascript\n// 初始化一条蛇\n// 初始化头部\nvar head = new SnakeBody(null, 4);\nhead.setPosition(300, 300);\nthis.addChild(head);\nthis.bodys.push(head);\nhead.setTag(1);\nthis.tail = head;\n// 循环添加5个身体\nfor (var i = 0; i < 5; i++) {\n    var node = new SnakeBody(this.tail, this.tail.direction);\n    this.addChild(node);\n    this.bodys.push(node);\n    this.tail = node;\n}\n```\n初始化完了之后蛇是不会动的，如何让它动起来呢，我们就要用到在关节类中封装的move方法了，我们每隔一个时间，对所有的关节类执行一次move方法，就能实现蛇的移动，首先在onEnter中添加定时任务：\n```javascript\n// 蛇移动的定时任务\nthis.schedule(this.snakeMove, Constants.frequency);\n```\n在这个snakeMove定时调用的方法中，我们要写出所有关节移动的逻辑，在这个方法中，我们需要完成以下几件事：\n```\n1. 遍历蛇的所有关节，每个关节执行一遍move方法，并在move完了之后，将下次移动方法变为本次移动方向\n2. 如果需要新增关节，在遍历完成之后，新增一个关节类，并将其父节点指向之前的蛇尾节点，并把蛇尾指向新加的这个关节\n```\n代码如下：\n```javascript\n// 蛇关节移动方法\nsnakeMove: function () {\n    for (var index in this.bodys) {\n        // 循环执行移动方法,并返回移动结果,false即视为游戏结束\n        if (!this.bodys[index].move(this)) {\n            // 执行移动方法,移动失败,游戏结束\n            this.unschedule(this.snakeMove);\n            this.unschedule(this.updateStar);\n            var overScene = new OverScene(Number(this.score.getString()), false);\n            cc.director.runScene(new cc.TransitionFade(1, overScene));\n        }\n    }\n    for (var index in this.bodys) {\n        // 本轮所有关节移动结束,所有节点的当前方向赋值为下一次的方向\n        this.bodys[index].direction = this.bodys[index].nextDirection;\n    }\n    if (this.canNewBody == 1) {\n        // 如果新增关节为1,增加关节\n        var node = new SnakeBody(this.tail, this.tail.direction);\n        this.addChild(node);\n        this.bodys.push(node);\n        this.tail = node;\n        this.canNewBody = 0;\n    }\n}\n```\n目前为止这条蛇是只会按照我们初始化的方向一直走到碰壁，然后游戏结束的，如何改变蛇的运动轨迹呢？前面说到了，蛇头部节点的下次移动方向的改变，即可对整个蛇的移动轨迹进行改变，这里我们可以通过点击屏幕实现蛇头的下次移动方向的改变。\n首先在onEnter方法中添加触摸事件监听：\n```javascript\n// 添加屏幕触摸事件\ncc.eventManager.addListener({\n    event: cc.EventListener.TOUCH_ONE_BY_ONE,\n    swallowTouches: true,\n    onTouchBegan: this.touchbegan,\n    onTouchMoved: this.touchmoved,\n    onTouchEnded: this.touchended\n}, this);\n```\n然后在onTouchBegan方法中实现点击事件，我们可以允许点击有一个10像素的误差：\n```javascript\n// 点击转向\ntouchbegan: function (touch, event) {\n    var x = touch.getLocation().x;\n    var y = touch.getLocation().y;\n    var head = event.getCurrentTarget().getChildByTag(1);\n    var headX = head.getPositionX();\n    var headY = head.getPositionY();\n    switch (head.direction) {\n        case 1:// 上\n        case 2:// 下\n            if (x <= headX - Constants.errDistance) {// 转左\n                head.nextDirection = 3;\n            } else if (x >= headX + Constants.errDistance) {// 转右\n                head.nextDirection = 4;\n            }\n            break;\n        case 3:// 左\n        case 4:// 右\n            if (y <= headY - Constants.errDistance) {// 转下\n                head.nextDirection = 2;\n            } else if (y >= headY + Constants.errDistance) {// 转上\n                head.nextDirection = 1;\n            }\n            break;\n    }\n    return true;\n}\n```\n最后我们只差最后一步，就是蛇要吃的星星，我们可以在屏幕中任意位置随机产生一颗星星（又或者叫豆子，这都无所谓），只要这个星星满足以下条件，那么它就可以被绘制出来，否则我们需要重新随机这个星星的位置：\n```\n1. 星星在游戏场景的屏幕范围内\n2. 星星不能与蛇的身体部分重叠\n```\n代码如下：\n```javascript\n// 更新星星\nupdateStar: function () {\n    if (this.star == null) {\n        this.star = new cc.Sprite(res.bean);\n        var randomX = Math.random() * (cc.winSize.width - this.star.width) + this.star.width;\n        var randomY = Math.random() * (cc.winSize.height - this.star.width) + this.star.height;\n        this.star.setPosition(randomX, randomY);\n        this.addChild(this.star);\n        // 产生的星星只要在屏幕外,或与蛇的身体部分重叠,则本次任务不产生\n        if ((randomX > cc.winSize.width - this.star.width / 2)\n            || (randomX < this.star.width / 2)\n            || (randomY > cc.winSize.height - this.star.height / 2)\n            || (randomY < this.star.height / 2)) {\n            cc.log(\"update star:out of screen\");\n            this.removeChild(this.star);\n            this.star = null;\n            return;\n        }\n        for (var index in this.bodys) {\n            if (cc.rectIntersectsRect(this.bodys[index].getBoundingBox(), this.star.getBoundingBox())) {\n                cc.log(\"update star:intersect with self\");\n                this.removeChild(this.star);\n                this.star = null;\n                return;\n            }\n        }\n    }\n}\n```\n至此，游戏的主要逻辑就大功告成了！贪吃蛇不仅能在屏幕中游走，还能吃星星，并且碰到自身或边缘都会GameOver！\n#### 开始/结束场景类\n说到GameOver，那么就必须要有一个Over的场景类了，毕竟有了开始场景，游戏场景和结束场景，才算得上一个完成的游戏流程嘛，结束场景类的实现很简单，只需要把游戏场景中获得的分数传递进来，然后在Label中展示即可，代码如下：\n```javascript\nvar OverLayer = cc.Layer.extend({\n    sprite: null,\n    score: 0,\n    ctor: function (score) {\n        this._super();\n        this.score = score;\n        return true;\n    },\n    onEnter: function () {\n        this._super();\n        var size = cc.winSize;\n        var over = new cc.LabelTTF(\"Game Over,你的分数是:\" + this.score, \"Arial\", 38);\n        over.setPosition(size.width / 2, size.height / 2);\n        this.addChild(over);\n        over.runAction(cc.sequence(cc.scaleTo(0.2, 2), cc.scaleTo(0.2, 0.5), cc.scaleTo(0.2, 1)));\n        var start = new cc.MenuItemFont(\"再来一次\", function () {\n            cc.director.runScene(new cc.TransitionFade(1, new HelloWorldScene()));\n        }, this);\n        start.setPosition(over.getPositionX(), over.getPositionY() - over.height / 2 - 50);\n        var menu = new cc.Menu(start);\n        this.addChild(menu);\n        menu.setPosition(0, 0);\n        return true;\n    }\n});\n\nvar OverScene = cc.Scene.extend({\n    score: 0,\n    ctor: function (score) {\n        this._super();\n        this.score = score;\n        return true;\n    },\n    onEnter: function () {\n        this._super();\n        var layer = new OverLayer(this.score);\n        this.addChild(layer);\n    }\n});\n```\n与结束场景一样，开始场景也只需一个Label一个Menu即可，代码如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite: null,\n    ctor: function () {\n        this._super();\n        var size = cc.winSize;\n        var helloLabel = new cc.LabelTTF(\"贪吃蛇\", \"Arial\", 38);\n        helloLabel.x = size.width / 2;\n        helloLabel.y = size.height / 2 + 200;\n        this.addChild(helloLabel, 5);\n        var start = new cc.MenuItemFont(\"开始游戏\", function () {\n            cc.director.runScene(new cc.TransitionFade(1, new GameScene()));\n        }, this);\n        var menu = new cc.Menu(start);\n        this.addChild(menu);\n        return true;\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter: function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n这样，我们就能形成一个完成游戏流程了，游戏加载进入游戏开始场景，点击开始游戏进行如主游戏场景，游戏结束后进入结束场景，结束场景点击“再来一次”又可以回到开始场景。\n### 运行效果\n最后的运行效果如下\n![贪吃蛇效果图](http://7xnnwn.com1.z0.glb.clouddn.com/snake.gif)\n通过CVP平台的项目托管可看到实际运行效果，地址如下：\nhttp://www.cocoscvp.com/usercode/2e17b3cd9586a574140e0bb765bad21673fc7686/\n### 源代码\n所有源代码均上传到github，欢迎交流学习，地址：\nhttps://github.com/hjcenry/snake","source":"_posts/Cocos2d-JS实现的贪吃蛇.md","raw":"---\ntitle: Cocos2d-JS实现的贪吃蛇\ndate: 2016-05-16 15:38\ncategories: cocos2d-js\ntags: [cocos2d-js,贪吃蛇]\n---\n### 前言\n相信贪吃蛇大家都玩儿过，我对贪吃蛇的印象就是在电子词典上，一只像素蛇在屏幕游走，饥渴难耐，看着豆子就要去吃，吃到豆子就会长一节，当蛇的身体越来越长的时候，它才发现这个世界变了，每走一步，都是寸步难行。<!--more-->当它的蛇头触碰到任意的物体，无论是屏幕边界还是自己的身体，游戏都将结束。这款游戏应该是比较经典的一个童年记忆。刚接触游戏开发的人可能比较喜欢以这款游戏入手，因为贪吃蛇包含了很多游戏开发中的原理，并且难度也不大，而我刚好在学习Cocos CVP的课程，学习在一个中间阶段，我也来拿这个练练手，以下就把我做贪吃蛇的过程分享出来。\n### 游戏分析\n#### 身体关节\n贪吃蛇的实现可能有多种方法，但今天，我想用面向对象的思想来对游戏进行设计，到今天，任何的程序开发都离不开面向对象的思想，通过面向对象的思想我们能把很多抽象的问题具象化，方便我们解决很多问题。而在贪吃蛇中，面向对象的思想依然实用。\n在贪吃蛇中，我们可以把一条游走的蛇的每个关节当做是一个对象，而蛇本身是由多个关节组成的整体，当每个关节在移动时，我们就能看到整个蛇的移动，每个关节的位置以及移动方向都跟它的上一个关节息息相关，那么我们就可以把关节与它的上一个关节关联起来，实现如下结构：\n![蛇关节关系图](http://7xnnwn.com1.z0.glb.clouddn.com/snake1.png)\n#### 移动方向\n如上文所说，按照上面的关节关系来实现，那么蛇的移动方向就是与父节点的移动方向相关联，每一个关节应该有一个当前移动方向和下次移动方向，每一步的移动，都是跟着当前移动方向走的，而父关节的当前移动的方向即为子关节的下次移动方向，这样，只需要调整蛇头关节的下次移动方向，整条蛇就能顺着各自的父关节方向移动，蛇的移动方向图如下：\n![蛇的移动方向图](http://7xnnwn.com1.z0.glb.clouddn.com/snakemove.png)\n### 开发设计\n#### 项目结构\n按照前面的设计，我们可以大致可以划分出游戏场景类和关节类，进入游戏场景类，再将一些全局的变量单独存在一个类中，项目结构可划分如下图：\n![项目结构图](http://7xnnwn.com1.z0.glb.clouddn.com/snake%E7%BB%93%E6%9E%84%E5%9B%BE.png)\n#### 全局变量类\n游戏中的全局变量，提炼为一个全局变量类，其中参数可以根据需求灵活变动配置\n```javascript\nvar Constants = {\n    frequency: 0.2,// 刷新频率\n    speed: 31,// 每帧移动距离,身体节点大小+1像素间隔\n    errDistance: 10,// 偏差举例\n}\n```\n#### 关节类\n按照以上设计的结构，每一个关节对象都应该包含蛇的当前方向、下次方向和蛇的父节点三个属性，代码如下：\n```javascript\nvar SnakeBody = cc.Sprite.extend({\n    frontBody: null,//上一个身体关节,没有则为头部\n    nextDirection: 0,// 1-上,2-下,3-左,4-右\n    direction: 0,// 1-上,2-下,3-左,4-右\n    ctor: function (frontBody, direction) {\n        this._super();\n        this.frontBody = frontBody;\n        this.direction = direction;\n        this.nextDirection = direction;\n        return true;\n    }\n}\n```\n上面说的，关节的位置跟它的福关节的位置是息息相关的，那么初始化的时候，我们就需要根据父关节的移动方向来进行次关节的位置设置，这部分代码，我们可以放在onEnter方法中，代码如下：\n```javascript\nonEnter: function () {\n  this._super();\n  if (this.frontBody == null) {\n      // 蛇头部关节,设置头部纹理\n      switch (this.direction) {\n          case 1:\n              this.setTexture(res.head_up);\n              break;\n          case 2:\n              this.setTexture(res.head_down);\n              break;\n          case 3:\n              this.setTexture(res.head_left);\n              break;\n          case 4:\n              this.setTexture(res.head_right);\n              break;\n      }\n  } else {\n      // 蛇身体关节\n      // 设置纹理\n      this.setTexture(res.body);\n      // 设置关节位置\n      var frontX = this.frontBody.getPositionX();\n      var frontY = this.frontBody.getPositionY();\n      var frontWidth = this.frontBody.width;\n      var frontHeight = this.frontBody.height;\n      var width = this.width;\n      var height = this.height;\n      switch (this.frontBody.direction) {\n          // 根据父关节的当前移动方向,决定此关节的位置\n          case 1:// 上\n              this.setPosition(frontX, frontY - frontHeight / 2 - height / 2 - 1);\n              break;\n          case 2:// 下\n              this.setPosition(frontX, frontY + frontHeight / 2 + height / 2 + 1);\n              break;\n          case 3:// 左\n              this.setPosition(frontX + frontWidth / 2 + width / 2 + 1, frontY);\n              break;\n          case 4:// 右\n              this.setPosition(frontX - frontWidth / 2 - width / 2 - 1, frontY);\n              break;\n      }\n  }\n  return true;\n}\n```\n有了这三个属性，每一个节点还应该有最重要的游戏逻辑——move方法，每一个关节分别调用move方法，从游戏场景中就能看到整条蛇按照预定方向进行移动，而整条蛇的运动方向就是跟着头部关节的方向走，头部关节的方向则通过点击屏幕区域控制。\n在move方法中，我们需要做以下事情：\n```\n1.按照关节的下次移动方向移动本身长度的像素的距离\n2.如果是头部关节，需要改变关节纹理\n```\n同时，如果是头部关节，我们还需要判断以下三个临界条件：\n```\n1.头部关节是否触碰到屏幕边界\n2.头部关节是否吃到屏幕中的豆子\n3.头部关节是否触碰到自身关节\n```\n其中1、3条件达成，则判定游戏结束，2条件达成，则能增加游戏分数，并且游戏继续。\nmove方法代码如下：\n```javascript\n// 关节移动方法\nmove: function (layer) {\n    var star = layer.star;\n    var direct;\n    if (this.frontBody == null) {\n        // 头部关节按照自身的下次方向行走\n        direct = this.nextDirection;\n    } else {\n        // 身体关节按照父关节的当前方向行走,并将福关节的当前方向设置为自身的下次方向\n        this.nextDirection = direct = this.frontBody.direction;\n    }\n    switch (direct) {\n        case 1:// 上\n            this.setPosition(this.getPositionX(), this.getPositionY() + Constants.speed);\n            // this.runAction(cc.moveBy(Constants.frequency, cc.p(0, Constants.speed), 0))\n            break;\n        case 2:// 下\n            this.setPosition(this.getPositionX(), this.getPositionY() - Constants.speed);\n            // this.runAction(cc.moveBy(Constants.frequency, cc.p(0, -Constants.speed), 0))\n            break;\n        case 3:// 左\n            this.setPosition(this.getPositionX() - Constants.speed, this.getPositionY());\n            // this.runAction(cc.moveBy(Constants.frequency, cc.p(-Constants.speed, 0), 0))\n            break;\n        case 4:// 右\n            this.setPosition(this.getPositionX() + Constants.speed, this.getPositionY());\n            // this.runAction(cc.moveBy(Constants.frequency, cc.p(Constants.speed, 0), 0))\n            break;\n    }\n    if (this.frontBody == null) {\n        switch (this.nextDirection) {\n            // 头部关节需要设置头部不同方向的纹理\n            case 1:// 上\n                this.setTexture(res.head_up);\n                break;\n            case 2:// 下\n                this.setTexture(res.head_down);\n                break;\n            case 3:// 左\n                this.setTexture(res.head_left);\n                break;\n            case 4:// 右\n                this.setTexture(res.head_right);\n                break;\n        }\n        // 头部关节判断是否触碰到边界\n        var size = cc.winSize;\n        if ((this.getPositionX() > size.width - this.width / 2)\n            || (this.getPositionX() < this.width / 2)\n            || (this.getPositionY() > size.height - this.height / 2)\n            || (this.getPositionY() < this.height / 2)) {\n            // 判断触碰边界\n            cc.log(\"game over\");\n            return false;\n        }\n        // 判断是否触碰到自己身体关节\n        for (var index in layer.bodys) {\n            if (layer.bodys[index] != this && cc.rectIntersectsRect(this.getBoundingBox(), layer.bodys[index].getBoundingBox())) {\n                return false;\n            }\n        }\n        // 判断是否吃到星星\n        if (star != null) {\n            if (cc.rectIntersectsRect(this.getBoundingBox(), star.getBoundingBox())) {\n                star.runAction(\n                    cc.sequence(cc.spawn(\n                        cc.scaleTo(0.2, 3),\n                        cc.fadeOut(0.2)\n                    ), cc.callFunc(function (star) {\n                        star.removeFromParent();\n                    }, star))\n                );\n                // 清除星星\n                layer.star = null;\n                // 添加身体\n                layer.canNewBody = 1;\n                // 改变分数\n                layer.score.setString(\"\" + (Number(layer.score.getString()) + Math.round(Math.random() * 3 + 1)));\n                layer.score.runAction(cc.sequence(cc.scaleTo(0.1, 2), cc.scaleTo(0.1, 0.5), cc.scaleTo(0.1, 1)));\n            }\n        }\n    }\n    return true;\n}\n```\n#### 游戏场景类\n在游戏场景中我们需要以下几个变量：\n```\n1. 贪吃蛇数组：用于存储贪吃蛇所有的关节节点\n2. 贪吃蛇尾部：每添加一个关节节点 ，都将此变量指向这个新加的节点，以便下次继续再尾部节点添加\n3. 吃的星星：屏幕中随机产生的星星，用于判断头部关节是否与它产生碰撞\n4. 是否添加节点：如果在定时任务中判断到吃到星星，那么可以次变量为1，代表可以添加一个节点\n5. 分数：存储游戏中累加的分数\n```\n在cc.Layer的构造函数中对以上变量进行初始化，代码如下：\n```javascript\nvar GameLayer = cc.Layer.extend({\n  bodys: [],// snake body\n  tail: null,// snake tail\n  star: null,// star\n  canNewBody: 0,// 0-无,1-有\n  score: null,// 分数Label\n  ctor: function () {\n      // 初始化全局参数\n      this._super();\n      this.bodys = [];\n      this.canNewBody = 0;\n      this.star = null;\n      this.tail = null;\n      this.score = null;\n      return true;\n  }\n}\n```\n之后，我们首先需要在场景中绘制出一条蛇，初始化定义为1个头部关节，5个身体关节，由于我们对关节类做了很好的封装，所以初始化一条蛇的代码很简单，我们在onEnter方法中进行初始化，如下所示：\n```javascript\n// 初始化一条蛇\n// 初始化头部\nvar head = new SnakeBody(null, 4);\nhead.setPosition(300, 300);\nthis.addChild(head);\nthis.bodys.push(head);\nhead.setTag(1);\nthis.tail = head;\n// 循环添加5个身体\nfor (var i = 0; i < 5; i++) {\n    var node = new SnakeBody(this.tail, this.tail.direction);\n    this.addChild(node);\n    this.bodys.push(node);\n    this.tail = node;\n}\n```\n初始化完了之后蛇是不会动的，如何让它动起来呢，我们就要用到在关节类中封装的move方法了，我们每隔一个时间，对所有的关节类执行一次move方法，就能实现蛇的移动，首先在onEnter中添加定时任务：\n```javascript\n// 蛇移动的定时任务\nthis.schedule(this.snakeMove, Constants.frequency);\n```\n在这个snakeMove定时调用的方法中，我们要写出所有关节移动的逻辑，在这个方法中，我们需要完成以下几件事：\n```\n1. 遍历蛇的所有关节，每个关节执行一遍move方法，并在move完了之后，将下次移动方法变为本次移动方向\n2. 如果需要新增关节，在遍历完成之后，新增一个关节类，并将其父节点指向之前的蛇尾节点，并把蛇尾指向新加的这个关节\n```\n代码如下：\n```javascript\n// 蛇关节移动方法\nsnakeMove: function () {\n    for (var index in this.bodys) {\n        // 循环执行移动方法,并返回移动结果,false即视为游戏结束\n        if (!this.bodys[index].move(this)) {\n            // 执行移动方法,移动失败,游戏结束\n            this.unschedule(this.snakeMove);\n            this.unschedule(this.updateStar);\n            var overScene = new OverScene(Number(this.score.getString()), false);\n            cc.director.runScene(new cc.TransitionFade(1, overScene));\n        }\n    }\n    for (var index in this.bodys) {\n        // 本轮所有关节移动结束,所有节点的当前方向赋值为下一次的方向\n        this.bodys[index].direction = this.bodys[index].nextDirection;\n    }\n    if (this.canNewBody == 1) {\n        // 如果新增关节为1,增加关节\n        var node = new SnakeBody(this.tail, this.tail.direction);\n        this.addChild(node);\n        this.bodys.push(node);\n        this.tail = node;\n        this.canNewBody = 0;\n    }\n}\n```\n目前为止这条蛇是只会按照我们初始化的方向一直走到碰壁，然后游戏结束的，如何改变蛇的运动轨迹呢？前面说到了，蛇头部节点的下次移动方向的改变，即可对整个蛇的移动轨迹进行改变，这里我们可以通过点击屏幕实现蛇头的下次移动方向的改变。\n首先在onEnter方法中添加触摸事件监听：\n```javascript\n// 添加屏幕触摸事件\ncc.eventManager.addListener({\n    event: cc.EventListener.TOUCH_ONE_BY_ONE,\n    swallowTouches: true,\n    onTouchBegan: this.touchbegan,\n    onTouchMoved: this.touchmoved,\n    onTouchEnded: this.touchended\n}, this);\n```\n然后在onTouchBegan方法中实现点击事件，我们可以允许点击有一个10像素的误差：\n```javascript\n// 点击转向\ntouchbegan: function (touch, event) {\n    var x = touch.getLocation().x;\n    var y = touch.getLocation().y;\n    var head = event.getCurrentTarget().getChildByTag(1);\n    var headX = head.getPositionX();\n    var headY = head.getPositionY();\n    switch (head.direction) {\n        case 1:// 上\n        case 2:// 下\n            if (x <= headX - Constants.errDistance) {// 转左\n                head.nextDirection = 3;\n            } else if (x >= headX + Constants.errDistance) {// 转右\n                head.nextDirection = 4;\n            }\n            break;\n        case 3:// 左\n        case 4:// 右\n            if (y <= headY - Constants.errDistance) {// 转下\n                head.nextDirection = 2;\n            } else if (y >= headY + Constants.errDistance) {// 转上\n                head.nextDirection = 1;\n            }\n            break;\n    }\n    return true;\n}\n```\n最后我们只差最后一步，就是蛇要吃的星星，我们可以在屏幕中任意位置随机产生一颗星星（又或者叫豆子，这都无所谓），只要这个星星满足以下条件，那么它就可以被绘制出来，否则我们需要重新随机这个星星的位置：\n```\n1. 星星在游戏场景的屏幕范围内\n2. 星星不能与蛇的身体部分重叠\n```\n代码如下：\n```javascript\n// 更新星星\nupdateStar: function () {\n    if (this.star == null) {\n        this.star = new cc.Sprite(res.bean);\n        var randomX = Math.random() * (cc.winSize.width - this.star.width) + this.star.width;\n        var randomY = Math.random() * (cc.winSize.height - this.star.width) + this.star.height;\n        this.star.setPosition(randomX, randomY);\n        this.addChild(this.star);\n        // 产生的星星只要在屏幕外,或与蛇的身体部分重叠,则本次任务不产生\n        if ((randomX > cc.winSize.width - this.star.width / 2)\n            || (randomX < this.star.width / 2)\n            || (randomY > cc.winSize.height - this.star.height / 2)\n            || (randomY < this.star.height / 2)) {\n            cc.log(\"update star:out of screen\");\n            this.removeChild(this.star);\n            this.star = null;\n            return;\n        }\n        for (var index in this.bodys) {\n            if (cc.rectIntersectsRect(this.bodys[index].getBoundingBox(), this.star.getBoundingBox())) {\n                cc.log(\"update star:intersect with self\");\n                this.removeChild(this.star);\n                this.star = null;\n                return;\n            }\n        }\n    }\n}\n```\n至此，游戏的主要逻辑就大功告成了！贪吃蛇不仅能在屏幕中游走，还能吃星星，并且碰到自身或边缘都会GameOver！\n#### 开始/结束场景类\n说到GameOver，那么就必须要有一个Over的场景类了，毕竟有了开始场景，游戏场景和结束场景，才算得上一个完成的游戏流程嘛，结束场景类的实现很简单，只需要把游戏场景中获得的分数传递进来，然后在Label中展示即可，代码如下：\n```javascript\nvar OverLayer = cc.Layer.extend({\n    sprite: null,\n    score: 0,\n    ctor: function (score) {\n        this._super();\n        this.score = score;\n        return true;\n    },\n    onEnter: function () {\n        this._super();\n        var size = cc.winSize;\n        var over = new cc.LabelTTF(\"Game Over,你的分数是:\" + this.score, \"Arial\", 38);\n        over.setPosition(size.width / 2, size.height / 2);\n        this.addChild(over);\n        over.runAction(cc.sequence(cc.scaleTo(0.2, 2), cc.scaleTo(0.2, 0.5), cc.scaleTo(0.2, 1)));\n        var start = new cc.MenuItemFont(\"再来一次\", function () {\n            cc.director.runScene(new cc.TransitionFade(1, new HelloWorldScene()));\n        }, this);\n        start.setPosition(over.getPositionX(), over.getPositionY() - over.height / 2 - 50);\n        var menu = new cc.Menu(start);\n        this.addChild(menu);\n        menu.setPosition(0, 0);\n        return true;\n    }\n});\n\nvar OverScene = cc.Scene.extend({\n    score: 0,\n    ctor: function (score) {\n        this._super();\n        this.score = score;\n        return true;\n    },\n    onEnter: function () {\n        this._super();\n        var layer = new OverLayer(this.score);\n        this.addChild(layer);\n    }\n});\n```\n与结束场景一样，开始场景也只需一个Label一个Menu即可，代码如下：\n```javascript\nvar HelloWorldLayer = cc.Layer.extend({\n    sprite: null,\n    ctor: function () {\n        this._super();\n        var size = cc.winSize;\n        var helloLabel = new cc.LabelTTF(\"贪吃蛇\", \"Arial\", 38);\n        helloLabel.x = size.width / 2;\n        helloLabel.y = size.height / 2 + 200;\n        this.addChild(helloLabel, 5);\n        var start = new cc.MenuItemFont(\"开始游戏\", function () {\n            cc.director.runScene(new cc.TransitionFade(1, new GameScene()));\n        }, this);\n        var menu = new cc.Menu(start);\n        this.addChild(menu);\n        return true;\n    }\n});\n\nvar HelloWorldScene = cc.Scene.extend({\n    onEnter: function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n    }\n});\n```\n这样，我们就能形成一个完成游戏流程了，游戏加载进入游戏开始场景，点击开始游戏进行如主游戏场景，游戏结束后进入结束场景，结束场景点击“再来一次”又可以回到开始场景。\n### 运行效果\n最后的运行效果如下\n![贪吃蛇效果图](http://7xnnwn.com1.z0.glb.clouddn.com/snake.gif)\n通过CVP平台的项目托管可看到实际运行效果，地址如下：\nhttp://www.cocoscvp.com/usercode/2e17b3cd9586a574140e0bb765bad21673fc7686/\n### 源代码\n所有源代码均上传到github，欢迎交流学习，地址：\nhttps://github.com/hjcenry/snake","slug":"Cocos2d-JS实现的贪吃蛇","published":1,"updated":"2016-08-03T13:14:14.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhvs004zwsaz29zfcpxp","content":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>相信贪吃蛇大家都玩儿过，我对贪吃蛇的印象就是在电子词典上，一只像素蛇在屏幕游走，饥渴难耐，看着豆子就要去吃，吃到豆子就会长一节，当蛇的身体越来越长的时候，它才发现这个世界变了，每走一步，都是寸步难行。<a id=\"more\"></a>当它的蛇头触碰到任意的物体，无论是屏幕边界还是自己的身体，游戏都将结束。这款游戏应该是比较经典的一个童年记忆。刚接触游戏开发的人可能比较喜欢以这款游戏入手，因为贪吃蛇包含了很多游戏开发中的原理，并且难度也不大，而我刚好在学习Cocos CVP的课程，学习在一个中间阶段，我也来拿这个练练手，以下就把我做贪吃蛇的过程分享出来。</p>\n<h3 id=\"游戏分析\"><a href=\"#游戏分析\" class=\"headerlink\" title=\"游戏分析\"></a>游戏分析</h3><h4 id=\"身体关节\"><a href=\"#身体关节\" class=\"headerlink\" title=\"身体关节\"></a>身体关节</h4><p>贪吃蛇的实现可能有多种方法，但今天，我想用面向对象的思想来对游戏进行设计，到今天，任何的程序开发都离不开面向对象的思想，通过面向对象的思想我们能把很多抽象的问题具象化，方便我们解决很多问题。而在贪吃蛇中，面向对象的思想依然实用。<br>在贪吃蛇中，我们可以把一条游走的蛇的每个关节当做是一个对象，而蛇本身是由多个关节组成的整体，当每个关节在移动时，我们就能看到整个蛇的移动，每个关节的位置以及移动方向都跟它的上一个关节息息相关，那么我们就可以把关节与它的上一个关节关联起来，实现如下结构：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/snake1.png\" alt=\"蛇关节关系图\"></p>\n<h4 id=\"移动方向\"><a href=\"#移动方向\" class=\"headerlink\" title=\"移动方向\"></a>移动方向</h4><p>如上文所说，按照上面的关节关系来实现，那么蛇的移动方向就是与父节点的移动方向相关联，每一个关节应该有一个当前移动方向和下次移动方向，每一步的移动，都是跟着当前移动方向走的，而父关节的当前移动的方向即为子关节的下次移动方向，这样，只需要调整蛇头关节的下次移动方向，整条蛇就能顺着各自的父关节方向移动，蛇的移动方向图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/snakemove.png\" alt=\"蛇的移动方向图\"></p>\n<h3 id=\"开发设计\"><a href=\"#开发设计\" class=\"headerlink\" title=\"开发设计\"></a>开发设计</h3><h4 id=\"项目结构\"><a href=\"#项目结构\" class=\"headerlink\" title=\"项目结构\"></a>项目结构</h4><p>按照前面的设计，我们可以大致可以划分出游戏场景类和关节类，进入游戏场景类，再将一些全局的变量单独存在一个类中，项目结构可划分如下图：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/snake%E7%BB%93%E6%9E%84%E5%9B%BE.png\" alt=\"项目结构图\"></p>\n<h4 id=\"全局变量类\"><a href=\"#全局变量类\" class=\"headerlink\" title=\"全局变量类\"></a>全局变量类</h4><p>游戏中的全局变量，提炼为一个全局变量类，其中参数可以根据需求灵活变动配置</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Constants = &#123;</span><br><span class=\"line\">    frequency: <span class=\"number\">0.2</span>,<span class=\"comment\">// 刷新频率</span></span><br><span class=\"line\">    speed: <span class=\"number\">31</span>,<span class=\"comment\">// 每帧移动距离,身体节点大小+1像素间隔</span></span><br><span class=\"line\">    errDistance: <span class=\"number\">10</span>,<span class=\"comment\">// 偏差举例</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"关节类\"><a href=\"#关节类\" class=\"headerlink\" title=\"关节类\"></a>关节类</h4><p>按照以上设计的结构，每一个关节对象都应该包含蛇的当前方向、下次方向和蛇的父节点三个属性，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> SnakeBody = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    frontBody: <span class=\"literal\">null</span>,<span class=\"comment\">//上一个身体关节,没有则为头部</span></span><br><span class=\"line\">    nextDirection: <span class=\"number\">0</span>,<span class=\"comment\">// 1-上,2-下,3-左,4-右</span></span><br><span class=\"line\">    direction: <span class=\"number\">0</span>,<span class=\"comment\">// 1-上,2-下,3-左,4-右</span></span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">frontBody, direction</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.frontBody = frontBody;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.direction = direction;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.nextDirection = direction;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面说的，关节的位置跟它的福关节的位置是息息相关的，那么初始化的时候，我们就需要根据父关节的移动方向来进行次关节的位置设置，这部分代码，我们可以放在onEnter方法中，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.frontBody == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 蛇头部关节,设置头部纹理</span></span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (<span class=\"built_in\">this</span>.direction) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setTexture(res.head_up);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setTexture(res.head_down);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setTexture(res.head_left);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setTexture(res.head_right);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 蛇身体关节</span></span><br><span class=\"line\">      <span class=\"comment\">// 设置纹理</span></span><br><span class=\"line\">      <span class=\"built_in\">this</span>.setTexture(res.body);</span><br><span class=\"line\">      <span class=\"comment\">// 设置关节位置</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> frontX = <span class=\"built_in\">this</span>.frontBody.getPositionX();</span><br><span class=\"line\">      <span class=\"keyword\">var</span> frontY = <span class=\"built_in\">this</span>.frontBody.getPositionY();</span><br><span class=\"line\">      <span class=\"keyword\">var</span> frontWidth = <span class=\"built_in\">this</span>.frontBody.width;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> frontHeight = <span class=\"built_in\">this</span>.frontBody.height;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> width = <span class=\"built_in\">this</span>.width;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> height = <span class=\"built_in\">this</span>.height;</span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (<span class=\"built_in\">this</span>.frontBody.direction) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// 根据父关节的当前移动方向,决定此关节的位置</span></span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">1</span>:<span class=\"comment\">// 上</span></span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setPosition(frontX, frontY - frontHeight / <span class=\"number\">2</span> - height / <span class=\"number\">2</span> - <span class=\"number\">1</span>);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">2</span>:<span class=\"comment\">// 下</span></span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setPosition(frontX, frontY + frontHeight / <span class=\"number\">2</span> + height / <span class=\"number\">2</span> + <span class=\"number\">1</span>);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">3</span>:<span class=\"comment\">// 左</span></span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setPosition(frontX + frontWidth / <span class=\"number\">2</span> + width / <span class=\"number\">2</span> + <span class=\"number\">1</span>, frontY);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">4</span>:<span class=\"comment\">// 右</span></span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setPosition(frontX - frontWidth / <span class=\"number\">2</span> - width / <span class=\"number\">2</span> - <span class=\"number\">1</span>, frontY);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>有了这三个属性，每一个节点还应该有最重要的游戏逻辑——move方法，每一个关节分别调用move方法，从游戏场景中就能看到整条蛇按照预定方向进行移动，而整条蛇的运动方向就是跟着头部关节的方向走，头部关节的方向则通过点击屏幕区域控制。<br>在move方法中，我们需要做以下事情：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.按照关节的下次移动方向移动本身长度的像素的距离</span><br><span class=\"line\">2.如果是头部关节，需要改变关节纹理</span><br></pre></td></tr></table></figure>\n<p>同时，如果是头部关节，我们还需要判断以下三个临界条件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.头部关节是否触碰到屏幕边界</span><br><span class=\"line\">2.头部关节是否吃到屏幕中的豆子</span><br><span class=\"line\">3.头部关节是否触碰到自身关节</span><br></pre></td></tr></table></figure>\n<p>其中1、3条件达成，则判定游戏结束，2条件达成，则能增加游戏分数，并且游戏继续。<br>move方法代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 关节移动方法</span></span><br><span class=\"line\">move: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">layer</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> star = layer.star;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> direct;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.frontBody == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 头部关节按照自身的下次方向行走</span></span><br><span class=\"line\">        direct = <span class=\"built_in\">this</span>.nextDirection;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 身体关节按照父关节的当前方向行走,并将福关节的当前方向设置为自身的下次方向</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.nextDirection = direct = <span class=\"built_in\">this</span>.frontBody.direction;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (direct) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:<span class=\"comment\">// 上</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.setPosition(<span class=\"built_in\">this</span>.getPositionX(), <span class=\"built_in\">this</span>.getPositionY() + Constants.speed);</span><br><span class=\"line\">            <span class=\"comment\">// this.runAction(cc.moveBy(Constants.frequency, cc.p(0, Constants.speed), 0))</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:<span class=\"comment\">// 下</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.setPosition(<span class=\"built_in\">this</span>.getPositionX(), <span class=\"built_in\">this</span>.getPositionY() - Constants.speed);</span><br><span class=\"line\">            <span class=\"comment\">// this.runAction(cc.moveBy(Constants.frequency, cc.p(0, -Constants.speed), 0))</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:<span class=\"comment\">// 左</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.setPosition(<span class=\"built_in\">this</span>.getPositionX() - Constants.speed, <span class=\"built_in\">this</span>.getPositionY());</span><br><span class=\"line\">            <span class=\"comment\">// this.runAction(cc.moveBy(Constants.frequency, cc.p(-Constants.speed, 0), 0))</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:<span class=\"comment\">// 右</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.setPosition(<span class=\"built_in\">this</span>.getPositionX() + Constants.speed, <span class=\"built_in\">this</span>.getPositionY());</span><br><span class=\"line\">            <span class=\"comment\">// this.runAction(cc.moveBy(Constants.frequency, cc.p(Constants.speed, 0), 0))</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.frontBody == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (<span class=\"built_in\">this</span>.nextDirection) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 头部关节需要设置头部不同方向的纹理</span></span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:<span class=\"comment\">// 上</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.setTexture(res.head_up);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:<span class=\"comment\">// 下</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.setTexture(res.head_down);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:<span class=\"comment\">// 左</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.setTexture(res.head_left);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">4</span>:<span class=\"comment\">// 右</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.setTexture(res.head_right);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 头部关节判断是否触碰到边界</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((<span class=\"built_in\">this</span>.getPositionX() &gt; size.width - <span class=\"built_in\">this</span>.width / <span class=\"number\">2</span>)</span><br><span class=\"line\">            || (<span class=\"built_in\">this</span>.getPositionX() &lt; <span class=\"built_in\">this</span>.width / <span class=\"number\">2</span>)</span><br><span class=\"line\">            || (<span class=\"built_in\">this</span>.getPositionY() &gt; size.height - <span class=\"built_in\">this</span>.height / <span class=\"number\">2</span>)</span><br><span class=\"line\">            || (<span class=\"built_in\">this</span>.getPositionY() &lt; <span class=\"built_in\">this</span>.height / <span class=\"number\">2</span>)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 判断触碰边界</span></span><br><span class=\"line\">            cc.log(<span class=\"string\">&quot;game over&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 判断是否触碰到自己身体关节</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> index <span class=\"keyword\">in</span> layer.bodys) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (layer.bodys[index] != <span class=\"built_in\">this</span> &amp;&amp; cc.rectIntersectsRect(<span class=\"built_in\">this</span>.getBoundingBox(), layer.bodys[index].getBoundingBox())) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 判断是否吃到星星</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (star != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cc.rectIntersectsRect(<span class=\"built_in\">this</span>.getBoundingBox(), star.getBoundingBox())) &#123;</span><br><span class=\"line\">                star.runAction(</span><br><span class=\"line\">                    cc.sequence(cc.spawn(</span><br><span class=\"line\">                        cc.scaleTo(<span class=\"number\">0.2</span>, <span class=\"number\">3</span>),</span><br><span class=\"line\">                        cc.fadeOut(<span class=\"number\">0.2</span>)</span><br><span class=\"line\">                    ), cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">star</span>) </span>&#123;</span><br><span class=\"line\">                        star.removeFromParent();</span><br><span class=\"line\">                    &#125;, star))</span><br><span class=\"line\">                );</span><br><span class=\"line\">                <span class=\"comment\">// 清除星星</span></span><br><span class=\"line\">                layer.star = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"comment\">// 添加身体</span></span><br><span class=\"line\">                layer.canNewBody = <span class=\"number\">1</span>;</span><br><span class=\"line\">                <span class=\"comment\">// 改变分数</span></span><br><span class=\"line\">                layer.score.setString(<span class=\"string\">&quot;&quot;</span> + (<span class=\"built_in\">Number</span>(layer.score.getString()) + <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">3</span> + <span class=\"number\">1</span>)));</span><br><span class=\"line\">                layer.score.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.1</span>, <span class=\"number\">2</span>), cc.scaleTo(<span class=\"number\">0.1</span>, <span class=\"number\">0.5</span>), cc.scaleTo(<span class=\"number\">0.1</span>, <span class=\"number\">1</span>)));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"游戏场景类\"><a href=\"#游戏场景类\" class=\"headerlink\" title=\"游戏场景类\"></a>游戏场景类</h4><p>在游戏场景中我们需要以下几个变量：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. 贪吃蛇数组：用于存储贪吃蛇所有的关节节点</span><br><span class=\"line\">2. 贪吃蛇尾部：每添加一个关节节点 ，都将此变量指向这个新加的节点，以便下次继续再尾部节点添加</span><br><span class=\"line\">3. 吃的星星：屏幕中随机产生的星星，用于判断头部关节是否与它产生碰撞</span><br><span class=\"line\">4. 是否添加节点：如果在定时任务中判断到吃到星星，那么可以次变量为1，代表可以添加一个节点</span><br><span class=\"line\">5. 分数：存储游戏中累加的分数</span><br></pre></td></tr></table></figure>\n<p>在cc.Layer的构造函数中对以上变量进行初始化，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> GameLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">  bodys: [],<span class=\"comment\">// snake body</span></span><br><span class=\"line\">  tail: <span class=\"literal\">null</span>,<span class=\"comment\">// snake tail</span></span><br><span class=\"line\">  star: <span class=\"literal\">null</span>,<span class=\"comment\">// star</span></span><br><span class=\"line\">  canNewBody: <span class=\"number\">0</span>,<span class=\"comment\">// 0-无,1-有</span></span><br><span class=\"line\">  score: <span class=\"literal\">null</span>,<span class=\"comment\">// 分数Label</span></span><br><span class=\"line\">  ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 初始化全局参数</span></span><br><span class=\"line\">      <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.bodys = [];</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.canNewBody = <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.star = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.tail = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.score = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>之后，我们首先需要在场景中绘制出一条蛇，初始化定义为1个头部关节，5个身体关节，由于我们对关节类做了很好的封装，所以初始化一条蛇的代码很简单，我们在onEnter方法中进行初始化，如下所示：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 初始化一条蛇</span></span><br><span class=\"line\"><span class=\"comment\">// 初始化头部</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> head = <span class=\"keyword\">new</span> SnakeBody(<span class=\"literal\">null</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\">head.setPosition(<span class=\"number\">300</span>, <span class=\"number\">300</span>);</span><br><span class=\"line\"><span class=\"built_in\">this</span>.addChild(head);</span><br><span class=\"line\"><span class=\"built_in\">this</span>.bodys.push(head);</span><br><span class=\"line\">head.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"built_in\">this</span>.tail = head;</span><br><span class=\"line\"><span class=\"comment\">// 循环添加5个身体</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> node = <span class=\"keyword\">new</span> SnakeBody(<span class=\"built_in\">this</span>.tail, <span class=\"built_in\">this</span>.tail.direction);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(node);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bodys.push(node);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.tail = node;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>初始化完了之后蛇是不会动的，如何让它动起来呢，我们就要用到在关节类中封装的move方法了，我们每隔一个时间，对所有的关节类执行一次move方法，就能实现蛇的移动，首先在onEnter中添加定时任务：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 蛇移动的定时任务</span></span><br><span class=\"line\"><span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.snakeMove, Constants.frequency);</span><br></pre></td></tr></table></figure>\n<p>在这个snakeMove定时调用的方法中，我们要写出所有关节移动的逻辑，在这个方法中，我们需要完成以下几件事：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. 遍历蛇的所有关节，每个关节执行一遍move方法，并在move完了之后，将下次移动方法变为本次移动方向</span><br><span class=\"line\">2. 如果需要新增关节，在遍历完成之后，新增一个关节类，并将其父节点指向之前的蛇尾节点，并把蛇尾指向新加的这个关节</span><br></pre></td></tr></table></figure>\n<p>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 蛇关节移动方法</span></span><br><span class=\"line\">snakeMove: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> index <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.bodys) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 循环执行移动方法,并返回移动结果,false即视为游戏结束</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.bodys[index].move(<span class=\"built_in\">this</span>)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 执行移动方法,移动失败,游戏结束</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.snakeMove);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.updateStar);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> overScene = <span class=\"keyword\">new</span> OverScene(<span class=\"built_in\">Number</span>(<span class=\"built_in\">this</span>.score.getString()), <span class=\"literal\">false</span>);</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, overScene));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> index <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.bodys) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 本轮所有关节移动结束,所有节点的当前方向赋值为下一次的方向</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.bodys[index].direction = <span class=\"built_in\">this</span>.bodys[index].nextDirection;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.canNewBody == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 如果新增关节为1,增加关节</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> node = <span class=\"keyword\">new</span> SnakeBody(<span class=\"built_in\">this</span>.tail, <span class=\"built_in\">this</span>.tail.direction);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(node);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.bodys.push(node);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.tail = node;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.canNewBody = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>目前为止这条蛇是只会按照我们初始化的方向一直走到碰壁，然后游戏结束的，如何改变蛇的运动轨迹呢？前面说到了，蛇头部节点的下次移动方向的改变，即可对整个蛇的移动轨迹进行改变，这里我们可以通过点击屏幕实现蛇头的下次移动方向的改变。<br>首先在onEnter方法中添加触摸事件监听：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 添加屏幕触摸事件</span></span><br><span class=\"line\">cc.eventManager.addListener(&#123;</span><br><span class=\"line\">    event: cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">    swallowTouches: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    onTouchBegan: <span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">    onTouchMoved: <span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">    onTouchEnded: <span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">&#125;, <span class=\"built_in\">this</span>);</span><br></pre></td></tr></table></figure>\n<p>然后在onTouchBegan方法中实现点击事件，我们可以允许点击有一个10像素的误差：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 点击转向</span></span><br><span class=\"line\">touchbegan: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">touch, event</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> x = touch.getLocation().x;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> y = touch.getLocation().y;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> head = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> headX = head.getPositionX();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> headY = head.getPositionY();</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (head.direction) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:<span class=\"comment\">// 上</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:<span class=\"comment\">// 下</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (x &lt;= headX - Constants.errDistance) &#123;<span class=\"comment\">// 转左</span></span><br><span class=\"line\">                head.nextDirection = <span class=\"number\">3</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (x &gt;= headX + Constants.errDistance) &#123;<span class=\"comment\">// 转右</span></span><br><span class=\"line\">                head.nextDirection = <span class=\"number\">4</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:<span class=\"comment\">// 左</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:<span class=\"comment\">// 右</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (y &lt;= headY - Constants.errDistance) &#123;<span class=\"comment\">// 转下</span></span><br><span class=\"line\">                head.nextDirection = <span class=\"number\">2</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (y &gt;= headY + Constants.errDistance) &#123;<span class=\"comment\">// 转上</span></span><br><span class=\"line\">                head.nextDirection = <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>最后我们只差最后一步，就是蛇要吃的星星，我们可以在屏幕中任意位置随机产生一颗星星（又或者叫豆子，这都无所谓），只要这个星星满足以下条件，那么它就可以被绘制出来，否则我们需要重新随机这个星星的位置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. 星星在游戏场景的屏幕范围内</span><br><span class=\"line\">2. 星星不能与蛇的身体部分重叠</span><br></pre></td></tr></table></figure>\n<p>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 更新星星</span></span><br><span class=\"line\">updateStar: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.star == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.star = <span class=\"keyword\">new</span> cc.Sprite(res.bean);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> randomX = <span class=\"built_in\">Math</span>.random() * (cc.winSize.width - <span class=\"built_in\">this</span>.star.width) + <span class=\"built_in\">this</span>.star.width;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> randomY = <span class=\"built_in\">Math</span>.random() * (cc.winSize.height - <span class=\"built_in\">this</span>.star.width) + <span class=\"built_in\">this</span>.star.height;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.star.setPosition(randomX, randomY);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.star);</span><br><span class=\"line\">        <span class=\"comment\">// 产生的星星只要在屏幕外,或与蛇的身体部分重叠,则本次任务不产生</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((randomX &gt; cc.winSize.width - <span class=\"built_in\">this</span>.star.width / <span class=\"number\">2</span>)</span><br><span class=\"line\">            || (randomX &lt; <span class=\"built_in\">this</span>.star.width / <span class=\"number\">2</span>)</span><br><span class=\"line\">            || (randomY &gt; cc.winSize.height - <span class=\"built_in\">this</span>.star.height / <span class=\"number\">2</span>)</span><br><span class=\"line\">            || (randomY &lt; <span class=\"built_in\">this</span>.star.height / <span class=\"number\">2</span>)) &#123;</span><br><span class=\"line\">            cc.log(<span class=\"string\">&quot;update star:out of screen&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.removeChild(<span class=\"built_in\">this</span>.star);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.star = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> index <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.bodys) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cc.rectIntersectsRect(<span class=\"built_in\">this</span>.bodys[index].getBoundingBox(), <span class=\"built_in\">this</span>.star.getBoundingBox())) &#123;</span><br><span class=\"line\">                cc.log(<span class=\"string\">&quot;update star:intersect with self&quot;</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.removeChild(<span class=\"built_in\">this</span>.star);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.star = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>至此，游戏的主要逻辑就大功告成了！贪吃蛇不仅能在屏幕中游走，还能吃星星，并且碰到自身或边缘都会GameOver！</p>\n<h4 id=\"开始-结束场景类\"><a href=\"#开始-结束场景类\" class=\"headerlink\" title=\"开始/结束场景类\"></a>开始/结束场景类</h4><p>说到GameOver，那么就必须要有一个Over的场景类了，毕竟有了开始场景，游戏场景和结束场景，才算得上一个完成的游戏流程嘛，结束场景类的实现很简单，只需要把游戏场景中获得的分数传递进来，然后在Label中展示即可，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> OverLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    score: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">score</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.score = score;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> over = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;Game Over,你的分数是:&quot;</span> + <span class=\"built_in\">this</span>.score, <span class=\"string\">&quot;Arial&quot;</span>, <span class=\"number\">38</span>);</span><br><span class=\"line\">        over.setPosition(size.width / <span class=\"number\">2</span>, size.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(over);</span><br><span class=\"line\">        over.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>, <span class=\"number\">2</span>), cc.scaleTo(<span class=\"number\">0.2</span>, <span class=\"number\">0.5</span>), cc.scaleTo(<span class=\"number\">0.2</span>, <span class=\"number\">1</span>)));</span><br><span class=\"line\">        <span class=\"keyword\">var</span> start = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;再来一次&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> HelloWorldScene()));</span><br><span class=\"line\">        &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        start.setPosition(over.getPositionX(), over.getPositionY() - over.height / <span class=\"number\">2</span> - <span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(start);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    score: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">score</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.score = score;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> OverLayer(<span class=\"built_in\">this</span>.score);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>与结束场景一样，开始场景也只需一个Label一个Menu即可，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helloLabel = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;贪吃蛇&quot;</span>, <span class=\"string\">&quot;Arial&quot;</span>, <span class=\"number\">38</span>);</span><br><span class=\"line\">        helloLabel.x = size.width / <span class=\"number\">2</span>;</span><br><span class=\"line\">        helloLabel.y = size.height / <span class=\"number\">2</span> + <span class=\"number\">200</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(helloLabel, <span class=\"number\">5</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> start = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;开始游戏&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> GameScene()));</span><br><span class=\"line\">        &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(start);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>这样，我们就能形成一个完成游戏流程了，游戏加载进入游戏开始场景，点击开始游戏进行如主游戏场景，游戏结束后进入结束场景，结束场景点击“再来一次”又可以回到开始场景。</p>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p>最后的运行效果如下<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/snake.gif\" alt=\"贪吃蛇效果图\"><br>通过CVP平台的项目托管可看到实际运行效果，地址如下：<br><a href=\"http://www.cocoscvp.com/usercode/2e17b3cd9586a574140e0bb765bad21673fc7686/\">http://www.cocoscvp.com/usercode/2e17b3cd9586a574140e0bb765bad21673fc7686/</a></p>\n<h3 id=\"源代码\"><a href=\"#源代码\" class=\"headerlink\" title=\"源代码\"></a>源代码</h3><p>所有源代码均上传到github，欢迎交流学习，地址：<br><a href=\"https://github.com/hjcenry/snake\">https://github.com/hjcenry/snake</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>相信贪吃蛇大家都玩儿过，我对贪吃蛇的印象就是在电子词典上，一只像素蛇在屏幕游走，饥渴难耐，看着豆子就要去吃，吃到豆子就会长一节，当蛇的身体越来越长的时候，它才发现这个世界变了，每走一步，都是寸步难行。","more":"当它的蛇头触碰到任意的物体，无论是屏幕边界还是自己的身体，游戏都将结束。这款游戏应该是比较经典的一个童年记忆。刚接触游戏开发的人可能比较喜欢以这款游戏入手，因为贪吃蛇包含了很多游戏开发中的原理，并且难度也不大，而我刚好在学习Cocos CVP的课程，学习在一个中间阶段，我也来拿这个练练手，以下就把我做贪吃蛇的过程分享出来。</p>\n<h3 id=\"游戏分析\"><a href=\"#游戏分析\" class=\"headerlink\" title=\"游戏分析\"></a>游戏分析</h3><h4 id=\"身体关节\"><a href=\"#身体关节\" class=\"headerlink\" title=\"身体关节\"></a>身体关节</h4><p>贪吃蛇的实现可能有多种方法，但今天，我想用面向对象的思想来对游戏进行设计，到今天，任何的程序开发都离不开面向对象的思想，通过面向对象的思想我们能把很多抽象的问题具象化，方便我们解决很多问题。而在贪吃蛇中，面向对象的思想依然实用。<br>在贪吃蛇中，我们可以把一条游走的蛇的每个关节当做是一个对象，而蛇本身是由多个关节组成的整体，当每个关节在移动时，我们就能看到整个蛇的移动，每个关节的位置以及移动方向都跟它的上一个关节息息相关，那么我们就可以把关节与它的上一个关节关联起来，实现如下结构：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/snake1.png\" alt=\"蛇关节关系图\"></p>\n<h4 id=\"移动方向\"><a href=\"#移动方向\" class=\"headerlink\" title=\"移动方向\"></a>移动方向</h4><p>如上文所说，按照上面的关节关系来实现，那么蛇的移动方向就是与父节点的移动方向相关联，每一个关节应该有一个当前移动方向和下次移动方向，每一步的移动，都是跟着当前移动方向走的，而父关节的当前移动的方向即为子关节的下次移动方向，这样，只需要调整蛇头关节的下次移动方向，整条蛇就能顺着各自的父关节方向移动，蛇的移动方向图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/snakemove.png\" alt=\"蛇的移动方向图\"></p>\n<h3 id=\"开发设计\"><a href=\"#开发设计\" class=\"headerlink\" title=\"开发设计\"></a>开发设计</h3><h4 id=\"项目结构\"><a href=\"#项目结构\" class=\"headerlink\" title=\"项目结构\"></a>项目结构</h4><p>按照前面的设计，我们可以大致可以划分出游戏场景类和关节类，进入游戏场景类，再将一些全局的变量单独存在一个类中，项目结构可划分如下图：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/snake%E7%BB%93%E6%9E%84%E5%9B%BE.png\" alt=\"项目结构图\"></p>\n<h4 id=\"全局变量类\"><a href=\"#全局变量类\" class=\"headerlink\" title=\"全局变量类\"></a>全局变量类</h4><p>游戏中的全局变量，提炼为一个全局变量类，其中参数可以根据需求灵活变动配置</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Constants = &#123;</span><br><span class=\"line\">    frequency: <span class=\"number\">0.2</span>,<span class=\"comment\">// 刷新频率</span></span><br><span class=\"line\">    speed: <span class=\"number\">31</span>,<span class=\"comment\">// 每帧移动距离,身体节点大小+1像素间隔</span></span><br><span class=\"line\">    errDistance: <span class=\"number\">10</span>,<span class=\"comment\">// 偏差举例</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"关节类\"><a href=\"#关节类\" class=\"headerlink\" title=\"关节类\"></a>关节类</h4><p>按照以上设计的结构，每一个关节对象都应该包含蛇的当前方向、下次方向和蛇的父节点三个属性，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> SnakeBody = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    frontBody: <span class=\"literal\">null</span>,<span class=\"comment\">//上一个身体关节,没有则为头部</span></span><br><span class=\"line\">    nextDirection: <span class=\"number\">0</span>,<span class=\"comment\">// 1-上,2-下,3-左,4-右</span></span><br><span class=\"line\">    direction: <span class=\"number\">0</span>,<span class=\"comment\">// 1-上,2-下,3-左,4-右</span></span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">frontBody, direction</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.frontBody = frontBody;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.direction = direction;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.nextDirection = direction;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面说的，关节的位置跟它的福关节的位置是息息相关的，那么初始化的时候，我们就需要根据父关节的移动方向来进行次关节的位置设置，这部分代码，我们可以放在onEnter方法中，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.frontBody == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 蛇头部关节,设置头部纹理</span></span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (<span class=\"built_in\">this</span>.direction) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setTexture(res.head_up);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setTexture(res.head_down);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setTexture(res.head_left);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setTexture(res.head_right);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 蛇身体关节</span></span><br><span class=\"line\">      <span class=\"comment\">// 设置纹理</span></span><br><span class=\"line\">      <span class=\"built_in\">this</span>.setTexture(res.body);</span><br><span class=\"line\">      <span class=\"comment\">// 设置关节位置</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> frontX = <span class=\"built_in\">this</span>.frontBody.getPositionX();</span><br><span class=\"line\">      <span class=\"keyword\">var</span> frontY = <span class=\"built_in\">this</span>.frontBody.getPositionY();</span><br><span class=\"line\">      <span class=\"keyword\">var</span> frontWidth = <span class=\"built_in\">this</span>.frontBody.width;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> frontHeight = <span class=\"built_in\">this</span>.frontBody.height;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> width = <span class=\"built_in\">this</span>.width;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> height = <span class=\"built_in\">this</span>.height;</span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (<span class=\"built_in\">this</span>.frontBody.direction) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// 根据父关节的当前移动方向,决定此关节的位置</span></span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">1</span>:<span class=\"comment\">// 上</span></span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setPosition(frontX, frontY - frontHeight / <span class=\"number\">2</span> - height / <span class=\"number\">2</span> - <span class=\"number\">1</span>);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">2</span>:<span class=\"comment\">// 下</span></span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setPosition(frontX, frontY + frontHeight / <span class=\"number\">2</span> + height / <span class=\"number\">2</span> + <span class=\"number\">1</span>);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">3</span>:<span class=\"comment\">// 左</span></span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setPosition(frontX + frontWidth / <span class=\"number\">2</span> + width / <span class=\"number\">2</span> + <span class=\"number\">1</span>, frontY);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"number\">4</span>:<span class=\"comment\">// 右</span></span><br><span class=\"line\">              <span class=\"built_in\">this</span>.setPosition(frontX - frontWidth / <span class=\"number\">2</span> - width / <span class=\"number\">2</span> - <span class=\"number\">1</span>, frontY);</span><br><span class=\"line\">              <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>有了这三个属性，每一个节点还应该有最重要的游戏逻辑——move方法，每一个关节分别调用move方法，从游戏场景中就能看到整条蛇按照预定方向进行移动，而整条蛇的运动方向就是跟着头部关节的方向走，头部关节的方向则通过点击屏幕区域控制。<br>在move方法中，我们需要做以下事情：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.按照关节的下次移动方向移动本身长度的像素的距离</span><br><span class=\"line\">2.如果是头部关节，需要改变关节纹理</span><br></pre></td></tr></table></figure>\n<p>同时，如果是头部关节，我们还需要判断以下三个临界条件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.头部关节是否触碰到屏幕边界</span><br><span class=\"line\">2.头部关节是否吃到屏幕中的豆子</span><br><span class=\"line\">3.头部关节是否触碰到自身关节</span><br></pre></td></tr></table></figure>\n<p>其中1、3条件达成，则判定游戏结束，2条件达成，则能增加游戏分数，并且游戏继续。<br>move方法代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 关节移动方法</span></span><br><span class=\"line\">move: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">layer</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> star = layer.star;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> direct;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.frontBody == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 头部关节按照自身的下次方向行走</span></span><br><span class=\"line\">        direct = <span class=\"built_in\">this</span>.nextDirection;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 身体关节按照父关节的当前方向行走,并将福关节的当前方向设置为自身的下次方向</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.nextDirection = direct = <span class=\"built_in\">this</span>.frontBody.direction;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (direct) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:<span class=\"comment\">// 上</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.setPosition(<span class=\"built_in\">this</span>.getPositionX(), <span class=\"built_in\">this</span>.getPositionY() + Constants.speed);</span><br><span class=\"line\">            <span class=\"comment\">// this.runAction(cc.moveBy(Constants.frequency, cc.p(0, Constants.speed), 0))</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:<span class=\"comment\">// 下</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.setPosition(<span class=\"built_in\">this</span>.getPositionX(), <span class=\"built_in\">this</span>.getPositionY() - Constants.speed);</span><br><span class=\"line\">            <span class=\"comment\">// this.runAction(cc.moveBy(Constants.frequency, cc.p(0, -Constants.speed), 0))</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:<span class=\"comment\">// 左</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.setPosition(<span class=\"built_in\">this</span>.getPositionX() - Constants.speed, <span class=\"built_in\">this</span>.getPositionY());</span><br><span class=\"line\">            <span class=\"comment\">// this.runAction(cc.moveBy(Constants.frequency, cc.p(-Constants.speed, 0), 0))</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:<span class=\"comment\">// 右</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.setPosition(<span class=\"built_in\">this</span>.getPositionX() + Constants.speed, <span class=\"built_in\">this</span>.getPositionY());</span><br><span class=\"line\">            <span class=\"comment\">// this.runAction(cc.moveBy(Constants.frequency, cc.p(Constants.speed, 0), 0))</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.frontBody == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (<span class=\"built_in\">this</span>.nextDirection) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 头部关节需要设置头部不同方向的纹理</span></span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:<span class=\"comment\">// 上</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.setTexture(res.head_up);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:<span class=\"comment\">// 下</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.setTexture(res.head_down);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:<span class=\"comment\">// 左</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.setTexture(res.head_left);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">4</span>:<span class=\"comment\">// 右</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.setTexture(res.head_right);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 头部关节判断是否触碰到边界</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((<span class=\"built_in\">this</span>.getPositionX() &gt; size.width - <span class=\"built_in\">this</span>.width / <span class=\"number\">2</span>)</span><br><span class=\"line\">            || (<span class=\"built_in\">this</span>.getPositionX() &lt; <span class=\"built_in\">this</span>.width / <span class=\"number\">2</span>)</span><br><span class=\"line\">            || (<span class=\"built_in\">this</span>.getPositionY() &gt; size.height - <span class=\"built_in\">this</span>.height / <span class=\"number\">2</span>)</span><br><span class=\"line\">            || (<span class=\"built_in\">this</span>.getPositionY() &lt; <span class=\"built_in\">this</span>.height / <span class=\"number\">2</span>)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 判断触碰边界</span></span><br><span class=\"line\">            cc.log(<span class=\"string\">&quot;game over&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 判断是否触碰到自己身体关节</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> index <span class=\"keyword\">in</span> layer.bodys) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (layer.bodys[index] != <span class=\"built_in\">this</span> &amp;&amp; cc.rectIntersectsRect(<span class=\"built_in\">this</span>.getBoundingBox(), layer.bodys[index].getBoundingBox())) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 判断是否吃到星星</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (star != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cc.rectIntersectsRect(<span class=\"built_in\">this</span>.getBoundingBox(), star.getBoundingBox())) &#123;</span><br><span class=\"line\">                star.runAction(</span><br><span class=\"line\">                    cc.sequence(cc.spawn(</span><br><span class=\"line\">                        cc.scaleTo(<span class=\"number\">0.2</span>, <span class=\"number\">3</span>),</span><br><span class=\"line\">                        cc.fadeOut(<span class=\"number\">0.2</span>)</span><br><span class=\"line\">                    ), cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">star</span>) </span>&#123;</span><br><span class=\"line\">                        star.removeFromParent();</span><br><span class=\"line\">                    &#125;, star))</span><br><span class=\"line\">                );</span><br><span class=\"line\">                <span class=\"comment\">// 清除星星</span></span><br><span class=\"line\">                layer.star = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"comment\">// 添加身体</span></span><br><span class=\"line\">                layer.canNewBody = <span class=\"number\">1</span>;</span><br><span class=\"line\">                <span class=\"comment\">// 改变分数</span></span><br><span class=\"line\">                layer.score.setString(<span class=\"string\">&quot;&quot;</span> + (<span class=\"built_in\">Number</span>(layer.score.getString()) + <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">3</span> + <span class=\"number\">1</span>)));</span><br><span class=\"line\">                layer.score.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.1</span>, <span class=\"number\">2</span>), cc.scaleTo(<span class=\"number\">0.1</span>, <span class=\"number\">0.5</span>), cc.scaleTo(<span class=\"number\">0.1</span>, <span class=\"number\">1</span>)));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"游戏场景类\"><a href=\"#游戏场景类\" class=\"headerlink\" title=\"游戏场景类\"></a>游戏场景类</h4><p>在游戏场景中我们需要以下几个变量：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. 贪吃蛇数组：用于存储贪吃蛇所有的关节节点</span><br><span class=\"line\">2. 贪吃蛇尾部：每添加一个关节节点 ，都将此变量指向这个新加的节点，以便下次继续再尾部节点添加</span><br><span class=\"line\">3. 吃的星星：屏幕中随机产生的星星，用于判断头部关节是否与它产生碰撞</span><br><span class=\"line\">4. 是否添加节点：如果在定时任务中判断到吃到星星，那么可以次变量为1，代表可以添加一个节点</span><br><span class=\"line\">5. 分数：存储游戏中累加的分数</span><br></pre></td></tr></table></figure>\n<p>在cc.Layer的构造函数中对以上变量进行初始化，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> GameLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">  bodys: [],<span class=\"comment\">// snake body</span></span><br><span class=\"line\">  tail: <span class=\"literal\">null</span>,<span class=\"comment\">// snake tail</span></span><br><span class=\"line\">  star: <span class=\"literal\">null</span>,<span class=\"comment\">// star</span></span><br><span class=\"line\">  canNewBody: <span class=\"number\">0</span>,<span class=\"comment\">// 0-无,1-有</span></span><br><span class=\"line\">  score: <span class=\"literal\">null</span>,<span class=\"comment\">// 分数Label</span></span><br><span class=\"line\">  ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 初始化全局参数</span></span><br><span class=\"line\">      <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.bodys = [];</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.canNewBody = <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.star = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.tail = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.score = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>之后，我们首先需要在场景中绘制出一条蛇，初始化定义为1个头部关节，5个身体关节，由于我们对关节类做了很好的封装，所以初始化一条蛇的代码很简单，我们在onEnter方法中进行初始化，如下所示：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 初始化一条蛇</span></span><br><span class=\"line\"><span class=\"comment\">// 初始化头部</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> head = <span class=\"keyword\">new</span> SnakeBody(<span class=\"literal\">null</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\">head.setPosition(<span class=\"number\">300</span>, <span class=\"number\">300</span>);</span><br><span class=\"line\"><span class=\"built_in\">this</span>.addChild(head);</span><br><span class=\"line\"><span class=\"built_in\">this</span>.bodys.push(head);</span><br><span class=\"line\">head.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"built_in\">this</span>.tail = head;</span><br><span class=\"line\"><span class=\"comment\">// 循环添加5个身体</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> node = <span class=\"keyword\">new</span> SnakeBody(<span class=\"built_in\">this</span>.tail, <span class=\"built_in\">this</span>.tail.direction);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.addChild(node);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.bodys.push(node);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.tail = node;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>初始化完了之后蛇是不会动的，如何让它动起来呢，我们就要用到在关节类中封装的move方法了，我们每隔一个时间，对所有的关节类执行一次move方法，就能实现蛇的移动，首先在onEnter中添加定时任务：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 蛇移动的定时任务</span></span><br><span class=\"line\"><span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.snakeMove, Constants.frequency);</span><br></pre></td></tr></table></figure>\n<p>在这个snakeMove定时调用的方法中，我们要写出所有关节移动的逻辑，在这个方法中，我们需要完成以下几件事：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. 遍历蛇的所有关节，每个关节执行一遍move方法，并在move完了之后，将下次移动方法变为本次移动方向</span><br><span class=\"line\">2. 如果需要新增关节，在遍历完成之后，新增一个关节类，并将其父节点指向之前的蛇尾节点，并把蛇尾指向新加的这个关节</span><br></pre></td></tr></table></figure>\n<p>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 蛇关节移动方法</span></span><br><span class=\"line\">snakeMove: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> index <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.bodys) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 循环执行移动方法,并返回移动结果,false即视为游戏结束</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.bodys[index].move(<span class=\"built_in\">this</span>)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 执行移动方法,移动失败,游戏结束</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.snakeMove);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.updateStar);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> overScene = <span class=\"keyword\">new</span> OverScene(<span class=\"built_in\">Number</span>(<span class=\"built_in\">this</span>.score.getString()), <span class=\"literal\">false</span>);</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, overScene));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> index <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.bodys) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 本轮所有关节移动结束,所有节点的当前方向赋值为下一次的方向</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.bodys[index].direction = <span class=\"built_in\">this</span>.bodys[index].nextDirection;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.canNewBody == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 如果新增关节为1,增加关节</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> node = <span class=\"keyword\">new</span> SnakeBody(<span class=\"built_in\">this</span>.tail, <span class=\"built_in\">this</span>.tail.direction);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(node);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.bodys.push(node);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.tail = node;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.canNewBody = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>目前为止这条蛇是只会按照我们初始化的方向一直走到碰壁，然后游戏结束的，如何改变蛇的运动轨迹呢？前面说到了，蛇头部节点的下次移动方向的改变，即可对整个蛇的移动轨迹进行改变，这里我们可以通过点击屏幕实现蛇头的下次移动方向的改变。<br>首先在onEnter方法中添加触摸事件监听：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 添加屏幕触摸事件</span></span><br><span class=\"line\">cc.eventManager.addListener(&#123;</span><br><span class=\"line\">    event: cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">    swallowTouches: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    onTouchBegan: <span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">    onTouchMoved: <span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">    onTouchEnded: <span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">&#125;, <span class=\"built_in\">this</span>);</span><br></pre></td></tr></table></figure>\n<p>然后在onTouchBegan方法中实现点击事件，我们可以允许点击有一个10像素的误差：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 点击转向</span></span><br><span class=\"line\">touchbegan: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">touch, event</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> x = touch.getLocation().x;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> y = touch.getLocation().y;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> head = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> headX = head.getPositionX();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> headY = head.getPositionY();</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (head.direction) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:<span class=\"comment\">// 上</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:<span class=\"comment\">// 下</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (x &lt;= headX - Constants.errDistance) &#123;<span class=\"comment\">// 转左</span></span><br><span class=\"line\">                head.nextDirection = <span class=\"number\">3</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (x &gt;= headX + Constants.errDistance) &#123;<span class=\"comment\">// 转右</span></span><br><span class=\"line\">                head.nextDirection = <span class=\"number\">4</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:<span class=\"comment\">// 左</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:<span class=\"comment\">// 右</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (y &lt;= headY - Constants.errDistance) &#123;<span class=\"comment\">// 转下</span></span><br><span class=\"line\">                head.nextDirection = <span class=\"number\">2</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (y &gt;= headY + Constants.errDistance) &#123;<span class=\"comment\">// 转上</span></span><br><span class=\"line\">                head.nextDirection = <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>最后我们只差最后一步，就是蛇要吃的星星，我们可以在屏幕中任意位置随机产生一颗星星（又或者叫豆子，这都无所谓），只要这个星星满足以下条件，那么它就可以被绘制出来，否则我们需要重新随机这个星星的位置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. 星星在游戏场景的屏幕范围内</span><br><span class=\"line\">2. 星星不能与蛇的身体部分重叠</span><br></pre></td></tr></table></figure>\n<p>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 更新星星</span></span><br><span class=\"line\">updateStar: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.star == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.star = <span class=\"keyword\">new</span> cc.Sprite(res.bean);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> randomX = <span class=\"built_in\">Math</span>.random() * (cc.winSize.width - <span class=\"built_in\">this</span>.star.width) + <span class=\"built_in\">this</span>.star.width;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> randomY = <span class=\"built_in\">Math</span>.random() * (cc.winSize.height - <span class=\"built_in\">this</span>.star.width) + <span class=\"built_in\">this</span>.star.height;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.star.setPosition(randomX, randomY);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(<span class=\"built_in\">this</span>.star);</span><br><span class=\"line\">        <span class=\"comment\">// 产生的星星只要在屏幕外,或与蛇的身体部分重叠,则本次任务不产生</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((randomX &gt; cc.winSize.width - <span class=\"built_in\">this</span>.star.width / <span class=\"number\">2</span>)</span><br><span class=\"line\">            || (randomX &lt; <span class=\"built_in\">this</span>.star.width / <span class=\"number\">2</span>)</span><br><span class=\"line\">            || (randomY &gt; cc.winSize.height - <span class=\"built_in\">this</span>.star.height / <span class=\"number\">2</span>)</span><br><span class=\"line\">            || (randomY &lt; <span class=\"built_in\">this</span>.star.height / <span class=\"number\">2</span>)) &#123;</span><br><span class=\"line\">            cc.log(<span class=\"string\">&quot;update star:out of screen&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.removeChild(<span class=\"built_in\">this</span>.star);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.star = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> index <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.bodys) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cc.rectIntersectsRect(<span class=\"built_in\">this</span>.bodys[index].getBoundingBox(), <span class=\"built_in\">this</span>.star.getBoundingBox())) &#123;</span><br><span class=\"line\">                cc.log(<span class=\"string\">&quot;update star:intersect with self&quot;</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.removeChild(<span class=\"built_in\">this</span>.star);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.star = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>至此，游戏的主要逻辑就大功告成了！贪吃蛇不仅能在屏幕中游走，还能吃星星，并且碰到自身或边缘都会GameOver！</p>\n<h4 id=\"开始-结束场景类\"><a href=\"#开始-结束场景类\" class=\"headerlink\" title=\"开始/结束场景类\"></a>开始/结束场景类</h4><p>说到GameOver，那么就必须要有一个Over的场景类了，毕竟有了开始场景，游戏场景和结束场景，才算得上一个完成的游戏流程嘛，结束场景类的实现很简单，只需要把游戏场景中获得的分数传递进来，然后在Label中展示即可，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> OverLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    score: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">score</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.score = score;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> over = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;Game Over,你的分数是:&quot;</span> + <span class=\"built_in\">this</span>.score, <span class=\"string\">&quot;Arial&quot;</span>, <span class=\"number\">38</span>);</span><br><span class=\"line\">        over.setPosition(size.width / <span class=\"number\">2</span>, size.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(over);</span><br><span class=\"line\">        over.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>, <span class=\"number\">2</span>), cc.scaleTo(<span class=\"number\">0.2</span>, <span class=\"number\">0.5</span>), cc.scaleTo(<span class=\"number\">0.2</span>, <span class=\"number\">1</span>)));</span><br><span class=\"line\">        <span class=\"keyword\">var</span> start = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;再来一次&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> HelloWorldScene()));</span><br><span class=\"line\">        &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        start.setPosition(over.getPositionX(), over.getPositionY() - over.height / <span class=\"number\">2</span> - <span class=\"number\">50</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(start);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    score: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">score</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.score = score;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> OverLayer(<span class=\"built_in\">this</span>.score);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>与结束场景一样，开始场景也只需一个Label一个Menu即可，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    sprite: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = cc.winSize;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helloLabel = <span class=\"keyword\">new</span> cc.LabelTTF(<span class=\"string\">&quot;贪吃蛇&quot;</span>, <span class=\"string\">&quot;Arial&quot;</span>, <span class=\"number\">38</span>);</span><br><span class=\"line\">        helloLabel.x = size.width / <span class=\"number\">2</span>;</span><br><span class=\"line\">        helloLabel.y = size.height / <span class=\"number\">2</span> + <span class=\"number\">200</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(helloLabel, <span class=\"number\">5</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> start = <span class=\"keyword\">new</span> cc.MenuItemFont(<span class=\"string\">&quot;开始游戏&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> GameScene()));</span><br><span class=\"line\">        &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(start);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> HelloWorldScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> HelloWorldLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>这样，我们就能形成一个完成游戏流程了，游戏加载进入游戏开始场景，点击开始游戏进行如主游戏场景，游戏结束后进入结束场景，结束场景点击“再来一次”又可以回到开始场景。</p>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p>最后的运行效果如下<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/snake.gif\" alt=\"贪吃蛇效果图\"><br>通过CVP平台的项目托管可看到实际运行效果，地址如下：<br><a href=\"http://www.cocoscvp.com/usercode/2e17b3cd9586a574140e0bb765bad21673fc7686/\">http://www.cocoscvp.com/usercode/2e17b3cd9586a574140e0bb765bad21673fc7686/</a></p>\n<h3 id=\"源代码\"><a href=\"#源代码\" class=\"headerlink\" title=\"源代码\"></a>源代码</h3><p>所有源代码均上传到github，欢迎交流学习，地址：<br><a href=\"https://github.com/hjcenry/snake\">https://github.com/hjcenry/snake</a></p>"},{"title":"Java读取CSV和XML文件方法","date":"2016-02-18T07:59:00.000Z","_content":"游戏开发中，读取策划给的配置表是必不可少的，我在之前公司，策划给的是xml表来读取，现在公司策划给的是CSV表来读取，其实大同小异，也并不是什么难点，我就简单分享下Java如何读取XML文件和CSV文件。以下工具类可随意拿去使用。\n<!--more-->\n### Java读XML文件\n如果是Maven项目，则依赖以下包（如果不是，则自己在项目添加配置相应jar包）\n```xml\n        <!-- dom4j begin -->\n\t\t<dependency>\n\t\t\t<groupId>dom4j</groupId>\n\t\t\t<artifactId>dom4j</artifactId>\n\t\t\t<version>1.6.1</version>\n\t\t</dependency>\n\t\t<!-- dom4j end -->\n\t\t<!--xml转换 -->\n\t\t<dependency>\n\t\t\t<groupId>com.thoughtworks.xstream</groupId>\n\t\t\t<artifactId>xstream</artifactId>\n\t\t\t<version>1.4.3</version>\n\t\t</dependency>\n```\n读取XML文件应该是比较常见的，用dom4j就可以很简单的读出来，首先准备一个XML文件，来映射出所有的XML资源文件的名字，资源文件如下：\ndataConfig.xml\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<config>\n \t<file name=\"Test.xml\" />\n</config>\n```\n示例资源XML文件如下\nTest.xml\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<dataset>\n \t<Test attr1=\"\" attr2=\"\" attr3=\"\" />\n</dataset>\n```\nJava项目中建一个类，变量名与XML中属性名相同，Java代码通过这个XML文件来找出所有的资源XML文件，然后将XML文件中的属性值全部读取到类中，再把类放进Map，加载到内存中，这样，每次需要读取配置表，就可以直接从内存中读取，快速且方便\n以下是XmlDataLoader.java，作用是从数据表中读取属性值到内存\n```java\npackage com.hjc._36.util.xml;\n\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.io.UnsupportedEncodingException;\nimport java.lang.reflect.Field;\nimport java.lang.reflect.Modifier;\nimport java.sql.Timestamp;\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.HashMap;\nimport java.util.LinkedList;\nimport java.util.List;\nimport java.util.Map;\n\nimport org.dom4j.Document;\nimport org.dom4j.DocumentException;\nimport org.dom4j.Element;\nimport org.dom4j.io.SAXReader;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\nimport com.hjc._36.core.GameInit;\nimport com.hjc._36.util.csv.TempletService;\n\n/**\n * 1 所有的template类都必须在一个包中 2 通过读取xml 遍历所有的Element，通过Element.name和 package 得到具体的\n * className; 3 通过Element的 attr 获取方法，并且根据parameterType 强制转换类型\n *\n * @author Administrator\n *\n */\npublic class XmlDataLoader {\n\tprivate String packageName;\n\tprivate String config; // 每一行就是一个配置文件名字\n\tprivate static Logger logger = LoggerFactory.getLogger(XmlDataLoader.class);\n\tpublic static int ActivityMaxValue;\n\n\tpublic XmlDataLoader(String packageName, String config) {\n\t\tthis.packageName = packageName;\n\t\tthis.config = config;\n\t}\n\n\t/**\n\t * 调用load方法加载所有的配置文件\n\t */\n\tpublic void load() {\n\t\tSAXReader reader = new SAXReader();\n\t\ttry {\n\t\t\tDocument doc = reader.read(new InputStreamReader(this.getClass()\n\t\t\t\t\t.getResourceAsStream(this.config)));\n\t\t\tList<?> nodes = doc.selectNodes(\"/config/file\");\n\t\t\tMap<String, List<?>> dataMap = new HashMap<String, List<?>>();\n\t\t\tList<String> files = new LinkedList<String>();\n\t\t\tfor (Object n : nodes) {\n\t\t\t\tElement t = (Element) n;\n\t\t\t\tString f = t.attributeValue(\"name\");\n\t\t\t\tList<?> dataList = this.loadFile(f, true);\n\t\t\t\tfor (Object o : dataList) {\n\t\t\t\t\tTempletService.getInstance().registerObject(o, dataMap);\n\t\t\t\t}\n\t\t\t\tfiles.add(f);\n\t\t\t}\n\t\t\tlogger.info(\"读取配置完毕，准备afterLoad\");\n\t\t\tTempletService.templetMap = dataMap;\n\t\t\tTempletService.getInstance().afterLoad();\n\t\t\tlogger.info(\"afterLoad 完毕\");\n\t\t} catch (DocumentException e) {\n\t\t\te.printStackTrace();\n\t\t} finally {\n\n\t\t}\n\t}\n\n\tprivate List<?> loadFile(String file, boolean exitWhenFail) {\n\t\ttry {\n\t\t\tfile = GameInit.confFileBasePath + file;\n\t\t\tlogger.info(\"load file: {}\", file);\n\t\t\tInputStream resourceAsStream = this.getClass().getResourceAsStream(\n\t\t\t\t\tfile);\n\t\t\tif (resourceAsStream == null) {\n\t\t\t\tlogger.error(\"文件不存在:\" + file);\n\t\t\t\tif (exitWhenFail) {\n\t\t\t\t\tSystem.exit(0);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn loadFromStream(resourceAsStream);\n\t\t} catch (Exception e) {\n\t\t\tlogger.error(\"载入文件出错：\" + file);\n\t\t\te.printStackTrace();\n\t\t\tSystem.exit(0);\n\t\t} finally {\n\t\t}\n\t\treturn Collections.EMPTY_LIST;\n\t}\n\n\tpublic List<?> loadFromStream(InputStream resourceAsStream)\n\t\t\tthrows UnsupportedEncodingException, DocumentException,\n\t\t\tInstantiationException, IllegalAccessException {\n\t\tSAXReader reader = new SAXReader();\n\t\tDocument doc = reader.read(new InputStreamReader(resourceAsStream,\n\t\t\t\t\"utf-8\"));\n\t\tElement dataSet = (Element) doc.selectNodes(\"/dataset\").get(0);\n\t\tList<?> nodes = dataSet.elements();\n\t\t// get clazz\n\t\tString className = this.packageName\n\t\t\t\t+ ((Element) nodes.get(0)).getName();\n\t\ttry {\n\t\t\tClass<?> classObject = Class.forName(className);\n\t\t\tif (classObject == null) {\n\t\t\t\tlogger.error(\"未找到类\" + className);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t// Get all the declared fields\n\t\t\tField[] fields = classObject.getDeclaredFields();\n\t\t\tLinkedList<Field> fieldList = new LinkedList<Field>();\n\t\t\tint length = fields.length;\n\t\t\tfor (int i = -1; ++i < length;) {\n\t\t\t\tboolean isStaticField = Modifier.isStatic(fields[i]\n\t\t\t\t\t\t.getModifiers());\n\t\t\t\tif (isStaticField)\n\t\t\t\t\tcontinue;\n\t\t\t\tboolean isTransientField = Modifier.isTransient(fields[i]\n\t\t\t\t\t\t.getModifiers());\n\t\t\t\tif (isTransientField)\n\t\t\t\t\tcontinue;\n\t\t\t\tfieldList.add(fields[i]);\n\t\t\t}\n\t\t\t// Get all the declared fields of supper class\n\t\t\tClass<?> tmp = classObject;\n\t\t\twhile ((tmp = tmp.getSuperclass()) != Object.class) {\n\t\t\t\tSystem.out.print(\"the extends class is\" + tmp.getName());\n\t\t\t\tfields = tmp.getDeclaredFields();\n\t\t\t\tlength = fields.length;\n\t\t\t\tif (length == 0)\n\t\t\t\t\tcontinue;\n\t\t\t\tfor (int i = -1; ++i < length;) {\n\t\t\t\t\tboolean isStaticField = Modifier.isStatic(fields[i]\n\t\t\t\t\t\t\t.getModifiers());\n\t\t\t\t\tif (isStaticField)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tboolean isTransientField = Modifier.isTransient(fields[i]\n\t\t\t\t\t\t\t.getModifiers());\n\t\t\t\t\tif (isTransientField)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tfieldList.add(fields[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// The truly need to return object\n\t\t\tList<Object> instances = new ArrayList<Object>(nodes.size());\n\t\t\tObject instance = null;\n\t\t\tString fieldName = null;\n\t\t\tString fieldValue = null;\n\t\t\tfor (Object node : nodes) {\n\t\t\t\tif (node != null) {\n\t\t\t\t\tinstance = classObject.newInstance();\n\t\t\t\t\tboolean ok = false;\n\t\t\t\t\tElement row = (Element) node;\n\t\t\t\t\tfor (Field field : fieldList) {\n\t\t\t\t\t\tfieldName = field.getName();\n\t\t\t\t\t\tfieldValue = row.attributeValue(fieldName);\n\t\t\t\t\t\tif (fieldValue == null)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.setField(instance, field, fieldValue);\n\t\t\t\t\t\t\tok = true;\n\t\t\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t\t\tlogger.error(\"类名称是\" + className + \"的属性\" + fieldName\n\t\t\t\t\t\t\t\t\t+ \"没有被成功赋予静态数据\");\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (ok)\n\t\t\t\t\t\tinstances.add(instance);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn instances;\n\t\t} catch (ClassNotFoundException e1) {\n\t\t\te1.printStackTrace();\n\t\t\tlogger.error(\"未找到类\" + className);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tpublic void reload() {\n\t}\n\n\t/**\n\t *\n\t * @Title: setUnknowField\n\t * @Description:\n\t * @param ob\n\t * @param f\n\t * @param v\n\t * @throws IllegalArgumentException\n\t * @throws IllegalAccessException\n\t */\n\tprivate void setField(Object obj, Field f, String v)\n\t\t\tthrows IllegalArgumentException, IllegalAccessException {\n\t\tf.setAccessible(true);\n\t\tif (f.getType() == int.class) {\n\t\t\tf.setInt(obj, Integer.parseInt(v));\n\t\t} else if (f.getType() == short.class) {\n\t\t\tf.setShort(obj, Short.parseShort(v));\n\t\t} else if (f.getType() == byte.class) {\n\t\t\tf.setByte(obj, Byte.parseByte(v));\n\t\t} else if (f.getType() == long.class) {\n\t\t\tf.setLong(obj, Long.parseLong(v));\n\t\t} else if (f.getType() == double.class) {\n\t\t\tf.setDouble(obj, Double.parseDouble(v));\n\t\t} else if (f.getType() == float.class) {\n\t\t\tf.setFloat(obj, Float.parseFloat(v));\n\t\t} else if (f.getType() == Timestamp.class) {\n\t\t\tf.set(obj, Timestamp.valueOf(v));\n\t\t} else {\n\t\t\tf.set(obj, f.getType().cast(v));\n\t\t}\n\t}\n\n\t/**\n\t * Test Code\n\t *\n\t * @param args\n\t */\n\tpublic static void main(String[] args) {\n\t\tXmlDataLoader dl = new XmlDataLoader(\"com.hjc._36.template.\",\n\t\t\t\t\"/dataConfig.xml\");\n\t\tdl.load();\n\t}\n\n}\n```\n如上的测试方法中看出，调用方式很简单，只需加载到映射XML文件，即可读取所有的配置XML文件，调用load()方法后，配置表就全部加载到了内存，我们通过以下类——TempletService.java来对这些配置数据进行管理：\n```java\npackage com.hjc._36.util.csv;\n\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\n/**\n * 添加一个数据表需要做以下几步\n * 1.在包com.hjc._36.template下创建对应的模板类，类名与数据文件一致\n * 2.在src/main/resources/xml/中添加模板数据文件\n * 3.在src/main/resources/dataConfig.xml加入刚才的模板数据文件\n *\n * @author 何金成\n *\n */\npublic class TempletService {\n\tpublic static Logger log = LoggerFactory.getLogger(TempletService.class);\n\tpublic static TempletService templetService = new TempletService();\n\t/**\n\t * key:实体名 value:该实体下的所有模板数据\n\t */\n\tpublic static Map<String, List<?>> templetMap = new HashMap<String, List<?>>();\n\n\tpublic TempletService() {\n\n\t}\n\n\tpublic static TempletService getInstance() {\n\t\treturn templetService;\n\t}\n\n\t/**\n\t * 获取该实体类下所有模板数据\n\t *\n\t * @param beanName\n\t * @return\n\t */\n\t@SuppressWarnings(\"unchecked\")\n\tpublic static List listAll(String beanName) {\n\t\treturn templetMap.get(beanName);\n\t}\n\n\t/**\n\t * @Title: registerObject\n\t * @Description: 注册对象到对应类的List中\n\t * @param o\n\t * @param dataMap\n\t * @return void\n\t * @throws\n\t */\n\tpublic void registerObject(Object o, Map<String, List<?>> dataMap) {\n\t\tadd(o.getClass().getSimpleName(), o, dataMap);\n\t}\n\n\n\n\t@SuppressWarnings(\"unchecked\")\n\tprivate void add(String key, Object data, Map<String, List<?>> dataMap) {\n\t\tList list = dataMap.get(key);\n\t\tif (list == null) {\n\t\t\tlist = new ArrayList();\n\t\t\tdataMap.put(key, list);\n\t\t}\n\t\tlist.add(data);\n\t}\n\n\tpublic void afterLoad() {\n\t\t// 加载后处理\n\t\t// List tests = TempletService.listAll(Test.class.getSimpleName());\n\t\t// for (Object object : tests) {\n\t\t// Test test = (Test)object;\n\t\t// System.out.print(test.getEquipLv());\n\t\t// System.out.print(\",\"+test.getLv1());\n\t\t// System.out.print(\",\"+test.getLv2());\n\t\t// System.out.print(\",\"+test.getLv3());\n\t\t// System.out.print(\",\"+test.getLv4());\n\t\t// System.out.print(\",\"+test.getLv5());\n\t\t// System.out.print(\",\"+test.getLv6());\n\t\t// System.out.print(\",\"+test.getLv7());\n\t\t// System.out.print(\",\"+test.getLv8());\n\t\t// System.out.print(\",\"+test.getLv9());\n\t\t// System.out.println(\",\"+test.getLv10());\n\t\t// }\n\t}\n\n\tpublic void loadCanShu() {\n\t\t// 加载全局参数xml配置\n\t}\n}\n```\n在load()中，变用到了上述类的registerObject方法来添加数据，在使用时，只需要调用listAll方法即可，在上面代码中的测试代码已经写明了用法。\n### Java读取CSV文件\nJava读CSV文件与读XML文件如出一辙，大致思路同上\ndataConfig.xml\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<config>\n \t<file name=\"Test.csv\" />\n \t<file name=\"JunjichuUpgrade.csv\" />\n \t<file name=\"Card.csv\" />\n \t<file name=\"Equip.csv\" />\n \t<file name=\"Prop.csv\" />\n</config>\n```\nTest.csv如下：\n```csv\n﻿等级,1星,2星,3星,4星,5星,6星,7星,8星,9星,10星,11星,12星,13星,14星,15星,16星,17星,18星,19星,20星,21星,22星,23星,24星,25星\nEquipLv,Lv1,Lv2,Lv3,Lv4,Lv5,Lv6,Lv7,Lv8,Lv9,Lv10,Lv11,Lv12,Lv13,Lv14,Lv15,Lv16,Lv17,Lv18,Lv19,Lv20,Lv21,Lv22,Lv23,Lv24,Lv25\n10,2,4,8,12,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n20,6,12,24,36,48,60,72,84,96,108,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n30,12,24,48,72,96,120,144,168,192,216,240,264,288,312,336,0,0,0,0,0,0,0,0,0,0\n40,20,40,80,120,160,200,240,280,320,360,400,440,480,520,560,0,0,0,0,0,0,0,0,0,0\n50,30,60,120,180,240,300,360,420,480,540,600,660,720,780,840,900,960,1020,1080,1140,0,0,0,0,0\n60,42,84,168,252,336,420,504,588,672,756,840,924,1008,1092,1176,1260,1344,1428,1512,1596,0,0,0,0,0\n70,56,112,224,336,448,560,672,784,896,1008,1120,1232,1344,1456,1568,1680,1792,1904,2016,2128,0,0,0,0,0\n80,72,144,288,432,576,720,864,1008,1152,1296,1440,1584,1728,1872,2016,2160,2304,2448,2592,2736,2880,3024,3168,3312,3456\n90,90,180,360,540,720,900,1080,1260,1440,1620,1800,1980,2160,2340,2520,2700,2880,3060,3240,3420,3600,3780,3960,4140,4320\n100,110,220,440,660,880,1100,1320,1540,1760,1980,2200,2420,2640,2860,3080,3300,3520,3740,3960,4180,4400,4620,4840,5060,5280\n```\n如上CSV表大家也能看出来，CSV文件中的数据是以一定规律呈现的，解析CSV便是根据CSV文件的这些特性来进行解析的，解析工具类CsvParser.java代码如下：\n```java\npackage com.hjc._36.util.csv;\n\nimport java.io.BufferedReader;\nimport java.io.BufferedWriter;\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.io.OutputStreamWriter;\nimport java.text.SimpleDateFormat;\nimport java.util.ArrayList;\nimport java.util.Date;\nimport java.util.Iterator;\nimport java.util.List;\n\n//JAVA 操作 excel 中的 .csv文件格式\npublic class CsvParser {\n\tprivate BufferedReader bufferedreader = null;\n\tprivate List list = new ArrayList();\n\n\tpublic CsvParser() {\n\t}\n\n\tpublic CsvParser(InputStream inStream) throws IOException {\n\t\tInputStreamReader isr = new InputStreamReader(inStream, \"UTF-8\");\n\t\tbufferedreader = new BufferedReader(isr);\n\t\tString stemp;\n\t\twhile ((stemp = bufferedreader.readLine()) != null) {\n\t\t\tlist.add(stemp);\n\t\t}\n\t}\n\n\tpublic List getList() throws IOException {\n\t\treturn list;\n\t}\n\n\tpublic List getListWithNoHeader() throws IOException {\n\t\treturn list.subList(2, list.size());\n\t}\n\n\t// 得到csv文件的行数\n\tpublic int getRowNum() {\n\t\treturn list.size();\n\t}\n\n\t// 得到csv文件的列数\n\tpublic int getColNum() {\n\t\tif (!list.toString().equals(\"[]\")) {\n\t\t\tif (list.get(0).toString().contains(\",\")) { // csv文件中，每列之间的是用','来分隔的\n\t\t\t\treturn list.get(0).toString().split(\",\").length;\n\t\t\t} else if (list.get(0).toString().trim().length() != 0) {\n\t\t\t\treturn 1;\n\t\t\t} else {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\t// 取得指定行的值\n\tpublic String getRow(int index) {\n\t\tif (this.list.size() != 0)\n\t\t\treturn (String) list.get(index);\n\t\telse\n\t\t\treturn null;\n\t}\n\n\t// 取得指定列的值\n\tpublic String getCol(int index) {\n\t\tif (this.getColNum() == 0) {\n\t\t\treturn null;\n\t\t}\n\t\tStringBuffer scol = new StringBuffer();\n\t\tString temp = null;\n\t\tint colnum = this.getColNum();\n\t\tif (colnum > 1) {\n\t\t\tfor (Iterator it = list.iterator(); it.hasNext();) {\n\t\t\t\ttemp = it.next().toString();\n\t\t\t\tscol = scol.append(temp.split(\",\")[index] + \",\");\n\t\t\t}\n\t\t} else {\n\t\t\tfor (Iterator it = list.iterator(); it.hasNext();) {\n\t\t\t\ttemp = it.next().toString();\n\t\t\t\tscol = scol.append(temp + \",\");\n\t\t\t}\n\t\t}\n\t\tString str = new String(scol.toString());\n\t\tstr = str.substring(0, str.length() - 1);\n\t\treturn str;\n\t}\n\n\t// 取得指定行，指定列的值\n\tpublic String getString(int row, int col) {\n\t\tString temp = null;\n\t\tint colnum = this.getColNum();\n\t\tif (colnum > 1) {\n\t\t\ttemp = list.get(row).toString().split(\",\")[col];\n\t\t} else if (colnum == 1) {\n\t\t\ttemp = list.get(row).toString();\n\t\t} else {\n\t\t\ttemp = null;\n\t\t}\n\t\treturn temp;\n\t}\n\n\tpublic void CsvClose() throws IOException {\n\t\tthis.bufferedreader.close();\n\t}\n\n\tpublic List readCvs(String filename) throws IOException {\n\t\tCsvParser cu = new CsvParser(new FileInputStream(new File(filename)));\n\t\tList list = cu.getList();\n\n\t\treturn list;\n\t}\n\n\tpublic void createCsv(String biao, List list, String path)\n\t\t\tthrows IOException {\n\t\tList tt = list;\n\t\tString data = \"\";\n\t\tSimpleDateFormat dataFormat = new SimpleDateFormat(\"yyyyMMdd\");\n\t\tDate today = new Date();\n\t\tString dateToday = dataFormat.format(today);\n\t\tFile file = new File(path + \"resource/expert/\" + dateToday\n\t\t\t\t+ \"importerrorinfo.csv\");\n\t\tif (!file.exists())\n\t\t\tfile.createNewFile();\n\t\telse\n\t\t\tfile.delete();\n\t\tString str[];\n\t\tStringBuilder sb = new StringBuilder(\"\");\n\t\tsb.append(biao);\n\t\tFileOutputStream writerStream = new FileOutputStream(file, true);\n\t\tBufferedWriter output = new BufferedWriter(new OutputStreamWriter(\n\t\t\t\twriterStream, \"UTF-8\"));\n\t\tfor (Iterator itt = tt.iterator(); itt.hasNext();) {\n\t\t\tString fileStr = itt.next().toString();\n\t\t\t// str = fileStr.split(\",\");\n\t\t\t// for (int i = 0; i <= str.length - 1; i++) { // 拆分成数组 用于插入数据库中\n\t\t\t// System.out.print(\"str[\" + i + \"]=\" + str[i] + \" \");\n\t\t\t// }\n\t\t\t// System.out.println(\"\");\n\t\t\tsb.append(fileStr + \"\\r\\n\");\n\t\t}\n\t\toutput.write(sb.toString());\n\t\toutput.flush();\n\t\toutput.close();\n\t}\n\n\tpublic static void main(String[] args) throws IOException {\n\t\tCsvParser test = new CsvParser();\n\t\tList aaa = test.readCvs(\"D:/abc.csv\");\n\t\tfor (int i = 0; i < aaa.size(); i++) {\n\t\t\tSystem.out.println(i + \"---\" + aaa.get(i));\n\t\t\tString a = (String) aaa.get(i).toString().split(\",\")[0];\n\t\t}\n\t\tSystem.out.println(aaa.size());\n\t\t//String biao = \"用户名,姓名,排序,专家类型,业务专长,错误信息\\n\";\n\t\t//test.createCsv(biao, aaa, \"D:/\");\n\t\t// test.run(\"D:/abc.csv\");\n\t\t// HttpServletResponse response = null;\n\t\t// test.createCsv(response);\n//\t\tCSVReader reader = new CSVReader(new FileReader(\"D:/abc.csv\"));\n//\t\tColumnPositionMappingStrategy<Test> strat = new ColumnPositionMappingStrategy<Test>();\n//\t\tstrat.setType(Test.class);\n//\t\tString[] columns = new String[] {\"EquipLv\",\"Lv1\",\"Lv2\",\"Lv3\",\"Lv4\",\"Lv5\",\"Lv6\",\"Lv7\",\"Lv8\",\"Lv9\",\"Lv10\",\"Lv11\",\"Lv12\",\"Lv13\",\"Lv14\",\"Lv15\"}; // the fields to bind do in your JavaBean\n//\t\tstrat.setColumnMapping(columns);\n//\t\tCsvToBean<Test> csv = new CsvToBean<Test>();\n//\t\tList<Test> list = csv.parse(strat, reader);\n//\t\tSystem.out.println(list.size());\n//\t\tfor (Test test : list) {\n//\t\t\tSystem.out.println(test.getEquipLv());\n//\t\t\tSystem.out.print(test.getLv1());\n//\t\t\tSystem.out.print(test.getLv2());\n//\t\t\tSystem.out.print(test.getLv3());\n//\t\t\tSystem.out.print(test.getLv4());\n//\t\t\tSystem.out.print(test.getLv5());\n//\t\t\tSystem.out.print(test.getLv6());\n//\t\t\tSystem.out.print(test.getLv7());\n//\t\t\tSystem.out.print(test.getLv8());\n//\t\t\tSystem.out.print(test.getLv9());\n//\t\t\tSystem.out.print(test.getLv10());\n//\t\t\tSystem.out.print(test.getLv11());\n//\t\t\tSystem.out.print(test.getLv12());\n//\t\t\tSystem.out.print(test.getLv13());\n//\t\t\tSystem.out.print(test.getLv14());\n//\t\t\tSystem.out.print(test.getLv15());\n//\t\t}\n\n\t}\n}\n```\nCSV解析与XML解析的区别仅限于此，XML使用SaxReader来进行解析，而CSV自定义解析方式（当然网上也有很多别得第三方解析工具），接下来的步骤与XML解析一模一样，CsvDataLoader.java稍有不同的地方就是解析CSV文件的部分，代码如下：\n```java\npackage com.hjc._36.util.csv;\n\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.lang.reflect.Field;\nimport java.lang.reflect.Modifier;\nimport java.sql.Timestamp;\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.HashMap;\nimport java.util.LinkedList;\nimport java.util.List;\nimport java.util.Map;\n\nimport org.dom4j.Document;\nimport org.dom4j.DocumentException;\nimport org.dom4j.Element;\nimport org.dom4j.io.SAXReader;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\nimport com.hjc._36.core.GameInit;\n\npublic class CsvDataLoader {\n\tpublic static Logger logger = LoggerFactory.getLogger(CsvDataLoader.class);\n\tprivate String packageName;\n\tprivate String config; // 每一行就是一个配置文件名字\n\tpublic static int ActivityMaxValue;\n\n\tpublic CsvDataLoader(String packageName, String config) {\n\t\tthis.packageName = packageName;\n\t\tthis.config = config;\n\t}\n\n\t/**\n\t * 调用load方法加载所有的配置文件\n\t */\n\tpublic void load() {\n\t\tSAXReader reader = new SAXReader();\n\t\ttry {\n\t\t\tDocument doc = reader.read(new InputStreamReader(this.getClass()\n\t\t\t\t\t.getResourceAsStream(this.config)));\n\t\t\tList<?> nodes = doc.selectNodes(\"/config/file\");\n\t\t\tMap<String, List<?>> dataMap = new HashMap<String, List<?>>();\n\t\t\tList<String> files = new LinkedList<String>();\n\t\t\tfor (Object n : nodes) {\n\t\t\t\tElement t = (Element) n;\n\t\t\t\tString f = t.attributeValue(\"name\");\n\t\t\t\tList<?> dataList = this.loadFile(f, true);\n\t\t\t\tfor (Object o : dataList) {\n\t\t\t\t\tTempletService.getInstance().registerObject(o, dataMap);\n\t\t\t\t}\n\t\t\t\tfiles.add(f);\n\t\t\t}\n\t\t\tlogger.info(\"读取配置完毕，准备afterLoad\");\n\t\t\tTempletService.templetMap = dataMap;\n\t\t\tTempletService.getInstance().afterLoad();\n\t\t\tlogger.info(\"afterLoad 完毕\");\n\t\t} catch (DocumentException e) {\n\t\t\te.printStackTrace();\n\t\t} finally {\n\n\t\t}\n\t}\n\n\tprivate List<?> loadFile(String file, boolean exitWhenFail) {// 读文件\n\t\ttry {\n\t\t\tString clzName = file.replaceAll(\".csv\", \"\");\n\t\t\tfile = GameInit.confFileBasePath + file;\n\t\t\tlogger.info(\"load file: {}\", file);\n\t\t\tInputStream resourceAsStream = this.getClass().getResourceAsStream(\n\t\t\t\t\tfile);\n\t\t\tif (resourceAsStream == null) {\n\t\t\t\tlogger.error(\"文件不存在:\" + file);\n\t\t\t\tif (exitWhenFail) {\n\t\t\t\t\tSystem.exit(0);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn loadFromStream(resourceAsStream, clzName);\n\t\t} catch (Exception e) {\n\t\t\tlogger.error(\"载入文件出错：\" + file);\n\t\t\te.printStackTrace();\n\t\t\tSystem.exit(0);\n\t\t} finally {\n\t\t}\n\t\treturn Collections.EMPTY_LIST;\n\t}\n\n\tpublic List<?> loadFromStream(InputStream resourceAsStream, String clzName)\n\t\t\tthrows DocumentException, InstantiationException,\n\t\t\tIllegalAccessException, IOException {// 读csv文件\n\t\tCsvParser csvParser = new CsvParser(resourceAsStream);\n\t\tList<String> nodes = csvParser.getListWithNoHeader();\n\t\t// get clazz\n\t\tString className = this.packageName + clzName;\n\t\ttry {\n\t\t\tClass<?> classObject = Class.forName(className);\n\t\t\tif (classObject == null) {\n\t\t\t\tlogger.error(\"未找到类\" + className);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t// Get all the declared fields\n\t\t\tField[] fields = classObject.getDeclaredFields();\n\t\t\tLinkedList<Field> fieldList = new LinkedList<Field>();\n\t\t\tint length = fields.length;\n\t\t\tfor (int i = -1; ++i < length;) {\n\t\t\t\tboolean isStaticField = Modifier.isStatic(fields[i]\n\t\t\t\t\t\t.getModifiers());\n\t\t\t\tif (isStaticField)\n\t\t\t\t\tcontinue;\n\t\t\t\tboolean isTransientField = Modifier.isTransient(fields[i]\n\t\t\t\t\t\t.getModifiers());\n\t\t\t\tif (isTransientField)\n\t\t\t\t\tcontinue;\n\t\t\t\tfieldList.add(fields[i]);\n\t\t\t}\n\t\t\t// Get all the declared fields of supper class\n\t\t\tClass<?> tmp = classObject;\n\t\t\twhile ((tmp = tmp.getSuperclass()) != Object.class) {\n\t\t\t\tSystem.out.print(\"the extends class is\" + tmp.getName());\n\t\t\t\tfields = tmp.getDeclaredFields();\n\t\t\t\tlength = fields.length;\n\t\t\t\tif (length == 0)\n\t\t\t\t\tcontinue;\n\t\t\t\tfor (int i = -1; ++i < length;) {\n\t\t\t\t\tboolean isStaticField = Modifier.isStatic(fields[i]\n\t\t\t\t\t\t\t.getModifiers());\n\t\t\t\t\tif (isStaticField)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tboolean isTransientField = Modifier.isTransient(fields[i]\n\t\t\t\t\t\t\t.getModifiers());\n\t\t\t\t\tif (isTransientField)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tfieldList.add(fields[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// The truly need to return object\n\t\t\tList<Object> instances = new ArrayList<Object>(nodes.size());\n\t\t\tObject instance = null;\n\t\t\tString fieldName = null;\n\t\t\tString fieldValue = null;\n\t\t\tfor (String node : nodes) {\n\t\t\t\tif (node != null) {\n\t\t\t\t\tinstance = classObject.newInstance();\n\t\t\t\t\tboolean ok = false;\n\t\t\t\t\t// Element row = (Element) node;\n\t\t\t\t\tString[] values = node.split(\",\");// csv文件以英文逗号分割值\n\t\t\t\t\tfor (int i = 0; i < fieldList.size(); i++) {\n\t\t\t\t\t\tField field = fieldList.get(i);\n\t\t\t\t\t\tfieldName = field.getName();\n\t\t\t\t\t\tfieldValue = values[i];\n\t\t\t\t\t\tif (fieldValue == null)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.setField(instance, field, fieldValue);\n\t\t\t\t\t\t\tok = true;\n\t\t\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t\t\tlogger.error(\"类名称是\" + className + \"的属性\" + fieldName\n\t\t\t\t\t\t\t\t\t+ \"没有被成功赋予静态数据\");\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (ok) {\n\t\t\t\t\t\tinstances.add(instance);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn instances;\n\t\t} catch (ClassNotFoundException e1) {\n\t\t\te1.printStackTrace();\n\t\t\tlogger.error(\"未找到类\" + className);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @Title: setUnknowField\n\t * @Description:\n\t * @param ob\n\t * @param f\n\t * @param v\n\t * @throws IllegalArgumentException\n\t * @throws IllegalAccessException\n\t */\n\tprivate void setField(Object obj, Field f, String v)\n\t\t\tthrows IllegalArgumentException, IllegalAccessException {\n\t\tf.setAccessible(true);\n\t\tif (f.getType() == int.class) {\n\t\t\tf.setInt(obj, Integer.parseInt(v));\n\t\t} else if (f.getType() == short.class) {\n\t\t\tf.setShort(obj, Short.parseShort(v));\n\t\t} else if (f.getType() == byte.class) {\n\t\t\tf.setByte(obj, Byte.parseByte(v));\n\t\t} else if (f.getType() == long.class) {\n\t\t\tf.setLong(obj, Long.parseLong(v));\n\t\t} else if (f.getType() == double.class) {\n\t\t\tf.setDouble(obj, Double.parseDouble(v));\n\t\t} else if (f.getType() == float.class) {\n\t\t\tf.setFloat(obj, Float.parseFloat(v));\n\t\t} else if (f.getType() == Timestamp.class) {\n\t\t\tf.set(obj, Timestamp.valueOf(v));\n\t\t} else {\n\t\t\tf.set(obj, f.getType().cast(v));\n\t\t}\n\t}\n\n\t/**\n\t * Test Code\n\t *\n\t * @param args\n\t */\n\tpublic static void main(String[] args) {\n\t\tCsvDataLoader dl = new CsvDataLoader(\"com.hjc._36.template.\",\n\t\t\t\t\"/dataConfig.xml\");\n\t\tdl.load();\n\t}\n}\n```\n最后load()加载过后，依然使用TempletService来进行管理，使用方法也相同，具体代码参照上面。\n\n##### 以上便是我对Java读取CSV和XML资源文件的总结，有需要的同学可以直接拿去用。\n","source":"_posts/Java读取CSV和XML文件方法.md","raw":"---\ntitle: Java读取CSV和XML文件方法\ndate: 2016-02-18 15:59\ncategories: Java\ntags: [Java,csv,xml]\n---\n游戏开发中，读取策划给的配置表是必不可少的，我在之前公司，策划给的是xml表来读取，现在公司策划给的是CSV表来读取，其实大同小异，也并不是什么难点，我就简单分享下Java如何读取XML文件和CSV文件。以下工具类可随意拿去使用。\n<!--more-->\n### Java读XML文件\n如果是Maven项目，则依赖以下包（如果不是，则自己在项目添加配置相应jar包）\n```xml\n        <!-- dom4j begin -->\n\t\t<dependency>\n\t\t\t<groupId>dom4j</groupId>\n\t\t\t<artifactId>dom4j</artifactId>\n\t\t\t<version>1.6.1</version>\n\t\t</dependency>\n\t\t<!-- dom4j end -->\n\t\t<!--xml转换 -->\n\t\t<dependency>\n\t\t\t<groupId>com.thoughtworks.xstream</groupId>\n\t\t\t<artifactId>xstream</artifactId>\n\t\t\t<version>1.4.3</version>\n\t\t</dependency>\n```\n读取XML文件应该是比较常见的，用dom4j就可以很简单的读出来，首先准备一个XML文件，来映射出所有的XML资源文件的名字，资源文件如下：\ndataConfig.xml\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<config>\n \t<file name=\"Test.xml\" />\n</config>\n```\n示例资源XML文件如下\nTest.xml\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<dataset>\n \t<Test attr1=\"\" attr2=\"\" attr3=\"\" />\n</dataset>\n```\nJava项目中建一个类，变量名与XML中属性名相同，Java代码通过这个XML文件来找出所有的资源XML文件，然后将XML文件中的属性值全部读取到类中，再把类放进Map，加载到内存中，这样，每次需要读取配置表，就可以直接从内存中读取，快速且方便\n以下是XmlDataLoader.java，作用是从数据表中读取属性值到内存\n```java\npackage com.hjc._36.util.xml;\n\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.io.UnsupportedEncodingException;\nimport java.lang.reflect.Field;\nimport java.lang.reflect.Modifier;\nimport java.sql.Timestamp;\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.HashMap;\nimport java.util.LinkedList;\nimport java.util.List;\nimport java.util.Map;\n\nimport org.dom4j.Document;\nimport org.dom4j.DocumentException;\nimport org.dom4j.Element;\nimport org.dom4j.io.SAXReader;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\nimport com.hjc._36.core.GameInit;\nimport com.hjc._36.util.csv.TempletService;\n\n/**\n * 1 所有的template类都必须在一个包中 2 通过读取xml 遍历所有的Element，通过Element.name和 package 得到具体的\n * className; 3 通过Element的 attr 获取方法，并且根据parameterType 强制转换类型\n *\n * @author Administrator\n *\n */\npublic class XmlDataLoader {\n\tprivate String packageName;\n\tprivate String config; // 每一行就是一个配置文件名字\n\tprivate static Logger logger = LoggerFactory.getLogger(XmlDataLoader.class);\n\tpublic static int ActivityMaxValue;\n\n\tpublic XmlDataLoader(String packageName, String config) {\n\t\tthis.packageName = packageName;\n\t\tthis.config = config;\n\t}\n\n\t/**\n\t * 调用load方法加载所有的配置文件\n\t */\n\tpublic void load() {\n\t\tSAXReader reader = new SAXReader();\n\t\ttry {\n\t\t\tDocument doc = reader.read(new InputStreamReader(this.getClass()\n\t\t\t\t\t.getResourceAsStream(this.config)));\n\t\t\tList<?> nodes = doc.selectNodes(\"/config/file\");\n\t\t\tMap<String, List<?>> dataMap = new HashMap<String, List<?>>();\n\t\t\tList<String> files = new LinkedList<String>();\n\t\t\tfor (Object n : nodes) {\n\t\t\t\tElement t = (Element) n;\n\t\t\t\tString f = t.attributeValue(\"name\");\n\t\t\t\tList<?> dataList = this.loadFile(f, true);\n\t\t\t\tfor (Object o : dataList) {\n\t\t\t\t\tTempletService.getInstance().registerObject(o, dataMap);\n\t\t\t\t}\n\t\t\t\tfiles.add(f);\n\t\t\t}\n\t\t\tlogger.info(\"读取配置完毕，准备afterLoad\");\n\t\t\tTempletService.templetMap = dataMap;\n\t\t\tTempletService.getInstance().afterLoad();\n\t\t\tlogger.info(\"afterLoad 完毕\");\n\t\t} catch (DocumentException e) {\n\t\t\te.printStackTrace();\n\t\t} finally {\n\n\t\t}\n\t}\n\n\tprivate List<?> loadFile(String file, boolean exitWhenFail) {\n\t\ttry {\n\t\t\tfile = GameInit.confFileBasePath + file;\n\t\t\tlogger.info(\"load file: {}\", file);\n\t\t\tInputStream resourceAsStream = this.getClass().getResourceAsStream(\n\t\t\t\t\tfile);\n\t\t\tif (resourceAsStream == null) {\n\t\t\t\tlogger.error(\"文件不存在:\" + file);\n\t\t\t\tif (exitWhenFail) {\n\t\t\t\t\tSystem.exit(0);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn loadFromStream(resourceAsStream);\n\t\t} catch (Exception e) {\n\t\t\tlogger.error(\"载入文件出错：\" + file);\n\t\t\te.printStackTrace();\n\t\t\tSystem.exit(0);\n\t\t} finally {\n\t\t}\n\t\treturn Collections.EMPTY_LIST;\n\t}\n\n\tpublic List<?> loadFromStream(InputStream resourceAsStream)\n\t\t\tthrows UnsupportedEncodingException, DocumentException,\n\t\t\tInstantiationException, IllegalAccessException {\n\t\tSAXReader reader = new SAXReader();\n\t\tDocument doc = reader.read(new InputStreamReader(resourceAsStream,\n\t\t\t\t\"utf-8\"));\n\t\tElement dataSet = (Element) doc.selectNodes(\"/dataset\").get(0);\n\t\tList<?> nodes = dataSet.elements();\n\t\t// get clazz\n\t\tString className = this.packageName\n\t\t\t\t+ ((Element) nodes.get(0)).getName();\n\t\ttry {\n\t\t\tClass<?> classObject = Class.forName(className);\n\t\t\tif (classObject == null) {\n\t\t\t\tlogger.error(\"未找到类\" + className);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t// Get all the declared fields\n\t\t\tField[] fields = classObject.getDeclaredFields();\n\t\t\tLinkedList<Field> fieldList = new LinkedList<Field>();\n\t\t\tint length = fields.length;\n\t\t\tfor (int i = -1; ++i < length;) {\n\t\t\t\tboolean isStaticField = Modifier.isStatic(fields[i]\n\t\t\t\t\t\t.getModifiers());\n\t\t\t\tif (isStaticField)\n\t\t\t\t\tcontinue;\n\t\t\t\tboolean isTransientField = Modifier.isTransient(fields[i]\n\t\t\t\t\t\t.getModifiers());\n\t\t\t\tif (isTransientField)\n\t\t\t\t\tcontinue;\n\t\t\t\tfieldList.add(fields[i]);\n\t\t\t}\n\t\t\t// Get all the declared fields of supper class\n\t\t\tClass<?> tmp = classObject;\n\t\t\twhile ((tmp = tmp.getSuperclass()) != Object.class) {\n\t\t\t\tSystem.out.print(\"the extends class is\" + tmp.getName());\n\t\t\t\tfields = tmp.getDeclaredFields();\n\t\t\t\tlength = fields.length;\n\t\t\t\tif (length == 0)\n\t\t\t\t\tcontinue;\n\t\t\t\tfor (int i = -1; ++i < length;) {\n\t\t\t\t\tboolean isStaticField = Modifier.isStatic(fields[i]\n\t\t\t\t\t\t\t.getModifiers());\n\t\t\t\t\tif (isStaticField)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tboolean isTransientField = Modifier.isTransient(fields[i]\n\t\t\t\t\t\t\t.getModifiers());\n\t\t\t\t\tif (isTransientField)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tfieldList.add(fields[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// The truly need to return object\n\t\t\tList<Object> instances = new ArrayList<Object>(nodes.size());\n\t\t\tObject instance = null;\n\t\t\tString fieldName = null;\n\t\t\tString fieldValue = null;\n\t\t\tfor (Object node : nodes) {\n\t\t\t\tif (node != null) {\n\t\t\t\t\tinstance = classObject.newInstance();\n\t\t\t\t\tboolean ok = false;\n\t\t\t\t\tElement row = (Element) node;\n\t\t\t\t\tfor (Field field : fieldList) {\n\t\t\t\t\t\tfieldName = field.getName();\n\t\t\t\t\t\tfieldValue = row.attributeValue(fieldName);\n\t\t\t\t\t\tif (fieldValue == null)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.setField(instance, field, fieldValue);\n\t\t\t\t\t\t\tok = true;\n\t\t\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t\t\tlogger.error(\"类名称是\" + className + \"的属性\" + fieldName\n\t\t\t\t\t\t\t\t\t+ \"没有被成功赋予静态数据\");\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (ok)\n\t\t\t\t\t\tinstances.add(instance);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn instances;\n\t\t} catch (ClassNotFoundException e1) {\n\t\t\te1.printStackTrace();\n\t\t\tlogger.error(\"未找到类\" + className);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tpublic void reload() {\n\t}\n\n\t/**\n\t *\n\t * @Title: setUnknowField\n\t * @Description:\n\t * @param ob\n\t * @param f\n\t * @param v\n\t * @throws IllegalArgumentException\n\t * @throws IllegalAccessException\n\t */\n\tprivate void setField(Object obj, Field f, String v)\n\t\t\tthrows IllegalArgumentException, IllegalAccessException {\n\t\tf.setAccessible(true);\n\t\tif (f.getType() == int.class) {\n\t\t\tf.setInt(obj, Integer.parseInt(v));\n\t\t} else if (f.getType() == short.class) {\n\t\t\tf.setShort(obj, Short.parseShort(v));\n\t\t} else if (f.getType() == byte.class) {\n\t\t\tf.setByte(obj, Byte.parseByte(v));\n\t\t} else if (f.getType() == long.class) {\n\t\t\tf.setLong(obj, Long.parseLong(v));\n\t\t} else if (f.getType() == double.class) {\n\t\t\tf.setDouble(obj, Double.parseDouble(v));\n\t\t} else if (f.getType() == float.class) {\n\t\t\tf.setFloat(obj, Float.parseFloat(v));\n\t\t} else if (f.getType() == Timestamp.class) {\n\t\t\tf.set(obj, Timestamp.valueOf(v));\n\t\t} else {\n\t\t\tf.set(obj, f.getType().cast(v));\n\t\t}\n\t}\n\n\t/**\n\t * Test Code\n\t *\n\t * @param args\n\t */\n\tpublic static void main(String[] args) {\n\t\tXmlDataLoader dl = new XmlDataLoader(\"com.hjc._36.template.\",\n\t\t\t\t\"/dataConfig.xml\");\n\t\tdl.load();\n\t}\n\n}\n```\n如上的测试方法中看出，调用方式很简单，只需加载到映射XML文件，即可读取所有的配置XML文件，调用load()方法后，配置表就全部加载到了内存，我们通过以下类——TempletService.java来对这些配置数据进行管理：\n```java\npackage com.hjc._36.util.csv;\n\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\n/**\n * 添加一个数据表需要做以下几步\n * 1.在包com.hjc._36.template下创建对应的模板类，类名与数据文件一致\n * 2.在src/main/resources/xml/中添加模板数据文件\n * 3.在src/main/resources/dataConfig.xml加入刚才的模板数据文件\n *\n * @author 何金成\n *\n */\npublic class TempletService {\n\tpublic static Logger log = LoggerFactory.getLogger(TempletService.class);\n\tpublic static TempletService templetService = new TempletService();\n\t/**\n\t * key:实体名 value:该实体下的所有模板数据\n\t */\n\tpublic static Map<String, List<?>> templetMap = new HashMap<String, List<?>>();\n\n\tpublic TempletService() {\n\n\t}\n\n\tpublic static TempletService getInstance() {\n\t\treturn templetService;\n\t}\n\n\t/**\n\t * 获取该实体类下所有模板数据\n\t *\n\t * @param beanName\n\t * @return\n\t */\n\t@SuppressWarnings(\"unchecked\")\n\tpublic static List listAll(String beanName) {\n\t\treturn templetMap.get(beanName);\n\t}\n\n\t/**\n\t * @Title: registerObject\n\t * @Description: 注册对象到对应类的List中\n\t * @param o\n\t * @param dataMap\n\t * @return void\n\t * @throws\n\t */\n\tpublic void registerObject(Object o, Map<String, List<?>> dataMap) {\n\t\tadd(o.getClass().getSimpleName(), o, dataMap);\n\t}\n\n\n\n\t@SuppressWarnings(\"unchecked\")\n\tprivate void add(String key, Object data, Map<String, List<?>> dataMap) {\n\t\tList list = dataMap.get(key);\n\t\tif (list == null) {\n\t\t\tlist = new ArrayList();\n\t\t\tdataMap.put(key, list);\n\t\t}\n\t\tlist.add(data);\n\t}\n\n\tpublic void afterLoad() {\n\t\t// 加载后处理\n\t\t// List tests = TempletService.listAll(Test.class.getSimpleName());\n\t\t// for (Object object : tests) {\n\t\t// Test test = (Test)object;\n\t\t// System.out.print(test.getEquipLv());\n\t\t// System.out.print(\",\"+test.getLv1());\n\t\t// System.out.print(\",\"+test.getLv2());\n\t\t// System.out.print(\",\"+test.getLv3());\n\t\t// System.out.print(\",\"+test.getLv4());\n\t\t// System.out.print(\",\"+test.getLv5());\n\t\t// System.out.print(\",\"+test.getLv6());\n\t\t// System.out.print(\",\"+test.getLv7());\n\t\t// System.out.print(\",\"+test.getLv8());\n\t\t// System.out.print(\",\"+test.getLv9());\n\t\t// System.out.println(\",\"+test.getLv10());\n\t\t// }\n\t}\n\n\tpublic void loadCanShu() {\n\t\t// 加载全局参数xml配置\n\t}\n}\n```\n在load()中，变用到了上述类的registerObject方法来添加数据，在使用时，只需要调用listAll方法即可，在上面代码中的测试代码已经写明了用法。\n### Java读取CSV文件\nJava读CSV文件与读XML文件如出一辙，大致思路同上\ndataConfig.xml\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<config>\n \t<file name=\"Test.csv\" />\n \t<file name=\"JunjichuUpgrade.csv\" />\n \t<file name=\"Card.csv\" />\n \t<file name=\"Equip.csv\" />\n \t<file name=\"Prop.csv\" />\n</config>\n```\nTest.csv如下：\n```csv\n﻿等级,1星,2星,3星,4星,5星,6星,7星,8星,9星,10星,11星,12星,13星,14星,15星,16星,17星,18星,19星,20星,21星,22星,23星,24星,25星\nEquipLv,Lv1,Lv2,Lv3,Lv4,Lv5,Lv6,Lv7,Lv8,Lv9,Lv10,Lv11,Lv12,Lv13,Lv14,Lv15,Lv16,Lv17,Lv18,Lv19,Lv20,Lv21,Lv22,Lv23,Lv24,Lv25\n10,2,4,8,12,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n20,6,12,24,36,48,60,72,84,96,108,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n30,12,24,48,72,96,120,144,168,192,216,240,264,288,312,336,0,0,0,0,0,0,0,0,0,0\n40,20,40,80,120,160,200,240,280,320,360,400,440,480,520,560,0,0,0,0,0,0,0,0,0,0\n50,30,60,120,180,240,300,360,420,480,540,600,660,720,780,840,900,960,1020,1080,1140,0,0,0,0,0\n60,42,84,168,252,336,420,504,588,672,756,840,924,1008,1092,1176,1260,1344,1428,1512,1596,0,0,0,0,0\n70,56,112,224,336,448,560,672,784,896,1008,1120,1232,1344,1456,1568,1680,1792,1904,2016,2128,0,0,0,0,0\n80,72,144,288,432,576,720,864,1008,1152,1296,1440,1584,1728,1872,2016,2160,2304,2448,2592,2736,2880,3024,3168,3312,3456\n90,90,180,360,540,720,900,1080,1260,1440,1620,1800,1980,2160,2340,2520,2700,2880,3060,3240,3420,3600,3780,3960,4140,4320\n100,110,220,440,660,880,1100,1320,1540,1760,1980,2200,2420,2640,2860,3080,3300,3520,3740,3960,4180,4400,4620,4840,5060,5280\n```\n如上CSV表大家也能看出来，CSV文件中的数据是以一定规律呈现的，解析CSV便是根据CSV文件的这些特性来进行解析的，解析工具类CsvParser.java代码如下：\n```java\npackage com.hjc._36.util.csv;\n\nimport java.io.BufferedReader;\nimport java.io.BufferedWriter;\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.io.OutputStreamWriter;\nimport java.text.SimpleDateFormat;\nimport java.util.ArrayList;\nimport java.util.Date;\nimport java.util.Iterator;\nimport java.util.List;\n\n//JAVA 操作 excel 中的 .csv文件格式\npublic class CsvParser {\n\tprivate BufferedReader bufferedreader = null;\n\tprivate List list = new ArrayList();\n\n\tpublic CsvParser() {\n\t}\n\n\tpublic CsvParser(InputStream inStream) throws IOException {\n\t\tInputStreamReader isr = new InputStreamReader(inStream, \"UTF-8\");\n\t\tbufferedreader = new BufferedReader(isr);\n\t\tString stemp;\n\t\twhile ((stemp = bufferedreader.readLine()) != null) {\n\t\t\tlist.add(stemp);\n\t\t}\n\t}\n\n\tpublic List getList() throws IOException {\n\t\treturn list;\n\t}\n\n\tpublic List getListWithNoHeader() throws IOException {\n\t\treturn list.subList(2, list.size());\n\t}\n\n\t// 得到csv文件的行数\n\tpublic int getRowNum() {\n\t\treturn list.size();\n\t}\n\n\t// 得到csv文件的列数\n\tpublic int getColNum() {\n\t\tif (!list.toString().equals(\"[]\")) {\n\t\t\tif (list.get(0).toString().contains(\",\")) { // csv文件中，每列之间的是用','来分隔的\n\t\t\t\treturn list.get(0).toString().split(\",\").length;\n\t\t\t} else if (list.get(0).toString().trim().length() != 0) {\n\t\t\t\treturn 1;\n\t\t\t} else {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\t// 取得指定行的值\n\tpublic String getRow(int index) {\n\t\tif (this.list.size() != 0)\n\t\t\treturn (String) list.get(index);\n\t\telse\n\t\t\treturn null;\n\t}\n\n\t// 取得指定列的值\n\tpublic String getCol(int index) {\n\t\tif (this.getColNum() == 0) {\n\t\t\treturn null;\n\t\t}\n\t\tStringBuffer scol = new StringBuffer();\n\t\tString temp = null;\n\t\tint colnum = this.getColNum();\n\t\tif (colnum > 1) {\n\t\t\tfor (Iterator it = list.iterator(); it.hasNext();) {\n\t\t\t\ttemp = it.next().toString();\n\t\t\t\tscol = scol.append(temp.split(\",\")[index] + \",\");\n\t\t\t}\n\t\t} else {\n\t\t\tfor (Iterator it = list.iterator(); it.hasNext();) {\n\t\t\t\ttemp = it.next().toString();\n\t\t\t\tscol = scol.append(temp + \",\");\n\t\t\t}\n\t\t}\n\t\tString str = new String(scol.toString());\n\t\tstr = str.substring(0, str.length() - 1);\n\t\treturn str;\n\t}\n\n\t// 取得指定行，指定列的值\n\tpublic String getString(int row, int col) {\n\t\tString temp = null;\n\t\tint colnum = this.getColNum();\n\t\tif (colnum > 1) {\n\t\t\ttemp = list.get(row).toString().split(\",\")[col];\n\t\t} else if (colnum == 1) {\n\t\t\ttemp = list.get(row).toString();\n\t\t} else {\n\t\t\ttemp = null;\n\t\t}\n\t\treturn temp;\n\t}\n\n\tpublic void CsvClose() throws IOException {\n\t\tthis.bufferedreader.close();\n\t}\n\n\tpublic List readCvs(String filename) throws IOException {\n\t\tCsvParser cu = new CsvParser(new FileInputStream(new File(filename)));\n\t\tList list = cu.getList();\n\n\t\treturn list;\n\t}\n\n\tpublic void createCsv(String biao, List list, String path)\n\t\t\tthrows IOException {\n\t\tList tt = list;\n\t\tString data = \"\";\n\t\tSimpleDateFormat dataFormat = new SimpleDateFormat(\"yyyyMMdd\");\n\t\tDate today = new Date();\n\t\tString dateToday = dataFormat.format(today);\n\t\tFile file = new File(path + \"resource/expert/\" + dateToday\n\t\t\t\t+ \"importerrorinfo.csv\");\n\t\tif (!file.exists())\n\t\t\tfile.createNewFile();\n\t\telse\n\t\t\tfile.delete();\n\t\tString str[];\n\t\tStringBuilder sb = new StringBuilder(\"\");\n\t\tsb.append(biao);\n\t\tFileOutputStream writerStream = new FileOutputStream(file, true);\n\t\tBufferedWriter output = new BufferedWriter(new OutputStreamWriter(\n\t\t\t\twriterStream, \"UTF-8\"));\n\t\tfor (Iterator itt = tt.iterator(); itt.hasNext();) {\n\t\t\tString fileStr = itt.next().toString();\n\t\t\t// str = fileStr.split(\",\");\n\t\t\t// for (int i = 0; i <= str.length - 1; i++) { // 拆分成数组 用于插入数据库中\n\t\t\t// System.out.print(\"str[\" + i + \"]=\" + str[i] + \" \");\n\t\t\t// }\n\t\t\t// System.out.println(\"\");\n\t\t\tsb.append(fileStr + \"\\r\\n\");\n\t\t}\n\t\toutput.write(sb.toString());\n\t\toutput.flush();\n\t\toutput.close();\n\t}\n\n\tpublic static void main(String[] args) throws IOException {\n\t\tCsvParser test = new CsvParser();\n\t\tList aaa = test.readCvs(\"D:/abc.csv\");\n\t\tfor (int i = 0; i < aaa.size(); i++) {\n\t\t\tSystem.out.println(i + \"---\" + aaa.get(i));\n\t\t\tString a = (String) aaa.get(i).toString().split(\",\")[0];\n\t\t}\n\t\tSystem.out.println(aaa.size());\n\t\t//String biao = \"用户名,姓名,排序,专家类型,业务专长,错误信息\\n\";\n\t\t//test.createCsv(biao, aaa, \"D:/\");\n\t\t// test.run(\"D:/abc.csv\");\n\t\t// HttpServletResponse response = null;\n\t\t// test.createCsv(response);\n//\t\tCSVReader reader = new CSVReader(new FileReader(\"D:/abc.csv\"));\n//\t\tColumnPositionMappingStrategy<Test> strat = new ColumnPositionMappingStrategy<Test>();\n//\t\tstrat.setType(Test.class);\n//\t\tString[] columns = new String[] {\"EquipLv\",\"Lv1\",\"Lv2\",\"Lv3\",\"Lv4\",\"Lv5\",\"Lv6\",\"Lv7\",\"Lv8\",\"Lv9\",\"Lv10\",\"Lv11\",\"Lv12\",\"Lv13\",\"Lv14\",\"Lv15\"}; // the fields to bind do in your JavaBean\n//\t\tstrat.setColumnMapping(columns);\n//\t\tCsvToBean<Test> csv = new CsvToBean<Test>();\n//\t\tList<Test> list = csv.parse(strat, reader);\n//\t\tSystem.out.println(list.size());\n//\t\tfor (Test test : list) {\n//\t\t\tSystem.out.println(test.getEquipLv());\n//\t\t\tSystem.out.print(test.getLv1());\n//\t\t\tSystem.out.print(test.getLv2());\n//\t\t\tSystem.out.print(test.getLv3());\n//\t\t\tSystem.out.print(test.getLv4());\n//\t\t\tSystem.out.print(test.getLv5());\n//\t\t\tSystem.out.print(test.getLv6());\n//\t\t\tSystem.out.print(test.getLv7());\n//\t\t\tSystem.out.print(test.getLv8());\n//\t\t\tSystem.out.print(test.getLv9());\n//\t\t\tSystem.out.print(test.getLv10());\n//\t\t\tSystem.out.print(test.getLv11());\n//\t\t\tSystem.out.print(test.getLv12());\n//\t\t\tSystem.out.print(test.getLv13());\n//\t\t\tSystem.out.print(test.getLv14());\n//\t\t\tSystem.out.print(test.getLv15());\n//\t\t}\n\n\t}\n}\n```\nCSV解析与XML解析的区别仅限于此，XML使用SaxReader来进行解析，而CSV自定义解析方式（当然网上也有很多别得第三方解析工具），接下来的步骤与XML解析一模一样，CsvDataLoader.java稍有不同的地方就是解析CSV文件的部分，代码如下：\n```java\npackage com.hjc._36.util.csv;\n\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.lang.reflect.Field;\nimport java.lang.reflect.Modifier;\nimport java.sql.Timestamp;\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.HashMap;\nimport java.util.LinkedList;\nimport java.util.List;\nimport java.util.Map;\n\nimport org.dom4j.Document;\nimport org.dom4j.DocumentException;\nimport org.dom4j.Element;\nimport org.dom4j.io.SAXReader;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\nimport com.hjc._36.core.GameInit;\n\npublic class CsvDataLoader {\n\tpublic static Logger logger = LoggerFactory.getLogger(CsvDataLoader.class);\n\tprivate String packageName;\n\tprivate String config; // 每一行就是一个配置文件名字\n\tpublic static int ActivityMaxValue;\n\n\tpublic CsvDataLoader(String packageName, String config) {\n\t\tthis.packageName = packageName;\n\t\tthis.config = config;\n\t}\n\n\t/**\n\t * 调用load方法加载所有的配置文件\n\t */\n\tpublic void load() {\n\t\tSAXReader reader = new SAXReader();\n\t\ttry {\n\t\t\tDocument doc = reader.read(new InputStreamReader(this.getClass()\n\t\t\t\t\t.getResourceAsStream(this.config)));\n\t\t\tList<?> nodes = doc.selectNodes(\"/config/file\");\n\t\t\tMap<String, List<?>> dataMap = new HashMap<String, List<?>>();\n\t\t\tList<String> files = new LinkedList<String>();\n\t\t\tfor (Object n : nodes) {\n\t\t\t\tElement t = (Element) n;\n\t\t\t\tString f = t.attributeValue(\"name\");\n\t\t\t\tList<?> dataList = this.loadFile(f, true);\n\t\t\t\tfor (Object o : dataList) {\n\t\t\t\t\tTempletService.getInstance().registerObject(o, dataMap);\n\t\t\t\t}\n\t\t\t\tfiles.add(f);\n\t\t\t}\n\t\t\tlogger.info(\"读取配置完毕，准备afterLoad\");\n\t\t\tTempletService.templetMap = dataMap;\n\t\t\tTempletService.getInstance().afterLoad();\n\t\t\tlogger.info(\"afterLoad 完毕\");\n\t\t} catch (DocumentException e) {\n\t\t\te.printStackTrace();\n\t\t} finally {\n\n\t\t}\n\t}\n\n\tprivate List<?> loadFile(String file, boolean exitWhenFail) {// 读文件\n\t\ttry {\n\t\t\tString clzName = file.replaceAll(\".csv\", \"\");\n\t\t\tfile = GameInit.confFileBasePath + file;\n\t\t\tlogger.info(\"load file: {}\", file);\n\t\t\tInputStream resourceAsStream = this.getClass().getResourceAsStream(\n\t\t\t\t\tfile);\n\t\t\tif (resourceAsStream == null) {\n\t\t\t\tlogger.error(\"文件不存在:\" + file);\n\t\t\t\tif (exitWhenFail) {\n\t\t\t\t\tSystem.exit(0);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn loadFromStream(resourceAsStream, clzName);\n\t\t} catch (Exception e) {\n\t\t\tlogger.error(\"载入文件出错：\" + file);\n\t\t\te.printStackTrace();\n\t\t\tSystem.exit(0);\n\t\t} finally {\n\t\t}\n\t\treturn Collections.EMPTY_LIST;\n\t}\n\n\tpublic List<?> loadFromStream(InputStream resourceAsStream, String clzName)\n\t\t\tthrows DocumentException, InstantiationException,\n\t\t\tIllegalAccessException, IOException {// 读csv文件\n\t\tCsvParser csvParser = new CsvParser(resourceAsStream);\n\t\tList<String> nodes = csvParser.getListWithNoHeader();\n\t\t// get clazz\n\t\tString className = this.packageName + clzName;\n\t\ttry {\n\t\t\tClass<?> classObject = Class.forName(className);\n\t\t\tif (classObject == null) {\n\t\t\t\tlogger.error(\"未找到类\" + className);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t// Get all the declared fields\n\t\t\tField[] fields = classObject.getDeclaredFields();\n\t\t\tLinkedList<Field> fieldList = new LinkedList<Field>();\n\t\t\tint length = fields.length;\n\t\t\tfor (int i = -1; ++i < length;) {\n\t\t\t\tboolean isStaticField = Modifier.isStatic(fields[i]\n\t\t\t\t\t\t.getModifiers());\n\t\t\t\tif (isStaticField)\n\t\t\t\t\tcontinue;\n\t\t\t\tboolean isTransientField = Modifier.isTransient(fields[i]\n\t\t\t\t\t\t.getModifiers());\n\t\t\t\tif (isTransientField)\n\t\t\t\t\tcontinue;\n\t\t\t\tfieldList.add(fields[i]);\n\t\t\t}\n\t\t\t// Get all the declared fields of supper class\n\t\t\tClass<?> tmp = classObject;\n\t\t\twhile ((tmp = tmp.getSuperclass()) != Object.class) {\n\t\t\t\tSystem.out.print(\"the extends class is\" + tmp.getName());\n\t\t\t\tfields = tmp.getDeclaredFields();\n\t\t\t\tlength = fields.length;\n\t\t\t\tif (length == 0)\n\t\t\t\t\tcontinue;\n\t\t\t\tfor (int i = -1; ++i < length;) {\n\t\t\t\t\tboolean isStaticField = Modifier.isStatic(fields[i]\n\t\t\t\t\t\t\t.getModifiers());\n\t\t\t\t\tif (isStaticField)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tboolean isTransientField = Modifier.isTransient(fields[i]\n\t\t\t\t\t\t\t.getModifiers());\n\t\t\t\t\tif (isTransientField)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tfieldList.add(fields[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// The truly need to return object\n\t\t\tList<Object> instances = new ArrayList<Object>(nodes.size());\n\t\t\tObject instance = null;\n\t\t\tString fieldName = null;\n\t\t\tString fieldValue = null;\n\t\t\tfor (String node : nodes) {\n\t\t\t\tif (node != null) {\n\t\t\t\t\tinstance = classObject.newInstance();\n\t\t\t\t\tboolean ok = false;\n\t\t\t\t\t// Element row = (Element) node;\n\t\t\t\t\tString[] values = node.split(\",\");// csv文件以英文逗号分割值\n\t\t\t\t\tfor (int i = 0; i < fieldList.size(); i++) {\n\t\t\t\t\t\tField field = fieldList.get(i);\n\t\t\t\t\t\tfieldName = field.getName();\n\t\t\t\t\t\tfieldValue = values[i];\n\t\t\t\t\t\tif (fieldValue == null)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.setField(instance, field, fieldValue);\n\t\t\t\t\t\t\tok = true;\n\t\t\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t\t\tlogger.error(\"类名称是\" + className + \"的属性\" + fieldName\n\t\t\t\t\t\t\t\t\t+ \"没有被成功赋予静态数据\");\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (ok) {\n\t\t\t\t\t\tinstances.add(instance);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn instances;\n\t\t} catch (ClassNotFoundException e1) {\n\t\t\te1.printStackTrace();\n\t\t\tlogger.error(\"未找到类\" + className);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @Title: setUnknowField\n\t * @Description:\n\t * @param ob\n\t * @param f\n\t * @param v\n\t * @throws IllegalArgumentException\n\t * @throws IllegalAccessException\n\t */\n\tprivate void setField(Object obj, Field f, String v)\n\t\t\tthrows IllegalArgumentException, IllegalAccessException {\n\t\tf.setAccessible(true);\n\t\tif (f.getType() == int.class) {\n\t\t\tf.setInt(obj, Integer.parseInt(v));\n\t\t} else if (f.getType() == short.class) {\n\t\t\tf.setShort(obj, Short.parseShort(v));\n\t\t} else if (f.getType() == byte.class) {\n\t\t\tf.setByte(obj, Byte.parseByte(v));\n\t\t} else if (f.getType() == long.class) {\n\t\t\tf.setLong(obj, Long.parseLong(v));\n\t\t} else if (f.getType() == double.class) {\n\t\t\tf.setDouble(obj, Double.parseDouble(v));\n\t\t} else if (f.getType() == float.class) {\n\t\t\tf.setFloat(obj, Float.parseFloat(v));\n\t\t} else if (f.getType() == Timestamp.class) {\n\t\t\tf.set(obj, Timestamp.valueOf(v));\n\t\t} else {\n\t\t\tf.set(obj, f.getType().cast(v));\n\t\t}\n\t}\n\n\t/**\n\t * Test Code\n\t *\n\t * @param args\n\t */\n\tpublic static void main(String[] args) {\n\t\tCsvDataLoader dl = new CsvDataLoader(\"com.hjc._36.template.\",\n\t\t\t\t\"/dataConfig.xml\");\n\t\tdl.load();\n\t}\n}\n```\n最后load()加载过后，依然使用TempletService来进行管理，使用方法也相同，具体代码参照上面。\n\n##### 以上便是我对Java读取CSV和XML资源文件的总结，有需要的同学可以直接拿去用。\n","slug":"Java读取CSV和XML文件方法","published":1,"updated":"2016-04-22T16:57:04.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhvt0051wsaz9itvfrhh","content":"<p>游戏开发中，读取策划给的配置表是必不可少的，我在之前公司，策划给的是xml表来读取，现在公司策划给的是CSV表来读取，其实大同小异，也并不是什么难点，我就简单分享下Java如何读取XML文件和CSV文件。以下工具类可随意拿去使用。</p>\n<a id=\"more\"></a>\n<h3 id=\"Java读XML文件\"><a href=\"#Java读XML文件\" class=\"headerlink\" title=\"Java读XML文件\"></a>Java读XML文件</h3><p>如果是Maven项目，则依赖以下包（如果不是，则自己在项目添加配置相应jar包）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">      <span class=\"comment\">&lt;!-- dom4j begin --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>dom4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dom4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.6.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- dom4j end --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--xml转换 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.thoughtworks.xstream<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>xstream<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.4.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>读取XML文件应该是比较常见的，用dom4j就可以很简单的读出来，首先准备一个XML文件，来映射出所有的XML资源文件的名字，资源文件如下：<br>dataConfig.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">config</span>&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">file</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Test.xml&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">config</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>示例资源XML文件如下<br>Test.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dataset</span>&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">Test</span> <span class=\"attr\">attr1</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">attr2</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">attr3</span>=<span class=\"string\">&quot;&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dataset</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>Java项目中建一个类，变量名与XML中属性名相同，Java代码通过这个XML文件来找出所有的资源XML文件，然后将XML文件中的属性值全部读取到类中，再把类放进Map，加载到内存中，这样，每次需要读取配置表，就可以直接从内存中读取，快速且方便<br>以下是XmlDataLoader.java，作用是从数据表中读取属性值到内存</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc._36.util.xml;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.UnsupportedEncodingException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Field;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Modifier;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.sql.Timestamp;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.LinkedList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.DocumentException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.Element;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.io.SAXReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc._36.core.GameInit;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc._36.util.csv.TempletService;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 1 所有的template类都必须在一个包中 2 通过读取xml 遍历所有的Element，通过Element.name和 package 得到具体的</span></span><br><span class=\"line\"><span class=\"comment\"> * className; 3 通过Element的 attr 获取方法，并且根据parameterType 强制转换类型</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Administrator</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">XmlDataLoader</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String packageName;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String config; <span class=\"comment\">// 每一行就是一个配置文件名字</span></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Logger logger = LoggerFactory.getLogger(XmlDataLoader.class);</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> ActivityMaxValue;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">XmlDataLoader</span><span class=\"params\">(String packageName, String config)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.packageName = packageName;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.config = config;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 调用load方法加载所有的配置文件</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">load</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tSAXReader reader = <span class=\"keyword\">new</span> SAXReader();</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tDocument doc = reader.read(<span class=\"keyword\">new</span> InputStreamReader(<span class=\"keyword\">this</span>.getClass()</span><br><span class=\"line\">\t\t\t\t\t.getResourceAsStream(<span class=\"keyword\">this</span>.config)));</span><br><span class=\"line\">\t\t\tList&lt;?&gt; nodes = doc.selectNodes(<span class=\"string\">&quot;/config/file&quot;</span>);</span><br><span class=\"line\">\t\t\tMap&lt;String, List&lt;?&gt;&gt; dataMap = <span class=\"keyword\">new</span> HashMap&lt;String, List&lt;?&gt;&gt;();</span><br><span class=\"line\">\t\t\tList&lt;String&gt; files = <span class=\"keyword\">new</span> LinkedList&lt;String&gt;();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (Object n : nodes) &#123;</span><br><span class=\"line\">\t\t\t\tElement t = (Element) n;</span><br><span class=\"line\">\t\t\t\tString f = t.attributeValue(<span class=\"string\">&quot;name&quot;</span>);</span><br><span class=\"line\">\t\t\t\tList&lt;?&gt; dataList = <span class=\"keyword\">this</span>.loadFile(f, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (Object o : dataList) &#123;</span><br><span class=\"line\">\t\t\t\t\tTempletService.getInstance().registerObject(o, dataMap);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tfiles.add(f);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tlogger.info(<span class=\"string\">&quot;读取配置完毕，准备afterLoad&quot;</span>);</span><br><span class=\"line\">\t\t\tTempletService.templetMap = dataMap;</span><br><span class=\"line\">\t\t\tTempletService.getInstance().afterLoad();</span><br><span class=\"line\">\t\t\tlogger.info(<span class=\"string\">&quot;afterLoad 完毕&quot;</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (DocumentException e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> List&lt;?&gt; loadFile(String file, <span class=\"keyword\">boolean</span> exitWhenFail) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tfile = GameInit.confFileBasePath + file;</span><br><span class=\"line\">\t\t\tlogger.info(<span class=\"string\">&quot;load file: &#123;&#125;&quot;</span>, file);</span><br><span class=\"line\">\t\t\tInputStream resourceAsStream = <span class=\"keyword\">this</span>.getClass().getResourceAsStream(</span><br><span class=\"line\">\t\t\t\t\tfile);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (resourceAsStream == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tlogger.error(<span class=\"string\">&quot;文件不存在:&quot;</span> + file);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (exitWhenFail) &#123;</span><br><span class=\"line\">\t\t\t\t\tSystem.exit(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> loadFromStream(resourceAsStream);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\tlogger.error(<span class=\"string\">&quot;载入文件出错：&quot;</span> + file);</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\tSystem.exit(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> Collections.EMPTY_LIST;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> List&lt;?&gt; loadFromStream(InputStream resourceAsStream)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">throws</span> UnsupportedEncodingException, DocumentException,</span><br><span class=\"line\">\t\t\tInstantiationException, IllegalAccessException &#123;</span><br><span class=\"line\">\t\tSAXReader reader = <span class=\"keyword\">new</span> SAXReader();</span><br><span class=\"line\">\t\tDocument doc = reader.read(<span class=\"keyword\">new</span> InputStreamReader(resourceAsStream,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;utf-8&quot;</span>));</span><br><span class=\"line\">\t\tElement dataSet = (Element) doc.selectNodes(<span class=\"string\">&quot;/dataset&quot;</span>).get(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t\tList&lt;?&gt; nodes = dataSet.elements();</span><br><span class=\"line\">\t\t<span class=\"comment\">// get clazz</span></span><br><span class=\"line\">\t\tString className = <span class=\"keyword\">this</span>.packageName</span><br><span class=\"line\">\t\t\t\t+ ((Element) nodes.get(<span class=\"number\">0</span>)).getName();</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tClass&lt;?&gt; classObject = Class.forName(className);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (classObject == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tlogger.error(<span class=\"string\">&quot;未找到类&quot;</span> + className);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Get all the declared fields</span></span><br><span class=\"line\">\t\t\tField[] fields = classObject.getDeclaredFields();</span><br><span class=\"line\">\t\t\tLinkedList&lt;Field&gt; fieldList = <span class=\"keyword\">new</span> LinkedList&lt;Field&gt;();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> length = fields.length;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = -<span class=\"number\">1</span>; ++i &lt; length;) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">boolean</span> isStaticField = Modifier.isStatic(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (isStaticField)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">boolean</span> isTransientField = Modifier.isTransient(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (isTransientField)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\tfieldList.add(fields[i]);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Get all the declared fields of supper class</span></span><br><span class=\"line\">\t\t\tClass&lt;?&gt; tmp = classObject;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> ((tmp = tmp.getSuperclass()) != Object.class) &#123;</span><br><span class=\"line\">\t\t\t\tSystem.out.print(<span class=\"string\">&quot;the extends class is&quot;</span> + tmp.getName());</span><br><span class=\"line\">\t\t\t\tfields = tmp.getDeclaredFields();</span><br><span class=\"line\">\t\t\t\tlength = fields.length;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (length == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = -<span class=\"number\">1</span>; ++i &lt; length;) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">boolean</span> isStaticField = Modifier.isStatic(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (isStaticField)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">boolean</span> isTransientField = Modifier.isTransient(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (isTransientField)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\tfieldList.add(fields[i]);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// The truly need to return object</span></span><br><span class=\"line\">\t\t\tList&lt;Object&gt; instances = <span class=\"keyword\">new</span> ArrayList&lt;Object&gt;(nodes.size());</span><br><span class=\"line\">\t\t\tObject instance = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\tString fieldName = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\tString fieldValue = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (Object node : nodes) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (node != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tinstance = classObject.newInstance();</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">boolean</span> ok = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t\t\t\tElement row = (Element) node;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span> (Field field : fieldList) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tfieldName = field.getName();</span><br><span class=\"line\">\t\t\t\t\t\tfieldValue = row.attributeValue(fieldName);</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span> (fieldValue == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">this</span>.setField(instance, field, fieldValue);</span><br><span class=\"line\">\t\t\t\t\t\t\tok = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tlogger.error(<span class=\"string\">&quot;类名称是&quot;</span> + className + <span class=\"string\">&quot;的属性&quot;</span> + fieldName</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t+ <span class=\"string\">&quot;没有被成功赋予静态数据&quot;</span>);</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (ok)</span><br><span class=\"line\">\t\t\t\t\t\tinstances.add(instance);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> instances;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e1) &#123;</span><br><span class=\"line\">\t\t\te1.printStackTrace();</span><br><span class=\"line\">\t\t\tlogger.error(<span class=\"string\">&quot;未找到类&quot;</span> + className);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">reload</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t *</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@Title</span>: setUnknowField</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@Description</span>:</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> ob</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> f</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> v</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> IllegalArgumentException</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> IllegalAccessException</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">setField</span><span class=\"params\">(Object obj, Field f, String v)</span></span></span><br><span class=\"line\"><span class=\"function\">\t\t\t<span class=\"keyword\">throws</span> IllegalArgumentException, IllegalAccessException </span>&#123;</span><br><span class=\"line\">\t\tf.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">int</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setInt(obj, Integer.parseInt(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">short</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setShort(obj, Short.parseShort(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">byte</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setByte(obj, Byte.parseByte(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">long</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setLong(obj, Long.parseLong(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">double</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setDouble(obj, Double.parseDouble(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">float</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setFloat(obj, Float.parseFloat(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == Timestamp.class) &#123;</span><br><span class=\"line\">\t\t\tf.set(obj, Timestamp.valueOf(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tf.set(obj, f.getType().cast(v));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Test Code</span></span><br><span class=\"line\"><span class=\"comment\">\t *</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> args</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">\t\tXmlDataLoader dl = <span class=\"keyword\">new</span> XmlDataLoader(<span class=\"string\">&quot;com.hjc._36.template.&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;/dataConfig.xml&quot;</span>);</span><br><span class=\"line\">\t\tdl.load();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如上的测试方法中看出，调用方式很简单，只需加载到映射XML文件，即可读取所有的配置XML文件，调用load()方法后，配置表就全部加载到了内存，我们通过以下类——TempletService.java来对这些配置数据进行管理：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc._36.util.csv;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 添加一个数据表需要做以下几步</span></span><br><span class=\"line\"><span class=\"comment\"> * 1.在包com.hjc._36.template下创建对应的模板类，类名与数据文件一致</span></span><br><span class=\"line\"><span class=\"comment\"> * 2.在src/main/resources/xml/中添加模板数据文件</span></span><br><span class=\"line\"><span class=\"comment\"> * 3.在src/main/resources/dataConfig.xml加入刚才的模板数据文件</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> 何金成</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TempletService</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Logger log = LoggerFactory.getLogger(TempletService.class);</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> TempletService templetService = <span class=\"keyword\">new</span> TempletService();</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * key:实体名 value:该实体下的所有模板数据</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Map&lt;String, List&lt;?&gt;&gt; templetMap = <span class=\"keyword\">new</span> HashMap&lt;String, List&lt;?&gt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TempletService</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> TempletService <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> templetService;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 获取该实体类下所有模板数据</span></span><br><span class=\"line\"><span class=\"comment\">\t *</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> beanName</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> List <span class=\"title\">listAll</span><span class=\"params\">(String beanName)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> templetMap.get(beanName);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@Title</span>: registerObject</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@Description</span>: 注册对象到对应类的List中</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> o</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> dataMap</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span></span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerObject</span><span class=\"params\">(Object o, Map&lt;String, List&lt;?&gt;&gt; dataMap)</span> </span>&#123;</span><br><span class=\"line\">\t\tadd(o.getClass().getSimpleName(), o, dataMap);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(String key, Object data, Map&lt;String, List&lt;?&gt;&gt; dataMap)</span> </span>&#123;</span><br><span class=\"line\">\t\tList list = dataMap.get(key);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (list == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tlist = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">\t\t\tdataMap.put(key, list);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tlist.add(data);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterLoad</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 加载后处理</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// List tests = TempletService.listAll(Test.class.getSimpleName());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// for (Object object : tests) &#123;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// Test test = (Test)object;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(test.getEquipLv());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv1());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv2());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv3());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv4());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv5());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv6());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv7());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv8());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv9());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.println(&quot;,&quot;+test.getLv10());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// &#125;</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">loadCanShu</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 加载全局参数xml配置</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在load()中，变用到了上述类的registerObject方法来添加数据，在使用时，只需要调用listAll方法即可，在上面代码中的测试代码已经写明了用法。</p>\n<h3 id=\"Java读取CSV文件\"><a href=\"#Java读取CSV文件\" class=\"headerlink\" title=\"Java读取CSV文件\"></a>Java读取CSV文件</h3><p>Java读CSV文件与读XML文件如出一辙，大致思路同上<br>dataConfig.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">config</span>&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">file</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Test.csv&quot;</span> /&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">file</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;JunjichuUpgrade.csv&quot;</span> /&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">file</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Card.csv&quot;</span> /&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">file</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Equip.csv&quot;</span> /&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">file</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Prop.csv&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">config</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>Test.csv如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﻿等级,1星,2星,3星,4星,5星,6星,7星,8星,9星,10星,11星,12星,13星,14星,15星,16星,17星,18星,19星,20星,21星,22星,23星,24星,25星</span><br><span class=\"line\">EquipLv,Lv1,Lv2,Lv3,Lv4,Lv5,Lv6,Lv7,Lv8,Lv9,Lv10,Lv11,Lv12,Lv13,Lv14,Lv15,Lv16,Lv17,Lv18,Lv19,Lv20,Lv21,Lv22,Lv23,Lv24,Lv25</span><br><span class=\"line\">10,2,4,8,12,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">20,6,12,24,36,48,60,72,84,96,108,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">30,12,24,48,72,96,120,144,168,192,216,240,264,288,312,336,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">40,20,40,80,120,160,200,240,280,320,360,400,440,480,520,560,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">50,30,60,120,180,240,300,360,420,480,540,600,660,720,780,840,900,960,1020,1080,1140,0,0,0,0,0</span><br><span class=\"line\">60,42,84,168,252,336,420,504,588,672,756,840,924,1008,1092,1176,1260,1344,1428,1512,1596,0,0,0,0,0</span><br><span class=\"line\">70,56,112,224,336,448,560,672,784,896,1008,1120,1232,1344,1456,1568,1680,1792,1904,2016,2128,0,0,0,0,0</span><br><span class=\"line\">80,72,144,288,432,576,720,864,1008,1152,1296,1440,1584,1728,1872,2016,2160,2304,2448,2592,2736,2880,3024,3168,3312,3456</span><br><span class=\"line\">90,90,180,360,540,720,900,1080,1260,1440,1620,1800,1980,2160,2340,2520,2700,2880,3060,3240,3420,3600,3780,3960,4140,4320</span><br><span class=\"line\">100,110,220,440,660,880,1100,1320,1540,1760,1980,2200,2420,2640,2860,3080,3300,3520,3740,3960,4180,4400,4620,4840,5060,5280</span><br></pre></td></tr></table></figure>\n<p>如上CSV表大家也能看出来，CSV文件中的数据是以一定规律呈现的，解析CSV便是根据CSV文件的这些特性来进行解析的，解析工具类CsvParser.java代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc._36.util.csv;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedWriter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileInputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileOutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.OutputStreamWriter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.text.SimpleDateFormat;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Iterator;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//JAVA 操作 excel 中的 .csv文件格式</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CsvParser</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> BufferedReader bufferedreader = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> List list = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CsvParser</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CsvParser</span><span class=\"params\">(InputStream inStream)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\tInputStreamReader isr = <span class=\"keyword\">new</span> InputStreamReader(inStream, <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">\t\tbufferedreader = <span class=\"keyword\">new</span> BufferedReader(isr);</span><br><span class=\"line\">\t\tString stemp;</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> ((stemp = bufferedreader.readLine()) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tlist.add(stemp);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getList</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> list;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getListWithNoHeader</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> list.subList(<span class=\"number\">2</span>, list.size());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 得到csv文件的行数</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getRowNum</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> list.size();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 得到csv文件的列数</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getColNum</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!list.toString().equals(<span class=\"string\">&quot;[]&quot;</span>)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (list.get(<span class=\"number\">0</span>).toString().contains(<span class=\"string\">&quot;,&quot;</span>)) &#123; <span class=\"comment\">// csv文件中，每列之间的是用&#x27;,&#x27;来分隔的</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> list.get(<span class=\"number\">0</span>).toString().split(<span class=\"string\">&quot;,&quot;</span>).length;</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (list.get(<span class=\"number\">0</span>).toString().trim().length() != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 取得指定行的值</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getRow</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.list.size() != <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> (String) list.get(index);</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 取得指定列的值</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getCol</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.getColNum() == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tStringBuffer scol = <span class=\"keyword\">new</span> StringBuffer();</span><br><span class=\"line\">\t\tString temp = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> colnum = <span class=\"keyword\">this</span>.getColNum();</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (colnum &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (Iterator it = list.iterator(); it.hasNext();) &#123;</span><br><span class=\"line\">\t\t\t\ttemp = it.next().toString();</span><br><span class=\"line\">\t\t\t\tscol = scol.append(temp.split(<span class=\"string\">&quot;,&quot;</span>)[index] + <span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (Iterator it = list.iterator(); it.hasNext();) &#123;</span><br><span class=\"line\">\t\t\t\ttemp = it.next().toString();</span><br><span class=\"line\">\t\t\t\tscol = scol.append(temp + <span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tString str = <span class=\"keyword\">new</span> String(scol.toString());</span><br><span class=\"line\">\t\tstr = str.substring(<span class=\"number\">0</span>, str.length() - <span class=\"number\">1</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> str;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 取得指定行，指定列的值</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getString</span><span class=\"params\">(<span class=\"keyword\">int</span> row, <span class=\"keyword\">int</span> col)</span> </span>&#123;</span><br><span class=\"line\">\t\tString temp = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> colnum = <span class=\"keyword\">this</span>.getColNum();</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (colnum &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t\ttemp = list.get(row).toString().split(<span class=\"string\">&quot;,&quot;</span>)[col];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (colnum == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t\ttemp = list.get(row).toString();</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\ttemp = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> temp;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">CsvClose</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.bufferedreader.close();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">readCvs</span><span class=\"params\">(String filename)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\tCsvParser cu = <span class=\"keyword\">new</span> CsvParser(<span class=\"keyword\">new</span> FileInputStream(<span class=\"keyword\">new</span> File(filename)));</span><br><span class=\"line\">\t\tList list = cu.getList();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> list;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createCsv</span><span class=\"params\">(String biao, List list, String path)</span></span></span><br><span class=\"line\"><span class=\"function\">\t\t\t<span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\tList tt = list;</span><br><span class=\"line\">\t\tString data = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">\t\tSimpleDateFormat dataFormat = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyyMMdd&quot;</span>);</span><br><span class=\"line\">\t\tDate today = <span class=\"keyword\">new</span> Date();</span><br><span class=\"line\">\t\tString dateToday = dataFormat.format(today);</span><br><span class=\"line\">\t\tFile file = <span class=\"keyword\">new</span> File(path + <span class=\"string\">&quot;resource/expert/&quot;</span> + dateToday</span><br><span class=\"line\">\t\t\t\t+ <span class=\"string\">&quot;importerrorinfo.csv&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!file.exists())</span><br><span class=\"line\">\t\t\tfile.createNewFile();</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\tfile.delete();</span><br><span class=\"line\">\t\tString str[];</span><br><span class=\"line\">\t\tStringBuilder sb = <span class=\"keyword\">new</span> StringBuilder(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">\t\tsb.append(biao);</span><br><span class=\"line\">\t\tFileOutputStream writerStream = <span class=\"keyword\">new</span> FileOutputStream(file, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\tBufferedWriter output = <span class=\"keyword\">new</span> BufferedWriter(<span class=\"keyword\">new</span> OutputStreamWriter(</span><br><span class=\"line\">\t\t\t\twriterStream, <span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (Iterator itt = tt.iterator(); itt.hasNext();) &#123;</span><br><span class=\"line\">\t\t\tString fileStr = itt.next().toString();</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// str = fileStr.split(&quot;,&quot;);</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// for (int i = 0; i &lt;= str.length - 1; i++) &#123; // 拆分成数组 用于插入数据库中</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// System.out.print(&quot;str[&quot; + i + &quot;]=&quot; + str[i] + &quot; &quot;);</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// &#125;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// System.out.println(&quot;&quot;);</span></span><br><span class=\"line\">\t\t\tsb.append(fileStr + <span class=\"string\">&quot;\\r\\n&quot;</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\toutput.write(sb.toString());</span><br><span class=\"line\">\t\toutput.flush();</span><br><span class=\"line\">\t\toutput.close();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\tCsvParser test = <span class=\"keyword\">new</span> CsvParser();</span><br><span class=\"line\">\t\tList aaa = test.readCvs(<span class=\"string\">&quot;D:/abc.csv&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; aaa.size(); i++) &#123;</span><br><span class=\"line\">\t\t\tSystem.out.println(i + <span class=\"string\">&quot;---&quot;</span> + aaa.get(i));</span><br><span class=\"line\">\t\t\tString a = (String) aaa.get(i).toString().split(<span class=\"string\">&quot;,&quot;</span>)[<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tSystem.out.println(aaa.size());</span><br><span class=\"line\">\t\t<span class=\"comment\">//String biao = &quot;用户名,姓名,排序,专家类型,业务专长,错误信息\\n&quot;;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//test.createCsv(biao, aaa, &quot;D:/&quot;);</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// test.run(&quot;D:/abc.csv&quot;);</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// HttpServletResponse response = null;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// test.createCsv(response);</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tCSVReader reader = new CSVReader(new FileReader(&quot;D:/abc.csv&quot;));</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tColumnPositionMappingStrategy&lt;Test&gt; strat = new ColumnPositionMappingStrategy&lt;Test&gt;();</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tstrat.setType(Test.class);</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tString[] columns = new String[] &#123;&quot;EquipLv&quot;,&quot;Lv1&quot;,&quot;Lv2&quot;,&quot;Lv3&quot;,&quot;Lv4&quot;,&quot;Lv5&quot;,&quot;Lv6&quot;,&quot;Lv7&quot;,&quot;Lv8&quot;,&quot;Lv9&quot;,&quot;Lv10&quot;,&quot;Lv11&quot;,&quot;Lv12&quot;,&quot;Lv13&quot;,&quot;Lv14&quot;,&quot;Lv15&quot;&#125;; // the fields to bind do in your JavaBean</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tstrat.setColumnMapping(columns);</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tCsvToBean&lt;Test&gt; csv = new CsvToBean&lt;Test&gt;();</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tList&lt;Test&gt; list = csv.parse(strat, reader);</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tSystem.out.println(list.size());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tfor (Test test : list) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.println(test.getEquipLv());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv1());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv2());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv3());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv4());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv5());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv6());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv7());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv8());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv9());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv10());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv11());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv12());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv13());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv14());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv15());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>CSV解析与XML解析的区别仅限于此，XML使用SaxReader来进行解析，而CSV自定义解析方式（当然网上也有很多别得第三方解析工具），接下来的步骤与XML解析一模一样，CsvDataLoader.java稍有不同的地方就是解析CSV文件的部分，代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc._36.util.csv;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Field;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Modifier;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.sql.Timestamp;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.LinkedList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.DocumentException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.Element;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.io.SAXReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc._36.core.GameInit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CsvDataLoader</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Logger logger = LoggerFactory.getLogger(CsvDataLoader.class);</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String packageName;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String config; <span class=\"comment\">// 每一行就是一个配置文件名字</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> ActivityMaxValue;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CsvDataLoader</span><span class=\"params\">(String packageName, String config)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.packageName = packageName;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.config = config;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 调用load方法加载所有的配置文件</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">load</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tSAXReader reader = <span class=\"keyword\">new</span> SAXReader();</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tDocument doc = reader.read(<span class=\"keyword\">new</span> InputStreamReader(<span class=\"keyword\">this</span>.getClass()</span><br><span class=\"line\">\t\t\t\t\t.getResourceAsStream(<span class=\"keyword\">this</span>.config)));</span><br><span class=\"line\">\t\t\tList&lt;?&gt; nodes = doc.selectNodes(<span class=\"string\">&quot;/config/file&quot;</span>);</span><br><span class=\"line\">\t\t\tMap&lt;String, List&lt;?&gt;&gt; dataMap = <span class=\"keyword\">new</span> HashMap&lt;String, List&lt;?&gt;&gt;();</span><br><span class=\"line\">\t\t\tList&lt;String&gt; files = <span class=\"keyword\">new</span> LinkedList&lt;String&gt;();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (Object n : nodes) &#123;</span><br><span class=\"line\">\t\t\t\tElement t = (Element) n;</span><br><span class=\"line\">\t\t\t\tString f = t.attributeValue(<span class=\"string\">&quot;name&quot;</span>);</span><br><span class=\"line\">\t\t\t\tList&lt;?&gt; dataList = <span class=\"keyword\">this</span>.loadFile(f, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (Object o : dataList) &#123;</span><br><span class=\"line\">\t\t\t\t\tTempletService.getInstance().registerObject(o, dataMap);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tfiles.add(f);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tlogger.info(<span class=\"string\">&quot;读取配置完毕，准备afterLoad&quot;</span>);</span><br><span class=\"line\">\t\t\tTempletService.templetMap = dataMap;</span><br><span class=\"line\">\t\t\tTempletService.getInstance().afterLoad();</span><br><span class=\"line\">\t\t\tlogger.info(<span class=\"string\">&quot;afterLoad 完毕&quot;</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (DocumentException e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> List&lt;?&gt; loadFile(String file, <span class=\"keyword\">boolean</span> exitWhenFail) &#123;<span class=\"comment\">// 读文件</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tString clzName = file.replaceAll(<span class=\"string\">&quot;.csv&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">\t\t\tfile = GameInit.confFileBasePath + file;</span><br><span class=\"line\">\t\t\tlogger.info(<span class=\"string\">&quot;load file: &#123;&#125;&quot;</span>, file);</span><br><span class=\"line\">\t\t\tInputStream resourceAsStream = <span class=\"keyword\">this</span>.getClass().getResourceAsStream(</span><br><span class=\"line\">\t\t\t\t\tfile);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (resourceAsStream == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tlogger.error(<span class=\"string\">&quot;文件不存在:&quot;</span> + file);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (exitWhenFail) &#123;</span><br><span class=\"line\">\t\t\t\t\tSystem.exit(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> loadFromStream(resourceAsStream, clzName);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\tlogger.error(<span class=\"string\">&quot;载入文件出错：&quot;</span> + file);</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\tSystem.exit(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> Collections.EMPTY_LIST;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> List&lt;?&gt; loadFromStream(InputStream resourceAsStream, String clzName)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">throws</span> DocumentException, InstantiationException,</span><br><span class=\"line\">\t\t\tIllegalAccessException, IOException &#123;<span class=\"comment\">// 读csv文件</span></span><br><span class=\"line\">\t\tCsvParser csvParser = <span class=\"keyword\">new</span> CsvParser(resourceAsStream);</span><br><span class=\"line\">\t\tList&lt;String&gt; nodes = csvParser.getListWithNoHeader();</span><br><span class=\"line\">\t\t<span class=\"comment\">// get clazz</span></span><br><span class=\"line\">\t\tString className = <span class=\"keyword\">this</span>.packageName + clzName;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tClass&lt;?&gt; classObject = Class.forName(className);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (classObject == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tlogger.error(<span class=\"string\">&quot;未找到类&quot;</span> + className);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Get all the declared fields</span></span><br><span class=\"line\">\t\t\tField[] fields = classObject.getDeclaredFields();</span><br><span class=\"line\">\t\t\tLinkedList&lt;Field&gt; fieldList = <span class=\"keyword\">new</span> LinkedList&lt;Field&gt;();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> length = fields.length;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = -<span class=\"number\">1</span>; ++i &lt; length;) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">boolean</span> isStaticField = Modifier.isStatic(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (isStaticField)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">boolean</span> isTransientField = Modifier.isTransient(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (isTransientField)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\tfieldList.add(fields[i]);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Get all the declared fields of supper class</span></span><br><span class=\"line\">\t\t\tClass&lt;?&gt; tmp = classObject;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> ((tmp = tmp.getSuperclass()) != Object.class) &#123;</span><br><span class=\"line\">\t\t\t\tSystem.out.print(<span class=\"string\">&quot;the extends class is&quot;</span> + tmp.getName());</span><br><span class=\"line\">\t\t\t\tfields = tmp.getDeclaredFields();</span><br><span class=\"line\">\t\t\t\tlength = fields.length;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (length == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = -<span class=\"number\">1</span>; ++i &lt; length;) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">boolean</span> isStaticField = Modifier.isStatic(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (isStaticField)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">boolean</span> isTransientField = Modifier.isTransient(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (isTransientField)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\tfieldList.add(fields[i]);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// The truly need to return object</span></span><br><span class=\"line\">\t\t\tList&lt;Object&gt; instances = <span class=\"keyword\">new</span> ArrayList&lt;Object&gt;(nodes.size());</span><br><span class=\"line\">\t\t\tObject instance = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\tString fieldName = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\tString fieldValue = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (String node : nodes) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (node != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tinstance = classObject.newInstance();</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">boolean</span> ok = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// Element row = (Element) node;</span></span><br><span class=\"line\">\t\t\t\t\tString[] values = node.split(<span class=\"string\">&quot;,&quot;</span>);<span class=\"comment\">// csv文件以英文逗号分割值</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; fieldList.size(); i++) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tField field = fieldList.get(i);</span><br><span class=\"line\">\t\t\t\t\t\tfieldName = field.getName();</span><br><span class=\"line\">\t\t\t\t\t\tfieldValue = values[i];</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span> (fieldValue == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">this</span>.setField(instance, field, fieldValue);</span><br><span class=\"line\">\t\t\t\t\t\t\tok = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tlogger.error(<span class=\"string\">&quot;类名称是&quot;</span> + className + <span class=\"string\">&quot;的属性&quot;</span> + fieldName</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t+ <span class=\"string\">&quot;没有被成功赋予静态数据&quot;</span>);</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (ok) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tinstances.add(instance);</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> instances;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e1) &#123;</span><br><span class=\"line\">\t\t\te1.printStackTrace();</span><br><span class=\"line\">\t\t\tlogger.error(<span class=\"string\">&quot;未找到类&quot;</span> + className);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t *</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@Title</span>: setUnknowField</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@Description</span>:</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> ob</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> f</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> v</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> IllegalArgumentException</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> IllegalAccessException</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">setField</span><span class=\"params\">(Object obj, Field f, String v)</span></span></span><br><span class=\"line\"><span class=\"function\">\t\t\t<span class=\"keyword\">throws</span> IllegalArgumentException, IllegalAccessException </span>&#123;</span><br><span class=\"line\">\t\tf.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">int</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setInt(obj, Integer.parseInt(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">short</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setShort(obj, Short.parseShort(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">byte</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setByte(obj, Byte.parseByte(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">long</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setLong(obj, Long.parseLong(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">double</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setDouble(obj, Double.parseDouble(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">float</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setFloat(obj, Float.parseFloat(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == Timestamp.class) &#123;</span><br><span class=\"line\">\t\t\tf.set(obj, Timestamp.valueOf(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tf.set(obj, f.getType().cast(v));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Test Code</span></span><br><span class=\"line\"><span class=\"comment\">\t *</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> args</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">\t\tCsvDataLoader dl = <span class=\"keyword\">new</span> CsvDataLoader(<span class=\"string\">&quot;com.hjc._36.template.&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;/dataConfig.xml&quot;</span>);</span><br><span class=\"line\">\t\tdl.load();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>最后load()加载过后，依然使用TempletService来进行管理，使用方法也相同，具体代码参照上面。</p>\n<h5 id=\"以上便是我对Java读取CSV和XML资源文件的总结，有需要的同学可以直接拿去用。\"><a href=\"#以上便是我对Java读取CSV和XML资源文件的总结，有需要的同学可以直接拿去用。\" class=\"headerlink\" title=\"以上便是我对Java读取CSV和XML资源文件的总结，有需要的同学可以直接拿去用。\"></a>以上便是我对Java读取CSV和XML资源文件的总结，有需要的同学可以直接拿去用。</h5>","site":{"data":{}},"excerpt":"<p>游戏开发中，读取策划给的配置表是必不可少的，我在之前公司，策划给的是xml表来读取，现在公司策划给的是CSV表来读取，其实大同小异，也并不是什么难点，我就简单分享下Java如何读取XML文件和CSV文件。以下工具类可随意拿去使用。</p>","more":"<h3 id=\"Java读XML文件\"><a href=\"#Java读XML文件\" class=\"headerlink\" title=\"Java读XML文件\"></a>Java读XML文件</h3><p>如果是Maven项目，则依赖以下包（如果不是，则自己在项目添加配置相应jar包）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">      <span class=\"comment\">&lt;!-- dom4j begin --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>dom4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dom4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.6.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- dom4j end --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--xml转换 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.thoughtworks.xstream<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>xstream<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.4.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>读取XML文件应该是比较常见的，用dom4j就可以很简单的读出来，首先准备一个XML文件，来映射出所有的XML资源文件的名字，资源文件如下：<br>dataConfig.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">config</span>&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">file</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Test.xml&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">config</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>示例资源XML文件如下<br>Test.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dataset</span>&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">Test</span> <span class=\"attr\">attr1</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">attr2</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">attr3</span>=<span class=\"string\">&quot;&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dataset</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>Java项目中建一个类，变量名与XML中属性名相同，Java代码通过这个XML文件来找出所有的资源XML文件，然后将XML文件中的属性值全部读取到类中，再把类放进Map，加载到内存中，这样，每次需要读取配置表，就可以直接从内存中读取，快速且方便<br>以下是XmlDataLoader.java，作用是从数据表中读取属性值到内存</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc._36.util.xml;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.UnsupportedEncodingException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Field;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Modifier;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.sql.Timestamp;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.LinkedList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.DocumentException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.Element;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.io.SAXReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc._36.core.GameInit;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc._36.util.csv.TempletService;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 1 所有的template类都必须在一个包中 2 通过读取xml 遍历所有的Element，通过Element.name和 package 得到具体的</span></span><br><span class=\"line\"><span class=\"comment\"> * className; 3 通过Element的 attr 获取方法，并且根据parameterType 强制转换类型</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Administrator</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">XmlDataLoader</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String packageName;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String config; <span class=\"comment\">// 每一行就是一个配置文件名字</span></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Logger logger = LoggerFactory.getLogger(XmlDataLoader.class);</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> ActivityMaxValue;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">XmlDataLoader</span><span class=\"params\">(String packageName, String config)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.packageName = packageName;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.config = config;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 调用load方法加载所有的配置文件</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">load</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tSAXReader reader = <span class=\"keyword\">new</span> SAXReader();</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tDocument doc = reader.read(<span class=\"keyword\">new</span> InputStreamReader(<span class=\"keyword\">this</span>.getClass()</span><br><span class=\"line\">\t\t\t\t\t.getResourceAsStream(<span class=\"keyword\">this</span>.config)));</span><br><span class=\"line\">\t\t\tList&lt;?&gt; nodes = doc.selectNodes(<span class=\"string\">&quot;/config/file&quot;</span>);</span><br><span class=\"line\">\t\t\tMap&lt;String, List&lt;?&gt;&gt; dataMap = <span class=\"keyword\">new</span> HashMap&lt;String, List&lt;?&gt;&gt;();</span><br><span class=\"line\">\t\t\tList&lt;String&gt; files = <span class=\"keyword\">new</span> LinkedList&lt;String&gt;();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (Object n : nodes) &#123;</span><br><span class=\"line\">\t\t\t\tElement t = (Element) n;</span><br><span class=\"line\">\t\t\t\tString f = t.attributeValue(<span class=\"string\">&quot;name&quot;</span>);</span><br><span class=\"line\">\t\t\t\tList&lt;?&gt; dataList = <span class=\"keyword\">this</span>.loadFile(f, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (Object o : dataList) &#123;</span><br><span class=\"line\">\t\t\t\t\tTempletService.getInstance().registerObject(o, dataMap);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tfiles.add(f);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tlogger.info(<span class=\"string\">&quot;读取配置完毕，准备afterLoad&quot;</span>);</span><br><span class=\"line\">\t\t\tTempletService.templetMap = dataMap;</span><br><span class=\"line\">\t\t\tTempletService.getInstance().afterLoad();</span><br><span class=\"line\">\t\t\tlogger.info(<span class=\"string\">&quot;afterLoad 完毕&quot;</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (DocumentException e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> List&lt;?&gt; loadFile(String file, <span class=\"keyword\">boolean</span> exitWhenFail) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tfile = GameInit.confFileBasePath + file;</span><br><span class=\"line\">\t\t\tlogger.info(<span class=\"string\">&quot;load file: &#123;&#125;&quot;</span>, file);</span><br><span class=\"line\">\t\t\tInputStream resourceAsStream = <span class=\"keyword\">this</span>.getClass().getResourceAsStream(</span><br><span class=\"line\">\t\t\t\t\tfile);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (resourceAsStream == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tlogger.error(<span class=\"string\">&quot;文件不存在:&quot;</span> + file);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (exitWhenFail) &#123;</span><br><span class=\"line\">\t\t\t\t\tSystem.exit(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> loadFromStream(resourceAsStream);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\tlogger.error(<span class=\"string\">&quot;载入文件出错：&quot;</span> + file);</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\tSystem.exit(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> Collections.EMPTY_LIST;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> List&lt;?&gt; loadFromStream(InputStream resourceAsStream)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">throws</span> UnsupportedEncodingException, DocumentException,</span><br><span class=\"line\">\t\t\tInstantiationException, IllegalAccessException &#123;</span><br><span class=\"line\">\t\tSAXReader reader = <span class=\"keyword\">new</span> SAXReader();</span><br><span class=\"line\">\t\tDocument doc = reader.read(<span class=\"keyword\">new</span> InputStreamReader(resourceAsStream,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;utf-8&quot;</span>));</span><br><span class=\"line\">\t\tElement dataSet = (Element) doc.selectNodes(<span class=\"string\">&quot;/dataset&quot;</span>).get(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t\tList&lt;?&gt; nodes = dataSet.elements();</span><br><span class=\"line\">\t\t<span class=\"comment\">// get clazz</span></span><br><span class=\"line\">\t\tString className = <span class=\"keyword\">this</span>.packageName</span><br><span class=\"line\">\t\t\t\t+ ((Element) nodes.get(<span class=\"number\">0</span>)).getName();</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tClass&lt;?&gt; classObject = Class.forName(className);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (classObject == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tlogger.error(<span class=\"string\">&quot;未找到类&quot;</span> + className);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Get all the declared fields</span></span><br><span class=\"line\">\t\t\tField[] fields = classObject.getDeclaredFields();</span><br><span class=\"line\">\t\t\tLinkedList&lt;Field&gt; fieldList = <span class=\"keyword\">new</span> LinkedList&lt;Field&gt;();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> length = fields.length;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = -<span class=\"number\">1</span>; ++i &lt; length;) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">boolean</span> isStaticField = Modifier.isStatic(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (isStaticField)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">boolean</span> isTransientField = Modifier.isTransient(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (isTransientField)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\tfieldList.add(fields[i]);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Get all the declared fields of supper class</span></span><br><span class=\"line\">\t\t\tClass&lt;?&gt; tmp = classObject;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> ((tmp = tmp.getSuperclass()) != Object.class) &#123;</span><br><span class=\"line\">\t\t\t\tSystem.out.print(<span class=\"string\">&quot;the extends class is&quot;</span> + tmp.getName());</span><br><span class=\"line\">\t\t\t\tfields = tmp.getDeclaredFields();</span><br><span class=\"line\">\t\t\t\tlength = fields.length;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (length == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = -<span class=\"number\">1</span>; ++i &lt; length;) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">boolean</span> isStaticField = Modifier.isStatic(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (isStaticField)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">boolean</span> isTransientField = Modifier.isTransient(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (isTransientField)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\tfieldList.add(fields[i]);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// The truly need to return object</span></span><br><span class=\"line\">\t\t\tList&lt;Object&gt; instances = <span class=\"keyword\">new</span> ArrayList&lt;Object&gt;(nodes.size());</span><br><span class=\"line\">\t\t\tObject instance = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\tString fieldName = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\tString fieldValue = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (Object node : nodes) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (node != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tinstance = classObject.newInstance();</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">boolean</span> ok = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t\t\t\tElement row = (Element) node;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span> (Field field : fieldList) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tfieldName = field.getName();</span><br><span class=\"line\">\t\t\t\t\t\tfieldValue = row.attributeValue(fieldName);</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span> (fieldValue == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">this</span>.setField(instance, field, fieldValue);</span><br><span class=\"line\">\t\t\t\t\t\t\tok = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tlogger.error(<span class=\"string\">&quot;类名称是&quot;</span> + className + <span class=\"string\">&quot;的属性&quot;</span> + fieldName</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t+ <span class=\"string\">&quot;没有被成功赋予静态数据&quot;</span>);</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (ok)</span><br><span class=\"line\">\t\t\t\t\t\tinstances.add(instance);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> instances;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e1) &#123;</span><br><span class=\"line\">\t\t\te1.printStackTrace();</span><br><span class=\"line\">\t\t\tlogger.error(<span class=\"string\">&quot;未找到类&quot;</span> + className);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">reload</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t *</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@Title</span>: setUnknowField</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@Description</span>:</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> ob</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> f</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> v</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> IllegalArgumentException</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> IllegalAccessException</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">setField</span><span class=\"params\">(Object obj, Field f, String v)</span></span></span><br><span class=\"line\"><span class=\"function\">\t\t\t<span class=\"keyword\">throws</span> IllegalArgumentException, IllegalAccessException </span>&#123;</span><br><span class=\"line\">\t\tf.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">int</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setInt(obj, Integer.parseInt(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">short</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setShort(obj, Short.parseShort(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">byte</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setByte(obj, Byte.parseByte(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">long</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setLong(obj, Long.parseLong(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">double</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setDouble(obj, Double.parseDouble(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">float</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setFloat(obj, Float.parseFloat(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == Timestamp.class) &#123;</span><br><span class=\"line\">\t\t\tf.set(obj, Timestamp.valueOf(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tf.set(obj, f.getType().cast(v));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Test Code</span></span><br><span class=\"line\"><span class=\"comment\">\t *</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> args</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">\t\tXmlDataLoader dl = <span class=\"keyword\">new</span> XmlDataLoader(<span class=\"string\">&quot;com.hjc._36.template.&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;/dataConfig.xml&quot;</span>);</span><br><span class=\"line\">\t\tdl.load();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如上的测试方法中看出，调用方式很简单，只需加载到映射XML文件，即可读取所有的配置XML文件，调用load()方法后，配置表就全部加载到了内存，我们通过以下类——TempletService.java来对这些配置数据进行管理：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc._36.util.csv;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 添加一个数据表需要做以下几步</span></span><br><span class=\"line\"><span class=\"comment\"> * 1.在包com.hjc._36.template下创建对应的模板类，类名与数据文件一致</span></span><br><span class=\"line\"><span class=\"comment\"> * 2.在src/main/resources/xml/中添加模板数据文件</span></span><br><span class=\"line\"><span class=\"comment\"> * 3.在src/main/resources/dataConfig.xml加入刚才的模板数据文件</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> 何金成</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TempletService</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Logger log = LoggerFactory.getLogger(TempletService.class);</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> TempletService templetService = <span class=\"keyword\">new</span> TempletService();</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * key:实体名 value:该实体下的所有模板数据</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Map&lt;String, List&lt;?&gt;&gt; templetMap = <span class=\"keyword\">new</span> HashMap&lt;String, List&lt;?&gt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TempletService</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> TempletService <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> templetService;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 获取该实体类下所有模板数据</span></span><br><span class=\"line\"><span class=\"comment\">\t *</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> beanName</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> List <span class=\"title\">listAll</span><span class=\"params\">(String beanName)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> templetMap.get(beanName);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@Title</span>: registerObject</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@Description</span>: 注册对象到对应类的List中</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> o</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> dataMap</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span></span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerObject</span><span class=\"params\">(Object o, Map&lt;String, List&lt;?&gt;&gt; dataMap)</span> </span>&#123;</span><br><span class=\"line\">\t\tadd(o.getClass().getSimpleName(), o, dataMap);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(String key, Object data, Map&lt;String, List&lt;?&gt;&gt; dataMap)</span> </span>&#123;</span><br><span class=\"line\">\t\tList list = dataMap.get(key);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (list == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tlist = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">\t\t\tdataMap.put(key, list);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tlist.add(data);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterLoad</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 加载后处理</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// List tests = TempletService.listAll(Test.class.getSimpleName());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// for (Object object : tests) &#123;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// Test test = (Test)object;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(test.getEquipLv());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv1());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv2());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv3());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv4());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv5());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv6());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv7());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv8());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.print(&quot;,&quot;+test.getLv9());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// System.out.println(&quot;,&quot;+test.getLv10());</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// &#125;</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">loadCanShu</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 加载全局参数xml配置</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在load()中，变用到了上述类的registerObject方法来添加数据，在使用时，只需要调用listAll方法即可，在上面代码中的测试代码已经写明了用法。</p>\n<h3 id=\"Java读取CSV文件\"><a href=\"#Java读取CSV文件\" class=\"headerlink\" title=\"Java读取CSV文件\"></a>Java读取CSV文件</h3><p>Java读CSV文件与读XML文件如出一辙，大致思路同上<br>dataConfig.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">config</span>&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">file</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Test.csv&quot;</span> /&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">file</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;JunjichuUpgrade.csv&quot;</span> /&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">file</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Card.csv&quot;</span> /&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">file</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Equip.csv&quot;</span> /&gt;</span></span><br><span class=\"line\"> \t<span class=\"tag\">&lt;<span class=\"name\">file</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Prop.csv&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">config</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>Test.csv如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﻿等级,1星,2星,3星,4星,5星,6星,7星,8星,9星,10星,11星,12星,13星,14星,15星,16星,17星,18星,19星,20星,21星,22星,23星,24星,25星</span><br><span class=\"line\">EquipLv,Lv1,Lv2,Lv3,Lv4,Lv5,Lv6,Lv7,Lv8,Lv9,Lv10,Lv11,Lv12,Lv13,Lv14,Lv15,Lv16,Lv17,Lv18,Lv19,Lv20,Lv21,Lv22,Lv23,Lv24,Lv25</span><br><span class=\"line\">10,2,4,8,12,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">20,6,12,24,36,48,60,72,84,96,108,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">30,12,24,48,72,96,120,144,168,192,216,240,264,288,312,336,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">40,20,40,80,120,160,200,240,280,320,360,400,440,480,520,560,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">50,30,60,120,180,240,300,360,420,480,540,600,660,720,780,840,900,960,1020,1080,1140,0,0,0,0,0</span><br><span class=\"line\">60,42,84,168,252,336,420,504,588,672,756,840,924,1008,1092,1176,1260,1344,1428,1512,1596,0,0,0,0,0</span><br><span class=\"line\">70,56,112,224,336,448,560,672,784,896,1008,1120,1232,1344,1456,1568,1680,1792,1904,2016,2128,0,0,0,0,0</span><br><span class=\"line\">80,72,144,288,432,576,720,864,1008,1152,1296,1440,1584,1728,1872,2016,2160,2304,2448,2592,2736,2880,3024,3168,3312,3456</span><br><span class=\"line\">90,90,180,360,540,720,900,1080,1260,1440,1620,1800,1980,2160,2340,2520,2700,2880,3060,3240,3420,3600,3780,3960,4140,4320</span><br><span class=\"line\">100,110,220,440,660,880,1100,1320,1540,1760,1980,2200,2420,2640,2860,3080,3300,3520,3740,3960,4180,4400,4620,4840,5060,5280</span><br></pre></td></tr></table></figure>\n<p>如上CSV表大家也能看出来，CSV文件中的数据是以一定规律呈现的，解析CSV便是根据CSV文件的这些特性来进行解析的，解析工具类CsvParser.java代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc._36.util.csv;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedWriter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileInputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileOutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.OutputStreamWriter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.text.SimpleDateFormat;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Iterator;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//JAVA 操作 excel 中的 .csv文件格式</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CsvParser</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> BufferedReader bufferedreader = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> List list = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CsvParser</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CsvParser</span><span class=\"params\">(InputStream inStream)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\tInputStreamReader isr = <span class=\"keyword\">new</span> InputStreamReader(inStream, <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">\t\tbufferedreader = <span class=\"keyword\">new</span> BufferedReader(isr);</span><br><span class=\"line\">\t\tString stemp;</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> ((stemp = bufferedreader.readLine()) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tlist.add(stemp);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getList</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> list;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getListWithNoHeader</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> list.subList(<span class=\"number\">2</span>, list.size());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 得到csv文件的行数</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getRowNum</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> list.size();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 得到csv文件的列数</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getColNum</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!list.toString().equals(<span class=\"string\">&quot;[]&quot;</span>)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (list.get(<span class=\"number\">0</span>).toString().contains(<span class=\"string\">&quot;,&quot;</span>)) &#123; <span class=\"comment\">// csv文件中，每列之间的是用&#x27;,&#x27;来分隔的</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> list.get(<span class=\"number\">0</span>).toString().split(<span class=\"string\">&quot;,&quot;</span>).length;</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (list.get(<span class=\"number\">0</span>).toString().trim().length() != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 取得指定行的值</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getRow</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.list.size() != <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> (String) list.get(index);</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 取得指定列的值</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getCol</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.getColNum() == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tStringBuffer scol = <span class=\"keyword\">new</span> StringBuffer();</span><br><span class=\"line\">\t\tString temp = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> colnum = <span class=\"keyword\">this</span>.getColNum();</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (colnum &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (Iterator it = list.iterator(); it.hasNext();) &#123;</span><br><span class=\"line\">\t\t\t\ttemp = it.next().toString();</span><br><span class=\"line\">\t\t\t\tscol = scol.append(temp.split(<span class=\"string\">&quot;,&quot;</span>)[index] + <span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (Iterator it = list.iterator(); it.hasNext();) &#123;</span><br><span class=\"line\">\t\t\t\ttemp = it.next().toString();</span><br><span class=\"line\">\t\t\t\tscol = scol.append(temp + <span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tString str = <span class=\"keyword\">new</span> String(scol.toString());</span><br><span class=\"line\">\t\tstr = str.substring(<span class=\"number\">0</span>, str.length() - <span class=\"number\">1</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> str;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 取得指定行，指定列的值</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getString</span><span class=\"params\">(<span class=\"keyword\">int</span> row, <span class=\"keyword\">int</span> col)</span> </span>&#123;</span><br><span class=\"line\">\t\tString temp = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> colnum = <span class=\"keyword\">this</span>.getColNum();</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (colnum &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t\ttemp = list.get(row).toString().split(<span class=\"string\">&quot;,&quot;</span>)[col];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (colnum == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t\ttemp = list.get(row).toString();</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\ttemp = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> temp;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">CsvClose</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.bufferedreader.close();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">readCvs</span><span class=\"params\">(String filename)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\tCsvParser cu = <span class=\"keyword\">new</span> CsvParser(<span class=\"keyword\">new</span> FileInputStream(<span class=\"keyword\">new</span> File(filename)));</span><br><span class=\"line\">\t\tList list = cu.getList();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> list;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createCsv</span><span class=\"params\">(String biao, List list, String path)</span></span></span><br><span class=\"line\"><span class=\"function\">\t\t\t<span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\tList tt = list;</span><br><span class=\"line\">\t\tString data = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">\t\tSimpleDateFormat dataFormat = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyyMMdd&quot;</span>);</span><br><span class=\"line\">\t\tDate today = <span class=\"keyword\">new</span> Date();</span><br><span class=\"line\">\t\tString dateToday = dataFormat.format(today);</span><br><span class=\"line\">\t\tFile file = <span class=\"keyword\">new</span> File(path + <span class=\"string\">&quot;resource/expert/&quot;</span> + dateToday</span><br><span class=\"line\">\t\t\t\t+ <span class=\"string\">&quot;importerrorinfo.csv&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!file.exists())</span><br><span class=\"line\">\t\t\tfile.createNewFile();</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\tfile.delete();</span><br><span class=\"line\">\t\tString str[];</span><br><span class=\"line\">\t\tStringBuilder sb = <span class=\"keyword\">new</span> StringBuilder(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">\t\tsb.append(biao);</span><br><span class=\"line\">\t\tFileOutputStream writerStream = <span class=\"keyword\">new</span> FileOutputStream(file, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\tBufferedWriter output = <span class=\"keyword\">new</span> BufferedWriter(<span class=\"keyword\">new</span> OutputStreamWriter(</span><br><span class=\"line\">\t\t\t\twriterStream, <span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (Iterator itt = tt.iterator(); itt.hasNext();) &#123;</span><br><span class=\"line\">\t\t\tString fileStr = itt.next().toString();</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// str = fileStr.split(&quot;,&quot;);</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// for (int i = 0; i &lt;= str.length - 1; i++) &#123; // 拆分成数组 用于插入数据库中</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// System.out.print(&quot;str[&quot; + i + &quot;]=&quot; + str[i] + &quot; &quot;);</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// &#125;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// System.out.println(&quot;&quot;);</span></span><br><span class=\"line\">\t\t\tsb.append(fileStr + <span class=\"string\">&quot;\\r\\n&quot;</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\toutput.write(sb.toString());</span><br><span class=\"line\">\t\toutput.flush();</span><br><span class=\"line\">\t\toutput.close();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\tCsvParser test = <span class=\"keyword\">new</span> CsvParser();</span><br><span class=\"line\">\t\tList aaa = test.readCvs(<span class=\"string\">&quot;D:/abc.csv&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; aaa.size(); i++) &#123;</span><br><span class=\"line\">\t\t\tSystem.out.println(i + <span class=\"string\">&quot;---&quot;</span> + aaa.get(i));</span><br><span class=\"line\">\t\t\tString a = (String) aaa.get(i).toString().split(<span class=\"string\">&quot;,&quot;</span>)[<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tSystem.out.println(aaa.size());</span><br><span class=\"line\">\t\t<span class=\"comment\">//String biao = &quot;用户名,姓名,排序,专家类型,业务专长,错误信息\\n&quot;;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//test.createCsv(biao, aaa, &quot;D:/&quot;);</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// test.run(&quot;D:/abc.csv&quot;);</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// HttpServletResponse response = null;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// test.createCsv(response);</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tCSVReader reader = new CSVReader(new FileReader(&quot;D:/abc.csv&quot;));</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tColumnPositionMappingStrategy&lt;Test&gt; strat = new ColumnPositionMappingStrategy&lt;Test&gt;();</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tstrat.setType(Test.class);</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tString[] columns = new String[] &#123;&quot;EquipLv&quot;,&quot;Lv1&quot;,&quot;Lv2&quot;,&quot;Lv3&quot;,&quot;Lv4&quot;,&quot;Lv5&quot;,&quot;Lv6&quot;,&quot;Lv7&quot;,&quot;Lv8&quot;,&quot;Lv9&quot;,&quot;Lv10&quot;,&quot;Lv11&quot;,&quot;Lv12&quot;,&quot;Lv13&quot;,&quot;Lv14&quot;,&quot;Lv15&quot;&#125;; // the fields to bind do in your JavaBean</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tstrat.setColumnMapping(columns);</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tCsvToBean&lt;Test&gt; csv = new CsvToBean&lt;Test&gt;();</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tList&lt;Test&gt; list = csv.parse(strat, reader);</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tSystem.out.println(list.size());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\tfor (Test test : list) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.println(test.getEquipLv());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv1());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv2());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv3());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv4());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv5());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv6());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv7());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv8());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv9());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv10());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv11());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv12());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv13());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv14());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\tSystem.out.print(test.getLv15());</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>CSV解析与XML解析的区别仅限于此，XML使用SaxReader来进行解析，而CSV自定义解析方式（当然网上也有很多别得第三方解析工具），接下来的步骤与XML解析一模一样，CsvDataLoader.java稍有不同的地方就是解析CSV文件的部分，代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hjc._36.util.csv;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Field;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Modifier;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.sql.Timestamp;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.LinkedList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.DocumentException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.Element;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.io.SAXReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hjc._36.core.GameInit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CsvDataLoader</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Logger logger = LoggerFactory.getLogger(CsvDataLoader.class);</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String packageName;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String config; <span class=\"comment\">// 每一行就是一个配置文件名字</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> ActivityMaxValue;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CsvDataLoader</span><span class=\"params\">(String packageName, String config)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.packageName = packageName;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.config = config;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 调用load方法加载所有的配置文件</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">load</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tSAXReader reader = <span class=\"keyword\">new</span> SAXReader();</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tDocument doc = reader.read(<span class=\"keyword\">new</span> InputStreamReader(<span class=\"keyword\">this</span>.getClass()</span><br><span class=\"line\">\t\t\t\t\t.getResourceAsStream(<span class=\"keyword\">this</span>.config)));</span><br><span class=\"line\">\t\t\tList&lt;?&gt; nodes = doc.selectNodes(<span class=\"string\">&quot;/config/file&quot;</span>);</span><br><span class=\"line\">\t\t\tMap&lt;String, List&lt;?&gt;&gt; dataMap = <span class=\"keyword\">new</span> HashMap&lt;String, List&lt;?&gt;&gt;();</span><br><span class=\"line\">\t\t\tList&lt;String&gt; files = <span class=\"keyword\">new</span> LinkedList&lt;String&gt;();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (Object n : nodes) &#123;</span><br><span class=\"line\">\t\t\t\tElement t = (Element) n;</span><br><span class=\"line\">\t\t\t\tString f = t.attributeValue(<span class=\"string\">&quot;name&quot;</span>);</span><br><span class=\"line\">\t\t\t\tList&lt;?&gt; dataList = <span class=\"keyword\">this</span>.loadFile(f, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (Object o : dataList) &#123;</span><br><span class=\"line\">\t\t\t\t\tTempletService.getInstance().registerObject(o, dataMap);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tfiles.add(f);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tlogger.info(<span class=\"string\">&quot;读取配置完毕，准备afterLoad&quot;</span>);</span><br><span class=\"line\">\t\t\tTempletService.templetMap = dataMap;</span><br><span class=\"line\">\t\t\tTempletService.getInstance().afterLoad();</span><br><span class=\"line\">\t\t\tlogger.info(<span class=\"string\">&quot;afterLoad 完毕&quot;</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (DocumentException e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> List&lt;?&gt; loadFile(String file, <span class=\"keyword\">boolean</span> exitWhenFail) &#123;<span class=\"comment\">// 读文件</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tString clzName = file.replaceAll(<span class=\"string\">&quot;.csv&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">\t\t\tfile = GameInit.confFileBasePath + file;</span><br><span class=\"line\">\t\t\tlogger.info(<span class=\"string\">&quot;load file: &#123;&#125;&quot;</span>, file);</span><br><span class=\"line\">\t\t\tInputStream resourceAsStream = <span class=\"keyword\">this</span>.getClass().getResourceAsStream(</span><br><span class=\"line\">\t\t\t\t\tfile);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (resourceAsStream == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tlogger.error(<span class=\"string\">&quot;文件不存在:&quot;</span> + file);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (exitWhenFail) &#123;</span><br><span class=\"line\">\t\t\t\t\tSystem.exit(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> loadFromStream(resourceAsStream, clzName);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\tlogger.error(<span class=\"string\">&quot;载入文件出错：&quot;</span> + file);</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\tSystem.exit(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> Collections.EMPTY_LIST;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> List&lt;?&gt; loadFromStream(InputStream resourceAsStream, String clzName)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">throws</span> DocumentException, InstantiationException,</span><br><span class=\"line\">\t\t\tIllegalAccessException, IOException &#123;<span class=\"comment\">// 读csv文件</span></span><br><span class=\"line\">\t\tCsvParser csvParser = <span class=\"keyword\">new</span> CsvParser(resourceAsStream);</span><br><span class=\"line\">\t\tList&lt;String&gt; nodes = csvParser.getListWithNoHeader();</span><br><span class=\"line\">\t\t<span class=\"comment\">// get clazz</span></span><br><span class=\"line\">\t\tString className = <span class=\"keyword\">this</span>.packageName + clzName;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tClass&lt;?&gt; classObject = Class.forName(className);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (classObject == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tlogger.error(<span class=\"string\">&quot;未找到类&quot;</span> + className);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Get all the declared fields</span></span><br><span class=\"line\">\t\t\tField[] fields = classObject.getDeclaredFields();</span><br><span class=\"line\">\t\t\tLinkedList&lt;Field&gt; fieldList = <span class=\"keyword\">new</span> LinkedList&lt;Field&gt;();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> length = fields.length;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = -<span class=\"number\">1</span>; ++i &lt; length;) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">boolean</span> isStaticField = Modifier.isStatic(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (isStaticField)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">boolean</span> isTransientField = Modifier.isTransient(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (isTransientField)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\tfieldList.add(fields[i]);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Get all the declared fields of supper class</span></span><br><span class=\"line\">\t\t\tClass&lt;?&gt; tmp = classObject;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> ((tmp = tmp.getSuperclass()) != Object.class) &#123;</span><br><span class=\"line\">\t\t\t\tSystem.out.print(<span class=\"string\">&quot;the extends class is&quot;</span> + tmp.getName());</span><br><span class=\"line\">\t\t\t\tfields = tmp.getDeclaredFields();</span><br><span class=\"line\">\t\t\t\tlength = fields.length;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (length == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = -<span class=\"number\">1</span>; ++i &lt; length;) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">boolean</span> isStaticField = Modifier.isStatic(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (isStaticField)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">boolean</span> isTransientField = Modifier.isTransient(fields[i]</span><br><span class=\"line\">\t\t\t\t\t\t\t.getModifiers());</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (isTransientField)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\tfieldList.add(fields[i]);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// The truly need to return object</span></span><br><span class=\"line\">\t\t\tList&lt;Object&gt; instances = <span class=\"keyword\">new</span> ArrayList&lt;Object&gt;(nodes.size());</span><br><span class=\"line\">\t\t\tObject instance = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\tString fieldName = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\tString fieldValue = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (String node : nodes) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (node != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tinstance = classObject.newInstance();</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">boolean</span> ok = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// Element row = (Element) node;</span></span><br><span class=\"line\">\t\t\t\t\tString[] values = node.split(<span class=\"string\">&quot;,&quot;</span>);<span class=\"comment\">// csv文件以英文逗号分割值</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; fieldList.size(); i++) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tField field = fieldList.get(i);</span><br><span class=\"line\">\t\t\t\t\t\tfieldName = field.getName();</span><br><span class=\"line\">\t\t\t\t\t\tfieldValue = values[i];</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span> (fieldValue == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">this</span>.setField(instance, field, fieldValue);</span><br><span class=\"line\">\t\t\t\t\t\t\tok = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tlogger.error(<span class=\"string\">&quot;类名称是&quot;</span> + className + <span class=\"string\">&quot;的属性&quot;</span> + fieldName</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t+ <span class=\"string\">&quot;没有被成功赋予静态数据&quot;</span>);</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (ok) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tinstances.add(instance);</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> instances;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e1) &#123;</span><br><span class=\"line\">\t\t\te1.printStackTrace();</span><br><span class=\"line\">\t\t\tlogger.error(<span class=\"string\">&quot;未找到类&quot;</span> + className);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t *</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@Title</span>: setUnknowField</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@Description</span>:</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> ob</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> f</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> v</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> IllegalArgumentException</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> IllegalAccessException</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">setField</span><span class=\"params\">(Object obj, Field f, String v)</span></span></span><br><span class=\"line\"><span class=\"function\">\t\t\t<span class=\"keyword\">throws</span> IllegalArgumentException, IllegalAccessException </span>&#123;</span><br><span class=\"line\">\t\tf.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">int</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setInt(obj, Integer.parseInt(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">short</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setShort(obj, Short.parseShort(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">byte</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setByte(obj, Byte.parseByte(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">long</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setLong(obj, Long.parseLong(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">double</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setDouble(obj, Double.parseDouble(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == <span class=\"keyword\">float</span>.class) &#123;</span><br><span class=\"line\">\t\t\tf.setFloat(obj, Float.parseFloat(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f.getType() == Timestamp.class) &#123;</span><br><span class=\"line\">\t\t\tf.set(obj, Timestamp.valueOf(v));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tf.set(obj, f.getType().cast(v));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Test Code</span></span><br><span class=\"line\"><span class=\"comment\">\t *</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> args</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">\t\tCsvDataLoader dl = <span class=\"keyword\">new</span> CsvDataLoader(<span class=\"string\">&quot;com.hjc._36.template.&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;/dataConfig.xml&quot;</span>);</span><br><span class=\"line\">\t\tdl.load();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>最后load()加载过后，依然使用TempletService来进行管理，使用方法也相同，具体代码参照上面。</p>\n<h5 id=\"以上便是我对Java读取CSV和XML资源文件的总结，有需要的同学可以直接拿去用。\"><a href=\"#以上便是我对Java读取CSV和XML资源文件的总结，有需要的同学可以直接拿去用。\" class=\"headerlink\" title=\"以上便是我对Java读取CSV和XML资源文件的总结，有需要的同学可以直接拿去用。\"></a>以上便是我对Java读取CSV和XML资源文件的总结，有需要的同学可以直接拿去用。</h5>"},{"title":"我的2019","date":"2019-12-24T17:10:00.000Z","_content":"看看这个标题，没错，这又是一篇年终总结，上一次写年终总结还是2017年，而2018年直接就跳过没有写。之前的业余时间的确是很多，现在我连休息时间也变少了，所以一年都很难产出一篇，前段时间闲了一点，才很艰难的挤出了一篇关于我对Python这门语言的理解。其实没有用文字记录下来，并不代表我这两年什么都没有做，相反，我经历了太多的事情，才让我连用文字记录的时间都没有了。那么接下来，我会用一整篇的篇幅来告诉大家，这两年，我都做了什么，学会了什么，完成了什么。\n<!--more-->\n`——一名游戏行业程序员的生活记录`\n\n## 一、关于写书\n大概是从入职上家公司开始，我开始学着写作，因为工作中需要我去学习很多新的东西，而学会一个东西最好的方式就是把你学会的从头到尾都详细解释出来，所以我开始了写博客，我写的东西其实并不高深，都是基础知识的运用，甚至在文章中加过很多修辞，故弄玄虚，夸大其词，而实际上却是知识很基础的一部分内容，而这些恰恰是因为我最初开始写文章的时候，自己的基础并不扎实，而又想急于求成所造成的结果。\n\n2016年，我花了几乎一年的时间写了一本书《深度解析Java游戏服务器开发》，我的确是倾注了个人的大部分时间和精力，但是老实说，这本书的内容特别的华而不实，这也是我后来对我那本书的一个自我反省，甚至说我想在两年后的今天，去重写里面的内容。那本书一经推出后，我也看了网上的评论，收获了不少差评，里面确实有我的个人原因，本身基础不太扎实的我，以一种急于求成的姿态去写了这样一本书，用网友的评论来说，这本书的确是堆砌代码且无营养。\n\n后来第二年，也就是2017年，我又开始写第二本书《Cocos2d-JS游戏开发快速入门到实战》，总结第一本书的经验教训，在写第二本书的时候，我特别注重书里内容的图、文、代码相结合，内容可以不多，但一定要准确，精简，让读者能看懂。同样是一年的时间，我完成了我的第二本书，这本书从销量上来说，可能还不如第一本书，因为JS技术的普遍性以及用Cocos2d-JS来做游戏的普遍性相对Java的使用普遍性来说要少很多，不过对我个人来说，第二本书是我结合了上一本书的经验教训写出来内容更加优质的书，写书的收入并不多，也就小一万块钱，但对于我个人的意义真的是不一样的，单从写书这件事情来说，就是对我个人意志力的一个巨大的挑战，你要牺牲近半年的休息时间用来写书，写案例，写示例代码，保证所有的代码都是可运行的。好在最后结果还不错，虽然销量可能并不高，但我看到网上的评论里大部分是好评，甚至有大学生或者刚毕业的开始工作的人私信我，问我一些职业发展上的问题，那个时候我就在想，我可能并不能给你们什么有用的建议，但我的书只要可以让一个人开始对游戏开发感兴趣，那我就是成功了。\n\n### `果然，坚持与认真，是做成一件事情最重要的品质。`\n\n## 二、关于工作\n从写完第二本书之后，我几乎停止了写作，因为在2017年初入职了我现在这家公司后，我的业余时间大大减少，那个时间点，游戏行业面临寒冬，版号开始限制，审查开始严格，大批量的不合格游戏需要整顿，当然，从宏观上来看，这是对游戏行业的规范的合理化，但最后落在我们每一个游戏行业的螺丝钉——程序员来说，可能就是加班以及赶工。从长远来看，加班并不影响我们做一件事情的热情，如果我正在做的是一件成功率很高的产品来说，加班赶工把它做好的意义，要远大于优哉游哉混日子的意义。对于我所在的项目组来说，我们所做的产品，在我看来也确实是有希望做成的，所以我选择了留在这里，并且到现在为止，已经做了快三年了，在前几天第一次内测的情况来看，我们的游戏确实是有希望成为游戏界的一款爆款游戏，测试数据要远好于同行产品，也获得了玩家和媒体的一致好评。\n\n在游戏测试的当天，我们就看到B站已经有主播在开始直播了，跟着有不少玩家发弹幕和评论，从网上的评论来看，这款游戏的惊艳程度，远远超过了玩家的预期，虽然也有很多不足的地方，但从大部分玩家来看，都是对我们的游戏充满了期待，希望能快点优化并上线，不管怎么样，看到网上铺天盖地的好评，以及最后的测试数据来看，我们最近一两个月的连续加班都是有意义的，而测试的三天时间，我也亲自玩了我们游戏，从玩家的角度来说，我也是对这款游戏充满了期待。\n\n`测试结束后的玩家一个宣传视频`\nhttps://www.bilibili.com/video/av79947489](https://www.bilibili.com/video/\n\n从整个项目来说，它在朝一款创新的类主机体验的ACT游戏发展，并且是一款有很大几率能做成的产品。从我个人成长来说，我也非常有幸从项目初期就加入到这款游戏的开发，我的个人能力也快速的成长了起来，并且我的老大对我的成长很有帮助，大到为人处世，小到编码规范，都对我有很重要的影响，有人说，工作就是要跟对好的项目，和跟对好的领导，现在这两样我都有了。在这个项目组的这几年，是对我的职业发展最快的几年。得益于老大的照顾，我能了解到项目整体的技术结构，我经历过项目战斗的状态同步到帧同步的转变，参与过核心战斗的开发，写过部分功能的可扩展的底层框架代码，对接过项目上线部署更新流程，也自己写过一些提高工作效率的工具。总的来说，参与这个项目，让我从头到尾都了解了一遍一款游戏的制作需要经历些什么，也让我的个人技术以及职业生涯成长了很多。虽然是游戏行业的新生代码农，但我也感觉我并没有走多少弯路，一直在正确的方向上，一直向前走。\n\n### `在正确的方向上，摸索和成长。`\n\n## 三、关于生活\n\n- #####婚姻\n2019年，我27岁了，不算大也不算小的年纪，这一年，我完成了人生的婚姻大事，实现了第一次的出国自由行，喜欢上了拍照和拍视频，也开始对人生产生思考，开始对生命和宇宙产生好奇。\n\n年初的时候，我完成了自己的人生大事，从那天之后，我可能就真的长成大人了，我需要对自己负责，也需要对新成立的小家负责。在婚后的一年时间里，其实我也没有太多不一样的感觉，我们还是很正常的生活，正常的工作，早上一起起床，一起洗漱，一起上班，晚上先后回家。有时候我加班很晚，她也会等到我回家，周末偶尔看看电影，做做饭，或者去稍远一点的郊区自驾游，拍拍照，这种感觉就像是，没有什么特别，没有什么不一样，但却有着陪伴的温暖，不可或缺。有个人和我一起在异地他乡赚钱生活，是一件很辛苦，却很幸福的事情。\n\n### `生活，平平淡淡才是真。`\n\n![结婚](http://upload-images.jianshu.io/upload_images/1472037-d8986d58e1e1856f.jpg)\n\n![结婚](http://upload-images.jianshu.io/upload_images/1472037-2ea959c46cf7703d.jpg)\n\n![结婚](http://upload-images.jianshu.io/upload_images/1472037-adefcafc8ebf00cf.jpg)\n\n![结婚](http://upload-images.jianshu.io/upload_images/1472037-7104098758fc2ec6.jpg)\n\n![结婚](http://upload-images.jianshu.io/upload_images/1472037-4c7ec957ea7dca7d.jpg)\n\n- #####旅行\n结婚之后，接着我又做了第二件人生的第一次尝试——出国旅游。请了长达12天的婚假（10天婚假连 一个周末），去了泰国的普吉和清迈，全程的签证、酒店、机票、景点路线以及各种注意事项，都是我和罗同学两个人研究的，并且全程下来，整个旅行的感受特别好，完全不同于各种购物旅游团，完全就是12天的度假休闲。休假的前的一个月，我们就开始研究这次旅行的所有攻略，并且制定了excel表格，规划好了所有的航班和酒店，并且计算了预计价格。\n![行程安排](https://upload-images.jianshu.io/upload_images/1472037-aba39822f01b225b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n上网搜索我需要准备那些APP\n![APP](https://upload-images.jianshu.io/upload_images/1472037-eede58fc739732a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n准备那些物品\n![物品准备](https://upload-images.jianshu.io/upload_images/1472037-a81f4f70c1fb0146.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n甚至根据B站上那些旅游UP主的旅游视频规划了我出门旅拍都需要拍摄什么内容\n![VLOG设计](https://upload-images.jianshu.io/upload_images/1472037-985258b320fe60b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n最后在一款叫出发吧的APP上详细罗列了我们的行程，并且整个自由行过程都按照行程一步一步的走。\nhttp://chufaba.me/journals/1055821\n\n整个旅程下来，12天时间，加上购物等所有的花销，我们一共是花费了两万六左右，人均一万三左右，在我看来，是一次性价比很高的旅行。与跟团旅行不同，我们的旅游路线完全是自己制定，甚至可以任性修改，而且我们每天都是八点多才起床，九点多才出门，如果突然发现今天计划的景点突然不感兴趣了，想去另外一个景点，也是可以突然更改的，只要整体进度在计划之内，就不会对整体行程有什么比较大的影响。\n\n在这次做了充足准备的泰国自由行中，我们也是度过了非常愉快的假期，拍了很多好看的照片和视频，包括泰国整个给我的印象也是一个非常开放的国度，大部分人的英语都特别好，很好交流，甚至在中国人密集的地方，小贩都能和你用中文聊天。这次去的两个地方分别有着不一样的风格，普吉岛的感觉是热情奔放，有热情的当地导游，有热闹的夜市小吃，有美丽的海岛风情，而清迈的感觉是悠然自得，阳光正好，心情舒适，能彻底放松身心。按照出行的规划的拍摄，我拍了很多视频片段，回来了精心挑选了一些片段以及音效音乐，剪成了一段小短片，也算是给我人生的第一次完全自己主导的出国自由行留下了一段美好的回忆。\n\n泰国蜜月旅行\n[https://www.bilibili.com/video/av47155696](https://www.bilibili.com/video/av47155696)\n\n### `如果有时间，一定要出去旅行，看看外面的世界有多精彩`\n\n- #####摄影\n说到拍照和拍视频，这也是我最近两年才突然学会的一项技能。大概是2015年的时候，罗同学不知道怎么回事，非要买一台相机，想学习拍照，后来不知道怎么的，相机就吃灰了，被搁置了，而近两年，我又不知道怎么回事，突然想要学习怎么拍照拍视频，尤其是今年，我经常会上B站去看看别人拍的照片和视频，学习前期拍摄技巧以及后期剪辑技术。就这样，一台四年前购买的Sony A7一代相机的使用率突然就高了起来，加上去年买了车，只要放假，就想要出去拍点好看的照片或者好看的视频，回家后期修图或者剪辑视频，而罗同学作为我的模特，也越来越喜欢让我给她拍照。慢慢的，摄影，也成了我除了打游戏以外的另一个爱好。\n\n不敢和各路大神相提并论，我喜欢摄影单纯只是想拍出美的照片，或者是剪辑一段好看的视频，每一次修照片或者剪视频，我都会觉得我之前拍的都是什么东西啊之类的想法，然后经常去看一些摄影UP主的视频去学习一些前期拍摄的技巧以及后期剪辑的技能。在我看来，时间不会停下来，但相机，可以留住一些珍贵的记忆。\n\n今年年底的时候，也就是前几天，我终于狠下心决定升级一下我的拍摄设备，购买了Sony A7M3相机，由于我拍罗同学比较多，所以我也买了适合拍人像的55mm1.8镜头和85mm1.8镜头，并打算把原来的A7一代卖掉，但挂闲鱼上却至今也没有人要。遗憾的是，我刚买完相机和镜头，公司项目就开始忙起来了，一直也没时间出去拍一点东西，最近两天才闲下来，打算在后边的几个周末出去拍一下，把我的新设备用起来。这个我新产生的爱好，也是我记录生活的一种方式。\n\n以下是一些我之前剪辑的视频：\n百里山水画廊：\n[https://www.bilibili.com/video/av70489540](https://www.bilibili.com/video/av70489540)\n丰宁坝上草原两日游：\n[https://www.bilibili.com/video/av60763262](https://www.bilibili.com/video/av60763262)\n周末日常：\n[https://www.bilibili.com/video/av60764806](https://www.bilibili.com/video/av60764806)\n奥森公园：\n[https://www.bilibili.com/video/av60764187](https://www.bilibili.com/video/av60764187)\n世界公园：\n[https://www.bilibili.com/video/av60763703](https://www.bilibili.com/video/av60763703)\n\n### `摄影，是暂停时间最好的方式`\n\n## 四、关于时间的猜想\n说到时间，我想起来之前在网上看到的一个小视频，里面有这样的一段话：“闭上眼睛想象，当你白发苍苍，七老八十的时候，你向上帝发问：神啊，能不能让我再活一次啊！上帝说，你闭上眼睛，然后时光倒流，这时候，睁开眼，你回到了现在，这一次，你打算怎么活？”。这是一个非常有意思的想象，从上帝视角来看，我其实是在进行我的第二次生命，并且命运如何我可以自己重新制定。视频的本意其实就是让我们把自己的命运掌握在自己手中。\n\n而我想到了另一个关于时间的猜想，我今年27岁，这27年来，除了父母和亲戚，身边的同学，朋友，同事，都是不断在变换，身边的人形形色色，人来人往。如果12岁的我，能通过时间隧道看到未来的我，也就是现在的我的话，他会怎么想，是感叹身边都是完全陌生的人吗？还是看到我写着自己完全看不懂的代码？还是过着自己完全想象不到的生活？如果换成是16岁的我，20岁的我呢？\n\n这不得不让我想到人们经常讨论的另一个问题，你真的活成了你所期望的样子吗？6岁的时候，我对未来世界的幻想就是长大做一名宇航员，去宇宙旅游，去其他星球旅游。抬头仰望的那一片星空，就是我最遥远的梦。12岁的时候，我对未来世界的幻想就是去大城市里生活。电视新闻里的大都市，就是我最遥远的梦。16岁的时候，我对未来世界的幻想就是去上海工作和生活。中国的国际经济中心，就是我最遥远的梦，20岁的我，对未来世界的幻想就是有自己的房子。车子，工作和生活，稳定的生活，就是我最遥远的梦。梦想变得越来越实际，眼光却也变得越来越狭隘，甚至不如6岁的我，在那双明亮的眼睛里，有着一整片的星空，可生活却只能这样，稳定的生活远好过遥远的星空。27岁的我，有父母赞助首付的一套小房子，有一辆工作两年攒钱买的很便宜的车，有在外人看来还算过得去的工作，有陪伴我的媳妇儿，有目前看来还算稳定并且日渐变好的生活。\n\n但就如我前面所说的，如果是6岁的我，12岁的我，16岁的我，20岁的我，分别通过时间隧道看到他们未来的样子，是会感到喜悦，欣慰，开心，还是难过，失望，沮丧。这个问题的答案，或许也不是一定的，或许我没能去到心里向往的国际大都市生活和工作，但我却留在了中国的首都，或许我并不是登陆外太空星球的宇航员，但我却能写出构建人类未来的代码，或许我的经济并不是衣食无忧，但我却也能过得悠然自得。这样看来，或许6岁的我会对现在的我感到失望，12岁的我会对现在的我感到沮丧，但我相信16岁的我，20岁的我，并不会对这样的未来失望。曾经，我想去宇宙，去探索那些人类未知的东西，后来随着年龄的增长，可能我更喜欢的，是让自己的生活更加精彩。不能忘记抬头仰望星空，但也不能忘记脚踏实地走好每一步。\n\n每当我怀疑自己“我真的活成了自己想要的样子吗”的时候，我可能还会想起来曾经那双明亮的双眼里的那一片星空，但生活会马上把我拉回到现实，努力工作，努力生活，过好眼前的一切，珍惜眼前的一切，才是我的人生目标，在我身边的一切，不才是我的整片星空吗。\n\n### `前进的时候，不要忘了仰望星空，仰望星空的时候，也别忘了脚踏实地`\n\n## 五、我的2019\n2020年，是以前大部分科幻世界里存在的年份，2020年，有机器人，有人工智能，有足不出户了解天下事。不管科幻世界里的描述是否都成为现实，当它真正到来的时候，我们才感慨到，时间过得真的很快。2019，我过得还算不错，很顺利，2020年，未来，继续加油！\n\n### `未来已来`\n\n## 六、憧憬\n对于2020或者更遥远的未来，我也有一些憧憬\n- 去更多地方旅游\n- 拍更多好看的照片和视频\n- 项目上线赚钱\n- 提升个人工作能力以及交往能力\n\n---\n\n`下面贴一些2019年自己认为拍的不错的照片作为结尾吧`\n![普吉岛](https://upload-images.jianshu.io/upload_images/1472037-5d133a242f415602.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![普吉岛](https://upload-images.jianshu.io/upload_images/1472037-93225e93d64afe08.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![普吉镇](https://upload-images.jianshu.io/upload_images/1472037-58552ba076d79037.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![普吉岛](https://upload-images.jianshu.io/upload_images/1472037-d1a0b00721a2d462.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![普吉岛](https://upload-images.jianshu.io/upload_images/1472037-7638161852d52755.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![蜜月岛](https://upload-images.jianshu.io/upload_images/1472037-130619996006a2ee.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![清迈](https://upload-images.jianshu.io/upload_images/1472037-b234c56608b9c92a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![清迈](https://upload-images.jianshu.io/upload_images/1472037-fc3d568850f253cd.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![加班凌晨回家](https://upload-images.jianshu.io/upload_images/1472037-b9cd52ba5e6c9435.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![百里山水画廊](https://upload-images.jianshu.io/upload_images/1472037-b83567e8175b8884.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![纪念碑谷](https://upload-images.jianshu.io/upload_images/1472037-4d65e8caeecacaf5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![纪念碑谷](https://upload-images.jianshu.io/upload_images/1472037-358c3fc290088c41.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![纪念碑谷](https://upload-images.jianshu.io/upload_images/1472037-7d855594b41759d1.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![首钢工业遗址](https://upload-images.jianshu.io/upload_images/1472037-c9afdec5905cd14c.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![首钢工业遗址](https://upload-images.jianshu.io/upload_images/1472037-861adef451c8be7d.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![首钢工业遗址](https://upload-images.jianshu.io/upload_images/1472037-0cdbf2d49e7bf809.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![世界公园](https://upload-images.jianshu.io/upload_images/1472037-ecea7f62fca67f1a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![坡峰岭](https://upload-images.jianshu.io/upload_images/1472037-969213d616cf89b5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![坡峰岭](https://upload-images.jianshu.io/upload_images/1472037-72682673ed542738.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![坡峰岭](https://upload-images.jianshu.io/upload_images/1472037-f79cd2cc48843dc2.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![坡峰岭](https://upload-images.jianshu.io/upload_images/1472037-2d4061c49193650f.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n","source":"_posts/我的2019.md","raw":"---\ntitle: 我的2019\ndate: 2019-12-25 01:10\ncategories: 生活\ntags: [生活]\n---\n看看这个标题，没错，这又是一篇年终总结，上一次写年终总结还是2017年，而2018年直接就跳过没有写。之前的业余时间的确是很多，现在我连休息时间也变少了，所以一年都很难产出一篇，前段时间闲了一点，才很艰难的挤出了一篇关于我对Python这门语言的理解。其实没有用文字记录下来，并不代表我这两年什么都没有做，相反，我经历了太多的事情，才让我连用文字记录的时间都没有了。那么接下来，我会用一整篇的篇幅来告诉大家，这两年，我都做了什么，学会了什么，完成了什么。\n<!--more-->\n`——一名游戏行业程序员的生活记录`\n\n## 一、关于写书\n大概是从入职上家公司开始，我开始学着写作，因为工作中需要我去学习很多新的东西，而学会一个东西最好的方式就是把你学会的从头到尾都详细解释出来，所以我开始了写博客，我写的东西其实并不高深，都是基础知识的运用，甚至在文章中加过很多修辞，故弄玄虚，夸大其词，而实际上却是知识很基础的一部分内容，而这些恰恰是因为我最初开始写文章的时候，自己的基础并不扎实，而又想急于求成所造成的结果。\n\n2016年，我花了几乎一年的时间写了一本书《深度解析Java游戏服务器开发》，我的确是倾注了个人的大部分时间和精力，但是老实说，这本书的内容特别的华而不实，这也是我后来对我那本书的一个自我反省，甚至说我想在两年后的今天，去重写里面的内容。那本书一经推出后，我也看了网上的评论，收获了不少差评，里面确实有我的个人原因，本身基础不太扎实的我，以一种急于求成的姿态去写了这样一本书，用网友的评论来说，这本书的确是堆砌代码且无营养。\n\n后来第二年，也就是2017年，我又开始写第二本书《Cocos2d-JS游戏开发快速入门到实战》，总结第一本书的经验教训，在写第二本书的时候，我特别注重书里内容的图、文、代码相结合，内容可以不多，但一定要准确，精简，让读者能看懂。同样是一年的时间，我完成了我的第二本书，这本书从销量上来说，可能还不如第一本书，因为JS技术的普遍性以及用Cocos2d-JS来做游戏的普遍性相对Java的使用普遍性来说要少很多，不过对我个人来说，第二本书是我结合了上一本书的经验教训写出来内容更加优质的书，写书的收入并不多，也就小一万块钱，但对于我个人的意义真的是不一样的，单从写书这件事情来说，就是对我个人意志力的一个巨大的挑战，你要牺牲近半年的休息时间用来写书，写案例，写示例代码，保证所有的代码都是可运行的。好在最后结果还不错，虽然销量可能并不高，但我看到网上的评论里大部分是好评，甚至有大学生或者刚毕业的开始工作的人私信我，问我一些职业发展上的问题，那个时候我就在想，我可能并不能给你们什么有用的建议，但我的书只要可以让一个人开始对游戏开发感兴趣，那我就是成功了。\n\n### `果然，坚持与认真，是做成一件事情最重要的品质。`\n\n## 二、关于工作\n从写完第二本书之后，我几乎停止了写作，因为在2017年初入职了我现在这家公司后，我的业余时间大大减少，那个时间点，游戏行业面临寒冬，版号开始限制，审查开始严格，大批量的不合格游戏需要整顿，当然，从宏观上来看，这是对游戏行业的规范的合理化，但最后落在我们每一个游戏行业的螺丝钉——程序员来说，可能就是加班以及赶工。从长远来看，加班并不影响我们做一件事情的热情，如果我正在做的是一件成功率很高的产品来说，加班赶工把它做好的意义，要远大于优哉游哉混日子的意义。对于我所在的项目组来说，我们所做的产品，在我看来也确实是有希望做成的，所以我选择了留在这里，并且到现在为止，已经做了快三年了，在前几天第一次内测的情况来看，我们的游戏确实是有希望成为游戏界的一款爆款游戏，测试数据要远好于同行产品，也获得了玩家和媒体的一致好评。\n\n在游戏测试的当天，我们就看到B站已经有主播在开始直播了，跟着有不少玩家发弹幕和评论，从网上的评论来看，这款游戏的惊艳程度，远远超过了玩家的预期，虽然也有很多不足的地方，但从大部分玩家来看，都是对我们的游戏充满了期待，希望能快点优化并上线，不管怎么样，看到网上铺天盖地的好评，以及最后的测试数据来看，我们最近一两个月的连续加班都是有意义的，而测试的三天时间，我也亲自玩了我们游戏，从玩家的角度来说，我也是对这款游戏充满了期待。\n\n`测试结束后的玩家一个宣传视频`\nhttps://www.bilibili.com/video/av79947489](https://www.bilibili.com/video/\n\n从整个项目来说，它在朝一款创新的类主机体验的ACT游戏发展，并且是一款有很大几率能做成的产品。从我个人成长来说，我也非常有幸从项目初期就加入到这款游戏的开发，我的个人能力也快速的成长了起来，并且我的老大对我的成长很有帮助，大到为人处世，小到编码规范，都对我有很重要的影响，有人说，工作就是要跟对好的项目，和跟对好的领导，现在这两样我都有了。在这个项目组的这几年，是对我的职业发展最快的几年。得益于老大的照顾，我能了解到项目整体的技术结构，我经历过项目战斗的状态同步到帧同步的转变，参与过核心战斗的开发，写过部分功能的可扩展的底层框架代码，对接过项目上线部署更新流程，也自己写过一些提高工作效率的工具。总的来说，参与这个项目，让我从头到尾都了解了一遍一款游戏的制作需要经历些什么，也让我的个人技术以及职业生涯成长了很多。虽然是游戏行业的新生代码农，但我也感觉我并没有走多少弯路，一直在正确的方向上，一直向前走。\n\n### `在正确的方向上，摸索和成长。`\n\n## 三、关于生活\n\n- #####婚姻\n2019年，我27岁了，不算大也不算小的年纪，这一年，我完成了人生的婚姻大事，实现了第一次的出国自由行，喜欢上了拍照和拍视频，也开始对人生产生思考，开始对生命和宇宙产生好奇。\n\n年初的时候，我完成了自己的人生大事，从那天之后，我可能就真的长成大人了，我需要对自己负责，也需要对新成立的小家负责。在婚后的一年时间里，其实我也没有太多不一样的感觉，我们还是很正常的生活，正常的工作，早上一起起床，一起洗漱，一起上班，晚上先后回家。有时候我加班很晚，她也会等到我回家，周末偶尔看看电影，做做饭，或者去稍远一点的郊区自驾游，拍拍照，这种感觉就像是，没有什么特别，没有什么不一样，但却有着陪伴的温暖，不可或缺。有个人和我一起在异地他乡赚钱生活，是一件很辛苦，却很幸福的事情。\n\n### `生活，平平淡淡才是真。`\n\n![结婚](http://upload-images.jianshu.io/upload_images/1472037-d8986d58e1e1856f.jpg)\n\n![结婚](http://upload-images.jianshu.io/upload_images/1472037-2ea959c46cf7703d.jpg)\n\n![结婚](http://upload-images.jianshu.io/upload_images/1472037-adefcafc8ebf00cf.jpg)\n\n![结婚](http://upload-images.jianshu.io/upload_images/1472037-7104098758fc2ec6.jpg)\n\n![结婚](http://upload-images.jianshu.io/upload_images/1472037-4c7ec957ea7dca7d.jpg)\n\n- #####旅行\n结婚之后，接着我又做了第二件人生的第一次尝试——出国旅游。请了长达12天的婚假（10天婚假连 一个周末），去了泰国的普吉和清迈，全程的签证、酒店、机票、景点路线以及各种注意事项，都是我和罗同学两个人研究的，并且全程下来，整个旅行的感受特别好，完全不同于各种购物旅游团，完全就是12天的度假休闲。休假的前的一个月，我们就开始研究这次旅行的所有攻略，并且制定了excel表格，规划好了所有的航班和酒店，并且计算了预计价格。\n![行程安排](https://upload-images.jianshu.io/upload_images/1472037-aba39822f01b225b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n上网搜索我需要准备那些APP\n![APP](https://upload-images.jianshu.io/upload_images/1472037-eede58fc739732a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n准备那些物品\n![物品准备](https://upload-images.jianshu.io/upload_images/1472037-a81f4f70c1fb0146.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n甚至根据B站上那些旅游UP主的旅游视频规划了我出门旅拍都需要拍摄什么内容\n![VLOG设计](https://upload-images.jianshu.io/upload_images/1472037-985258b320fe60b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n最后在一款叫出发吧的APP上详细罗列了我们的行程，并且整个自由行过程都按照行程一步一步的走。\nhttp://chufaba.me/journals/1055821\n\n整个旅程下来，12天时间，加上购物等所有的花销，我们一共是花费了两万六左右，人均一万三左右，在我看来，是一次性价比很高的旅行。与跟团旅行不同，我们的旅游路线完全是自己制定，甚至可以任性修改，而且我们每天都是八点多才起床，九点多才出门，如果突然发现今天计划的景点突然不感兴趣了，想去另外一个景点，也是可以突然更改的，只要整体进度在计划之内，就不会对整体行程有什么比较大的影响。\n\n在这次做了充足准备的泰国自由行中，我们也是度过了非常愉快的假期，拍了很多好看的照片和视频，包括泰国整个给我的印象也是一个非常开放的国度，大部分人的英语都特别好，很好交流，甚至在中国人密集的地方，小贩都能和你用中文聊天。这次去的两个地方分别有着不一样的风格，普吉岛的感觉是热情奔放，有热情的当地导游，有热闹的夜市小吃，有美丽的海岛风情，而清迈的感觉是悠然自得，阳光正好，心情舒适，能彻底放松身心。按照出行的规划的拍摄，我拍了很多视频片段，回来了精心挑选了一些片段以及音效音乐，剪成了一段小短片，也算是给我人生的第一次完全自己主导的出国自由行留下了一段美好的回忆。\n\n泰国蜜月旅行\n[https://www.bilibili.com/video/av47155696](https://www.bilibili.com/video/av47155696)\n\n### `如果有时间，一定要出去旅行，看看外面的世界有多精彩`\n\n- #####摄影\n说到拍照和拍视频，这也是我最近两年才突然学会的一项技能。大概是2015年的时候，罗同学不知道怎么回事，非要买一台相机，想学习拍照，后来不知道怎么的，相机就吃灰了，被搁置了，而近两年，我又不知道怎么回事，突然想要学习怎么拍照拍视频，尤其是今年，我经常会上B站去看看别人拍的照片和视频，学习前期拍摄技巧以及后期剪辑技术。就这样，一台四年前购买的Sony A7一代相机的使用率突然就高了起来，加上去年买了车，只要放假，就想要出去拍点好看的照片或者好看的视频，回家后期修图或者剪辑视频，而罗同学作为我的模特，也越来越喜欢让我给她拍照。慢慢的，摄影，也成了我除了打游戏以外的另一个爱好。\n\n不敢和各路大神相提并论，我喜欢摄影单纯只是想拍出美的照片，或者是剪辑一段好看的视频，每一次修照片或者剪视频，我都会觉得我之前拍的都是什么东西啊之类的想法，然后经常去看一些摄影UP主的视频去学习一些前期拍摄的技巧以及后期剪辑的技能。在我看来，时间不会停下来，但相机，可以留住一些珍贵的记忆。\n\n今年年底的时候，也就是前几天，我终于狠下心决定升级一下我的拍摄设备，购买了Sony A7M3相机，由于我拍罗同学比较多，所以我也买了适合拍人像的55mm1.8镜头和85mm1.8镜头，并打算把原来的A7一代卖掉，但挂闲鱼上却至今也没有人要。遗憾的是，我刚买完相机和镜头，公司项目就开始忙起来了，一直也没时间出去拍一点东西，最近两天才闲下来，打算在后边的几个周末出去拍一下，把我的新设备用起来。这个我新产生的爱好，也是我记录生活的一种方式。\n\n以下是一些我之前剪辑的视频：\n百里山水画廊：\n[https://www.bilibili.com/video/av70489540](https://www.bilibili.com/video/av70489540)\n丰宁坝上草原两日游：\n[https://www.bilibili.com/video/av60763262](https://www.bilibili.com/video/av60763262)\n周末日常：\n[https://www.bilibili.com/video/av60764806](https://www.bilibili.com/video/av60764806)\n奥森公园：\n[https://www.bilibili.com/video/av60764187](https://www.bilibili.com/video/av60764187)\n世界公园：\n[https://www.bilibili.com/video/av60763703](https://www.bilibili.com/video/av60763703)\n\n### `摄影，是暂停时间最好的方式`\n\n## 四、关于时间的猜想\n说到时间，我想起来之前在网上看到的一个小视频，里面有这样的一段话：“闭上眼睛想象，当你白发苍苍，七老八十的时候，你向上帝发问：神啊，能不能让我再活一次啊！上帝说，你闭上眼睛，然后时光倒流，这时候，睁开眼，你回到了现在，这一次，你打算怎么活？”。这是一个非常有意思的想象，从上帝视角来看，我其实是在进行我的第二次生命，并且命运如何我可以自己重新制定。视频的本意其实就是让我们把自己的命运掌握在自己手中。\n\n而我想到了另一个关于时间的猜想，我今年27岁，这27年来，除了父母和亲戚，身边的同学，朋友，同事，都是不断在变换，身边的人形形色色，人来人往。如果12岁的我，能通过时间隧道看到未来的我，也就是现在的我的话，他会怎么想，是感叹身边都是完全陌生的人吗？还是看到我写着自己完全看不懂的代码？还是过着自己完全想象不到的生活？如果换成是16岁的我，20岁的我呢？\n\n这不得不让我想到人们经常讨论的另一个问题，你真的活成了你所期望的样子吗？6岁的时候，我对未来世界的幻想就是长大做一名宇航员，去宇宙旅游，去其他星球旅游。抬头仰望的那一片星空，就是我最遥远的梦。12岁的时候，我对未来世界的幻想就是去大城市里生活。电视新闻里的大都市，就是我最遥远的梦。16岁的时候，我对未来世界的幻想就是去上海工作和生活。中国的国际经济中心，就是我最遥远的梦，20岁的我，对未来世界的幻想就是有自己的房子。车子，工作和生活，稳定的生活，就是我最遥远的梦。梦想变得越来越实际，眼光却也变得越来越狭隘，甚至不如6岁的我，在那双明亮的眼睛里，有着一整片的星空，可生活却只能这样，稳定的生活远好过遥远的星空。27岁的我，有父母赞助首付的一套小房子，有一辆工作两年攒钱买的很便宜的车，有在外人看来还算过得去的工作，有陪伴我的媳妇儿，有目前看来还算稳定并且日渐变好的生活。\n\n但就如我前面所说的，如果是6岁的我，12岁的我，16岁的我，20岁的我，分别通过时间隧道看到他们未来的样子，是会感到喜悦，欣慰，开心，还是难过，失望，沮丧。这个问题的答案，或许也不是一定的，或许我没能去到心里向往的国际大都市生活和工作，但我却留在了中国的首都，或许我并不是登陆外太空星球的宇航员，但我却能写出构建人类未来的代码，或许我的经济并不是衣食无忧，但我却也能过得悠然自得。这样看来，或许6岁的我会对现在的我感到失望，12岁的我会对现在的我感到沮丧，但我相信16岁的我，20岁的我，并不会对这样的未来失望。曾经，我想去宇宙，去探索那些人类未知的东西，后来随着年龄的增长，可能我更喜欢的，是让自己的生活更加精彩。不能忘记抬头仰望星空，但也不能忘记脚踏实地走好每一步。\n\n每当我怀疑自己“我真的活成了自己想要的样子吗”的时候，我可能还会想起来曾经那双明亮的双眼里的那一片星空，但生活会马上把我拉回到现实，努力工作，努力生活，过好眼前的一切，珍惜眼前的一切，才是我的人生目标，在我身边的一切，不才是我的整片星空吗。\n\n### `前进的时候，不要忘了仰望星空，仰望星空的时候，也别忘了脚踏实地`\n\n## 五、我的2019\n2020年，是以前大部分科幻世界里存在的年份，2020年，有机器人，有人工智能，有足不出户了解天下事。不管科幻世界里的描述是否都成为现实，当它真正到来的时候，我们才感慨到，时间过得真的很快。2019，我过得还算不错，很顺利，2020年，未来，继续加油！\n\n### `未来已来`\n\n## 六、憧憬\n对于2020或者更遥远的未来，我也有一些憧憬\n- 去更多地方旅游\n- 拍更多好看的照片和视频\n- 项目上线赚钱\n- 提升个人工作能力以及交往能力\n\n---\n\n`下面贴一些2019年自己认为拍的不错的照片作为结尾吧`\n![普吉岛](https://upload-images.jianshu.io/upload_images/1472037-5d133a242f415602.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![普吉岛](https://upload-images.jianshu.io/upload_images/1472037-93225e93d64afe08.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![普吉镇](https://upload-images.jianshu.io/upload_images/1472037-58552ba076d79037.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![普吉岛](https://upload-images.jianshu.io/upload_images/1472037-d1a0b00721a2d462.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![普吉岛](https://upload-images.jianshu.io/upload_images/1472037-7638161852d52755.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![蜜月岛](https://upload-images.jianshu.io/upload_images/1472037-130619996006a2ee.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![清迈](https://upload-images.jianshu.io/upload_images/1472037-b234c56608b9c92a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![清迈](https://upload-images.jianshu.io/upload_images/1472037-fc3d568850f253cd.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![加班凌晨回家](https://upload-images.jianshu.io/upload_images/1472037-b9cd52ba5e6c9435.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![百里山水画廊](https://upload-images.jianshu.io/upload_images/1472037-b83567e8175b8884.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![纪念碑谷](https://upload-images.jianshu.io/upload_images/1472037-4d65e8caeecacaf5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![纪念碑谷](https://upload-images.jianshu.io/upload_images/1472037-358c3fc290088c41.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![纪念碑谷](https://upload-images.jianshu.io/upload_images/1472037-7d855594b41759d1.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![首钢工业遗址](https://upload-images.jianshu.io/upload_images/1472037-c9afdec5905cd14c.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![首钢工业遗址](https://upload-images.jianshu.io/upload_images/1472037-861adef451c8be7d.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![首钢工业遗址](https://upload-images.jianshu.io/upload_images/1472037-0cdbf2d49e7bf809.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![世界公园](https://upload-images.jianshu.io/upload_images/1472037-ecea7f62fca67f1a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![坡峰岭](https://upload-images.jianshu.io/upload_images/1472037-969213d616cf89b5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![坡峰岭](https://upload-images.jianshu.io/upload_images/1472037-72682673ed542738.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![坡峰岭](https://upload-images.jianshu.io/upload_images/1472037-f79cd2cc48843dc2.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![坡峰岭](https://upload-images.jianshu.io/upload_images/1472037-2d4061c49193650f.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n","slug":"我的2019","published":1,"updated":"2020-09-26T15:34:23.838Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhvu0053wsazacvefp8b","content":"<p>看看这个标题，没错，这又是一篇年终总结，上一次写年终总结还是2017年，而2018年直接就跳过没有写。之前的业余时间的确是很多，现在我连休息时间也变少了，所以一年都很难产出一篇，前段时间闲了一点，才很艰难的挤出了一篇关于我对Python这门语言的理解。其实没有用文字记录下来，并不代表我这两年什么都没有做，相反，我经历了太多的事情，才让我连用文字记录的时间都没有了。那么接下来，我会用一整篇的篇幅来告诉大家，这两年，我都做了什么，学会了什么，完成了什么。</p>\n<a id=\"more\"></a>\n<p><code>——一名游戏行业程序员的生活记录</code></p>\n<h2 id=\"一、关于写书\"><a href=\"#一、关于写书\" class=\"headerlink\" title=\"一、关于写书\"></a>一、关于写书</h2><p>大概是从入职上家公司开始，我开始学着写作，因为工作中需要我去学习很多新的东西，而学会一个东西最好的方式就是把你学会的从头到尾都详细解释出来，所以我开始了写博客，我写的东西其实并不高深，都是基础知识的运用，甚至在文章中加过很多修辞，故弄玄虚，夸大其词，而实际上却是知识很基础的一部分内容，而这些恰恰是因为我最初开始写文章的时候，自己的基础并不扎实，而又想急于求成所造成的结果。</p>\n<p>2016年，我花了几乎一年的时间写了一本书《深度解析Java游戏服务器开发》，我的确是倾注了个人的大部分时间和精力，但是老实说，这本书的内容特别的华而不实，这也是我后来对我那本书的一个自我反省，甚至说我想在两年后的今天，去重写里面的内容。那本书一经推出后，我也看了网上的评论，收获了不少差评，里面确实有我的个人原因，本身基础不太扎实的我，以一种急于求成的姿态去写了这样一本书，用网友的评论来说，这本书的确是堆砌代码且无营养。</p>\n<p>后来第二年，也就是2017年，我又开始写第二本书《Cocos2d-JS游戏开发快速入门到实战》，总结第一本书的经验教训，在写第二本书的时候，我特别注重书里内容的图、文、代码相结合，内容可以不多，但一定要准确，精简，让读者能看懂。同样是一年的时间，我完成了我的第二本书，这本书从销量上来说，可能还不如第一本书，因为JS技术的普遍性以及用Cocos2d-JS来做游戏的普遍性相对Java的使用普遍性来说要少很多，不过对我个人来说，第二本书是我结合了上一本书的经验教训写出来内容更加优质的书，写书的收入并不多，也就小一万块钱，但对于我个人的意义真的是不一样的，单从写书这件事情来说，就是对我个人意志力的一个巨大的挑战，你要牺牲近半年的休息时间用来写书，写案例，写示例代码，保证所有的代码都是可运行的。好在最后结果还不错，虽然销量可能并不高，但我看到网上的评论里大部分是好评，甚至有大学生或者刚毕业的开始工作的人私信我，问我一些职业发展上的问题，那个时候我就在想，我可能并不能给你们什么有用的建议，但我的书只要可以让一个人开始对游戏开发感兴趣，那我就是成功了。</p>\n<h3 id=\"果然，坚持与认真，是做成一件事情最重要的品质。\"><a href=\"#果然，坚持与认真，是做成一件事情最重要的品质。\" class=\"headerlink\" title=\"果然，坚持与认真，是做成一件事情最重要的品质。\"></a><code>果然，坚持与认真，是做成一件事情最重要的品质。</code></h3><h2 id=\"二、关于工作\"><a href=\"#二、关于工作\" class=\"headerlink\" title=\"二、关于工作\"></a>二、关于工作</h2><p>从写完第二本书之后，我几乎停止了写作，因为在2017年初入职了我现在这家公司后，我的业余时间大大减少，那个时间点，游戏行业面临寒冬，版号开始限制，审查开始严格，大批量的不合格游戏需要整顿，当然，从宏观上来看，这是对游戏行业的规范的合理化，但最后落在我们每一个游戏行业的螺丝钉——程序员来说，可能就是加班以及赶工。从长远来看，加班并不影响我们做一件事情的热情，如果我正在做的是一件成功率很高的产品来说，加班赶工把它做好的意义，要远大于优哉游哉混日子的意义。对于我所在的项目组来说，我们所做的产品，在我看来也确实是有希望做成的，所以我选择了留在这里，并且到现在为止，已经做了快三年了，在前几天第一次内测的情况来看，我们的游戏确实是有希望成为游戏界的一款爆款游戏，测试数据要远好于同行产品，也获得了玩家和媒体的一致好评。</p>\n<p>在游戏测试的当天，我们就看到B站已经有主播在开始直播了，跟着有不少玩家发弹幕和评论，从网上的评论来看，这款游戏的惊艳程度，远远超过了玩家的预期，虽然也有很多不足的地方，但从大部分玩家来看，都是对我们的游戏充满了期待，希望能快点优化并上线，不管怎么样，看到网上铺天盖地的好评，以及最后的测试数据来看，我们最近一两个月的连续加班都是有意义的，而测试的三天时间，我也亲自玩了我们游戏，从玩家的角度来说，我也是对这款游戏充满了期待。</p>\n<p><code>测试结束后的玩家一个宣传视频</code><br><a href=\"https://www.bilibili.com/video/av79947489]\">https://www.bilibili.com/video/av79947489]</a>(<a href=\"https://www.bilibili.com/video/\">https://www.bilibili.com/video/</a></p>\n<p>从整个项目来说，它在朝一款创新的类主机体验的ACT游戏发展，并且是一款有很大几率能做成的产品。从我个人成长来说，我也非常有幸从项目初期就加入到这款游戏的开发，我的个人能力也快速的成长了起来，并且我的老大对我的成长很有帮助，大到为人处世，小到编码规范，都对我有很重要的影响，有人说，工作就是要跟对好的项目，和跟对好的领导，现在这两样我都有了。在这个项目组的这几年，是对我的职业发展最快的几年。得益于老大的照顾，我能了解到项目整体的技术结构，我经历过项目战斗的状态同步到帧同步的转变，参与过核心战斗的开发，写过部分功能的可扩展的底层框架代码，对接过项目上线部署更新流程，也自己写过一些提高工作效率的工具。总的来说，参与这个项目，让我从头到尾都了解了一遍一款游戏的制作需要经历些什么，也让我的个人技术以及职业生涯成长了很多。虽然是游戏行业的新生代码农，但我也感觉我并没有走多少弯路，一直在正确的方向上，一直向前走。</p>\n<h3 id=\"在正确的方向上，摸索和成长。\"><a href=\"#在正确的方向上，摸索和成长。\" class=\"headerlink\" title=\"在正确的方向上，摸索和成长。\"></a><code>在正确的方向上，摸索和成长。</code></h3><h2 id=\"三、关于生活\"><a href=\"#三、关于生活\" class=\"headerlink\" title=\"三、关于生活\"></a>三、关于生活</h2><ul>\n<li>#####婚姻<br>2019年，我27岁了，不算大也不算小的年纪，这一年，我完成了人生的婚姻大事，实现了第一次的出国自由行，喜欢上了拍照和拍视频，也开始对人生产生思考，开始对生命和宇宙产生好奇。</li>\n</ul>\n<p>年初的时候，我完成了自己的人生大事，从那天之后，我可能就真的长成大人了，我需要对自己负责，也需要对新成立的小家负责。在婚后的一年时间里，其实我也没有太多不一样的感觉，我们还是很正常的生活，正常的工作，早上一起起床，一起洗漱，一起上班，晚上先后回家。有时候我加班很晚，她也会等到我回家，周末偶尔看看电影，做做饭，或者去稍远一点的郊区自驾游，拍拍照，这种感觉就像是，没有什么特别，没有什么不一样，但却有着陪伴的温暖，不可或缺。有个人和我一起在异地他乡赚钱生活，是一件很辛苦，却很幸福的事情。</p>\n<h3 id=\"生活，平平淡淡才是真。\"><a href=\"#生活，平平淡淡才是真。\" class=\"headerlink\" title=\"生活，平平淡淡才是真。\"></a><code>生活，平平淡淡才是真。</code></h3><p><img src=\"http://upload-images.jianshu.io/upload_images/1472037-d8986d58e1e1856f.jpg\" alt=\"结婚\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/1472037-2ea959c46cf7703d.jpg\" alt=\"结婚\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/1472037-adefcafc8ebf00cf.jpg\" alt=\"结婚\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/1472037-7104098758fc2ec6.jpg\" alt=\"结婚\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/1472037-4c7ec957ea7dca7d.jpg\" alt=\"结婚\"></p>\n<ul>\n<li>#####旅行<br>结婚之后，接着我又做了第二件人生的第一次尝试——出国旅游。请了长达12天的婚假（10天婚假连 一个周末），去了泰国的普吉和清迈，全程的签证、酒店、机票、景点路线以及各种注意事项，都是我和罗同学两个人研究的，并且全程下来，整个旅行的感受特别好，完全不同于各种购物旅游团，完全就是12天的度假休闲。休假的前的一个月，我们就开始研究这次旅行的所有攻略，并且制定了excel表格，规划好了所有的航班和酒店，并且计算了预计价格。<br><img src=\"https://upload-images.jianshu.io/upload_images/1472037-aba39822f01b225b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"行程安排\"><br>上网搜索我需要准备那些APP<br><img src=\"https://upload-images.jianshu.io/upload_images/1472037-eede58fc739732a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"APP\"><br>准备那些物品<br><img src=\"https://upload-images.jianshu.io/upload_images/1472037-a81f4f70c1fb0146.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"物品准备\"><br>甚至根据B站上那些旅游UP主的旅游视频规划了我出门旅拍都需要拍摄什么内容<br><img src=\"https://upload-images.jianshu.io/upload_images/1472037-985258b320fe60b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"VLOG设计\"></li>\n</ul>\n<p>最后在一款叫出发吧的APP上详细罗列了我们的行程，并且整个自由行过程都按照行程一步一步的走。<br><a href=\"http://chufaba.me/journals/1055821\">http://chufaba.me/journals/1055821</a></p>\n<p>整个旅程下来，12天时间，加上购物等所有的花销，我们一共是花费了两万六左右，人均一万三左右，在我看来，是一次性价比很高的旅行。与跟团旅行不同，我们的旅游路线完全是自己制定，甚至可以任性修改，而且我们每天都是八点多才起床，九点多才出门，如果突然发现今天计划的景点突然不感兴趣了，想去另外一个景点，也是可以突然更改的，只要整体进度在计划之内，就不会对整体行程有什么比较大的影响。</p>\n<p>在这次做了充足准备的泰国自由行中，我们也是度过了非常愉快的假期，拍了很多好看的照片和视频，包括泰国整个给我的印象也是一个非常开放的国度，大部分人的英语都特别好，很好交流，甚至在中国人密集的地方，小贩都能和你用中文聊天。这次去的两个地方分别有着不一样的风格，普吉岛的感觉是热情奔放，有热情的当地导游，有热闹的夜市小吃，有美丽的海岛风情，而清迈的感觉是悠然自得，阳光正好，心情舒适，能彻底放松身心。按照出行的规划的拍摄，我拍了很多视频片段，回来了精心挑选了一些片段以及音效音乐，剪成了一段小短片，也算是给我人生的第一次完全自己主导的出国自由行留下了一段美好的回忆。</p>\n<p>泰国蜜月旅行<br><a href=\"https://www.bilibili.com/video/av47155696\">https://www.bilibili.com/video/av47155696</a></p>\n<h3 id=\"如果有时间，一定要出去旅行，看看外面的世界有多精彩\"><a href=\"#如果有时间，一定要出去旅行，看看外面的世界有多精彩\" class=\"headerlink\" title=\"如果有时间，一定要出去旅行，看看外面的世界有多精彩\"></a><code>如果有时间，一定要出去旅行，看看外面的世界有多精彩</code></h3><ul>\n<li>#####摄影<br>说到拍照和拍视频，这也是我最近两年才突然学会的一项技能。大概是2015年的时候，罗同学不知道怎么回事，非要买一台相机，想学习拍照，后来不知道怎么的，相机就吃灰了，被搁置了，而近两年，我又不知道怎么回事，突然想要学习怎么拍照拍视频，尤其是今年，我经常会上B站去看看别人拍的照片和视频，学习前期拍摄技巧以及后期剪辑技术。就这样，一台四年前购买的Sony A7一代相机的使用率突然就高了起来，加上去年买了车，只要放假，就想要出去拍点好看的照片或者好看的视频，回家后期修图或者剪辑视频，而罗同学作为我的模特，也越来越喜欢让我给她拍照。慢慢的，摄影，也成了我除了打游戏以外的另一个爱好。</li>\n</ul>\n<p>不敢和各路大神相提并论，我喜欢摄影单纯只是想拍出美的照片，或者是剪辑一段好看的视频，每一次修照片或者剪视频，我都会觉得我之前拍的都是什么东西啊之类的想法，然后经常去看一些摄影UP主的视频去学习一些前期拍摄的技巧以及后期剪辑的技能。在我看来，时间不会停下来，但相机，可以留住一些珍贵的记忆。</p>\n<p>今年年底的时候，也就是前几天，我终于狠下心决定升级一下我的拍摄设备，购买了Sony A7M3相机，由于我拍罗同学比较多，所以我也买了适合拍人像的55mm1.8镜头和85mm1.8镜头，并打算把原来的A7一代卖掉，但挂闲鱼上却至今也没有人要。遗憾的是，我刚买完相机和镜头，公司项目就开始忙起来了，一直也没时间出去拍一点东西，最近两天才闲下来，打算在后边的几个周末出去拍一下，把我的新设备用起来。这个我新产生的爱好，也是我记录生活的一种方式。</p>\n<p>以下是一些我之前剪辑的视频：<br>百里山水画廊：<br><a href=\"https://www.bilibili.com/video/av70489540\">https://www.bilibili.com/video/av70489540</a><br>丰宁坝上草原两日游：<br><a href=\"https://www.bilibili.com/video/av60763262\">https://www.bilibili.com/video/av60763262</a><br>周末日常：<br><a href=\"https://www.bilibili.com/video/av60764806\">https://www.bilibili.com/video/av60764806</a><br>奥森公园：<br><a href=\"https://www.bilibili.com/video/av60764187\">https://www.bilibili.com/video/av60764187</a><br>世界公园：<br><a href=\"https://www.bilibili.com/video/av60763703\">https://www.bilibili.com/video/av60763703</a></p>\n<h3 id=\"摄影，是暂停时间最好的方式\"><a href=\"#摄影，是暂停时间最好的方式\" class=\"headerlink\" title=\"摄影，是暂停时间最好的方式\"></a><code>摄影，是暂停时间最好的方式</code></h3><h2 id=\"四、关于时间的猜想\"><a href=\"#四、关于时间的猜想\" class=\"headerlink\" title=\"四、关于时间的猜想\"></a>四、关于时间的猜想</h2><p>说到时间，我想起来之前在网上看到的一个小视频，里面有这样的一段话：“闭上眼睛想象，当你白发苍苍，七老八十的时候，你向上帝发问：神啊，能不能让我再活一次啊！上帝说，你闭上眼睛，然后时光倒流，这时候，睁开眼，你回到了现在，这一次，你打算怎么活？”。这是一个非常有意思的想象，从上帝视角来看，我其实是在进行我的第二次生命，并且命运如何我可以自己重新制定。视频的本意其实就是让我们把自己的命运掌握在自己手中。</p>\n<p>而我想到了另一个关于时间的猜想，我今年27岁，这27年来，除了父母和亲戚，身边的同学，朋友，同事，都是不断在变换，身边的人形形色色，人来人往。如果12岁的我，能通过时间隧道看到未来的我，也就是现在的我的话，他会怎么想，是感叹身边都是完全陌生的人吗？还是看到我写着自己完全看不懂的代码？还是过着自己完全想象不到的生活？如果换成是16岁的我，20岁的我呢？</p>\n<p>这不得不让我想到人们经常讨论的另一个问题，你真的活成了你所期望的样子吗？6岁的时候，我对未来世界的幻想就是长大做一名宇航员，去宇宙旅游，去其他星球旅游。抬头仰望的那一片星空，就是我最遥远的梦。12岁的时候，我对未来世界的幻想就是去大城市里生活。电视新闻里的大都市，就是我最遥远的梦。16岁的时候，我对未来世界的幻想就是去上海工作和生活。中国的国际经济中心，就是我最遥远的梦，20岁的我，对未来世界的幻想就是有自己的房子。车子，工作和生活，稳定的生活，就是我最遥远的梦。梦想变得越来越实际，眼光却也变得越来越狭隘，甚至不如6岁的我，在那双明亮的眼睛里，有着一整片的星空，可生活却只能这样，稳定的生活远好过遥远的星空。27岁的我，有父母赞助首付的一套小房子，有一辆工作两年攒钱买的很便宜的车，有在外人看来还算过得去的工作，有陪伴我的媳妇儿，有目前看来还算稳定并且日渐变好的生活。</p>\n<p>但就如我前面所说的，如果是6岁的我，12岁的我，16岁的我，20岁的我，分别通过时间隧道看到他们未来的样子，是会感到喜悦，欣慰，开心，还是难过，失望，沮丧。这个问题的答案，或许也不是一定的，或许我没能去到心里向往的国际大都市生活和工作，但我却留在了中国的首都，或许我并不是登陆外太空星球的宇航员，但我却能写出构建人类未来的代码，或许我的经济并不是衣食无忧，但我却也能过得悠然自得。这样看来，或许6岁的我会对现在的我感到失望，12岁的我会对现在的我感到沮丧，但我相信16岁的我，20岁的我，并不会对这样的未来失望。曾经，我想去宇宙，去探索那些人类未知的东西，后来随着年龄的增长，可能我更喜欢的，是让自己的生活更加精彩。不能忘记抬头仰望星空，但也不能忘记脚踏实地走好每一步。</p>\n<p>每当我怀疑自己“我真的活成了自己想要的样子吗”的时候，我可能还会想起来曾经那双明亮的双眼里的那一片星空，但生活会马上把我拉回到现实，努力工作，努力生活，过好眼前的一切，珍惜眼前的一切，才是我的人生目标，在我身边的一切，不才是我的整片星空吗。</p>\n<h3 id=\"前进的时候，不要忘了仰望星空，仰望星空的时候，也别忘了脚踏实地\"><a href=\"#前进的时候，不要忘了仰望星空，仰望星空的时候，也别忘了脚踏实地\" class=\"headerlink\" title=\"前进的时候，不要忘了仰望星空，仰望星空的时候，也别忘了脚踏实地\"></a><code>前进的时候，不要忘了仰望星空，仰望星空的时候，也别忘了脚踏实地</code></h3><h2 id=\"五、我的2019\"><a href=\"#五、我的2019\" class=\"headerlink\" title=\"五、我的2019\"></a>五、我的2019</h2><p>2020年，是以前大部分科幻世界里存在的年份，2020年，有机器人，有人工智能，有足不出户了解天下事。不管科幻世界里的描述是否都成为现实，当它真正到来的时候，我们才感慨到，时间过得真的很快。2019，我过得还算不错，很顺利，2020年，未来，继续加油！</p>\n<h3 id=\"未来已来\"><a href=\"#未来已来\" class=\"headerlink\" title=\"未来已来\"></a><code>未来已来</code></h3><h2 id=\"六、憧憬\"><a href=\"#六、憧憬\" class=\"headerlink\" title=\"六、憧憬\"></a>六、憧憬</h2><p>对于2020或者更遥远的未来，我也有一些憧憬</p>\n<ul>\n<li>去更多地方旅游</li>\n<li>拍更多好看的照片和视频</li>\n<li>项目上线赚钱</li>\n<li>提升个人工作能力以及交往能力</li>\n</ul>\n<hr>\n<p><code>下面贴一些2019年自己认为拍的不错的照片作为结尾吧</code><br><img src=\"https://upload-images.jianshu.io/upload_images/1472037-5d133a242f415602.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"普吉岛\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-93225e93d64afe08.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"普吉岛\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-58552ba076d79037.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"普吉镇\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-d1a0b00721a2d462.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"普吉岛\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-7638161852d52755.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"普吉岛\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-130619996006a2ee.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"蜜月岛\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-b234c56608b9c92a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"清迈\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-fc3d568850f253cd.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"清迈\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-b9cd52ba5e6c9435.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"加班凌晨回家\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-b83567e8175b8884.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"百里山水画廊\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-4d65e8caeecacaf5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"纪念碑谷\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-358c3fc290088c41.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"纪念碑谷\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-7d855594b41759d1.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"纪念碑谷\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-c9afdec5905cd14c.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"首钢工业遗址\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-861adef451c8be7d.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"首钢工业遗址\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-0cdbf2d49e7bf809.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"首钢工业遗址\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-ecea7f62fca67f1a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"世界公园\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-969213d616cf89b5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"坡峰岭\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-72682673ed542738.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"坡峰岭\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-f79cd2cc48843dc2.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"坡峰岭\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-2d4061c49193650f.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"坡峰岭\"></p>\n","site":{"data":{}},"excerpt":"<p>看看这个标题，没错，这又是一篇年终总结，上一次写年终总结还是2017年，而2018年直接就跳过没有写。之前的业余时间的确是很多，现在我连休息时间也变少了，所以一年都很难产出一篇，前段时间闲了一点，才很艰难的挤出了一篇关于我对Python这门语言的理解。其实没有用文字记录下来，并不代表我这两年什么都没有做，相反，我经历了太多的事情，才让我连用文字记录的时间都没有了。那么接下来，我会用一整篇的篇幅来告诉大家，这两年，我都做了什么，学会了什么，完成了什么。</p>","more":"<p><code>——一名游戏行业程序员的生活记录</code></p>\n<h2 id=\"一、关于写书\"><a href=\"#一、关于写书\" class=\"headerlink\" title=\"一、关于写书\"></a>一、关于写书</h2><p>大概是从入职上家公司开始，我开始学着写作，因为工作中需要我去学习很多新的东西，而学会一个东西最好的方式就是把你学会的从头到尾都详细解释出来，所以我开始了写博客，我写的东西其实并不高深，都是基础知识的运用，甚至在文章中加过很多修辞，故弄玄虚，夸大其词，而实际上却是知识很基础的一部分内容，而这些恰恰是因为我最初开始写文章的时候，自己的基础并不扎实，而又想急于求成所造成的结果。</p>\n<p>2016年，我花了几乎一年的时间写了一本书《深度解析Java游戏服务器开发》，我的确是倾注了个人的大部分时间和精力，但是老实说，这本书的内容特别的华而不实，这也是我后来对我那本书的一个自我反省，甚至说我想在两年后的今天，去重写里面的内容。那本书一经推出后，我也看了网上的评论，收获了不少差评，里面确实有我的个人原因，本身基础不太扎实的我，以一种急于求成的姿态去写了这样一本书，用网友的评论来说，这本书的确是堆砌代码且无营养。</p>\n<p>后来第二年，也就是2017年，我又开始写第二本书《Cocos2d-JS游戏开发快速入门到实战》，总结第一本书的经验教训，在写第二本书的时候，我特别注重书里内容的图、文、代码相结合，内容可以不多，但一定要准确，精简，让读者能看懂。同样是一年的时间，我完成了我的第二本书，这本书从销量上来说，可能还不如第一本书，因为JS技术的普遍性以及用Cocos2d-JS来做游戏的普遍性相对Java的使用普遍性来说要少很多，不过对我个人来说，第二本书是我结合了上一本书的经验教训写出来内容更加优质的书，写书的收入并不多，也就小一万块钱，但对于我个人的意义真的是不一样的，单从写书这件事情来说，就是对我个人意志力的一个巨大的挑战，你要牺牲近半年的休息时间用来写书，写案例，写示例代码，保证所有的代码都是可运行的。好在最后结果还不错，虽然销量可能并不高，但我看到网上的评论里大部分是好评，甚至有大学生或者刚毕业的开始工作的人私信我，问我一些职业发展上的问题，那个时候我就在想，我可能并不能给你们什么有用的建议，但我的书只要可以让一个人开始对游戏开发感兴趣，那我就是成功了。</p>\n<h3 id=\"果然，坚持与认真，是做成一件事情最重要的品质。\"><a href=\"#果然，坚持与认真，是做成一件事情最重要的品质。\" class=\"headerlink\" title=\"果然，坚持与认真，是做成一件事情最重要的品质。\"></a><code>果然，坚持与认真，是做成一件事情最重要的品质。</code></h3><h2 id=\"二、关于工作\"><a href=\"#二、关于工作\" class=\"headerlink\" title=\"二、关于工作\"></a>二、关于工作</h2><p>从写完第二本书之后，我几乎停止了写作，因为在2017年初入职了我现在这家公司后，我的业余时间大大减少，那个时间点，游戏行业面临寒冬，版号开始限制，审查开始严格，大批量的不合格游戏需要整顿，当然，从宏观上来看，这是对游戏行业的规范的合理化，但最后落在我们每一个游戏行业的螺丝钉——程序员来说，可能就是加班以及赶工。从长远来看，加班并不影响我们做一件事情的热情，如果我正在做的是一件成功率很高的产品来说，加班赶工把它做好的意义，要远大于优哉游哉混日子的意义。对于我所在的项目组来说，我们所做的产品，在我看来也确实是有希望做成的，所以我选择了留在这里，并且到现在为止，已经做了快三年了，在前几天第一次内测的情况来看，我们的游戏确实是有希望成为游戏界的一款爆款游戏，测试数据要远好于同行产品，也获得了玩家和媒体的一致好评。</p>\n<p>在游戏测试的当天，我们就看到B站已经有主播在开始直播了，跟着有不少玩家发弹幕和评论，从网上的评论来看，这款游戏的惊艳程度，远远超过了玩家的预期，虽然也有很多不足的地方，但从大部分玩家来看，都是对我们的游戏充满了期待，希望能快点优化并上线，不管怎么样，看到网上铺天盖地的好评，以及最后的测试数据来看，我们最近一两个月的连续加班都是有意义的，而测试的三天时间，我也亲自玩了我们游戏，从玩家的角度来说，我也是对这款游戏充满了期待。</p>\n<p><code>测试结束后的玩家一个宣传视频</code><br><a href=\"https://www.bilibili.com/video/av79947489]\">https://www.bilibili.com/video/av79947489]</a>(<a href=\"https://www.bilibili.com/video/\">https://www.bilibili.com/video/</a></p>\n<p>从整个项目来说，它在朝一款创新的类主机体验的ACT游戏发展，并且是一款有很大几率能做成的产品。从我个人成长来说，我也非常有幸从项目初期就加入到这款游戏的开发，我的个人能力也快速的成长了起来，并且我的老大对我的成长很有帮助，大到为人处世，小到编码规范，都对我有很重要的影响，有人说，工作就是要跟对好的项目，和跟对好的领导，现在这两样我都有了。在这个项目组的这几年，是对我的职业发展最快的几年。得益于老大的照顾，我能了解到项目整体的技术结构，我经历过项目战斗的状态同步到帧同步的转变，参与过核心战斗的开发，写过部分功能的可扩展的底层框架代码，对接过项目上线部署更新流程，也自己写过一些提高工作效率的工具。总的来说，参与这个项目，让我从头到尾都了解了一遍一款游戏的制作需要经历些什么，也让我的个人技术以及职业生涯成长了很多。虽然是游戏行业的新生代码农，但我也感觉我并没有走多少弯路，一直在正确的方向上，一直向前走。</p>\n<h3 id=\"在正确的方向上，摸索和成长。\"><a href=\"#在正确的方向上，摸索和成长。\" class=\"headerlink\" title=\"在正确的方向上，摸索和成长。\"></a><code>在正确的方向上，摸索和成长。</code></h3><h2 id=\"三、关于生活\"><a href=\"#三、关于生活\" class=\"headerlink\" title=\"三、关于生活\"></a>三、关于生活</h2><ul>\n<li>#####婚姻<br>2019年，我27岁了，不算大也不算小的年纪，这一年，我完成了人生的婚姻大事，实现了第一次的出国自由行，喜欢上了拍照和拍视频，也开始对人生产生思考，开始对生命和宇宙产生好奇。</li>\n</ul>\n<p>年初的时候，我完成了自己的人生大事，从那天之后，我可能就真的长成大人了，我需要对自己负责，也需要对新成立的小家负责。在婚后的一年时间里，其实我也没有太多不一样的感觉，我们还是很正常的生活，正常的工作，早上一起起床，一起洗漱，一起上班，晚上先后回家。有时候我加班很晚，她也会等到我回家，周末偶尔看看电影，做做饭，或者去稍远一点的郊区自驾游，拍拍照，这种感觉就像是，没有什么特别，没有什么不一样，但却有着陪伴的温暖，不可或缺。有个人和我一起在异地他乡赚钱生活，是一件很辛苦，却很幸福的事情。</p>\n<h3 id=\"生活，平平淡淡才是真。\"><a href=\"#生活，平平淡淡才是真。\" class=\"headerlink\" title=\"生活，平平淡淡才是真。\"></a><code>生活，平平淡淡才是真。</code></h3><p><img src=\"http://upload-images.jianshu.io/upload_images/1472037-d8986d58e1e1856f.jpg\" alt=\"结婚\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/1472037-2ea959c46cf7703d.jpg\" alt=\"结婚\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/1472037-adefcafc8ebf00cf.jpg\" alt=\"结婚\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/1472037-7104098758fc2ec6.jpg\" alt=\"结婚\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/1472037-4c7ec957ea7dca7d.jpg\" alt=\"结婚\"></p>\n<ul>\n<li>#####旅行<br>结婚之后，接着我又做了第二件人生的第一次尝试——出国旅游。请了长达12天的婚假（10天婚假连 一个周末），去了泰国的普吉和清迈，全程的签证、酒店、机票、景点路线以及各种注意事项，都是我和罗同学两个人研究的，并且全程下来，整个旅行的感受特别好，完全不同于各种购物旅游团，完全就是12天的度假休闲。休假的前的一个月，我们就开始研究这次旅行的所有攻略，并且制定了excel表格，规划好了所有的航班和酒店，并且计算了预计价格。<br><img src=\"https://upload-images.jianshu.io/upload_images/1472037-aba39822f01b225b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"行程安排\"><br>上网搜索我需要准备那些APP<br><img src=\"https://upload-images.jianshu.io/upload_images/1472037-eede58fc739732a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"APP\"><br>准备那些物品<br><img src=\"https://upload-images.jianshu.io/upload_images/1472037-a81f4f70c1fb0146.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"物品准备\"><br>甚至根据B站上那些旅游UP主的旅游视频规划了我出门旅拍都需要拍摄什么内容<br><img src=\"https://upload-images.jianshu.io/upload_images/1472037-985258b320fe60b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"VLOG设计\"></li>\n</ul>\n<p>最后在一款叫出发吧的APP上详细罗列了我们的行程，并且整个自由行过程都按照行程一步一步的走。<br><a href=\"http://chufaba.me/journals/1055821\">http://chufaba.me/journals/1055821</a></p>\n<p>整个旅程下来，12天时间，加上购物等所有的花销，我们一共是花费了两万六左右，人均一万三左右，在我看来，是一次性价比很高的旅行。与跟团旅行不同，我们的旅游路线完全是自己制定，甚至可以任性修改，而且我们每天都是八点多才起床，九点多才出门，如果突然发现今天计划的景点突然不感兴趣了，想去另外一个景点，也是可以突然更改的，只要整体进度在计划之内，就不会对整体行程有什么比较大的影响。</p>\n<p>在这次做了充足准备的泰国自由行中，我们也是度过了非常愉快的假期，拍了很多好看的照片和视频，包括泰国整个给我的印象也是一个非常开放的国度，大部分人的英语都特别好，很好交流，甚至在中国人密集的地方，小贩都能和你用中文聊天。这次去的两个地方分别有着不一样的风格，普吉岛的感觉是热情奔放，有热情的当地导游，有热闹的夜市小吃，有美丽的海岛风情，而清迈的感觉是悠然自得，阳光正好，心情舒适，能彻底放松身心。按照出行的规划的拍摄，我拍了很多视频片段，回来了精心挑选了一些片段以及音效音乐，剪成了一段小短片，也算是给我人生的第一次完全自己主导的出国自由行留下了一段美好的回忆。</p>\n<p>泰国蜜月旅行<br><a href=\"https://www.bilibili.com/video/av47155696\">https://www.bilibili.com/video/av47155696</a></p>\n<h3 id=\"如果有时间，一定要出去旅行，看看外面的世界有多精彩\"><a href=\"#如果有时间，一定要出去旅行，看看外面的世界有多精彩\" class=\"headerlink\" title=\"如果有时间，一定要出去旅行，看看外面的世界有多精彩\"></a><code>如果有时间，一定要出去旅行，看看外面的世界有多精彩</code></h3><ul>\n<li>#####摄影<br>说到拍照和拍视频，这也是我最近两年才突然学会的一项技能。大概是2015年的时候，罗同学不知道怎么回事，非要买一台相机，想学习拍照，后来不知道怎么的，相机就吃灰了，被搁置了，而近两年，我又不知道怎么回事，突然想要学习怎么拍照拍视频，尤其是今年，我经常会上B站去看看别人拍的照片和视频，学习前期拍摄技巧以及后期剪辑技术。就这样，一台四年前购买的Sony A7一代相机的使用率突然就高了起来，加上去年买了车，只要放假，就想要出去拍点好看的照片或者好看的视频，回家后期修图或者剪辑视频，而罗同学作为我的模特，也越来越喜欢让我给她拍照。慢慢的，摄影，也成了我除了打游戏以外的另一个爱好。</li>\n</ul>\n<p>不敢和各路大神相提并论，我喜欢摄影单纯只是想拍出美的照片，或者是剪辑一段好看的视频，每一次修照片或者剪视频，我都会觉得我之前拍的都是什么东西啊之类的想法，然后经常去看一些摄影UP主的视频去学习一些前期拍摄的技巧以及后期剪辑的技能。在我看来，时间不会停下来，但相机，可以留住一些珍贵的记忆。</p>\n<p>今年年底的时候，也就是前几天，我终于狠下心决定升级一下我的拍摄设备，购买了Sony A7M3相机，由于我拍罗同学比较多，所以我也买了适合拍人像的55mm1.8镜头和85mm1.8镜头，并打算把原来的A7一代卖掉，但挂闲鱼上却至今也没有人要。遗憾的是，我刚买完相机和镜头，公司项目就开始忙起来了，一直也没时间出去拍一点东西，最近两天才闲下来，打算在后边的几个周末出去拍一下，把我的新设备用起来。这个我新产生的爱好，也是我记录生活的一种方式。</p>\n<p>以下是一些我之前剪辑的视频：<br>百里山水画廊：<br><a href=\"https://www.bilibili.com/video/av70489540\">https://www.bilibili.com/video/av70489540</a><br>丰宁坝上草原两日游：<br><a href=\"https://www.bilibili.com/video/av60763262\">https://www.bilibili.com/video/av60763262</a><br>周末日常：<br><a href=\"https://www.bilibili.com/video/av60764806\">https://www.bilibili.com/video/av60764806</a><br>奥森公园：<br><a href=\"https://www.bilibili.com/video/av60764187\">https://www.bilibili.com/video/av60764187</a><br>世界公园：<br><a href=\"https://www.bilibili.com/video/av60763703\">https://www.bilibili.com/video/av60763703</a></p>\n<h3 id=\"摄影，是暂停时间最好的方式\"><a href=\"#摄影，是暂停时间最好的方式\" class=\"headerlink\" title=\"摄影，是暂停时间最好的方式\"></a><code>摄影，是暂停时间最好的方式</code></h3><h2 id=\"四、关于时间的猜想\"><a href=\"#四、关于时间的猜想\" class=\"headerlink\" title=\"四、关于时间的猜想\"></a>四、关于时间的猜想</h2><p>说到时间，我想起来之前在网上看到的一个小视频，里面有这样的一段话：“闭上眼睛想象，当你白发苍苍，七老八十的时候，你向上帝发问：神啊，能不能让我再活一次啊！上帝说，你闭上眼睛，然后时光倒流，这时候，睁开眼，你回到了现在，这一次，你打算怎么活？”。这是一个非常有意思的想象，从上帝视角来看，我其实是在进行我的第二次生命，并且命运如何我可以自己重新制定。视频的本意其实就是让我们把自己的命运掌握在自己手中。</p>\n<p>而我想到了另一个关于时间的猜想，我今年27岁，这27年来，除了父母和亲戚，身边的同学，朋友，同事，都是不断在变换，身边的人形形色色，人来人往。如果12岁的我，能通过时间隧道看到未来的我，也就是现在的我的话，他会怎么想，是感叹身边都是完全陌生的人吗？还是看到我写着自己完全看不懂的代码？还是过着自己完全想象不到的生活？如果换成是16岁的我，20岁的我呢？</p>\n<p>这不得不让我想到人们经常讨论的另一个问题，你真的活成了你所期望的样子吗？6岁的时候，我对未来世界的幻想就是长大做一名宇航员，去宇宙旅游，去其他星球旅游。抬头仰望的那一片星空，就是我最遥远的梦。12岁的时候，我对未来世界的幻想就是去大城市里生活。电视新闻里的大都市，就是我最遥远的梦。16岁的时候，我对未来世界的幻想就是去上海工作和生活。中国的国际经济中心，就是我最遥远的梦，20岁的我，对未来世界的幻想就是有自己的房子。车子，工作和生活，稳定的生活，就是我最遥远的梦。梦想变得越来越实际，眼光却也变得越来越狭隘，甚至不如6岁的我，在那双明亮的眼睛里，有着一整片的星空，可生活却只能这样，稳定的生活远好过遥远的星空。27岁的我，有父母赞助首付的一套小房子，有一辆工作两年攒钱买的很便宜的车，有在外人看来还算过得去的工作，有陪伴我的媳妇儿，有目前看来还算稳定并且日渐变好的生活。</p>\n<p>但就如我前面所说的，如果是6岁的我，12岁的我，16岁的我，20岁的我，分别通过时间隧道看到他们未来的样子，是会感到喜悦，欣慰，开心，还是难过，失望，沮丧。这个问题的答案，或许也不是一定的，或许我没能去到心里向往的国际大都市生活和工作，但我却留在了中国的首都，或许我并不是登陆外太空星球的宇航员，但我却能写出构建人类未来的代码，或许我的经济并不是衣食无忧，但我却也能过得悠然自得。这样看来，或许6岁的我会对现在的我感到失望，12岁的我会对现在的我感到沮丧，但我相信16岁的我，20岁的我，并不会对这样的未来失望。曾经，我想去宇宙，去探索那些人类未知的东西，后来随着年龄的增长，可能我更喜欢的，是让自己的生活更加精彩。不能忘记抬头仰望星空，但也不能忘记脚踏实地走好每一步。</p>\n<p>每当我怀疑自己“我真的活成了自己想要的样子吗”的时候，我可能还会想起来曾经那双明亮的双眼里的那一片星空，但生活会马上把我拉回到现实，努力工作，努力生活，过好眼前的一切，珍惜眼前的一切，才是我的人生目标，在我身边的一切，不才是我的整片星空吗。</p>\n<h3 id=\"前进的时候，不要忘了仰望星空，仰望星空的时候，也别忘了脚踏实地\"><a href=\"#前进的时候，不要忘了仰望星空，仰望星空的时候，也别忘了脚踏实地\" class=\"headerlink\" title=\"前进的时候，不要忘了仰望星空，仰望星空的时候，也别忘了脚踏实地\"></a><code>前进的时候，不要忘了仰望星空，仰望星空的时候，也别忘了脚踏实地</code></h3><h2 id=\"五、我的2019\"><a href=\"#五、我的2019\" class=\"headerlink\" title=\"五、我的2019\"></a>五、我的2019</h2><p>2020年，是以前大部分科幻世界里存在的年份，2020年，有机器人，有人工智能，有足不出户了解天下事。不管科幻世界里的描述是否都成为现实，当它真正到来的时候，我们才感慨到，时间过得真的很快。2019，我过得还算不错，很顺利，2020年，未来，继续加油！</p>\n<h3 id=\"未来已来\"><a href=\"#未来已来\" class=\"headerlink\" title=\"未来已来\"></a><code>未来已来</code></h3><h2 id=\"六、憧憬\"><a href=\"#六、憧憬\" class=\"headerlink\" title=\"六、憧憬\"></a>六、憧憬</h2><p>对于2020或者更遥远的未来，我也有一些憧憬</p>\n<ul>\n<li>去更多地方旅游</li>\n<li>拍更多好看的照片和视频</li>\n<li>项目上线赚钱</li>\n<li>提升个人工作能力以及交往能力</li>\n</ul>\n<hr>\n<p><code>下面贴一些2019年自己认为拍的不错的照片作为结尾吧</code><br><img src=\"https://upload-images.jianshu.io/upload_images/1472037-5d133a242f415602.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"普吉岛\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-93225e93d64afe08.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"普吉岛\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-58552ba076d79037.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"普吉镇\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-d1a0b00721a2d462.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"普吉岛\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-7638161852d52755.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"普吉岛\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-130619996006a2ee.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"蜜月岛\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-b234c56608b9c92a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"清迈\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-fc3d568850f253cd.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"清迈\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-b9cd52ba5e6c9435.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"加班凌晨回家\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-b83567e8175b8884.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"百里山水画廊\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-4d65e8caeecacaf5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"纪念碑谷\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-358c3fc290088c41.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"纪念碑谷\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-7d855594b41759d1.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"纪念碑谷\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-c9afdec5905cd14c.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"首钢工业遗址\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-861adef451c8be7d.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"首钢工业遗址\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-0cdbf2d49e7bf809.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"首钢工业遗址\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-ecea7f62fca67f1a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"世界公园\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-969213d616cf89b5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"坡峰岭\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-72682673ed542738.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"坡峰岭\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-f79cd2cc48843dc2.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"坡峰岭\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/1472037-2d4061c49193650f.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"坡峰岭\"></p>"},{"title":"Cocos2d-JS实现的打飞机","date":"2016-07-10T10:17:00.000Z","_content":"### 前言\n今天我们来讲一个最最最常见的一个小游戏——打飞机！是的，打飞机！还记得小时候在玩儿的雷电，应该是打飞机最早的样子了吧。直到现在，也有微信打飞机，全民飞机大战，全民打飞机等游戏的出现，这些游戏基本都是在我们小时候玩儿的打飞机的原型上增加特效音效以及更多新的玩儿法，在这基础上进行的创新。<!--more-->其实作为开发者来说，仔细看这款游戏，也并不是什么高大上的游戏，其他很多元素、逻辑，都是我们常见的，比如滚动背景，定时产生敌人等。真正开发一款打飞机游戏，其实只要一天就够了，但这个游戏的经典玩法却是很难超越的，在这里，我不得不向这款游戏的原创致敬。\n### 游戏分析\n游戏中的元素基本可以确定，有玩家，三种敌机，两种道具，子弹和滚动的背景。而游戏的场景，也就是开始场景，游戏场景，帮助场景（这个都是可有可无的），暂停场景和结束场景。游戏中的逻辑其实也很简单，无非就是灵活运用定时器，定时产生敌人，定时产生子弹，定时产生道具，再然后就是玩家与道具，玩家与敌人，子弹与敌人的碰撞检测。我们可以把以上提到的元素全部抽象成类，每个类封装自己的实现接口，在游戏场景中调用相应类的对应的方法即可。\n### 游戏实现\n#### 全局类\n游戏中所有用到的常量都可以放在一个全局类中，在实际开发中可根据需求动态修改，也方便管理维护。\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar Global = {\n    // 子弹移动速度\n    bulletSpeed:10,\n    // 敌机移动速度\n    enemySpeed:function(type){\n        switch(type){\n            case 1:\n                return 5;\n            break;\n            case 2:\n                return 3;\n            break;\n            case 3:\n                return 2;\n            break;\n        };\n    },\n    // 敌机创造速度\n    createEnemySpeed:function(type){\n        switch(type){\n            case 1:\n                return 1;\n            break;\n            case 2:\n                return 3;\n            break;\n            case 3:\n                return 5;\n            break;\n        };\n    },\n    // 敌机生命\n    enemyHp:function(type){\n        switch(type){\n            case 1:\n                return 1;\n            break;\n            case 2:\n                return 5;\n            break;\n            case 3:\n                return 10;\n            break;\n        };\n    },\n    // 道具移动速度\n    toolSpeed:function(type){\n        switch(type){\n            case 1:\n                return 2;\n            break;\n            case 2:\n                return 3;\n            break;\n        };\n    },\n    // 道具创造速度\n    createToolSpeed:function(type){\n        switch(type){\n            case 1:\n                return 30;\n            break;\n            case 2:\n                return 50;\n            break;\n        };\n    },\n    // 射击速度\n    shootSpeed:0.2,\n    // 双倍射击时长\n    doubleShootTimes:100\n};\n```\n#### 背景类\n游戏中用到的背景也可以提出来为一个背景类，游戏中的背景是滚动的，滚动背景的实现方式就是用两张相同的图片拼接起来，不断往下移动，当下面那张完全移出屏幕的时候，再将这张图片移动到前一张的上面，这样一直循环往复，就形成了不断滚动的背景。实现代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\n var Background = cc.Sprite.extend({\n     ctor: function (isOver) {\n        if(isOver){\n            this._super();\n            var bg = new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"gameover.png\"));\n            bg.setScale(750/480);\n            this.addChild(bg);\n        }else{\n            this._super();\n            this.setScale(750/480);\n            // 滚动背景图1\n            var menuBg1 = new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"background.png\"));\n            menuBg1.setPosition(cc.winSize.width / 2, cc.winSize.height / 2);\n            menuBg1.setScale(750 / 480);\n            menuBg1.setTag(1);\n            this.addChild(menuBg1);\n            // 滚动背景图2\n            var menuBg2 = new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"background.png\"));\n            menuBg2.setPosition(cc.winSize.width / 2, cc.winSize.height / 2 + cc.winSize.height - 4);\n            menuBg2.setScale(750 / 480);\n            menuBg2.setTag(2);\n            this.addChild(menuBg2);\n            this.schedule(this.update);\n        }\n        return true;\n     },\n     stopMove:function(){\n        this.unschedule(this.update);\n     },\n     update: function () {\n         var menuBg1 = this.getChildByTag(1);\n         var menuBg2 = this.getChildByTag(2);\n         if (menuBg1.getPositionY() <= -cc.winSize.height / 2 + 20) {\n             menuBg1.setPositionY(cc.winSize.height / 2 + cc.winSize.height);\n         } else {\n             menuBg1.setPositionY(menuBg1.getPositionY() - 1);\n         }\n         if (menuBg2.getPositionY() <= -cc.winSize.height / 2 + 20) {\n             menuBg2.setPositionY(cc.winSize.height / 2 + cc.winSize.height);\n         } else {\n             menuBg2.setPositionY(menuBg2.getPositionY() - 1);\n         }\n     }\n });\n```\n#### 子弹类\n玩家不断发出子弹，子弹类需要包含移动和移除两个方法，子弹一旦被创建，就按照一个轨迹移动，直到碰撞到敌机或飞出屏幕才移除子弹，碰撞检测在游戏场景中实现，碰撞之后调用子弹类的移除方法。\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar Bullet = cc.Sprite.extend({\n    gameLayer:null,\n    ctor: function (type,isUp,gameLayer) {\n        this.gameLayer = gameLayer;\n        this._super(cc.spriteFrameCache.getSpriteFrame(\"bullet\"+type+\".png\"));\n        if(isUp){\n            this.schedule(this.moveUp);\n        }else{\n            this.schedule(this.moveDown);\n        }\n        return true;\n    },\n    moveUp:function(){\n        this.setPositionY(this.getPositionY() + Global.bulletSpeed);\n        if(this.getPositionY()>=cc.winSize.height+this.height/2){\n            // 飞出屏幕删除\n            this.remove();\n        }\n    },\n    moveDown:function(){\n        this.setPositionY(this.getPositionY() - Global.bulletSpeed);\n        if(this.getPositionY()<=-this.height/2){\n            // 飞出屏幕删除\n            this.remove();\n        }\n    },\n    remove:function(){\n        var index = this.gameLayer.bullets.indexOf(this);  \n        if (index > -1) {  \n            this.gameLayer.bullets.splice(index, 1);  \n        }\n        this.removeFromParent();\n    }\n});\n```\n#### 玩家类\n游戏中的主角就是玩家类，玩家控制玩家类在屏幕中移动飞行，并不断射击子弹，玩家类中包含单行子弹射击和吃完道具之后的双行子弹射击两个方法，玩家还有移动方法，飞入屏幕方法和爆炸方法。同时飞机重复播放飞行动画。\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar Player = cc.Sprite.extend({\n    lock:true,\n    gameLayer:null,\n    doubleCount:0,\n    ctor: function (gameLayer) {\n        this._super(cc.spriteFrameCache.getSpriteFrame(\"hero1.png\"));\n        this.gameLayer = gameLayer;\n        this.doubleCount = 0;\n        this.lock = true;\n        // 飞行动画\n        var heroHoldFrames = [\n            cc.spriteFrameCache.getSpriteFrame(\"hero1.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"hero2.png\")\n        ];\n        var holdAnimation = new cc.Animation(heroHoldFrames, 0.1);\n        this.runAction(cc.repeatForever(cc.animate(holdAnimation)));\n        this.moveIn();\n        this.schedule(this.shootSingleBullet,Global.shootSpeed);\n        return true;\n    },\n    shootSingleBullet:function(){\n        if (!this.lock) {\n            var bullet = new Bullet(2,true,this.gameLayer);\n            bullet.setPosition(this.getPositionX(),this.getPositionY()+this.height/2);\n            this.gameLayer.addChild(bullet);\n            this.gameLayer.bullets.push(bullet);\n            // 发射子弹音效\n            cc.audioEngine.playEffect(\"res/sound/bullet.mp3\");\n        }\n    },\n    shootDoubleBegin:function(){\n        this.unschedule(this.shootSingleBullet);\n        this.schedule(this.shootDoubleBullet,Global.shootSpeed-0.1);\n        this.doubleCount = 0;\n    },\n    shootDoubleBullet:function(){\n        if (!this.lock) {\n            if(this.doubleCount>=Global.doubleShootTimes){\n                this.unschedule(this.shootDoubleBullet);\n                this.schedule(this.shootSingleBullet,Global.shootSpeed);\n            }else{\n                this.doubleCount += 1;\n                var bulletLeft = new Bullet(2,true,this.gameLayer);\n                var bulletRight = new Bullet(2,true,this.gameLayer);\n                bulletLeft.setPosition(this.getPositionX()-35,this.getPositionY()+5);\n                bulletRight.setPosition(this.getPositionX()+35,this.getPositionY()+5);\n                this.gameLayer.addChild(bulletLeft);\n                this.gameLayer.addChild(bulletRight);\n                this.gameLayer.bullets.push(bulletLeft);\n                this.gameLayer.bullets.push(bulletRight);\n                // 发射子弹音效\n                cc.audioEngine.playEffect(\"res/sound/bullet.mp3\");\n            }\n        }\n    },\n    moveIn:function(){\n        this.runAction(cc.sequence(\n            cc.moveTo(1, cc.p(cc.winSize.width/2, cc.winSize.height/2)),\n            cc.moveBy(2, cc.p(0, -400)),\n            cc.callFunc(function(player){\n                // 播完动画解锁操作\n                player.lock = false;\n            },this,this)\n        ));\n    },\n    moveBy:function(x,y) {\n        if (!this.lock) {\n            this.setPosition(this.getPositionX() + x, this.getPositionY() + y);\n        }\n    },\n    blowUp:function(){\n        this.lock = true;\n        // 爆炸动画\n        var blowUpFrames = [\n            cc.spriteFrameCache.getSpriteFrame(\"hero_blowup_n1.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"hero_blowup_n2.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"hero_blowup_n3.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"hero_blowup_n4.png\")\n        ];\n        var blowUpAnimation = new cc.Animation(blowUpFrames, 0.1);\n        this.stopAllActions();\n        this.runAction(cc.sequence(cc.animate(blowUpAnimation),cc.callFunc(function(hero){\n            hero.removeFromParent();\n        },this,this)));\n    }\n});\n```\n#### 敌机类\n敌机分为三种，小型飞机，中型飞机和大型飞机，三种飞机的血量，速度都不相同，其中，大型飞机还能在每三秒创建三个小型飞机。敌机同样包含移动，击中和爆炸方法。\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar Enemy = cc.Sprite.extend({\n    type:1,\n    hp:0,\n    gameLayer:null,\n    ctor: function (type,gameLayer) {\n        this.type = type;\n        this.hp = Global.enemyHp(type);\n        this.gameLayer = gameLayer;\n        if(type==3){\n            // 大型飞机的动画\n            this._super(cc.spriteFrameCache.getSpriteFrame(\"enemy\"+type+\"_n1.png\"));\n            var holdFrames = [\n                cc.spriteFrameCache.getSpriteFrame(\"enemy\"+type+\"_n1.png\"),\n                cc.spriteFrameCache.getSpriteFrame(\"enemy\"+type+\"_n2.png\")\n            ];\n            var holdAnimation = new cc.Animation(holdFrames, 0.1);\n            this.runAction(cc.repeatForever(cc.animate(holdAnimation)));\n        }else{\n            this._super(cc.spriteFrameCache.getSpriteFrame(\"enemy\"+type+\".png\"));\n        }\n        this.schedule(this.moveDown);\n        if(this.type==3){\n            // 大飞机每3s产生3个小飞机\n            this.schedule(function(){\n                this.createEnemy();\n            },3);\n        }\n        return true;\n    },\n    // 创造三个小型飞机\n    createEnemy:function(){\n        var enemy1 = new Enemy(1,this.gameLayer);\n        var enemy2 = new Enemy(1,this.gameLayer);\n        var enemy3 = new Enemy(1,this.gameLayer);\n        var x1 = this.getPositionX()-this.width/2+enemy1.width/2;\n        var x2 = this.getPositionX();\n        var x3 = this.getPositionX()+this.width/2-enemy3.width/2;\n        enemy1.setPosition(x1,this.getPositionY());\n        enemy2.setPosition(x2,this.getPositionY());\n        enemy3.setPosition(x3,this.getPositionY());\n        this.gameLayer.addChild(enemy1);\n        this.gameLayer.addChild(enemy2);\n        this.gameLayer.addChild(enemy3);\n        this.gameLayer.enemies.push(enemy1);\n        this.gameLayer.enemies.push(enemy2);\n        this.gameLayer.enemies.push(enemy3);\n    },\n    moveDown:function(){\n        this.setPositionY(this.getPositionY() - parseInt(Global.enemySpeed(this.type)));\n        if(this.getPositionY()<=-this.height/2){\n            // 飞出屏幕删除\n            this.remove();\n        }\n    },\n    remove:function(){\n        var index = this.gameLayer.enemies.indexOf(this);  \n        if (index > -1) {  \n            this.gameLayer.enemies.splice(index, 1);  \n        }\n        this.removeFromParent();\n    },\n    // 击中\n    hit:function(){\n        // 击中动画\n        this.hp -= 1;\n        if(this.hp<=0){\n            this.blowUp();\n        }else{\n            var holdFrame = this.type==3?\"enemy\"+this.type+\"_n1.png\":\"enemy\"+this.type+\".png\";\n            var hitFrames = [\n                cc.spriteFrameCache.getSpriteFrame(holdFrame),\n                cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_hit.png\")\n            ];\n            var hitAnimation = new cc.Animation(hitFrames, 0.1);\n            this.runAction(cc.sequence(cc.animate(hitAnimation),cc.callFunc(function(enemy){\n                enemy.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(holdFrame));\n            },this)));\n        }\n    },\n    // 爆炸\n    blowUp:function(){\n        if(this.type==3){\n            // 大飞机爆炸产生3个小飞机\n            this.createEnemy();\n        }\n        this.unschedule(this.moveDown);\n        var index = this.gameLayer.enemies.indexOf(this);  \n        if (index > -1) {  \n            this.gameLayer.enemies.splice(index, 1);  \n        }\n        // 爆炸动画\n        var blowUpFrames = [\n            cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_down1.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_down2.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_down3.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_down4.png\")\n        ];\n        if(this.type==3){\n            blowUpFrames = blowUpFrames.concat([\n                cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_down5.png\"),\n                cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_down6.png\")\n            ]);\n        }\n        // 播放爆炸音效\n        if(this.type==3){\n            cc.audioEngine.playEffect(\"res/sound/enemy3_down.mp3\");\n        }else{\n            cc.audioEngine.playEffect(\"res/sound/enemy1_down.mp3\");\n        }\n        var blowUpAnimation = new cc.Animation(blowUpFrames, 0.1);\n        this.stopAllActions();\n        this.runAction(cc.sequence(cc.animate(blowUpAnimation),cc.callFunc(function(enemy){\n            enemy.removeFromParent();\n        },this,this)));\n        // 加分\n        this.gameLayer.addScore(this.type);\n    }\n});\n```\n#### 道具类\n游戏中会定时掉落道具，道具类包含向下移动方法，移除方法和旋转方法。道具与玩家的碰撞检测在游戏场景中实现。\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar Tool = cc.Sprite.extend({\n    gameLayer:null,\n    type:0,\n    ctor: function (type,gameLayer) {\n        this._super(cc.spriteFrameCache.getSpriteFrame(\"ufo\"+type+\".png\"));\n        this.type = type;\n        this.gameLayer = gameLayer;\n        // 旋转特效\n        this.rotate();\n        // 向下移动\n        this.schedule(this.moveDown);\n        return true;\n    },\n    moveDown:function(){\n        this.setPositionY(this.getPositionY()-Global.toolSpeed(this.type));\n        if(this.getPositionY()<=-this.height/2){\n            // 飞出屏幕删除\n            this.remove();\n        }\n    },\n    remove:function(){\n        var index = this.gameLayer.tools.indexOf(this);  \n        if (index > -1) {  \n            this.gameLayer.tools.splice(index, 1);  \n        }\n        this.runAction(cc.sequence(cc.scaleTo(0.1,0),cc.callFunc(function(tool){\n            tool.removeFromParent();\n        },this,this)));\n    },\n    rotate:function(){\n        var rotateAction = cc.repeatForever(cc.sequence(cc.rotateTo(1,30),cc.sequence(cc.rotateTo(1,-30))));\n        this.runAction(rotateAction);\n    }\n});\n```\n#### 载入类\n载入类只是在开始场景中的一个载入的循环播放的动画。\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar Loading = cc.Sprite.extend({\n    ctor: function () {\n        this._super(cc.spriteFrameCache.getSpriteFrame(\"game_loading1.png\"));\n        var loadingFrames = [\n            cc.spriteFrameCache.getSpriteFrame(\"game_loading1.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"game_loading2.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"game_loading3.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"game_loading4.png\")\n        ];\n        var loadingAnimation = new cc.Animation(loadingFrames, 0.5);\n        this.runAction(cc.repeatForever(cc.animate(loadingAnimation)));\n        return true;\n    }\n});\n```\n#### 开始场景\n开始场景是游戏的入口场景，进入之后首先进入开始场景，开始场景包含开始游戏按钮和帮助按钮，点击帮助按钮进入帮助场景，点击开始按钮进入游戏场景。开始场景还包含一个滚动的背景图和一个载入动画。\n开始场景的效果如下：\n![开始场景](http://7xnnwn.com1.z0.glb.clouddn.com/MenuScene.gif)\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar MenuLayer = cc.Layer.extend({\n    loadCount: 1,\n    ctor: function () {\n        this._super();\n        this.loadCount = 1;\n        // 加载plist\n        cc.spriteFrameCache.addSpriteFrames(res.shoot_background_plist);\n        // 添加背景图\n        var bg = new Background(false);\n        bg.setPosition(0,0);\n        this.addChild(bg);\n        // logo\n        var copyright = new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"shoot_copyright.png\"));\n        copyright.setPosition(cc.winSize.width / 2, cc.winSize.height / 2 + 270);\n        copyright.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(1, 1.5), cc.scaleTo(1, 1))));\n        this.addChild(copyright);\n        // 游戏按钮\n        var startBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/game_start.png\"),\n            new cc.Sprite(\"res/game_start_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.director.runScene(new cc.TransitionFade(1, new GameScene()));\n            }, this);\n        var helpBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/game_help.png\"),\n            new cc.Sprite(\"res/game_help_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.director.runScene(new cc.TransitionFade(1, new HelpScene()));\n            }, this);\n        helpBtn.setPositionY(startBtn.getPositionY() - startBtn.height / 2 - 100);\n        var menu = new cc.Menu(startBtn, helpBtn);\n        this.addChild(menu);\n        // loading动画\n        var loading = new Loading();\n        loading.setPosition(cc.winSize.width/2,200);\n        this.addChild(loading);\n        return true;\n    }\n});\n\nvar MenuScene = cc.Scene.extend({\n    onEnter: function () {\n        this._super();\n        var layer = new MenuLayer();\n        this.addChild(layer);\n    }\n});\n```\n#### 游戏场景\n从开始场景点击开始游戏按钮之后进入游戏场景，游戏场景包含所有的游戏逻辑，包括滚动背景，玩家，定时产生的敌机，定时产生的道具，玩家与敌机、敌机与子弹、以及玩家与道具的碰撞检测，玩家的移动操作，使用爆炸道具等。\n游戏开始之前有一个玩家飞入屏幕的动画，效果图如下：\n![玩家飞入](http://7xnnwn.com1.z0.glb.clouddn.com/MoveIn.gif)\n玩家飞入之后，就可以定时创建子弹、道具与敌机，游戏场景的效果图如下：\n![游戏场景](http://7xnnwn.com1.z0.glb.clouddn.com/GameScene.gif)\n掉落的道具有发射双排子弹和炸弹两种，双排子弹效果图如下：\n![双排子弹](http://7xnnwn.com1.z0.glb.clouddn.com/DoubleShoot.gif)\n拾取到炸弹道具会累加到左下角的计数中，点击炸弹就可以使用，炸弹可让屏幕中所有飞机全部爆炸，效果图如下：\n![炸弹](http://7xnnwn.com1.z0.glb.clouddn.com/Bomb.gif)\n游戏中的敌机，子弹以及道具，都用数组来存储，每一帧都要遍历数组来进行碰撞检测，但玩家与子弹碰撞，玩家与敌机碰撞，以及敌机与子弹碰撞时，调用相应的类的逻辑，代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar GameLayer = cc.Layer.extend({\n    touchStartX:0,\n    touchStartY:0,\n    bullets:[],\n    enemies:[],\n    tools:[],\n    ctor: function () {\n        this._super();\n        this.touchStartX = 0;\n        this.touchStartY = 0;\n        this.bullets = [];\n        this.enemies = [];\n        this.tools = [];\n        // 播放背景音乐\n        cc.audioEngine.playMusic(\"res/sound/game_music.mp3\",true);\n        // 加载plist\n        cc.spriteFrameCache.addSpriteFrames(res.shoot_background_plist);\n        cc.spriteFrameCache.addSpriteFrames(res.shoot_plist);\n        // 添加背景图\n        var bg = new Background(false);\n        bg.setPosition(0,0);\n        this.addChild(bg);\n        // 添加飞机\n        var player = new Player(this);\n        player.setPosition(cc.winSize.width / 2, -player.height / 2);\n        this.addChild(player);\n        player.setTag(1);\n        // 产生敌机\n        this.schedule(function(){\n            this.createEnemy(1);\n        },Global.createEnemySpeed(1));\n        this.schedule(function(){\n            this.createEnemy(2);\n        },Global.createEnemySpeed(2));\n        this.schedule(function(){\n            this.createEnemy(3);\n        },Global.createEnemySpeed(3));\n        // 产生道具\n        this.schedule(function(){\n            this.createTool(1);\n        },Global.createToolSpeed(1));\n        this.schedule(function(){\n            this.createTool(2);\n        },Global.createToolSpeed(2));\n        // 添加爆炸道具\n        var bombNor = new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"bomb.png\"));\n        var bombSelected = new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"bomb.png\"));\n        bombSelected.setPosition(-bombSelected.width/4,-bombSelected.height/4);\n        bombSelected.setScale(1.5);\n        var bombBtn = new cc.MenuItemSprite(\n            bombNor,\n            bombSelected,\n            function () {\n                var bombNum = this.getChildByTag(3);\n                if(parseInt(bombNum.getString().slice(1))==0){\n                    return;\n                }\n                // 全屏爆炸\n                var blowEnemy = [];\n                for(var i in this.enemies){\n                    var enemy = this.enemies[i];\n                    blowEnemy.push(enemy);\n                }\n                for(var j in blowEnemy){\n                    blowEnemy[j].blowUp();\n                }\n                // 数量减一\n                bombNum.setString(\"X\"+(parseInt(bombNum.getString().slice(1))-1));\n            }, this);\n        bombBtn.setPosition(50+bombBtn.width/2,50+bombBtn.height/2);\n        var bombMenu = new cc.Menu(bombBtn);\n        bombMenu.setPosition(0,0);\n        bombMenu.setAnchorPoint(0,0);\n        this.addChild(bombMenu);\n        // 爆炸道具数量\n        var bombNum = new cc.LabelBMFont(\"X2\",res.font);\n        bombNum.setAnchorPoint(0,0.5);\n        bombNum.setPosition(bombBtn.getPositionX()+bombBtn.width/2+50,bombBtn.getPositionY());\n        bombNum.setTag(3);\n        this.addChild(bombNum);\n        // 暂停开始按钮\n        var pauseBtn = new cc.MenuItemSprite(\n            new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"game_pause_nor.png\")),\n            new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"game_pause_pressed.png\")),\n            function () {\n                // 暂停音乐音效\n                cc.audioEngine.pauseAllEffects();\n                cc.audioEngine.pauseMusic();\n                pauseBtn.setEnabled(false);\n                cc.director.pause();\n                this.addChild(new PauseLayer(pauseBtn),10);\n            }, this);\n        var pauseMenu = new cc.Menu(pauseBtn);\n        pauseMenu.setPosition(20+pauseBtn.width/2,cc.winSize.height-pauseBtn.height/2-20);\n        pauseMenu.setAnchorPoint(0,0);\n        this.addChild(pauseMenu);\n        // 分数\n        var score = new cc.LabelBMFont(\"0\",res.font);\n        score.setAnchorPoint(0,0.5);\n        score.setPosition(pauseMenu.getPositionX()+pauseBtn.width/2+50,pauseMenu.getPositionY());\n        score.setTag(2);\n        this.addChild(score);\n        // 碰撞检测\n        this.schedule(this.collision);\n        return true;\n    },\n    collision:function(){\n        var bullets = this.bullets;\n        var enemies = this.enemies;\n        var tools = this.tools;\n        var score = parseInt(this.getChildByTag(2).getString());\n        for(var i in enemies){\n            var enemy = enemies[i];\n            // 检测是否与玩家碰撞\n            var player = this.getChildByTag(1);\n            if(cc.rectIntersectsRect(enemy.getBoundingBox(),player.getBoundingBox())){\n                // 游戏结束\n                this.unschedule(this.collision);\n                player.blowUp();\n                // 停止背景音乐\n                cc.audioEngine.stopMusic(\"res/sound/game_music.mp3\");\n                cc.audioEngine.playEffect(\"res/sound/game_over.mp3\");\n                this.scheduleOnce(function() {\n                    cc.director.runScene(new cc.TransitionFade(1,new OverScene(score)));\n                },2);\n            }\n            // 检测是否吃到道具\n            for(var m in tools){\n                var tool = tools[m];\n                if(cc.rectIntersectsRect(tool.getBoundingBox(),player.getBoundingBox())){\n                    switch(tool.type){\n                        case 1:\n                            // 双排子弹道具\n                            cc.audioEngine.playEffect(\"res/sound/get_double_laser.mp3\");\n                            player.shootDoubleBegin();\n                            break;\n                        case 2:\n                            // 清屏道具\n                            cc.audioEngine.playEffect(\"res/sound/get_bomb.mp3\");\n                            var bomb = this.getChildByTag(3);\n                            bomb.setString(\"X\"+(parseInt(bomb.getString().slice(1))+1));\n                            bomb.runAction(cc.sequence(cc.scaleTo(0.1,1.2),cc.scaleTo(0.1,1)));\n                            break;\n                    }                  \n                    tool.remove();\n                }\n            }\n            for(var j in bullets){\n                var bullet = bullets[j];\n                // 检测是否与子弹碰撞\n                if(cc.rectIntersectsRect(enemy.getBoundingBox(),bullet.getBoundingBox())){\n                    enemy.hit();\n                    bullet.remove();\n                }\n            }\n        }\n    },\n    addScore:function(type){\n        var score = this.getChildByTag(2);\n        var addScore = 0;\n        var curScore = parseInt(score.getString());\n        switch(type){\n            case 1:\n                addScore = 100 + Math.ceil(Math.random()*(curScore/1000));\n            break;\n            case 2:\n                addScore = 200 + Math.ceil(Math.random()*(curScore/1000));\n            break;\n            case 3:\n                addScore = 500 + Math.ceil(Math.random()*(curScore/1000));\n            break;\n        }\n        score.setString(curScore+addScore);\n    },\n    createEnemy:function(type){\n        var enemy = new Enemy(type,this);\n        var randomX = Math.random()*(cc.winSize.width-enemy.width/2-enemy.width/2)+enemy.width/2;\n        enemy.setPosition(randomX,cc.winSize.height+enemy.height/2);\n        this.addChild(enemy);\n        this.enemies.push(enemy);\n    },\n    createTool:function(type){\n        var tool = new Tool(type,this);\n        var randomX = Math.random()*(cc.winSize.width-tool.width/2-tool.width/2)+tool.width/2;\n        tool.setPosition(randomX,cc.winSize.height+tool.height/2);\n        this.addChild(tool);\n        this.tools.push(tool);\n    },\n    onEnter:function(){\n        this._super();\n        // 添加触摸事件\n        cc.eventManager.addListener({\n            event:cc.EventListener.TOUCH_ONE_BY_ONE,\n            swallowTouches:true,\n            onTouchBegan:this.touchbegan,\n            onTouchMoved:this.touchmoved,\n            onTouchEnded:this.touchended\n        },this);\n        return true;\n    },\n    touchbegan:function(touch,event){\n        event.getCurrentTarget().touchStartX = touch.getLocation().x;\n        event.getCurrentTarget().touchStartY = touch.getLocation().y;\n        return true;\n    },\n    touchmoved:function(touch,event){\n        var touchX = touch.getLocation().x;\n        var touchY = touch.getLocation().y;\n        var touchStartX = event.getCurrentTarget().touchStartX;\n        var touchStartY = event.getCurrentTarget().touchStartY;\n        var player = event.getCurrentTarget().getChildByTag(1);\n        if(player!=null){\n            player.moveBy(touchX-touchStartX,touchY-touchStartY);\n            event.getCurrentTarget().touchStartX = touchX;\n            event.getCurrentTarget().touchStartY = touchY;\n        }\n        return true;\n    },\n    touchended:function(touch,event){\n        return true;\n    }\n});\n\nvar GameScene = cc.Scene.extend({\n    onEnter: function () {\n        this._super();\n        var layer = new GameLayer();\n        this.addChild(layer);\n    }\n});\n```\n#### 暂停场景\n在游戏场景点击暂停按钮进入暂停场景，暂停场景实际上只是一个半透明的层盖在游戏场景上，进入暂停场景后游戏暂停，暂停场景包含继续按钮，结束按钮和重新开始按钮。\n暂停场景效果图如下：\n![暂停场景](http://7xnnwn.com1.z0.glb.clouddn.com/PauseMenu.gif)\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar PauseLayer=cc.LayerColor.extend({\n    ctor:function (pauseBtn) {\n        // 初始化为黑色\n        this._super(cc.color(0,0,0,100));\n        this.width = cc.winSize.width;\n        this.height = cc.winSize.height;\n        // 继续按钮\n        var resumeBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/game_continue.png\"),\n            new cc.Sprite(\"res/game_continue_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.audioEngine.resumeMusic();\n                cc.director.resume();\n                pauseBtn.setEnabled(true);\n                this.removeFromParent();\n            }, this);\n        resumeBtn.setPosition(0,100);\n        // 结束游戏按钮\n        var overBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/game_over.png\"),\n            new cc.Sprite(\"res/game_over_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.audioEngine.stopMusic(\"res/sound/game_music.mp3\");\n                cc.director.resume();\n                cc.director.runScene(new cc.TransitionFade(1, new MenuScene()));\n            }, this);\n        overBtn.setPosition(0,0);\n        // 重新开始按钮\n        var reagainBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/game_Reagain.png\"),\n            new cc.Sprite(\"res/game_Reagain_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.audioEngine.stopMusic(\"res/sound/game_music.mp3\");\n                cc.director.resume();\n                cc.director.runScene(new cc.TransitionFade(1, new GameScene()));\n            }, this);\n        reagainBtn.setPosition(0,-100);\n        var menu = new cc.Menu(resumeBtn,overBtn,reagainBtn);\n        this.addChild(menu);\n        return true;\n    }\n});\n```\n#### 结束场景\n在游戏场景中，如果在碰撞检测中检测到玩家与敌机碰撞，则游戏结束，游戏结束进入结束场景，结束场景包含玩家的最终分数，以及展示最高历史分数和保存最高历史分数。\n结束场景的效果如下：\n![结束场景](http://7xnnwn.com1.z0.glb.clouddn.com/OverScene.gif)\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar OverLayer=cc.Layer.extend({\n    ctor:function (score) {\n        this._super();\n        var bg = new Background(true);\n        bg.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        this.addChild(bg);\n        var highest = cc.sys.localStorage.getItem(\"highest\");\n        highest = highest==null?0:highest;\n        // 分数存储\n        if(parseInt(score)>parseInt(highest)){\n            cc.sys.localStorage.setItem(\"highest\" ,score);\n            highest = score;\n        }\n        // 历史最高分数\n        var highestFnt = new cc.LabelBMFont(highest.toString(),res.font);\n        highestFnt.setPosition(250,cc.winSize.height-highestFnt.height/2-75);\n        highestFnt.setAnchorPoint(0,0.5);\n        this.addChild(highestFnt);\n        // 分数显示\n        var scoreFnt = new cc.LabelBMFont(score,res.font);\n        scoreFnt.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        this.addChild(scoreFnt);\n        this.scheduleOnce(function(){\n            cc.audioEngine.playEffect(\"res/sound/out_porp.mp3\");\n            scoreFnt.runAction(cc.sequence(cc.scaleTo(0.2,1.5),cc.scaleTo(0.2,1)));\n        },1);\n        // 菜单按钮\n        var restartBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/btn_finish.png\"),\n            new cc.Sprite(\"res/btn_finish_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.director.runScene(new cc.TransitionFade(1, new MenuScene()));\n            }, this);\n        restartBtn.setPosition(scoreFnt.getPositionX(),scoreFnt.getPositionY()-scoreFnt.height/2-100);\n        var menu = new cc.Menu(restartBtn);\n        menu.setPosition(0,0);\n        menu.setAnchorPoint(0,0);\n        this.addChild(menu);\n        return true;\n    }\n});\n\nvar OverScene=cc.Scene.extend({\n    ctor:function(score){\n        this._super();\n        var layer=new OverLayer(score);\n        this.addChild(layer);\n    }\n});\n```\n#### 帮助场景\n帮助场景就是一个展示游戏帮助提示的场景，其实只有文字和返回游戏按钮。\n帮助场景的效果如下：\n![帮助场景](http://7xnnwn.com1.z0.glb.clouddn.com/HelpScene.gif)\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar OverLayer=cc.Layer.extend({\n    ctor:function (score) {\n        this._super();\n        var bg = new Background(true);\n        bg.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        this.addChild(bg);\n        var highest = cc.sys.localStorage.getItem(\"highest\");\n        highest = highest==null?0:highest;\n        // 分数存储\n        if(parseInt(score)>parseInt(highest)){\n            cc.sys.localStorage.setItem(\"highest\" ,score);\n            highest = score;\n        }\n        // 历史最高分数\n        var highestFnt = new cc.LabelBMFont(highest.toString(),res.font);\n        highestFnt.setPosition(250,cc.winSize.height-highestFnt.height/2-75);\n        highestFnt.setAnchorPoint(0,0.5);\n        this.addChild(highestFnt);\n        // 分数显示\n        var scoreFnt = new cc.LabelBMFont(score,res.font);\n        scoreFnt.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        this.addChild(scoreFnt);\n        this.scheduleOnce(function(){\n            cc.audioEngine.playEffect(\"res/sound/out_porp.mp3\");\n            scoreFnt.runAction(cc.sequence(cc.scaleTo(0.2,1.5),cc.scaleTo(0.2,1)));\n        },1);\n        // 菜单按钮\n        var restartBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/btn_finish.png\"),\n            new cc.Sprite(\"res/btn_finish_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.director.runScene(new cc.TransitionFade(1, new MenuScene()));\n            }, this);\n        restartBtn.setPosition(scoreFnt.getPositionX(),scoreFnt.getPositionY()-scoreFnt.height/2-100);\n        var menu = new cc.Menu(restartBtn);\n        menu.setPosition(0,0);install\n        menu.setAnchorPoint(0,0);\n        this.addChild(menu);\n        return true;\n    }\n});\n\nvar OverScene=cc.Scene.extend({\n    ctor:function(score){\n        this._super();\n        var layer=new OverLayer(score);\n        this.addChild(layer);\n    }\n});\n```\n### 运行效果\n最后的运行效果如下\n![打飞机效果图](http://7xnnwn.com1.z0.glb.clouddn.com/Plane.gif)\n通过CVP平台的项目托管可看到实际运行效果，地址如下：\nhttp://www.cocoscvp.com/usercode/3d1775ea3aea1f12e986b7d8ebbb079fca12c064/\n### 源代码\n所有源代码均上传到github，欢迎交流学习，地址：\nhttps://github.com/hjcenry/plane\n\n- 原文博客：http://hjcenry.github.io","source":"_posts/Cocos2d-JS实现的打飞机.md","raw":"---\ntitle: Cocos2d-JS实现的打飞机\ndate: 2016-07-10 18:17\ncategories: cocos2d-js\ntags: [cocos2d-js,打飞机,cvp]\n---\n### 前言\n今天我们来讲一个最最最常见的一个小游戏——打飞机！是的，打飞机！还记得小时候在玩儿的雷电，应该是打飞机最早的样子了吧。直到现在，也有微信打飞机，全民飞机大战，全民打飞机等游戏的出现，这些游戏基本都是在我们小时候玩儿的打飞机的原型上增加特效音效以及更多新的玩儿法，在这基础上进行的创新。<!--more-->其实作为开发者来说，仔细看这款游戏，也并不是什么高大上的游戏，其他很多元素、逻辑，都是我们常见的，比如滚动背景，定时产生敌人等。真正开发一款打飞机游戏，其实只要一天就够了，但这个游戏的经典玩法却是很难超越的，在这里，我不得不向这款游戏的原创致敬。\n### 游戏分析\n游戏中的元素基本可以确定，有玩家，三种敌机，两种道具，子弹和滚动的背景。而游戏的场景，也就是开始场景，游戏场景，帮助场景（这个都是可有可无的），暂停场景和结束场景。游戏中的逻辑其实也很简单，无非就是灵活运用定时器，定时产生敌人，定时产生子弹，定时产生道具，再然后就是玩家与道具，玩家与敌人，子弹与敌人的碰撞检测。我们可以把以上提到的元素全部抽象成类，每个类封装自己的实现接口，在游戏场景中调用相应类的对应的方法即可。\n### 游戏实现\n#### 全局类\n游戏中所有用到的常量都可以放在一个全局类中，在实际开发中可根据需求动态修改，也方便管理维护。\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar Global = {\n    // 子弹移动速度\n    bulletSpeed:10,\n    // 敌机移动速度\n    enemySpeed:function(type){\n        switch(type){\n            case 1:\n                return 5;\n            break;\n            case 2:\n                return 3;\n            break;\n            case 3:\n                return 2;\n            break;\n        };\n    },\n    // 敌机创造速度\n    createEnemySpeed:function(type){\n        switch(type){\n            case 1:\n                return 1;\n            break;\n            case 2:\n                return 3;\n            break;\n            case 3:\n                return 5;\n            break;\n        };\n    },\n    // 敌机生命\n    enemyHp:function(type){\n        switch(type){\n            case 1:\n                return 1;\n            break;\n            case 2:\n                return 5;\n            break;\n            case 3:\n                return 10;\n            break;\n        };\n    },\n    // 道具移动速度\n    toolSpeed:function(type){\n        switch(type){\n            case 1:\n                return 2;\n            break;\n            case 2:\n                return 3;\n            break;\n        };\n    },\n    // 道具创造速度\n    createToolSpeed:function(type){\n        switch(type){\n            case 1:\n                return 30;\n            break;\n            case 2:\n                return 50;\n            break;\n        };\n    },\n    // 射击速度\n    shootSpeed:0.2,\n    // 双倍射击时长\n    doubleShootTimes:100\n};\n```\n#### 背景类\n游戏中用到的背景也可以提出来为一个背景类，游戏中的背景是滚动的，滚动背景的实现方式就是用两张相同的图片拼接起来，不断往下移动，当下面那张完全移出屏幕的时候，再将这张图片移动到前一张的上面，这样一直循环往复，就形成了不断滚动的背景。实现代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\n var Background = cc.Sprite.extend({\n     ctor: function (isOver) {\n        if(isOver){\n            this._super();\n            var bg = new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"gameover.png\"));\n            bg.setScale(750/480);\n            this.addChild(bg);\n        }else{\n            this._super();\n            this.setScale(750/480);\n            // 滚动背景图1\n            var menuBg1 = new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"background.png\"));\n            menuBg1.setPosition(cc.winSize.width / 2, cc.winSize.height / 2);\n            menuBg1.setScale(750 / 480);\n            menuBg1.setTag(1);\n            this.addChild(menuBg1);\n            // 滚动背景图2\n            var menuBg2 = new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"background.png\"));\n            menuBg2.setPosition(cc.winSize.width / 2, cc.winSize.height / 2 + cc.winSize.height - 4);\n            menuBg2.setScale(750 / 480);\n            menuBg2.setTag(2);\n            this.addChild(menuBg2);\n            this.schedule(this.update);\n        }\n        return true;\n     },\n     stopMove:function(){\n        this.unschedule(this.update);\n     },\n     update: function () {\n         var menuBg1 = this.getChildByTag(1);\n         var menuBg2 = this.getChildByTag(2);\n         if (menuBg1.getPositionY() <= -cc.winSize.height / 2 + 20) {\n             menuBg1.setPositionY(cc.winSize.height / 2 + cc.winSize.height);\n         } else {\n             menuBg1.setPositionY(menuBg1.getPositionY() - 1);\n         }\n         if (menuBg2.getPositionY() <= -cc.winSize.height / 2 + 20) {\n             menuBg2.setPositionY(cc.winSize.height / 2 + cc.winSize.height);\n         } else {\n             menuBg2.setPositionY(menuBg2.getPositionY() - 1);\n         }\n     }\n });\n```\n#### 子弹类\n玩家不断发出子弹，子弹类需要包含移动和移除两个方法，子弹一旦被创建，就按照一个轨迹移动，直到碰撞到敌机或飞出屏幕才移除子弹，碰撞检测在游戏场景中实现，碰撞之后调用子弹类的移除方法。\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar Bullet = cc.Sprite.extend({\n    gameLayer:null,\n    ctor: function (type,isUp,gameLayer) {\n        this.gameLayer = gameLayer;\n        this._super(cc.spriteFrameCache.getSpriteFrame(\"bullet\"+type+\".png\"));\n        if(isUp){\n            this.schedule(this.moveUp);\n        }else{\n            this.schedule(this.moveDown);\n        }\n        return true;\n    },\n    moveUp:function(){\n        this.setPositionY(this.getPositionY() + Global.bulletSpeed);\n        if(this.getPositionY()>=cc.winSize.height+this.height/2){\n            // 飞出屏幕删除\n            this.remove();\n        }\n    },\n    moveDown:function(){\n        this.setPositionY(this.getPositionY() - Global.bulletSpeed);\n        if(this.getPositionY()<=-this.height/2){\n            // 飞出屏幕删除\n            this.remove();\n        }\n    },\n    remove:function(){\n        var index = this.gameLayer.bullets.indexOf(this);  \n        if (index > -1) {  \n            this.gameLayer.bullets.splice(index, 1);  \n        }\n        this.removeFromParent();\n    }\n});\n```\n#### 玩家类\n游戏中的主角就是玩家类，玩家控制玩家类在屏幕中移动飞行，并不断射击子弹，玩家类中包含单行子弹射击和吃完道具之后的双行子弹射击两个方法，玩家还有移动方法，飞入屏幕方法和爆炸方法。同时飞机重复播放飞行动画。\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar Player = cc.Sprite.extend({\n    lock:true,\n    gameLayer:null,\n    doubleCount:0,\n    ctor: function (gameLayer) {\n        this._super(cc.spriteFrameCache.getSpriteFrame(\"hero1.png\"));\n        this.gameLayer = gameLayer;\n        this.doubleCount = 0;\n        this.lock = true;\n        // 飞行动画\n        var heroHoldFrames = [\n            cc.spriteFrameCache.getSpriteFrame(\"hero1.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"hero2.png\")\n        ];\n        var holdAnimation = new cc.Animation(heroHoldFrames, 0.1);\n        this.runAction(cc.repeatForever(cc.animate(holdAnimation)));\n        this.moveIn();\n        this.schedule(this.shootSingleBullet,Global.shootSpeed);\n        return true;\n    },\n    shootSingleBullet:function(){\n        if (!this.lock) {\n            var bullet = new Bullet(2,true,this.gameLayer);\n            bullet.setPosition(this.getPositionX(),this.getPositionY()+this.height/2);\n            this.gameLayer.addChild(bullet);\n            this.gameLayer.bullets.push(bullet);\n            // 发射子弹音效\n            cc.audioEngine.playEffect(\"res/sound/bullet.mp3\");\n        }\n    },\n    shootDoubleBegin:function(){\n        this.unschedule(this.shootSingleBullet);\n        this.schedule(this.shootDoubleBullet,Global.shootSpeed-0.1);\n        this.doubleCount = 0;\n    },\n    shootDoubleBullet:function(){\n        if (!this.lock) {\n            if(this.doubleCount>=Global.doubleShootTimes){\n                this.unschedule(this.shootDoubleBullet);\n                this.schedule(this.shootSingleBullet,Global.shootSpeed);\n            }else{\n                this.doubleCount += 1;\n                var bulletLeft = new Bullet(2,true,this.gameLayer);\n                var bulletRight = new Bullet(2,true,this.gameLayer);\n                bulletLeft.setPosition(this.getPositionX()-35,this.getPositionY()+5);\n                bulletRight.setPosition(this.getPositionX()+35,this.getPositionY()+5);\n                this.gameLayer.addChild(bulletLeft);\n                this.gameLayer.addChild(bulletRight);\n                this.gameLayer.bullets.push(bulletLeft);\n                this.gameLayer.bullets.push(bulletRight);\n                // 发射子弹音效\n                cc.audioEngine.playEffect(\"res/sound/bullet.mp3\");\n            }\n        }\n    },\n    moveIn:function(){\n        this.runAction(cc.sequence(\n            cc.moveTo(1, cc.p(cc.winSize.width/2, cc.winSize.height/2)),\n            cc.moveBy(2, cc.p(0, -400)),\n            cc.callFunc(function(player){\n                // 播完动画解锁操作\n                player.lock = false;\n            },this,this)\n        ));\n    },\n    moveBy:function(x,y) {\n        if (!this.lock) {\n            this.setPosition(this.getPositionX() + x, this.getPositionY() + y);\n        }\n    },\n    blowUp:function(){\n        this.lock = true;\n        // 爆炸动画\n        var blowUpFrames = [\n            cc.spriteFrameCache.getSpriteFrame(\"hero_blowup_n1.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"hero_blowup_n2.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"hero_blowup_n3.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"hero_blowup_n4.png\")\n        ];\n        var blowUpAnimation = new cc.Animation(blowUpFrames, 0.1);\n        this.stopAllActions();\n        this.runAction(cc.sequence(cc.animate(blowUpAnimation),cc.callFunc(function(hero){\n            hero.removeFromParent();\n        },this,this)));\n    }\n});\n```\n#### 敌机类\n敌机分为三种，小型飞机，中型飞机和大型飞机，三种飞机的血量，速度都不相同，其中，大型飞机还能在每三秒创建三个小型飞机。敌机同样包含移动，击中和爆炸方法。\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar Enemy = cc.Sprite.extend({\n    type:1,\n    hp:0,\n    gameLayer:null,\n    ctor: function (type,gameLayer) {\n        this.type = type;\n        this.hp = Global.enemyHp(type);\n        this.gameLayer = gameLayer;\n        if(type==3){\n            // 大型飞机的动画\n            this._super(cc.spriteFrameCache.getSpriteFrame(\"enemy\"+type+\"_n1.png\"));\n            var holdFrames = [\n                cc.spriteFrameCache.getSpriteFrame(\"enemy\"+type+\"_n1.png\"),\n                cc.spriteFrameCache.getSpriteFrame(\"enemy\"+type+\"_n2.png\")\n            ];\n            var holdAnimation = new cc.Animation(holdFrames, 0.1);\n            this.runAction(cc.repeatForever(cc.animate(holdAnimation)));\n        }else{\n            this._super(cc.spriteFrameCache.getSpriteFrame(\"enemy\"+type+\".png\"));\n        }\n        this.schedule(this.moveDown);\n        if(this.type==3){\n            // 大飞机每3s产生3个小飞机\n            this.schedule(function(){\n                this.createEnemy();\n            },3);\n        }\n        return true;\n    },\n    // 创造三个小型飞机\n    createEnemy:function(){\n        var enemy1 = new Enemy(1,this.gameLayer);\n        var enemy2 = new Enemy(1,this.gameLayer);\n        var enemy3 = new Enemy(1,this.gameLayer);\n        var x1 = this.getPositionX()-this.width/2+enemy1.width/2;\n        var x2 = this.getPositionX();\n        var x3 = this.getPositionX()+this.width/2-enemy3.width/2;\n        enemy1.setPosition(x1,this.getPositionY());\n        enemy2.setPosition(x2,this.getPositionY());\n        enemy3.setPosition(x3,this.getPositionY());\n        this.gameLayer.addChild(enemy1);\n        this.gameLayer.addChild(enemy2);\n        this.gameLayer.addChild(enemy3);\n        this.gameLayer.enemies.push(enemy1);\n        this.gameLayer.enemies.push(enemy2);\n        this.gameLayer.enemies.push(enemy3);\n    },\n    moveDown:function(){\n        this.setPositionY(this.getPositionY() - parseInt(Global.enemySpeed(this.type)));\n        if(this.getPositionY()<=-this.height/2){\n            // 飞出屏幕删除\n            this.remove();\n        }\n    },\n    remove:function(){\n        var index = this.gameLayer.enemies.indexOf(this);  \n        if (index > -1) {  \n            this.gameLayer.enemies.splice(index, 1);  \n        }\n        this.removeFromParent();\n    },\n    // 击中\n    hit:function(){\n        // 击中动画\n        this.hp -= 1;\n        if(this.hp<=0){\n            this.blowUp();\n        }else{\n            var holdFrame = this.type==3?\"enemy\"+this.type+\"_n1.png\":\"enemy\"+this.type+\".png\";\n            var hitFrames = [\n                cc.spriteFrameCache.getSpriteFrame(holdFrame),\n                cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_hit.png\")\n            ];\n            var hitAnimation = new cc.Animation(hitFrames, 0.1);\n            this.runAction(cc.sequence(cc.animate(hitAnimation),cc.callFunc(function(enemy){\n                enemy.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(holdFrame));\n            },this)));\n        }\n    },\n    // 爆炸\n    blowUp:function(){\n        if(this.type==3){\n            // 大飞机爆炸产生3个小飞机\n            this.createEnemy();\n        }\n        this.unschedule(this.moveDown);\n        var index = this.gameLayer.enemies.indexOf(this);  \n        if (index > -1) {  \n            this.gameLayer.enemies.splice(index, 1);  \n        }\n        // 爆炸动画\n        var blowUpFrames = [\n            cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_down1.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_down2.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_down3.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_down4.png\")\n        ];\n        if(this.type==3){\n            blowUpFrames = blowUpFrames.concat([\n                cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_down5.png\"),\n                cc.spriteFrameCache.getSpriteFrame(\"enemy\"+this.type+\"_down6.png\")\n            ]);\n        }\n        // 播放爆炸音效\n        if(this.type==3){\n            cc.audioEngine.playEffect(\"res/sound/enemy3_down.mp3\");\n        }else{\n            cc.audioEngine.playEffect(\"res/sound/enemy1_down.mp3\");\n        }\n        var blowUpAnimation = new cc.Animation(blowUpFrames, 0.1);\n        this.stopAllActions();\n        this.runAction(cc.sequence(cc.animate(blowUpAnimation),cc.callFunc(function(enemy){\n            enemy.removeFromParent();\n        },this,this)));\n        // 加分\n        this.gameLayer.addScore(this.type);\n    }\n});\n```\n#### 道具类\n游戏中会定时掉落道具，道具类包含向下移动方法，移除方法和旋转方法。道具与玩家的碰撞检测在游戏场景中实现。\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar Tool = cc.Sprite.extend({\n    gameLayer:null,\n    type:0,\n    ctor: function (type,gameLayer) {\n        this._super(cc.spriteFrameCache.getSpriteFrame(\"ufo\"+type+\".png\"));\n        this.type = type;\n        this.gameLayer = gameLayer;\n        // 旋转特效\n        this.rotate();\n        // 向下移动\n        this.schedule(this.moveDown);\n        return true;\n    },\n    moveDown:function(){\n        this.setPositionY(this.getPositionY()-Global.toolSpeed(this.type));\n        if(this.getPositionY()<=-this.height/2){\n            // 飞出屏幕删除\n            this.remove();\n        }\n    },\n    remove:function(){\n        var index = this.gameLayer.tools.indexOf(this);  \n        if (index > -1) {  \n            this.gameLayer.tools.splice(index, 1);  \n        }\n        this.runAction(cc.sequence(cc.scaleTo(0.1,0),cc.callFunc(function(tool){\n            tool.removeFromParent();\n        },this,this)));\n    },\n    rotate:function(){\n        var rotateAction = cc.repeatForever(cc.sequence(cc.rotateTo(1,30),cc.sequence(cc.rotateTo(1,-30))));\n        this.runAction(rotateAction);\n    }\n});\n```\n#### 载入类\n载入类只是在开始场景中的一个载入的循环播放的动画。\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar Loading = cc.Sprite.extend({\n    ctor: function () {\n        this._super(cc.spriteFrameCache.getSpriteFrame(\"game_loading1.png\"));\n        var loadingFrames = [\n            cc.spriteFrameCache.getSpriteFrame(\"game_loading1.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"game_loading2.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"game_loading3.png\"),\n            cc.spriteFrameCache.getSpriteFrame(\"game_loading4.png\")\n        ];\n        var loadingAnimation = new cc.Animation(loadingFrames, 0.5);\n        this.runAction(cc.repeatForever(cc.animate(loadingAnimation)));\n        return true;\n    }\n});\n```\n#### 开始场景\n开始场景是游戏的入口场景，进入之后首先进入开始场景，开始场景包含开始游戏按钮和帮助按钮，点击帮助按钮进入帮助场景，点击开始按钮进入游戏场景。开始场景还包含一个滚动的背景图和一个载入动画。\n开始场景的效果如下：\n![开始场景](http://7xnnwn.com1.z0.glb.clouddn.com/MenuScene.gif)\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar MenuLayer = cc.Layer.extend({\n    loadCount: 1,\n    ctor: function () {\n        this._super();\n        this.loadCount = 1;\n        // 加载plist\n        cc.spriteFrameCache.addSpriteFrames(res.shoot_background_plist);\n        // 添加背景图\n        var bg = new Background(false);\n        bg.setPosition(0,0);\n        this.addChild(bg);\n        // logo\n        var copyright = new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"shoot_copyright.png\"));\n        copyright.setPosition(cc.winSize.width / 2, cc.winSize.height / 2 + 270);\n        copyright.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(1, 1.5), cc.scaleTo(1, 1))));\n        this.addChild(copyright);\n        // 游戏按钮\n        var startBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/game_start.png\"),\n            new cc.Sprite(\"res/game_start_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.director.runScene(new cc.TransitionFade(1, new GameScene()));\n            }, this);\n        var helpBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/game_help.png\"),\n            new cc.Sprite(\"res/game_help_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.director.runScene(new cc.TransitionFade(1, new HelpScene()));\n            }, this);\n        helpBtn.setPositionY(startBtn.getPositionY() - startBtn.height / 2 - 100);\n        var menu = new cc.Menu(startBtn, helpBtn);\n        this.addChild(menu);\n        // loading动画\n        var loading = new Loading();\n        loading.setPosition(cc.winSize.width/2,200);\n        this.addChild(loading);\n        return true;\n    }\n});\n\nvar MenuScene = cc.Scene.extend({\n    onEnter: function () {\n        this._super();\n        var layer = new MenuLayer();\n        this.addChild(layer);\n    }\n});\n```\n#### 游戏场景\n从开始场景点击开始游戏按钮之后进入游戏场景，游戏场景包含所有的游戏逻辑，包括滚动背景，玩家，定时产生的敌机，定时产生的道具，玩家与敌机、敌机与子弹、以及玩家与道具的碰撞检测，玩家的移动操作，使用爆炸道具等。\n游戏开始之前有一个玩家飞入屏幕的动画，效果图如下：\n![玩家飞入](http://7xnnwn.com1.z0.glb.clouddn.com/MoveIn.gif)\n玩家飞入之后，就可以定时创建子弹、道具与敌机，游戏场景的效果图如下：\n![游戏场景](http://7xnnwn.com1.z0.glb.clouddn.com/GameScene.gif)\n掉落的道具有发射双排子弹和炸弹两种，双排子弹效果图如下：\n![双排子弹](http://7xnnwn.com1.z0.glb.clouddn.com/DoubleShoot.gif)\n拾取到炸弹道具会累加到左下角的计数中，点击炸弹就可以使用，炸弹可让屏幕中所有飞机全部爆炸，效果图如下：\n![炸弹](http://7xnnwn.com1.z0.glb.clouddn.com/Bomb.gif)\n游戏中的敌机，子弹以及道具，都用数组来存储，每一帧都要遍历数组来进行碰撞检测，但玩家与子弹碰撞，玩家与敌机碰撞，以及敌机与子弹碰撞时，调用相应的类的逻辑，代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar GameLayer = cc.Layer.extend({\n    touchStartX:0,\n    touchStartY:0,\n    bullets:[],\n    enemies:[],\n    tools:[],\n    ctor: function () {\n        this._super();\n        this.touchStartX = 0;\n        this.touchStartY = 0;\n        this.bullets = [];\n        this.enemies = [];\n        this.tools = [];\n        // 播放背景音乐\n        cc.audioEngine.playMusic(\"res/sound/game_music.mp3\",true);\n        // 加载plist\n        cc.spriteFrameCache.addSpriteFrames(res.shoot_background_plist);\n        cc.spriteFrameCache.addSpriteFrames(res.shoot_plist);\n        // 添加背景图\n        var bg = new Background(false);\n        bg.setPosition(0,0);\n        this.addChild(bg);\n        // 添加飞机\n        var player = new Player(this);\n        player.setPosition(cc.winSize.width / 2, -player.height / 2);\n        this.addChild(player);\n        player.setTag(1);\n        // 产生敌机\n        this.schedule(function(){\n            this.createEnemy(1);\n        },Global.createEnemySpeed(1));\n        this.schedule(function(){\n            this.createEnemy(2);\n        },Global.createEnemySpeed(2));\n        this.schedule(function(){\n            this.createEnemy(3);\n        },Global.createEnemySpeed(3));\n        // 产生道具\n        this.schedule(function(){\n            this.createTool(1);\n        },Global.createToolSpeed(1));\n        this.schedule(function(){\n            this.createTool(2);\n        },Global.createToolSpeed(2));\n        // 添加爆炸道具\n        var bombNor = new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"bomb.png\"));\n        var bombSelected = new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"bomb.png\"));\n        bombSelected.setPosition(-bombSelected.width/4,-bombSelected.height/4);\n        bombSelected.setScale(1.5);\n        var bombBtn = new cc.MenuItemSprite(\n            bombNor,\n            bombSelected,\n            function () {\n                var bombNum = this.getChildByTag(3);\n                if(parseInt(bombNum.getString().slice(1))==0){\n                    return;\n                }\n                // 全屏爆炸\n                var blowEnemy = [];\n                for(var i in this.enemies){\n                    var enemy = this.enemies[i];\n                    blowEnemy.push(enemy);\n                }\n                for(var j in blowEnemy){\n                    blowEnemy[j].blowUp();\n                }\n                // 数量减一\n                bombNum.setString(\"X\"+(parseInt(bombNum.getString().slice(1))-1));\n            }, this);\n        bombBtn.setPosition(50+bombBtn.width/2,50+bombBtn.height/2);\n        var bombMenu = new cc.Menu(bombBtn);\n        bombMenu.setPosition(0,0);\n        bombMenu.setAnchorPoint(0,0);\n        this.addChild(bombMenu);\n        // 爆炸道具数量\n        var bombNum = new cc.LabelBMFont(\"X2\",res.font);\n        bombNum.setAnchorPoint(0,0.5);\n        bombNum.setPosition(bombBtn.getPositionX()+bombBtn.width/2+50,bombBtn.getPositionY());\n        bombNum.setTag(3);\n        this.addChild(bombNum);\n        // 暂停开始按钮\n        var pauseBtn = new cc.MenuItemSprite(\n            new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"game_pause_nor.png\")),\n            new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(\"game_pause_pressed.png\")),\n            function () {\n                // 暂停音乐音效\n                cc.audioEngine.pauseAllEffects();\n                cc.audioEngine.pauseMusic();\n                pauseBtn.setEnabled(false);\n                cc.director.pause();\n                this.addChild(new PauseLayer(pauseBtn),10);\n            }, this);\n        var pauseMenu = new cc.Menu(pauseBtn);\n        pauseMenu.setPosition(20+pauseBtn.width/2,cc.winSize.height-pauseBtn.height/2-20);\n        pauseMenu.setAnchorPoint(0,0);\n        this.addChild(pauseMenu);\n        // 分数\n        var score = new cc.LabelBMFont(\"0\",res.font);\n        score.setAnchorPoint(0,0.5);\n        score.setPosition(pauseMenu.getPositionX()+pauseBtn.width/2+50,pauseMenu.getPositionY());\n        score.setTag(2);\n        this.addChild(score);\n        // 碰撞检测\n        this.schedule(this.collision);\n        return true;\n    },\n    collision:function(){\n        var bullets = this.bullets;\n        var enemies = this.enemies;\n        var tools = this.tools;\n        var score = parseInt(this.getChildByTag(2).getString());\n        for(var i in enemies){\n            var enemy = enemies[i];\n            // 检测是否与玩家碰撞\n            var player = this.getChildByTag(1);\n            if(cc.rectIntersectsRect(enemy.getBoundingBox(),player.getBoundingBox())){\n                // 游戏结束\n                this.unschedule(this.collision);\n                player.blowUp();\n                // 停止背景音乐\n                cc.audioEngine.stopMusic(\"res/sound/game_music.mp3\");\n                cc.audioEngine.playEffect(\"res/sound/game_over.mp3\");\n                this.scheduleOnce(function() {\n                    cc.director.runScene(new cc.TransitionFade(1,new OverScene(score)));\n                },2);\n            }\n            // 检测是否吃到道具\n            for(var m in tools){\n                var tool = tools[m];\n                if(cc.rectIntersectsRect(tool.getBoundingBox(),player.getBoundingBox())){\n                    switch(tool.type){\n                        case 1:\n                            // 双排子弹道具\n                            cc.audioEngine.playEffect(\"res/sound/get_double_laser.mp3\");\n                            player.shootDoubleBegin();\n                            break;\n                        case 2:\n                            // 清屏道具\n                            cc.audioEngine.playEffect(\"res/sound/get_bomb.mp3\");\n                            var bomb = this.getChildByTag(3);\n                            bomb.setString(\"X\"+(parseInt(bomb.getString().slice(1))+1));\n                            bomb.runAction(cc.sequence(cc.scaleTo(0.1,1.2),cc.scaleTo(0.1,1)));\n                            break;\n                    }                  \n                    tool.remove();\n                }\n            }\n            for(var j in bullets){\n                var bullet = bullets[j];\n                // 检测是否与子弹碰撞\n                if(cc.rectIntersectsRect(enemy.getBoundingBox(),bullet.getBoundingBox())){\n                    enemy.hit();\n                    bullet.remove();\n                }\n            }\n        }\n    },\n    addScore:function(type){\n        var score = this.getChildByTag(2);\n        var addScore = 0;\n        var curScore = parseInt(score.getString());\n        switch(type){\n            case 1:\n                addScore = 100 + Math.ceil(Math.random()*(curScore/1000));\n            break;\n            case 2:\n                addScore = 200 + Math.ceil(Math.random()*(curScore/1000));\n            break;\n            case 3:\n                addScore = 500 + Math.ceil(Math.random()*(curScore/1000));\n            break;\n        }\n        score.setString(curScore+addScore);\n    },\n    createEnemy:function(type){\n        var enemy = new Enemy(type,this);\n        var randomX = Math.random()*(cc.winSize.width-enemy.width/2-enemy.width/2)+enemy.width/2;\n        enemy.setPosition(randomX,cc.winSize.height+enemy.height/2);\n        this.addChild(enemy);\n        this.enemies.push(enemy);\n    },\n    createTool:function(type){\n        var tool = new Tool(type,this);\n        var randomX = Math.random()*(cc.winSize.width-tool.width/2-tool.width/2)+tool.width/2;\n        tool.setPosition(randomX,cc.winSize.height+tool.height/2);\n        this.addChild(tool);\n        this.tools.push(tool);\n    },\n    onEnter:function(){\n        this._super();\n        // 添加触摸事件\n        cc.eventManager.addListener({\n            event:cc.EventListener.TOUCH_ONE_BY_ONE,\n            swallowTouches:true,\n            onTouchBegan:this.touchbegan,\n            onTouchMoved:this.touchmoved,\n            onTouchEnded:this.touchended\n        },this);\n        return true;\n    },\n    touchbegan:function(touch,event){\n        event.getCurrentTarget().touchStartX = touch.getLocation().x;\n        event.getCurrentTarget().touchStartY = touch.getLocation().y;\n        return true;\n    },\n    touchmoved:function(touch,event){\n        var touchX = touch.getLocation().x;\n        var touchY = touch.getLocation().y;\n        var touchStartX = event.getCurrentTarget().touchStartX;\n        var touchStartY = event.getCurrentTarget().touchStartY;\n        var player = event.getCurrentTarget().getChildByTag(1);\n        if(player!=null){\n            player.moveBy(touchX-touchStartX,touchY-touchStartY);\n            event.getCurrentTarget().touchStartX = touchX;\n            event.getCurrentTarget().touchStartY = touchY;\n        }\n        return true;\n    },\n    touchended:function(touch,event){\n        return true;\n    }\n});\n\nvar GameScene = cc.Scene.extend({\n    onEnter: function () {\n        this._super();\n        var layer = new GameLayer();\n        this.addChild(layer);\n    }\n});\n```\n#### 暂停场景\n在游戏场景点击暂停按钮进入暂停场景，暂停场景实际上只是一个半透明的层盖在游戏场景上，进入暂停场景后游戏暂停，暂停场景包含继续按钮，结束按钮和重新开始按钮。\n暂停场景效果图如下：\n![暂停场景](http://7xnnwn.com1.z0.glb.clouddn.com/PauseMenu.gif)\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar PauseLayer=cc.LayerColor.extend({\n    ctor:function (pauseBtn) {\n        // 初始化为黑色\n        this._super(cc.color(0,0,0,100));\n        this.width = cc.winSize.width;\n        this.height = cc.winSize.height;\n        // 继续按钮\n        var resumeBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/game_continue.png\"),\n            new cc.Sprite(\"res/game_continue_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.audioEngine.resumeMusic();\n                cc.director.resume();\n                pauseBtn.setEnabled(true);\n                this.removeFromParent();\n            }, this);\n        resumeBtn.setPosition(0,100);\n        // 结束游戏按钮\n        var overBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/game_over.png\"),\n            new cc.Sprite(\"res/game_over_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.audioEngine.stopMusic(\"res/sound/game_music.mp3\");\n                cc.director.resume();\n                cc.director.runScene(new cc.TransitionFade(1, new MenuScene()));\n            }, this);\n        overBtn.setPosition(0,0);\n        // 重新开始按钮\n        var reagainBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/game_Reagain.png\"),\n            new cc.Sprite(\"res/game_Reagain_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.audioEngine.stopMusic(\"res/sound/game_music.mp3\");\n                cc.director.resume();\n                cc.director.runScene(new cc.TransitionFade(1, new GameScene()));\n            }, this);\n        reagainBtn.setPosition(0,-100);\n        var menu = new cc.Menu(resumeBtn,overBtn,reagainBtn);\n        this.addChild(menu);\n        return true;\n    }\n});\n```\n#### 结束场景\n在游戏场景中，如果在碰撞检测中检测到玩家与敌机碰撞，则游戏结束，游戏结束进入结束场景，结束场景包含玩家的最终分数，以及展示最高历史分数和保存最高历史分数。\n结束场景的效果如下：\n![结束场景](http://7xnnwn.com1.z0.glb.clouddn.com/OverScene.gif)\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar OverLayer=cc.Layer.extend({\n    ctor:function (score) {\n        this._super();\n        var bg = new Background(true);\n        bg.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        this.addChild(bg);\n        var highest = cc.sys.localStorage.getItem(\"highest\");\n        highest = highest==null?0:highest;\n        // 分数存储\n        if(parseInt(score)>parseInt(highest)){\n            cc.sys.localStorage.setItem(\"highest\" ,score);\n            highest = score;\n        }\n        // 历史最高分数\n        var highestFnt = new cc.LabelBMFont(highest.toString(),res.font);\n        highestFnt.setPosition(250,cc.winSize.height-highestFnt.height/2-75);\n        highestFnt.setAnchorPoint(0,0.5);\n        this.addChild(highestFnt);\n        // 分数显示\n        var scoreFnt = new cc.LabelBMFont(score,res.font);\n        scoreFnt.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        this.addChild(scoreFnt);\n        this.scheduleOnce(function(){\n            cc.audioEngine.playEffect(\"res/sound/out_porp.mp3\");\n            scoreFnt.runAction(cc.sequence(cc.scaleTo(0.2,1.5),cc.scaleTo(0.2,1)));\n        },1);\n        // 菜单按钮\n        var restartBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/btn_finish.png\"),\n            new cc.Sprite(\"res/btn_finish_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.director.runScene(new cc.TransitionFade(1, new MenuScene()));\n            }, this);\n        restartBtn.setPosition(scoreFnt.getPositionX(),scoreFnt.getPositionY()-scoreFnt.height/2-100);\n        var menu = new cc.Menu(restartBtn);\n        menu.setPosition(0,0);\n        menu.setAnchorPoint(0,0);\n        this.addChild(menu);\n        return true;\n    }\n});\n\nvar OverScene=cc.Scene.extend({\n    ctor:function(score){\n        this._super();\n        var layer=new OverLayer(score);\n        this.addChild(layer);\n    }\n});\n```\n#### 帮助场景\n帮助场景就是一个展示游戏帮助提示的场景，其实只有文字和返回游戏按钮。\n帮助场景的效果如下：\n![帮助场景](http://7xnnwn.com1.z0.glb.clouddn.com/HelpScene.gif)\n代码如下：\n```javascript\n/**\n * Created by Henry on 16/7/6.\n */\nvar OverLayer=cc.Layer.extend({\n    ctor:function (score) {\n        this._super();\n        var bg = new Background(true);\n        bg.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        this.addChild(bg);\n        var highest = cc.sys.localStorage.getItem(\"highest\");\n        highest = highest==null?0:highest;\n        // 分数存储\n        if(parseInt(score)>parseInt(highest)){\n            cc.sys.localStorage.setItem(\"highest\" ,score);\n            highest = score;\n        }\n        // 历史最高分数\n        var highestFnt = new cc.LabelBMFont(highest.toString(),res.font);\n        highestFnt.setPosition(250,cc.winSize.height-highestFnt.height/2-75);\n        highestFnt.setAnchorPoint(0,0.5);\n        this.addChild(highestFnt);\n        // 分数显示\n        var scoreFnt = new cc.LabelBMFont(score,res.font);\n        scoreFnt.setPosition(cc.winSize.width/2,cc.winSize.height/2);\n        this.addChild(scoreFnt);\n        this.scheduleOnce(function(){\n            cc.audioEngine.playEffect(\"res/sound/out_porp.mp3\");\n            scoreFnt.runAction(cc.sequence(cc.scaleTo(0.2,1.5),cc.scaleTo(0.2,1)));\n        },1);\n        // 菜单按钮\n        var restartBtn = new cc.MenuItemSprite(\n            new cc.Sprite(\"res/btn_finish.png\"),\n            new cc.Sprite(\"res/btn_finish_selected.png\"),\n            function () {\n                cc.audioEngine.playEffect(\"res/sound/button.mp3\");\n                cc.director.runScene(new cc.TransitionFade(1, new MenuScene()));\n            }, this);\n        restartBtn.setPosition(scoreFnt.getPositionX(),scoreFnt.getPositionY()-scoreFnt.height/2-100);\n        var menu = new cc.Menu(restartBtn);\n        menu.setPosition(0,0);install\n        menu.setAnchorPoint(0,0);\n        this.addChild(menu);\n        return true;\n    }\n});\n\nvar OverScene=cc.Scene.extend({\n    ctor:function(score){\n        this._super();\n        var layer=new OverLayer(score);\n        this.addChild(layer);\n    }\n});\n```\n### 运行效果\n最后的运行效果如下\n![打飞机效果图](http://7xnnwn.com1.z0.glb.clouddn.com/Plane.gif)\n通过CVP平台的项目托管可看到实际运行效果，地址如下：\nhttp://www.cocoscvp.com/usercode/3d1775ea3aea1f12e986b7d8ebbb079fca12c064/\n### 源代码\n所有源代码均上传到github，欢迎交流学习，地址：\nhttps://github.com/hjcenry/plane\n\n- 原文博客：http://hjcenry.github.io","slug":"Cocos2d-JS实现的打飞机","published":1,"updated":"2016-07-10T12:56:50.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckflddhw2005qwsazffs0834w","content":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>今天我们来讲一个最最最常见的一个小游戏——打飞机！是的，打飞机！还记得小时候在玩儿的雷电，应该是打飞机最早的样子了吧。直到现在，也有微信打飞机，全民飞机大战，全民打飞机等游戏的出现，这些游戏基本都是在我们小时候玩儿的打飞机的原型上增加特效音效以及更多新的玩儿法，在这基础上进行的创新。<a id=\"more\"></a>其实作为开发者来说，仔细看这款游戏，也并不是什么高大上的游戏，其他很多元素、逻辑，都是我们常见的，比如滚动背景，定时产生敌人等。真正开发一款打飞机游戏，其实只要一天就够了，但这个游戏的经典玩法却是很难超越的，在这里，我不得不向这款游戏的原创致敬。</p>\n<h3 id=\"游戏分析\"><a href=\"#游戏分析\" class=\"headerlink\" title=\"游戏分析\"></a>游戏分析</h3><p>游戏中的元素基本可以确定，有玩家，三种敌机，两种道具，子弹和滚动的背景。而游戏的场景，也就是开始场景，游戏场景，帮助场景（这个都是可有可无的），暂停场景和结束场景。游戏中的逻辑其实也很简单，无非就是灵活运用定时器，定时产生敌人，定时产生子弹，定时产生道具，再然后就是玩家与道具，玩家与敌人，子弹与敌人的碰撞检测。我们可以把以上提到的元素全部抽象成类，每个类封装自己的实现接口，在游戏场景中调用相应类的对应的方法即可。</p>\n<h3 id=\"游戏实现\"><a href=\"#游戏实现\" class=\"headerlink\" title=\"游戏实现\"></a>游戏实现</h3><h4 id=\"全局类\"><a href=\"#全局类\" class=\"headerlink\" title=\"全局类\"></a>全局类</h4><p>游戏中所有用到的常量都可以放在一个全局类中，在实际开发中可根据需求动态修改，也方便管理维护。<br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Global = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 子弹移动速度</span></span><br><span class=\"line\">    bulletSpeed:<span class=\"number\">10</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 敌机移动速度</span></span><br><span class=\"line\">    enemySpeed:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 敌机创造速度</span></span><br><span class=\"line\">    createEnemySpeed:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 敌机生命</span></span><br><span class=\"line\">    enemyHp:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">10</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 道具移动速度</span></span><br><span class=\"line\">    toolSpeed:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 道具创造速度</span></span><br><span class=\"line\">    createToolSpeed:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">30</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">50</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 射击速度</span></span><br><span class=\"line\">    shootSpeed:<span class=\"number\">0.2</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 双倍射击时长</span></span><br><span class=\"line\">    doubleShootTimes:<span class=\"number\">100</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4 id=\"背景类\"><a href=\"#背景类\" class=\"headerlink\" title=\"背景类\"></a>背景类</h4><p>游戏中用到的背景也可以提出来为一个背景类，游戏中的背景是滚动的，滚动背景的实现方式就是用两张相同的图片拼接起来，不断往下移动，当下面那张完全移出屏幕的时候，再将这张图片移动到前一张的上面，这样一直循环往复，就形成了不断滚动的背景。实现代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"> <span class=\"keyword\">var</span> Background = cc.Sprite.extend(&#123;</span><br><span class=\"line\">     ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">isOver</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(isOver)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">            <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;gameover.png&quot;</span>));</span><br><span class=\"line\">            bg.setScale(<span class=\"number\">750</span>/<span class=\"number\">480</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.setScale(<span class=\"number\">750</span>/<span class=\"number\">480</span>);</span><br><span class=\"line\">            <span class=\"comment\">// 滚动背景图1</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> menuBg1 = <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;background.png&quot;</span>));</span><br><span class=\"line\">            menuBg1.setPosition(cc.winSize.width / <span class=\"number\">2</span>, cc.winSize.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">            menuBg1.setScale(<span class=\"number\">750</span> / <span class=\"number\">480</span>);</span><br><span class=\"line\">            menuBg1.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(menuBg1);</span><br><span class=\"line\">            <span class=\"comment\">// 滚动背景图2</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> menuBg2 = <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;background.png&quot;</span>));</span><br><span class=\"line\">            menuBg2.setPosition(cc.winSize.width / <span class=\"number\">2</span>, cc.winSize.height / <span class=\"number\">2</span> + cc.winSize.height - <span class=\"number\">4</span>);</span><br><span class=\"line\">            menuBg2.setScale(<span class=\"number\">750</span> / <span class=\"number\">480</span>);</span><br><span class=\"line\">            menuBg2.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(menuBg2);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.update);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">     &#125;,</span><br><span class=\"line\">     stopMove:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.update);</span><br><span class=\"line\">     &#125;,</span><br><span class=\"line\">     update: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">         <span class=\"keyword\">var</span> menuBg1 = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">         <span class=\"keyword\">var</span> menuBg2 = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (menuBg1.getPositionY() &lt;= -cc.winSize.height / <span class=\"number\">2</span> + <span class=\"number\">20</span>) &#123;</span><br><span class=\"line\">             menuBg1.setPositionY(cc.winSize.height / <span class=\"number\">2</span> + cc.winSize.height);</span><br><span class=\"line\">         &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">             menuBg1.setPositionY(menuBg1.getPositionY() - <span class=\"number\">1</span>);</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (menuBg2.getPositionY() &lt;= -cc.winSize.height / <span class=\"number\">2</span> + <span class=\"number\">20</span>) &#123;</span><br><span class=\"line\">             menuBg2.setPositionY(cc.winSize.height / <span class=\"number\">2</span> + cc.winSize.height);</span><br><span class=\"line\">         &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">             menuBg2.setPositionY(menuBg2.getPositionY() - <span class=\"number\">1</span>);</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"> &#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"子弹类\"><a href=\"#子弹类\" class=\"headerlink\" title=\"子弹类\"></a>子弹类</h4><p>玩家不断发出子弹，子弹类需要包含移动和移除两个方法，子弹一旦被创建，就按照一个轨迹移动，直到碰撞到敌机或飞出屏幕才移除子弹，碰撞检测在游戏场景中实现，碰撞之后调用子弹类的移除方法。<br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Bullet = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    gameLayer:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">type,isUp,gameLayer</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer = gameLayer;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;bullet&quot;</span>+type+<span class=\"string\">&quot;.png&quot;</span>));</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(isUp)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.moveUp);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.moveDown);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    moveUp:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.setPositionY(<span class=\"built_in\">this</span>.getPositionY() + Global.bulletSpeed);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.getPositionY()&gt;=cc.winSize.height+<span class=\"built_in\">this</span>.height/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 飞出屏幕删除</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    moveDown:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.setPositionY(<span class=\"built_in\">this</span>.getPositionY() - Global.bulletSpeed);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.getPositionY()&lt;=-<span class=\"built_in\">this</span>.height/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 飞出屏幕删除</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    remove:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> index = <span class=\"built_in\">this</span>.gameLayer.bullets.indexOf(<span class=\"built_in\">this</span>);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index &gt; <span class=\"number\">-1</span>) &#123;  </span><br><span class=\"line\">            <span class=\"built_in\">this</span>.gameLayer.bullets.splice(index, <span class=\"number\">1</span>);  </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.removeFromParent();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"玩家类\"><a href=\"#玩家类\" class=\"headerlink\" title=\"玩家类\"></a>玩家类</h4><p>游戏中的主角就是玩家类，玩家控制玩家类在屏幕中移动飞行，并不断射击子弹，玩家类中包含单行子弹射击和吃完道具之后的双行子弹射击两个方法，玩家还有移动方法，飞入屏幕方法和爆炸方法。同时飞机重复播放飞行动画。<br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Player = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    lock:<span class=\"literal\">true</span>,</span><br><span class=\"line\">    gameLayer:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    doubleCount:<span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">gameLayer</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero1.png&quot;</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer = gameLayer;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.doubleCount = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.lock = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 飞行动画</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> heroHoldFrames = [</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero1.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero2.png&quot;</span>)</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> holdAnimation = <span class=\"keyword\">new</span> cc.Animation(heroHoldFrames, <span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(cc.repeatForever(cc.animate(holdAnimation)));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.moveIn();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.shootSingleBullet,Global.shootSpeed);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    shootSingleBullet:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.lock) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> bullet = <span class=\"keyword\">new</span> Bullet(<span class=\"number\">2</span>,<span class=\"literal\">true</span>,<span class=\"built_in\">this</span>.gameLayer);</span><br><span class=\"line\">            bullet.setPosition(<span class=\"built_in\">this</span>.getPositionX(),<span class=\"built_in\">this</span>.getPositionY()+<span class=\"built_in\">this</span>.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.gameLayer.addChild(bullet);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.gameLayer.bullets.push(bullet);</span><br><span class=\"line\">            <span class=\"comment\">// 发射子弹音效</span></span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/bullet.mp3&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    shootDoubleBegin:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.shootSingleBullet);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.shootDoubleBullet,Global.shootSpeed<span class=\"number\">-0.1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.doubleCount = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    shootDoubleBullet:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.lock) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.doubleCount&gt;=Global.doubleShootTimes)&#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.shootDoubleBullet);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.shootSingleBullet,Global.shootSpeed);</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.doubleCount += <span class=\"number\">1</span>;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> bulletLeft = <span class=\"keyword\">new</span> Bullet(<span class=\"number\">2</span>,<span class=\"literal\">true</span>,<span class=\"built_in\">this</span>.gameLayer);</span><br><span class=\"line\">                <span class=\"keyword\">var</span> bulletRight = <span class=\"keyword\">new</span> Bullet(<span class=\"number\">2</span>,<span class=\"literal\">true</span>,<span class=\"built_in\">this</span>.gameLayer);</span><br><span class=\"line\">                bulletLeft.setPosition(<span class=\"built_in\">this</span>.getPositionX()<span class=\"number\">-35</span>,<span class=\"built_in\">this</span>.getPositionY()+<span class=\"number\">5</span>);</span><br><span class=\"line\">                bulletRight.setPosition(<span class=\"built_in\">this</span>.getPositionX()+<span class=\"number\">35</span>,<span class=\"built_in\">this</span>.getPositionY()+<span class=\"number\">5</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.gameLayer.addChild(bulletLeft);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.gameLayer.addChild(bulletRight);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.gameLayer.bullets.push(bulletLeft);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.gameLayer.bullets.push(bulletRight);</span><br><span class=\"line\">                <span class=\"comment\">// 发射子弹音效</span></span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/bullet.mp3&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    moveIn:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(cc.sequence(</span><br><span class=\"line\">            cc.moveTo(<span class=\"number\">1</span>, cc.p(cc.winSize.width/<span class=\"number\">2</span>, cc.winSize.height/<span class=\"number\">2</span>)),</span><br><span class=\"line\">            cc.moveBy(<span class=\"number\">2</span>, cc.p(<span class=\"number\">0</span>, <span class=\"number\">-400</span>)),</span><br><span class=\"line\">            cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">player</span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 播完动画解锁操作</span></span><br><span class=\"line\">                player.lock = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;,<span class=\"built_in\">this</span>,<span class=\"built_in\">this</span>)</span><br><span class=\"line\">        ));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    moveBy:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x,y</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.lock) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.setPosition(<span class=\"built_in\">this</span>.getPositionX() + x, <span class=\"built_in\">this</span>.getPositionY() + y);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    blowUp:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.lock = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 爆炸动画</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> blowUpFrames = [</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero_blowup_n1.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero_blowup_n2.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero_blowup_n3.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero_blowup_n4.png&quot;</span>)</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> blowUpAnimation = <span class=\"keyword\">new</span> cc.Animation(blowUpFrames, <span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.stopAllActions();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(cc.sequence(cc.animate(blowUpAnimation),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">hero</span>)</span>&#123;</span><br><span class=\"line\">            hero.removeFromParent();</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>,<span class=\"built_in\">this</span>)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"敌机类\"><a href=\"#敌机类\" class=\"headerlink\" title=\"敌机类\"></a>敌机类</h4><p>敌机分为三种，小型飞机，中型飞机和大型飞机，三种飞机的血量，速度都不相同，其中，大型飞机还能在每三秒创建三个小型飞机。敌机同样包含移动，击中和爆炸方法。<br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Enemy = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    type:<span class=\"number\">1</span>,</span><br><span class=\"line\">    hp:<span class=\"number\">0</span>,</span><br><span class=\"line\">    gameLayer:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">type,gameLayer</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.type = type;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.hp = Global.enemyHp(type);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer = gameLayer;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(type==<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 大型飞机的动画</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>._super(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+type+<span class=\"string\">&quot;_n1.png&quot;</span>));</span><br><span class=\"line\">            <span class=\"keyword\">var</span> holdFrames = [</span><br><span class=\"line\">                cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+type+<span class=\"string\">&quot;_n1.png&quot;</span>),</span><br><span class=\"line\">                cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+type+<span class=\"string\">&quot;_n2.png&quot;</span>)</span><br><span class=\"line\">            ];</span><br><span class=\"line\">            <span class=\"keyword\">var</span> holdAnimation = <span class=\"keyword\">new</span> cc.Animation(holdFrames, <span class=\"number\">0.1</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.runAction(cc.repeatForever(cc.animate(holdAnimation)));</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>._super(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+type+<span class=\"string\">&quot;.png&quot;</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.moveDown);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.type==<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 大飞机每3s产生3个小飞机</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.schedule(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.createEnemy();</span><br><span class=\"line\">            &#125;,<span class=\"number\">3</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 创造三个小型飞机</span></span><br><span class=\"line\">    createEnemy:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> enemy1 = <span class=\"keyword\">new</span> Enemy(<span class=\"number\">1</span>,<span class=\"built_in\">this</span>.gameLayer);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> enemy2 = <span class=\"keyword\">new</span> Enemy(<span class=\"number\">1</span>,<span class=\"built_in\">this</span>.gameLayer);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> enemy3 = <span class=\"keyword\">new</span> Enemy(<span class=\"number\">1</span>,<span class=\"built_in\">this</span>.gameLayer);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x1 = <span class=\"built_in\">this</span>.getPositionX()-<span class=\"built_in\">this</span>.width/<span class=\"number\">2</span>+enemy1.width/<span class=\"number\">2</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x2 = <span class=\"built_in\">this</span>.getPositionX();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x3 = <span class=\"built_in\">this</span>.getPositionX()+<span class=\"built_in\">this</span>.width/<span class=\"number\">2</span>-enemy3.width/<span class=\"number\">2</span>;</span><br><span class=\"line\">        enemy1.setPosition(x1,<span class=\"built_in\">this</span>.getPositionY());</span><br><span class=\"line\">        enemy2.setPosition(x2,<span class=\"built_in\">this</span>.getPositionY());</span><br><span class=\"line\">        enemy3.setPosition(x3,<span class=\"built_in\">this</span>.getPositionY());</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.addChild(enemy1);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.addChild(enemy2);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.addChild(enemy3);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.enemies.push(enemy1);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.enemies.push(enemy2);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.enemies.push(enemy3);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    moveDown:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.setPositionY(<span class=\"built_in\">this</span>.getPositionY() - <span class=\"built_in\">parseInt</span>(Global.enemySpeed(<span class=\"built_in\">this</span>.type)));</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.getPositionY()&lt;=-<span class=\"built_in\">this</span>.height/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 飞出屏幕删除</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    remove:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> index = <span class=\"built_in\">this</span>.gameLayer.enemies.indexOf(<span class=\"built_in\">this</span>);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index &gt; <span class=\"number\">-1</span>) &#123;  </span><br><span class=\"line\">            <span class=\"built_in\">this</span>.gameLayer.enemies.splice(index, <span class=\"number\">1</span>);  </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.removeFromParent();</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 击中</span></span><br><span class=\"line\">    hit:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 击中动画</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.hp -= <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.hp&lt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.blowUp();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> holdFrame = <span class=\"built_in\">this</span>.type==<span class=\"number\">3</span>?<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_n1.png&quot;</span>:<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;.png&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> hitFrames = [</span><br><span class=\"line\">                cc.spriteFrameCache.getSpriteFrame(holdFrame),</span><br><span class=\"line\">                cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_hit.png&quot;</span>)</span><br><span class=\"line\">            ];</span><br><span class=\"line\">            <span class=\"keyword\">var</span> hitAnimation = <span class=\"keyword\">new</span> cc.Animation(hitFrames, <span class=\"number\">0.1</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.runAction(cc.sequence(cc.animate(hitAnimation),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">enemy</span>)</span>&#123;</span><br><span class=\"line\">                enemy.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(holdFrame));</span><br><span class=\"line\">            &#125;,<span class=\"built_in\">this</span>)));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 爆炸</span></span><br><span class=\"line\">    blowUp:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.type==<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 大飞机爆炸产生3个小飞机</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.createEnemy();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.moveDown);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> index = <span class=\"built_in\">this</span>.gameLayer.enemies.indexOf(<span class=\"built_in\">this</span>);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index &gt; <span class=\"number\">-1</span>) &#123;  </span><br><span class=\"line\">            <span class=\"built_in\">this</span>.gameLayer.enemies.splice(index, <span class=\"number\">1</span>);  </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 爆炸动画</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> blowUpFrames = [</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_down1.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_down2.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_down3.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_down4.png&quot;</span>)</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.type==<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">            blowUpFrames = blowUpFrames.concat([</span><br><span class=\"line\">                cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_down5.png&quot;</span>),</span><br><span class=\"line\">                cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_down6.png&quot;</span>)</span><br><span class=\"line\">            ]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 播放爆炸音效</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.type==<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/enemy3_down.mp3&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/enemy1_down.mp3&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> blowUpAnimation = <span class=\"keyword\">new</span> cc.Animation(blowUpFrames, <span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.stopAllActions();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(cc.sequence(cc.animate(blowUpAnimation),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">enemy</span>)</span>&#123;</span><br><span class=\"line\">            enemy.removeFromParent();</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>,<span class=\"built_in\">this</span>)));</span><br><span class=\"line\">        <span class=\"comment\">// 加分</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.addScore(<span class=\"built_in\">this</span>.type);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"道具类\"><a href=\"#道具类\" class=\"headerlink\" title=\"道具类\"></a>道具类</h4><p>游戏中会定时掉落道具，道具类包含向下移动方法，移除方法和旋转方法。道具与玩家的碰撞检测在游戏场景中实现。<br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Tool = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    gameLayer:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    type:<span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">type,gameLayer</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;ufo&quot;</span>+type+<span class=\"string\">&quot;.png&quot;</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.type = type;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer = gameLayer;</span><br><span class=\"line\">        <span class=\"comment\">// 旋转特效</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.rotate();</span><br><span class=\"line\">        <span class=\"comment\">// 向下移动</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.moveDown);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    moveDown:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.setPositionY(<span class=\"built_in\">this</span>.getPositionY()-Global.toolSpeed(<span class=\"built_in\">this</span>.type));</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.getPositionY()&lt;=-<span class=\"built_in\">this</span>.height/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 飞出屏幕删除</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    remove:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> index = <span class=\"built_in\">this</span>.gameLayer.tools.indexOf(<span class=\"built_in\">this</span>);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index &gt; <span class=\"number\">-1</span>) &#123;  </span><br><span class=\"line\">            <span class=\"built_in\">this</span>.gameLayer.tools.splice(index, <span class=\"number\">1</span>);  </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0</span>),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">tool</span>)</span>&#123;</span><br><span class=\"line\">            tool.removeFromParent();</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>,<span class=\"built_in\">this</span>)));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    rotate:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rotateAction = cc.repeatForever(cc.sequence(cc.rotateTo(<span class=\"number\">1</span>,<span class=\"number\">30</span>),cc.sequence(cc.rotateTo(<span class=\"number\">1</span>,<span class=\"number\">-30</span>))));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(rotateAction);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"载入类\"><a href=\"#载入类\" class=\"headerlink\" title=\"载入类\"></a>载入类</h4><p>载入类只是在开始场景中的一个载入的循环播放的动画。<br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Loading = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_loading1.png&quot;</span>));</span><br><span class=\"line\">        <span class=\"keyword\">var</span> loadingFrames = [</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_loading1.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_loading2.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_loading3.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_loading4.png&quot;</span>)</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> loadingAnimation = <span class=\"keyword\">new</span> cc.Animation(loadingFrames, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(cc.repeatForever(cc.animate(loadingAnimation)));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"开始场景\"><a href=\"#开始场景\" class=\"headerlink\" title=\"开始场景\"></a>开始场景</h4><p>开始场景是游戏的入口场景，进入之后首先进入开始场景，开始场景包含开始游戏按钮和帮助按钮，点击帮助按钮进入帮助场景，点击开始按钮进入游戏场景。开始场景还包含一个滚动的背景图和一个载入动画。<br>开始场景的效果如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/MenuScene.gif\" alt=\"开始场景\"><br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> MenuLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    loadCount: <span class=\"number\">1</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.loadCount = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 加载plist</span></span><br><span class=\"line\">        cc.spriteFrameCache.addSpriteFrames(res.shoot_background_plist);</span><br><span class=\"line\">        <span class=\"comment\">// 添加背景图</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> Background(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        bg.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        <span class=\"comment\">// logo</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> copyright = <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;shoot_copyright.png&quot;</span>));</span><br><span class=\"line\">        copyright.setPosition(cc.winSize.width / <span class=\"number\">2</span>, cc.winSize.height / <span class=\"number\">2</span> + <span class=\"number\">270</span>);</span><br><span class=\"line\">        copyright.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(<span class=\"number\">1</span>, <span class=\"number\">1.5</span>), cc.scaleTo(<span class=\"number\">1</span>, <span class=\"number\">1</span>))));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(copyright);</span><br><span class=\"line\">        <span class=\"comment\">// 游戏按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> startBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_start.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_start_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> GameScene()));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helpBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_help.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_help_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> HelpScene()));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        helpBtn.setPositionY(startBtn.getPositionY() - startBtn.height / <span class=\"number\">2</span> - <span class=\"number\">100</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(startBtn, helpBtn);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"comment\">// loading动画</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> loading = <span class=\"keyword\">new</span> Loading();</span><br><span class=\"line\">        loading.setPosition(cc.winSize.width/<span class=\"number\">2</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(loading);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> MenuScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> MenuLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"游戏场景\"><a href=\"#游戏场景\" class=\"headerlink\" title=\"游戏场景\"></a>游戏场景</h4><p>从开始场景点击开始游戏按钮之后进入游戏场景，游戏场景包含所有的游戏逻辑，包括滚动背景，玩家，定时产生的敌机，定时产生的道具，玩家与敌机、敌机与子弹、以及玩家与道具的碰撞检测，玩家的移动操作，使用爆炸道具等。<br>游戏开始之前有一个玩家飞入屏幕的动画，效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/MoveIn.gif\" alt=\"玩家飞入\"><br>玩家飞入之后，就可以定时创建子弹、道具与敌机，游戏场景的效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/GameScene.gif\" alt=\"游戏场景\"><br>掉落的道具有发射双排子弹和炸弹两种，双排子弹效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/DoubleShoot.gif\" alt=\"双排子弹\"><br>拾取到炸弹道具会累加到左下角的计数中，点击炸弹就可以使用，炸弹可让屏幕中所有飞机全部爆炸，效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/Bomb.gif\" alt=\"炸弹\"><br>游戏中的敌机，子弹以及道具，都用数组来存储，每一帧都要遍历数组来进行碰撞检测，但玩家与子弹碰撞，玩家与敌机碰撞，以及敌机与子弹碰撞时，调用相应的类的逻辑，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> GameLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    touchStartX:<span class=\"number\">0</span>,</span><br><span class=\"line\">    touchStartY:<span class=\"number\">0</span>,</span><br><span class=\"line\">    bullets:[],</span><br><span class=\"line\">    enemies:[],</span><br><span class=\"line\">    tools:[],</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.touchStartX = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.touchStartY = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.bullets = [];</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.enemies = [];</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.tools = [];</span><br><span class=\"line\">        <span class=\"comment\">// 播放背景音乐</span></span><br><span class=\"line\">        cc.audioEngine.playMusic(<span class=\"string\">&quot;res/sound/game_music.mp3&quot;</span>,<span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 加载plist</span></span><br><span class=\"line\">        cc.spriteFrameCache.addSpriteFrames(res.shoot_background_plist);</span><br><span class=\"line\">        cc.spriteFrameCache.addSpriteFrames(res.shoot_plist);</span><br><span class=\"line\">        <span class=\"comment\">// 添加背景图</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> Background(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        bg.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        <span class=\"comment\">// 添加飞机</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> player = <span class=\"keyword\">new</span> Player(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        player.setPosition(cc.winSize.width / <span class=\"number\">2</span>, -player.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(player);</span><br><span class=\"line\">        player.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 产生敌机</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.createEnemy(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;,Global.createEnemySpeed(<span class=\"number\">1</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.createEnemy(<span class=\"number\">2</span>);</span><br><span class=\"line\">        &#125;,Global.createEnemySpeed(<span class=\"number\">2</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.createEnemy(<span class=\"number\">3</span>);</span><br><span class=\"line\">        &#125;,Global.createEnemySpeed(<span class=\"number\">3</span>));</span><br><span class=\"line\">        <span class=\"comment\">// 产生道具</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.createTool(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;,Global.createToolSpeed(<span class=\"number\">1</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.createTool(<span class=\"number\">2</span>);</span><br><span class=\"line\">        &#125;,Global.createToolSpeed(<span class=\"number\">2</span>));</span><br><span class=\"line\">        <span class=\"comment\">// 添加爆炸道具</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bombNor = <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;bomb.png&quot;</span>));</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bombSelected = <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;bomb.png&quot;</span>));</span><br><span class=\"line\">        bombSelected.setPosition(-bombSelected.width/<span class=\"number\">4</span>,-bombSelected.height/<span class=\"number\">4</span>);</span><br><span class=\"line\">        bombSelected.setScale(<span class=\"number\">1.5</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bombBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            bombNor,</span><br><span class=\"line\">            bombSelected,</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> bombNum = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"built_in\">parseInt</span>(bombNum.getString().slice(<span class=\"number\">1</span>))==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// 全屏爆炸</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> blowEnemy = [];</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.enemies)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> enemy = <span class=\"built_in\">this</span>.enemies[i];</span><br><span class=\"line\">                    blowEnemy.push(enemy);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> j <span class=\"keyword\">in</span> blowEnemy)&#123;</span><br><span class=\"line\">                    blowEnemy[j].blowUp();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// 数量减一</span></span><br><span class=\"line\">                bombNum.setString(<span class=\"string\">&quot;X&quot;</span>+(<span class=\"built_in\">parseInt</span>(bombNum.getString().slice(<span class=\"number\">1</span>))<span class=\"number\">-1</span>));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        bombBtn.setPosition(<span class=\"number\">50</span>+bombBtn.width/<span class=\"number\">2</span>,<span class=\"number\">50</span>+bombBtn.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bombMenu = <span class=\"keyword\">new</span> cc.Menu(bombBtn);</span><br><span class=\"line\">        bombMenu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        bombMenu.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bombMenu);</span><br><span class=\"line\">        <span class=\"comment\">// 爆炸道具数量</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bombNum = <span class=\"keyword\">new</span> cc.LabelBMFont(<span class=\"string\">&quot;X2&quot;</span>,res.font);</span><br><span class=\"line\">        bombNum.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        bombNum.setPosition(bombBtn.getPositionX()+bombBtn.width/<span class=\"number\">2</span>+<span class=\"number\">50</span>,bombBtn.getPositionY());</span><br><span class=\"line\">        bombNum.setTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bombNum);</span><br><span class=\"line\">        <span class=\"comment\">// 暂停开始按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> pauseBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_pause_nor.png&quot;</span>)),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_pause_pressed.png&quot;</span>)),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 暂停音乐音效</span></span><br><span class=\"line\">                cc.audioEngine.pauseAllEffects();</span><br><span class=\"line\">                cc.audioEngine.pauseMusic();</span><br><span class=\"line\">                pauseBtn.setEnabled(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                cc.director.pause();</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.addChild(<span class=\"keyword\">new</span> PauseLayer(pauseBtn),<span class=\"number\">10</span>);</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> pauseMenu = <span class=\"keyword\">new</span> cc.Menu(pauseBtn);</span><br><span class=\"line\">        pauseMenu.setPosition(<span class=\"number\">20</span>+pauseBtn.width/<span class=\"number\">2</span>,cc.winSize.height-pauseBtn.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        pauseMenu.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(pauseMenu);</span><br><span class=\"line\">        <span class=\"comment\">// 分数</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> score = <span class=\"keyword\">new</span> cc.LabelBMFont(<span class=\"string\">&quot;0&quot;</span>,res.font);</span><br><span class=\"line\">        score.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        score.setPosition(pauseMenu.getPositionX()+pauseBtn.width/<span class=\"number\">2</span>+<span class=\"number\">50</span>,pauseMenu.getPositionY());</span><br><span class=\"line\">        score.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(score);</span><br><span class=\"line\">        <span class=\"comment\">// 碰撞检测</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.collision);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    collision:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bullets = <span class=\"built_in\">this</span>.bullets;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> enemies = <span class=\"built_in\">this</span>.enemies;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> tools = <span class=\"built_in\">this</span>.tools;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> score = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">2</span>).getString());</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> enemies)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> enemy = enemies[i];</span><br><span class=\"line\">            <span class=\"comment\">// 检测是否与玩家碰撞</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> player = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(cc.rectIntersectsRect(enemy.getBoundingBox(),player.getBoundingBox()))&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 游戏结束</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.collision);</span><br><span class=\"line\">                player.blowUp();</span><br><span class=\"line\">                <span class=\"comment\">// 停止背景音乐</span></span><br><span class=\"line\">                cc.audioEngine.stopMusic(<span class=\"string\">&quot;res/sound/game_music.mp3&quot;</span>);</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/game_over.mp3&quot;</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.scheduleOnce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                    cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>,<span class=\"keyword\">new</span> OverScene(score)));</span><br><span class=\"line\">                &#125;,<span class=\"number\">2</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// 检测是否吃到道具</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> m <span class=\"keyword\">in</span> tools)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> tool = tools[m];</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(cc.rectIntersectsRect(tool.getBoundingBox(),player.getBoundingBox()))&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">switch</span>(tool.type)&#123;</span><br><span class=\"line\">                        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                            <span class=\"comment\">// 双排子弹道具</span></span><br><span class=\"line\">                            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/get_double_laser.mp3&quot;</span>);</span><br><span class=\"line\">                            player.shootDoubleBegin();</span><br><span class=\"line\">                            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                            <span class=\"comment\">// 清屏道具</span></span><br><span class=\"line\">                            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/get_bomb.mp3&quot;</span>);</span><br><span class=\"line\">                            <span class=\"keyword\">var</span> bomb = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">                            bomb.setString(<span class=\"string\">&quot;X&quot;</span>+(<span class=\"built_in\">parseInt</span>(bomb.getString().slice(<span class=\"number\">1</span>))+<span class=\"number\">1</span>));</span><br><span class=\"line\">                            bomb.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1.2</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">                            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;                  </span><br><span class=\"line\">                    tool.remove();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> j <span class=\"keyword\">in</span> bullets)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> bullet = bullets[j];</span><br><span class=\"line\">                <span class=\"comment\">// 检测是否与子弹碰撞</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(cc.rectIntersectsRect(enemy.getBoundingBox(),bullet.getBoundingBox()))&#123;</span><br><span class=\"line\">                    enemy.hit();</span><br><span class=\"line\">                    bullet.remove();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    addScore:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> score = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> addScore = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> curScore = <span class=\"built_in\">parseInt</span>(score.getString());</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                addScore = <span class=\"number\">100</span> + <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random()*(curScore/<span class=\"number\">1000</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                addScore = <span class=\"number\">200</span> + <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random()*(curScore/<span class=\"number\">1000</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                addScore = <span class=\"number\">500</span> + <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random()*(curScore/<span class=\"number\">1000</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        score.setString(curScore+addScore);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    createEnemy:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> enemy = <span class=\"keyword\">new</span> Enemy(type,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> randomX = <span class=\"built_in\">Math</span>.random()*(cc.winSize.width-enemy.width/<span class=\"number\">2</span>-enemy.width/<span class=\"number\">2</span>)+enemy.width/<span class=\"number\">2</span>;</span><br><span class=\"line\">        enemy.setPosition(randomX,cc.winSize.height+enemy.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(enemy);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.enemies.push(enemy);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    createTool:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> tool = <span class=\"keyword\">new</span> Tool(type,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> randomX = <span class=\"built_in\">Math</span>.random()*(cc.winSize.width-tool.width/<span class=\"number\">2</span>-tool.width/<span class=\"number\">2</span>)+tool.width/<span class=\"number\">2</span>;</span><br><span class=\"line\">        tool.setPosition(randomX,cc.winSize.height+tool.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(tool);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.tools.push(tool);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">// 添加触摸事件</span></span><br><span class=\"line\">        cc.eventManager.addListener(&#123;</span><br><span class=\"line\">            event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">            swallowTouches:<span class=\"literal\">true</span>,</span><br><span class=\"line\">            onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">            onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">            onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        event.getCurrentTarget().touchStartX = touch.getLocation().x;</span><br><span class=\"line\">        event.getCurrentTarget().touchStartY = touch.getLocation().y;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> touchX = touch.getLocation().x;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> touchY = touch.getLocation().y;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> touchStartX = event.getCurrentTarget().touchStartX;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> touchStartY = event.getCurrentTarget().touchStartY;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> player = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(player!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">            player.moveBy(touchX-touchStartX,touchY-touchStartY);</span><br><span class=\"line\">            event.getCurrentTarget().touchStartX = touchX;</span><br><span class=\"line\">            event.getCurrentTarget().touchStartY = touchY;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> GameScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> GameLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"暂停场景\"><a href=\"#暂停场景\" class=\"headerlink\" title=\"暂停场景\"></a>暂停场景</h4><p>在游戏场景点击暂停按钮进入暂停场景，暂停场景实际上只是一个半透明的层盖在游戏场景上，进入暂停场景后游戏暂停，暂停场景包含继续按钮，结束按钮和重新开始按钮。<br>暂停场景效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/PauseMenu.gif\" alt=\"暂停场景\"><br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> PauseLayer=cc.LayerColor.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">pauseBtn</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 初始化为黑色</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super(cc.color(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">100</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.width = cc.winSize.width;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.height = cc.winSize.height;</span><br><span class=\"line\">        <span class=\"comment\">// 继续按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> resumeBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_continue.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_continue_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.audioEngine.resumeMusic();</span><br><span class=\"line\">                cc.director.resume();</span><br><span class=\"line\">                pauseBtn.setEnabled(<span class=\"literal\">true</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.removeFromParent();</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        resumeBtn.setPosition(<span class=\"number\">0</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 结束游戏按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> overBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_over.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_over_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.audioEngine.stopMusic(<span class=\"string\">&quot;res/sound/game_music.mp3&quot;</span>);</span><br><span class=\"line\">                cc.director.resume();</span><br><span class=\"line\">                cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> MenuScene()));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        overBtn.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 重新开始按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> reagainBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_Reagain.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_Reagain_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.audioEngine.stopMusic(<span class=\"string\">&quot;res/sound/game_music.mp3&quot;</span>);</span><br><span class=\"line\">                cc.director.resume();</span><br><span class=\"line\">                cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> GameScene()));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        reagainBtn.setPosition(<span class=\"number\">0</span>,<span class=\"number\">-100</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(resumeBtn,overBtn,reagainBtn);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"结束场景\"><a href=\"#结束场景\" class=\"headerlink\" title=\"结束场景\"></a>结束场景</h4><p>在游戏场景中，如果在碰撞检测中检测到玩家与敌机碰撞，则游戏结束，游戏结束进入结束场景，结束场景包含玩家的最终分数，以及展示最高历史分数和保存最高历史分数。<br>结束场景的效果如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/OverScene.gif\" alt=\"结束场景\"><br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverLayer=cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">score</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> Background(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        bg.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> highest = cc.sys.localStorage.getItem(<span class=\"string\">&quot;highest&quot;</span>);</span><br><span class=\"line\">        highest = highest==<span class=\"literal\">null</span>?<span class=\"number\">0</span>:highest;</span><br><span class=\"line\">        <span class=\"comment\">// 分数存储</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">parseInt</span>(score)&gt;<span class=\"built_in\">parseInt</span>(highest))&#123;</span><br><span class=\"line\">            cc.sys.localStorage.setItem(<span class=\"string\">&quot;highest&quot;</span> ,score);</span><br><span class=\"line\">            highest = score;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 历史最高分数</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> highestFnt = <span class=\"keyword\">new</span> cc.LabelBMFont(highest.toString(),res.font);</span><br><span class=\"line\">        highestFnt.setPosition(<span class=\"number\">250</span>,cc.winSize.height-highestFnt.height/<span class=\"number\">2</span><span class=\"number\">-75</span>);</span><br><span class=\"line\">        highestFnt.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(highestFnt);</span><br><span class=\"line\">        <span class=\"comment\">// 分数显示</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> scoreFnt = <span class=\"keyword\">new</span> cc.LabelBMFont(score,res.font);</span><br><span class=\"line\">        scoreFnt.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(scoreFnt);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scheduleOnce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/out_porp.mp3&quot;</span>);</span><br><span class=\"line\">            scoreFnt.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.5</span>),cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">        &#125;,<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 菜单按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> restartBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/btn_finish.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/btn_finish_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> MenuScene()));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        restartBtn.setPosition(scoreFnt.getPositionX(),scoreFnt.getPositionY()-scoreFnt.height/<span class=\"number\">2</span><span class=\"number\">-100</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(restartBtn);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        menu.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverScene=cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">score</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer=<span class=\"keyword\">new</span> OverLayer(score);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"帮助场景\"><a href=\"#帮助场景\" class=\"headerlink\" title=\"帮助场景\"></a>帮助场景</h4><p>帮助场景就是一个展示游戏帮助提示的场景，其实只有文字和返回游戏按钮。<br>帮助场景的效果如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/HelpScene.gif\" alt=\"帮助场景\"><br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverLayer=cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">score</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> Background(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        bg.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> highest = cc.sys.localStorage.getItem(<span class=\"string\">&quot;highest&quot;</span>);</span><br><span class=\"line\">        highest = highest==<span class=\"literal\">null</span>?<span class=\"number\">0</span>:highest;</span><br><span class=\"line\">        <span class=\"comment\">// 分数存储</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">parseInt</span>(score)&gt;<span class=\"built_in\">parseInt</span>(highest))&#123;</span><br><span class=\"line\">            cc.sys.localStorage.setItem(<span class=\"string\">&quot;highest&quot;</span> ,score);</span><br><span class=\"line\">            highest = score;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 历史最高分数</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> highestFnt = <span class=\"keyword\">new</span> cc.LabelBMFont(highest.toString(),res.font);</span><br><span class=\"line\">        highestFnt.setPosition(<span class=\"number\">250</span>,cc.winSize.height-highestFnt.height/<span class=\"number\">2</span><span class=\"number\">-75</span>);</span><br><span class=\"line\">        highestFnt.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(highestFnt);</span><br><span class=\"line\">        <span class=\"comment\">// 分数显示</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> scoreFnt = <span class=\"keyword\">new</span> cc.LabelBMFont(score,res.font);</span><br><span class=\"line\">        scoreFnt.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(scoreFnt);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scheduleOnce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/out_porp.mp3&quot;</span>);</span><br><span class=\"line\">            scoreFnt.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.5</span>),cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">        &#125;,<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 菜单按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> restartBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/btn_finish.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/btn_finish_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> MenuScene()));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        restartBtn.setPosition(scoreFnt.getPositionX(),scoreFnt.getPositionY()-scoreFnt.height/<span class=\"number\">2</span><span class=\"number\">-100</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(restartBtn);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);install</span><br><span class=\"line\">        menu.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverScene=cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">score</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer=<span class=\"keyword\">new</span> OverLayer(score);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p>最后的运行效果如下<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/Plane.gif\" alt=\"打飞机效果图\"><br>通过CVP平台的项目托管可看到实际运行效果，地址如下：<br><a href=\"http://www.cocoscvp.com/usercode/3d1775ea3aea1f12e986b7d8ebbb079fca12c064/\">http://www.cocoscvp.com/usercode/3d1775ea3aea1f12e986b7d8ebbb079fca12c064/</a></p>\n<h3 id=\"源代码\"><a href=\"#源代码\" class=\"headerlink\" title=\"源代码\"></a>源代码</h3><p>所有源代码均上传到github，欢迎交流学习，地址：<br><a href=\"https://github.com/hjcenry/plane\">https://github.com/hjcenry/plane</a></p>\n<ul>\n<li>原文博客：<a href=\"http://hjcenry.github.io/\">http://hjcenry.github.io</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>今天我们来讲一个最最最常见的一个小游戏——打飞机！是的，打飞机！还记得小时候在玩儿的雷电，应该是打飞机最早的样子了吧。直到现在，也有微信打飞机，全民飞机大战，全民打飞机等游戏的出现，这些游戏基本都是在我们小时候玩儿的打飞机的原型上增加特效音效以及更多新的玩儿法，在这基础上进行的创新。","more":"其实作为开发者来说，仔细看这款游戏，也并不是什么高大上的游戏，其他很多元素、逻辑，都是我们常见的，比如滚动背景，定时产生敌人等。真正开发一款打飞机游戏，其实只要一天就够了，但这个游戏的经典玩法却是很难超越的，在这里，我不得不向这款游戏的原创致敬。</p>\n<h3 id=\"游戏分析\"><a href=\"#游戏分析\" class=\"headerlink\" title=\"游戏分析\"></a>游戏分析</h3><p>游戏中的元素基本可以确定，有玩家，三种敌机，两种道具，子弹和滚动的背景。而游戏的场景，也就是开始场景，游戏场景，帮助场景（这个都是可有可无的），暂停场景和结束场景。游戏中的逻辑其实也很简单，无非就是灵活运用定时器，定时产生敌人，定时产生子弹，定时产生道具，再然后就是玩家与道具，玩家与敌人，子弹与敌人的碰撞检测。我们可以把以上提到的元素全部抽象成类，每个类封装自己的实现接口，在游戏场景中调用相应类的对应的方法即可。</p>\n<h3 id=\"游戏实现\"><a href=\"#游戏实现\" class=\"headerlink\" title=\"游戏实现\"></a>游戏实现</h3><h4 id=\"全局类\"><a href=\"#全局类\" class=\"headerlink\" title=\"全局类\"></a>全局类</h4><p>游戏中所有用到的常量都可以放在一个全局类中，在实际开发中可根据需求动态修改，也方便管理维护。<br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Global = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 子弹移动速度</span></span><br><span class=\"line\">    bulletSpeed:<span class=\"number\">10</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 敌机移动速度</span></span><br><span class=\"line\">    enemySpeed:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 敌机创造速度</span></span><br><span class=\"line\">    createEnemySpeed:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 敌机生命</span></span><br><span class=\"line\">    enemyHp:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">10</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 道具移动速度</span></span><br><span class=\"line\">    toolSpeed:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 道具创造速度</span></span><br><span class=\"line\">    createToolSpeed:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">30</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">50</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 射击速度</span></span><br><span class=\"line\">    shootSpeed:<span class=\"number\">0.2</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 双倍射击时长</span></span><br><span class=\"line\">    doubleShootTimes:<span class=\"number\">100</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4 id=\"背景类\"><a href=\"#背景类\" class=\"headerlink\" title=\"背景类\"></a>背景类</h4><p>游戏中用到的背景也可以提出来为一个背景类，游戏中的背景是滚动的，滚动背景的实现方式就是用两张相同的图片拼接起来，不断往下移动，当下面那张完全移出屏幕的时候，再将这张图片移动到前一张的上面，这样一直循环往复，就形成了不断滚动的背景。实现代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"> <span class=\"keyword\">var</span> Background = cc.Sprite.extend(&#123;</span><br><span class=\"line\">     ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">isOver</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(isOver)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">            <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;gameover.png&quot;</span>));</span><br><span class=\"line\">            bg.setScale(<span class=\"number\">750</span>/<span class=\"number\">480</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.setScale(<span class=\"number\">750</span>/<span class=\"number\">480</span>);</span><br><span class=\"line\">            <span class=\"comment\">// 滚动背景图1</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> menuBg1 = <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;background.png&quot;</span>));</span><br><span class=\"line\">            menuBg1.setPosition(cc.winSize.width / <span class=\"number\">2</span>, cc.winSize.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">            menuBg1.setScale(<span class=\"number\">750</span> / <span class=\"number\">480</span>);</span><br><span class=\"line\">            menuBg1.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(menuBg1);</span><br><span class=\"line\">            <span class=\"comment\">// 滚动背景图2</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> menuBg2 = <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;background.png&quot;</span>));</span><br><span class=\"line\">            menuBg2.setPosition(cc.winSize.width / <span class=\"number\">2</span>, cc.winSize.height / <span class=\"number\">2</span> + cc.winSize.height - <span class=\"number\">4</span>);</span><br><span class=\"line\">            menuBg2.setScale(<span class=\"number\">750</span> / <span class=\"number\">480</span>);</span><br><span class=\"line\">            menuBg2.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.addChild(menuBg2);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.update);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">     &#125;,</span><br><span class=\"line\">     stopMove:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.update);</span><br><span class=\"line\">     &#125;,</span><br><span class=\"line\">     update: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">         <span class=\"keyword\">var</span> menuBg1 = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">         <span class=\"keyword\">var</span> menuBg2 = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (menuBg1.getPositionY() &lt;= -cc.winSize.height / <span class=\"number\">2</span> + <span class=\"number\">20</span>) &#123;</span><br><span class=\"line\">             menuBg1.setPositionY(cc.winSize.height / <span class=\"number\">2</span> + cc.winSize.height);</span><br><span class=\"line\">         &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">             menuBg1.setPositionY(menuBg1.getPositionY() - <span class=\"number\">1</span>);</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (menuBg2.getPositionY() &lt;= -cc.winSize.height / <span class=\"number\">2</span> + <span class=\"number\">20</span>) &#123;</span><br><span class=\"line\">             menuBg2.setPositionY(cc.winSize.height / <span class=\"number\">2</span> + cc.winSize.height);</span><br><span class=\"line\">         &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">             menuBg2.setPositionY(menuBg2.getPositionY() - <span class=\"number\">1</span>);</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"> &#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"子弹类\"><a href=\"#子弹类\" class=\"headerlink\" title=\"子弹类\"></a>子弹类</h4><p>玩家不断发出子弹，子弹类需要包含移动和移除两个方法，子弹一旦被创建，就按照一个轨迹移动，直到碰撞到敌机或飞出屏幕才移除子弹，碰撞检测在游戏场景中实现，碰撞之后调用子弹类的移除方法。<br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Bullet = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    gameLayer:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">type,isUp,gameLayer</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer = gameLayer;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;bullet&quot;</span>+type+<span class=\"string\">&quot;.png&quot;</span>));</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(isUp)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.moveUp);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.moveDown);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    moveUp:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.setPositionY(<span class=\"built_in\">this</span>.getPositionY() + Global.bulletSpeed);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.getPositionY()&gt;=cc.winSize.height+<span class=\"built_in\">this</span>.height/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 飞出屏幕删除</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    moveDown:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.setPositionY(<span class=\"built_in\">this</span>.getPositionY() - Global.bulletSpeed);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.getPositionY()&lt;=-<span class=\"built_in\">this</span>.height/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 飞出屏幕删除</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    remove:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> index = <span class=\"built_in\">this</span>.gameLayer.bullets.indexOf(<span class=\"built_in\">this</span>);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index &gt; <span class=\"number\">-1</span>) &#123;  </span><br><span class=\"line\">            <span class=\"built_in\">this</span>.gameLayer.bullets.splice(index, <span class=\"number\">1</span>);  </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.removeFromParent();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"玩家类\"><a href=\"#玩家类\" class=\"headerlink\" title=\"玩家类\"></a>玩家类</h4><p>游戏中的主角就是玩家类，玩家控制玩家类在屏幕中移动飞行，并不断射击子弹，玩家类中包含单行子弹射击和吃完道具之后的双行子弹射击两个方法，玩家还有移动方法，飞入屏幕方法和爆炸方法。同时飞机重复播放飞行动画。<br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Player = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    lock:<span class=\"literal\">true</span>,</span><br><span class=\"line\">    gameLayer:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    doubleCount:<span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">gameLayer</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero1.png&quot;</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer = gameLayer;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.doubleCount = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.lock = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 飞行动画</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> heroHoldFrames = [</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero1.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero2.png&quot;</span>)</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> holdAnimation = <span class=\"keyword\">new</span> cc.Animation(heroHoldFrames, <span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(cc.repeatForever(cc.animate(holdAnimation)));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.moveIn();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.shootSingleBullet,Global.shootSpeed);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    shootSingleBullet:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.lock) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> bullet = <span class=\"keyword\">new</span> Bullet(<span class=\"number\">2</span>,<span class=\"literal\">true</span>,<span class=\"built_in\">this</span>.gameLayer);</span><br><span class=\"line\">            bullet.setPosition(<span class=\"built_in\">this</span>.getPositionX(),<span class=\"built_in\">this</span>.getPositionY()+<span class=\"built_in\">this</span>.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.gameLayer.addChild(bullet);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.gameLayer.bullets.push(bullet);</span><br><span class=\"line\">            <span class=\"comment\">// 发射子弹音效</span></span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/bullet.mp3&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    shootDoubleBegin:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.shootSingleBullet);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.shootDoubleBullet,Global.shootSpeed<span class=\"number\">-0.1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.doubleCount = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    shootDoubleBullet:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.lock) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.doubleCount&gt;=Global.doubleShootTimes)&#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.shootDoubleBullet);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.shootSingleBullet,Global.shootSpeed);</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.doubleCount += <span class=\"number\">1</span>;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> bulletLeft = <span class=\"keyword\">new</span> Bullet(<span class=\"number\">2</span>,<span class=\"literal\">true</span>,<span class=\"built_in\">this</span>.gameLayer);</span><br><span class=\"line\">                <span class=\"keyword\">var</span> bulletRight = <span class=\"keyword\">new</span> Bullet(<span class=\"number\">2</span>,<span class=\"literal\">true</span>,<span class=\"built_in\">this</span>.gameLayer);</span><br><span class=\"line\">                bulletLeft.setPosition(<span class=\"built_in\">this</span>.getPositionX()<span class=\"number\">-35</span>,<span class=\"built_in\">this</span>.getPositionY()+<span class=\"number\">5</span>);</span><br><span class=\"line\">                bulletRight.setPosition(<span class=\"built_in\">this</span>.getPositionX()+<span class=\"number\">35</span>,<span class=\"built_in\">this</span>.getPositionY()+<span class=\"number\">5</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.gameLayer.addChild(bulletLeft);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.gameLayer.addChild(bulletRight);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.gameLayer.bullets.push(bulletLeft);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.gameLayer.bullets.push(bulletRight);</span><br><span class=\"line\">                <span class=\"comment\">// 发射子弹音效</span></span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/bullet.mp3&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    moveIn:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(cc.sequence(</span><br><span class=\"line\">            cc.moveTo(<span class=\"number\">1</span>, cc.p(cc.winSize.width/<span class=\"number\">2</span>, cc.winSize.height/<span class=\"number\">2</span>)),</span><br><span class=\"line\">            cc.moveBy(<span class=\"number\">2</span>, cc.p(<span class=\"number\">0</span>, <span class=\"number\">-400</span>)),</span><br><span class=\"line\">            cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">player</span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 播完动画解锁操作</span></span><br><span class=\"line\">                player.lock = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;,<span class=\"built_in\">this</span>,<span class=\"built_in\">this</span>)</span><br><span class=\"line\">        ));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    moveBy:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x,y</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.lock) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.setPosition(<span class=\"built_in\">this</span>.getPositionX() + x, <span class=\"built_in\">this</span>.getPositionY() + y);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    blowUp:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.lock = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 爆炸动画</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> blowUpFrames = [</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero_blowup_n1.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero_blowup_n2.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero_blowup_n3.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;hero_blowup_n4.png&quot;</span>)</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> blowUpAnimation = <span class=\"keyword\">new</span> cc.Animation(blowUpFrames, <span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.stopAllActions();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(cc.sequence(cc.animate(blowUpAnimation),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">hero</span>)</span>&#123;</span><br><span class=\"line\">            hero.removeFromParent();</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>,<span class=\"built_in\">this</span>)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"敌机类\"><a href=\"#敌机类\" class=\"headerlink\" title=\"敌机类\"></a>敌机类</h4><p>敌机分为三种，小型飞机，中型飞机和大型飞机，三种飞机的血量，速度都不相同，其中，大型飞机还能在每三秒创建三个小型飞机。敌机同样包含移动，击中和爆炸方法。<br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Enemy = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    type:<span class=\"number\">1</span>,</span><br><span class=\"line\">    hp:<span class=\"number\">0</span>,</span><br><span class=\"line\">    gameLayer:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">type,gameLayer</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.type = type;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.hp = Global.enemyHp(type);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer = gameLayer;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(type==<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 大型飞机的动画</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>._super(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+type+<span class=\"string\">&quot;_n1.png&quot;</span>));</span><br><span class=\"line\">            <span class=\"keyword\">var</span> holdFrames = [</span><br><span class=\"line\">                cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+type+<span class=\"string\">&quot;_n1.png&quot;</span>),</span><br><span class=\"line\">                cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+type+<span class=\"string\">&quot;_n2.png&quot;</span>)</span><br><span class=\"line\">            ];</span><br><span class=\"line\">            <span class=\"keyword\">var</span> holdAnimation = <span class=\"keyword\">new</span> cc.Animation(holdFrames, <span class=\"number\">0.1</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.runAction(cc.repeatForever(cc.animate(holdAnimation)));</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>._super(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+type+<span class=\"string\">&quot;.png&quot;</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.moveDown);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.type==<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 大飞机每3s产生3个小飞机</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.schedule(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.createEnemy();</span><br><span class=\"line\">            &#125;,<span class=\"number\">3</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 创造三个小型飞机</span></span><br><span class=\"line\">    createEnemy:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> enemy1 = <span class=\"keyword\">new</span> Enemy(<span class=\"number\">1</span>,<span class=\"built_in\">this</span>.gameLayer);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> enemy2 = <span class=\"keyword\">new</span> Enemy(<span class=\"number\">1</span>,<span class=\"built_in\">this</span>.gameLayer);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> enemy3 = <span class=\"keyword\">new</span> Enemy(<span class=\"number\">1</span>,<span class=\"built_in\">this</span>.gameLayer);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x1 = <span class=\"built_in\">this</span>.getPositionX()-<span class=\"built_in\">this</span>.width/<span class=\"number\">2</span>+enemy1.width/<span class=\"number\">2</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x2 = <span class=\"built_in\">this</span>.getPositionX();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> x3 = <span class=\"built_in\">this</span>.getPositionX()+<span class=\"built_in\">this</span>.width/<span class=\"number\">2</span>-enemy3.width/<span class=\"number\">2</span>;</span><br><span class=\"line\">        enemy1.setPosition(x1,<span class=\"built_in\">this</span>.getPositionY());</span><br><span class=\"line\">        enemy2.setPosition(x2,<span class=\"built_in\">this</span>.getPositionY());</span><br><span class=\"line\">        enemy3.setPosition(x3,<span class=\"built_in\">this</span>.getPositionY());</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.addChild(enemy1);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.addChild(enemy2);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.addChild(enemy3);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.enemies.push(enemy1);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.enemies.push(enemy2);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.enemies.push(enemy3);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    moveDown:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.setPositionY(<span class=\"built_in\">this</span>.getPositionY() - <span class=\"built_in\">parseInt</span>(Global.enemySpeed(<span class=\"built_in\">this</span>.type)));</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.getPositionY()&lt;=-<span class=\"built_in\">this</span>.height/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 飞出屏幕删除</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    remove:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> index = <span class=\"built_in\">this</span>.gameLayer.enemies.indexOf(<span class=\"built_in\">this</span>);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index &gt; <span class=\"number\">-1</span>) &#123;  </span><br><span class=\"line\">            <span class=\"built_in\">this</span>.gameLayer.enemies.splice(index, <span class=\"number\">1</span>);  </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.removeFromParent();</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 击中</span></span><br><span class=\"line\">    hit:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 击中动画</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.hp -= <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.hp&lt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.blowUp();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> holdFrame = <span class=\"built_in\">this</span>.type==<span class=\"number\">3</span>?<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_n1.png&quot;</span>:<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;.png&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> hitFrames = [</span><br><span class=\"line\">                cc.spriteFrameCache.getSpriteFrame(holdFrame),</span><br><span class=\"line\">                cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_hit.png&quot;</span>)</span><br><span class=\"line\">            ];</span><br><span class=\"line\">            <span class=\"keyword\">var</span> hitAnimation = <span class=\"keyword\">new</span> cc.Animation(hitFrames, <span class=\"number\">0.1</span>);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.runAction(cc.sequence(cc.animate(hitAnimation),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">enemy</span>)</span>&#123;</span><br><span class=\"line\">                enemy.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(holdFrame));</span><br><span class=\"line\">            &#125;,<span class=\"built_in\">this</span>)));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 爆炸</span></span><br><span class=\"line\">    blowUp:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.type==<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 大飞机爆炸产生3个小飞机</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.createEnemy();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.moveDown);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> index = <span class=\"built_in\">this</span>.gameLayer.enemies.indexOf(<span class=\"built_in\">this</span>);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index &gt; <span class=\"number\">-1</span>) &#123;  </span><br><span class=\"line\">            <span class=\"built_in\">this</span>.gameLayer.enemies.splice(index, <span class=\"number\">1</span>);  </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 爆炸动画</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> blowUpFrames = [</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_down1.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_down2.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_down3.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_down4.png&quot;</span>)</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.type==<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">            blowUpFrames = blowUpFrames.concat([</span><br><span class=\"line\">                cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_down5.png&quot;</span>),</span><br><span class=\"line\">                cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;enemy&quot;</span>+<span class=\"built_in\">this</span>.type+<span class=\"string\">&quot;_down6.png&quot;</span>)</span><br><span class=\"line\">            ]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 播放爆炸音效</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.type==<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/enemy3_down.mp3&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/enemy1_down.mp3&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> blowUpAnimation = <span class=\"keyword\">new</span> cc.Animation(blowUpFrames, <span class=\"number\">0.1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.stopAllActions();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(cc.sequence(cc.animate(blowUpAnimation),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">enemy</span>)</span>&#123;</span><br><span class=\"line\">            enemy.removeFromParent();</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>,<span class=\"built_in\">this</span>)));</span><br><span class=\"line\">        <span class=\"comment\">// 加分</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer.addScore(<span class=\"built_in\">this</span>.type);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"道具类\"><a href=\"#道具类\" class=\"headerlink\" title=\"道具类\"></a>道具类</h4><p>游戏中会定时掉落道具，道具类包含向下移动方法，移除方法和旋转方法。道具与玩家的碰撞检测在游戏场景中实现。<br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Tool = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    gameLayer:<span class=\"literal\">null</span>,</span><br><span class=\"line\">    type:<span class=\"number\">0</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">type,gameLayer</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;ufo&quot;</span>+type+<span class=\"string\">&quot;.png&quot;</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.type = type;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.gameLayer = gameLayer;</span><br><span class=\"line\">        <span class=\"comment\">// 旋转特效</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.rotate();</span><br><span class=\"line\">        <span class=\"comment\">// 向下移动</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.moveDown);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    moveDown:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.setPositionY(<span class=\"built_in\">this</span>.getPositionY()-Global.toolSpeed(<span class=\"built_in\">this</span>.type));</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.getPositionY()&lt;=-<span class=\"built_in\">this</span>.height/<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 飞出屏幕删除</span></span><br><span class=\"line\">            <span class=\"built_in\">this</span>.remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    remove:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> index = <span class=\"built_in\">this</span>.gameLayer.tools.indexOf(<span class=\"built_in\">this</span>);  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index &gt; <span class=\"number\">-1</span>) &#123;  </span><br><span class=\"line\">            <span class=\"built_in\">this</span>.gameLayer.tools.splice(index, <span class=\"number\">1</span>);  </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">0</span>),cc.callFunc(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">tool</span>)</span>&#123;</span><br><span class=\"line\">            tool.removeFromParent();</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>,<span class=\"built_in\">this</span>)));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    rotate:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> rotateAction = cc.repeatForever(cc.sequence(cc.rotateTo(<span class=\"number\">1</span>,<span class=\"number\">30</span>),cc.sequence(cc.rotateTo(<span class=\"number\">1</span>,<span class=\"number\">-30</span>))));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(rotateAction);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"载入类\"><a href=\"#载入类\" class=\"headerlink\" title=\"载入类\"></a>载入类</h4><p>载入类只是在开始场景中的一个载入的循环播放的动画。<br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Loading = cc.Sprite.extend(&#123;</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_loading1.png&quot;</span>));</span><br><span class=\"line\">        <span class=\"keyword\">var</span> loadingFrames = [</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_loading1.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_loading2.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_loading3.png&quot;</span>),</span><br><span class=\"line\">            cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_loading4.png&quot;</span>)</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> loadingAnimation = <span class=\"keyword\">new</span> cc.Animation(loadingFrames, <span class=\"number\">0.5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.runAction(cc.repeatForever(cc.animate(loadingAnimation)));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"开始场景\"><a href=\"#开始场景\" class=\"headerlink\" title=\"开始场景\"></a>开始场景</h4><p>开始场景是游戏的入口场景，进入之后首先进入开始场景，开始场景包含开始游戏按钮和帮助按钮，点击帮助按钮进入帮助场景，点击开始按钮进入游戏场景。开始场景还包含一个滚动的背景图和一个载入动画。<br>开始场景的效果如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/MenuScene.gif\" alt=\"开始场景\"><br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> MenuLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    loadCount: <span class=\"number\">1</span>,</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.loadCount = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 加载plist</span></span><br><span class=\"line\">        cc.spriteFrameCache.addSpriteFrames(res.shoot_background_plist);</span><br><span class=\"line\">        <span class=\"comment\">// 添加背景图</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> Background(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        bg.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        <span class=\"comment\">// logo</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> copyright = <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;shoot_copyright.png&quot;</span>));</span><br><span class=\"line\">        copyright.setPosition(cc.winSize.width / <span class=\"number\">2</span>, cc.winSize.height / <span class=\"number\">2</span> + <span class=\"number\">270</span>);</span><br><span class=\"line\">        copyright.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(<span class=\"number\">1</span>, <span class=\"number\">1.5</span>), cc.scaleTo(<span class=\"number\">1</span>, <span class=\"number\">1</span>))));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(copyright);</span><br><span class=\"line\">        <span class=\"comment\">// 游戏按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> startBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_start.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_start_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> GameScene()));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> helpBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_help.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_help_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> HelpScene()));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        helpBtn.setPositionY(startBtn.getPositionY() - startBtn.height / <span class=\"number\">2</span> - <span class=\"number\">100</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(startBtn, helpBtn);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"comment\">// loading动画</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> loading = <span class=\"keyword\">new</span> Loading();</span><br><span class=\"line\">        loading.setPosition(cc.winSize.width/<span class=\"number\">2</span>,<span class=\"number\">200</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(loading);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> MenuScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> MenuLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"游戏场景\"><a href=\"#游戏场景\" class=\"headerlink\" title=\"游戏场景\"></a>游戏场景</h4><p>从开始场景点击开始游戏按钮之后进入游戏场景，游戏场景包含所有的游戏逻辑，包括滚动背景，玩家，定时产生的敌机，定时产生的道具，玩家与敌机、敌机与子弹、以及玩家与道具的碰撞检测，玩家的移动操作，使用爆炸道具等。<br>游戏开始之前有一个玩家飞入屏幕的动画，效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/MoveIn.gif\" alt=\"玩家飞入\"><br>玩家飞入之后，就可以定时创建子弹、道具与敌机，游戏场景的效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/GameScene.gif\" alt=\"游戏场景\"><br>掉落的道具有发射双排子弹和炸弹两种，双排子弹效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/DoubleShoot.gif\" alt=\"双排子弹\"><br>拾取到炸弹道具会累加到左下角的计数中，点击炸弹就可以使用，炸弹可让屏幕中所有飞机全部爆炸，效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/Bomb.gif\" alt=\"炸弹\"><br>游戏中的敌机，子弹以及道具，都用数组来存储，每一帧都要遍历数组来进行碰撞检测，但玩家与子弹碰撞，玩家与敌机碰撞，以及敌机与子弹碰撞时，调用相应的类的逻辑，代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> GameLayer = cc.Layer.extend(&#123;</span><br><span class=\"line\">    touchStartX:<span class=\"number\">0</span>,</span><br><span class=\"line\">    touchStartY:<span class=\"number\">0</span>,</span><br><span class=\"line\">    bullets:[],</span><br><span class=\"line\">    enemies:[],</span><br><span class=\"line\">    tools:[],</span><br><span class=\"line\">    ctor: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.touchStartX = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.touchStartY = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.bullets = [];</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.enemies = [];</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.tools = [];</span><br><span class=\"line\">        <span class=\"comment\">// 播放背景音乐</span></span><br><span class=\"line\">        cc.audioEngine.playMusic(<span class=\"string\">&quot;res/sound/game_music.mp3&quot;</span>,<span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 加载plist</span></span><br><span class=\"line\">        cc.spriteFrameCache.addSpriteFrames(res.shoot_background_plist);</span><br><span class=\"line\">        cc.spriteFrameCache.addSpriteFrames(res.shoot_plist);</span><br><span class=\"line\">        <span class=\"comment\">// 添加背景图</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> Background(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        bg.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        <span class=\"comment\">// 添加飞机</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> player = <span class=\"keyword\">new</span> Player(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        player.setPosition(cc.winSize.width / <span class=\"number\">2</span>, -player.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(player);</span><br><span class=\"line\">        player.setTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 产生敌机</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.createEnemy(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;,Global.createEnemySpeed(<span class=\"number\">1</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.createEnemy(<span class=\"number\">2</span>);</span><br><span class=\"line\">        &#125;,Global.createEnemySpeed(<span class=\"number\">2</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.createEnemy(<span class=\"number\">3</span>);</span><br><span class=\"line\">        &#125;,Global.createEnemySpeed(<span class=\"number\">3</span>));</span><br><span class=\"line\">        <span class=\"comment\">// 产生道具</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.createTool(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;,Global.createToolSpeed(<span class=\"number\">1</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.createTool(<span class=\"number\">2</span>);</span><br><span class=\"line\">        &#125;,Global.createToolSpeed(<span class=\"number\">2</span>));</span><br><span class=\"line\">        <span class=\"comment\">// 添加爆炸道具</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bombNor = <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;bomb.png&quot;</span>));</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bombSelected = <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;bomb.png&quot;</span>));</span><br><span class=\"line\">        bombSelected.setPosition(-bombSelected.width/<span class=\"number\">4</span>,-bombSelected.height/<span class=\"number\">4</span>);</span><br><span class=\"line\">        bombSelected.setScale(<span class=\"number\">1.5</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bombBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            bombNor,</span><br><span class=\"line\">            bombSelected,</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> bombNum = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"built_in\">parseInt</span>(bombNum.getString().slice(<span class=\"number\">1</span>))==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// 全屏爆炸</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> blowEnemy = [];</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.enemies)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> enemy = <span class=\"built_in\">this</span>.enemies[i];</span><br><span class=\"line\">                    blowEnemy.push(enemy);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> j <span class=\"keyword\">in</span> blowEnemy)&#123;</span><br><span class=\"line\">                    blowEnemy[j].blowUp();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// 数量减一</span></span><br><span class=\"line\">                bombNum.setString(<span class=\"string\">&quot;X&quot;</span>+(<span class=\"built_in\">parseInt</span>(bombNum.getString().slice(<span class=\"number\">1</span>))<span class=\"number\">-1</span>));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        bombBtn.setPosition(<span class=\"number\">50</span>+bombBtn.width/<span class=\"number\">2</span>,<span class=\"number\">50</span>+bombBtn.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bombMenu = <span class=\"keyword\">new</span> cc.Menu(bombBtn);</span><br><span class=\"line\">        bombMenu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        bombMenu.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bombMenu);</span><br><span class=\"line\">        <span class=\"comment\">// 爆炸道具数量</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bombNum = <span class=\"keyword\">new</span> cc.LabelBMFont(<span class=\"string\">&quot;X2&quot;</span>,res.font);</span><br><span class=\"line\">        bombNum.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        bombNum.setPosition(bombBtn.getPositionX()+bombBtn.width/<span class=\"number\">2</span>+<span class=\"number\">50</span>,bombBtn.getPositionY());</span><br><span class=\"line\">        bombNum.setTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bombNum);</span><br><span class=\"line\">        <span class=\"comment\">// 暂停开始按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> pauseBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_pause_nor.png&quot;</span>)),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(cc.spriteFrameCache.getSpriteFrame(<span class=\"string\">&quot;game_pause_pressed.png&quot;</span>)),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 暂停音乐音效</span></span><br><span class=\"line\">                cc.audioEngine.pauseAllEffects();</span><br><span class=\"line\">                cc.audioEngine.pauseMusic();</span><br><span class=\"line\">                pauseBtn.setEnabled(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                cc.director.pause();</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.addChild(<span class=\"keyword\">new</span> PauseLayer(pauseBtn),<span class=\"number\">10</span>);</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> pauseMenu = <span class=\"keyword\">new</span> cc.Menu(pauseBtn);</span><br><span class=\"line\">        pauseMenu.setPosition(<span class=\"number\">20</span>+pauseBtn.width/<span class=\"number\">2</span>,cc.winSize.height-pauseBtn.height/<span class=\"number\">2</span><span class=\"number\">-20</span>);</span><br><span class=\"line\">        pauseMenu.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(pauseMenu);</span><br><span class=\"line\">        <span class=\"comment\">// 分数</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> score = <span class=\"keyword\">new</span> cc.LabelBMFont(<span class=\"string\">&quot;0&quot;</span>,res.font);</span><br><span class=\"line\">        score.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        score.setPosition(pauseMenu.getPositionX()+pauseBtn.width/<span class=\"number\">2</span>+<span class=\"number\">50</span>,pauseMenu.getPositionY());</span><br><span class=\"line\">        score.setTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(score);</span><br><span class=\"line\">        <span class=\"comment\">// 碰撞检测</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schedule(<span class=\"built_in\">this</span>.collision);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    collision:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bullets = <span class=\"built_in\">this</span>.bullets;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> enemies = <span class=\"built_in\">this</span>.enemies;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> tools = <span class=\"built_in\">this</span>.tools;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> score = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">2</span>).getString());</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> enemies)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> enemy = enemies[i];</span><br><span class=\"line\">            <span class=\"comment\">// 检测是否与玩家碰撞</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> player = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(cc.rectIntersectsRect(enemy.getBoundingBox(),player.getBoundingBox()))&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 游戏结束</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.unschedule(<span class=\"built_in\">this</span>.collision);</span><br><span class=\"line\">                player.blowUp();</span><br><span class=\"line\">                <span class=\"comment\">// 停止背景音乐</span></span><br><span class=\"line\">                cc.audioEngine.stopMusic(<span class=\"string\">&quot;res/sound/game_music.mp3&quot;</span>);</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/game_over.mp3&quot;</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.scheduleOnce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                    cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>,<span class=\"keyword\">new</span> OverScene(score)));</span><br><span class=\"line\">                &#125;,<span class=\"number\">2</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// 检测是否吃到道具</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> m <span class=\"keyword\">in</span> tools)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> tool = tools[m];</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(cc.rectIntersectsRect(tool.getBoundingBox(),player.getBoundingBox()))&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">switch</span>(tool.type)&#123;</span><br><span class=\"line\">                        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                            <span class=\"comment\">// 双排子弹道具</span></span><br><span class=\"line\">                            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/get_double_laser.mp3&quot;</span>);</span><br><span class=\"line\">                            player.shootDoubleBegin();</span><br><span class=\"line\">                            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                            <span class=\"comment\">// 清屏道具</span></span><br><span class=\"line\">                            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/get_bomb.mp3&quot;</span>);</span><br><span class=\"line\">                            <span class=\"keyword\">var</span> bomb = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">3</span>);</span><br><span class=\"line\">                            bomb.setString(<span class=\"string\">&quot;X&quot;</span>+(<span class=\"built_in\">parseInt</span>(bomb.getString().slice(<span class=\"number\">1</span>))+<span class=\"number\">1</span>));</span><br><span class=\"line\">                            bomb.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1.2</span>),cc.scaleTo(<span class=\"number\">0.1</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">                            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;                  </span><br><span class=\"line\">                    tool.remove();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> j <span class=\"keyword\">in</span> bullets)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> bullet = bullets[j];</span><br><span class=\"line\">                <span class=\"comment\">// 检测是否与子弹碰撞</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(cc.rectIntersectsRect(enemy.getBoundingBox(),bullet.getBoundingBox()))&#123;</span><br><span class=\"line\">                    enemy.hit();</span><br><span class=\"line\">                    bullet.remove();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    addScore:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> score = <span class=\"built_in\">this</span>.getChildByTag(<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> addScore = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> curScore = <span class=\"built_in\">parseInt</span>(score.getString());</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(type)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                addScore = <span class=\"number\">100</span> + <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random()*(curScore/<span class=\"number\">1000</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                addScore = <span class=\"number\">200</span> + <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random()*(curScore/<span class=\"number\">1000</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                addScore = <span class=\"number\">500</span> + <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random()*(curScore/<span class=\"number\">1000</span>));</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        score.setString(curScore+addScore);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    createEnemy:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> enemy = <span class=\"keyword\">new</span> Enemy(type,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> randomX = <span class=\"built_in\">Math</span>.random()*(cc.winSize.width-enemy.width/<span class=\"number\">2</span>-enemy.width/<span class=\"number\">2</span>)+enemy.width/<span class=\"number\">2</span>;</span><br><span class=\"line\">        enemy.setPosition(randomX,cc.winSize.height+enemy.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(enemy);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.enemies.push(enemy);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    createTool:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> tool = <span class=\"keyword\">new</span> Tool(type,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> randomX = <span class=\"built_in\">Math</span>.random()*(cc.winSize.width-tool.width/<span class=\"number\">2</span>-tool.width/<span class=\"number\">2</span>)+tool.width/<span class=\"number\">2</span>;</span><br><span class=\"line\">        tool.setPosition(randomX,cc.winSize.height+tool.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(tool);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.tools.push(tool);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    onEnter:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"comment\">// 添加触摸事件</span></span><br><span class=\"line\">        cc.eventManager.addListener(&#123;</span><br><span class=\"line\">            event:cc.EventListener.TOUCH_ONE_BY_ONE,</span><br><span class=\"line\">            swallowTouches:<span class=\"literal\">true</span>,</span><br><span class=\"line\">            onTouchBegan:<span class=\"built_in\">this</span>.touchbegan,</span><br><span class=\"line\">            onTouchMoved:<span class=\"built_in\">this</span>.touchmoved,</span><br><span class=\"line\">            onTouchEnded:<span class=\"built_in\">this</span>.touchended</span><br><span class=\"line\">        &#125;,<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchbegan:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        event.getCurrentTarget().touchStartX = touch.getLocation().x;</span><br><span class=\"line\">        event.getCurrentTarget().touchStartY = touch.getLocation().y;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchmoved:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> touchX = touch.getLocation().x;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> touchY = touch.getLocation().y;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> touchStartX = event.getCurrentTarget().touchStartX;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> touchStartY = event.getCurrentTarget().touchStartY;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> player = event.getCurrentTarget().getChildByTag(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(player!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">            player.moveBy(touchX-touchStartX,touchY-touchStartY);</span><br><span class=\"line\">            event.getCurrentTarget().touchStartX = touchX;</span><br><span class=\"line\">            event.getCurrentTarget().touchStartY = touchY;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    touchended:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">touch,event</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> GameScene = cc.Scene.extend(&#123;</span><br><span class=\"line\">    onEnter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer = <span class=\"keyword\">new</span> GameLayer();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"暂停场景\"><a href=\"#暂停场景\" class=\"headerlink\" title=\"暂停场景\"></a>暂停场景</h4><p>在游戏场景点击暂停按钮进入暂停场景，暂停场景实际上只是一个半透明的层盖在游戏场景上，进入暂停场景后游戏暂停，暂停场景包含继续按钮，结束按钮和重新开始按钮。<br>暂停场景效果图如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/PauseMenu.gif\" alt=\"暂停场景\"><br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> PauseLayer=cc.LayerColor.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">pauseBtn</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 初始化为黑色</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super(cc.color(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">100</span>));</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.width = cc.winSize.width;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.height = cc.winSize.height;</span><br><span class=\"line\">        <span class=\"comment\">// 继续按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> resumeBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_continue.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_continue_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.audioEngine.resumeMusic();</span><br><span class=\"line\">                cc.director.resume();</span><br><span class=\"line\">                pauseBtn.setEnabled(<span class=\"literal\">true</span>);</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.removeFromParent();</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        resumeBtn.setPosition(<span class=\"number\">0</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 结束游戏按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> overBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_over.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_over_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.audioEngine.stopMusic(<span class=\"string\">&quot;res/sound/game_music.mp3&quot;</span>);</span><br><span class=\"line\">                cc.director.resume();</span><br><span class=\"line\">                cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> MenuScene()));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        overBtn.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 重新开始按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> reagainBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_Reagain.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/game_Reagain_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.audioEngine.stopMusic(<span class=\"string\">&quot;res/sound/game_music.mp3&quot;</span>);</span><br><span class=\"line\">                cc.director.resume();</span><br><span class=\"line\">                cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> GameScene()));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        reagainBtn.setPosition(<span class=\"number\">0</span>,<span class=\"number\">-100</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(resumeBtn,overBtn,reagainBtn);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"结束场景\"><a href=\"#结束场景\" class=\"headerlink\" title=\"结束场景\"></a>结束场景</h4><p>在游戏场景中，如果在碰撞检测中检测到玩家与敌机碰撞，则游戏结束，游戏结束进入结束场景，结束场景包含玩家的最终分数，以及展示最高历史分数和保存最高历史分数。<br>结束场景的效果如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/OverScene.gif\" alt=\"结束场景\"><br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverLayer=cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">score</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> Background(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        bg.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> highest = cc.sys.localStorage.getItem(<span class=\"string\">&quot;highest&quot;</span>);</span><br><span class=\"line\">        highest = highest==<span class=\"literal\">null</span>?<span class=\"number\">0</span>:highest;</span><br><span class=\"line\">        <span class=\"comment\">// 分数存储</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">parseInt</span>(score)&gt;<span class=\"built_in\">parseInt</span>(highest))&#123;</span><br><span class=\"line\">            cc.sys.localStorage.setItem(<span class=\"string\">&quot;highest&quot;</span> ,score);</span><br><span class=\"line\">            highest = score;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 历史最高分数</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> highestFnt = <span class=\"keyword\">new</span> cc.LabelBMFont(highest.toString(),res.font);</span><br><span class=\"line\">        highestFnt.setPosition(<span class=\"number\">250</span>,cc.winSize.height-highestFnt.height/<span class=\"number\">2</span><span class=\"number\">-75</span>);</span><br><span class=\"line\">        highestFnt.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(highestFnt);</span><br><span class=\"line\">        <span class=\"comment\">// 分数显示</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> scoreFnt = <span class=\"keyword\">new</span> cc.LabelBMFont(score,res.font);</span><br><span class=\"line\">        scoreFnt.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(scoreFnt);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scheduleOnce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/out_porp.mp3&quot;</span>);</span><br><span class=\"line\">            scoreFnt.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.5</span>),cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">        &#125;,<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 菜单按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> restartBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/btn_finish.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/btn_finish_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> MenuScene()));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        restartBtn.setPosition(scoreFnt.getPositionX(),scoreFnt.getPositionY()-scoreFnt.height/<span class=\"number\">2</span><span class=\"number\">-100</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(restartBtn);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        menu.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverScene=cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">score</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer=<span class=\"keyword\">new</span> OverLayer(score);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"帮助场景\"><a href=\"#帮助场景\" class=\"headerlink\" title=\"帮助场景\"></a>帮助场景</h4><p>帮助场景就是一个展示游戏帮助提示的场景，其实只有文字和返回游戏按钮。<br>帮助场景的效果如下：<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/HelpScene.gif\" alt=\"帮助场景\"><br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Henry on 16/7/6.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverLayer=cc.Layer.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">score</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bg = <span class=\"keyword\">new</span> Background(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        bg.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(bg);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> highest = cc.sys.localStorage.getItem(<span class=\"string\">&quot;highest&quot;</span>);</span><br><span class=\"line\">        highest = highest==<span class=\"literal\">null</span>?<span class=\"number\">0</span>:highest;</span><br><span class=\"line\">        <span class=\"comment\">// 分数存储</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">parseInt</span>(score)&gt;<span class=\"built_in\">parseInt</span>(highest))&#123;</span><br><span class=\"line\">            cc.sys.localStorage.setItem(<span class=\"string\">&quot;highest&quot;</span> ,score);</span><br><span class=\"line\">            highest = score;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 历史最高分数</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> highestFnt = <span class=\"keyword\">new</span> cc.LabelBMFont(highest.toString(),res.font);</span><br><span class=\"line\">        highestFnt.setPosition(<span class=\"number\">250</span>,cc.winSize.height-highestFnt.height/<span class=\"number\">2</span><span class=\"number\">-75</span>);</span><br><span class=\"line\">        highestFnt.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0.5</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(highestFnt);</span><br><span class=\"line\">        <span class=\"comment\">// 分数显示</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> scoreFnt = <span class=\"keyword\">new</span> cc.LabelBMFont(score,res.font);</span><br><span class=\"line\">        scoreFnt.setPosition(cc.winSize.width/<span class=\"number\">2</span>,cc.winSize.height/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(scoreFnt);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.scheduleOnce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/out_porp.mp3&quot;</span>);</span><br><span class=\"line\">            scoreFnt.runAction(cc.sequence(cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1.5</span>),cc.scaleTo(<span class=\"number\">0.2</span>,<span class=\"number\">1</span>)));</span><br><span class=\"line\">        &#125;,<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 菜单按钮</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> restartBtn = <span class=\"keyword\">new</span> cc.MenuItemSprite(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/btn_finish.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> cc.Sprite(<span class=\"string\">&quot;res/btn_finish_selected.png&quot;</span>),</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                cc.audioEngine.playEffect(<span class=\"string\">&quot;res/sound/button.mp3&quot;</span>);</span><br><span class=\"line\">                cc.director.runScene(<span class=\"keyword\">new</span> cc.TransitionFade(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> MenuScene()));</span><br><span class=\"line\">            &#125;, <span class=\"built_in\">this</span>);</span><br><span class=\"line\">        restartBtn.setPosition(scoreFnt.getPositionX(),scoreFnt.getPositionY()-scoreFnt.height/<span class=\"number\">2</span><span class=\"number\">-100</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> menu = <span class=\"keyword\">new</span> cc.Menu(restartBtn);</span><br><span class=\"line\">        menu.setPosition(<span class=\"number\">0</span>,<span class=\"number\">0</span>);install</span><br><span class=\"line\">        menu.setAnchorPoint(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(menu);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> OverScene=cc.Scene.extend(&#123;</span><br><span class=\"line\">    ctor:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">score</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>._super();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> layer=<span class=\"keyword\">new</span> OverLayer(score);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.addChild(layer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"运行效果\"><a href=\"#运行效果\" class=\"headerlink\" title=\"运行效果\"></a>运行效果</h3><p>最后的运行效果如下<br><img src=\"http://7xnnwn.com1.z0.glb.clouddn.com/Plane.gif\" alt=\"打飞机效果图\"><br>通过CVP平台的项目托管可看到实际运行效果，地址如下：<br><a href=\"http://www.cocoscvp.com/usercode/3d1775ea3aea1f12e986b7d8ebbb079fca12c064/\">http://www.cocoscvp.com/usercode/3d1775ea3aea1f12e986b7d8ebbb079fca12c064/</a></p>\n<h3 id=\"源代码\"><a href=\"#源代码\" class=\"headerlink\" title=\"源代码\"></a>源代码</h3><p>所有源代码均上传到github，欢迎交流学习，地址：<br><a href=\"https://github.com/hjcenry/plane\">https://github.com/hjcenry/plane</a></p>\n<ul>\n<li>原文博客：<a href=\"http://hjcenry.github.io/\">http://hjcenry.github.io</a></li>\n</ul>"}],"PostAsset":[],"PostCategory":[{"post_id":"ckflddhtb0001wsazebb85kxs","category_id":"ckflddhth0004wsazd0woeqx8","_id":"ckflddhts000fwsaz6n2iazbw"},{"post_id":"ckflddhtp000dwsaz9ct7dof1","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhtx000kwsaz4gmi4mdo"},{"post_id":"ckflddhtf0003wsazeec7be0f","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhtz000owsazbyag7yo3"},{"post_id":"ckflddhtr000ewsaz9olxah2n","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhu1000qwsaz0rgo27hz"},{"post_id":"ckflddhtu000iwsazb7i30ojc","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhu6000uwsazc7p75tfb"},{"post_id":"ckflddhtk0007wsaz3gb42je3","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhu7000xwsaz2isl2ygo"},{"post_id":"ckflddhtw000jwsaz9jol2cpu","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhu90010wsaz7emlfrfs"},{"post_id":"ckflddhty000nwsaze1idhkd5","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhua0014wsazfhvn71kv"},{"post_id":"ckflddhtn0009wsazepxdgybi","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhub0017wsazbcvehyup"},{"post_id":"ckflddhu0000pwsaz49q33dl6","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhud001bwsazg6kk68r2"},{"post_id":"ckflddhu2000twsazaiuxd4pt","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhue001ewsaze56p8nq1"},{"post_id":"ckflddhto000awsazdm7ebrle","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhug001iwsazck7le5p5"},{"post_id":"ckflddhu7000wwsaz7bft5tud","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhuh001lwsazh5tf89qo"},{"post_id":"ckflddhu8000zwsaz37ba298i","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhuj001pwsaz35udhj7l"},{"post_id":"ckflddhua0013wsazg4793syj","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhuk001swsazc6hz8a6p"},{"post_id":"ckflddhub0016wsaz5a1f9lhk","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhum001wwsazcahd81q4"},{"post_id":"ckflddhud001awsaz08re5fgj","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhun001zwsaz6iu0ctzm"},{"post_id":"ckflddhue001dwsaz2axrb1vo","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhuo0023wsaz3j77b6lk"},{"post_id":"ckflddhuf001hwsaz0tsj99jv","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhuq0026wsaz0oxbay0f"},{"post_id":"ckflddhug001kwsazc7xo5tkj","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhur002awsaz7w339wku"},{"post_id":"ckflddhui001owsaz4o1v9gfj","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhus002dwsazbf8p4xrm"},{"post_id":"ckflddhuj001rwsaz2ipgb68v","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhuu002hwsazb1wv5vig"},{"post_id":"ckflddhul001vwsazd9qhgu94","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhuv002kwsaz3enee3yy"},{"post_id":"ckflddhum001ywsazdzhb1o1n","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhux002owsaz5u0nb4p2"},{"post_id":"ckflddhuo0022wsazez3dgfr6","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhux002qwsazedagaz83"},{"post_id":"ckflddhup0025wsaz5cpu5bet","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhuz002uwsaz51w845sd"},{"post_id":"ckflddhuq0029wsazgtab1udd","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhuz002wwsaz3iyn65of"},{"post_id":"ckflddhus002cwsaz8o4g7x8o","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhv0002zwsaze1rcax8j"},{"post_id":"ckflddhut002gwsazazxbc4u1","category_id":"ckflddhth0004wsazd0woeqx8","_id":"ckflddhv00031wsazc9sd2vth"},{"post_id":"ckflddhuv002jwsazfp1n7k4z","category_id":"ckflddhth0004wsazd0woeqx8","_id":"ckflddhv10034wsaz709ogzjv"},{"post_id":"ckflddhuw002nwsaz0967h5h9","category_id":"ckflddhuy002swsaz87ii9aoc","_id":"ckflddhv10036wsazba0r8l4s"},{"post_id":"ckflddhvk004twsaz7ccf2apc","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhvt0050wsazflklds3l"},{"post_id":"ckflddhvp004uwsazdj8r90e3","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhvu0052wsazhnmcfbyy"},{"post_id":"ckflddhvq004wwsaz3bgw4f0j","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhvv0055wsazgmipd559"},{"post_id":"ckflddhvs004zwsaz29zfcpxp","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhvw0057wsaz79ks6umy"},{"post_id":"ckflddhvt0051wsaz9itvfrhh","category_id":"ckflddhth0004wsazd0woeqx8","_id":"ckflddhvx005awsazhg03b6v8"},{"post_id":"ckflddhvu0053wsazacvefp8b","category_id":"ckflddhvw0058wsazeo0hclaa","_id":"ckflddhw0005hwsaz6puld4vi"},{"post_id":"ckflddhw2005qwsazffs0834w","category_id":"ckflddhtp000bwsaz9n1xhs92","_id":"ckflddhw4005swsaz2naz9ibx"}],"PostTag":[{"post_id":"ckflddhtb0001wsazebb85kxs","tag_id":"ckflddhtj0005wsazegto1k7u","_id":"ckflddhu6000vwsaz7uo543k6"},{"post_id":"ckflddhtb0001wsazebb85kxs","tag_id":"ckflddhtp000cwsaz27pd86fz","_id":"ckflddhu8000ywsaz4ar23kwd"},{"post_id":"ckflddhtb0001wsazebb85kxs","tag_id":"ckflddhtt000hwsaz2eskduet","_id":"ckflddhu90012wsaz93x5cvkw"},{"post_id":"ckflddhtb0001wsazebb85kxs","tag_id":"ckflddhty000mwsaz1zw580lb","_id":"ckflddhub0015wsaz598vbsp3"},{"post_id":"ckflddhua0013wsazg4793syj","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhuc0019wsaz6sbs0s6p"},{"post_id":"ckflddhua0013wsazg4793syj","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhue001cwsaz0kue387p"},{"post_id":"ckflddhtf0003wsazeec7be0f","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhuf001gwsaz5umq7544"},{"post_id":"ckflddhtf0003wsazeec7be0f","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhug001jwsazg9ou2vq5"},{"post_id":"ckflddhub0016wsaz5a1f9lhk","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhui001nwsazcezw8dt1"},{"post_id":"ckflddhub0016wsaz5a1f9lhk","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhuj001qwsazcw748lx4"},{"post_id":"ckflddhud001awsaz08re5fgj","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhul001uwsaz7ytr63ai"},{"post_id":"ckflddhud001awsaz08re5fgj","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhum001xwsaz82i8axzk"},{"post_id":"ckflddhue001dwsaz2axrb1vo","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhuo0021wsaz90h5hx3w"},{"post_id":"ckflddhue001dwsaz2axrb1vo","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhup0024wsaz0v6d5bzw"},{"post_id":"ckflddhuf001hwsaz0tsj99jv","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhuq0028wsaz9qff40w1"},{"post_id":"ckflddhuf001hwsaz0tsj99jv","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhur002bwsaz95jx8uj0"},{"post_id":"ckflddhtk0007wsaz3gb42je3","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhut002fwsazabj89bcn"},{"post_id":"ckflddhtk0007wsaz3gb42je3","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhuu002iwsazauk5gdwp"},{"post_id":"ckflddhug001kwsazc7xo5tkj","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhuw002mwsaz2ekc1p6y"},{"post_id":"ckflddhug001kwsazc7xo5tkj","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhux002pwsazgjx9gvvk"},{"post_id":"ckflddhui001owsaz4o1v9gfj","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhuz002twsazakplabxb"},{"post_id":"ckflddhui001owsaz4o1v9gfj","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhuz002vwsaz0ju3bi8g"},{"post_id":"ckflddhuj001rwsaz2ipgb68v","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhuz002ywsaz4v0q0dwa"},{"post_id":"ckflddhuj001rwsaz2ipgb68v","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhv00030wsazg33zdgvf"},{"post_id":"ckflddhul001vwsazd9qhgu94","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhv00033wsaz08sdgmp9"},{"post_id":"ckflddhul001vwsazd9qhgu94","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhv10035wsazavohf0fu"},{"post_id":"ckflddhtn0009wsazepxdgybi","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhv10038wsazcr718e1n"},{"post_id":"ckflddhtn0009wsazepxdgybi","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhv10039wsaz1qyi663e"},{"post_id":"ckflddhum001ywsazdzhb1o1n","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhv2003bwsaz3y0leziu"},{"post_id":"ckflddhum001ywsazdzhb1o1n","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhv2003cwsaz0nmgflko"},{"post_id":"ckflddhuo0022wsazez3dgfr6","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhv2003ewsazhpak1hic"},{"post_id":"ckflddhuo0022wsazez3dgfr6","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhv3003fwsazf5n0g36y"},{"post_id":"ckflddhup0025wsaz5cpu5bet","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhv3003hwsazcqd2876y"},{"post_id":"ckflddhup0025wsaz5cpu5bet","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhv3003iwsazaw0yh1l5"},{"post_id":"ckflddhuq0029wsazgtab1udd","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhv4003kwsaz6on76184"},{"post_id":"ckflddhuq0029wsazgtab1udd","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhv4003lwsazfsq578mu"},{"post_id":"ckflddhto000awsazdm7ebrle","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhv4003nwsazhgb9cbf5"},{"post_id":"ckflddhto000awsazdm7ebrle","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhv5003owsaz79z8152r"},{"post_id":"ckflddhus002cwsaz8o4g7x8o","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhv5003qwsazhakz8y42"},{"post_id":"ckflddhus002cwsaz8o4g7x8o","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhv5003rwsaz3dzb051k"},{"post_id":"ckflddhtp000dwsaz9ct7dof1","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhv6003twsazdc043wco"},{"post_id":"ckflddhtp000dwsaz9ct7dof1","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhv6003uwsaz5yhx99gv"},{"post_id":"ckflddhtr000ewsaz9olxah2n","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhv8003wwsaza1lg8895"},{"post_id":"ckflddhtr000ewsaz9olxah2n","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhv8003xwsaz4pvr9ln3"},{"post_id":"ckflddhtu000iwsazb7i30ojc","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhv9003zwsazdw760pn0"},{"post_id":"ckflddhtu000iwsazb7i30ojc","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhv90040wsazg45rg5sr"},{"post_id":"ckflddhtw000jwsaz9jol2cpu","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhv90042wsaz3dqth0c9"},{"post_id":"ckflddhtw000jwsaz9jol2cpu","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhv90043wsaz228aa9gr"},{"post_id":"ckflddhty000nwsaze1idhkd5","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhva0045wsaz106vhwnw"},{"post_id":"ckflddhty000nwsaze1idhkd5","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhva0046wsaz8oxp6fvx"},{"post_id":"ckflddhu0000pwsaz49q33dl6","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhvc0048wsaz2kwchgg6"},{"post_id":"ckflddhu0000pwsaz49q33dl6","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhvc0049wsaz2kpef1uc"},{"post_id":"ckflddhu2000twsazaiuxd4pt","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhvc004awsazhiyt8t7u"},{"post_id":"ckflddhu2000twsazaiuxd4pt","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhvd004cwsaz5t16hf6i"},{"post_id":"ckflddhu7000wwsaz7bft5tud","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhve004dwsaz0hns0tpr"},{"post_id":"ckflddhu7000wwsaz7bft5tud","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhve004fwsaz1qrs9krf"},{"post_id":"ckflddhu8000zwsaz37ba298i","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhve004gwsaz91iiezl2"},{"post_id":"ckflddhu8000zwsaz37ba298i","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhvf004iwsazawjug2vz"},{"post_id":"ckflddhut002gwsazazxbc4u1","tag_id":"ckflddhtj0005wsazegto1k7u","_id":"ckflddhvf004jwsaz24bgdmjx"},{"post_id":"ckflddhut002gwsazazxbc4u1","tag_id":"ckflddhva0044wsaz519tgwsf","_id":"ckflddhvg004lwsaz7jub2n4n"},{"post_id":"ckflddhut002gwsazazxbc4u1","tag_id":"ckflddhva0047wsaz815rbtt5","_id":"ckflddhvg004mwsaz8cl6ccl1"},{"post_id":"ckflddhut002gwsazazxbc4u1","tag_id":"ckflddhtp000cwsaz27pd86fz","_id":"ckflddhvg004nwsaz4ukadr95"},{"post_id":"ckflddhuv002jwsazfp1n7k4z","tag_id":"ckflddhtj0005wsazegto1k7u","_id":"ckflddhvg004owsaz5fzk3ohg"},{"post_id":"ckflddhuv002jwsazfp1n7k4z","tag_id":"ckflddhvc004bwsazdud72bzi","_id":"ckflddhvg004pwsaz25dm685q"},{"post_id":"ckflddhuv002jwsazfp1n7k4z","tag_id":"ckflddhve004ewsaz04gk6a3z","_id":"ckflddhvg004qwsaza8knftlj"},{"post_id":"ckflddhuv002jwsazfp1n7k4z","tag_id":"ckflddhva0044wsaz519tgwsf","_id":"ckflddhvg004rwsazfw9l0fmt"},{"post_id":"ckflddhuw002nwsaz0967h5h9","tag_id":"ckflddhvf004kwsaz3kpwesfb","_id":"ckflddhvh004swsazhf903672"},{"post_id":"ckflddhvk004twsaz7ccf2apc","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhvq004vwsaz3qglfn0l"},{"post_id":"ckflddhvk004twsaz7ccf2apc","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhvs004ywsaz4ge35qnr"},{"post_id":"ckflddhvp004uwsazdj8r90e3","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhvw0056wsaz3zkk294y"},{"post_id":"ckflddhvp004uwsazdj8r90e3","tag_id":"ckflddhvr004xwsazde5885pz","_id":"ckflddhvx0059wsazdqao2kq4"},{"post_id":"ckflddhvp004uwsazdj8r90e3","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhvy005cwsazegkp0gqv"},{"post_id":"ckflddhvq004wwsaz3bgw4f0j","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhvy005dwsazdzly0zvi"},{"post_id":"ckflddhvq004wwsaz3bgw4f0j","tag_id":"ckflddhvv0054wsaze22g0m3a","_id":"ckflddhvz005fwsaz9826g1l3"},{"post_id":"ckflddhvq004wwsaz3bgw4f0j","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhvz005gwsaz5u40byhn"},{"post_id":"ckflddhvs004zwsaz29zfcpxp","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhw0005jwsaz4x7wclbk"},{"post_id":"ckflddhvs004zwsaz29zfcpxp","tag_id":"ckflddhvx005bwsaz1acq93im","_id":"ckflddhw0005kwsazfxrtbxjx"},{"post_id":"ckflddhvt0051wsaz9itvfrhh","tag_id":"ckflddhtj0005wsazegto1k7u","_id":"ckflddhw1005mwsazb0kb574w"},{"post_id":"ckflddhvt0051wsaz9itvfrhh","tag_id":"ckflddhvy005ewsazbm8y998y","_id":"ckflddhw1005nwsaz756q0qrc"},{"post_id":"ckflddhvt0051wsaz9itvfrhh","tag_id":"ckflddhw0005iwsazf6usfd1m","_id":"ckflddhw1005owsaz2tfr8krl"},{"post_id":"ckflddhvu0053wsazacvefp8b","tag_id":"ckflddhw0005lwsaz9hw4dzma","_id":"ckflddhw1005pwsaz5aj9c45u"},{"post_id":"ckflddhw2005qwsazffs0834w","tag_id":"ckflddhu1000swsaz1s7g3sn1","_id":"ckflddhw6005twsazhkdye8y3"},{"post_id":"ckflddhw2005qwsazffs0834w","tag_id":"ckflddhw3005rwsaz662rh2w9","_id":"ckflddhw6005uwsazbg0929ug"},{"post_id":"ckflddhw2005qwsazffs0834w","tag_id":"ckflddhu90011wsazae47bjbb","_id":"ckflddhw6005vwsazbweb9kav"}],"Tag":[{"name":"Java","_id":"ckflddhtj0005wsazegto1k7u"},{"name":"游戏服务器","_id":"ckflddhtp000cwsaz27pd86fz"},{"name":"总结","_id":"ckflddhtt000hwsaz2eskduet"},{"name":"随笔","_id":"ckflddhty000mwsaz1zw580lb"},{"name":"cocos2d-js","_id":"ckflddhu1000swsaz1s7g3sn1"},{"name":"cvp","_id":"ckflddhu90011wsazae47bjbb"},{"name":"rpc","_id":"ckflddhva0044wsaz519tgwsf"},{"name":"jsonrpc","_id":"ckflddhva0047wsaz815rbtt5"},{"name":"Motan","_id":"ckflddhvc004bwsazdud72bzi"},{"name":"开源","_id":"ckflddhve004ewsaz04gk6a3z"},{"name":"Python","_id":"ckflddhvf004kwsaz3kpwesfb"},{"name":"点我+1","_id":"ckflddhvr004xwsazde5885pz"},{"name":"2048","_id":"ckflddhvv0054wsaze22g0m3a"},{"name":"贪吃蛇","_id":"ckflddhvx005bwsaz1acq93im"},{"name":"csv","_id":"ckflddhvy005ewsazbm8y998y"},{"name":"xml","_id":"ckflddhw0005iwsazf6usfd1m"},{"name":"生活","_id":"ckflddhw0005lwsaz9hw4dzma"},{"name":"打飞机","_id":"ckflddhw3005rwsaz662rh2w9"}]}}